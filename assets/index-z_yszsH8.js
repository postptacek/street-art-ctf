function wLe(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const l=Object.getOwnPropertyDescriptor(i,s);l&&Object.defineProperty(n,s,l.get?l:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();var xg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function t7(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function CLe(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var n7={exports:{}},wS={},i7={exports:{}},_i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V1=Symbol.for("react.element"),ELe=Symbol.for("react.portal"),_Le=Symbol.for("react.fragment"),ILe=Symbol.for("react.strict_mode"),SLe=Symbol.for("react.profiler"),TLe=Symbol.for("react.provider"),MLe=Symbol.for("react.context"),kLe=Symbol.for("react.forward_ref"),RLe=Symbol.for("react.suspense"),LLe=Symbol.for("react.memo"),BLe=Symbol.for("react.lazy"),fX=Symbol.iterator;function PLe(n){return n===null||typeof n!="object"?null:(n=fX&&n[fX]||n["@@iterator"],typeof n=="function"?n:null)}var r7={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},s7=Object.assign,o7={};function WA(n,e,t){this.props=n,this.context=e,this.refs=o7,this.updater=t||r7}WA.prototype.isReactComponent={};WA.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};WA.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function a7(){}a7.prototype=WA.prototype;function F3(n,e,t){this.props=n,this.context=e,this.refs=o7,this.updater=t||r7}var O3=F3.prototype=new a7;O3.constructor=F3;s7(O3,WA.prototype);O3.isPureReactComponent=!0;var pX=Array.isArray,l7=Object.prototype.hasOwnProperty,V3={current:null},c7={key:!0,ref:!0,__self:!0,__source:!0};function u7(n,e,t){var i,s={},l=null,u=null;if(e!=null)for(i in e.ref!==void 0&&(u=e.ref),e.key!==void 0&&(l=""+e.key),e)l7.call(e,i)&&!c7.hasOwnProperty(i)&&(s[i]=e[i]);var d=arguments.length-2;if(d===1)s.children=t;else if(1<d){for(var p=Array(d),g=0;g<d;g++)p[g]=arguments[g+2];s.children=p}if(n&&n.defaultProps)for(i in d=n.defaultProps,d)s[i]===void 0&&(s[i]=d[i]);return{$$typeof:V1,type:n,key:l,ref:u,props:s,_owner:V3.current}}function NLe(n,e){return{$$typeof:V1,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function U3(n){return typeof n=="object"&&n!==null&&n.$$typeof===V1}function DLe(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var mX=/\/+/g;function mL(n,e){return typeof n=="object"&&n!==null&&n.key!=null?DLe(""+n.key):e.toString(36)}function U_(n,e,t,i,s){var l=typeof n;(l==="undefined"||l==="boolean")&&(n=null);var u=!1;if(n===null)u=!0;else switch(l){case"string":case"number":u=!0;break;case"object":switch(n.$$typeof){case V1:case ELe:u=!0}}if(u)return u=n,s=s(u),n=i===""?"."+mL(u,0):i,pX(s)?(t="",n!=null&&(t=n.replace(mX,"$&/")+"/"),U_(s,e,t,"",function(g){return g})):s!=null&&(U3(s)&&(s=NLe(s,t+(!s.key||u&&u.key===s.key?"":(""+s.key).replace(mX,"$&/")+"/")+n)),e.push(s)),1;if(u=0,i=i===""?".":i+":",pX(n))for(var d=0;d<n.length;d++){l=n[d];var p=i+mL(l,d);u+=U_(l,e,t,p,s)}else if(p=PLe(n),typeof p=="function")for(n=p.call(n),d=0;!(l=n.next()).done;)l=l.value,p=i+mL(l,d++),u+=U_(l,e,t,p,s);else if(l==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return u}function $C(n,e,t){if(n==null)return n;var i=[],s=0;return U_(n,i,"","",function(l){return e.call(t,l,s++)}),i}function FLe(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ka={current:null},z_={transition:null},OLe={ReactCurrentDispatcher:ka,ReactCurrentBatchConfig:z_,ReactCurrentOwner:V3};function h7(){throw Error("act(...) is not supported in production builds of React.")}_i.Children={map:$C,forEach:function(n,e,t){$C(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return $C(n,function(){e++}),e},toArray:function(n){return $C(n,function(e){return e})||[]},only:function(n){if(!U3(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};_i.Component=WA;_i.Fragment=_Le;_i.Profiler=SLe;_i.PureComponent=F3;_i.StrictMode=ILe;_i.Suspense=RLe;_i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OLe;_i.act=h7;_i.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=s7({},n.props),s=n.key,l=n.ref,u=n._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,u=V3.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var d=n.type.defaultProps;for(p in e)l7.call(e,p)&&!c7.hasOwnProperty(p)&&(i[p]=e[p]===void 0&&d!==void 0?d[p]:e[p])}var p=arguments.length-2;if(p===1)i.children=t;else if(1<p){d=Array(p);for(var g=0;g<p;g++)d[g]=arguments[g+2];i.children=d}return{$$typeof:V1,type:n.type,key:s,ref:l,props:i,_owner:u}};_i.createContext=function(n){return n={$$typeof:MLe,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:TLe,_context:n},n.Consumer=n};_i.createElement=u7;_i.createFactory=function(n){var e=u7.bind(null,n);return e.type=n,e};_i.createRef=function(){return{current:null}};_i.forwardRef=function(n){return{$$typeof:kLe,render:n}};_i.isValidElement=U3;_i.lazy=function(n){return{$$typeof:BLe,_payload:{_status:-1,_result:n},_init:FLe}};_i.memo=function(n,e){return{$$typeof:LLe,type:n,compare:e===void 0?null:e}};_i.startTransition=function(n){var e=z_.transition;z_.transition={};try{n()}finally{z_.transition=e}};_i.unstable_act=h7;_i.useCallback=function(n,e){return ka.current.useCallback(n,e)};_i.useContext=function(n){return ka.current.useContext(n)};_i.useDebugValue=function(){};_i.useDeferredValue=function(n){return ka.current.useDeferredValue(n)};_i.useEffect=function(n,e){return ka.current.useEffect(n,e)};_i.useId=function(){return ka.current.useId()};_i.useImperativeHandle=function(n,e,t){return ka.current.useImperativeHandle(n,e,t)};_i.useInsertionEffect=function(n,e){return ka.current.useInsertionEffect(n,e)};_i.useLayoutEffect=function(n,e){return ka.current.useLayoutEffect(n,e)};_i.useMemo=function(n,e){return ka.current.useMemo(n,e)};_i.useReducer=function(n,e,t){return ka.current.useReducer(n,e,t)};_i.useRef=function(n){return ka.current.useRef(n)};_i.useState=function(n){return ka.current.useState(n)};_i.useSyncExternalStore=function(n,e,t){return ka.current.useSyncExternalStore(n,e,t)};_i.useTransition=function(){return ka.current.useTransition()};_i.version="18.3.1";i7.exports=_i;var Le=i7.exports;const Vg=t7(Le),VLe=wLe({__proto__:null,default:Vg},[Le]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ULe=Le,zLe=Symbol.for("react.element"),GLe=Symbol.for("react.fragment"),WLe=Object.prototype.hasOwnProperty,HLe=ULe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,XLe={key:!0,ref:!0,__self:!0,__source:!0};function d7(n,e,t){var i,s={},l=null,u=null;t!==void 0&&(l=""+t),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(u=e.ref);for(i in e)WLe.call(e,i)&&!XLe.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:zLe,type:n,key:l,ref:u,props:s,_owner:HLe.current}}wS.Fragment=GLe;wS.jsx=d7;wS.jsxs=d7;n7.exports=wS;var he=n7.exports,sN={},f7={exports:{}},Bl={},p7={exports:{}},m7={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Ae,Fe){var Ie=Ae.length;Ae.push(Fe);e:for(;0<Ie;){var qe=Ie-1>>>1,dt=Ae[qe];if(0<s(dt,Fe))Ae[qe]=Fe,Ae[Ie]=dt,Ie=qe;else break e}}function t(Ae){return Ae.length===0?null:Ae[0]}function i(Ae){if(Ae.length===0)return null;var Fe=Ae[0],Ie=Ae.pop();if(Ie!==Fe){Ae[0]=Ie;e:for(var qe=0,dt=Ae.length,Wt=dt>>>1;qe<Wt;){var xt=2*(qe+1)-1,At=Ae[xt],Rt=xt+1,Et=Ae[Rt];if(0>s(At,Ie))Rt<dt&&0>s(Et,At)?(Ae[qe]=Et,Ae[Rt]=Ie,qe=Rt):(Ae[qe]=At,Ae[xt]=Ie,qe=xt);else if(Rt<dt&&0>s(Et,Ie))Ae[qe]=Et,Ae[Rt]=Ie,qe=Rt;else break e}}return Fe}function s(Ae,Fe){var Ie=Ae.sortIndex-Fe.sortIndex;return Ie!==0?Ie:Ae.id-Fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var u=Date,d=u.now();n.unstable_now=function(){return u.now()-d}}var p=[],g=[],x=1,b=null,E=3,S=!1,M=!1,R=!1,P=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,F=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(Ae){for(var Fe=t(g);Fe!==null;){if(Fe.callback===null)i(g);else if(Fe.startTime<=Ae)i(g),Fe.sortIndex=Fe.expirationTime,e(p,Fe);else break;Fe=t(g)}}function G(Ae){if(R=!1,V(Ae),!M)if(t(p)!==null)M=!0,Me(q);else{var Fe=t(g);Fe!==null&&Ne(G,Fe.startTime-Ae)}}function q(Ae,Fe){M=!1,R&&(R=!1,k(Q),Q=-1),S=!0;var Ie=E;try{for(V(Fe),b=t(p);b!==null&&(!(b.expirationTime>Fe)||Ae&&!ee());){var qe=b.callback;if(typeof qe=="function"){b.callback=null,E=b.priorityLevel;var dt=qe(b.expirationTime<=Fe);Fe=n.unstable_now(),typeof dt=="function"?b.callback=dt:b===t(p)&&i(p),V(Fe)}else i(p);b=t(p)}if(b!==null)var Wt=!0;else{var xt=t(g);xt!==null&&Ne(G,xt.startTime-Fe),Wt=!1}return Wt}finally{b=null,E=Ie,S=!1}}var ne=!1,K=null,Q=-1,H=5,j=-1;function ee(){return!(n.unstable_now()-j<H)}function de(){if(K!==null){var Ae=n.unstable_now();j=Ae;var Fe=!0;try{Fe=K(!0,Ae)}finally{Fe?oe():(ne=!1,K=null)}}else ne=!1}var oe;if(typeof F=="function")oe=function(){F(de)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,$e=we.port2;we.port1.onmessage=de,oe=function(){$e.postMessage(null)}}else oe=function(){P(de,0)};function Me(Ae){K=Ae,ne||(ne=!0,oe())}function Ne(Ae,Fe){Q=P(function(){Ae(n.unstable_now())},Fe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ae){Ae.callback=null},n.unstable_continueExecution=function(){M||S||(M=!0,Me(q))},n.unstable_forceFrameRate=function(Ae){0>Ae||125<Ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<Ae?Math.floor(1e3/Ae):5},n.unstable_getCurrentPriorityLevel=function(){return E},n.unstable_getFirstCallbackNode=function(){return t(p)},n.unstable_next=function(Ae){switch(E){case 1:case 2:case 3:var Fe=3;break;default:Fe=E}var Ie=E;E=Fe;try{return Ae()}finally{E=Ie}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ae,Fe){switch(Ae){case 1:case 2:case 3:case 4:case 5:break;default:Ae=3}var Ie=E;E=Ae;try{return Fe()}finally{E=Ie}},n.unstable_scheduleCallback=function(Ae,Fe,Ie){var qe=n.unstable_now();switch(typeof Ie=="object"&&Ie!==null?(Ie=Ie.delay,Ie=typeof Ie=="number"&&0<Ie?qe+Ie:qe):Ie=qe,Ae){case 1:var dt=-1;break;case 2:dt=250;break;case 5:dt=1073741823;break;case 4:dt=1e4;break;default:dt=5e3}return dt=Ie+dt,Ae={id:x++,callback:Fe,priorityLevel:Ae,startTime:Ie,expirationTime:dt,sortIndex:-1},Ie>qe?(Ae.sortIndex=Ie,e(g,Ae),t(p)===null&&Ae===t(g)&&(R?(k(Q),Q=-1):R=!0,Ne(G,Ie-qe))):(Ae.sortIndex=dt,e(p,Ae),M||S||(M=!0,Me(q))),Ae},n.unstable_shouldYield=ee,n.unstable_wrapCallback=function(Ae){var Fe=E;return function(){var Ie=E;E=Fe;try{return Ae.apply(this,arguments)}finally{E=Ie}}}})(m7);p7.exports=m7;var $Le=p7.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QLe=Le,kl=$Le;function Ut(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g7=new Set,Fx={};function e0(n,e){xA(n,e),xA(n+"Capture",e)}function xA(n,e){for(Fx[n]=e,n=0;n<e.length;n++)g7.add(e[n])}var Ld=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),oN=Object.prototype.hasOwnProperty,KLe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gX={},yX={};function ZLe(n){return oN.call(yX,n)?!0:oN.call(gX,n)?!1:KLe.test(n)?yX[n]=!0:(gX[n]=!0,!1)}function jLe(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function YLe(n,e,t,i){if(e===null||typeof e>"u"||jLe(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ra(n,e,t,i,s,l,u){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=l,this.removeEmptyString=u}var Eo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Eo[n]=new Ra(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Eo[e]=new Ra(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Eo[n]=new Ra(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Eo[n]=new Ra(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Eo[n]=new Ra(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Eo[n]=new Ra(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Eo[n]=new Ra(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Eo[n]=new Ra(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Eo[n]=new Ra(n,5,!1,n.toLowerCase(),null,!1,!1)});var z3=/[\-:]([a-z])/g;function G3(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(z3,G3);Eo[e]=new Ra(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(z3,G3);Eo[e]=new Ra(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(z3,G3);Eo[e]=new Ra(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Eo[n]=new Ra(n,1,!1,n.toLowerCase(),null,!1,!1)});Eo.xlinkHref=new Ra("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Eo[n]=new Ra(n,1,!1,n.toLowerCase(),null,!0,!0)});function W3(n,e,t,i){var s=Eo.hasOwnProperty(e)?Eo[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(YLe(e,t,s,i)&&(t=null),i||s===null?ZLe(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,i=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var $d=QLe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,QC=Symbol.for("react.element"),Fy=Symbol.for("react.portal"),Oy=Symbol.for("react.fragment"),H3=Symbol.for("react.strict_mode"),aN=Symbol.for("react.profiler"),y7=Symbol.for("react.provider"),A7=Symbol.for("react.context"),X3=Symbol.for("react.forward_ref"),lN=Symbol.for("react.suspense"),cN=Symbol.for("react.suspense_list"),$3=Symbol.for("react.memo"),Qf=Symbol.for("react.lazy"),v7=Symbol.for("react.offscreen"),AX=Symbol.iterator;function pb(n){return n===null||typeof n!="object"?null:(n=AX&&n[AX]||n["@@iterator"],typeof n=="function"?n:null)}var Ur=Object.assign,gL;function Kb(n){if(gL===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);gL=e&&e[1]||""}return`
`+gL+n}var yL=!1;function AL(n,e){if(!n||yL)return"";yL=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(g){var i=g}Reflect.construct(n,[],e)}else{try{e.call()}catch(g){i=g}n.call(e.prototype)}else{try{throw Error()}catch(g){i=g}n()}}catch(g){if(g&&i&&typeof g.stack=="string"){for(var s=g.stack.split(`
`),l=i.stack.split(`
`),u=s.length-1,d=l.length-1;1<=u&&0<=d&&s[u]!==l[d];)d--;for(;1<=u&&0<=d;u--,d--)if(s[u]!==l[d]){if(u!==1||d!==1)do if(u--,d--,0>d||s[u]!==l[d]){var p=`
`+s[u].replace(" at new "," at ");return n.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",n.displayName)),p}while(1<=u&&0<=d);break}}}finally{yL=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Kb(n):""}function qLe(n){switch(n.tag){case 5:return Kb(n.type);case 16:return Kb("Lazy");case 13:return Kb("Suspense");case 19:return Kb("SuspenseList");case 0:case 2:case 15:return n=AL(n.type,!1),n;case 11:return n=AL(n.type.render,!1),n;case 1:return n=AL(n.type,!0),n;default:return""}}function uN(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Oy:return"Fragment";case Fy:return"Portal";case aN:return"Profiler";case H3:return"StrictMode";case lN:return"Suspense";case cN:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case A7:return(n.displayName||"Context")+".Consumer";case y7:return(n._context.displayName||"Context")+".Provider";case X3:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case $3:return e=n.displayName||null,e!==null?e:uN(n.type)||"Memo";case Qf:e=n._payload,n=n._init;try{return uN(n(e))}catch{}}return null}function JLe(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return uN(e);case 8:return e===H3?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Rp(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function b7(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eBe(n){var e=b7(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,l=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(u){i=""+u,l.call(this,u)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(u){i=""+u},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function KC(n){n._valueTracker||(n._valueTracker=eBe(n))}function x7(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=b7(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function bI(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function hN(n,e){var t=e.checked;return Ur({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function vX(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=Rp(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function w7(n,e){e=e.checked,e!=null&&W3(n,"checked",e,!1)}function dN(n,e){w7(n,e);var t=Rp(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?fN(n,e.type,t):e.hasOwnProperty("defaultValue")&&fN(n,e.type,Rp(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function bX(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function fN(n,e,t){(e!=="number"||bI(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Zb=Array.isArray;function aA(n,e,t,i){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&i&&(n[t].defaultSelected=!0)}else{for(t=""+Rp(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,i&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function pN(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ut(91));return Ur({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function xX(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ut(92));if(Zb(t)){if(1<t.length)throw Error(Ut(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Rp(t)}}function C7(n,e){var t=Rp(e.value),i=Rp(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function wX(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function E7(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function mN(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?E7(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ZC,_7=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ZC=ZC||document.createElement("div"),ZC.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ZC.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Ox(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var ax={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tBe=["Webkit","ms","Moz","O"];Object.keys(ax).forEach(function(n){tBe.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),ax[e]=ax[n]})});function I7(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||ax.hasOwnProperty(n)&&ax[n]?(""+e).trim():e+"px"}function S7(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,s=I7(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,s):n[t]=s}}var nBe=Ur({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function gN(n,e){if(e){if(nBe[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ut(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ut(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ut(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ut(62))}}function yN(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var AN=null;function Q3(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var vN=null,lA=null,cA=null;function CX(n){if(n=G1(n)){if(typeof vN!="function")throw Error(Ut(280));var e=n.stateNode;e&&(e=SS(e),vN(n.stateNode,n.type,e))}}function T7(n){lA?cA?cA.push(n):cA=[n]:lA=n}function M7(){if(lA){var n=lA,e=cA;if(cA=lA=null,CX(n),e)for(n=0;n<e.length;n++)CX(e[n])}}function k7(n,e){return n(e)}function R7(){}var vL=!1;function L7(n,e,t){if(vL)return n(e,t);vL=!0;try{return k7(n,e,t)}finally{vL=!1,(lA!==null||cA!==null)&&(R7(),M7())}}function Vx(n,e){var t=n.stateNode;if(t===null)return null;var i=SS(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ut(231,e,typeof t));return t}var bN=!1;if(Ld)try{var mb={};Object.defineProperty(mb,"passive",{get:function(){bN=!0}}),window.addEventListener("test",mb,mb),window.removeEventListener("test",mb,mb)}catch{bN=!1}function iBe(n,e,t,i,s,l,u,d,p){var g=Array.prototype.slice.call(arguments,3);try{e.apply(t,g)}catch(x){this.onError(x)}}var lx=!1,xI=null,wI=!1,xN=null,rBe={onError:function(n){lx=!0,xI=n}};function sBe(n,e,t,i,s,l,u,d,p){lx=!1,xI=null,iBe.apply(rBe,arguments)}function oBe(n,e,t,i,s,l,u,d,p){if(sBe.apply(this,arguments),lx){if(lx){var g=xI;lx=!1,xI=null}else throw Error(Ut(198));wI||(wI=!0,xN=g)}}function t0(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function B7(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function EX(n){if(t0(n)!==n)throw Error(Ut(188))}function aBe(n){var e=n.alternate;if(!e){if(e=t0(n),e===null)throw Error(Ut(188));return e!==n?null:n}for(var t=n,i=e;;){var s=t.return;if(s===null)break;var l=s.alternate;if(l===null){if(i=s.return,i!==null){t=i;continue}break}if(s.child===l.child){for(l=s.child;l;){if(l===t)return EX(s),n;if(l===i)return EX(s),e;l=l.sibling}throw Error(Ut(188))}if(t.return!==i.return)t=s,i=l;else{for(var u=!1,d=s.child;d;){if(d===t){u=!0,t=s,i=l;break}if(d===i){u=!0,i=s,t=l;break}d=d.sibling}if(!u){for(d=l.child;d;){if(d===t){u=!0,t=l,i=s;break}if(d===i){u=!0,i=l,t=s;break}d=d.sibling}if(!u)throw Error(Ut(189))}}if(t.alternate!==i)throw Error(Ut(190))}if(t.tag!==3)throw Error(Ut(188));return t.stateNode.current===t?n:e}function P7(n){return n=aBe(n),n!==null?N7(n):null}function N7(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=N7(n);if(e!==null)return e;n=n.sibling}return null}var D7=kl.unstable_scheduleCallback,_X=kl.unstable_cancelCallback,lBe=kl.unstable_shouldYield,cBe=kl.unstable_requestPaint,os=kl.unstable_now,uBe=kl.unstable_getCurrentPriorityLevel,K3=kl.unstable_ImmediatePriority,F7=kl.unstable_UserBlockingPriority,CI=kl.unstable_NormalPriority,hBe=kl.unstable_LowPriority,O7=kl.unstable_IdlePriority,CS=null,sh=null;function dBe(n){if(sh&&typeof sh.onCommitFiberRoot=="function")try{sh.onCommitFiberRoot(CS,n,void 0,(n.current.flags&128)===128)}catch{}}var iu=Math.clz32?Math.clz32:mBe,fBe=Math.log,pBe=Math.LN2;function mBe(n){return n>>>=0,n===0?32:31-(fBe(n)/pBe|0)|0}var jC=64,YC=4194304;function jb(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function EI(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,s=n.suspendedLanes,l=n.pingedLanes,u=t&268435455;if(u!==0){var d=u&~s;d!==0?i=jb(d):(l&=u,l!==0&&(i=jb(l)))}else u=t&~s,u!==0?i=jb(u):l!==0&&(i=jb(l));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,l=e&-e,s>=l||s===16&&(l&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-iu(e),s=1<<t,i|=n[t],e&=~s;return i}function gBe(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yBe(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,l=n.pendingLanes;0<l;){var u=31-iu(l),d=1<<u,p=s[u];p===-1?(!(d&t)||d&i)&&(s[u]=gBe(d,e)):p<=e&&(n.expiredLanes|=d),l&=~d}}function wN(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function V7(){var n=jC;return jC<<=1,!(jC&4194240)&&(jC=64),n}function bL(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function U1(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-iu(e),n[e]=t}function ABe(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-iu(t),l=1<<s;e[s]=0,i[s]=-1,n[s]=-1,t&=~l}}function Z3(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-iu(t),s=1<<i;s&e|n[i]&e&&(n[i]|=e),t&=~s}}var nr=0;function U7(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var z7,j3,G7,W7,H7,CN=!1,qC=[],up=null,hp=null,dp=null,Ux=new Map,zx=new Map,Jf=[],vBe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function IX(n,e){switch(n){case"focusin":case"focusout":up=null;break;case"dragenter":case"dragleave":hp=null;break;case"mouseover":case"mouseout":dp=null;break;case"pointerover":case"pointerout":Ux.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zx.delete(e.pointerId)}}function gb(n,e,t,i,s,l){return n===null||n.nativeEvent!==l?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:l,targetContainers:[s]},e!==null&&(e=G1(e),e!==null&&j3(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function bBe(n,e,t,i,s){switch(e){case"focusin":return up=gb(up,n,e,t,i,s),!0;case"dragenter":return hp=gb(hp,n,e,t,i,s),!0;case"mouseover":return dp=gb(dp,n,e,t,i,s),!0;case"pointerover":var l=s.pointerId;return Ux.set(l,gb(Ux.get(l)||null,n,e,t,i,s)),!0;case"gotpointercapture":return l=s.pointerId,zx.set(l,gb(zx.get(l)||null,n,e,t,i,s)),!0}return!1}function X7(n){var e=wg(n.target);if(e!==null){var t=t0(e);if(t!==null){if(e=t.tag,e===13){if(e=B7(t),e!==null){n.blockedOn=e,H7(n.priority,function(){G7(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function G_(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=EN(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);AN=i,t.target.dispatchEvent(i),AN=null}else return e=G1(t),e!==null&&j3(e),n.blockedOn=t,!1;e.shift()}return!0}function SX(n,e,t){G_(n)&&t.delete(e)}function xBe(){CN=!1,up!==null&&G_(up)&&(up=null),hp!==null&&G_(hp)&&(hp=null),dp!==null&&G_(dp)&&(dp=null),Ux.forEach(SX),zx.forEach(SX)}function yb(n,e){n.blockedOn===e&&(n.blockedOn=null,CN||(CN=!0,kl.unstable_scheduleCallback(kl.unstable_NormalPriority,xBe)))}function Gx(n){function e(s){return yb(s,n)}if(0<qC.length){yb(qC[0],n);for(var t=1;t<qC.length;t++){var i=qC[t];i.blockedOn===n&&(i.blockedOn=null)}}for(up!==null&&yb(up,n),hp!==null&&yb(hp,n),dp!==null&&yb(dp,n),Ux.forEach(e),zx.forEach(e),t=0;t<Jf.length;t++)i=Jf[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Jf.length&&(t=Jf[0],t.blockedOn===null);)X7(t),t.blockedOn===null&&Jf.shift()}var uA=$d.ReactCurrentBatchConfig,_I=!0;function wBe(n,e,t,i){var s=nr,l=uA.transition;uA.transition=null;try{nr=1,Y3(n,e,t,i)}finally{nr=s,uA.transition=l}}function CBe(n,e,t,i){var s=nr,l=uA.transition;uA.transition=null;try{nr=4,Y3(n,e,t,i)}finally{nr=s,uA.transition=l}}function Y3(n,e,t,i){if(_I){var s=EN(n,e,t,i);if(s===null)kL(n,e,i,II,t),IX(n,i);else if(bBe(s,n,e,t,i))i.stopPropagation();else if(IX(n,i),e&4&&-1<vBe.indexOf(n)){for(;s!==null;){var l=G1(s);if(l!==null&&z7(l),l=EN(n,e,t,i),l===null&&kL(n,e,i,II,t),l===s)break;s=l}s!==null&&i.stopPropagation()}else kL(n,e,i,null,t)}}var II=null;function EN(n,e,t,i){if(II=null,n=Q3(i),n=wg(n),n!==null)if(e=t0(n),e===null)n=null;else if(t=e.tag,t===13){if(n=B7(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return II=n,null}function $7(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uBe()){case K3:return 1;case F7:return 4;case CI:case hBe:return 16;case O7:return 536870912;default:return 16}default:return 16}}var op=null,q3=null,W_=null;function Q7(){if(W_)return W_;var n,e=q3,t=e.length,i,s="value"in op?op.value:op.textContent,l=s.length;for(n=0;n<t&&e[n]===s[n];n++);var u=t-n;for(i=1;i<=u&&e[t-i]===s[l-i];i++);return W_=s.slice(n,1<i?1-i:void 0)}function H_(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function JC(){return!0}function TX(){return!1}function Pl(n){function e(t,i,s,l,u){this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=l,this.target=u,this.currentTarget=null;for(var d in n)n.hasOwnProperty(d)&&(t=n[d],this[d]=t?t(l):l[d]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?JC:TX,this.isPropagationStopped=TX,this}return Ur(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=JC)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=JC)},persist:function(){},isPersistent:JC}),e}var HA={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},J3=Pl(HA),z1=Ur({},HA,{view:0,detail:0}),EBe=Pl(z1),xL,wL,Ab,ES=Ur({},z1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eF,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ab&&(Ab&&n.type==="mousemove"?(xL=n.screenX-Ab.screenX,wL=n.screenY-Ab.screenY):wL=xL=0,Ab=n),xL)},movementY:function(n){return"movementY"in n?n.movementY:wL}}),MX=Pl(ES),_Be=Ur({},ES,{dataTransfer:0}),IBe=Pl(_Be),SBe=Ur({},z1,{relatedTarget:0}),CL=Pl(SBe),TBe=Ur({},HA,{animationName:0,elapsedTime:0,pseudoElement:0}),MBe=Pl(TBe),kBe=Ur({},HA,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),RBe=Pl(kBe),LBe=Ur({},HA,{data:0}),kX=Pl(LBe),BBe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},PBe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},NBe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DBe(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=NBe[n])?!!e[n]:!1}function eF(){return DBe}var FBe=Ur({},z1,{key:function(n){if(n.key){var e=BBe[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=H_(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?PBe[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eF,charCode:function(n){return n.type==="keypress"?H_(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?H_(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),OBe=Pl(FBe),VBe=Ur({},ES,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),RX=Pl(VBe),UBe=Ur({},z1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eF}),zBe=Pl(UBe),GBe=Ur({},HA,{propertyName:0,elapsedTime:0,pseudoElement:0}),WBe=Pl(GBe),HBe=Ur({},ES,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),XBe=Pl(HBe),$Be=[9,13,27,32],tF=Ld&&"CompositionEvent"in window,cx=null;Ld&&"documentMode"in document&&(cx=document.documentMode);var QBe=Ld&&"TextEvent"in window&&!cx,K7=Ld&&(!tF||cx&&8<cx&&11>=cx),LX=" ",BX=!1;function Z7(n,e){switch(n){case"keyup":return $Be.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function j7(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Vy=!1;function KBe(n,e){switch(n){case"compositionend":return j7(e);case"keypress":return e.which!==32?null:(BX=!0,LX);case"textInput":return n=e.data,n===LX&&BX?null:n;default:return null}}function ZBe(n,e){if(Vy)return n==="compositionend"||!tF&&Z7(n,e)?(n=Q7(),W_=q3=op=null,Vy=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return K7&&e.locale!=="ko"?null:e.data;default:return null}}var jBe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PX(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!jBe[n.type]:e==="textarea"}function Y7(n,e,t,i){T7(i),e=SI(e,"onChange"),0<e.length&&(t=new J3("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var ux=null,Wx=null;function YBe(n){lY(n,0)}function _S(n){var e=Gy(n);if(x7(e))return n}function qBe(n,e){if(n==="change")return e}var q7=!1;if(Ld){var EL;if(Ld){var _L="oninput"in document;if(!_L){var NX=document.createElement("div");NX.setAttribute("oninput","return;"),_L=typeof NX.oninput=="function"}EL=_L}else EL=!1;q7=EL&&(!document.documentMode||9<document.documentMode)}function DX(){ux&&(ux.detachEvent("onpropertychange",J7),Wx=ux=null)}function J7(n){if(n.propertyName==="value"&&_S(Wx)){var e=[];Y7(e,Wx,n,Q3(n)),L7(YBe,e)}}function JBe(n,e,t){n==="focusin"?(DX(),ux=e,Wx=t,ux.attachEvent("onpropertychange",J7)):n==="focusout"&&DX()}function ePe(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return _S(Wx)}function tPe(n,e){if(n==="click")return _S(e)}function nPe(n,e){if(n==="input"||n==="change")return _S(e)}function iPe(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var su=typeof Object.is=="function"?Object.is:iPe;function Hx(n,e){if(su(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var s=t[i];if(!oN.call(e,s)||!su(n[s],e[s]))return!1}return!0}function FX(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function OX(n,e){var t=FX(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=FX(t)}}function eY(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?eY(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function tY(){for(var n=window,e=bI();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=bI(n.document)}return e}function nF(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function rPe(n){var e=tY(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&eY(t.ownerDocument.documentElement,t)){if(i!==null&&nF(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,l=Math.min(i.start,s);i=i.end===void 0?l:Math.min(i.end,s),!n.extend&&l>i&&(s=i,i=l,l=s),s=OX(t,l);var u=OX(t,i);s&&u&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==u.node||n.focusOffset!==u.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),l>i?(n.addRange(e),n.extend(u.node,u.offset)):(e.setEnd(u.node,u.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var sPe=Ld&&"documentMode"in document&&11>=document.documentMode,Uy=null,_N=null,hx=null,IN=!1;function VX(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;IN||Uy==null||Uy!==bI(i)||(i=Uy,"selectionStart"in i&&nF(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),hx&&Hx(hx,i)||(hx=i,i=SI(_N,"onSelect"),0<i.length&&(e=new J3("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Uy)))}function eE(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var zy={animationend:eE("Animation","AnimationEnd"),animationiteration:eE("Animation","AnimationIteration"),animationstart:eE("Animation","AnimationStart"),transitionend:eE("Transition","TransitionEnd")},IL={},nY={};Ld&&(nY=document.createElement("div").style,"AnimationEvent"in window||(delete zy.animationend.animation,delete zy.animationiteration.animation,delete zy.animationstart.animation),"TransitionEvent"in window||delete zy.transitionend.transition);function IS(n){if(IL[n])return IL[n];if(!zy[n])return n;var e=zy[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in nY)return IL[n]=e[t];return n}var iY=IS("animationend"),rY=IS("animationiteration"),sY=IS("animationstart"),oY=IS("transitionend"),aY=new Map,UX="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qp(n,e){aY.set(n,e),e0(e,[n])}for(var SL=0;SL<UX.length;SL++){var TL=UX[SL],oPe=TL.toLowerCase(),aPe=TL[0].toUpperCase()+TL.slice(1);Qp(oPe,"on"+aPe)}Qp(iY,"onAnimationEnd");Qp(rY,"onAnimationIteration");Qp(sY,"onAnimationStart");Qp("dblclick","onDoubleClick");Qp("focusin","onFocus");Qp("focusout","onBlur");Qp(oY,"onTransitionEnd");xA("onMouseEnter",["mouseout","mouseover"]);xA("onMouseLeave",["mouseout","mouseover"]);xA("onPointerEnter",["pointerout","pointerover"]);xA("onPointerLeave",["pointerout","pointerover"]);e0("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));e0("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));e0("onBeforeInput",["compositionend","keypress","textInput","paste"]);e0("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));e0("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));e0("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lPe=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yb));function zX(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,oBe(i,e,void 0,n),n.currentTarget=null}function lY(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],s=i.event;i=i.listeners;e:{var l=void 0;if(e)for(var u=i.length-1;0<=u;u--){var d=i[u],p=d.instance,g=d.currentTarget;if(d=d.listener,p!==l&&s.isPropagationStopped())break e;zX(s,d,g),l=p}else for(u=0;u<i.length;u++){if(d=i[u],p=d.instance,g=d.currentTarget,d=d.listener,p!==l&&s.isPropagationStopped())break e;zX(s,d,g),l=p}}}if(wI)throw n=xN,wI=!1,xN=null,n}function Er(n,e){var t=e[RN];t===void 0&&(t=e[RN]=new Set);var i=n+"__bubble";t.has(i)||(cY(e,n,2,!1),t.add(i))}function ML(n,e,t){var i=0;e&&(i|=4),cY(t,n,i,e)}var tE="_reactListening"+Math.random().toString(36).slice(2);function Xx(n){if(!n[tE]){n[tE]=!0,g7.forEach(function(t){t!=="selectionchange"&&(lPe.has(t)||ML(t,!1,n),ML(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[tE]||(e[tE]=!0,ML("selectionchange",!1,e))}}function cY(n,e,t,i){switch($7(e)){case 1:var s=wBe;break;case 4:s=CBe;break;default:s=Y3}t=s.bind(null,e,t,n),s=void 0,!bN||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function kL(n,e,t,i,s){var l=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var u=i.tag;if(u===3||u===4){var d=i.stateNode.containerInfo;if(d===s||d.nodeType===8&&d.parentNode===s)break;if(u===4)for(u=i.return;u!==null;){var p=u.tag;if((p===3||p===4)&&(p=u.stateNode.containerInfo,p===s||p.nodeType===8&&p.parentNode===s))return;u=u.return}for(;d!==null;){if(u=wg(d),u===null)return;if(p=u.tag,p===5||p===6){i=l=u;continue e}d=d.parentNode}}i=i.return}L7(function(){var g=l,x=Q3(t),b=[];e:{var E=aY.get(n);if(E!==void 0){var S=J3,M=n;switch(n){case"keypress":if(H_(t)===0)break e;case"keydown":case"keyup":S=OBe;break;case"focusin":M="focus",S=CL;break;case"focusout":M="blur",S=CL;break;case"beforeblur":case"afterblur":S=CL;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":S=MX;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":S=IBe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":S=zBe;break;case iY:case rY:case sY:S=MBe;break;case oY:S=WBe;break;case"scroll":S=EBe;break;case"wheel":S=XBe;break;case"copy":case"cut":case"paste":S=RBe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":S=RX}var R=(e&4)!==0,P=!R&&n==="scroll",k=R?E!==null?E+"Capture":null:E;R=[];for(var F=g,V;F!==null;){V=F;var G=V.stateNode;if(V.tag===5&&G!==null&&(V=G,k!==null&&(G=Vx(F,k),G!=null&&R.push($x(F,G,V)))),P)break;F=F.return}0<R.length&&(E=new S(E,M,null,t,x),b.push({event:E,listeners:R}))}}if(!(e&7)){e:{if(E=n==="mouseover"||n==="pointerover",S=n==="mouseout"||n==="pointerout",E&&t!==AN&&(M=t.relatedTarget||t.fromElement)&&(wg(M)||M[Bd]))break e;if((S||E)&&(E=x.window===x?x:(E=x.ownerDocument)?E.defaultView||E.parentWindow:window,S?(M=t.relatedTarget||t.toElement,S=g,M=M?wg(M):null,M!==null&&(P=t0(M),M!==P||M.tag!==5&&M.tag!==6)&&(M=null)):(S=null,M=g),S!==M)){if(R=MX,G="onMouseLeave",k="onMouseEnter",F="mouse",(n==="pointerout"||n==="pointerover")&&(R=RX,G="onPointerLeave",k="onPointerEnter",F="pointer"),P=S==null?E:Gy(S),V=M==null?E:Gy(M),E=new R(G,F+"leave",S,t,x),E.target=P,E.relatedTarget=V,G=null,wg(x)===g&&(R=new R(k,F+"enter",M,t,x),R.target=V,R.relatedTarget=P,G=R),P=G,S&&M)t:{for(R=S,k=M,F=0,V=R;V;V=sy(V))F++;for(V=0,G=k;G;G=sy(G))V++;for(;0<F-V;)R=sy(R),F--;for(;0<V-F;)k=sy(k),V--;for(;F--;){if(R===k||k!==null&&R===k.alternate)break t;R=sy(R),k=sy(k)}R=null}else R=null;S!==null&&GX(b,E,S,R,!1),M!==null&&P!==null&&GX(b,P,M,R,!0)}}e:{if(E=g?Gy(g):window,S=E.nodeName&&E.nodeName.toLowerCase(),S==="select"||S==="input"&&E.type==="file")var q=qBe;else if(PX(E))if(q7)q=nPe;else{q=ePe;var ne=JBe}else(S=E.nodeName)&&S.toLowerCase()==="input"&&(E.type==="checkbox"||E.type==="radio")&&(q=tPe);if(q&&(q=q(n,g))){Y7(b,q,t,x);break e}ne&&ne(n,E,g),n==="focusout"&&(ne=E._wrapperState)&&ne.controlled&&E.type==="number"&&fN(E,"number",E.value)}switch(ne=g?Gy(g):window,n){case"focusin":(PX(ne)||ne.contentEditable==="true")&&(Uy=ne,_N=g,hx=null);break;case"focusout":hx=_N=Uy=null;break;case"mousedown":IN=!0;break;case"contextmenu":case"mouseup":case"dragend":IN=!1,VX(b,t,x);break;case"selectionchange":if(sPe)break;case"keydown":case"keyup":VX(b,t,x)}var K;if(tF)e:{switch(n){case"compositionstart":var Q="onCompositionStart";break e;case"compositionend":Q="onCompositionEnd";break e;case"compositionupdate":Q="onCompositionUpdate";break e}Q=void 0}else Vy?Z7(n,t)&&(Q="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(Q="onCompositionStart");Q&&(K7&&t.locale!=="ko"&&(Vy||Q!=="onCompositionStart"?Q==="onCompositionEnd"&&Vy&&(K=Q7()):(op=x,q3="value"in op?op.value:op.textContent,Vy=!0)),ne=SI(g,Q),0<ne.length&&(Q=new kX(Q,n,null,t,x),b.push({event:Q,listeners:ne}),K?Q.data=K:(K=j7(t),K!==null&&(Q.data=K)))),(K=QBe?KBe(n,t):ZBe(n,t))&&(g=SI(g,"onBeforeInput"),0<g.length&&(x=new kX("onBeforeInput","beforeinput",null,t,x),b.push({event:x,listeners:g}),x.data=K))}lY(b,e)})}function $x(n,e,t){return{instance:n,listener:e,currentTarget:t}}function SI(n,e){for(var t=e+"Capture",i=[];n!==null;){var s=n,l=s.stateNode;s.tag===5&&l!==null&&(s=l,l=Vx(n,t),l!=null&&i.unshift($x(n,l,s)),l=Vx(n,e),l!=null&&i.push($x(n,l,s))),n=n.return}return i}function sy(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function GX(n,e,t,i,s){for(var l=e._reactName,u=[];t!==null&&t!==i;){var d=t,p=d.alternate,g=d.stateNode;if(p!==null&&p===i)break;d.tag===5&&g!==null&&(d=g,s?(p=Vx(t,l),p!=null&&u.unshift($x(t,p,d))):s||(p=Vx(t,l),p!=null&&u.push($x(t,p,d)))),t=t.return}u.length!==0&&n.push({event:e,listeners:u})}var cPe=/\r\n?/g,uPe=/\u0000|\uFFFD/g;function WX(n){return(typeof n=="string"?n:""+n).replace(cPe,`
`).replace(uPe,"")}function nE(n,e,t){if(e=WX(e),WX(n)!==e&&t)throw Error(Ut(425))}function TI(){}var SN=null,TN=null;function MN(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kN=typeof setTimeout=="function"?setTimeout:void 0,hPe=typeof clearTimeout=="function"?clearTimeout:void 0,HX=typeof Promise=="function"?Promise:void 0,dPe=typeof queueMicrotask=="function"?queueMicrotask:typeof HX<"u"?function(n){return HX.resolve(null).then(n).catch(fPe)}:kN;function fPe(n){setTimeout(function(){throw n})}function RL(n,e){var t=e,i=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(i===0){n.removeChild(s),Gx(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=s}while(t);Gx(e)}function fp(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function XX(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var XA=Math.random().toString(36).slice(2),th="__reactFiber$"+XA,Qx="__reactProps$"+XA,Bd="__reactContainer$"+XA,RN="__reactEvents$"+XA,pPe="__reactListeners$"+XA,mPe="__reactHandles$"+XA;function wg(n){var e=n[th];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Bd]||t[th]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=XX(n);n!==null;){if(t=n[th])return t;n=XX(n)}return e}n=t,t=n.parentNode}return null}function G1(n){return n=n[th]||n[Bd],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Gy(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ut(33))}function SS(n){return n[Qx]||null}var LN=[],Wy=-1;function Kp(n){return{current:n}}function Sr(n){0>Wy||(n.current=LN[Wy],LN[Wy]=null,Wy--)}function vr(n,e){Wy++,LN[Wy]=n.current,n.current=e}var Lp={},qo=Kp(Lp),el=Kp(!1),Ug=Lp;function wA(n,e){var t=n.type.contextTypes;if(!t)return Lp;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},l;for(l in t)s[l]=e[l];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function tl(n){return n=n.childContextTypes,n!=null}function MI(){Sr(el),Sr(qo)}function $X(n,e,t){if(qo.current!==Lp)throw Error(Ut(168));vr(qo,e),vr(el,t)}function uY(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(Ut(108,JLe(n)||"Unknown",s));return Ur({},t,i)}function kI(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Lp,Ug=qo.current,vr(qo,n),vr(el,el.current),!0}function QX(n,e,t){var i=n.stateNode;if(!i)throw Error(Ut(169));t?(n=uY(n,e,Ug),i.__reactInternalMemoizedMergedChildContext=n,Sr(el),Sr(qo),vr(qo,n)):Sr(el),vr(el,t)}var hd=null,TS=!1,LL=!1;function hY(n){hd===null?hd=[n]:hd.push(n)}function gPe(n){TS=!0,hY(n)}function Zp(){if(!LL&&hd!==null){LL=!0;var n=0,e=nr;try{var t=hd;for(nr=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}hd=null,TS=!1}catch(s){throw hd!==null&&(hd=hd.slice(n+1)),D7(K3,Zp),s}finally{nr=e,LL=!1}}return null}var Hy=[],Xy=0,RI=null,LI=0,sc=[],oc=0,zg=null,pd=1,md="";function hg(n,e){Hy[Xy++]=LI,Hy[Xy++]=RI,RI=n,LI=e}function dY(n,e,t){sc[oc++]=pd,sc[oc++]=md,sc[oc++]=zg,zg=n;var i=pd;n=md;var s=32-iu(i)-1;i&=~(1<<s),t+=1;var l=32-iu(e)+s;if(30<l){var u=s-s%5;l=(i&(1<<u)-1).toString(32),i>>=u,s-=u,pd=1<<32-iu(e)+s|t<<s|i,md=l+n}else pd=1<<l|t<<s|i,md=n}function iF(n){n.return!==null&&(hg(n,1),dY(n,1,0))}function rF(n){for(;n===RI;)RI=Hy[--Xy],Hy[Xy]=null,LI=Hy[--Xy],Hy[Xy]=null;for(;n===zg;)zg=sc[--oc],sc[oc]=null,md=sc[--oc],sc[oc]=null,pd=sc[--oc],sc[oc]=null}var Tl=null,Sl=null,Lr=!1,jc=null;function fY(n,e){var t=uc(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function KX(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Tl=n,Sl=fp(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Tl=n,Sl=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=zg!==null?{id:pd,overflow:md}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=uc(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Tl=n,Sl=null,!0):!1;default:return!1}}function BN(n){return(n.mode&1)!==0&&(n.flags&128)===0}function PN(n){if(Lr){var e=Sl;if(e){var t=e;if(!KX(n,e)){if(BN(n))throw Error(Ut(418));e=fp(t.nextSibling);var i=Tl;e&&KX(n,e)?fY(i,t):(n.flags=n.flags&-4097|2,Lr=!1,Tl=n)}}else{if(BN(n))throw Error(Ut(418));n.flags=n.flags&-4097|2,Lr=!1,Tl=n}}}function ZX(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Tl=n}function iE(n){if(n!==Tl)return!1;if(!Lr)return ZX(n),Lr=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!MN(n.type,n.memoizedProps)),e&&(e=Sl)){if(BN(n))throw pY(),Error(Ut(418));for(;e;)fY(n,e),e=fp(e.nextSibling)}if(ZX(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ut(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Sl=fp(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Sl=null}}else Sl=Tl?fp(n.stateNode.nextSibling):null;return!0}function pY(){for(var n=Sl;n;)n=fp(n.nextSibling)}function CA(){Sl=Tl=null,Lr=!1}function sF(n){jc===null?jc=[n]:jc.push(n)}var yPe=$d.ReactCurrentBatchConfig;function vb(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ut(309));var i=t.stateNode}if(!i)throw Error(Ut(147,n));var s=i,l=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(u){var d=s.refs;u===null?delete d[l]:d[l]=u},e._stringRef=l,e)}if(typeof n!="string")throw Error(Ut(284));if(!t._owner)throw Error(Ut(290,n))}return n}function rE(n,e){throw n=Object.prototype.toString.call(e),Error(Ut(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function jX(n){var e=n._init;return e(n._payload)}function mY(n){function e(k,F){if(n){var V=k.deletions;V===null?(k.deletions=[F],k.flags|=16):V.push(F)}}function t(k,F){if(!n)return null;for(;F!==null;)e(k,F),F=F.sibling;return null}function i(k,F){for(k=new Map;F!==null;)F.key!==null?k.set(F.key,F):k.set(F.index,F),F=F.sibling;return k}function s(k,F){return k=yp(k,F),k.index=0,k.sibling=null,k}function l(k,F,V){return k.index=V,n?(V=k.alternate,V!==null?(V=V.index,V<F?(k.flags|=2,F):V):(k.flags|=2,F)):(k.flags|=1048576,F)}function u(k){return n&&k.alternate===null&&(k.flags|=2),k}function d(k,F,V,G){return F===null||F.tag!==6?(F=VL(V,k.mode,G),F.return=k,F):(F=s(F,V),F.return=k,F)}function p(k,F,V,G){var q=V.type;return q===Oy?x(k,F,V.props.children,G,V.key):F!==null&&(F.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===Qf&&jX(q)===F.type)?(G=s(F,V.props),G.ref=vb(k,F,V),G.return=k,G):(G=Y_(V.type,V.key,V.props,null,k.mode,G),G.ref=vb(k,F,V),G.return=k,G)}function g(k,F,V,G){return F===null||F.tag!==4||F.stateNode.containerInfo!==V.containerInfo||F.stateNode.implementation!==V.implementation?(F=UL(V,k.mode,G),F.return=k,F):(F=s(F,V.children||[]),F.return=k,F)}function x(k,F,V,G,q){return F===null||F.tag!==7?(F=Lg(V,k.mode,G,q),F.return=k,F):(F=s(F,V),F.return=k,F)}function b(k,F,V){if(typeof F=="string"&&F!==""||typeof F=="number")return F=VL(""+F,k.mode,V),F.return=k,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case QC:return V=Y_(F.type,F.key,F.props,null,k.mode,V),V.ref=vb(k,null,F),V.return=k,V;case Fy:return F=UL(F,k.mode,V),F.return=k,F;case Qf:var G=F._init;return b(k,G(F._payload),V)}if(Zb(F)||pb(F))return F=Lg(F,k.mode,V,null),F.return=k,F;rE(k,F)}return null}function E(k,F,V,G){var q=F!==null?F.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return q!==null?null:d(k,F,""+V,G);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case QC:return V.key===q?p(k,F,V,G):null;case Fy:return V.key===q?g(k,F,V,G):null;case Qf:return q=V._init,E(k,F,q(V._payload),G)}if(Zb(V)||pb(V))return q!==null?null:x(k,F,V,G,null);rE(k,V)}return null}function S(k,F,V,G,q){if(typeof G=="string"&&G!==""||typeof G=="number")return k=k.get(V)||null,d(F,k,""+G,q);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case QC:return k=k.get(G.key===null?V:G.key)||null,p(F,k,G,q);case Fy:return k=k.get(G.key===null?V:G.key)||null,g(F,k,G,q);case Qf:var ne=G._init;return S(k,F,V,ne(G._payload),q)}if(Zb(G)||pb(G))return k=k.get(V)||null,x(F,k,G,q,null);rE(F,G)}return null}function M(k,F,V,G){for(var q=null,ne=null,K=F,Q=F=0,H=null;K!==null&&Q<V.length;Q++){K.index>Q?(H=K,K=null):H=K.sibling;var j=E(k,K,V[Q],G);if(j===null){K===null&&(K=H);break}n&&K&&j.alternate===null&&e(k,K),F=l(j,F,Q),ne===null?q=j:ne.sibling=j,ne=j,K=H}if(Q===V.length)return t(k,K),Lr&&hg(k,Q),q;if(K===null){for(;Q<V.length;Q++)K=b(k,V[Q],G),K!==null&&(F=l(K,F,Q),ne===null?q=K:ne.sibling=K,ne=K);return Lr&&hg(k,Q),q}for(K=i(k,K);Q<V.length;Q++)H=S(K,k,Q,V[Q],G),H!==null&&(n&&H.alternate!==null&&K.delete(H.key===null?Q:H.key),F=l(H,F,Q),ne===null?q=H:ne.sibling=H,ne=H);return n&&K.forEach(function(ee){return e(k,ee)}),Lr&&hg(k,Q),q}function R(k,F,V,G){var q=pb(V);if(typeof q!="function")throw Error(Ut(150));if(V=q.call(V),V==null)throw Error(Ut(151));for(var ne=q=null,K=F,Q=F=0,H=null,j=V.next();K!==null&&!j.done;Q++,j=V.next()){K.index>Q?(H=K,K=null):H=K.sibling;var ee=E(k,K,j.value,G);if(ee===null){K===null&&(K=H);break}n&&K&&ee.alternate===null&&e(k,K),F=l(ee,F,Q),ne===null?q=ee:ne.sibling=ee,ne=ee,K=H}if(j.done)return t(k,K),Lr&&hg(k,Q),q;if(K===null){for(;!j.done;Q++,j=V.next())j=b(k,j.value,G),j!==null&&(F=l(j,F,Q),ne===null?q=j:ne.sibling=j,ne=j);return Lr&&hg(k,Q),q}for(K=i(k,K);!j.done;Q++,j=V.next())j=S(K,k,Q,j.value,G),j!==null&&(n&&j.alternate!==null&&K.delete(j.key===null?Q:j.key),F=l(j,F,Q),ne===null?q=j:ne.sibling=j,ne=j);return n&&K.forEach(function(de){return e(k,de)}),Lr&&hg(k,Q),q}function P(k,F,V,G){if(typeof V=="object"&&V!==null&&V.type===Oy&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case QC:e:{for(var q=V.key,ne=F;ne!==null;){if(ne.key===q){if(q=V.type,q===Oy){if(ne.tag===7){t(k,ne.sibling),F=s(ne,V.props.children),F.return=k,k=F;break e}}else if(ne.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===Qf&&jX(q)===ne.type){t(k,ne.sibling),F=s(ne,V.props),F.ref=vb(k,ne,V),F.return=k,k=F;break e}t(k,ne);break}else e(k,ne);ne=ne.sibling}V.type===Oy?(F=Lg(V.props.children,k.mode,G,V.key),F.return=k,k=F):(G=Y_(V.type,V.key,V.props,null,k.mode,G),G.ref=vb(k,F,V),G.return=k,k=G)}return u(k);case Fy:e:{for(ne=V.key;F!==null;){if(F.key===ne)if(F.tag===4&&F.stateNode.containerInfo===V.containerInfo&&F.stateNode.implementation===V.implementation){t(k,F.sibling),F=s(F,V.children||[]),F.return=k,k=F;break e}else{t(k,F);break}else e(k,F);F=F.sibling}F=UL(V,k.mode,G),F.return=k,k=F}return u(k);case Qf:return ne=V._init,P(k,F,ne(V._payload),G)}if(Zb(V))return M(k,F,V,G);if(pb(V))return R(k,F,V,G);rE(k,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,F!==null&&F.tag===6?(t(k,F.sibling),F=s(F,V),F.return=k,k=F):(t(k,F),F=VL(V,k.mode,G),F.return=k,k=F),u(k)):t(k,F)}return P}var EA=mY(!0),gY=mY(!1),BI=Kp(null),PI=null,$y=null,oF=null;function aF(){oF=$y=PI=null}function lF(n){var e=BI.current;Sr(BI),n._currentValue=e}function NN(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function hA(n,e){PI=n,oF=$y=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(qa=!0),n.firstContext=null)}function pc(n){var e=n._currentValue;if(oF!==n)if(n={context:n,memoizedValue:e,next:null},$y===null){if(PI===null)throw Error(Ut(308));$y=n,PI.dependencies={lanes:0,firstContext:n}}else $y=$y.next=n;return e}var Cg=null;function cF(n){Cg===null?Cg=[n]:Cg.push(n)}function yY(n,e,t,i){var s=e.interleaved;return s===null?(t.next=t,cF(e)):(t.next=s.next,s.next=t),e.interleaved=t,Pd(n,i)}function Pd(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Kf=!1;function uF(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function AY(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Cd(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function pp(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,Hi&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,Pd(n,t)}return s=i.interleaved,s===null?(e.next=e,cF(i)):(e.next=s.next,s.next=e),i.interleaved=e,Pd(n,t)}function X_(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Z3(n,t)}}function YX(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var s=null,l=null;if(t=t.firstBaseUpdate,t!==null){do{var u={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};l===null?s=l=u:l=l.next=u,t=t.next}while(t!==null);l===null?s=l=e:l=l.next=e}else s=l=e;t={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:l,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function NI(n,e,t,i){var s=n.updateQueue;Kf=!1;var l=s.firstBaseUpdate,u=s.lastBaseUpdate,d=s.shared.pending;if(d!==null){s.shared.pending=null;var p=d,g=p.next;p.next=null,u===null?l=g:u.next=g,u=p;var x=n.alternate;x!==null&&(x=x.updateQueue,d=x.lastBaseUpdate,d!==u&&(d===null?x.firstBaseUpdate=g:d.next=g,x.lastBaseUpdate=p))}if(l!==null){var b=s.baseState;u=0,x=g=p=null,d=l;do{var E=d.lane,S=d.eventTime;if((i&E)===E){x!==null&&(x=x.next={eventTime:S,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var M=n,R=d;switch(E=e,S=t,R.tag){case 1:if(M=R.payload,typeof M=="function"){b=M.call(S,b,E);break e}b=M;break e;case 3:M.flags=M.flags&-65537|128;case 0:if(M=R.payload,E=typeof M=="function"?M.call(S,b,E):M,E==null)break e;b=Ur({},b,E);break e;case 2:Kf=!0}}d.callback!==null&&d.lane!==0&&(n.flags|=64,E=s.effects,E===null?s.effects=[d]:E.push(d))}else S={eventTime:S,lane:E,tag:d.tag,payload:d.payload,callback:d.callback,next:null},x===null?(g=x=S,p=b):x=x.next=S,u|=E;if(d=d.next,d===null){if(d=s.shared.pending,d===null)break;E=d,d=E.next,E.next=null,s.lastBaseUpdate=E,s.shared.pending=null}}while(!0);if(x===null&&(p=b),s.baseState=p,s.firstBaseUpdate=g,s.lastBaseUpdate=x,e=s.shared.interleaved,e!==null){s=e;do u|=s.lane,s=s.next;while(s!==e)}else l===null&&(s.shared.lanes=0);Wg|=u,n.lanes=u,n.memoizedState=b}}function qX(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],s=i.callback;if(s!==null){if(i.callback=null,i=t,typeof s!="function")throw Error(Ut(191,s));s.call(i)}}}var W1={},oh=Kp(W1),Kx=Kp(W1),Zx=Kp(W1);function Eg(n){if(n===W1)throw Error(Ut(174));return n}function hF(n,e){switch(vr(Zx,e),vr(Kx,n),vr(oh,W1),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:mN(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=mN(e,n)}Sr(oh),vr(oh,e)}function _A(){Sr(oh),Sr(Kx),Sr(Zx)}function vY(n){Eg(Zx.current);var e=Eg(oh.current),t=mN(e,n.type);e!==t&&(vr(Kx,n),vr(oh,t))}function dF(n){Kx.current===n&&(Sr(oh),Sr(Kx))}var Nr=Kp(0);function DI(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var BL=[];function fF(){for(var n=0;n<BL.length;n++)BL[n]._workInProgressVersionPrimary=null;BL.length=0}var $_=$d.ReactCurrentDispatcher,PL=$d.ReactCurrentBatchConfig,Gg=0,Or=null,Vs=null,no=null,FI=!1,dx=!1,jx=0,APe=0;function Uo(){throw Error(Ut(321))}function pF(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!su(n[t],e[t]))return!1;return!0}function mF(n,e,t,i,s,l){if(Gg=l,Or=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$_.current=n===null||n.memoizedState===null?wPe:CPe,n=t(i,s),dx){l=0;do{if(dx=!1,jx=0,25<=l)throw Error(Ut(301));l+=1,no=Vs=null,e.updateQueue=null,$_.current=EPe,n=t(i,s)}while(dx)}if($_.current=OI,e=Vs!==null&&Vs.next!==null,Gg=0,no=Vs=Or=null,FI=!1,e)throw Error(Ut(300));return n}function gF(){var n=jx!==0;return jx=0,n}function ju(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return no===null?Or.memoizedState=no=n:no=no.next=n,no}function mc(){if(Vs===null){var n=Or.alternate;n=n!==null?n.memoizedState:null}else n=Vs.next;var e=no===null?Or.memoizedState:no.next;if(e!==null)no=e,Vs=n;else{if(n===null)throw Error(Ut(310));Vs=n,n={memoizedState:Vs.memoizedState,baseState:Vs.baseState,baseQueue:Vs.baseQueue,queue:Vs.queue,next:null},no===null?Or.memoizedState=no=n:no=no.next=n}return no}function Yx(n,e){return typeof e=="function"?e(n):e}function NL(n){var e=mc(),t=e.queue;if(t===null)throw Error(Ut(311));t.lastRenderedReducer=n;var i=Vs,s=i.baseQueue,l=t.pending;if(l!==null){if(s!==null){var u=s.next;s.next=l.next,l.next=u}i.baseQueue=s=l,t.pending=null}if(s!==null){l=s.next,i=i.baseState;var d=u=null,p=null,g=l;do{var x=g.lane;if((Gg&x)===x)p!==null&&(p=p.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),i=g.hasEagerState?g.eagerState:n(i,g.action);else{var b={lane:x,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};p===null?(d=p=b,u=i):p=p.next=b,Or.lanes|=x,Wg|=x}g=g.next}while(g!==null&&g!==l);p===null?u=i:p.next=d,su(i,e.memoizedState)||(qa=!0),e.memoizedState=i,e.baseState=u,e.baseQueue=p,t.lastRenderedState=i}if(n=t.interleaved,n!==null){s=n;do l=s.lane,Or.lanes|=l,Wg|=l,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function DL(n){var e=mc(),t=e.queue;if(t===null)throw Error(Ut(311));t.lastRenderedReducer=n;var i=t.dispatch,s=t.pending,l=e.memoizedState;if(s!==null){t.pending=null;var u=s=s.next;do l=n(l,u.action),u=u.next;while(u!==s);su(l,e.memoizedState)||(qa=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),t.lastRenderedState=l}return[l,i]}function bY(){}function xY(n,e){var t=Or,i=mc(),s=e(),l=!su(i.memoizedState,s);if(l&&(i.memoizedState=s,qa=!0),i=i.queue,yF(EY.bind(null,t,i,n),[n]),i.getSnapshot!==e||l||no!==null&&no.memoizedState.tag&1){if(t.flags|=2048,qx(9,CY.bind(null,t,i,s,e),void 0,null),io===null)throw Error(Ut(349));Gg&30||wY(t,e,s)}return s}function wY(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Or.updateQueue,e===null?(e={lastEffect:null,stores:null},Or.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function CY(n,e,t,i){e.value=t,e.getSnapshot=i,_Y(e)&&IY(n)}function EY(n,e,t){return t(function(){_Y(e)&&IY(n)})}function _Y(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!su(n,t)}catch{return!0}}function IY(n){var e=Pd(n,1);e!==null&&ru(e,n,1,-1)}function JX(n){var e=ju();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yx,lastRenderedState:n},e.queue=n,n=n.dispatch=xPe.bind(null,Or,n),[e.memoizedState,n]}function qx(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Or.updateQueue,e===null?(e={lastEffect:null,stores:null},Or.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function SY(){return mc().memoizedState}function Q_(n,e,t,i){var s=ju();Or.flags|=n,s.memoizedState=qx(1|e,t,void 0,i===void 0?null:i)}function MS(n,e,t,i){var s=mc();i=i===void 0?null:i;var l=void 0;if(Vs!==null){var u=Vs.memoizedState;if(l=u.destroy,i!==null&&pF(i,u.deps)){s.memoizedState=qx(e,t,l,i);return}}Or.flags|=n,s.memoizedState=qx(1|e,t,l,i)}function e$(n,e){return Q_(8390656,8,n,e)}function yF(n,e){return MS(2048,8,n,e)}function TY(n,e){return MS(4,2,n,e)}function MY(n,e){return MS(4,4,n,e)}function kY(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function RY(n,e,t){return t=t!=null?t.concat([n]):null,MS(4,4,kY.bind(null,e,n),t)}function AF(){}function LY(n,e){var t=mc();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&pF(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function BY(n,e){var t=mc();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&pF(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function PY(n,e,t){return Gg&21?(su(t,e)||(t=V7(),Or.lanes|=t,Wg|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,qa=!0),n.memoizedState=t)}function vPe(n,e){var t=nr;nr=t!==0&&4>t?t:4,n(!0);var i=PL.transition;PL.transition={};try{n(!1),e()}finally{nr=t,PL.transition=i}}function NY(){return mc().memoizedState}function bPe(n,e,t){var i=gp(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},DY(n))FY(e,t);else if(t=yY(n,e,t,i),t!==null){var s=Sa();ru(t,n,i,s),OY(t,e,i)}}function xPe(n,e,t){var i=gp(n),s={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(DY(n))FY(e,s);else{var l=n.alternate;if(n.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var u=e.lastRenderedState,d=l(u,t);if(s.hasEagerState=!0,s.eagerState=d,su(d,u)){var p=e.interleaved;p===null?(s.next=s,cF(e)):(s.next=p.next,p.next=s),e.interleaved=s;return}}catch{}finally{}t=yY(n,e,s,i),t!==null&&(s=Sa(),ru(t,n,i,s),OY(t,e,i))}}function DY(n){var e=n.alternate;return n===Or||e!==null&&e===Or}function FY(n,e){dx=FI=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function OY(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Z3(n,t)}}var OI={readContext:pc,useCallback:Uo,useContext:Uo,useEffect:Uo,useImperativeHandle:Uo,useInsertionEffect:Uo,useLayoutEffect:Uo,useMemo:Uo,useReducer:Uo,useRef:Uo,useState:Uo,useDebugValue:Uo,useDeferredValue:Uo,useTransition:Uo,useMutableSource:Uo,useSyncExternalStore:Uo,useId:Uo,unstable_isNewReconciler:!1},wPe={readContext:pc,useCallback:function(n,e){return ju().memoizedState=[n,e===void 0?null:e],n},useContext:pc,useEffect:e$,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Q_(4194308,4,kY.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Q_(4194308,4,n,e)},useInsertionEffect:function(n,e){return Q_(4,2,n,e)},useMemo:function(n,e){var t=ju();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ju();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=bPe.bind(null,Or,n),[i.memoizedState,n]},useRef:function(n){var e=ju();return n={current:n},e.memoizedState=n},useState:JX,useDebugValue:AF,useDeferredValue:function(n){return ju().memoizedState=n},useTransition:function(){var n=JX(!1),e=n[0];return n=vPe.bind(null,n[1]),ju().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Or,s=ju();if(Lr){if(t===void 0)throw Error(Ut(407));t=t()}else{if(t=e(),io===null)throw Error(Ut(349));Gg&30||wY(i,e,t)}s.memoizedState=t;var l={value:t,getSnapshot:e};return s.queue=l,e$(EY.bind(null,i,l,n),[n]),i.flags|=2048,qx(9,CY.bind(null,i,l,t,e),void 0,null),t},useId:function(){var n=ju(),e=io.identifierPrefix;if(Lr){var t=md,i=pd;t=(i&~(1<<32-iu(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=jx++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=APe++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},CPe={readContext:pc,useCallback:LY,useContext:pc,useEffect:yF,useImperativeHandle:RY,useInsertionEffect:TY,useLayoutEffect:MY,useMemo:BY,useReducer:NL,useRef:SY,useState:function(){return NL(Yx)},useDebugValue:AF,useDeferredValue:function(n){var e=mc();return PY(e,Vs.memoizedState,n)},useTransition:function(){var n=NL(Yx)[0],e=mc().memoizedState;return[n,e]},useMutableSource:bY,useSyncExternalStore:xY,useId:NY,unstable_isNewReconciler:!1},EPe={readContext:pc,useCallback:LY,useContext:pc,useEffect:yF,useImperativeHandle:RY,useInsertionEffect:TY,useLayoutEffect:MY,useMemo:BY,useReducer:DL,useRef:SY,useState:function(){return DL(Yx)},useDebugValue:AF,useDeferredValue:function(n){var e=mc();return Vs===null?e.memoizedState=n:PY(e,Vs.memoizedState,n)},useTransition:function(){var n=DL(Yx)[0],e=mc().memoizedState;return[n,e]},useMutableSource:bY,useSyncExternalStore:xY,useId:NY,unstable_isNewReconciler:!1};function Kc(n,e){if(n&&n.defaultProps){e=Ur({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function DN(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Ur({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var kS={isMounted:function(n){return(n=n._reactInternals)?t0(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Sa(),s=gp(n),l=Cd(i,s);l.payload=e,t!=null&&(l.callback=t),e=pp(n,l,s),e!==null&&(ru(e,n,s,i),X_(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Sa(),s=gp(n),l=Cd(i,s);l.tag=1,l.payload=e,t!=null&&(l.callback=t),e=pp(n,l,s),e!==null&&(ru(e,n,s,i),X_(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Sa(),i=gp(n),s=Cd(t,i);s.tag=2,e!=null&&(s.callback=e),e=pp(n,s,i),e!==null&&(ru(e,n,i,t),X_(e,n,i))}};function t$(n,e,t,i,s,l,u){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,l,u):e.prototype&&e.prototype.isPureReactComponent?!Hx(t,i)||!Hx(s,l):!0}function VY(n,e,t){var i=!1,s=Lp,l=e.contextType;return typeof l=="object"&&l!==null?l=pc(l):(s=tl(e)?Ug:qo.current,i=e.contextTypes,l=(i=i!=null)?wA(n,s):Lp),e=new e(t,l),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=kS,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=l),e}function n$(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&kS.enqueueReplaceState(e,e.state,null)}function FN(n,e,t,i){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},uF(n);var l=e.contextType;typeof l=="object"&&l!==null?s.context=pc(l):(l=tl(e)?Ug:qo.current,s.context=wA(n,l)),s.state=n.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(DN(n,e,l,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&kS.enqueueReplaceState(s,s.state,null),NI(n,t,s,i),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function IA(n,e){try{var t="",i=e;do t+=qLe(i),i=i.return;while(i);var s=t}catch(l){s=`
Error generating stack: `+l.message+`
`+l.stack}return{value:n,source:e,stack:s,digest:null}}function FL(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function ON(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var _Pe=typeof WeakMap=="function"?WeakMap:Map;function UY(n,e,t){t=Cd(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){UI||(UI=!0,KN=i),ON(n,e)},t}function zY(n,e,t){t=Cd(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;t.payload=function(){return i(s)},t.callback=function(){ON(n,e)}}var l=n.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(t.callback=function(){ON(n,e),typeof i!="function"&&(mp===null?mp=new Set([this]):mp.add(this));var u=e.stack;this.componentDidCatch(e.value,{componentStack:u!==null?u:""})}),t}function i$(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new _Pe;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(t)||(s.add(t),n=VPe.bind(null,n,e,t),e.then(n,n))}function r$(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function s$(n,e,t,i,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Cd(-1,1),e.tag=2,pp(t,e,1))),t.lanes|=1),n)}var IPe=$d.ReactCurrentOwner,qa=!1;function xa(n,e,t,i){e.child=n===null?gY(e,null,t,i):EA(e,n.child,t,i)}function o$(n,e,t,i,s){t=t.render;var l=e.ref;return hA(e,s),i=mF(n,e,t,i,l,s),t=gF(),n!==null&&!qa?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Nd(n,e,s)):(Lr&&t&&iF(e),e.flags|=1,xa(n,e,i,s),e.child)}function a$(n,e,t,i,s){if(n===null){var l=t.type;return typeof l=="function"&&!IF(l)&&l.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=l,GY(n,e,l,i,s)):(n=Y_(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(l=n.child,!(n.lanes&s)){var u=l.memoizedProps;if(t=t.compare,t=t!==null?t:Hx,t(u,i)&&n.ref===e.ref)return Nd(n,e,s)}return e.flags|=1,n=yp(l,i),n.ref=e.ref,n.return=e,e.child=n}function GY(n,e,t,i,s){if(n!==null){var l=n.memoizedProps;if(Hx(l,i)&&n.ref===e.ref)if(qa=!1,e.pendingProps=i=l,(n.lanes&s)!==0)n.flags&131072&&(qa=!0);else return e.lanes=n.lanes,Nd(n,e,s)}return VN(n,e,t,i,s)}function WY(n,e,t){var i=e.pendingProps,s=i.children,l=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},vr(Ky,El),El|=t;else{if(!(t&1073741824))return n=l!==null?l.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,vr(Ky,El),El|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=l!==null?l.baseLanes:t,vr(Ky,El),El|=i}else l!==null?(i=l.baseLanes|t,e.memoizedState=null):i=t,vr(Ky,El),El|=i;return xa(n,e,s,t),e.child}function HY(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function VN(n,e,t,i,s){var l=tl(t)?Ug:qo.current;return l=wA(e,l),hA(e,s),t=mF(n,e,t,i,l,s),i=gF(),n!==null&&!qa?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Nd(n,e,s)):(Lr&&i&&iF(e),e.flags|=1,xa(n,e,t,s),e.child)}function l$(n,e,t,i,s){if(tl(t)){var l=!0;kI(e)}else l=!1;if(hA(e,s),e.stateNode===null)K_(n,e),VY(e,t,i),FN(e,t,i,s),i=!0;else if(n===null){var u=e.stateNode,d=e.memoizedProps;u.props=d;var p=u.context,g=t.contextType;typeof g=="object"&&g!==null?g=pc(g):(g=tl(t)?Ug:qo.current,g=wA(e,g));var x=t.getDerivedStateFromProps,b=typeof x=="function"||typeof u.getSnapshotBeforeUpdate=="function";b||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(d!==i||p!==g)&&n$(e,u,i,g),Kf=!1;var E=e.memoizedState;u.state=E,NI(e,i,u,s),p=e.memoizedState,d!==i||E!==p||el.current||Kf?(typeof x=="function"&&(DN(e,t,x,i),p=e.memoizedState),(d=Kf||t$(e,t,d,i,E,p,g))?(b||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(e.flags|=4194308)):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=p),u.props=i,u.state=p,u.context=g,i=d):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{u=e.stateNode,AY(n,e),d=e.memoizedProps,g=e.type===e.elementType?d:Kc(e.type,d),u.props=g,b=e.pendingProps,E=u.context,p=t.contextType,typeof p=="object"&&p!==null?p=pc(p):(p=tl(t)?Ug:qo.current,p=wA(e,p));var S=t.getDerivedStateFromProps;(x=typeof S=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(d!==b||E!==p)&&n$(e,u,i,p),Kf=!1,E=e.memoizedState,u.state=E,NI(e,i,u,s);var M=e.memoizedState;d!==b||E!==M||el.current||Kf?(typeof S=="function"&&(DN(e,t,S,i),M=e.memoizedState),(g=Kf||t$(e,t,g,i,E,M,p)||!1)?(x||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(i,M,p),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(i,M,p)),typeof u.componentDidUpdate=="function"&&(e.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof u.componentDidUpdate!="function"||d===n.memoizedProps&&E===n.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||d===n.memoizedProps&&E===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=M),u.props=i,u.state=M,u.context=p,i=g):(typeof u.componentDidUpdate!="function"||d===n.memoizedProps&&E===n.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||d===n.memoizedProps&&E===n.memoizedState||(e.flags|=1024),i=!1)}return UN(n,e,t,i,l,s)}function UN(n,e,t,i,s,l){HY(n,e);var u=(e.flags&128)!==0;if(!i&&!u)return s&&QX(e,t,!1),Nd(n,e,l);i=e.stateNode,IPe.current=e;var d=u&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&u?(e.child=EA(e,n.child,null,l),e.child=EA(e,null,d,l)):xa(n,e,d,l),e.memoizedState=i.state,s&&QX(e,t,!0),e.child}function XY(n){var e=n.stateNode;e.pendingContext?$X(n,e.pendingContext,e.pendingContext!==e.context):e.context&&$X(n,e.context,!1),hF(n,e.containerInfo)}function c$(n,e,t,i,s){return CA(),sF(s),e.flags|=256,xa(n,e,t,i),e.child}var zN={dehydrated:null,treeContext:null,retryLane:0};function GN(n){return{baseLanes:n,cachePool:null,transitions:null}}function $Y(n,e,t){var i=e.pendingProps,s=Nr.current,l=!1,u=(e.flags&128)!==0,d;if((d=u)||(d=n!==null&&n.memoizedState===null?!1:(s&2)!==0),d?(l=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),vr(Nr,s&1),n===null)return PN(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(u=i.children,n=i.fallback,l?(i=e.mode,l=e.child,u={mode:"hidden",children:u},!(i&1)&&l!==null?(l.childLanes=0,l.pendingProps=u):l=BS(u,i,0,null),n=Lg(n,i,t,null),l.return=e,n.return=e,l.sibling=n,e.child=l,e.child.memoizedState=GN(t),e.memoizedState=zN,n):vF(e,u));if(s=n.memoizedState,s!==null&&(d=s.dehydrated,d!==null))return SPe(n,e,u,i,d,s,t);if(l){l=i.fallback,u=e.mode,s=n.child,d=s.sibling;var p={mode:"hidden",children:i.children};return!(u&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=p,e.deletions=null):(i=yp(s,p),i.subtreeFlags=s.subtreeFlags&14680064),d!==null?l=yp(d,l):(l=Lg(l,u,t,null),l.flags|=2),l.return=e,i.return=e,i.sibling=l,e.child=i,i=l,l=e.child,u=n.child.memoizedState,u=u===null?GN(t):{baseLanes:u.baseLanes|t,cachePool:null,transitions:u.transitions},l.memoizedState=u,l.childLanes=n.childLanes&~t,e.memoizedState=zN,i}return l=n.child,n=l.sibling,i=yp(l,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function vF(n,e){return e=BS({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function sE(n,e,t,i){return i!==null&&sF(i),EA(e,n.child,null,t),n=vF(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function SPe(n,e,t,i,s,l,u){if(t)return e.flags&256?(e.flags&=-257,i=FL(Error(Ut(422))),sE(n,e,u,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(l=i.fallback,s=e.mode,i=BS({mode:"visible",children:i.children},s,0,null),l=Lg(l,s,u,null),l.flags|=2,i.return=e,l.return=e,i.sibling=l,e.child=i,e.mode&1&&EA(e,n.child,null,u),e.child.memoizedState=GN(u),e.memoizedState=zN,l);if(!(e.mode&1))return sE(n,e,u,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var d=i.dgst;return i=d,l=Error(Ut(419)),i=FL(l,i,void 0),sE(n,e,u,i)}if(d=(u&n.childLanes)!==0,qa||d){if(i=io,i!==null){switch(u&-u){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|u)?0:s,s!==0&&s!==l.retryLane&&(l.retryLane=s,Pd(n,s),ru(i,n,s,-1))}return _F(),i=FL(Error(Ut(421))),sE(n,e,u,i)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=UPe.bind(null,n),s._reactRetry=e,null):(n=l.treeContext,Sl=fp(s.nextSibling),Tl=e,Lr=!0,jc=null,n!==null&&(sc[oc++]=pd,sc[oc++]=md,sc[oc++]=zg,pd=n.id,md=n.overflow,zg=e),e=vF(e,i.children),e.flags|=4096,e)}function u$(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),NN(n.return,e,t)}function OL(n,e,t,i,s){var l=n.memoizedState;l===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:s}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=i,l.tail=t,l.tailMode=s)}function QY(n,e,t){var i=e.pendingProps,s=i.revealOrder,l=i.tail;if(xa(n,e,i.children,t),i=Nr.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&u$(n,t,e);else if(n.tag===19)u$(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(vr(Nr,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&DI(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),OL(e,!1,s,t,l);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&DI(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}OL(e,!0,t,null,l);break;case"together":OL(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function K_(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Nd(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Wg|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Ut(153));if(e.child!==null){for(n=e.child,t=yp(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=yp(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function TPe(n,e,t){switch(e.tag){case 3:XY(e),CA();break;case 5:vY(e);break;case 1:tl(e.type)&&kI(e);break;case 4:hF(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;vr(BI,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(vr(Nr,Nr.current&1),e.flags|=128,null):t&e.child.childLanes?$Y(n,e,t):(vr(Nr,Nr.current&1),n=Nd(n,e,t),n!==null?n.sibling:null);vr(Nr,Nr.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return QY(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),vr(Nr,Nr.current),i)break;return null;case 22:case 23:return e.lanes=0,WY(n,e,t)}return Nd(n,e,t)}var KY,WN,ZY,jY;KY=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};WN=function(){};ZY=function(n,e,t,i){var s=n.memoizedProps;if(s!==i){n=e.stateNode,Eg(oh.current);var l=null;switch(t){case"input":s=hN(n,s),i=hN(n,i),l=[];break;case"select":s=Ur({},s,{value:void 0}),i=Ur({},i,{value:void 0}),l=[];break;case"textarea":s=pN(n,s),i=pN(n,i),l=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=TI)}gN(t,i);var u;t=null;for(g in s)if(!i.hasOwnProperty(g)&&s.hasOwnProperty(g)&&s[g]!=null)if(g==="style"){var d=s[g];for(u in d)d.hasOwnProperty(u)&&(t||(t={}),t[u]="")}else g!=="dangerouslySetInnerHTML"&&g!=="children"&&g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(Fx.hasOwnProperty(g)?l||(l=[]):(l=l||[]).push(g,null));for(g in i){var p=i[g];if(d=s!=null?s[g]:void 0,i.hasOwnProperty(g)&&p!==d&&(p!=null||d!=null))if(g==="style")if(d){for(u in d)!d.hasOwnProperty(u)||p&&p.hasOwnProperty(u)||(t||(t={}),t[u]="");for(u in p)p.hasOwnProperty(u)&&d[u]!==p[u]&&(t||(t={}),t[u]=p[u])}else t||(l||(l=[]),l.push(g,t)),t=p;else g==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,d=d?d.__html:void 0,p!=null&&d!==p&&(l=l||[]).push(g,p)):g==="children"?typeof p!="string"&&typeof p!="number"||(l=l||[]).push(g,""+p):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&(Fx.hasOwnProperty(g)?(p!=null&&g==="onScroll"&&Er("scroll",n),l||d===p||(l=[])):(l=l||[]).push(g,p))}t&&(l=l||[]).push("style",t);var g=l;(e.updateQueue=g)&&(e.flags|=4)}};jY=function(n,e,t,i){t!==i&&(e.flags|=4)};function bb(n,e){if(!Lr)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function zo(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function MPe(n,e,t){var i=e.pendingProps;switch(rF(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zo(e),null;case 1:return tl(e.type)&&MI(),zo(e),null;case 3:return i=e.stateNode,_A(),Sr(el),Sr(qo),fF(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(iE(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,jc!==null&&(YN(jc),jc=null))),WN(n,e),zo(e),null;case 5:dF(e);var s=Eg(Zx.current);if(t=e.type,n!==null&&e.stateNode!=null)ZY(n,e,t,i,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ut(166));return zo(e),null}if(n=Eg(oh.current),iE(e)){i=e.stateNode,t=e.type;var l=e.memoizedProps;switch(i[th]=e,i[Qx]=l,n=(e.mode&1)!==0,t){case"dialog":Er("cancel",i),Er("close",i);break;case"iframe":case"object":case"embed":Er("load",i);break;case"video":case"audio":for(s=0;s<Yb.length;s++)Er(Yb[s],i);break;case"source":Er("error",i);break;case"img":case"image":case"link":Er("error",i),Er("load",i);break;case"details":Er("toggle",i);break;case"input":vX(i,l),Er("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!l.multiple},Er("invalid",i);break;case"textarea":xX(i,l),Er("invalid",i)}gN(t,l),s=null;for(var u in l)if(l.hasOwnProperty(u)){var d=l[u];u==="children"?typeof d=="string"?i.textContent!==d&&(l.suppressHydrationWarning!==!0&&nE(i.textContent,d,n),s=["children",d]):typeof d=="number"&&i.textContent!==""+d&&(l.suppressHydrationWarning!==!0&&nE(i.textContent,d,n),s=["children",""+d]):Fx.hasOwnProperty(u)&&d!=null&&u==="onScroll"&&Er("scroll",i)}switch(t){case"input":KC(i),bX(i,l,!0);break;case"textarea":KC(i),wX(i);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(i.onclick=TI)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{u=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=E7(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=u.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=u.createElement(t,{is:i.is}):(n=u.createElement(t),t==="select"&&(u=n,i.multiple?u.multiple=!0:i.size&&(u.size=i.size))):n=u.createElementNS(n,t),n[th]=e,n[Qx]=i,KY(n,e,!1,!1),e.stateNode=n;e:{switch(u=yN(t,i),t){case"dialog":Er("cancel",n),Er("close",n),s=i;break;case"iframe":case"object":case"embed":Er("load",n),s=i;break;case"video":case"audio":for(s=0;s<Yb.length;s++)Er(Yb[s],n);s=i;break;case"source":Er("error",n),s=i;break;case"img":case"image":case"link":Er("error",n),Er("load",n),s=i;break;case"details":Er("toggle",n),s=i;break;case"input":vX(n,i),s=hN(n,i),Er("invalid",n);break;case"option":s=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},s=Ur({},i,{value:void 0}),Er("invalid",n);break;case"textarea":xX(n,i),s=pN(n,i),Er("invalid",n);break;default:s=i}gN(t,s),d=s;for(l in d)if(d.hasOwnProperty(l)){var p=d[l];l==="style"?S7(n,p):l==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&_7(n,p)):l==="children"?typeof p=="string"?(t!=="textarea"||p!=="")&&Ox(n,p):typeof p=="number"&&Ox(n,""+p):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Fx.hasOwnProperty(l)?p!=null&&l==="onScroll"&&Er("scroll",n):p!=null&&W3(n,l,p,u))}switch(t){case"input":KC(n),bX(n,i,!1);break;case"textarea":KC(n),wX(n);break;case"option":i.value!=null&&n.setAttribute("value",""+Rp(i.value));break;case"select":n.multiple=!!i.multiple,l=i.value,l!=null?aA(n,!!i.multiple,l,!1):i.defaultValue!=null&&aA(n,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=TI)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return zo(e),null;case 6:if(n&&e.stateNode!=null)jY(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ut(166));if(t=Eg(Zx.current),Eg(oh.current),iE(e)){if(i=e.stateNode,t=e.memoizedProps,i[th]=e,(l=i.nodeValue!==t)&&(n=Tl,n!==null))switch(n.tag){case 3:nE(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&nE(i.nodeValue,t,(n.mode&1)!==0)}l&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[th]=e,e.stateNode=i}return zo(e),null;case 13:if(Sr(Nr),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Lr&&Sl!==null&&e.mode&1&&!(e.flags&128))pY(),CA(),e.flags|=98560,l=!1;else if(l=iE(e),i!==null&&i.dehydrated!==null){if(n===null){if(!l)throw Error(Ut(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(Ut(317));l[th]=e}else CA(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;zo(e),l=!1}else jc!==null&&(YN(jc),jc=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Nr.current&1?Gs===0&&(Gs=3):_F())),e.updateQueue!==null&&(e.flags|=4),zo(e),null);case 4:return _A(),WN(n,e),n===null&&Xx(e.stateNode.containerInfo),zo(e),null;case 10:return lF(e.type._context),zo(e),null;case 17:return tl(e.type)&&MI(),zo(e),null;case 19:if(Sr(Nr),l=e.memoizedState,l===null)return zo(e),null;if(i=(e.flags&128)!==0,u=l.rendering,u===null)if(i)bb(l,!1);else{if(Gs!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(u=DI(n),u!==null){for(e.flags|=128,bb(l,!1),i=u.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)l=t,n=i,l.flags&=14680066,u=l.alternate,u===null?(l.childLanes=0,l.lanes=n,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=u.childLanes,l.lanes=u.lanes,l.child=u.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=u.memoizedProps,l.memoizedState=u.memoizedState,l.updateQueue=u.updateQueue,l.type=u.type,n=u.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return vr(Nr,Nr.current&1|2),e.child}n=n.sibling}l.tail!==null&&os()>SA&&(e.flags|=128,i=!0,bb(l,!1),e.lanes=4194304)}else{if(!i)if(n=DI(u),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),bb(l,!0),l.tail===null&&l.tailMode==="hidden"&&!u.alternate&&!Lr)return zo(e),null}else 2*os()-l.renderingStartTime>SA&&t!==1073741824&&(e.flags|=128,i=!0,bb(l,!1),e.lanes=4194304);l.isBackwards?(u.sibling=e.child,e.child=u):(t=l.last,t!==null?t.sibling=u:e.child=u,l.last=u)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=os(),e.sibling=null,t=Nr.current,vr(Nr,i?t&1|2:t&1),e):(zo(e),null);case 22:case 23:return EF(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?El&1073741824&&(zo(e),e.subtreeFlags&6&&(e.flags|=8192)):zo(e),null;case 24:return null;case 25:return null}throw Error(Ut(156,e.tag))}function kPe(n,e){switch(rF(e),e.tag){case 1:return tl(e.type)&&MI(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return _A(),Sr(el),Sr(qo),fF(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return dF(e),null;case 13:if(Sr(Nr),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Ut(340));CA()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Sr(Nr),null;case 4:return _A(),null;case 10:return lF(e.type._context),null;case 22:case 23:return EF(),null;case 24:return null;default:return null}}var oE=!1,Zo=!1,RPe=typeof WeakSet=="function"?WeakSet:Set,xn=null;function Qy(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){jr(n,e,i)}else t.current=null}function HN(n,e,t){try{t()}catch(i){jr(n,e,i)}}var h$=!1;function LPe(n,e){if(SN=_I,n=tY(),nF(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var s=i.anchorOffset,l=i.focusNode;i=i.focusOffset;try{t.nodeType,l.nodeType}catch{t=null;break e}var u=0,d=-1,p=-1,g=0,x=0,b=n,E=null;t:for(;;){for(var S;b!==t||s!==0&&b.nodeType!==3||(d=u+s),b!==l||i!==0&&b.nodeType!==3||(p=u+i),b.nodeType===3&&(u+=b.nodeValue.length),(S=b.firstChild)!==null;)E=b,b=S;for(;;){if(b===n)break t;if(E===t&&++g===s&&(d=u),E===l&&++x===i&&(p=u),(S=b.nextSibling)!==null)break;b=E,E=b.parentNode}b=S}t=d===-1||p===-1?null:{start:d,end:p}}else t=null}t=t||{start:0,end:0}}else t=null;for(TN={focusedElem:n,selectionRange:t},_I=!1,xn=e;xn!==null;)if(e=xn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,xn=n;else for(;xn!==null;){e=xn;try{var M=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(M!==null){var R=M.memoizedProps,P=M.memoizedState,k=e.stateNode,F=k.getSnapshotBeforeUpdate(e.elementType===e.type?R:Kc(e.type,R),P);k.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var V=e.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ut(163))}}catch(G){jr(e,e.return,G)}if(n=e.sibling,n!==null){n.return=e.return,xn=n;break}xn=e.return}return M=h$,h$=!1,M}function fx(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&n)===n){var l=s.destroy;s.destroy=void 0,l!==void 0&&HN(e,t,l)}s=s.next}while(s!==i)}}function RS(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function XN(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function YY(n){var e=n.alternate;e!==null&&(n.alternate=null,YY(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[th],delete e[Qx],delete e[RN],delete e[pPe],delete e[mPe])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function qY(n){return n.tag===5||n.tag===3||n.tag===4}function d$(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||qY(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function $N(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=TI));else if(i!==4&&(n=n.child,n!==null))for($N(n,e,t),n=n.sibling;n!==null;)$N(n,e,t),n=n.sibling}function QN(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(QN(n,e,t),n=n.sibling;n!==null;)QN(n,e,t),n=n.sibling}var go=null,Zc=!1;function Lf(n,e,t){for(t=t.child;t!==null;)JY(n,e,t),t=t.sibling}function JY(n,e,t){if(sh&&typeof sh.onCommitFiberUnmount=="function")try{sh.onCommitFiberUnmount(CS,t)}catch{}switch(t.tag){case 5:Zo||Qy(t,e);case 6:var i=go,s=Zc;go=null,Lf(n,e,t),go=i,Zc=s,go!==null&&(Zc?(n=go,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):go.removeChild(t.stateNode));break;case 18:go!==null&&(Zc?(n=go,t=t.stateNode,n.nodeType===8?RL(n.parentNode,t):n.nodeType===1&&RL(n,t),Gx(n)):RL(go,t.stateNode));break;case 4:i=go,s=Zc,go=t.stateNode.containerInfo,Zc=!0,Lf(n,e,t),go=i,Zc=s;break;case 0:case 11:case 14:case 15:if(!Zo&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var l=s,u=l.destroy;l=l.tag,u!==void 0&&(l&2||l&4)&&HN(t,e,u),s=s.next}while(s!==i)}Lf(n,e,t);break;case 1:if(!Zo&&(Qy(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(d){jr(t,e,d)}Lf(n,e,t);break;case 21:Lf(n,e,t);break;case 22:t.mode&1?(Zo=(i=Zo)||t.memoizedState!==null,Lf(n,e,t),Zo=i):Lf(n,e,t);break;default:Lf(n,e,t)}}function f$(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new RPe),e.forEach(function(i){var s=zPe.bind(null,n,i);t.has(i)||(t.add(i),i.then(s,s))})}}function zc(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var s=t[i];try{var l=n,u=e,d=u;e:for(;d!==null;){switch(d.tag){case 5:go=d.stateNode,Zc=!1;break e;case 3:go=d.stateNode.containerInfo,Zc=!0;break e;case 4:go=d.stateNode.containerInfo,Zc=!0;break e}d=d.return}if(go===null)throw Error(Ut(160));JY(l,u,s),go=null,Zc=!1;var p=s.alternate;p!==null&&(p.return=null),s.return=null}catch(g){jr(s,e,g)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)eq(e,n),e=e.sibling}function eq(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(zc(e,n),Ku(n),i&4){try{fx(3,n,n.return),RS(3,n)}catch(R){jr(n,n.return,R)}try{fx(5,n,n.return)}catch(R){jr(n,n.return,R)}}break;case 1:zc(e,n),Ku(n),i&512&&t!==null&&Qy(t,t.return);break;case 5:if(zc(e,n),Ku(n),i&512&&t!==null&&Qy(t,t.return),n.flags&32){var s=n.stateNode;try{Ox(s,"")}catch(R){jr(n,n.return,R)}}if(i&4&&(s=n.stateNode,s!=null)){var l=n.memoizedProps,u=t!==null?t.memoizedProps:l,d=n.type,p=n.updateQueue;if(n.updateQueue=null,p!==null)try{d==="input"&&l.type==="radio"&&l.name!=null&&w7(s,l),yN(d,u);var g=yN(d,l);for(u=0;u<p.length;u+=2){var x=p[u],b=p[u+1];x==="style"?S7(s,b):x==="dangerouslySetInnerHTML"?_7(s,b):x==="children"?Ox(s,b):W3(s,x,b,g)}switch(d){case"input":dN(s,l);break;case"textarea":C7(s,l);break;case"select":var E=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!l.multiple;var S=l.value;S!=null?aA(s,!!l.multiple,S,!1):E!==!!l.multiple&&(l.defaultValue!=null?aA(s,!!l.multiple,l.defaultValue,!0):aA(s,!!l.multiple,l.multiple?[]:"",!1))}s[Qx]=l}catch(R){jr(n,n.return,R)}}break;case 6:if(zc(e,n),Ku(n),i&4){if(n.stateNode===null)throw Error(Ut(162));s=n.stateNode,l=n.memoizedProps;try{s.nodeValue=l}catch(R){jr(n,n.return,R)}}break;case 3:if(zc(e,n),Ku(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Gx(e.containerInfo)}catch(R){jr(n,n.return,R)}break;case 4:zc(e,n),Ku(n);break;case 13:zc(e,n),Ku(n),s=n.child,s.flags&8192&&(l=s.memoizedState!==null,s.stateNode.isHidden=l,!l||s.alternate!==null&&s.alternate.memoizedState!==null||(wF=os())),i&4&&f$(n);break;case 22:if(x=t!==null&&t.memoizedState!==null,n.mode&1?(Zo=(g=Zo)||x,zc(e,n),Zo=g):zc(e,n),Ku(n),i&8192){if(g=n.memoizedState!==null,(n.stateNode.isHidden=g)&&!x&&n.mode&1)for(xn=n,x=n.child;x!==null;){for(b=xn=x;xn!==null;){switch(E=xn,S=E.child,E.tag){case 0:case 11:case 14:case 15:fx(4,E,E.return);break;case 1:Qy(E,E.return);var M=E.stateNode;if(typeof M.componentWillUnmount=="function"){i=E,t=E.return;try{e=i,M.props=e.memoizedProps,M.state=e.memoizedState,M.componentWillUnmount()}catch(R){jr(i,t,R)}}break;case 5:Qy(E,E.return);break;case 22:if(E.memoizedState!==null){m$(b);continue}}S!==null?(S.return=E,xn=S):m$(b)}x=x.sibling}e:for(x=null,b=n;;){if(b.tag===5){if(x===null){x=b;try{s=b.stateNode,g?(l=s.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(d=b.stateNode,p=b.memoizedProps.style,u=p!=null&&p.hasOwnProperty("display")?p.display:null,d.style.display=I7("display",u))}catch(R){jr(n,n.return,R)}}}else if(b.tag===6){if(x===null)try{b.stateNode.nodeValue=g?"":b.memoizedProps}catch(R){jr(n,n.return,R)}}else if((b.tag!==22&&b.tag!==23||b.memoizedState===null||b===n)&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===n)break e;for(;b.sibling===null;){if(b.return===null||b.return===n)break e;x===b&&(x=null),b=b.return}x===b&&(x=null),b.sibling.return=b.return,b=b.sibling}}break;case 19:zc(e,n),Ku(n),i&4&&f$(n);break;case 21:break;default:zc(e,n),Ku(n)}}function Ku(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(qY(t)){var i=t;break e}t=t.return}throw Error(Ut(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(Ox(s,""),i.flags&=-33);var l=d$(n);QN(n,l,s);break;case 3:case 4:var u=i.stateNode.containerInfo,d=d$(n);$N(n,d,u);break;default:throw Error(Ut(161))}}catch(p){jr(n,n.return,p)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function BPe(n,e,t){xn=n,tq(n)}function tq(n,e,t){for(var i=(n.mode&1)!==0;xn!==null;){var s=xn,l=s.child;if(s.tag===22&&i){var u=s.memoizedState!==null||oE;if(!u){var d=s.alternate,p=d!==null&&d.memoizedState!==null||Zo;d=oE;var g=Zo;if(oE=u,(Zo=p)&&!g)for(xn=s;xn!==null;)u=xn,p=u.child,u.tag===22&&u.memoizedState!==null?g$(s):p!==null?(p.return=u,xn=p):g$(s);for(;l!==null;)xn=l,tq(l),l=l.sibling;xn=s,oE=d,Zo=g}p$(n)}else s.subtreeFlags&8772&&l!==null?(l.return=s,xn=l):p$(n)}}function p$(n){for(;xn!==null;){var e=xn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Zo||RS(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Zo)if(t===null)i.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Kc(e.type,t.memoizedProps);i.componentDidUpdate(s,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&qX(e,l,i);break;case 3:var u=e.updateQueue;if(u!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}qX(e,u,t)}break;case 5:var d=e.stateNode;if(t===null&&e.flags&4){t=d;var p=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&t.focus();break;case"img":p.src&&(t.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var g=e.alternate;if(g!==null){var x=g.memoizedState;if(x!==null){var b=x.dehydrated;b!==null&&Gx(b)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ut(163))}Zo||e.flags&512&&XN(e)}catch(E){jr(e,e.return,E)}}if(e===n){xn=null;break}if(t=e.sibling,t!==null){t.return=e.return,xn=t;break}xn=e.return}}function m$(n){for(;xn!==null;){var e=xn;if(e===n){xn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,xn=t;break}xn=e.return}}function g$(n){for(;xn!==null;){var e=xn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{RS(4,e)}catch(p){jr(e,t,p)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(p){jr(e,s,p)}}var l=e.return;try{XN(e)}catch(p){jr(e,l,p)}break;case 5:var u=e.return;try{XN(e)}catch(p){jr(e,u,p)}}}catch(p){jr(e,e.return,p)}if(e===n){xn=null;break}var d=e.sibling;if(d!==null){d.return=e.return,xn=d;break}xn=e.return}}var PPe=Math.ceil,VI=$d.ReactCurrentDispatcher,bF=$d.ReactCurrentOwner,dc=$d.ReactCurrentBatchConfig,Hi=0,io=null,Is=null,wo=0,El=0,Ky=Kp(0),Gs=0,Jx=null,Wg=0,LS=0,xF=0,px=null,ja=null,wF=0,SA=1/0,cd=null,UI=!1,KN=null,mp=null,aE=!1,ap=null,zI=0,mx=0,ZN=null,Z_=-1,j_=0;function Sa(){return Hi&6?os():Z_!==-1?Z_:Z_=os()}function gp(n){return n.mode&1?Hi&2&&wo!==0?wo&-wo:yPe.transition!==null?(j_===0&&(j_=V7()),j_):(n=nr,n!==0||(n=window.event,n=n===void 0?16:$7(n.type)),n):1}function ru(n,e,t,i){if(50<mx)throw mx=0,ZN=null,Error(Ut(185));U1(n,t,i),(!(Hi&2)||n!==io)&&(n===io&&(!(Hi&2)&&(LS|=t),Gs===4&&ep(n,wo)),nl(n,i),t===1&&Hi===0&&!(e.mode&1)&&(SA=os()+500,TS&&Zp()))}function nl(n,e){var t=n.callbackNode;yBe(n,e);var i=EI(n,n===io?wo:0);if(i===0)t!==null&&_X(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&_X(t),e===1)n.tag===0?gPe(y$.bind(null,n)):hY(y$.bind(null,n)),dPe(function(){!(Hi&6)&&Zp()}),t=null;else{switch(U7(i)){case 1:t=K3;break;case 4:t=F7;break;case 16:t=CI;break;case 536870912:t=O7;break;default:t=CI}t=cq(t,nq.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function nq(n,e){if(Z_=-1,j_=0,Hi&6)throw Error(Ut(327));var t=n.callbackNode;if(dA()&&n.callbackNode!==t)return null;var i=EI(n,n===io?wo:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=GI(n,i);else{e=i;var s=Hi;Hi|=2;var l=rq();(io!==n||wo!==e)&&(cd=null,SA=os()+500,Rg(n,e));do try{FPe();break}catch(d){iq(n,d)}while(!0);aF(),VI.current=l,Hi=s,Is!==null?e=0:(io=null,wo=0,e=Gs)}if(e!==0){if(e===2&&(s=wN(n),s!==0&&(i=s,e=jN(n,s))),e===1)throw t=Jx,Rg(n,0),ep(n,i),nl(n,os()),t;if(e===6)ep(n,i);else{if(s=n.current.alternate,!(i&30)&&!NPe(s)&&(e=GI(n,i),e===2&&(l=wN(n),l!==0&&(i=l,e=jN(n,l))),e===1))throw t=Jx,Rg(n,0),ep(n,i),nl(n,os()),t;switch(n.finishedWork=s,n.finishedLanes=i,e){case 0:case 1:throw Error(Ut(345));case 2:dg(n,ja,cd);break;case 3:if(ep(n,i),(i&130023424)===i&&(e=wF+500-os(),10<e)){if(EI(n,0)!==0)break;if(s=n.suspendedLanes,(s&i)!==i){Sa(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=kN(dg.bind(null,n,ja,cd),e);break}dg(n,ja,cd);break;case 4:if(ep(n,i),(i&4194240)===i)break;for(e=n.eventTimes,s=-1;0<i;){var u=31-iu(i);l=1<<u,u=e[u],u>s&&(s=u),i&=~l}if(i=s,i=os()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*PPe(i/1960))-i,10<i){n.timeoutHandle=kN(dg.bind(null,n,ja,cd),i);break}dg(n,ja,cd);break;case 5:dg(n,ja,cd);break;default:throw Error(Ut(329))}}}return nl(n,os()),n.callbackNode===t?nq.bind(null,n):null}function jN(n,e){var t=px;return n.current.memoizedState.isDehydrated&&(Rg(n,e).flags|=256),n=GI(n,e),n!==2&&(e=ja,ja=t,e!==null&&YN(e)),n}function YN(n){ja===null?ja=n:ja.push.apply(ja,n)}function NPe(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var s=t[i],l=s.getSnapshot;s=s.value;try{if(!su(l(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ep(n,e){for(e&=~xF,e&=~LS,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-iu(e),i=1<<t;n[t]=-1,e&=~i}}function y$(n){if(Hi&6)throw Error(Ut(327));dA();var e=EI(n,0);if(!(e&1))return nl(n,os()),null;var t=GI(n,e);if(n.tag!==0&&t===2){var i=wN(n);i!==0&&(e=i,t=jN(n,i))}if(t===1)throw t=Jx,Rg(n,0),ep(n,e),nl(n,os()),t;if(t===6)throw Error(Ut(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,dg(n,ja,cd),nl(n,os()),null}function CF(n,e){var t=Hi;Hi|=1;try{return n(e)}finally{Hi=t,Hi===0&&(SA=os()+500,TS&&Zp())}}function Hg(n){ap!==null&&ap.tag===0&&!(Hi&6)&&dA();var e=Hi;Hi|=1;var t=dc.transition,i=nr;try{if(dc.transition=null,nr=1,n)return n()}finally{nr=i,dc.transition=t,Hi=e,!(Hi&6)&&Zp()}}function EF(){El=Ky.current,Sr(Ky)}function Rg(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,hPe(t)),Is!==null)for(t=Is.return;t!==null;){var i=t;switch(rF(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&MI();break;case 3:_A(),Sr(el),Sr(qo),fF();break;case 5:dF(i);break;case 4:_A();break;case 13:Sr(Nr);break;case 19:Sr(Nr);break;case 10:lF(i.type._context);break;case 22:case 23:EF()}t=t.return}if(io=n,Is=n=yp(n.current,null),wo=El=e,Gs=0,Jx=null,xF=LS=Wg=0,ja=px=null,Cg!==null){for(e=0;e<Cg.length;e++)if(t=Cg[e],i=t.interleaved,i!==null){t.interleaved=null;var s=i.next,l=t.pending;if(l!==null){var u=l.next;l.next=s,i.next=u}t.pending=i}Cg=null}return n}function iq(n,e){do{var t=Is;try{if(aF(),$_.current=OI,FI){for(var i=Or.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}FI=!1}if(Gg=0,no=Vs=Or=null,dx=!1,jx=0,bF.current=null,t===null||t.return===null){Gs=1,Jx=e,Is=null;break}e:{var l=n,u=t.return,d=t,p=e;if(e=wo,d.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var g=p,x=d,b=x.tag;if(!(x.mode&1)&&(b===0||b===11||b===15)){var E=x.alternate;E?(x.updateQueue=E.updateQueue,x.memoizedState=E.memoizedState,x.lanes=E.lanes):(x.updateQueue=null,x.memoizedState=null)}var S=r$(u);if(S!==null){S.flags&=-257,s$(S,u,d,l,e),S.mode&1&&i$(l,g,e),e=S,p=g;var M=e.updateQueue;if(M===null){var R=new Set;R.add(p),e.updateQueue=R}else M.add(p);break e}else{if(!(e&1)){i$(l,g,e),_F();break e}p=Error(Ut(426))}}else if(Lr&&d.mode&1){var P=r$(u);if(P!==null){!(P.flags&65536)&&(P.flags|=256),s$(P,u,d,l,e),sF(IA(p,d));break e}}l=p=IA(p,d),Gs!==4&&(Gs=2),px===null?px=[l]:px.push(l),l=u;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var k=UY(l,p,e);YX(l,k);break e;case 1:d=p;var F=l.type,V=l.stateNode;if(!(l.flags&128)&&(typeof F.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(mp===null||!mp.has(V)))){l.flags|=65536,e&=-e,l.lanes|=e;var G=zY(l,d,e);YX(l,G);break e}}l=l.return}while(l!==null)}oq(t)}catch(q){e=q,Is===t&&t!==null&&(Is=t=t.return);continue}break}while(!0)}function rq(){var n=VI.current;return VI.current=OI,n===null?OI:n}function _F(){(Gs===0||Gs===3||Gs===2)&&(Gs=4),io===null||!(Wg&268435455)&&!(LS&268435455)||ep(io,wo)}function GI(n,e){var t=Hi;Hi|=2;var i=rq();(io!==n||wo!==e)&&(cd=null,Rg(n,e));do try{DPe();break}catch(s){iq(n,s)}while(!0);if(aF(),Hi=t,VI.current=i,Is!==null)throw Error(Ut(261));return io=null,wo=0,Gs}function DPe(){for(;Is!==null;)sq(Is)}function FPe(){for(;Is!==null&&!lBe();)sq(Is)}function sq(n){var e=lq(n.alternate,n,El);n.memoizedProps=n.pendingProps,e===null?oq(n):Is=e,bF.current=null}function oq(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=kPe(t,e),t!==null){t.flags&=32767,Is=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Gs=6,Is=null;return}}else if(t=MPe(t,e,El),t!==null){Is=t;return}if(e=e.sibling,e!==null){Is=e;return}Is=e=n}while(e!==null);Gs===0&&(Gs=5)}function dg(n,e,t){var i=nr,s=dc.transition;try{dc.transition=null,nr=1,OPe(n,e,t,i)}finally{dc.transition=s,nr=i}return null}function OPe(n,e,t,i){do dA();while(ap!==null);if(Hi&6)throw Error(Ut(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ut(177));n.callbackNode=null,n.callbackPriority=0;var l=t.lanes|t.childLanes;if(ABe(n,l),n===io&&(Is=io=null,wo=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||aE||(aE=!0,cq(CI,function(){return dA(),null})),l=(t.flags&15990)!==0,t.subtreeFlags&15990||l){l=dc.transition,dc.transition=null;var u=nr;nr=1;var d=Hi;Hi|=4,bF.current=null,LPe(n,t),eq(t,n),rPe(TN),_I=!!SN,TN=SN=null,n.current=t,BPe(t),cBe(),Hi=d,nr=u,dc.transition=l}else n.current=t;if(aE&&(aE=!1,ap=n,zI=s),l=n.pendingLanes,l===0&&(mp=null),dBe(t.stateNode),nl(n,os()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],i(s.value,{componentStack:s.stack,digest:s.digest});if(UI)throw UI=!1,n=KN,KN=null,n;return zI&1&&n.tag!==0&&dA(),l=n.pendingLanes,l&1?n===ZN?mx++:(mx=0,ZN=n):mx=0,Zp(),null}function dA(){if(ap!==null){var n=U7(zI),e=dc.transition,t=nr;try{if(dc.transition=null,nr=16>n?16:n,ap===null)var i=!1;else{if(n=ap,ap=null,zI=0,Hi&6)throw Error(Ut(331));var s=Hi;for(Hi|=4,xn=n.current;xn!==null;){var l=xn,u=l.child;if(xn.flags&16){var d=l.deletions;if(d!==null){for(var p=0;p<d.length;p++){var g=d[p];for(xn=g;xn!==null;){var x=xn;switch(x.tag){case 0:case 11:case 15:fx(8,x,l)}var b=x.child;if(b!==null)b.return=x,xn=b;else for(;xn!==null;){x=xn;var E=x.sibling,S=x.return;if(YY(x),x===g){xn=null;break}if(E!==null){E.return=S,xn=E;break}xn=S}}}var M=l.alternate;if(M!==null){var R=M.child;if(R!==null){M.child=null;do{var P=R.sibling;R.sibling=null,R=P}while(R!==null)}}xn=l}}if(l.subtreeFlags&2064&&u!==null)u.return=l,xn=u;else e:for(;xn!==null;){if(l=xn,l.flags&2048)switch(l.tag){case 0:case 11:case 15:fx(9,l,l.return)}var k=l.sibling;if(k!==null){k.return=l.return,xn=k;break e}xn=l.return}}var F=n.current;for(xn=F;xn!==null;){u=xn;var V=u.child;if(u.subtreeFlags&2064&&V!==null)V.return=u,xn=V;else e:for(u=F;xn!==null;){if(d=xn,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:RS(9,d)}}catch(q){jr(d,d.return,q)}if(d===u){xn=null;break e}var G=d.sibling;if(G!==null){G.return=d.return,xn=G;break e}xn=d.return}}if(Hi=s,Zp(),sh&&typeof sh.onPostCommitFiberRoot=="function")try{sh.onPostCommitFiberRoot(CS,n)}catch{}i=!0}return i}finally{nr=t,dc.transition=e}}return!1}function A$(n,e,t){e=IA(t,e),e=UY(n,e,1),n=pp(n,e,1),e=Sa(),n!==null&&(U1(n,1,e),nl(n,e))}function jr(n,e,t){if(n.tag===3)A$(n,n,t);else for(;e!==null;){if(e.tag===3){A$(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(mp===null||!mp.has(i))){n=IA(t,n),n=zY(e,n,1),e=pp(e,n,1),n=Sa(),e!==null&&(U1(e,1,n),nl(e,n));break}}e=e.return}}function VPe(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Sa(),n.pingedLanes|=n.suspendedLanes&t,io===n&&(wo&t)===t&&(Gs===4||Gs===3&&(wo&130023424)===wo&&500>os()-wF?Rg(n,0):xF|=t),nl(n,e)}function aq(n,e){e===0&&(n.mode&1?(e=YC,YC<<=1,!(YC&130023424)&&(YC=4194304)):e=1);var t=Sa();n=Pd(n,e),n!==null&&(U1(n,e,t),nl(n,t))}function UPe(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),aq(n,t)}function zPe(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Ut(314))}i!==null&&i.delete(e),aq(n,t)}var lq;lq=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||el.current)qa=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return qa=!1,TPe(n,e,t);qa=!!(n.flags&131072)}else qa=!1,Lr&&e.flags&1048576&&dY(e,LI,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;K_(n,e),n=e.pendingProps;var s=wA(e,qo.current);hA(e,t),s=mF(null,e,i,n,s,t);var l=gF();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,tl(i)?(l=!0,kI(e)):l=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,uF(e),s.updater=kS,e.stateNode=s,s._reactInternals=e,FN(e,i,n,t),e=UN(null,e,i,!0,l,t)):(e.tag=0,Lr&&l&&iF(e),xa(null,e,s,t),e=e.child),e;case 16:i=e.elementType;e:{switch(K_(n,e),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=WPe(i),n=Kc(i,n),s){case 0:e=VN(null,e,i,n,t);break e;case 1:e=l$(null,e,i,n,t);break e;case 11:e=o$(null,e,i,n,t);break e;case 14:e=a$(null,e,i,Kc(i.type,n),t);break e}throw Error(Ut(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Kc(i,s),VN(n,e,i,s,t);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Kc(i,s),l$(n,e,i,s,t);case 3:e:{if(XY(e),n===null)throw Error(Ut(387));i=e.pendingProps,l=e.memoizedState,s=l.element,AY(n,e),NI(e,i,null,t);var u=e.memoizedState;if(i=u.element,l.isDehydrated)if(l={element:i,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){s=IA(Error(Ut(423)),e),e=c$(n,e,i,t,s);break e}else if(i!==s){s=IA(Error(Ut(424)),e),e=c$(n,e,i,t,s);break e}else for(Sl=fp(e.stateNode.containerInfo.firstChild),Tl=e,Lr=!0,jc=null,t=gY(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(CA(),i===s){e=Nd(n,e,t);break e}xa(n,e,i,t)}e=e.child}return e;case 5:return vY(e),n===null&&PN(e),i=e.type,s=e.pendingProps,l=n!==null?n.memoizedProps:null,u=s.children,MN(i,s)?u=null:l!==null&&MN(i,l)&&(e.flags|=32),HY(n,e),xa(n,e,u,t),e.child;case 6:return n===null&&PN(e),null;case 13:return $Y(n,e,t);case 4:return hF(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=EA(e,null,i,t):xa(n,e,i,t),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Kc(i,s),o$(n,e,i,s,t);case 7:return xa(n,e,e.pendingProps,t),e.child;case 8:return xa(n,e,e.pendingProps.children,t),e.child;case 12:return xa(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,l=e.memoizedProps,u=s.value,vr(BI,i._currentValue),i._currentValue=u,l!==null)if(su(l.value,u)){if(l.children===s.children&&!el.current){e=Nd(n,e,t);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var d=l.dependencies;if(d!==null){u=l.child;for(var p=d.firstContext;p!==null;){if(p.context===i){if(l.tag===1){p=Cd(-1,t&-t),p.tag=2;var g=l.updateQueue;if(g!==null){g=g.shared;var x=g.pending;x===null?p.next=p:(p.next=x.next,x.next=p),g.pending=p}}l.lanes|=t,p=l.alternate,p!==null&&(p.lanes|=t),NN(l.return,t,e),d.lanes|=t;break}p=p.next}}else if(l.tag===10)u=l.type===e.type?null:l.child;else if(l.tag===18){if(u=l.return,u===null)throw Error(Ut(341));u.lanes|=t,d=u.alternate,d!==null&&(d.lanes|=t),NN(u,t,e),u=l.sibling}else u=l.child;if(u!==null)u.return=l;else for(u=l;u!==null;){if(u===e){u=null;break}if(l=u.sibling,l!==null){l.return=u.return,u=l;break}u=u.return}l=u}xa(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,hA(e,t),s=pc(s),i=i(s),e.flags|=1,xa(n,e,i,t),e.child;case 14:return i=e.type,s=Kc(i,e.pendingProps),s=Kc(i.type,s),a$(n,e,i,s,t);case 15:return GY(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Kc(i,s),K_(n,e),e.tag=1,tl(i)?(n=!0,kI(e)):n=!1,hA(e,t),VY(e,i,s),FN(e,i,s,t),UN(null,e,i,!0,n,t);case 19:return QY(n,e,t);case 22:return WY(n,e,t)}throw Error(Ut(156,e.tag))};function cq(n,e){return D7(n,e)}function GPe(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function uc(n,e,t,i){return new GPe(n,e,t,i)}function IF(n){return n=n.prototype,!(!n||!n.isReactComponent)}function WPe(n){if(typeof n=="function")return IF(n)?1:0;if(n!=null){if(n=n.$$typeof,n===X3)return 11;if(n===$3)return 14}return 2}function yp(n,e){var t=n.alternate;return t===null?(t=uc(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Y_(n,e,t,i,s,l){var u=2;if(i=n,typeof n=="function")IF(n)&&(u=1);else if(typeof n=="string")u=5;else e:switch(n){case Oy:return Lg(t.children,s,l,e);case H3:u=8,s|=8;break;case aN:return n=uc(12,t,e,s|2),n.elementType=aN,n.lanes=l,n;case lN:return n=uc(13,t,e,s),n.elementType=lN,n.lanes=l,n;case cN:return n=uc(19,t,e,s),n.elementType=cN,n.lanes=l,n;case v7:return BS(t,s,l,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case y7:u=10;break e;case A7:u=9;break e;case X3:u=11;break e;case $3:u=14;break e;case Qf:u=16,i=null;break e}throw Error(Ut(130,n==null?n:typeof n,""))}return e=uc(u,t,e,s),e.elementType=n,e.type=i,e.lanes=l,e}function Lg(n,e,t,i){return n=uc(7,n,i,e),n.lanes=t,n}function BS(n,e,t,i){return n=uc(22,n,i,e),n.elementType=v7,n.lanes=t,n.stateNode={isHidden:!1},n}function VL(n,e,t){return n=uc(6,n,null,e),n.lanes=t,n}function UL(n,e,t){return e=uc(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function HPe(n,e,t,i,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=bL(0),this.expirationTimes=bL(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bL(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function SF(n,e,t,i,s,l,u,d,p){return n=new HPe(n,e,t,d,p),e===1?(e=1,l===!0&&(e|=8)):e=0,l=uc(3,null,null,e),n.current=l,l.stateNode=n,l.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},uF(l),n}function XPe(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fy,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function uq(n){if(!n)return Lp;n=n._reactInternals;e:{if(t0(n)!==n||n.tag!==1)throw Error(Ut(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(tl(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ut(171))}if(n.tag===1){var t=n.type;if(tl(t))return uY(n,t,e)}return e}function hq(n,e,t,i,s,l,u,d,p){return n=SF(t,i,!0,n,s,l,u,d,p),n.context=uq(null),t=n.current,i=Sa(),s=gp(t),l=Cd(i,s),l.callback=e??null,pp(t,l,s),n.current.lanes=s,U1(n,s,i),nl(n,i),n}function PS(n,e,t,i){var s=e.current,l=Sa(),u=gp(s);return t=uq(t),e.context===null?e.context=t:e.pendingContext=t,e=Cd(l,u),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=pp(s,e,u),n!==null&&(ru(n,s,u,l),X_(n,s,u)),u}function WI(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function v$(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function TF(n,e){v$(n,e),(n=n.alternate)&&v$(n,e)}function $Pe(){return null}var dq=typeof reportError=="function"?reportError:function(n){console.error(n)};function MF(n){this._internalRoot=n}NS.prototype.render=MF.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Ut(409));PS(n,e,null,null)};NS.prototype.unmount=MF.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Hg(function(){PS(null,n,null,null)}),e[Bd]=null}};function NS(n){this._internalRoot=n}NS.prototype.unstable_scheduleHydration=function(n){if(n){var e=W7();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Jf.length&&e!==0&&e<Jf[t].priority;t++);Jf.splice(t,0,n),t===0&&X7(n)}};function kF(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function DS(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function b$(){}function QPe(n,e,t,i,s){if(s){if(typeof i=="function"){var l=i;i=function(){var g=WI(u);l.call(g)}}var u=hq(e,i,n,0,null,!1,!1,"",b$);return n._reactRootContainer=u,n[Bd]=u.current,Xx(n.nodeType===8?n.parentNode:n),Hg(),u}for(;s=n.lastChild;)n.removeChild(s);if(typeof i=="function"){var d=i;i=function(){var g=WI(p);d.call(g)}}var p=SF(n,0,!1,null,null,!1,!1,"",b$);return n._reactRootContainer=p,n[Bd]=p.current,Xx(n.nodeType===8?n.parentNode:n),Hg(function(){PS(e,p,t,i)}),p}function FS(n,e,t,i,s){var l=t._reactRootContainer;if(l){var u=l;if(typeof s=="function"){var d=s;s=function(){var p=WI(u);d.call(p)}}PS(e,u,n,s)}else u=QPe(t,e,n,s,i);return WI(u)}z7=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=jb(e.pendingLanes);t!==0&&(Z3(e,t|1),nl(e,os()),!(Hi&6)&&(SA=os()+500,Zp()))}break;case 13:Hg(function(){var i=Pd(n,1);if(i!==null){var s=Sa();ru(i,n,1,s)}}),TF(n,1)}};j3=function(n){if(n.tag===13){var e=Pd(n,134217728);if(e!==null){var t=Sa();ru(e,n,134217728,t)}TF(n,134217728)}};G7=function(n){if(n.tag===13){var e=gp(n),t=Pd(n,e);if(t!==null){var i=Sa();ru(t,n,e,i)}TF(n,e)}};W7=function(){return nr};H7=function(n,e){var t=nr;try{return nr=n,e()}finally{nr=t}};vN=function(n,e,t){switch(e){case"input":if(dN(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var s=SS(i);if(!s)throw Error(Ut(90));x7(i),dN(i,s)}}}break;case"textarea":C7(n,t);break;case"select":e=t.value,e!=null&&aA(n,!!t.multiple,e,!1)}};k7=CF;R7=Hg;var KPe={usingClientEntryPoint:!1,Events:[G1,Gy,SS,T7,M7,CF]},xb={findFiberByHostInstance:wg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ZPe={bundleType:xb.bundleType,version:xb.version,rendererPackageName:xb.rendererPackageName,rendererConfig:xb.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$d.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=P7(n),n===null?null:n.stateNode},findFiberByHostInstance:xb.findFiberByHostInstance||$Pe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lE.isDisabled&&lE.supportsFiber)try{CS=lE.inject(ZPe),sh=lE}catch{}}Bl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KPe;Bl.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kF(e))throw Error(Ut(200));return XPe(n,e,null,t)};Bl.createRoot=function(n,e){if(!kF(n))throw Error(Ut(299));var t=!1,i="",s=dq;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=SF(n,1,!1,null,null,t,!1,i,s),n[Bd]=e.current,Xx(n.nodeType===8?n.parentNode:n),new MF(e)};Bl.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ut(188)):(n=Object.keys(n).join(","),Error(Ut(268,n)));return n=P7(e),n=n===null?null:n.stateNode,n};Bl.flushSync=function(n){return Hg(n)};Bl.hydrate=function(n,e,t){if(!DS(e))throw Error(Ut(200));return FS(null,n,e,!0,t)};Bl.hydrateRoot=function(n,e,t){if(!kF(n))throw Error(Ut(405));var i=t!=null&&t.hydratedSources||null,s=!1,l="",u=dq;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(u=t.onRecoverableError)),e=hq(e,null,n,1,t??null,s,!1,l,u),n[Bd]=e.current,Xx(n),i)for(n=0;n<i.length;n++)t=i[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new NS(e)};Bl.render=function(n,e,t){if(!DS(e))throw Error(Ut(200));return FS(null,n,e,!1,t)};Bl.unmountComponentAtNode=function(n){if(!DS(n))throw Error(Ut(40));return n._reactRootContainer?(Hg(function(){FS(null,null,n,!1,function(){n._reactRootContainer=null,n[Bd]=null})}),!0):!1};Bl.unstable_batchedUpdates=CF;Bl.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!DS(t))throw Error(Ut(200));if(n==null||n._reactInternals===void 0)throw Error(Ut(38));return FS(n,e,t,!1,i)};Bl.version="18.3.1-next-f1338f8080-20240426";function fq(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fq)}catch(n){console.error(n)}}fq(),f7.exports=Bl;var jPe=f7.exports,x$=jPe;sN.createRoot=x$.createRoot,sN.hydrateRoot=x$.hydrateRoot;/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function e1(){return e1=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},e1.apply(this,arguments)}var lp;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(lp||(lp={}));const w$="popstate";function YPe(n){n===void 0&&(n={});function e(s,l){let{pathname:u="/",search:d="",hash:p=""}=n0(s.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),qN("",{pathname:u,search:d,hash:p},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function t(s,l){let u=s.document.querySelector("base"),d="";if(u&&u.getAttribute("href")){let p=s.location.href,g=p.indexOf("#");d=g===-1?p:p.slice(0,g)}return d+"#"+(typeof l=="string"?l:HI(l))}function i(s,l){OS(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(l)+")")}return JPe(e,t,i,n)}function Vr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function OS(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function qPe(){return Math.random().toString(36).substr(2,8)}function C$(n,e){return{usr:n.state,key:n.key,idx:e}}function qN(n,e,t,i){return t===void 0&&(t=null),e1({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?n0(e):e,{state:t,key:e&&e.key||i||qPe()})}function HI(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function n0(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function JPe(n,e,t,i){i===void 0&&(i={});let{window:s=document.defaultView,v5Compat:l=!1}=i,u=s.history,d=lp.Pop,p=null,g=x();g==null&&(g=0,u.replaceState(e1({},u.state,{idx:g}),""));function x(){return(u.state||{idx:null}).idx}function b(){d=lp.Pop;let P=x(),k=P==null?null:P-g;g=P,p&&p({action:d,location:R.location,delta:k})}function E(P,k){d=lp.Push;let F=qN(R.location,P,k);t&&t(F,P),g=x()+1;let V=C$(F,g),G=R.createHref(F);try{u.pushState(V,"",G)}catch(q){if(q instanceof DOMException&&q.name==="DataCloneError")throw q;s.location.assign(G)}l&&p&&p({action:d,location:R.location,delta:1})}function S(P,k){d=lp.Replace;let F=qN(R.location,P,k);t&&t(F,P),g=x();let V=C$(F,g),G=R.createHref(F);u.replaceState(V,"",G),l&&p&&p({action:d,location:R.location,delta:0})}function M(P){let k=s.location.origin!=="null"?s.location.origin:s.location.href,F=typeof P=="string"?P:HI(P);return F=F.replace(/ $/,"%20"),Vr(k,"No window.location.(origin|href) available to create URL for href: "+F),new URL(F,k)}let R={get action(){return d},get location(){return n(s,u)},listen(P){if(p)throw new Error("A history only accepts one active listener");return s.addEventListener(w$,b),p=P,()=>{s.removeEventListener(w$,b),p=null}},createHref(P){return e(s,P)},createURL:M,encodeLocation(P){let k=M(P);return{pathname:k.pathname,search:k.search,hash:k.hash}},push:E,replace:S,go(P){return u.go(P)}};return R}var E$;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(E$||(E$={}));function eNe(n,e,t){return t===void 0&&(t="/"),tNe(n,e,t)}function tNe(n,e,t,i){let s=typeof e=="string"?n0(e):e,l=TA(s.pathname||"/",t);if(l==null)return null;let u=pq(n);nNe(u);let d=null;for(let p=0;d==null&&p<u.length;++p){let g=fNe(l);d=hNe(u[p],g)}return d}function pq(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let s=(l,u,d)=>{let p={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:u,route:l};p.relativePath.startsWith("/")&&(Vr(p.relativePath.startsWith(i),'Absolute route path "'+p.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),p.relativePath=p.relativePath.slice(i.length));let g=Ap([i,p.relativePath]),x=t.concat(p);l.children&&l.children.length>0&&(Vr(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+g+'".')),pq(l.children,e,x,g)),!(l.path==null&&!l.index)&&e.push({path:g,score:cNe(g,l.index),routesMeta:x})};return n.forEach((l,u)=>{var d;if(l.path===""||!((d=l.path)!=null&&d.includes("?")))s(l,u);else for(let p of mq(l.path))s(l,u,p)}),e}function mq(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),l=t.replace(/\?$/,"");if(i.length===0)return s?[l,""]:[l];let u=mq(i.join("/")),d=[];return d.push(...u.map(p=>p===""?l:[l,p].join("/"))),s&&d.push(...u),d.map(p=>n.startsWith("/")&&p===""?"/":p)}function nNe(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:uNe(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const iNe=/^:[\w-]+$/,rNe=3,sNe=2,oNe=1,aNe=10,lNe=-2,_$=n=>n==="*";function cNe(n,e){let t=n.split("/"),i=t.length;return t.some(_$)&&(i+=lNe),e&&(i+=sNe),t.filter(s=>!_$(s)).reduce((s,l)=>s+(iNe.test(l)?rNe:l===""?oNe:aNe),i)}function uNe(n,e){return n.length===e.length&&n.slice(0,-1).every((i,s)=>i===e[s])?n[n.length-1]-e[e.length-1]:0}function hNe(n,e,t){let{routesMeta:i}=n,s={},l="/",u=[];for(let d=0;d<i.length;++d){let p=i[d],g=d===i.length-1,x=l==="/"?e:e.slice(l.length)||"/",b=JN({path:p.relativePath,caseSensitive:p.caseSensitive,end:g},x),E=p.route;if(!b)return null;Object.assign(s,b.params),u.push({params:s,pathname:Ap([l,b.pathname]),pathnameBase:ANe(Ap([l,b.pathnameBase])),route:E}),b.pathnameBase!=="/"&&(l=Ap([l,b.pathnameBase]))}return u}function JN(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=dNe(n.path,n.caseSensitive,n.end),s=e.match(t);if(!s)return null;let l=s[0],u=l.replace(/(.)\/+$/,"$1"),d=s.slice(1);return{params:i.reduce((g,x,b)=>{let{paramName:E,isOptional:S}=x;if(E==="*"){let R=d[b]||"";u=l.slice(0,l.length-R.length).replace(/(.)\/+$/,"$1")}const M=d[b];return S&&!M?g[E]=void 0:g[E]=(M||"").replace(/%2F/g,"/"),g},{}),pathname:l,pathnameBase:u,pattern:n}}function dNe(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),OS(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],s="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,d,p)=>(i.push({paramName:d,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),s+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":n!==""&&n!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function fNe(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return OS(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function TA(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}const pNe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,mNe=n=>pNe.test(n);function gNe(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:s=""}=typeof n=="string"?n0(n):n,l;if(t)if(mNe(t))l=t;else{if(t.includes("//")){let u=t;t=t.replace(/\/\/+/g,"/"),OS(!1,"Pathnames cannot have embedded double slashes - normalizing "+(u+" -> "+t))}t.startsWith("/")?l=I$(t.substring(1),"/"):l=I$(t,e)}else l=e;return{pathname:l,search:vNe(i),hash:bNe(s)}}function I$(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function zL(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function yNe(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function RF(n,e){let t=yNe(n);return e?t.map((i,s)=>s===t.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function LF(n,e,t,i){i===void 0&&(i=!1);let s;typeof n=="string"?s=n0(n):(s=e1({},n),Vr(!s.pathname||!s.pathname.includes("?"),zL("?","pathname","search",s)),Vr(!s.pathname||!s.pathname.includes("#"),zL("#","pathname","hash",s)),Vr(!s.search||!s.search.includes("#"),zL("#","search","hash",s)));let l=n===""||s.pathname==="",u=l?"/":s.pathname,d;if(u==null)d=t;else{let b=e.length-1;if(!i&&u.startsWith("..")){let E=u.split("/");for(;E[0]==="..";)E.shift(),b-=1;s.pathname=E.join("/")}d=b>=0?e[b]:"/"}let p=gNe(s,d),g=u&&u!=="/"&&u.endsWith("/"),x=(l||u===".")&&t.endsWith("/");return!p.pathname.endsWith("/")&&(g||x)&&(p.pathname+="/"),p}const Ap=n=>n.join("/").replace(/\/\/+/g,"/"),ANe=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),vNe=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,bNe=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function xNe(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const gq=["post","put","patch","delete"];new Set(gq);const wNe=["get",...gq];new Set(wNe);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function t1(){return t1=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},t1.apply(this,arguments)}const VS=Le.createContext(null),yq=Le.createContext(null),Qd=Le.createContext(null),US=Le.createContext(null),jp=Le.createContext({outlet:null,matches:[],isDataRoute:!1}),Aq=Le.createContext(null);function CNe(n,e){let{relative:t}=e===void 0?{}:e;$A()||Vr(!1);let{basename:i,navigator:s}=Le.useContext(Qd),{hash:l,pathname:u,search:d}=zS(n,{relative:t}),p=u;return i!=="/"&&(p=u==="/"?i:Ap([i,u])),s.createHref({pathname:p,search:d,hash:l})}function $A(){return Le.useContext(US)!=null}function i0(){return $A()||Vr(!1),Le.useContext(US).location}function vq(n){Le.useContext(Qd).static||Le.useLayoutEffect(n)}function H1(){let{isDataRoute:n}=Le.useContext(jp);return n?DNe():ENe()}function ENe(){$A()||Vr(!1);let n=Le.useContext(VS),{basename:e,future:t,navigator:i}=Le.useContext(Qd),{matches:s}=Le.useContext(jp),{pathname:l}=i0(),u=JSON.stringify(RF(s,t.v7_relativeSplatPath)),d=Le.useRef(!1);return vq(()=>{d.current=!0}),Le.useCallback(function(g,x){if(x===void 0&&(x={}),!d.current)return;if(typeof g=="number"){i.go(g);return}let b=LF(g,JSON.parse(u),l,x.relative==="path");n==null&&e!=="/"&&(b.pathname=b.pathname==="/"?e:Ap([e,b.pathname])),(x.replace?i.replace:i.push)(b,x.state,x)},[e,i,u,l,n])}function zS(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=Le.useContext(Qd),{matches:s}=Le.useContext(jp),{pathname:l}=i0(),u=JSON.stringify(RF(s,i.v7_relativeSplatPath));return Le.useMemo(()=>LF(n,JSON.parse(u),l,t==="path"),[n,u,l,t])}function _Ne(n,e){return INe(n,e)}function INe(n,e,t,i){$A()||Vr(!1);let{navigator:s}=Le.useContext(Qd),{matches:l}=Le.useContext(jp),u=l[l.length-1],d=u?u.params:{};u&&u.pathname;let p=u?u.pathnameBase:"/";u&&u.route;let g=i0(),x;if(e){var b;let P=typeof e=="string"?n0(e):e;p==="/"||(b=P.pathname)!=null&&b.startsWith(p)||Vr(!1),x=P}else x=g;let E=x.pathname||"/",S=E;if(p!=="/"){let P=p.replace(/^\//,"").split("/");S="/"+E.replace(/^\//,"").split("/").slice(P.length).join("/")}let M=eNe(n,{pathname:S}),R=RNe(M&&M.map(P=>Object.assign({},P,{params:Object.assign({},d,P.params),pathname:Ap([p,s.encodeLocation?s.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?p:Ap([p,s.encodeLocation?s.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),l,t,i);return e&&R?Le.createElement(US.Provider,{value:{location:t1({pathname:"/",search:"",hash:"",state:null,key:"default"},x),navigationType:lp.Pop}},R):R}function SNe(){let n=NNe(),e=xNe(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Le.createElement(Le.Fragment,null,Le.createElement("h2",null,"Unexpected Application Error!"),Le.createElement("h3",{style:{fontStyle:"italic"}},e),t?Le.createElement("pre",{style:s},t):null,null)}const TNe=Le.createElement(SNe,null);class MNe extends Le.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Le.createElement(jp.Provider,{value:this.props.routeContext},Le.createElement(Aq.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function kNe(n){let{routeContext:e,match:t,children:i}=n,s=Le.useContext(VS);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),Le.createElement(jp.Provider,{value:e},i)}function RNe(n,e,t,i){var s;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var l;if(!t)return null;if(t.errors)n=t.matches;else if((l=i)!=null&&l.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let u=n,d=(s=t)==null?void 0:s.errors;if(d!=null){let x=u.findIndex(b=>b.route.id&&(d==null?void 0:d[b.route.id])!==void 0);x>=0||Vr(!1),u=u.slice(0,Math.min(u.length,x+1))}let p=!1,g=-1;if(t&&i&&i.v7_partialHydration)for(let x=0;x<u.length;x++){let b=u[x];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(g=x),b.route.id){let{loaderData:E,errors:S}=t,M=b.route.loader&&E[b.route.id]===void 0&&(!S||S[b.route.id]===void 0);if(b.route.lazy||M){p=!0,g>=0?u=u.slice(0,g+1):u=[u[0]];break}}}return u.reduceRight((x,b,E)=>{let S,M=!1,R=null,P=null;t&&(S=d&&b.route.id?d[b.route.id]:void 0,R=b.route.errorElement||TNe,p&&(g<0&&E===0?(FNe("route-fallback"),M=!0,P=null):g===E&&(M=!0,P=b.route.hydrateFallbackElement||null)));let k=e.concat(u.slice(0,E+1)),F=()=>{let V;return S?V=R:M?V=P:b.route.Component?V=Le.createElement(b.route.Component,null):b.route.element?V=b.route.element:V=x,Le.createElement(kNe,{match:b,routeContext:{outlet:x,matches:k,isDataRoute:t!=null},children:V})};return t&&(b.route.ErrorBoundary||b.route.errorElement||E===0)?Le.createElement(MNe,{location:t.location,revalidation:t.revalidation,component:R,error:S,children:F(),routeContext:{outlet:null,matches:k,isDataRoute:!0}}):F()},null)}var bq=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(bq||{}),xq=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(xq||{});function LNe(n){let e=Le.useContext(VS);return e||Vr(!1),e}function BNe(n){let e=Le.useContext(yq);return e||Vr(!1),e}function PNe(n){let e=Le.useContext(jp);return e||Vr(!1),e}function wq(n){let e=PNe(),t=e.matches[e.matches.length-1];return t.route.id||Vr(!1),t.route.id}function NNe(){var n;let e=Le.useContext(Aq),t=BNe(),i=wq();return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function DNe(){let{router:n}=LNe(bq.UseNavigateStable),e=wq(xq.UseNavigateStable),t=Le.useRef(!1);return vq(()=>{t.current=!0}),Le.useCallback(function(s,l){l===void 0&&(l={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,t1({fromRouteId:e},l)))},[n,e])}const S$={};function FNe(n,e,t){S$[n]||(S$[n]=!0)}function ONe(n,e){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function Cq(n){let{to:e,replace:t,state:i,relative:s}=n;$A()||Vr(!1);let{future:l,static:u}=Le.useContext(Qd),{matches:d}=Le.useContext(jp),{pathname:p}=i0(),g=H1(),x=LF(e,RF(d,l.v7_relativeSplatPath),p,s==="path"),b=JSON.stringify(x);return Le.useEffect(()=>g(JSON.parse(b),{replace:t,state:i,relative:s}),[g,b,s,t,i]),null}function fg(n){Vr(!1)}function VNe(n){let{basename:e="/",children:t=null,location:i,navigationType:s=lp.Pop,navigator:l,static:u=!1,future:d}=n;$A()&&Vr(!1);let p=e.replace(/^\/*/,"/"),g=Le.useMemo(()=>({basename:p,navigator:l,static:u,future:t1({v7_relativeSplatPath:!1},d)}),[p,d,l,u]);typeof i=="string"&&(i=n0(i));let{pathname:x="/",search:b="",hash:E="",state:S=null,key:M="default"}=i,R=Le.useMemo(()=>{let P=TA(x,p);return P==null?null:{location:{pathname:P,search:b,hash:E,state:S,key:M},navigationType:s}},[p,x,b,E,S,M,s]);return R==null?null:Le.createElement(Qd.Provider,{value:g},Le.createElement(US.Provider,{children:t,value:R}))}function UNe(n){let{children:e,location:t}=n;return _Ne(eD(e),t)}new Promise(()=>{});function eD(n,e){e===void 0&&(e=[]);let t=[];return Le.Children.forEach(n,(i,s)=>{if(!Le.isValidElement(i))return;let l=[...e,s];if(i.type===Le.Fragment){t.push.apply(t,eD(i.props.children,l));return}i.type!==fg&&Vr(!1),!i.props.index||!i.props.children||Vr(!1);let u={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(u.children=eD(i.props.children,l)),t.push(u)}),t}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function XI(){return XI=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},XI.apply(this,arguments)}function Eq(n,e){if(n==null)return{};var t={},i=Object.keys(n),s,l;for(l=0;l<i.length;l++)s=i[l],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function zNe(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function GNe(n,e){return n.button===0&&(!e||e==="_self")&&!zNe(n)}const WNe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],HNe=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],XNe="6";try{window.__reactRouterVersion=XNe}catch{}const $Ne=Le.createContext({isTransitioning:!1}),QNe="startTransition",T$=VLe[QNe];function KNe(n){let{basename:e,children:t,future:i,window:s}=n,l=Le.useRef();l.current==null&&(l.current=YPe({window:s,v5Compat:!0}));let u=l.current,[d,p]=Le.useState({action:u.action,location:u.location}),{v7_startTransition:g}=i||{},x=Le.useCallback(b=>{g&&T$?T$(()=>p(b)):p(b)},[p,g]);return Le.useLayoutEffect(()=>u.listen(x),[u,x]),Le.useEffect(()=>ONe(i),[i]),Le.createElement(VNe,{basename:e,children:t,location:d.location,navigationType:d.action,navigator:u,future:i})}const ZNe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jNe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,YNe=Le.forwardRef(function(e,t){let{onClick:i,relative:s,reloadDocument:l,replace:u,state:d,target:p,to:g,preventScrollReset:x,viewTransition:b}=e,E=Eq(e,WNe),{basename:S}=Le.useContext(Qd),M,R=!1;if(typeof g=="string"&&jNe.test(g)&&(M=g,ZNe))try{let V=new URL(window.location.href),G=g.startsWith("//")?new URL(V.protocol+g):new URL(g),q=TA(G.pathname,S);G.origin===V.origin&&q!=null?g=q+G.search+G.hash:R=!0}catch{}let P=CNe(g,{relative:s}),k=eDe(g,{replace:u,state:d,target:p,preventScrollReset:x,relative:s,viewTransition:b});function F(V){i&&i(V),V.defaultPrevented||k(V)}return Le.createElement("a",XI({},E,{href:M||P,onClick:R||l?i:F,ref:t,target:p}))}),qNe=Le.forwardRef(function(e,t){let{"aria-current":i="page",caseSensitive:s=!1,className:l="",end:u=!1,style:d,to:p,viewTransition:g,children:x}=e,b=Eq(e,HNe),E=zS(p,{relative:b.relative}),S=i0(),M=Le.useContext(yq),{navigator:R,basename:P}=Le.useContext(Qd),k=M!=null&&tDe(E)&&g===!0,F=R.encodeLocation?R.encodeLocation(E).pathname:E.pathname,V=S.pathname,G=M&&M.navigation&&M.navigation.location?M.navigation.location.pathname:null;s||(V=V.toLowerCase(),G=G?G.toLowerCase():null,F=F.toLowerCase()),G&&P&&(G=TA(G,P)||G);const q=F!=="/"&&F.endsWith("/")?F.length-1:F.length;let ne=V===F||!u&&V.startsWith(F)&&V.charAt(q)==="/",K=G!=null&&(G===F||!u&&G.startsWith(F)&&G.charAt(F.length)==="/"),Q={isActive:ne,isPending:K,isTransitioning:k},H=ne?i:void 0,j;typeof l=="function"?j=l(Q):j=[l,ne?"active":null,K?"pending":null,k?"transitioning":null].filter(Boolean).join(" ");let ee=typeof d=="function"?d(Q):d;return Le.createElement(YNe,XI({},b,{"aria-current":H,className:j,ref:t,style:ee,to:p,viewTransition:g}),typeof x=="function"?x(Q):x)});var tD;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(tD||(tD={}));var M$;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(M$||(M$={}));function JNe(n){let e=Le.useContext(VS);return e||Vr(!1),e}function eDe(n,e){let{target:t,replace:i,state:s,preventScrollReset:l,relative:u,viewTransition:d}=e===void 0?{}:e,p=H1(),g=i0(),x=zS(n,{relative:u});return Le.useCallback(b=>{if(GNe(b,t)){b.preventDefault();let E=i!==void 0?i:HI(g)===HI(x);p(n,{replace:E,state:s,preventScrollReset:l,relative:u,viewTransition:d})}},[g,p,x,i,s,t,n,l,u,d])}function tDe(n,e){e===void 0&&(e={});let t=Le.useContext($Ne);t==null&&Vr(!1);let{basename:i}=JNe(tD.useViewTransitionState),s=zS(n,{relative:e.relative});if(!t.isTransitioning)return!1;let l=TA(t.currentLocation.pathname,i)||t.currentLocation.pathname,u=TA(t.nextLocation.pathname,i)||t.nextLocation.pathname;return JN(s.pathname,u)!=null||JN(s.pathname,l)!=null}const _q=Le.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"}),GS=Le.createContext({}),WS=Le.createContext(null),HS=typeof document<"u",BF=HS?Le.useLayoutEffect:Le.useEffect,Iq=Le.createContext({strict:!1}),PF=n=>n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),nDe="framerAppearId",Sq="data-"+PF(nDe);function iDe(n,e,t,i){const{visualElement:s}=Le.useContext(GS),l=Le.useContext(Iq),u=Le.useContext(WS),d=Le.useContext(_q).reducedMotion,p=Le.useRef();i=i||l.renderer,!p.current&&i&&(p.current=i(n,{visualState:e,parent:s,props:t,presenceContext:u,blockInitialAnimation:u?u.initial===!1:!1,reducedMotionConfig:d}));const g=p.current;Le.useInsertionEffect(()=>{g&&g.update(t,u)});const x=Le.useRef(!!(t[Sq]&&!window.HandoffComplete));return BF(()=>{g&&(g.render(),x.current&&g.animationState&&g.animationState.animateChanges())}),Le.useEffect(()=>{g&&(g.updateFeatures(),!x.current&&g.animationState&&g.animationState.animateChanges(),x.current&&(x.current=!1,window.HandoffComplete=!0))}),g}function Zy(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function rDe(n,e,t){return Le.useCallback(i=>{i&&n.mount&&n.mount(i),e&&(i?e.mount(i):e.unmount()),t&&(typeof t=="function"?t(i):Zy(t)&&(t.current=i))},[e])}function n1(n){return typeof n=="string"||Array.isArray(n)}function XS(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const NF=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],DF=["initial",...NF];function $S(n){return XS(n.animate)||DF.some(e=>n1(n[e]))}function Tq(n){return!!($S(n)||n.variants)}function sDe(n,e){if($S(n)){const{initial:t,animate:i}=n;return{initial:t===!1||n1(t)?t:void 0,animate:n1(i)?i:void 0}}return n.inherit!==!1?e:{}}function oDe(n){const{initial:e,animate:t}=sDe(n,Le.useContext(GS));return Le.useMemo(()=>({initial:e,animate:t}),[k$(e),k$(t)])}function k$(n){return Array.isArray(n)?n.join(" "):n}const R$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},i1={};for(const n in R$)i1[n]={isEnabled:e=>R$[n].some(t=>!!e[t])};function aDe(n){for(const e in n)i1[e]={...i1[e],...n[e]}}const FF=Le.createContext({}),Mq=Le.createContext({}),lDe=Symbol.for("motionComponentSymbol");function cDe({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:i,Component:s}){n&&aDe(n);function l(d,p){let g;const x={...Le.useContext(_q),...d,layoutId:uDe(d)},{isStatic:b}=x,E=oDe(d),S=i(d,b);if(!b&&HS){E.visualElement=iDe(s,S,x,e);const M=Le.useContext(Mq),R=Le.useContext(Iq).strict;E.visualElement&&(g=E.visualElement.loadFeatures(x,R,n,M))}return Le.createElement(GS.Provider,{value:E},g&&E.visualElement?Le.createElement(g,{visualElement:E.visualElement,...x}):null,t(s,d,rDe(S,E.visualElement,p),S,b,E.visualElement))}const u=Le.forwardRef(l);return u[lDe]=s,u}function uDe({layoutId:n}){const e=Le.useContext(FF).id;return e&&n!==void 0?e+"-"+n:n}function hDe(n){function e(i,s={}){return cDe(n(i,s))}if(typeof Proxy>"u")return e;const t=new Map;return new Proxy(e,{get:(i,s)=>(t.has(s)||t.set(s,e(s)),t.get(s))})}const dDe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function OF(n){return typeof n!="string"||n.includes("-")?!1:!!(dDe.indexOf(n)>-1||/[A-Z]/.test(n))}const $I={};function fDe(n){Object.assign($I,n)}const X1=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],r0=new Set(X1);function kq(n,{layout:e,layoutId:t}){return r0.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!$I[n]||n==="opacity")}const rl=n=>!!(n&&n.getVelocity),pDe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},mDe=X1.length;function gDe(n,{enableHardwareAcceleration:e=!0,allowTransformNone:t=!0},i,s){let l="";for(let u=0;u<mDe;u++){const d=X1[u];if(n[d]!==void 0){const p=pDe[d]||d;l+=`${p}(${n[d]}) `}}return e&&!n.z&&(l+="translateZ(0)"),l=l.trim(),s?l=s(n,i?"":l):t&&i&&(l="none"),l}const Rq=n=>e=>typeof e=="string"&&e.startsWith(n),Lq=Rq("--"),nD=Rq("var(--"),yDe=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,ADe=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Bp=(n,e,t)=>Math.min(Math.max(t,n),e),s0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},gx={...s0,transform:n=>Bp(0,1,n)},cE={...s0,default:1},yx=n=>Math.round(n*1e5)/1e5,QS=/(-)?([\d]*\.?[\d])+/g,Bq=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,vDe=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function $1(n){return typeof n=="string"}const Q1=n=>({test:e=>$1(e)&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),$f=Q1("deg"),ah=Q1("%"),Qn=Q1("px"),bDe=Q1("vh"),xDe=Q1("vw"),L$={...ah,parse:n=>ah.parse(n)/100,transform:n=>ah.transform(n*100)},B$={...s0,transform:Math.round},Pq={borderWidth:Qn,borderTopWidth:Qn,borderRightWidth:Qn,borderBottomWidth:Qn,borderLeftWidth:Qn,borderRadius:Qn,radius:Qn,borderTopLeftRadius:Qn,borderTopRightRadius:Qn,borderBottomRightRadius:Qn,borderBottomLeftRadius:Qn,width:Qn,maxWidth:Qn,height:Qn,maxHeight:Qn,size:Qn,top:Qn,right:Qn,bottom:Qn,left:Qn,padding:Qn,paddingTop:Qn,paddingRight:Qn,paddingBottom:Qn,paddingLeft:Qn,margin:Qn,marginTop:Qn,marginRight:Qn,marginBottom:Qn,marginLeft:Qn,rotate:$f,rotateX:$f,rotateY:$f,rotateZ:$f,scale:cE,scaleX:cE,scaleY:cE,scaleZ:cE,skew:$f,skewX:$f,skewY:$f,distance:Qn,translateX:Qn,translateY:Qn,translateZ:Qn,x:Qn,y:Qn,z:Qn,perspective:Qn,transformPerspective:Qn,opacity:gx,originX:L$,originY:L$,originZ:Qn,zIndex:B$,fillOpacity:gx,strokeOpacity:gx,numOctaves:B$};function VF(n,e,t,i){const{style:s,vars:l,transform:u,transformOrigin:d}=n;let p=!1,g=!1,x=!0;for(const b in e){const E=e[b];if(Lq(b)){l[b]=E;continue}const S=Pq[b],M=ADe(E,S);if(r0.has(b)){if(p=!0,u[b]=M,!x)continue;E!==(S.default||0)&&(x=!1)}else b.startsWith("origin")?(g=!0,d[b]=M):s[b]=M}if(e.transform||(p||i?s.transform=gDe(n.transform,t,x,i):s.transform&&(s.transform="none")),g){const{originX:b="50%",originY:E="50%",originZ:S=0}=d;s.transformOrigin=`${b} ${E} ${S}`}}const UF=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Nq(n,e,t){for(const i in e)!rl(e[i])&&!kq(i,t)&&(n[i]=e[i])}function wDe({transformTemplate:n},e,t){return Le.useMemo(()=>{const i=UF();return VF(i,e,{enableHardwareAcceleration:!t},n),Object.assign({},i.vars,i.style)},[e])}function CDe(n,e,t){const i=n.style||{},s={};return Nq(s,i,n),Object.assign(s,wDe(n,e,t)),n.transformValues?n.transformValues(s):s}function EDe(n,e,t){const i={},s=CDe(n,e,t);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=s,i}const _De=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function QI(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||_De.has(n)}let Dq=n=>!QI(n);function IDe(n){n&&(Dq=e=>e.startsWith("on")?!QI(e):n(e))}try{IDe(require("@emotion/is-prop-valid").default)}catch{}function SDe(n,e,t){const i={};for(const s in n)s==="values"&&typeof n.values=="object"||(Dq(s)||t===!0&&QI(s)||!e&&!QI(s)||n.draggable&&s.startsWith("onDrag"))&&(i[s]=n[s]);return i}function P$(n,e,t){return typeof n=="string"?n:Qn.transform(e+t*n)}function TDe(n,e,t){const i=P$(e,n.x,n.width),s=P$(t,n.y,n.height);return`${i} ${s}`}const MDe={offset:"stroke-dashoffset",array:"stroke-dasharray"},kDe={offset:"strokeDashoffset",array:"strokeDasharray"};function RDe(n,e,t=1,i=0,s=!0){n.pathLength=1;const l=s?MDe:kDe;n[l.offset]=Qn.transform(-i);const u=Qn.transform(e),d=Qn.transform(t);n[l.array]=`${u} ${d}`}function zF(n,{attrX:e,attrY:t,attrScale:i,originX:s,originY:l,pathLength:u,pathSpacing:d=1,pathOffset:p=0,...g},x,b,E){if(VF(n,g,x,E),b){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:S,style:M,dimensions:R}=n;S.transform&&(R&&(M.transform=S.transform),delete S.transform),R&&(s!==void 0||l!==void 0||M.transform)&&(M.transformOrigin=TDe(R,s!==void 0?s:.5,l!==void 0?l:.5)),e!==void 0&&(S.x=e),t!==void 0&&(S.y=t),i!==void 0&&(S.scale=i),u!==void 0&&RDe(S,u,d,p,!1)}const Fq=()=>({...UF(),attrs:{}}),GF=n=>typeof n=="string"&&n.toLowerCase()==="svg";function LDe(n,e,t,i){const s=Le.useMemo(()=>{const l=Fq();return zF(l,e,{enableHardwareAcceleration:!1},GF(i),n.transformTemplate),{...l.attrs,style:{...l.style}}},[e]);if(n.style){const l={};Nq(l,n.style,n),s.style={...l,...s.style}}return s}function BDe(n=!1){return(t,i,s,{latestValues:l},u)=>{const p=(OF(t)?LDe:EDe)(i,l,u,t),x={...SDe(i,typeof t=="string",n),...p,ref:s},{children:b}=i,E=Le.useMemo(()=>rl(b)?b.get():b,[b]);return Le.createElement(t,{...x,children:E})}}function Oq(n,{style:e,vars:t},i,s){Object.assign(n.style,e,s&&s.getProjectionStyles(i));for(const l in t)n.style.setProperty(l,t[l])}const Vq=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Uq(n,e,t,i){Oq(n,e,void 0,i);for(const s in e.attrs)n.setAttribute(Vq.has(s)?s:PF(s),e.attrs[s])}function WF(n,e){const{style:t}=n,i={};for(const s in t)(rl(t[s])||e.style&&rl(e.style[s])||kq(s,n))&&(i[s]=t[s]);return i}function zq(n,e){const t=WF(n,e);for(const i in n)if(rl(n[i])||rl(e[i])){const s=X1.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;t[s]=n[i]}return t}function HF(n,e,t,i={},s={}){return typeof e=="function"&&(e=e(t!==void 0?t:n.custom,i,s)),typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"&&(e=e(t!==void 0?t:n.custom,i,s)),e}function Gq(n){const e=Le.useRef(null);return e.current===null&&(e.current=n()),e.current}const KI=n=>Array.isArray(n),PDe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),NDe=n=>KI(n)?n[n.length-1]||0:n;function q_(n){const e=rl(n)?n.get():n;return PDe(e)?e.toValue():e}function DDe({scrapeMotionValuesFromProps:n,createRenderState:e,onMount:t},i,s,l){const u={latestValues:FDe(i,s,l,n),renderState:e()};return t&&(u.mount=d=>t(i,d,u)),u}const Wq=n=>(e,t)=>{const i=Le.useContext(GS),s=Le.useContext(WS),l=()=>DDe(n,e,i,s);return t?l():Gq(l)};function FDe(n,e,t,i){const s={},l=i(n,{});for(const E in l)s[E]=q_(l[E]);let{initial:u,animate:d}=n;const p=$S(n),g=Tq(n);e&&g&&!p&&n.inherit!==!1&&(u===void 0&&(u=e.initial),d===void 0&&(d=e.animate));let x=t?t.initial===!1:!1;x=x||u===!1;const b=x?d:u;return b&&typeof b!="boolean"&&!XS(b)&&(Array.isArray(b)?b:[b]).forEach(S=>{const M=HF(n,S);if(!M)return;const{transitionEnd:R,transition:P,...k}=M;for(const F in k){let V=k[F];if(Array.isArray(V)){const G=x?V.length-1:0;V=V[G]}V!==null&&(s[F]=V)}for(const F in R)s[F]=R[F]}),s}const cs=n=>n;class N${constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const t=this.order.indexOf(e);t!==-1&&(this.order.splice(t,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function ODe(n){let e=new N$,t=new N$,i=0,s=!1,l=!1;const u=new WeakSet,d={schedule:(p,g=!1,x=!1)=>{const b=x&&s,E=b?e:t;return g&&u.add(p),E.add(p)&&b&&s&&(i=e.order.length),p},cancel:p=>{t.remove(p),u.delete(p)},process:p=>{if(s){l=!0;return}if(s=!0,[e,t]=[t,e],t.clear(),i=e.order.length,i)for(let g=0;g<i;g++){const x=e.order[g];x(p),u.has(x)&&(d.schedule(x),n())}s=!1,l&&(l=!1,d.process(p))}};return d}const uE=["prepare","read","update","preRender","render","postRender"],VDe=40;function UDe(n,e){let t=!1,i=!0;const s={delta:0,timestamp:0,isProcessing:!1},l=uE.reduce((b,E)=>(b[E]=ODe(()=>t=!0),b),{}),u=b=>l[b].process(s),d=()=>{const b=performance.now();t=!1,s.delta=i?1e3/60:Math.max(Math.min(b-s.timestamp,VDe),1),s.timestamp=b,s.isProcessing=!0,uE.forEach(u),s.isProcessing=!1,t&&e&&(i=!1,n(d))},p=()=>{t=!0,i=!0,s.isProcessing||n(d)};return{schedule:uE.reduce((b,E)=>{const S=l[E];return b[E]=(M,R=!1,P=!1)=>(t||p(),S.schedule(M,R,P)),b},{}),cancel:b=>uE.forEach(E=>l[E].cancel(b)),state:s,steps:l}}const{schedule:br,cancel:Dd,state:Qo,steps:GL}=UDe(typeof requestAnimationFrame<"u"?requestAnimationFrame:cs,!0),zDe={useVisualState:Wq({scrapeMotionValuesFromProps:zq,createRenderState:Fq,onMount:(n,e,{renderState:t,latestValues:i})=>{br.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),br.render(()=>{zF(t,i,{enableHardwareAcceleration:!1},GF(e.tagName),n.transformTemplate),Uq(e,t)})}})},GDe={useVisualState:Wq({scrapeMotionValuesFromProps:WF,createRenderState:UF})};function WDe(n,{forwardMotionProps:e=!1},t,i){return{...OF(n)?zDe:GDe,preloadedFeatures:t,useRender:BDe(e),createVisualElement:i,Component:n}}function gd(n,e,t,i={passive:!0}){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t)}const Hq=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function KS(n,e="page"){return{point:{x:n[e+"X"],y:n[e+"Y"]}}}const HDe=n=>e=>Hq(e)&&n(e,KS(e));function Ed(n,e,t,i){return gd(n,e,HDe(t),i)}const XDe=(n,e)=>t=>e(n(t)),vp=(...n)=>n.reduce(XDe);function Xq(n){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=n,t):!1}}const D$=Xq("dragHorizontal"),F$=Xq("dragVertical");function $q(n){let e=!1;if(n==="y")e=F$();else if(n==="x")e=D$();else{const t=D$(),i=F$();t&&i?e=()=>{t(),i()}:(t&&t(),i&&i())}return e}function Qq(){const n=$q(!0);return n?(n(),!1):!0}class Yp{constructor(e){this.isMounted=!1,this.node=e}update(){}}function O$(n,e){const t="pointer"+(e?"enter":"leave"),i="onHover"+(e?"Start":"End"),s=(l,u)=>{if(l.pointerType==="touch"||Qq())return;const d=n.getProps();n.animationState&&d.whileHover&&n.animationState.setActive("whileHover",e),d[i]&&br.update(()=>d[i](l,u))};return Ed(n.current,t,s,{passive:!n.getProps()[i]})}class $De extends Yp{mount(){this.unmount=vp(O$(this.node,!0),O$(this.node,!1))}unmount(){}}class QDe extends Yp{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=vp(gd(this.node.current,"focus",()=>this.onFocus()),gd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const Kq=(n,e)=>e?n===e?!0:Kq(n,e.parentElement):!1;function WL(n,e){if(!e)return;const t=new PointerEvent("pointer"+n);e(t,KS(t))}class KDe extends Yp{constructor(){super(...arguments),this.removeStartListeners=cs,this.removeEndListeners=cs,this.removeAccessibleListeners=cs,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const i=this.node.getProps(),l=Ed(window,"pointerup",(d,p)=>{if(!this.checkPressEnd())return;const{onTap:g,onTapCancel:x,globalTapTarget:b}=this.node.getProps();br.update(()=>{!b&&!Kq(this.node.current,d.target)?x&&x(d,p):g&&g(d,p)})},{passive:!(i.onTap||i.onPointerUp)}),u=Ed(window,"pointercancel",(d,p)=>this.cancelPress(d,p),{passive:!(i.onTapCancel||i.onPointerCancel)});this.removeEndListeners=vp(l,u),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=l=>{if(l.key!=="Enter"||this.isPressing)return;const u=d=>{d.key!=="Enter"||!this.checkPressEnd()||WL("up",(p,g)=>{const{onTap:x}=this.node.getProps();x&&br.update(()=>x(p,g))})};this.removeEndListeners(),this.removeEndListeners=gd(this.node.current,"keyup",u),WL("down",(d,p)=>{this.startPress(d,p)})},t=gd(this.node.current,"keydown",e),i=()=>{this.isPressing&&WL("cancel",(l,u)=>this.cancelPress(l,u))},s=gd(this.node.current,"blur",i);this.removeAccessibleListeners=vp(t,s)}}startPress(e,t){this.isPressing=!0;const{onTapStart:i,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),i&&br.update(()=>i(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!Qq()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:i}=this.node.getProps();i&&br.update(()=>i(e,t))}mount(){const e=this.node.getProps(),t=Ed(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),i=gd(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=vp(t,i)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const iD=new WeakMap,HL=new WeakMap,ZDe=n=>{const e=iD.get(n.target);e&&e(n)},jDe=n=>{n.forEach(ZDe)};function YDe({root:n,...e}){const t=n||document;HL.has(t)||HL.set(t,{});const i=HL.get(t),s=JSON.stringify(e);return i[s]||(i[s]=new IntersectionObserver(jDe,{root:n,...e})),i[s]}function qDe(n,e,t){const i=YDe(e);return iD.set(n,t),i.observe(n),()=>{iD.delete(n),i.unobserve(n)}}const JDe={some:0,all:1};class e3e extends Yp{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:i,amount:s="some",once:l}=e,u={root:t?t.current:void 0,rootMargin:i,threshold:typeof s=="number"?s:JDe[s]},d=p=>{const{isIntersecting:g}=p;if(this.isInView===g||(this.isInView=g,l&&!g&&this.hasEnteredView))return;g&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",g);const{onViewportEnter:x,onViewportLeave:b}=this.node.getProps(),E=g?x:b;E&&E(p)};return qDe(this.node.current,u,d)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(t3e(e,t))&&this.startObserver()}unmount(){}}function t3e({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const n3e={inView:{Feature:e3e},tap:{Feature:KDe},focus:{Feature:QDe},hover:{Feature:$De}};function Zq(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let i=0;i<t;i++)if(e[i]!==n[i])return!1;return!0}function i3e(n){const e={};return n.values.forEach((t,i)=>e[i]=t.get()),e}function r3e(n){const e={};return n.values.forEach((t,i)=>e[i]=t.getVelocity()),e}function ZS(n,e,t){const i=n.getProps();return HF(i,e,t!==void 0?t:i.custom,i3e(n),r3e(n))}let XF=cs;const Bg=n=>n*1e3,_d=n=>n/1e3,s3e={current:!1},jq=n=>Array.isArray(n)&&typeof n[0]=="number";function Yq(n){return!!(!n||typeof n=="string"&&qq[n]||jq(n)||Array.isArray(n)&&n.every(Yq))}const qb=([n,e,t,i])=>`cubic-bezier(${n}, ${e}, ${t}, ${i})`,qq={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:qb([0,.65,.55,1]),circOut:qb([.55,0,1,.45]),backIn:qb([.31,.01,.66,-.59]),backOut:qb([.33,1.53,.69,.99])};function Jq(n){if(n)return jq(n)?qb(n):Array.isArray(n)?n.map(Jq):qq[n]}function o3e(n,e,t,{delay:i=0,duration:s,repeat:l=0,repeatType:u="loop",ease:d,times:p}={}){const g={[e]:t};p&&(g.offset=p);const x=Jq(d);return Array.isArray(x)&&(g.easing=x),n.animate(g,{delay:i,duration:s,easing:Array.isArray(x)?"linear":x,fill:"both",iterations:l+1,direction:u==="reverse"?"alternate":"normal"})}function a3e(n,{repeat:e,repeatType:t="loop"}){const i=e&&t!=="loop"&&e%2===1?0:n.length-1;return n[i]}const eJ=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,l3e=1e-7,c3e=12;function u3e(n,e,t,i,s){let l,u,d=0;do u=e+(t-e)/2,l=eJ(u,i,s)-n,l>0?t=u:e=u;while(Math.abs(l)>l3e&&++d<c3e);return u}function K1(n,e,t,i){if(n===e&&t===i)return cs;const s=l=>u3e(l,0,1,n,t);return l=>l===0||l===1?l:eJ(s(l),e,i)}const h3e=K1(.42,0,1,1),d3e=K1(0,0,.58,1),tJ=K1(.42,0,.58,1),f3e=n=>Array.isArray(n)&&typeof n[0]!="number",nJ=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,iJ=n=>e=>1-n(1-e),$F=n=>1-Math.sin(Math.acos(n)),rJ=iJ($F),p3e=nJ($F),sJ=K1(.33,1.53,.69,.99),QF=iJ(sJ),m3e=nJ(QF),g3e=n=>(n*=2)<1?.5*QF(n):.5*(2-Math.pow(2,-10*(n-1))),y3e={linear:cs,easeIn:h3e,easeInOut:tJ,easeOut:d3e,circIn:$F,circInOut:p3e,circOut:rJ,backIn:QF,backInOut:m3e,backOut:sJ,anticipate:g3e},V$=n=>{if(Array.isArray(n)){XF(n.length===4);const[e,t,i,s]=n;return K1(e,t,i,s)}else if(typeof n=="string")return y3e[n];return n},KF=(n,e)=>t=>!!($1(t)&&vDe.test(t)&&t.startsWith(n)||e&&Object.prototype.hasOwnProperty.call(t,e)),oJ=(n,e,t)=>i=>{if(!$1(i))return i;const[s,l,u,d]=i.match(QS);return{[n]:parseFloat(s),[e]:parseFloat(l),[t]:parseFloat(u),alpha:d!==void 0?parseFloat(d):1}},A3e=n=>Bp(0,255,n),XL={...s0,transform:n=>Math.round(A3e(n))},_g={test:KF("rgb","red"),parse:oJ("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:i=1})=>"rgba("+XL.transform(n)+", "+XL.transform(e)+", "+XL.transform(t)+", "+yx(gx.transform(i))+")"};function v3e(n){let e="",t="",i="",s="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),i=n.substring(5,7),s=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),i=n.substring(3,4),s=n.substring(4,5),e+=e,t+=t,i+=i,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:s?parseInt(s,16)/255:1}}const rD={test:KF("#"),parse:v3e,transform:_g.transform},jy={test:KF("hsl","hue"),parse:oJ("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:i=1})=>"hsla("+Math.round(n)+", "+ah.transform(yx(e))+", "+ah.transform(yx(t))+", "+yx(gx.transform(i))+")"},ba={test:n=>_g.test(n)||rD.test(n)||jy.test(n),parse:n=>_g.test(n)?_g.parse(n):jy.test(n)?jy.parse(n):rD.parse(n),transform:n=>$1(n)?n:n.hasOwnProperty("red")?_g.transform(n):jy.transform(n)},Dr=(n,e,t)=>-t*n+t*e+n;function $L(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function b3e({hue:n,saturation:e,lightness:t,alpha:i}){n/=360,e/=100,t/=100;let s=0,l=0,u=0;if(!e)s=l=u=t;else{const d=t<.5?t*(1+e):t+e-t*e,p=2*t-d;s=$L(p,d,n+1/3),l=$L(p,d,n),u=$L(p,d,n-1/3)}return{red:Math.round(s*255),green:Math.round(l*255),blue:Math.round(u*255),alpha:i}}const QL=(n,e,t)=>{const i=n*n;return Math.sqrt(Math.max(0,t*(e*e-i)+i))},x3e=[rD,_g,jy],w3e=n=>x3e.find(e=>e.test(n));function U$(n){const e=w3e(n);let t=e.parse(n);return e===jy&&(t=b3e(t)),t}const aJ=(n,e)=>{const t=U$(n),i=U$(e),s={...t};return l=>(s.red=QL(t.red,i.red,l),s.green=QL(t.green,i.green,l),s.blue=QL(t.blue,i.blue,l),s.alpha=Dr(t.alpha,i.alpha,l),_g.transform(s))};function C3e(n){var e,t;return isNaN(n)&&$1(n)&&(((e=n.match(QS))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(Bq))===null||t===void 0?void 0:t.length)||0)>0}const lJ={regex:yDe,countKey:"Vars",token:"${v}",parse:cs},cJ={regex:Bq,countKey:"Colors",token:"${c}",parse:ba.parse},uJ={regex:QS,countKey:"Numbers",token:"${n}",parse:s0.parse};function KL(n,{regex:e,countKey:t,token:i,parse:s}){const l=n.tokenised.match(e);l&&(n["num"+t]=l.length,n.tokenised=n.tokenised.replace(e,i),n.values.push(...l.map(s)))}function ZI(n){const e=n.toString(),t={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return t.value.includes("var(--")&&KL(t,lJ),KL(t,cJ),KL(t,uJ),t}function hJ(n){return ZI(n).values}function dJ(n){const{values:e,numColors:t,numVars:i,tokenised:s}=ZI(n),l=e.length;return u=>{let d=s;for(let p=0;p<l;p++)p<i?d=d.replace(lJ.token,u[p]):p<i+t?d=d.replace(cJ.token,ba.transform(u[p])):d=d.replace(uJ.token,yx(u[p]));return d}}const E3e=n=>typeof n=="number"?0:n;function _3e(n){const e=hJ(n);return dJ(n)(e.map(E3e))}const Pp={test:C3e,parse:hJ,createTransformer:dJ,getAnimatableNone:_3e},fJ=(n,e)=>t=>`${t>0?e:n}`;function pJ(n,e){return typeof n=="number"?t=>Dr(n,e,t):ba.test(n)?aJ(n,e):n.startsWith("var(")?fJ(n,e):gJ(n,e)}const mJ=(n,e)=>{const t=[...n],i=t.length,s=n.map((l,u)=>pJ(l,e[u]));return l=>{for(let u=0;u<i;u++)t[u]=s[u](l);return t}},I3e=(n,e)=>{const t={...n,...e},i={};for(const s in t)n[s]!==void 0&&e[s]!==void 0&&(i[s]=pJ(n[s],e[s]));return s=>{for(const l in i)t[l]=i[l](s);return t}},gJ=(n,e)=>{const t=Pp.createTransformer(e),i=ZI(n),s=ZI(e);return i.numVars===s.numVars&&i.numColors===s.numColors&&i.numNumbers>=s.numNumbers?vp(mJ(i.values,s.values),t):fJ(n,e)},r1=(n,e,t)=>{const i=e-n;return i===0?1:(t-n)/i},z$=(n,e)=>t=>Dr(n,e,t);function S3e(n){return typeof n=="number"?z$:typeof n=="string"?ba.test(n)?aJ:gJ:Array.isArray(n)?mJ:typeof n=="object"?I3e:z$}function T3e(n,e,t){const i=[],s=t||S3e(n[0]),l=n.length-1;for(let u=0;u<l;u++){let d=s(n[u],n[u+1]);if(e){const p=Array.isArray(e)?e[u]||cs:e;d=vp(p,d)}i.push(d)}return i}function yJ(n,e,{clamp:t=!0,ease:i,mixer:s}={}){const l=n.length;if(XF(l===e.length),l===1)return()=>e[0];n[0]>n[l-1]&&(n=[...n].reverse(),e=[...e].reverse());const u=T3e(e,i,s),d=u.length,p=g=>{let x=0;if(d>1)for(;x<n.length-2&&!(g<n[x+1]);x++);const b=r1(n[x],n[x+1],g);return u[x](b)};return t?g=>p(Bp(n[0],n[l-1],g)):p}function M3e(n,e){const t=n[n.length-1];for(let i=1;i<=e;i++){const s=r1(0,e,i);n.push(Dr(t,1,s))}}function k3e(n){const e=[0];return M3e(e,n.length-1),e}function R3e(n,e){return n.map(t=>t*e)}function L3e(n,e){return n.map(()=>e||tJ).splice(0,n.length-1)}function jI({duration:n=300,keyframes:e,times:t,ease:i="easeInOut"}){const s=f3e(i)?i.map(V$):V$(i),l={done:!1,value:e[0]},u=R3e(t&&t.length===e.length?t:k3e(e),n),d=yJ(u,e,{ease:Array.isArray(s)?s:L3e(e,s)});return{calculatedDuration:n,next:p=>(l.value=d(p),l.done=p>=n,l)}}function AJ(n,e){return e?n*(1e3/e):0}const B3e=5;function vJ(n,e,t){const i=Math.max(e-B3e,0);return AJ(t-n(i),e-i)}const ZL=.001,P3e=.01,N3e=10,D3e=.05,F3e=1;function O3e({duration:n=800,bounce:e=.25,velocity:t=0,mass:i=1}){let s,l,u=1-e;u=Bp(D3e,F3e,u),n=Bp(P3e,N3e,_d(n)),u<1?(s=g=>{const x=g*u,b=x*n,E=x-t,S=sD(g,u),M=Math.exp(-b);return ZL-E/S*M},l=g=>{const b=g*u*n,E=b*t+t,S=Math.pow(u,2)*Math.pow(g,2)*n,M=Math.exp(-b),R=sD(Math.pow(g,2),u);return(-s(g)+ZL>0?-1:1)*((E-S)*M)/R}):(s=g=>{const x=Math.exp(-g*n),b=(g-t)*n+1;return-ZL+x*b},l=g=>{const x=Math.exp(-g*n),b=(t-g)*(n*n);return x*b});const d=5/n,p=U3e(s,l,d);if(n=Bg(n),isNaN(p))return{stiffness:100,damping:10,duration:n};{const g=Math.pow(p,2)*i;return{stiffness:g,damping:u*2*Math.sqrt(i*g),duration:n}}}const V3e=12;function U3e(n,e,t){let i=t;for(let s=1;s<V3e;s++)i=i-n(i)/e(i);return i}function sD(n,e){return n*Math.sqrt(1-e*e)}const z3e=["duration","bounce"],G3e=["stiffness","damping","mass"];function G$(n,e){return e.some(t=>n[t]!==void 0)}function W3e(n){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...n};if(!G$(n,G3e)&&G$(n,z3e)){const t=O3e(n);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function bJ({keyframes:n,restDelta:e,restSpeed:t,...i}){const s=n[0],l=n[n.length-1],u={done:!1,value:s},{stiffness:d,damping:p,mass:g,duration:x,velocity:b,isResolvedFromDuration:E}=W3e({...i,velocity:-_d(i.velocity||0)}),S=b||0,M=p/(2*Math.sqrt(d*g)),R=l-s,P=_d(Math.sqrt(d/g)),k=Math.abs(R)<5;t||(t=k?.01:2),e||(e=k?.005:.5);let F;if(M<1){const V=sD(P,M);F=G=>{const q=Math.exp(-M*P*G);return l-q*((S+M*P*R)/V*Math.sin(V*G)+R*Math.cos(V*G))}}else if(M===1)F=V=>l-Math.exp(-P*V)*(R+(S+P*R)*V);else{const V=P*Math.sqrt(M*M-1);F=G=>{const q=Math.exp(-M*P*G),ne=Math.min(V*G,300);return l-q*((S+M*P*R)*Math.sinh(ne)+V*R*Math.cosh(ne))/V}}return{calculatedDuration:E&&x||null,next:V=>{const G=F(V);if(E)u.done=V>=x;else{let q=S;V!==0&&(M<1?q=vJ(F,V,G):q=0);const ne=Math.abs(q)<=t,K=Math.abs(l-G)<=e;u.done=ne&&K}return u.value=u.done?l:G,u}}}function W$({keyframes:n,velocity:e=0,power:t=.8,timeConstant:i=325,bounceDamping:s=10,bounceStiffness:l=500,modifyTarget:u,min:d,max:p,restDelta:g=.5,restSpeed:x}){const b=n[0],E={done:!1,value:b},S=Q=>d!==void 0&&Q<d||p!==void 0&&Q>p,M=Q=>d===void 0?p:p===void 0||Math.abs(d-Q)<Math.abs(p-Q)?d:p;let R=t*e;const P=b+R,k=u===void 0?P:u(P);k!==P&&(R=k-b);const F=Q=>-R*Math.exp(-Q/i),V=Q=>k+F(Q),G=Q=>{const H=F(Q),j=V(Q);E.done=Math.abs(H)<=g,E.value=E.done?k:j};let q,ne;const K=Q=>{S(E.value)&&(q=Q,ne=bJ({keyframes:[E.value,M(E.value)],velocity:vJ(V,Q,E.value),damping:s,stiffness:l,restDelta:g,restSpeed:x}))};return K(0),{calculatedDuration:null,next:Q=>{let H=!1;return!ne&&q===void 0&&(H=!0,G(Q),K(Q)),q!==void 0&&Q>q?ne.next(Q-q):(!H&&G(Q),E)}}}const H3e=n=>{const e=({timestamp:t})=>n(t);return{start:()=>br.update(e,!0),stop:()=>Dd(e),now:()=>Qo.isProcessing?Qo.timestamp:performance.now()}},H$=2e4;function X$(n){let e=0;const t=50;let i=n.next(e);for(;!i.done&&e<H$;)e+=t,i=n.next(e);return e>=H$?1/0:e}const X3e={decay:W$,inertia:W$,tween:jI,keyframes:jI,spring:bJ};function YI({autoplay:n=!0,delay:e=0,driver:t=H3e,keyframes:i,type:s="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:d="loop",onPlay:p,onStop:g,onComplete:x,onUpdate:b,...E}){let S=1,M=!1,R,P;const k=()=>{P=new Promise(qe=>{R=qe})};k();let F;const V=X3e[s]||jI;let G;V!==jI&&typeof i[0]!="number"&&(G=yJ([0,100],i,{clamp:!1}),i=[0,100]);const q=V({...E,keyframes:i});let ne;d==="mirror"&&(ne=V({...E,keyframes:[...i].reverse(),velocity:-(E.velocity||0)}));let K="idle",Q=null,H=null,j=null;q.calculatedDuration===null&&l&&(q.calculatedDuration=X$(q));const{calculatedDuration:ee}=q;let de=1/0,oe=1/0;ee!==null&&(de=ee+u,oe=de*(l+1)-u);let we=0;const $e=qe=>{if(H===null)return;S>0&&(H=Math.min(H,qe)),S<0&&(H=Math.min(qe-oe/S,H)),Q!==null?we=Q:we=Math.round(qe-H)*S;const dt=we-e*(S>=0?1:-1),Wt=S>=0?dt<0:dt>oe;we=Math.max(dt,0),K==="finished"&&Q===null&&(we=oe);let xt=we,At=q;if(l){const It=Math.min(we,oe)/de;let Lt=Math.floor(It),Yt=It%1;!Yt&&It>=1&&(Yt=1),Yt===1&&Lt--,Lt=Math.min(Lt,l+1),!!(Lt%2)&&(d==="reverse"?(Yt=1-Yt,u&&(Yt-=u/de)):d==="mirror"&&(At=ne)),xt=Bp(0,1,Yt)*de}const Rt=Wt?{done:!1,value:i[0]}:At.next(xt);G&&(Rt.value=G(Rt.value));let{done:Et}=Rt;!Wt&&ee!==null&&(Et=S>=0?we>=oe:we<=0);const Ze=Q===null&&(K==="finished"||K==="running"&&Et);return b&&b(Rt.value),Ze&&Ae(),Rt},Me=()=>{F&&F.stop(),F=void 0},Ne=()=>{K="idle",Me(),R(),k(),H=j=null},Ae=()=>{K="finished",x&&x(),Me(),R()},Fe=()=>{if(M)return;F||(F=t($e));const qe=F.now();p&&p(),Q!==null?H=qe-Q:(!H||K==="finished")&&(H=qe),K==="finished"&&k(),j=H,Q=null,K="running",F.start()};n&&Fe();const Ie={then(qe,dt){return P.then(qe,dt)},get time(){return _d(we)},set time(qe){qe=Bg(qe),we=qe,Q!==null||!F||S===0?Q=qe:H=F.now()-qe/S},get duration(){const qe=q.calculatedDuration===null?X$(q):q.calculatedDuration;return _d(qe)},get speed(){return S},set speed(qe){qe===S||!F||(S=qe,Ie.time=_d(we))},get state(){return K},play:Fe,pause:()=>{K="paused",Q=we},stop:()=>{M=!0,K!=="idle"&&(K="idle",g&&g(),Ne())},cancel:()=>{j!==null&&$e(j),Ne()},complete:()=>{K="finished"},sample:qe=>(H=0,$e(qe))};return Ie}function $3e(n){let e;return()=>(e===void 0&&(e=n()),e)}const Q3e=$3e(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),K3e=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),hE=10,Z3e=2e4,j3e=(n,e)=>e.type==="spring"||n==="backgroundColor"||!Yq(e.ease);function Y3e(n,e,{onUpdate:t,onComplete:i,...s}){if(!(Q3e()&&K3e.has(e)&&!s.repeatDelay&&s.repeatType!=="mirror"&&s.damping!==0&&s.type!=="inertia"))return!1;let u=!1,d,p,g=!1;const x=()=>{p=new Promise(V=>{d=V})};x();let{keyframes:b,duration:E=300,ease:S,times:M}=s;if(j3e(e,s)){const V=YI({...s,repeat:0,delay:0});let G={done:!1,value:b[0]};const q=[];let ne=0;for(;!G.done&&ne<Z3e;)G=V.sample(ne),q.push(G.value),ne+=hE;M=void 0,b=q,E=ne-hE,S="linear"}const R=o3e(n.owner.current,e,b,{...s,duration:E,ease:S,times:M}),P=()=>{g=!1,R.cancel()},k=()=>{g=!0,br.update(P),d(),x()};return R.onfinish=()=>{g||(n.set(a3e(b,s)),i&&i(),k())},{then(V,G){return p.then(V,G)},attachTimeline(V){return R.timeline=V,R.onfinish=null,cs},get time(){return _d(R.currentTime||0)},set time(V){R.currentTime=Bg(V)},get speed(){return R.playbackRate},set speed(V){R.playbackRate=V},get duration(){return _d(E)},play:()=>{u||(R.play(),Dd(P))},pause:()=>R.pause(),stop:()=>{if(u=!0,R.playState==="idle")return;const{currentTime:V}=R;if(V){const G=YI({...s,autoplay:!1});n.setWithVelocity(G.sample(V-hE).value,G.sample(V).value,hE)}k()},complete:()=>{g||R.finish()},cancel:k}}function q3e({keyframes:n,delay:e,onUpdate:t,onComplete:i}){const s=()=>(t&&t(n[n.length-1]),i&&i(),{time:0,speed:1,duration:0,play:cs,pause:cs,stop:cs,then:l=>(l(),Promise.resolve()),cancel:cs,complete:cs});return e?YI({keyframes:[0,1],duration:0,delay:e,onComplete:s}):s()}const J3e={type:"spring",stiffness:500,damping:25,restSpeed:10},eFe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),tFe={type:"keyframes",duration:.8},nFe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},iFe=(n,{keyframes:e})=>e.length>2?tFe:r0.has(n)?n.startsWith("scale")?eFe(e[1]):J3e:nFe,oD=(n,e)=>n==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Pp.test(e)||e==="0")&&!e.startsWith("url(")),rFe=new Set(["brightness","contrast","saturate","opacity"]);function sFe(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[i]=t.match(QS)||[];if(!i)return n;const s=t.replace(i,"");let l=rFe.has(e)?1:0;return i!==t&&(l*=100),e+"("+l+s+")"}const oFe=/([a-z-]*)\(.*?\)/g,aD={...Pp,getAnimatableNone:n=>{const e=n.match(oFe);return e?e.map(sFe).join(" "):n}},aFe={...Pq,color:ba,backgroundColor:ba,outlineColor:ba,fill:ba,stroke:ba,borderColor:ba,borderTopColor:ba,borderRightColor:ba,borderBottomColor:ba,borderLeftColor:ba,filter:aD,WebkitFilter:aD},ZF=n=>aFe[n];function xJ(n,e){let t=ZF(n);return t!==aD&&(t=Pp),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const wJ=n=>/^0[^.\s]+$/.test(n);function lFe(n){if(typeof n=="number")return n===0;if(n!==null)return n==="none"||n==="0"||wJ(n)}function cFe(n,e,t,i){const s=oD(e,t);let l;Array.isArray(t)?l=[...t]:l=[null,t];const u=i.from!==void 0?i.from:n.get();let d;const p=[];for(let g=0;g<l.length;g++)l[g]===null&&(l[g]=g===0?u:l[g-1]),lFe(l[g])&&p.push(g),typeof l[g]=="string"&&l[g]!=="none"&&l[g]!=="0"&&(d=l[g]);if(s&&p.length&&d)for(let g=0;g<p.length;g++){const x=p[g];l[x]=xJ(e,d)}return l}function uFe({when:n,delay:e,delayChildren:t,staggerChildren:i,staggerDirection:s,repeat:l,repeatType:u,repeatDelay:d,from:p,elapsed:g,...x}){return!!Object.keys(x).length}function jF(n,e){return n[e]||n.default||n}const hFe={skipAnimations:!1},YF=(n,e,t,i={})=>s=>{const l=jF(i,n)||{},u=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Bg(u);const p=cFe(e,n,t,l),g=p[0],x=p[p.length-1],b=oD(n,g),E=oD(n,x);let S={keyframes:p,velocity:e.getVelocity(),ease:"easeOut",...l,delay:-d,onUpdate:M=>{e.set(M),l.onUpdate&&l.onUpdate(M)},onComplete:()=>{s(),l.onComplete&&l.onComplete()}};if(uFe(l)||(S={...S,...iFe(n,S)}),S.duration&&(S.duration=Bg(S.duration)),S.repeatDelay&&(S.repeatDelay=Bg(S.repeatDelay)),!b||!E||s3e.current||l.type===!1||hFe.skipAnimations)return q3e(S);if(!i.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const M=Y3e(e,n,S);if(M)return M}return YI(S)};function qI(n){return!!(rl(n)&&n.add)}const CJ=n=>/^\-?\d*\.?\d+$/.test(n);function qF(n,e){n.indexOf(e)===-1&&n.push(e)}function JF(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class eO{constructor(){this.subscriptions=[]}add(e){return qF(this.subscriptions,e),()=>JF(this.subscriptions,e)}notify(e,t,i){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,i);else for(let l=0;l<s;l++){const u=this.subscriptions[l];u&&u(e,t,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const dFe=n=>!isNaN(parseFloat(n));class fFe{constructor(e,t={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(i,s=!0)=>{this.prev=this.current,this.current=i;const{delta:l,timestamp:u}=Qo;this.lastUpdated!==u&&(this.timeDelta=l,this.lastUpdated=u,br.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>br.postRender(this.velocityCheck),this.velocityCheck=({timestamp:i})=>{i!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=dFe(this.current),this.owner=t.owner}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new eO);const i=this.events[e].add(t);return e==="change"?()=>{i(),br.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,i){this.set(t),this.prev=e,this.timeDelta=i}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?AJ(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function MA(n,e){return new fFe(n,e)}const EJ=n=>e=>e.test(n),pFe={test:n=>n==="auto",parse:n=>n},_J=[s0,Qn,ah,$f,xDe,bDe,pFe],wb=n=>_J.find(EJ(n)),mFe=[..._J,ba,Pp],gFe=n=>mFe.find(EJ(n));function yFe(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,MA(t))}function AFe(n,e){const t=ZS(n,e);let{transitionEnd:i={},transition:s={},...l}=t?n.makeTargetAnimatable(t,!1):{};l={...l,...i};for(const u in l){const d=NDe(l[u]);yFe(n,u,d)}}function vFe(n,e,t){var i,s;const l=Object.keys(e).filter(d=>!n.hasValue(d)),u=l.length;if(u)for(let d=0;d<u;d++){const p=l[d],g=e[p];let x=null;Array.isArray(g)&&(x=g[0]),x===null&&(x=(s=(i=t[p])!==null&&i!==void 0?i:n.readValue(p))!==null&&s!==void 0?s:e[p]),x!=null&&(typeof x=="string"&&(CJ(x)||wJ(x))?x=parseFloat(x):!gFe(x)&&Pp.test(g)&&(x=xJ(p,g)),n.addValue(p,MA(x,{owner:n})),t[p]===void 0&&(t[p]=x),x!==null&&n.setBaseTarget(p,x))}}function bFe(n,e){return e?(e[n]||e.default||e).from:void 0}function xFe(n,e,t){const i={};for(const s in n){const l=bFe(s,e);if(l!==void 0)i[s]=l;else{const u=t.getValue(s);u&&(i[s]=u.get())}}return i}function wFe({protectedKeys:n,needsAnimating:e},t){const i=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,i}function CFe(n,e){const t=n.get();if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(e[i]!==t)return!0}else return t!==e}function IJ(n,e,{delay:t=0,transitionOverride:i,type:s}={}){let{transition:l=n.getDefaultTransition(),transitionEnd:u,...d}=n.makeTargetAnimatable(e);const p=n.getValue("willChange");i&&(l=i);const g=[],x=s&&n.animationState&&n.animationState.getState()[s];for(const b in d){const E=n.getValue(b),S=d[b];if(!E||S===void 0||x&&wFe(x,b))continue;const M={delay:t,elapsed:0,...jF(l||{},b)};if(window.HandoffAppearAnimations){const k=n.getProps()[Sq];if(k){const F=window.HandoffAppearAnimations(k,b,E,br);F!==null&&(M.elapsed=F,M.isHandoff=!0)}}let R=!M.isHandoff&&!CFe(E,S);if(M.type==="spring"&&(E.getVelocity()||M.velocity)&&(R=!1),E.animation&&(R=!1),R)continue;E.start(YF(b,E,S,n.shouldReduceMotion&&r0.has(b)?{type:!1}:M));const P=E.animation;qI(p)&&(p.add(b),P.then(()=>p.remove(b))),g.push(P)}return u&&Promise.all(g).then(()=>{u&&AFe(n,u)}),g}function lD(n,e,t={}){const i=ZS(n,e,t.custom);let{transition:s=n.getDefaultTransition()||{}}=i||{};t.transitionOverride&&(s=t.transitionOverride);const l=i?()=>Promise.all(IJ(n,i,t)):()=>Promise.resolve(),u=n.variantChildren&&n.variantChildren.size?(p=0)=>{const{delayChildren:g=0,staggerChildren:x,staggerDirection:b}=s;return EFe(n,e,g+p,x,b,t)}:()=>Promise.resolve(),{when:d}=s;if(d){const[p,g]=d==="beforeChildren"?[l,u]:[u,l];return p().then(()=>g())}else return Promise.all([l(),u(t.delay)])}function EFe(n,e,t=0,i=0,s=1,l){const u=[],d=(n.variantChildren.size-1)*i,p=s===1?(g=0)=>g*i:(g=0)=>d-g*i;return Array.from(n.variantChildren).sort(_Fe).forEach((g,x)=>{g.notify("AnimationStart",e),u.push(lD(g,e,{...l,delay:t+p(x)}).then(()=>g.notify("AnimationComplete",e)))}),Promise.all(u)}function _Fe(n,e){return n.sortNodePosition(e)}function IFe(n,e,t={}){n.notify("AnimationStart",e);let i;if(Array.isArray(e)){const s=e.map(l=>lD(n,l,t));i=Promise.all(s)}else if(typeof e=="string")i=lD(n,e,t);else{const s=typeof e=="function"?ZS(n,e,t.custom):e;i=Promise.all(IJ(n,s,t))}return i.then(()=>n.notify("AnimationComplete",e))}const SFe=[...NF].reverse(),TFe=NF.length;function MFe(n){return e=>Promise.all(e.map(({animation:t,options:i})=>IFe(n,t,i)))}function kFe(n){let e=MFe(n);const t=LFe();let i=!0;const s=(p,g)=>{const x=ZS(n,g);if(x){const{transition:b,transitionEnd:E,...S}=x;p={...p,...S,...E}}return p};function l(p){e=p(n)}function u(p,g){const x=n.getProps(),b=n.getVariantContext(!0)||{},E=[],S=new Set;let M={},R=1/0;for(let k=0;k<TFe;k++){const F=SFe[k],V=t[F],G=x[F]!==void 0?x[F]:b[F],q=n1(G),ne=F===g?V.isActive:null;ne===!1&&(R=k);let K=G===b[F]&&G!==x[F]&&q;if(K&&i&&n.manuallyAnimateOnMount&&(K=!1),V.protectedKeys={...M},!V.isActive&&ne===null||!G&&!V.prevProp||XS(G)||typeof G=="boolean")continue;let H=RFe(V.prevProp,G)||F===g&&V.isActive&&!K&&q||k>R&&q,j=!1;const ee=Array.isArray(G)?G:[G];let de=ee.reduce(s,{});ne===!1&&(de={});const{prevResolvedValues:oe={}}=V,we={...oe,...de},$e=Me=>{H=!0,S.has(Me)&&(j=!0,S.delete(Me)),V.needsAnimating[Me]=!0};for(const Me in we){const Ne=de[Me],Ae=oe[Me];if(M.hasOwnProperty(Me))continue;let Fe=!1;KI(Ne)&&KI(Ae)?Fe=!Zq(Ne,Ae):Fe=Ne!==Ae,Fe?Ne!==void 0?$e(Me):S.add(Me):Ne!==void 0&&S.has(Me)?$e(Me):V.protectedKeys[Me]=!0}V.prevProp=G,V.prevResolvedValues=de,V.isActive&&(M={...M,...de}),i&&n.blockInitialAnimation&&(H=!1),H&&(!K||j)&&E.push(...ee.map(Me=>({animation:Me,options:{type:F,...p}})))}if(S.size){const k={};S.forEach(F=>{const V=n.getBaseTarget(F);V!==void 0&&(k[F]=V)}),E.push({animation:k})}let P=!!E.length;return i&&(x.initial===!1||x.initial===x.animate)&&!n.manuallyAnimateOnMount&&(P=!1),i=!1,P?e(E):Promise.resolve()}function d(p,g,x){var b;if(t[p].isActive===g)return Promise.resolve();(b=n.variantChildren)===null||b===void 0||b.forEach(S=>{var M;return(M=S.animationState)===null||M===void 0?void 0:M.setActive(p,g)}),t[p].isActive=g;const E=u(x,p);for(const S in t)t[S].protectedKeys={};return E}return{animateChanges:u,setActive:d,setAnimateFunction:l,getState:()=>t}}function RFe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!Zq(e,n):!1}function Gm(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function LFe(){return{animate:Gm(!0),whileInView:Gm(),whileHover:Gm(),whileTap:Gm(),whileDrag:Gm(),whileFocus:Gm(),exit:Gm()}}class BFe extends Yp{constructor(e){super(e),e.animationState||(e.animationState=kFe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),XS(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){}}let PFe=0;class NFe extends Yp{constructor(){super(...arguments),this.id=PFe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t,custom:i}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const l=this.node.animationState.setActive("exit",!e,{custom:i??this.node.getProps().custom});t&&!e&&l.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const DFe={animation:{Feature:BFe},exit:{Feature:NFe}},$$=(n,e)=>Math.abs(n-e);function FFe(n,e){const t=$$(n.x,e.x),i=$$(n.y,e.y);return Math.sqrt(t**2+i**2)}class SJ{constructor(e,t,{transformPagePoint:i,contextWindow:s,dragSnapToOrigin:l=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=YL(this.lastMoveEventInfo,this.history),E=this.startEvent!==null,S=FFe(b.offset,{x:0,y:0})>=3;if(!E&&!S)return;const{point:M}=b,{timestamp:R}=Qo;this.history.push({...M,timestamp:R});const{onStart:P,onMove:k}=this.handlers;E||(P&&P(this.lastMoveEvent,b),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,b)},this.handlePointerMove=(b,E)=>{this.lastMoveEvent=b,this.lastMoveEventInfo=jL(E,this.transformPagePoint),br.update(this.updatePoint,!0)},this.handlePointerUp=(b,E)=>{this.end();const{onEnd:S,onSessionEnd:M,resumeAnimation:R}=this.handlers;if(this.dragSnapToOrigin&&R&&R(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const P=YL(b.type==="pointercancel"?this.lastMoveEventInfo:jL(E,this.transformPagePoint),this.history);this.startEvent&&S&&S(b,P),M&&M(b,P)},!Hq(e))return;this.dragSnapToOrigin=l,this.handlers=t,this.transformPagePoint=i,this.contextWindow=s||window;const u=KS(e),d=jL(u,this.transformPagePoint),{point:p}=d,{timestamp:g}=Qo;this.history=[{...p,timestamp:g}];const{onSessionStart:x}=t;x&&x(e,YL(d,this.history)),this.removeListeners=vp(Ed(this.contextWindow,"pointermove",this.handlePointerMove),Ed(this.contextWindow,"pointerup",this.handlePointerUp),Ed(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Dd(this.updatePoint)}}function jL(n,e){return e?{point:e(n.point)}:n}function Q$(n,e){return{x:n.x-e.x,y:n.y-e.y}}function YL({point:n},e){return{point:n,delta:Q$(n,TJ(e)),offset:Q$(n,OFe(e)),velocity:VFe(e,.1)}}function OFe(n){return n[0]}function TJ(n){return n[n.length-1]}function VFe(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,i=null;const s=TJ(n);for(;t>=0&&(i=n[t],!(s.timestamp-i.timestamp>Bg(e)));)t--;if(!i)return{x:0,y:0};const l=_d(s.timestamp-i.timestamp);if(l===0)return{x:0,y:0};const u={x:(s.x-i.x)/l,y:(s.y-i.y)/l};return u.x===1/0&&(u.x=0),u.y===1/0&&(u.y=0),u}function Rl(n){return n.max-n.min}function cD(n,e=0,t=.01){return Math.abs(n-e)<=t}function K$(n,e,t,i=.5){n.origin=i,n.originPoint=Dr(e.min,e.max,n.origin),n.scale=Rl(t)/Rl(e),(cD(n.scale,1,1e-4)||isNaN(n.scale))&&(n.scale=1),n.translate=Dr(t.min,t.max,n.origin)-n.originPoint,(cD(n.translate)||isNaN(n.translate))&&(n.translate=0)}function Ax(n,e,t,i){K$(n.x,e.x,t.x,i?i.originX:void 0),K$(n.y,e.y,t.y,i?i.originY:void 0)}function Z$(n,e,t){n.min=t.min+e.min,n.max=n.min+Rl(e)}function UFe(n,e,t){Z$(n.x,e.x,t.x),Z$(n.y,e.y,t.y)}function j$(n,e,t){n.min=e.min-t.min,n.max=n.min+Rl(e)}function vx(n,e,t){j$(n.x,e.x,t.x),j$(n.y,e.y,t.y)}function zFe(n,{min:e,max:t},i){return e!==void 0&&n<e?n=i?Dr(e,n,i.min):Math.max(n,e):t!==void 0&&n>t&&(n=i?Dr(t,n,i.max):Math.min(n,t)),n}function Y$(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function GFe(n,{top:e,left:t,bottom:i,right:s}){return{x:Y$(n.x,t,s),y:Y$(n.y,e,i)}}function q$(n,e){let t=e.min-n.min,i=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,i]=[i,t]),{min:t,max:i}}function WFe(n,e){return{x:q$(n.x,e.x),y:q$(n.y,e.y)}}function HFe(n,e){let t=.5;const i=Rl(n),s=Rl(e);return s>i?t=r1(e.min,e.max-i,n.min):i>s&&(t=r1(n.min,n.max-s,e.min)),Bp(0,1,t)}function XFe(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const uD=.35;function $Fe(n=uD){return n===!1?n=0:n===!0&&(n=uD),{x:J$(n,"left","right"),y:J$(n,"top","bottom")}}function J$(n,e,t){return{min:eQ(n,e),max:eQ(n,t)}}function eQ(n,e){return typeof n=="number"?n:n[e]||0}const tQ=()=>({translate:0,scale:1,origin:0,originPoint:0}),Yy=()=>({x:tQ(),y:tQ()}),nQ=()=>({min:0,max:0}),_s=()=>({x:nQ(),y:nQ()});function ic(n){return[n("x"),n("y")]}function MJ({top:n,left:e,right:t,bottom:i}){return{x:{min:e,max:t},y:{min:n,max:i}}}function QFe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function KFe(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),i=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}function qL(n){return n===void 0||n===1}function hD({scale:n,scaleX:e,scaleY:t}){return!qL(n)||!qL(e)||!qL(t)}function pg(n){return hD(n)||kJ(n)||n.z||n.rotate||n.rotateX||n.rotateY}function kJ(n){return iQ(n.x)||iQ(n.y)}function iQ(n){return n&&n!=="0%"}function JI(n,e,t){const i=n-t,s=e*i;return t+s}function rQ(n,e,t,i,s){return s!==void 0&&(n=JI(n,s,i)),JI(n,t,i)+e}function dD(n,e=0,t=1,i,s){n.min=rQ(n.min,e,t,i,s),n.max=rQ(n.max,e,t,i,s)}function RJ(n,{x:e,y:t}){dD(n.x,e.translate,e.scale,e.originPoint),dD(n.y,t.translate,t.scale,t.originPoint)}function ZFe(n,e,t,i=!1){const s=t.length;if(!s)return;e.x=e.y=1;let l,u;for(let d=0;d<s;d++){l=t[d],u=l.projectionDelta;const p=l.instance;p&&p.style&&p.style.display==="contents"||(i&&l.options.layoutScroll&&l.scroll&&l!==l.root&&qy(n,{x:-l.scroll.offset.x,y:-l.scroll.offset.y}),u&&(e.x*=u.x.scale,e.y*=u.y.scale,RJ(n,u)),i&&pg(l.latestValues)&&qy(n,l.latestValues))}e.x=sQ(e.x),e.y=sQ(e.y)}function sQ(n){return Number.isInteger(n)||n>1.0000000000001||n<.999999999999?n:1}function Zf(n,e){n.min=n.min+e,n.max=n.max+e}function oQ(n,e,[t,i,s]){const l=e[s]!==void 0?e[s]:.5,u=Dr(n.min,n.max,l);dD(n,e[t],e[i],u,e.scale)}const jFe=["x","scaleX","originX"],YFe=["y","scaleY","originY"];function qy(n,e){oQ(n.x,e,jFe),oQ(n.y,e,YFe)}function LJ(n,e){return MJ(KFe(n.getBoundingClientRect(),e))}function qFe(n,e,t){const i=LJ(n,t),{scroll:s}=e;return s&&(Zf(i.x,s.offset.x),Zf(i.y,s.offset.y)),i}const BJ=({current:n})=>n?n.ownerDocument.defaultView:null,JFe=new WeakMap;class eOe{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=_s(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const s=x=>{const{dragSnapToOrigin:b}=this.getProps();b?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(KS(x,"page").point)},l=(x,b)=>{const{drag:E,dragPropagation:S,onDragStart:M}=this.getProps();if(E&&!S&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=$q(E),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ic(P=>{let k=this.getAxisMotionValue(P).get()||0;if(ah.test(k)){const{projection:F}=this.visualElement;if(F&&F.layout){const V=F.layout.layoutBox[P];V&&(k=Rl(V)*(parseFloat(k)/100))}}this.originPoint[P]=k}),M&&br.update(()=>M(x,b),!1,!0);const{animationState:R}=this.visualElement;R&&R.setActive("whileDrag",!0)},u=(x,b)=>{const{dragPropagation:E,dragDirectionLock:S,onDirectionLock:M,onDrag:R}=this.getProps();if(!E&&!this.openGlobalLock)return;const{offset:P}=b;if(S&&this.currentDirection===null){this.currentDirection=tOe(P),this.currentDirection!==null&&M&&M(this.currentDirection);return}this.updateAxis("x",b.point,P),this.updateAxis("y",b.point,P),this.visualElement.render(),R&&R(x,b)},d=(x,b)=>this.stop(x,b),p=()=>ic(x=>{var b;return this.getAnimationState(x)==="paused"&&((b=this.getAxisMotionValue(x).animation)===null||b===void 0?void 0:b.play())}),{dragSnapToOrigin:g}=this.getProps();this.panSession=new SJ(e,{onSessionStart:s,onStart:l,onMove:u,onSessionEnd:d,resumeAnimation:p},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:g,contextWindow:BJ(this.visualElement)})}stop(e,t){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:l}=this.getProps();l&&br.update(()=>l(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,i){const{drag:s}=this.getProps();if(!i||!dE(e,s,this.currentDirection))return;const l=this.getAxisMotionValue(e);let u=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(u=zFe(u,this.constraints[e],this.elastic[e])),l.set(u)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:i}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,l=this.constraints;t&&Zy(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=GFe(s.layoutBox,t):this.constraints=!1,this.elastic=$Fe(i),l!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&ic(u=>{this.getAxisMotionValue(u)&&(this.constraints[u]=XFe(s.layoutBox[u],this.constraints[u]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!Zy(e))return!1;const i=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const l=qFe(i,s.root,this.visualElement.getTransformPagePoint());let u=WFe(s.layout.layoutBox,l);if(t){const d=t(QFe(u));this.hasMutatedConstraints=!!d,d&&(u=MJ(d))}return u}startAnimation(e){const{drag:t,dragMomentum:i,dragElastic:s,dragTransition:l,dragSnapToOrigin:u,onDragTransitionEnd:d}=this.getProps(),p=this.constraints||{},g=ic(x=>{if(!dE(x,t,this.currentDirection))return;let b=p&&p[x]||{};u&&(b={min:0,max:0});const E=s?200:1e6,S=s?40:1e7,M={type:"inertia",velocity:i?e[x]:0,bounceStiffness:E,bounceDamping:S,timeConstant:750,restDelta:1,restSpeed:10,...l,...b};return this.startAxisValueAnimation(x,M)});return Promise.all(g).then(d)}startAxisValueAnimation(e,t){const i=this.getAxisMotionValue(e);return i.start(YF(e,i,0,t))}stopAnimation(){ic(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ic(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t="_drag"+e.toUpperCase(),i=this.visualElement.getProps(),s=i[t];return s||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){ic(t=>{const{drag:i}=this.getProps();if(!dE(t,i,this.currentDirection))return;const{projection:s}=this.visualElement,l=this.getAxisMotionValue(t);if(s&&s.layout){const{min:u,max:d}=s.layout.layoutBox[t];l.set(e[t]-Dr(u,d,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:i}=this.visualElement;if(!Zy(t)||!i||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};ic(u=>{const d=this.getAxisMotionValue(u);if(d){const p=d.get();s[u]=HFe({min:p,max:p},this.constraints[u])}});const{transformTemplate:l}=this.visualElement.getProps();this.visualElement.current.style.transform=l?l({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),ic(u=>{if(!dE(u,e,null))return;const d=this.getAxisMotionValue(u),{min:p,max:g}=this.constraints[u];d.set(Dr(p,g,s[u]))})}addListeners(){if(!this.visualElement.current)return;JFe.set(this.visualElement,this);const e=this.visualElement.current,t=Ed(e,"pointerdown",p=>{const{drag:g,dragListener:x=!0}=this.getProps();g&&x&&this.start(p)}),i=()=>{const{dragConstraints:p}=this.getProps();Zy(p)&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,l=s.addEventListener("measure",i);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),i();const u=gd(window,"resize",()=>this.scalePositionWithinConstraints()),d=s.addEventListener("didUpdate",({delta:p,hasLayoutChanged:g})=>{this.isDragging&&g&&(ic(x=>{const b=this.getAxisMotionValue(x);b&&(this.originPoint[x]+=p[x].translate,b.set(b.get()+p[x].translate))}),this.visualElement.render())});return()=>{u(),t(),l(),d&&d()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:i=!1,dragPropagation:s=!1,dragConstraints:l=!1,dragElastic:u=uD,dragMomentum:d=!0}=e;return{...e,drag:t,dragDirectionLock:i,dragPropagation:s,dragConstraints:l,dragElastic:u,dragMomentum:d}}}function dE(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function tOe(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class nOe extends Yp{constructor(e){super(e),this.removeGroupControls=cs,this.removeListeners=cs,this.controls=new eOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||cs}unmount(){this.removeGroupControls(),this.removeListeners()}}const aQ=n=>(e,t)=>{n&&br.update(()=>n(e,t))};class iOe extends Yp{constructor(){super(...arguments),this.removePointerDownListener=cs}onPointerDown(e){this.session=new SJ(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:BJ(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:i,onPanEnd:s}=this.node.getProps();return{onSessionStart:aQ(e),onStart:aQ(t),onMove:i,onEnd:(l,u)=>{delete this.session,s&&br.update(()=>s(l,u))}}}mount(){this.removePointerDownListener=Ed(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function rOe(){const n=Le.useContext(WS);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:i}=n,s=Le.useId();return Le.useEffect(()=>i(s),[]),!e&&t?[!1,()=>t&&t(s)]:[!0]}const J_={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function lQ(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const Cb={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Qn.test(n))n=parseFloat(n);else return n;const t=lQ(n,e.target.x),i=lQ(n,e.target.y);return`${t}% ${i}%`}},sOe={correct:(n,{treeScale:e,projectionDelta:t})=>{const i=n,s=Pp.parse(n);if(s.length>5)return i;const l=Pp.createTransformer(n),u=typeof s[0]!="number"?1:0,d=t.x.scale*e.x,p=t.y.scale*e.y;s[0+u]/=d,s[1+u]/=p;const g=Dr(d,p,.5);return typeof s[2+u]=="number"&&(s[2+u]/=g),typeof s[3+u]=="number"&&(s[3+u]/=g),l(s)}};class oOe extends Vg.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i,layoutId:s}=this.props,{projection:l}=e;fDe(aOe),l&&(t.group&&t.group.add(l),i&&i.register&&s&&i.register(l),l.root.didUpdate(),l.addEventListener("animationComplete",()=>{this.safeToRemove()}),l.setOptions({...l.options,onExitComplete:()=>this.safeToRemove()})),J_.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:i,drag:s,isPresent:l}=this.props,u=i.projection;return u&&(u.isPresent=l,s||e.layoutDependency!==t||t===void 0?u.willUpdate():this.safeToRemove(),e.isPresent!==l&&(l?u.promote():u.relegate()||br.postRender(()=>{const d=u.getStack();(!d||!d.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),i&&i.deregister&&i.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function PJ(n){const[e,t]=rOe(),i=Le.useContext(FF);return Vg.createElement(oOe,{...n,layoutGroup:i,switchLayoutGroup:Le.useContext(Mq),isPresent:e,safeToRemove:t})}const aOe={borderRadius:{...Cb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Cb,borderTopRightRadius:Cb,borderBottomLeftRadius:Cb,borderBottomRightRadius:Cb,boxShadow:sOe},NJ=["TopLeft","TopRight","BottomLeft","BottomRight"],lOe=NJ.length,cQ=n=>typeof n=="string"?parseFloat(n):n,uQ=n=>typeof n=="number"||Qn.test(n);function cOe(n,e,t,i,s,l){s?(n.opacity=Dr(0,t.opacity!==void 0?t.opacity:1,uOe(i)),n.opacityExit=Dr(e.opacity!==void 0?e.opacity:1,0,hOe(i))):l&&(n.opacity=Dr(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,i));for(let u=0;u<lOe;u++){const d=`border${NJ[u]}Radius`;let p=hQ(e,d),g=hQ(t,d);if(p===void 0&&g===void 0)continue;p||(p=0),g||(g=0),p===0||g===0||uQ(p)===uQ(g)?(n[d]=Math.max(Dr(cQ(p),cQ(g),i),0),(ah.test(g)||ah.test(p))&&(n[d]+="%")):n[d]=g}(e.rotate||t.rotate)&&(n.rotate=Dr(e.rotate||0,t.rotate||0,i))}function hQ(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const uOe=DJ(0,.5,rJ),hOe=DJ(.5,.95,cs);function DJ(n,e,t){return i=>i<n?0:i>e?1:t(r1(n,e,i))}function dQ(n,e){n.min=e.min,n.max=e.max}function ec(n,e){dQ(n.x,e.x),dQ(n.y,e.y)}function fQ(n,e,t,i,s){return n-=e,n=JI(n,1/t,i),s!==void 0&&(n=JI(n,1/s,i)),n}function dOe(n,e=0,t=1,i=.5,s,l=n,u=n){if(ah.test(e)&&(e=parseFloat(e),e=Dr(u.min,u.max,e/100)-u.min),typeof e!="number")return;let d=Dr(l.min,l.max,i);n===l&&(d-=e),n.min=fQ(n.min,e,t,d,s),n.max=fQ(n.max,e,t,d,s)}function pQ(n,e,[t,i,s],l,u){dOe(n,e[t],e[i],e[s],e.scale,l,u)}const fOe=["x","scaleX","originX"],pOe=["y","scaleY","originY"];function mQ(n,e,t,i){pQ(n.x,e,fOe,t?t.x:void 0,i?i.x:void 0),pQ(n.y,e,pOe,t?t.y:void 0,i?i.y:void 0)}function gQ(n){return n.translate===0&&n.scale===1}function FJ(n){return gQ(n.x)&&gQ(n.y)}function mOe(n,e){return n.x.min===e.x.min&&n.x.max===e.x.max&&n.y.min===e.y.min&&n.y.max===e.y.max}function OJ(n,e){return Math.round(n.x.min)===Math.round(e.x.min)&&Math.round(n.x.max)===Math.round(e.x.max)&&Math.round(n.y.min)===Math.round(e.y.min)&&Math.round(n.y.max)===Math.round(e.y.max)}function yQ(n){return Rl(n.x)/Rl(n.y)}class gOe{constructor(){this.members=[]}add(e){qF(this.members,e),e.scheduleRender()}remove(e){if(JF(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let i;for(let s=t;s>=0;s--){const l=this.members[s];if(l.isPresent!==!1){i=l;break}}return i?(this.promote(i),!0):!1}promote(e,t){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,t&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:i}=e;t.onExitComplete&&t.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function AQ(n,e,t){let i="";const s=n.x.translate/e.x,l=n.y.translate/e.y;if((s||l)&&(i=`translate3d(${s}px, ${l}px, 0) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),t){const{rotate:p,rotateX:g,rotateY:x}=t;p&&(i+=`rotate(${p}deg) `),g&&(i+=`rotateX(${g}deg) `),x&&(i+=`rotateY(${x}deg) `)}const u=n.x.scale*e.x,d=n.y.scale*e.y;return(u!==1||d!==1)&&(i+=`scale(${u}, ${d})`),i||"none"}const yOe=(n,e)=>n.depth-e.depth;class AOe{constructor(){this.children=[],this.isDirty=!1}add(e){qF(this.children,e),this.isDirty=!0}remove(e){JF(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(yOe),this.isDirty=!1,this.children.forEach(e)}}function vOe(n,e){const t=performance.now(),i=({timestamp:s})=>{const l=s-t;l>=e&&(Dd(i),n(l-e))};return br.read(i,!0),()=>Dd(i)}function bOe(n){window.MotionDebug&&window.MotionDebug.record(n)}function xOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}function wOe(n,e,t){const i=rl(n)?n:MA(n);return i.start(YF("",i,e,t)),i.animation}const vQ=["","X","Y","Z"],COe={visibility:"hidden"},bQ=1e3;let EOe=0;const mg={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function VJ({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:i,resetTransform:s}){return class{constructor(u={},d=e==null?void 0:e()){this.id=EOe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,mg.totalNodes=mg.resolvedTargetDeltas=mg.recalculatedProjection=0,this.nodes.forEach(SOe),this.nodes.forEach(LOe),this.nodes.forEach(BOe),this.nodes.forEach(TOe),bOe(mg)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=u,this.root=d?d.root||d:this,this.path=d?[...d.path,d]:[],this.parent=d,this.depth=d?d.depth+1:0;for(let p=0;p<this.path.length;p++)this.path[p].shouldResetTransform=!0;this.root===this&&(this.nodes=new AOe)}addEventListener(u,d){return this.eventHandlers.has(u)||this.eventHandlers.set(u,new eO),this.eventHandlers.get(u).add(d)}notifyListeners(u,...d){const p=this.eventHandlers.get(u);p&&p.notify(...d)}hasListeners(u){return this.eventHandlers.has(u)}mount(u,d=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=xOe(u),this.instance=u;const{layoutId:p,layout:g,visualElement:x}=this.options;if(x&&!x.current&&x.mount(u),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),d&&(g||p)&&(this.isLayoutDirty=!0),n){let b;const E=()=>this.root.updateBlockedByResize=!1;n(u,()=>{this.root.updateBlockedByResize=!0,b&&b(),b=vOe(E,250),J_.hasAnimatedSinceResize&&(J_.hasAnimatedSinceResize=!1,this.nodes.forEach(wQ))})}p&&this.root.registerSharedNode(p,this),this.options.animate!==!1&&x&&(p||g)&&this.addEventListener("didUpdate",({delta:b,hasLayoutChanged:E,hasRelativeTargetChanged:S,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const R=this.options.transition||x.getDefaultTransition()||OOe,{onLayoutAnimationStart:P,onLayoutAnimationComplete:k}=x.getProps(),F=!this.targetLayout||!OJ(this.targetLayout,M)||S,V=!E&&S;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||V||E&&(F||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(b,V);const G={...jF(R,"layout"),onPlay:P,onComplete:k};(x.shouldReduceMotion||this.options.layoutRoot)&&(G.delay=0,G.type=!1),this.startAnimation(G)}else E||wQ(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const u=this.getStack();u&&u.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Dd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(POe),this.animationId++)}getTransformTemplate(){const{visualElement:u}=this.options;return u&&u.getProps().transformTemplate}willUpdate(u=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let x=0;x<this.path.length;x++){const b=this.path[x];b.shouldResetTransform=!0,b.updateScroll("snapshot"),b.options.layoutRoot&&b.willUpdate(!1)}const{layoutId:d,layout:p}=this.options;if(d===void 0&&!p)return;const g=this.getTransformTemplate();this.prevTransformTemplateValue=g?g(this.latestValues,""):void 0,this.updateSnapshot(),u&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(xQ);return}this.isUpdating||this.nodes.forEach(kOe),this.isUpdating=!1,this.nodes.forEach(ROe),this.nodes.forEach(_Oe),this.nodes.forEach(IOe),this.clearAllSnapshots();const d=performance.now();Qo.delta=Bp(0,1e3/60,d-Qo.timestamp),Qo.timestamp=d,Qo.isProcessing=!0,GL.update.process(Qo),GL.preRender.process(Qo),GL.render.process(Qo),Qo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(MOe),this.sharedNodes.forEach(NOe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,br.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){br.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let p=0;p<this.path.length;p++)this.path[p].updateScroll();const u=this.layout;this.layout=this.measure(!1),this.layoutCorrected=_s(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:d}=this.options;d&&d.notify("LayoutMeasure",this.layout.layoutBox,u?u.layoutBox:void 0)}updateScroll(u="measure"){let d=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===u&&(d=!1),d&&(this.scroll={animationId:this.root.animationId,phase:u,isRoot:i(this.instance),offset:t(this.instance)})}resetTransform(){if(!s)return;const u=this.isLayoutDirty||this.shouldResetTransform,d=this.projectionDelta&&!FJ(this.projectionDelta),p=this.getTransformTemplate(),g=p?p(this.latestValues,""):void 0,x=g!==this.prevTransformTemplateValue;u&&(d||pg(this.latestValues)||x)&&(s(this.instance,g),this.shouldResetTransform=!1,this.scheduleRender())}measure(u=!0){const d=this.measurePageBox();let p=this.removeElementScroll(d);return u&&(p=this.removeTransform(p)),VOe(p),{animationId:this.root.animationId,measuredBox:d,layoutBox:p,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:u}=this.options;if(!u)return _s();const d=u.measureViewportBox(),{scroll:p}=this.root;return p&&(Zf(d.x,p.offset.x),Zf(d.y,p.offset.y)),d}removeElementScroll(u){const d=_s();ec(d,u);for(let p=0;p<this.path.length;p++){const g=this.path[p],{scroll:x,options:b}=g;if(g!==this.root&&x&&b.layoutScroll){if(x.isRoot){ec(d,u);const{scroll:E}=this.root;E&&(Zf(d.x,-E.offset.x),Zf(d.y,-E.offset.y))}Zf(d.x,x.offset.x),Zf(d.y,x.offset.y)}}return d}applyTransform(u,d=!1){const p=_s();ec(p,u);for(let g=0;g<this.path.length;g++){const x=this.path[g];!d&&x.options.layoutScroll&&x.scroll&&x!==x.root&&qy(p,{x:-x.scroll.offset.x,y:-x.scroll.offset.y}),pg(x.latestValues)&&qy(p,x.latestValues)}return pg(this.latestValues)&&qy(p,this.latestValues),p}removeTransform(u){const d=_s();ec(d,u);for(let p=0;p<this.path.length;p++){const g=this.path[p];if(!g.instance||!pg(g.latestValues))continue;hD(g.latestValues)&&g.updateSnapshot();const x=_s(),b=g.measurePageBox();ec(x,b),mQ(d,g.latestValues,g.snapshot?g.snapshot.layoutBox:void 0,x)}return pg(this.latestValues)&&mQ(d,this.latestValues),d}setTargetDelta(u){this.targetDelta=u,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(u){this.options={...this.options,...u,crossfade:u.crossfade!==void 0?u.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Qo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(u=!1){var d;const p=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=p.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=p.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=p.isSharedProjectionDirty);const g=!!this.resumingFrom||this!==p;if(!(u||g&&this.isSharedProjectionDirty||this.isProjectionDirty||!((d=this.parent)===null||d===void 0)&&d.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:b,layoutId:E}=this.options;if(!(!this.layout||!(b||E))){if(this.resolvedRelativeTargetAt=Qo.timestamp,!this.targetDelta&&!this.relativeTarget){const S=this.getClosestProjectingParent();S&&S.layout&&this.animationProgress!==1?(this.relativeParent=S,this.forceRelativeParentToResolveTarget(),this.relativeTarget=_s(),this.relativeTargetOrigin=_s(),vx(this.relativeTargetOrigin,this.layout.layoutBox,S.layout.layoutBox),ec(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=_s(),this.targetWithTransforms=_s()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),UFe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ec(this.target,this.layout.layoutBox),RJ(this.target,this.targetDelta)):ec(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const S=this.getClosestProjectingParent();S&&!!S.resumingFrom==!!this.resumingFrom&&!S.options.layoutScroll&&S.target&&this.animationProgress!==1?(this.relativeParent=S,this.forceRelativeParentToResolveTarget(),this.relativeTarget=_s(),this.relativeTargetOrigin=_s(),vx(this.relativeTargetOrigin,this.target,S.target),ec(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}mg.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||hD(this.parent.latestValues)||kJ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var u;const d=this.getLead(),p=!!this.resumingFrom||this!==d;let g=!0;if((this.isProjectionDirty||!((u=this.parent)===null||u===void 0)&&u.isProjectionDirty)&&(g=!1),p&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(g=!1),this.resolvedRelativeTargetAt===Qo.timestamp&&(g=!1),g)return;const{layout:x,layoutId:b}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(x||b))return;ec(this.layoutCorrected,this.layout.layoutBox);const E=this.treeScale.x,S=this.treeScale.y;ZFe(this.layoutCorrected,this.treeScale,this.path,p),d.layout&&!d.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(d.target=d.layout.layoutBox);const{target:M}=d;if(!M){this.projectionTransform&&(this.projectionDelta=Yy(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Yy(),this.projectionDeltaWithTransform=Yy());const R=this.projectionTransform;Ax(this.projectionDelta,this.layoutCorrected,M,this.latestValues),this.projectionTransform=AQ(this.projectionDelta,this.treeScale),(this.projectionTransform!==R||this.treeScale.x!==E||this.treeScale.y!==S)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M)),mg.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(u=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),u){const d=this.getStack();d&&d.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(u,d=!1){const p=this.snapshot,g=p?p.latestValues:{},x={...this.latestValues},b=Yy();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!d;const E=_s(),S=p?p.source:void 0,M=this.layout?this.layout.source:void 0,R=S!==M,P=this.getStack(),k=!P||P.members.length<=1,F=!!(R&&!k&&this.options.crossfade===!0&&!this.path.some(FOe));this.animationProgress=0;let V;this.mixTargetDelta=G=>{const q=G/1e3;CQ(b.x,u.x,q),CQ(b.y,u.y,q),this.setTargetDelta(b),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(vx(E,this.layout.layoutBox,this.relativeParent.layout.layoutBox),DOe(this.relativeTarget,this.relativeTargetOrigin,E,q),V&&mOe(this.relativeTarget,V)&&(this.isProjectionDirty=!1),V||(V=_s()),ec(V,this.relativeTarget)),R&&(this.animationValues=x,cOe(x,g,this.latestValues,q,F,k)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=q},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(u){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Dd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=br.update(()=>{J_.hasAnimatedSinceResize=!0,this.currentAnimation=wOe(0,bQ,{...u,onUpdate:d=>{this.mixTargetDelta(d),u.onUpdate&&u.onUpdate(d)},onComplete:()=>{u.onComplete&&u.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const u=this.getStack();u&&u.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(bQ),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const u=this.getLead();let{targetWithTransforms:d,target:p,layout:g,latestValues:x}=u;if(!(!d||!p||!g)){if(this!==u&&this.layout&&g&&UJ(this.options.animationType,this.layout.layoutBox,g.layoutBox)){p=this.target||_s();const b=Rl(this.layout.layoutBox.x);p.x.min=u.target.x.min,p.x.max=p.x.min+b;const E=Rl(this.layout.layoutBox.y);p.y.min=u.target.y.min,p.y.max=p.y.min+E}ec(d,p),qy(d,x),Ax(this.projectionDeltaWithTransform,this.layoutCorrected,d,x)}}registerSharedNode(u,d){this.sharedNodes.has(u)||this.sharedNodes.set(u,new gOe),this.sharedNodes.get(u).add(d);const g=d.options.initialPromotionConfig;d.promote({transition:g?g.transition:void 0,preserveFollowOpacity:g&&g.shouldPreserveFollowOpacity?g.shouldPreserveFollowOpacity(d):void 0})}isLead(){const u=this.getStack();return u?u.lead===this:!0}getLead(){var u;const{layoutId:d}=this.options;return d?((u=this.getStack())===null||u===void 0?void 0:u.lead)||this:this}getPrevLead(){var u;const{layoutId:d}=this.options;return d?(u=this.getStack())===null||u===void 0?void 0:u.prevLead:void 0}getStack(){const{layoutId:u}=this.options;if(u)return this.root.sharedNodes.get(u)}promote({needsReset:u,transition:d,preserveFollowOpacity:p}={}){const g=this.getStack();g&&g.promote(this,p),u&&(this.projectionDelta=void 0,this.needsReset=!0),d&&this.setOptions({transition:d})}relegate(){const u=this.getStack();return u?u.relegate(this):!1}resetRotation(){const{visualElement:u}=this.options;if(!u)return;let d=!1;const{latestValues:p}=u;if((p.rotate||p.rotateX||p.rotateY||p.rotateZ)&&(d=!0),!d)return;const g={};for(let x=0;x<vQ.length;x++){const b="rotate"+vQ[x];p[b]&&(g[b]=p[b],u.setStaticValue(b,0))}u.render();for(const x in g)u.setStaticValue(x,g[x]);u.scheduleRender()}getProjectionStyles(u){var d,p;if(!this.instance||this.isSVG)return;if(!this.isVisible)return COe;const g={visibility:""},x=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,g.opacity="",g.pointerEvents=q_(u==null?void 0:u.pointerEvents)||"",g.transform=x?x(this.latestValues,""):"none",g;const b=this.getLead();if(!this.projectionDelta||!this.layout||!b.target){const R={};return this.options.layoutId&&(R.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,R.pointerEvents=q_(u==null?void 0:u.pointerEvents)||""),this.hasProjected&&!pg(this.latestValues)&&(R.transform=x?x({},""):"none",this.hasProjected=!1),R}const E=b.animationValues||b.latestValues;this.applyTransformsToTarget(),g.transform=AQ(this.projectionDeltaWithTransform,this.treeScale,E),x&&(g.transform=x(E,g.transform));const{x:S,y:M}=this.projectionDelta;g.transformOrigin=`${S.origin*100}% ${M.origin*100}% 0`,b.animationValues?g.opacity=b===this?(p=(d=E.opacity)!==null&&d!==void 0?d:this.latestValues.opacity)!==null&&p!==void 0?p:1:this.preserveOpacity?this.latestValues.opacity:E.opacityExit:g.opacity=b===this?E.opacity!==void 0?E.opacity:"":E.opacityExit!==void 0?E.opacityExit:0;for(const R in $I){if(E[R]===void 0)continue;const{correct:P,applyTo:k}=$I[R],F=g.transform==="none"?E[R]:P(E[R],b);if(k){const V=k.length;for(let G=0;G<V;G++)g[k[G]]=F}else g[R]=F}return this.options.layoutId&&(g.pointerEvents=b===this?q_(u==null?void 0:u.pointerEvents)||"":"none"),g}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(u=>{var d;return(d=u.currentAnimation)===null||d===void 0?void 0:d.stop()}),this.root.nodes.forEach(xQ),this.root.sharedNodes.clear()}}}function _Oe(n){n.updateLayout()}function IOe(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:s}=n.layout,{animationType:l}=n.options,u=t.source!==n.layout.source;l==="size"?ic(b=>{const E=u?t.measuredBox[b]:t.layoutBox[b],S=Rl(E);E.min=i[b].min,E.max=E.min+S}):UJ(l,t.layoutBox,i)&&ic(b=>{const E=u?t.measuredBox[b]:t.layoutBox[b],S=Rl(i[b]);E.max=E.min+S,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[b].max=n.relativeTarget[b].min+S)});const d=Yy();Ax(d,i,t.layoutBox);const p=Yy();u?Ax(p,n.applyTransform(s,!0),t.measuredBox):Ax(p,i,t.layoutBox);const g=!FJ(d);let x=!1;if(!n.resumeFrom){const b=n.getClosestProjectingParent();if(b&&!b.resumeFrom){const{snapshot:E,layout:S}=b;if(E&&S){const M=_s();vx(M,t.layoutBox,E.layoutBox);const R=_s();vx(R,i,S.layoutBox),OJ(M,R)||(x=!0),b.options.layoutRoot&&(n.relativeTarget=R,n.relativeTargetOrigin=M,n.relativeParent=b)}}}n.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:p,layoutDelta:d,hasLayoutChanged:g,hasRelativeTargetChanged:x})}else if(n.isLead()){const{onExitComplete:i}=n.options;i&&i()}n.options.transition=void 0}function SOe(n){mg.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function TOe(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function MOe(n){n.clearSnapshot()}function xQ(n){n.clearMeasurements()}function kOe(n){n.isLayoutDirty=!1}function ROe(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function wQ(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function LOe(n){n.resolveTargetDelta()}function BOe(n){n.calcProjection()}function POe(n){n.resetRotation()}function NOe(n){n.removeLeadSnapshot()}function CQ(n,e,t){n.translate=Dr(e.translate,0,t),n.scale=Dr(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function EQ(n,e,t,i){n.min=Dr(e.min,t.min,i),n.max=Dr(e.max,t.max,i)}function DOe(n,e,t,i){EQ(n.x,e.x,t.x,i),EQ(n.y,e.y,t.y,i)}function FOe(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const OOe={duration:.45,ease:[.4,0,.1,1]},_Q=n=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(n),IQ=_Q("applewebkit/")&&!_Q("chrome/")?Math.round:cs;function SQ(n){n.min=IQ(n.min),n.max=IQ(n.max)}function VOe(n){SQ(n.x),SQ(n.y)}function UJ(n,e,t){return n==="position"||n==="preserve-aspect"&&!cD(yQ(e),yQ(t),.2)}const UOe=VJ({attachResizeListener:(n,e)=>gd(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),JL={current:void 0},zJ=VJ({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!JL.current){const n=new UOe({});n.mount(window),n.setOptions({layoutScroll:!0}),JL.current=n}return JL.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),zOe={pan:{Feature:iOe},drag:{Feature:nOe,ProjectionNode:zJ,MeasureLayout:PJ}},GOe=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function WOe(n){const e=GOe.exec(n);if(!e)return[,];const[,t,i]=e;return[t,i]}function fD(n,e,t=1){const[i,s]=WOe(n);if(!i)return;const l=window.getComputedStyle(e).getPropertyValue(i);if(l){const u=l.trim();return CJ(u)?parseFloat(u):u}else return nD(s)?fD(s,e,t+1):s}function HOe(n,{...e},t){const i=n.current;if(!(i instanceof Element))return{target:e,transitionEnd:t};t&&(t={...t}),n.values.forEach(s=>{const l=s.get();if(!nD(l))return;const u=fD(l,i);u&&s.set(u)});for(const s in e){const l=e[s];if(!nD(l))continue;const u=fD(l,i);u&&(e[s]=u,t||(t={}),t[s]===void 0&&(t[s]=l))}return{target:e,transitionEnd:t}}const XOe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),GJ=n=>XOe.has(n),$Oe=n=>Object.keys(n).some(GJ),TQ=n=>n===s0||n===Qn,MQ=(n,e)=>parseFloat(n.split(", ")[e]),kQ=(n,e)=>(t,{transform:i})=>{if(i==="none"||!i)return 0;const s=i.match(/^matrix3d\((.+)\)$/);if(s)return MQ(s[1],e);{const l=i.match(/^matrix\((.+)\)$/);return l?MQ(l[1],n):0}},QOe=new Set(["x","y","z"]),KOe=X1.filter(n=>!QOe.has(n));function ZOe(n){const e=[];return KOe.forEach(t=>{const i=n.getValue(t);i!==void 0&&(e.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),e.length&&n.render(),e}const kA={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:kQ(4,13),y:kQ(5,14)};kA.translateX=kA.x;kA.translateY=kA.y;const jOe=(n,e,t)=>{const i=e.measureViewportBox(),s=e.current,l=getComputedStyle(s),{display:u}=l,d={};u==="none"&&e.setStaticValue("display",n.display||"block"),t.forEach(g=>{d[g]=kA[g](i,l)}),e.render();const p=e.measureViewportBox();return t.forEach(g=>{const x=e.getValue(g);x&&x.jump(d[g]),n[g]=kA[g](p,l)}),n},YOe=(n,e,t={},i={})=>{e={...e},i={...i};const s=Object.keys(e).filter(GJ);let l=[],u=!1;const d=[];if(s.forEach(p=>{const g=n.getValue(p);if(!n.hasValue(p))return;let x=t[p],b=wb(x);const E=e[p];let S;if(KI(E)){const M=E.length,R=E[0]===null?1:0;x=E[R],b=wb(x);for(let P=R;P<M&&E[P]!==null;P++)S?XF(wb(E[P])===S):S=wb(E[P])}else S=wb(E);if(b!==S)if(TQ(b)&&TQ(S)){const M=g.get();typeof M=="string"&&g.set(parseFloat(M)),typeof E=="string"?e[p]=parseFloat(E):Array.isArray(E)&&S===Qn&&(e[p]=E.map(parseFloat))}else b!=null&&b.transform&&(S!=null&&S.transform)&&(x===0||E===0)?x===0?g.set(S.transform(x)):e[p]=b.transform(E):(u||(l=ZOe(n),u=!0),d.push(p),i[p]=i[p]!==void 0?i[p]:e[p],g.jump(E))}),d.length){const p=d.indexOf("height")>=0?window.pageYOffset:null,g=jOe(e,n,d);return l.length&&l.forEach(([x,b])=>{n.getValue(x).set(b)}),n.render(),HS&&p!==null&&window.scrollTo({top:p}),{target:g,transitionEnd:i}}else return{target:e,transitionEnd:i}};function qOe(n,e,t,i){return $Oe(e)?YOe(n,e,t,i):{target:e,transitionEnd:i}}const JOe=(n,e,t,i)=>{const s=HOe(n,e,i);return e=s.target,i=s.transitionEnd,qOe(n,e,t,i)},pD={current:null},WJ={current:!1};function eVe(){if(WJ.current=!0,!!HS)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>pD.current=n.matches;n.addListener(e),e()}else pD.current=!1}function tVe(n,e,t){const{willChange:i}=e;for(const s in e){const l=e[s],u=t[s];if(rl(l))n.addValue(s,l),qI(i)&&i.add(s);else if(rl(u))n.addValue(s,MA(l,{owner:n})),qI(i)&&i.remove(s);else if(u!==l)if(n.hasValue(s)){const d=n.getValue(s);!d.hasAnimated&&d.set(l)}else{const d=n.getStaticValue(s);n.addValue(s,MA(d!==void 0?d:l,{owner:n}))}}for(const s in t)e[s]===void 0&&n.removeValue(s);return e}const RQ=new WeakMap,HJ=Object.keys(i1),nVe=HJ.length,LQ=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],iVe=DF.length;class rVe{constructor({parent:e,props:t,presenceContext:i,reducedMotionConfig:s,visualState:l},u={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>br.render(this.render,!1,!0);const{latestValues:d,renderState:p}=l;this.latestValues=d,this.baseTarget={...d},this.initialValues=t.initial?{...d}:{},this.renderState=p,this.parent=e,this.props=t,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=u,this.isControllingVariants=$S(t),this.isVariantNode=Tq(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:g,...x}=this.scrapeMotionValuesFromProps(t,{});for(const b in x){const E=x[b];d[b]!==void 0&&rl(E)&&(E.set(d[b],!1),qI(g)&&g.add(b))}}scrapeMotionValuesFromProps(e,t){return{}}mount(e){this.current=e,RQ.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,i)=>this.bindToMotionValue(i,t)),WJ.current||eVe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:pD.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){RQ.delete(this.current),this.projection&&this.projection.unmount(),Dd(this.notifyUpdate),Dd(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,t){const i=r0.has(e),s=t.on("change",u=>{this.latestValues[e]=u,this.props.onUpdate&&br.update(this.notifyUpdate,!1,!0),i&&this.projection&&(this.projection.isTransformDirty=!0)}),l=t.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{s(),l()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...t},i,s,l){let u,d;for(let p=0;p<nVe;p++){const g=HJ[p],{isEnabled:x,Feature:b,ProjectionNode:E,MeasureLayout:S}=i1[g];E&&(u=E),x(t)&&(!this.features[g]&&b&&(this.features[g]=new b(this)),S&&(d=S))}if((this.type==="html"||this.type==="svg")&&!this.projection&&u){this.projection=new u(this.latestValues,this.parent&&this.parent.projection);const{layoutId:p,layout:g,drag:x,dragConstraints:b,layoutScroll:E,layoutRoot:S}=t;this.projection.setOptions({layoutId:p,layout:g,alwaysMeasureLayout:!!x||b&&Zy(b),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof g=="string"?g:"both",initialPromotionConfig:l,layoutScroll:E,layoutRoot:S})}return d}updateFeatures(){for(const e in this.features){const t=this.features[e];t.isMounted?t.update():(t.mount(),t.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):_s()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}makeTargetAnimatable(e,t=!0){return this.makeTargetAnimatableFromInstance(e,this.props,t)}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let i=0;i<LQ.length;i++){const s=LQ[i];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const l=e["on"+s];l&&(this.propEventSubscriptions[s]=this.on(s,l))}this.prevMotionValues=tVe(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const i=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(i.initial=this.props.initial),i}const t={};for(let i=0;i<iVe;i++){const s=DF[i],l=this.props[s];(n1(l)||l===!1)&&(t[s]=l)}return t}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){t!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,t)),this.values.set(e,t),this.latestValues[e]=t.get()}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&t!==void 0&&(i=MA(t,{owner:this}),this.addValue(e,i)),i}readValue(e){var t;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(t=this.getBaseTargetFromProps(this.props,e))!==null&&t!==void 0?t:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:i}=this.props,s=typeof i=="string"||typeof i=="object"?(t=HF(this.props,i))===null||t===void 0?void 0:t[e]:void 0;if(i&&s!==void 0)return s;const l=this.getBaseTargetFromProps(this.props,e);return l!==void 0&&!rl(l)?l:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new eO),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class XJ extends rVe{sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:i}){delete t[e],delete i[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:t,...i},{transformValues:s},l){let u=xFe(i,e||{},this);if(s&&(t&&(t=s(t)),i&&(i=s(i)),u&&(u=s(u))),l){vFe(this,i,u);const d=JOe(this,i,u,t);t=d.transitionEnd,i=d.target}return{transition:e,transitionEnd:t,...i}}}function sVe(n){return window.getComputedStyle(n)}class oVe extends XJ{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,t){if(r0.has(t)){const i=ZF(t);return i&&i.default||0}else{const i=sVe(e),s=(Lq(t)?i.getPropertyValue(t):i[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return LJ(e,t)}build(e,t,i,s){VF(e,t,i,s.transformTemplate)}scrapeMotionValuesFromProps(e,t){return WF(e,t)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;rl(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}renderInstance(e,t,i,s){Oq(e,t,i,s)}}class aVe extends XJ{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(r0.has(t)){const i=ZF(t);return i&&i.default||0}return t=Vq.has(t)?t:PF(t),e.getAttribute(t)}measureInstanceViewportBox(){return _s()}scrapeMotionValuesFromProps(e,t){return zq(e,t)}build(e,t,i,s){zF(e,t,i,this.isSVGTag,s.transformTemplate)}renderInstance(e,t,i,s){Uq(e,t,i,s)}mount(e){this.isSVGTag=GF(e.tagName),super.mount(e)}}const lVe=(n,e)=>OF(n)?new aVe(e,{enableHardwareAcceleration:!1}):new oVe(e,{enableHardwareAcceleration:!0}),cVe={layout:{ProjectionNode:zJ,MeasureLayout:PJ}},uVe={...DFe,...n3e,...zOe,...cVe},Mn=hDe((n,e)=>WDe(n,e,uVe,lVe));function $J(){const n=Le.useRef(!1);return BF(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function hVe(){const n=$J(),[e,t]=Le.useState(0),i=Le.useCallback(()=>{n.current&&t(e+1)},[e]);return[Le.useCallback(()=>br.postRender(i),[i]),e]}class dVe extends Le.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const i=this.props.sizeRef.current;i.height=t.offsetHeight||0,i.width=t.offsetWidth||0,i.top=t.offsetTop,i.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function fVe({children:n,isPresent:e}){const t=Le.useId(),i=Le.useRef(null),s=Le.useRef({width:0,height:0,top:0,left:0});return Le.useInsertionEffect(()=>{const{width:l,height:u,top:d,left:p}=s.current;if(e||!i.current||!l||!u)return;i.current.dataset.motionPopId=t;const g=document.createElement("style");return document.head.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${u}px !important;
            top: ${d}px !important;
            left: ${p}px !important;
          }
        `),()=>{document.head.removeChild(g)}},[e]),Le.createElement(dVe,{isPresent:e,childRef:i,sizeRef:s},Le.cloneElement(n,{ref:i}))}const eB=({children:n,initial:e,isPresent:t,onExitComplete:i,custom:s,presenceAffectsLayout:l,mode:u})=>{const d=Gq(pVe),p=Le.useId(),g=Le.useMemo(()=>({id:p,initial:e,isPresent:t,custom:s,onExitComplete:x=>{d.set(x,!0);for(const b of d.values())if(!b)return;i&&i()},register:x=>(d.set(x,!1),()=>d.delete(x))}),l?void 0:[t]);return Le.useMemo(()=>{d.forEach((x,b)=>d.set(b,!1))},[t]),Le.useEffect(()=>{!t&&!d.size&&i&&i()},[t]),u==="popLayout"&&(n=Le.createElement(fVe,{isPresent:t},n)),Le.createElement(WS.Provider,{value:g},n)};function pVe(){return new Map}function mVe(n){return Le.useEffect(()=>()=>n(),[])}const gg=n=>n.key||"";function gVe(n,e){n.forEach(t=>{const i=gg(t);e.set(i,t)})}function yVe(n){const e=[];return Le.Children.forEach(n,t=>{Le.isValidElement(t)&&e.push(t)}),e}const RA=({children:n,custom:e,initial:t=!0,onExitComplete:i,exitBeforeEnter:s,presenceAffectsLayout:l=!0,mode:u="sync"})=>{const d=Le.useContext(FF).forceRender||hVe()[0],p=$J(),g=yVe(n);let x=g;const b=Le.useRef(new Map).current,E=Le.useRef(x),S=Le.useRef(new Map).current,M=Le.useRef(!0);if(BF(()=>{M.current=!1,gVe(g,S),E.current=x}),mVe(()=>{M.current=!0,S.clear(),b.clear()}),M.current)return Le.createElement(Le.Fragment,null,x.map(F=>Le.createElement(eB,{key:gg(F),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:l,mode:u},F)));x=[...x];const R=E.current.map(gg),P=g.map(gg),k=R.length;for(let F=0;F<k;F++){const V=R[F];P.indexOf(V)===-1&&!b.has(V)&&b.set(V,void 0)}return u==="wait"&&b.size&&(x=[]),b.forEach((F,V)=>{if(P.indexOf(V)!==-1)return;const G=S.get(V);if(!G)return;const q=R.indexOf(V);let ne=F;if(!ne){const K=()=>{b.delete(V);const Q=Array.from(S.keys()).filter(H=>!P.includes(H));if(Q.forEach(H=>S.delete(H)),E.current=g.filter(H=>{const j=gg(H);return j===V||Q.includes(j)}),!b.size){if(p.current===!1)return;d(),i&&i()}};ne=Le.createElement(eB,{key:gg(G),isPresent:!1,onExitComplete:K,custom:e,presenceAffectsLayout:l,mode:u},G),b.set(V,ne)}x.splice(q,0,ne)}),x=x.map(F=>{const V=F.key;return b.has(V)?F:Le.createElement(eB,{key:gg(F),isPresent:!0,presenceAffectsLayout:l,mode:u},F)}),Le.createElement(Le.Fragment,null,b.size?x:x.map(F=>Le.cloneElement(F)))},AVe=()=>{};var BQ={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QJ=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},vVe=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const l=n[t++];e[i++]=String.fromCharCode((s&31)<<6|l&63)}else if(s>239&&s<365){const l=n[t++],u=n[t++],d=n[t++],p=((s&7)<<18|(l&63)<<12|(u&63)<<6|d&63)-65536;e[i++]=String.fromCharCode(55296+(p>>10)),e[i++]=String.fromCharCode(56320+(p&1023))}else{const l=n[t++],u=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(l&63)<<6|u&63)}}return e.join("")},KJ={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const l=n[s],u=s+1<n.length,d=u?n[s+1]:0,p=s+2<n.length,g=p?n[s+2]:0,x=l>>2,b=(l&3)<<4|d>>4;let E=(d&15)<<2|g>>6,S=g&63;p||(S=64,u||(E=64)),i.push(t[x],t[b],t[E],t[S])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(QJ(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):vVe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const l=t[n.charAt(s++)],d=s<n.length?t[n.charAt(s)]:0;++s;const g=s<n.length?t[n.charAt(s)]:64;++s;const b=s<n.length?t[n.charAt(s)]:64;if(++s,l==null||d==null||g==null||b==null)throw new bVe;const E=l<<2|d>>4;if(i.push(E),g!==64){const S=d<<4&240|g>>2;if(i.push(S),b!==64){const M=g<<6&192|b;i.push(M)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class bVe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const xVe=function(n){const e=QJ(n);return KJ.encodeByteArray(e,!0)},e2=function(n){return xVe(n).replace(/\./g,"")},ZJ=function(n){try{return KJ.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wVe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CVe=()=>wVe().__FIREBASE_DEFAULTS__,EVe=()=>{if(typeof process>"u"||typeof BQ>"u")return;const n=BQ.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},_Ve=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ZJ(n[1]);return e&&JSON.parse(e)},jS=()=>{try{return AVe()||CVe()||EVe()||_Ve()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},jJ=n=>{var e,t;return(t=(e=jS())==null?void 0:e.emulatorHosts)==null?void 0:t[n]},YJ=n=>{const e=jJ(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},qJ=()=>{var n;return(n=jS())==null?void 0:n.config},JJ=n=>{var e;return(e=jS())==null?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o0(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tO(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eee(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,l=n.sub||n.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...n};return[e2(JSON.stringify(t)),e2(JSON.stringify(u)),""].join(".")}const bx={};function SVe(){const n={prod:[],emulator:[]};for(const e of Object.keys(bx))bx[e]?n.emulator.push(e):n.prod.push(e);return n}function TVe(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let PQ=!1;function nO(n,e){if(typeof window>"u"||typeof document>"u"||!o0(window.location.host)||bx[n]===e||bx[n]||PQ)return;bx[n]=e;function t(E){return`__firebase__banner__${E}`}const i="__firebase__banner",l=SVe().prod.length>0;function u(){const E=document.getElementById(i);E&&E.remove()}function d(E){E.style.display="flex",E.style.background="#7faaf0",E.style.position="fixed",E.style.bottom="5px",E.style.left="5px",E.style.padding=".5em",E.style.borderRadius="5px",E.style.alignItems="center"}function p(E,S){E.setAttribute("width","24"),E.setAttribute("id",S),E.setAttribute("height","24"),E.setAttribute("viewBox","0 0 24 24"),E.setAttribute("fill","none"),E.style.marginLeft="-6px"}function g(){const E=document.createElement("span");return E.style.cursor="pointer",E.style.marginLeft="16px",E.style.fontSize="24px",E.innerHTML=" &times;",E.onclick=()=>{PQ=!0,u()},E}function x(E,S){E.setAttribute("id",S),E.innerText="Learn more",E.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",E.setAttribute("target","__blank"),E.style.paddingLeft="5px",E.style.textDecoration="underline"}function b(){const E=TVe(i),S=t("text"),M=document.getElementById(S)||document.createElement("span"),R=t("learnmore"),P=document.getElementById(R)||document.createElement("a"),k=t("preprendIcon"),F=document.getElementById(k)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(E.created){const V=E.element;d(V),x(P,R);const G=g();p(F,k),V.append(F,M,P,G),document.body.appendChild(V)}l?(M.innerText="Preview backend disconnected.",F.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(F.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,M.innerText="Preview backend running in this workspace."),M.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function MVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jo())}function kVe(){var e;const n=(e=jS())==null?void 0:e.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function RVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function LVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function BVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function PVe(){const n=Jo();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function NVe(){return!kVe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function DVe(){try{return typeof indexedDB=="object"}catch{return!1}}function FVe(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var l;e(((l=s.error)==null?void 0:l.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OVe="FirebaseError";class xh extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=OVe,Object.setPrototypeOf(this,xh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Z1.prototype.create)}}class Z1{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,l=this.errors[e],u=l?VVe(l,i):"Error",d=`${this.serviceName}: ${u} (${s}).`;return new xh(s,d,i)}}function VVe(n,e){return n.replace(UVe,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const UVe=/\{\$([^}]+)}/g;function zVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xg(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const l=n[s],u=e[s];if(NQ(l)&&NQ(u)){if(!Xg(l,u))return!1}else if(l!==u)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function NQ(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j1(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function GVe(n,e){const t=new WVe(n,e);return t.subscribe.bind(t)}class WVe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let s;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");HVe(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:i},s.next===void 0&&(s.next=tB),s.error===void 0&&(s.error=tB),s.complete===void 0&&(s.complete=tB);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function HVe(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function tB(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(n){return n&&n._delegate?n._delegate:n}class Np{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yg="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XVe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new IVe;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(QVe(e))try{this.getOrInitializeService({instanceIdentifier:yg})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:s});i.resolve(l)}catch{}}}}clearInstance(e=yg){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=yg){return this.instances.has(e)}getOptions(e=yg){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[l,u]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(l);i===d&&u.resolve(s)}return s}onInit(e,t){const i=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);const l=this.instances.get(i);return l&&e(l,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:$Ve(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=yg){return this.component?this.component.multipleInstances?e:yg:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function $Ve(n){return n===yg?void 0:n}function QVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new XVe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Si;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Si||(Si={}));const ZVe={debug:Si.DEBUG,verbose:Si.VERBOSE,info:Si.INFO,warn:Si.WARN,error:Si.ERROR,silent:Si.SILENT},jVe=Si.INFO,YVe={[Si.DEBUG]:"log",[Si.VERBOSE]:"log",[Si.INFO]:"info",[Si.WARN]:"warn",[Si.ERROR]:"error"},qVe=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=YVe[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class iO{constructor(e){this.name=e,this._logLevel=jVe,this._logHandler=qVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Si))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?ZVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Si.DEBUG,...e),this._logHandler(this,Si.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Si.VERBOSE,...e),this._logHandler(this,Si.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Si.INFO,...e),this._logHandler(this,Si.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Si.WARN,...e),this._logHandler(this,Si.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Si.ERROR,...e),this._logHandler(this,Si.ERROR,...e)}}const JVe=(n,e)=>e.some(t=>n instanceof t);let DQ,FQ;function eUe(){return DQ||(DQ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tUe(){return FQ||(FQ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tee=new WeakMap,mD=new WeakMap,nee=new WeakMap,nB=new WeakMap,rO=new WeakMap;function nUe(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",l),n.removeEventListener("error",u)},l=()=>{t(bp(n.result)),s()},u=()=>{i(n.error),s()};n.addEventListener("success",l),n.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&tee.set(t,n)}).catch(()=>{}),rO.set(e,n),e}function iUe(n){if(mD.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",l),n.removeEventListener("error",u),n.removeEventListener("abort",u)},l=()=>{t(),s()},u=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",l),n.addEventListener("error",u),n.addEventListener("abort",u)});mD.set(n,e)}let gD={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return mD.get(n);if(e==="objectStoreNames")return n.objectStoreNames||nee.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bp(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function rUe(n){gD=n(gD)}function sUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(iB(this),e,...t);return nee.set(i,e.sort?e.sort():[e]),bp(i)}:tUe().includes(n)?function(...e){return n.apply(iB(this),e),bp(tee.get(this))}:function(...e){return bp(n.apply(iB(this),e))}}function oUe(n){return typeof n=="function"?sUe(n):(n instanceof IDBTransaction&&iUe(n),JVe(n,eUe())?new Proxy(n,gD):n)}function bp(n){if(n instanceof IDBRequest)return nUe(n);if(nB.has(n))return nB.get(n);const e=oUe(n);return e!==n&&(nB.set(n,e),rO.set(e,n)),e}const iB=n=>rO.get(n);function aUe(n,e,{blocked:t,upgrade:i,blocking:s,terminated:l}={}){const u=indexedDB.open(n,e),d=bp(u);return i&&u.addEventListener("upgradeneeded",p=>{i(bp(u.result),p.oldVersion,p.newVersion,bp(u.transaction),p)}),t&&u.addEventListener("blocked",p=>t(p.oldVersion,p.newVersion,p)),d.then(p=>{l&&p.addEventListener("close",()=>l()),s&&p.addEventListener("versionchange",g=>s(g.oldVersion,g.newVersion,g))}).catch(()=>{}),d}const lUe=["get","getKey","getAll","getAllKeys","count"],cUe=["put","add","delete","clear"],rB=new Map;function OQ(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(rB.get(e))return rB.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=cUe.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||lUe.includes(t)))return;const l=async function(u,...d){const p=this.transaction(u,s?"readwrite":"readonly");let g=p.store;return i&&(g=g.index(d.shift())),(await Promise.all([g[t](...d),s&&p.done]))[0]};return rB.set(e,l),l}rUe(n=>({...n,get:(e,t,i)=>OQ(e,t)||n.get(e,t,i),has:(e,t)=>!!OQ(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uUe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(hUe(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function hUe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const yD="@firebase/app",VQ="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fd=new iO("@firebase/app"),dUe="@firebase/app-compat",fUe="@firebase/analytics-compat",pUe="@firebase/analytics",mUe="@firebase/app-check-compat",gUe="@firebase/app-check",yUe="@firebase/auth",AUe="@firebase/auth-compat",vUe="@firebase/database",bUe="@firebase/data-connect",xUe="@firebase/database-compat",wUe="@firebase/functions",CUe="@firebase/functions-compat",EUe="@firebase/installations",_Ue="@firebase/installations-compat",IUe="@firebase/messaging",SUe="@firebase/messaging-compat",TUe="@firebase/performance",MUe="@firebase/performance-compat",kUe="@firebase/remote-config",RUe="@firebase/remote-config-compat",LUe="@firebase/storage",BUe="@firebase/storage-compat",PUe="@firebase/firestore",NUe="@firebase/ai",DUe="@firebase/firestore-compat",FUe="firebase",OUe="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AD="[DEFAULT]",VUe={[yD]:"fire-core",[dUe]:"fire-core-compat",[pUe]:"fire-analytics",[fUe]:"fire-analytics-compat",[gUe]:"fire-app-check",[mUe]:"fire-app-check-compat",[yUe]:"fire-auth",[AUe]:"fire-auth-compat",[vUe]:"fire-rtdb",[bUe]:"fire-data-connect",[xUe]:"fire-rtdb-compat",[wUe]:"fire-fn",[CUe]:"fire-fn-compat",[EUe]:"fire-iid",[_Ue]:"fire-iid-compat",[IUe]:"fire-fcm",[SUe]:"fire-fcm-compat",[TUe]:"fire-perf",[MUe]:"fire-perf-compat",[kUe]:"fire-rc",[RUe]:"fire-rc-compat",[LUe]:"fire-gcs",[BUe]:"fire-gcs-compat",[PUe]:"fire-fst",[DUe]:"fire-fst-compat",[NUe]:"fire-vertex","fire-js":"fire-js",[FUe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=new Map,UUe=new Map,vD=new Map;function UQ(n,e){try{n.container.addComponent(e)}catch(t){Fd.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function $g(n){const e=n.name;if(vD.has(e))return Fd.debug(`There were multiple attempts to register component ${e}.`),!1;vD.set(e,n);for(const t of t2.values())UQ(t,n);for(const t of UUe.values())UQ(t,n);return!0}function YS(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ac(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zUe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},xp=new Z1("app","Firebase",zUe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GUe{constructor(e,t,i){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Np("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw xp.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a0=OUe;function iee(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i={name:AD,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw xp.create("bad-app-name",{appName:String(s)});if(t||(t=qJ()),!t)throw xp.create("no-options");const l=t2.get(s);if(l){if(Xg(t,l.options)&&Xg(i,l.config))return l;throw xp.create("duplicate-app",{appName:s})}const u=new KVe(s);for(const p of vD.values())u.addComponent(p);const d=new GUe(t,i,u);return t2.set(s,d),d}function sO(n=AD){const e=t2.get(n);if(!e&&n===AD&&qJ())return iee();if(!e)throw xp.create("no-app",{appName:n});return e}function lh(n,e,t){let i=VUe[n]??n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),l=e.match(/\s|\//);if(s||l){const u=[`Unable to register library "${i}" with version "${e}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&l&&u.push("and"),l&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Fd.warn(u.join(" "));return}$g(new Np(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WUe="firebase-heartbeat-database",HUe=1,s1="firebase-heartbeat-store";let sB=null;function ree(){return sB||(sB=aUe(WUe,HUe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(s1)}catch(t){console.warn(t)}}}}).catch(n=>{throw xp.create("idb-open",{originalErrorMessage:n.message})})),sB}async function XUe(n){try{const t=(await ree()).transaction(s1),i=await t.objectStore(s1).get(see(n));return await t.done,i}catch(e){if(e instanceof xh)Fd.warn(e.message);else{const t=xp.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Fd.warn(t.message)}}}async function zQ(n,e){try{const i=(await ree()).transaction(s1,"readwrite");await i.objectStore(s1).put(e,see(n)),await i.done}catch(t){if(t instanceof xh)Fd.warn(t.message);else{const i=xp.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Fd.warn(i.message)}}}function see(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Ue=1024,QUe=30;class KUe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new jUe(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=GQ();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)==null?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(u=>u.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:s}),this._heartbeatsCache.heartbeats.length>QUe){const u=YUe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(u,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Fd.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=GQ(),{heartbeatsToSend:i,unsentEntries:s}=ZUe(this._heartbeatsCache.heartbeats),l=e2(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(t){return Fd.warn(t),""}}}function GQ(){return new Date().toISOString().substring(0,10)}function ZUe(n,e=$Ue){const t=[];let i=n.slice();for(const s of n){const l=t.find(u=>u.agent===s.agent);if(l){if(l.dates.push(s.date),WQ(t)>e){l.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),WQ(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class jUe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return DVe()?FVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await XUe(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return zQ(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return zQ(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function WQ(n){return e2(JSON.stringify({version:2,heartbeats:n})).length}function YUe(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qUe(n){$g(new Np("platform-logger",e=>new uUe(e),"PRIVATE")),$g(new Np("heartbeat",e=>new KUe(e),"PRIVATE")),lh(yD,VQ,n),lh(yD,VQ,"esm2020"),lh("fire-js","")}qUe("");var HQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var wp,oee;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(K,Q){function H(){}H.prototype=Q.prototype,K.F=Q.prototype,K.prototype=new H,K.prototype.constructor=K,K.D=function(j,ee,de){for(var oe=Array(arguments.length-2),we=2;we<arguments.length;we++)oe[we-2]=arguments[we];return Q.prototype[ee].apply(j,oe)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,t),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(K,Q,H){H||(H=0);const j=Array(16);if(typeof Q=="string")for(var ee=0;ee<16;++ee)j[ee]=Q.charCodeAt(H++)|Q.charCodeAt(H++)<<8|Q.charCodeAt(H++)<<16|Q.charCodeAt(H++)<<24;else for(ee=0;ee<16;++ee)j[ee]=Q[H++]|Q[H++]<<8|Q[H++]<<16|Q[H++]<<24;Q=K.g[0],H=K.g[1],ee=K.g[2];let de=K.g[3],oe;oe=Q+(de^H&(ee^de))+j[0]+3614090360&4294967295,Q=H+(oe<<7&4294967295|oe>>>25),oe=de+(ee^Q&(H^ee))+j[1]+3905402710&4294967295,de=Q+(oe<<12&4294967295|oe>>>20),oe=ee+(H^de&(Q^H))+j[2]+606105819&4294967295,ee=de+(oe<<17&4294967295|oe>>>15),oe=H+(Q^ee&(de^Q))+j[3]+3250441966&4294967295,H=ee+(oe<<22&4294967295|oe>>>10),oe=Q+(de^H&(ee^de))+j[4]+4118548399&4294967295,Q=H+(oe<<7&4294967295|oe>>>25),oe=de+(ee^Q&(H^ee))+j[5]+1200080426&4294967295,de=Q+(oe<<12&4294967295|oe>>>20),oe=ee+(H^de&(Q^H))+j[6]+2821735955&4294967295,ee=de+(oe<<17&4294967295|oe>>>15),oe=H+(Q^ee&(de^Q))+j[7]+4249261313&4294967295,H=ee+(oe<<22&4294967295|oe>>>10),oe=Q+(de^H&(ee^de))+j[8]+1770035416&4294967295,Q=H+(oe<<7&4294967295|oe>>>25),oe=de+(ee^Q&(H^ee))+j[9]+2336552879&4294967295,de=Q+(oe<<12&4294967295|oe>>>20),oe=ee+(H^de&(Q^H))+j[10]+4294925233&4294967295,ee=de+(oe<<17&4294967295|oe>>>15),oe=H+(Q^ee&(de^Q))+j[11]+2304563134&4294967295,H=ee+(oe<<22&4294967295|oe>>>10),oe=Q+(de^H&(ee^de))+j[12]+1804603682&4294967295,Q=H+(oe<<7&4294967295|oe>>>25),oe=de+(ee^Q&(H^ee))+j[13]+4254626195&4294967295,de=Q+(oe<<12&4294967295|oe>>>20),oe=ee+(H^de&(Q^H))+j[14]+2792965006&4294967295,ee=de+(oe<<17&4294967295|oe>>>15),oe=H+(Q^ee&(de^Q))+j[15]+1236535329&4294967295,H=ee+(oe<<22&4294967295|oe>>>10),oe=Q+(ee^de&(H^ee))+j[1]+4129170786&4294967295,Q=H+(oe<<5&4294967295|oe>>>27),oe=de+(H^ee&(Q^H))+j[6]+3225465664&4294967295,de=Q+(oe<<9&4294967295|oe>>>23),oe=ee+(Q^H&(de^Q))+j[11]+643717713&4294967295,ee=de+(oe<<14&4294967295|oe>>>18),oe=H+(de^Q&(ee^de))+j[0]+3921069994&4294967295,H=ee+(oe<<20&4294967295|oe>>>12),oe=Q+(ee^de&(H^ee))+j[5]+3593408605&4294967295,Q=H+(oe<<5&4294967295|oe>>>27),oe=de+(H^ee&(Q^H))+j[10]+38016083&4294967295,de=Q+(oe<<9&4294967295|oe>>>23),oe=ee+(Q^H&(de^Q))+j[15]+3634488961&4294967295,ee=de+(oe<<14&4294967295|oe>>>18),oe=H+(de^Q&(ee^de))+j[4]+3889429448&4294967295,H=ee+(oe<<20&4294967295|oe>>>12),oe=Q+(ee^de&(H^ee))+j[9]+568446438&4294967295,Q=H+(oe<<5&4294967295|oe>>>27),oe=de+(H^ee&(Q^H))+j[14]+3275163606&4294967295,de=Q+(oe<<9&4294967295|oe>>>23),oe=ee+(Q^H&(de^Q))+j[3]+4107603335&4294967295,ee=de+(oe<<14&4294967295|oe>>>18),oe=H+(de^Q&(ee^de))+j[8]+1163531501&4294967295,H=ee+(oe<<20&4294967295|oe>>>12),oe=Q+(ee^de&(H^ee))+j[13]+2850285829&4294967295,Q=H+(oe<<5&4294967295|oe>>>27),oe=de+(H^ee&(Q^H))+j[2]+4243563512&4294967295,de=Q+(oe<<9&4294967295|oe>>>23),oe=ee+(Q^H&(de^Q))+j[7]+1735328473&4294967295,ee=de+(oe<<14&4294967295|oe>>>18),oe=H+(de^Q&(ee^de))+j[12]+2368359562&4294967295,H=ee+(oe<<20&4294967295|oe>>>12),oe=Q+(H^ee^de)+j[5]+4294588738&4294967295,Q=H+(oe<<4&4294967295|oe>>>28),oe=de+(Q^H^ee)+j[8]+2272392833&4294967295,de=Q+(oe<<11&4294967295|oe>>>21),oe=ee+(de^Q^H)+j[11]+1839030562&4294967295,ee=de+(oe<<16&4294967295|oe>>>16),oe=H+(ee^de^Q)+j[14]+4259657740&4294967295,H=ee+(oe<<23&4294967295|oe>>>9),oe=Q+(H^ee^de)+j[1]+2763975236&4294967295,Q=H+(oe<<4&4294967295|oe>>>28),oe=de+(Q^H^ee)+j[4]+1272893353&4294967295,de=Q+(oe<<11&4294967295|oe>>>21),oe=ee+(de^Q^H)+j[7]+4139469664&4294967295,ee=de+(oe<<16&4294967295|oe>>>16),oe=H+(ee^de^Q)+j[10]+3200236656&4294967295,H=ee+(oe<<23&4294967295|oe>>>9),oe=Q+(H^ee^de)+j[13]+681279174&4294967295,Q=H+(oe<<4&4294967295|oe>>>28),oe=de+(Q^H^ee)+j[0]+3936430074&4294967295,de=Q+(oe<<11&4294967295|oe>>>21),oe=ee+(de^Q^H)+j[3]+3572445317&4294967295,ee=de+(oe<<16&4294967295|oe>>>16),oe=H+(ee^de^Q)+j[6]+76029189&4294967295,H=ee+(oe<<23&4294967295|oe>>>9),oe=Q+(H^ee^de)+j[9]+3654602809&4294967295,Q=H+(oe<<4&4294967295|oe>>>28),oe=de+(Q^H^ee)+j[12]+3873151461&4294967295,de=Q+(oe<<11&4294967295|oe>>>21),oe=ee+(de^Q^H)+j[15]+530742520&4294967295,ee=de+(oe<<16&4294967295|oe>>>16),oe=H+(ee^de^Q)+j[2]+3299628645&4294967295,H=ee+(oe<<23&4294967295|oe>>>9),oe=Q+(ee^(H|~de))+j[0]+4096336452&4294967295,Q=H+(oe<<6&4294967295|oe>>>26),oe=de+(H^(Q|~ee))+j[7]+1126891415&4294967295,de=Q+(oe<<10&4294967295|oe>>>22),oe=ee+(Q^(de|~H))+j[14]+2878612391&4294967295,ee=de+(oe<<15&4294967295|oe>>>17),oe=H+(de^(ee|~Q))+j[5]+4237533241&4294967295,H=ee+(oe<<21&4294967295|oe>>>11),oe=Q+(ee^(H|~de))+j[12]+1700485571&4294967295,Q=H+(oe<<6&4294967295|oe>>>26),oe=de+(H^(Q|~ee))+j[3]+2399980690&4294967295,de=Q+(oe<<10&4294967295|oe>>>22),oe=ee+(Q^(de|~H))+j[10]+4293915773&4294967295,ee=de+(oe<<15&4294967295|oe>>>17),oe=H+(de^(ee|~Q))+j[1]+2240044497&4294967295,H=ee+(oe<<21&4294967295|oe>>>11),oe=Q+(ee^(H|~de))+j[8]+1873313359&4294967295,Q=H+(oe<<6&4294967295|oe>>>26),oe=de+(H^(Q|~ee))+j[15]+4264355552&4294967295,de=Q+(oe<<10&4294967295|oe>>>22),oe=ee+(Q^(de|~H))+j[6]+2734768916&4294967295,ee=de+(oe<<15&4294967295|oe>>>17),oe=H+(de^(ee|~Q))+j[13]+1309151649&4294967295,H=ee+(oe<<21&4294967295|oe>>>11),oe=Q+(ee^(H|~de))+j[4]+4149444226&4294967295,Q=H+(oe<<6&4294967295|oe>>>26),oe=de+(H^(Q|~ee))+j[11]+3174756917&4294967295,de=Q+(oe<<10&4294967295|oe>>>22),oe=ee+(Q^(de|~H))+j[2]+718787259&4294967295,ee=de+(oe<<15&4294967295|oe>>>17),oe=H+(de^(ee|~Q))+j[9]+3951481745&4294967295,K.g[0]=K.g[0]+Q&4294967295,K.g[1]=K.g[1]+(ee+(oe<<21&4294967295|oe>>>11))&4294967295,K.g[2]=K.g[2]+ee&4294967295,K.g[3]=K.g[3]+de&4294967295}i.prototype.v=function(K,Q){Q===void 0&&(Q=K.length);const H=Q-this.blockSize,j=this.C;let ee=this.h,de=0;for(;de<Q;){if(ee==0)for(;de<=H;)s(this,K,de),de+=this.blockSize;if(typeof K=="string"){for(;de<Q;)if(j[ee++]=K.charCodeAt(de++),ee==this.blockSize){s(this,j),ee=0;break}}else for(;de<Q;)if(j[ee++]=K[de++],ee==this.blockSize){s(this,j),ee=0;break}}this.h=ee,this.o+=Q},i.prototype.A=function(){var K=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);K[0]=128;for(var Q=1;Q<K.length-8;++Q)K[Q]=0;Q=this.o*8;for(var H=K.length-8;H<K.length;++H)K[H]=Q&255,Q/=256;for(this.v(K),K=Array(16),Q=0,H=0;H<4;++H)for(let j=0;j<32;j+=8)K[Q++]=this.g[H]>>>j&255;return K};function l(K,Q){var H=d;return Object.prototype.hasOwnProperty.call(H,K)?H[K]:H[K]=Q(K)}function u(K,Q){this.h=Q;const H=[];let j=!0;for(let ee=K.length-1;ee>=0;ee--){const de=K[ee]|0;j&&de==Q||(H[ee]=de,j=!1)}this.g=H}var d={};function p(K){return-128<=K&&K<128?l(K,function(Q){return new u([Q|0],Q<0?-1:0)}):new u([K|0],K<0?-1:0)}function g(K){if(isNaN(K)||!isFinite(K))return b;if(K<0)return P(g(-K));const Q=[];let H=1;for(let j=0;K>=H;j++)Q[j]=K/H|0,H*=4294967296;return new u(Q,0)}function x(K,Q){if(K.length==0)throw Error("number format error: empty string");if(Q=Q||10,Q<2||36<Q)throw Error("radix out of range: "+Q);if(K.charAt(0)=="-")return P(x(K.substring(1),Q));if(K.indexOf("-")>=0)throw Error('number format error: interior "-" character');const H=g(Math.pow(Q,8));let j=b;for(let de=0;de<K.length;de+=8){var ee=Math.min(8,K.length-de);const oe=parseInt(K.substring(de,de+ee),Q);ee<8?(ee=g(Math.pow(Q,ee)),j=j.j(ee).add(g(oe))):(j=j.j(H),j=j.add(g(oe)))}return j}var b=p(0),E=p(1),S=p(16777216);n=u.prototype,n.m=function(){if(R(this))return-P(this).m();let K=0,Q=1;for(let H=0;H<this.g.length;H++){const j=this.i(H);K+=(j>=0?j:4294967296+j)*Q,Q*=4294967296}return K},n.toString=function(K){if(K=K||10,K<2||36<K)throw Error("radix out of range: "+K);if(M(this))return"0";if(R(this))return"-"+P(this).toString(K);const Q=g(Math.pow(K,6));var H=this;let j="";for(;;){const ee=G(H,Q).g;H=k(H,ee.j(Q));let de=((H.g.length>0?H.g[0]:H.h)>>>0).toString(K);if(H=ee,M(H))return de+j;for(;de.length<6;)de="0"+de;j=de+j}},n.i=function(K){return K<0?0:K<this.g.length?this.g[K]:this.h};function M(K){if(K.h!=0)return!1;for(let Q=0;Q<K.g.length;Q++)if(K.g[Q]!=0)return!1;return!0}function R(K){return K.h==-1}n.l=function(K){return K=k(this,K),R(K)?-1:M(K)?0:1};function P(K){const Q=K.g.length,H=[];for(let j=0;j<Q;j++)H[j]=~K.g[j];return new u(H,~K.h).add(E)}n.abs=function(){return R(this)?P(this):this},n.add=function(K){const Q=Math.max(this.g.length,K.g.length),H=[];let j=0;for(let ee=0;ee<=Q;ee++){let de=j+(this.i(ee)&65535)+(K.i(ee)&65535),oe=(de>>>16)+(this.i(ee)>>>16)+(K.i(ee)>>>16);j=oe>>>16,de&=65535,oe&=65535,H[ee]=oe<<16|de}return new u(H,H[H.length-1]&-2147483648?-1:0)};function k(K,Q){return K.add(P(Q))}n.j=function(K){if(M(this)||M(K))return b;if(R(this))return R(K)?P(this).j(P(K)):P(P(this).j(K));if(R(K))return P(this.j(P(K)));if(this.l(S)<0&&K.l(S)<0)return g(this.m()*K.m());const Q=this.g.length+K.g.length,H=[];for(var j=0;j<2*Q;j++)H[j]=0;for(j=0;j<this.g.length;j++)for(let ee=0;ee<K.g.length;ee++){const de=this.i(j)>>>16,oe=this.i(j)&65535,we=K.i(ee)>>>16,$e=K.i(ee)&65535;H[2*j+2*ee]+=oe*$e,F(H,2*j+2*ee),H[2*j+2*ee+1]+=de*$e,F(H,2*j+2*ee+1),H[2*j+2*ee+1]+=oe*we,F(H,2*j+2*ee+1),H[2*j+2*ee+2]+=de*we,F(H,2*j+2*ee+2)}for(K=0;K<Q;K++)H[K]=H[2*K+1]<<16|H[2*K];for(K=Q;K<2*Q;K++)H[K]=0;return new u(H,0)};function F(K,Q){for(;(K[Q]&65535)!=K[Q];)K[Q+1]+=K[Q]>>>16,K[Q]&=65535,Q++}function V(K,Q){this.g=K,this.h=Q}function G(K,Q){if(M(Q))throw Error("division by zero");if(M(K))return new V(b,b);if(R(K))return Q=G(P(K),Q),new V(P(Q.g),P(Q.h));if(R(Q))return Q=G(K,P(Q)),new V(P(Q.g),Q.h);if(K.g.length>30){if(R(K)||R(Q))throw Error("slowDivide_ only works with positive integers.");for(var H=E,j=Q;j.l(K)<=0;)H=q(H),j=q(j);var ee=ne(H,1),de=ne(j,1);for(j=ne(j,2),H=ne(H,2);!M(j);){var oe=de.add(j);oe.l(K)<=0&&(ee=ee.add(H),de=oe),j=ne(j,1),H=ne(H,1)}return Q=k(K,ee.j(Q)),new V(ee,Q)}for(ee=b;K.l(Q)>=0;){for(H=Math.max(1,Math.floor(K.m()/Q.m())),j=Math.ceil(Math.log(H)/Math.LN2),j=j<=48?1:Math.pow(2,j-48),de=g(H),oe=de.j(Q);R(oe)||oe.l(K)>0;)H-=j,de=g(H),oe=de.j(Q);M(de)&&(de=E),ee=ee.add(de),K=k(K,oe)}return new V(ee,K)}n.B=function(K){return G(this,K).h},n.and=function(K){const Q=Math.max(this.g.length,K.g.length),H=[];for(let j=0;j<Q;j++)H[j]=this.i(j)&K.i(j);return new u(H,this.h&K.h)},n.or=function(K){const Q=Math.max(this.g.length,K.g.length),H=[];for(let j=0;j<Q;j++)H[j]=this.i(j)|K.i(j);return new u(H,this.h|K.h)},n.xor=function(K){const Q=Math.max(this.g.length,K.g.length),H=[];for(let j=0;j<Q;j++)H[j]=this.i(j)^K.i(j);return new u(H,this.h^K.h)};function q(K){const Q=K.g.length+1,H=[];for(let j=0;j<Q;j++)H[j]=K.i(j)<<1|K.i(j-1)>>>31;return new u(H,K.h)}function ne(K,Q){const H=Q>>5;Q%=32;const j=K.g.length-H,ee=[];for(let de=0;de<j;de++)ee[de]=Q>0?K.i(de+H)>>>Q|K.i(de+H+1)<<32-Q:K.i(de+H);return new u(ee,K.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,oee=i,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.B,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=g,u.fromString=x,wp=u}).apply(typeof HQ<"u"?HQ:typeof self<"u"?self:typeof window<"u"?window:{});var fE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aee,Jb,lee,eI,bD,cee,uee,hee;(function(){var n,e=Object.defineProperty;function t(N){N=[typeof globalThis=="object"&&globalThis,N,typeof window=="object"&&window,typeof self=="object"&&self,typeof fE=="object"&&fE];for(var J=0;J<N.length;++J){var ae=N[J];if(ae&&ae.Math==Math)return ae}throw Error("Cannot find global object")}var i=t(this);function s(N,J){if(J)e:{var ae=i;N=N.split(".");for(var me=0;me<N.length-1;me++){var Ke=N[me];if(!(Ke in ae))break e;ae=ae[Ke]}N=N[N.length-1],me=ae[N],J=J(me),J!=me&&J!=null&&e(ae,N,{configurable:!0,writable:!0,value:J})}}s("Symbol.dispose",function(N){return N||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(N){return N||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(N){return N||function(J){var ae=[],me;for(me in J)Object.prototype.hasOwnProperty.call(J,me)&&ae.push([me,J[me]]);return ae}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var l=l||{},u=this||self;function d(N){var J=typeof N;return J=="object"&&N!=null||J=="function"}function p(N,J,ae){return N.call.apply(N.bind,arguments)}function g(N,J,ae){return g=p,g.apply(null,arguments)}function x(N,J){var ae=Array.prototype.slice.call(arguments,1);return function(){var me=ae.slice();return me.push.apply(me,arguments),N.apply(this,me)}}function b(N,J){function ae(){}ae.prototype=J.prototype,N.Z=J.prototype,N.prototype=new ae,N.prototype.constructor=N,N.Ob=function(me,Ke,it){for(var Xt=Array(arguments.length-2),zn=2;zn<arguments.length;zn++)Xt[zn-2]=arguments[zn];return J.prototype[Ke].apply(me,Xt)}}var E=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?N=>N&&AsyncContext.Snapshot.wrap(N):N=>N;function S(N){const J=N.length;if(J>0){const ae=Array(J);for(let me=0;me<J;me++)ae[me]=N[me];return ae}return[]}function M(N,J){for(let me=1;me<arguments.length;me++){const Ke=arguments[me];var ae=typeof Ke;if(ae=ae!="object"?ae:Ke?Array.isArray(Ke)?"array":ae:"null",ae=="array"||ae=="object"&&typeof Ke.length=="number"){ae=N.length||0;const it=Ke.length||0;N.length=ae+it;for(let Xt=0;Xt<it;Xt++)N[ae+Xt]=Ke[Xt]}else N.push(Ke)}}class R{constructor(J,ae){this.i=J,this.j=ae,this.h=0,this.g=null}get(){let J;return this.h>0?(this.h--,J=this.g,this.g=J.next,J.next=null):J=this.i(),J}}function P(N){u.setTimeout(()=>{throw N},0)}function k(){var N=K;let J=null;return N.g&&(J=N.g,N.g=N.g.next,N.g||(N.h=null),J.next=null),J}class F{constructor(){this.h=this.g=null}add(J,ae){const me=V.get();me.set(J,ae),this.h?this.h.next=me:this.g=me,this.h=me}}var V=new R(()=>new G,N=>N.reset());class G{constructor(){this.next=this.g=this.h=null}set(J,ae){this.h=J,this.g=ae,this.next=null}reset(){this.next=this.g=this.h=null}}let q,ne=!1,K=new F,Q=()=>{const N=Promise.resolve(void 0);q=()=>{N.then(H)}};function H(){for(var N;N=k();){try{N.h.call(N.g)}catch(ae){P(ae)}var J=V;J.j(N),J.h<100&&(J.h++,N.next=J.g,J.g=N)}ne=!1}function j(){this.u=this.u,this.C=this.C}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ee(N,J){this.type=N,this.g=this.target=J,this.defaultPrevented=!1}ee.prototype.h=function(){this.defaultPrevented=!0};var de=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var N=!1,J=Object.defineProperty({},"passive",{get:function(){N=!0}});try{const ae=()=>{};u.addEventListener("test",ae,J),u.removeEventListener("test",ae,J)}catch{}return N}();function oe(N){return/^[\s\xa0]*$/.test(N)}function we(N,J){ee.call(this,N?N.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,N&&this.init(N,J)}b(we,ee),we.prototype.init=function(N,J){const ae=this.type=N.type,me=N.changedTouches&&N.changedTouches.length?N.changedTouches[0]:null;this.target=N.target||N.srcElement,this.g=J,J=N.relatedTarget,J||(ae=="mouseover"?J=N.fromElement:ae=="mouseout"&&(J=N.toElement)),this.relatedTarget=J,me?(this.clientX=me.clientX!==void 0?me.clientX:me.pageX,this.clientY=me.clientY!==void 0?me.clientY:me.pageY,this.screenX=me.screenX||0,this.screenY=me.screenY||0):(this.clientX=N.clientX!==void 0?N.clientX:N.pageX,this.clientY=N.clientY!==void 0?N.clientY:N.pageY,this.screenX=N.screenX||0,this.screenY=N.screenY||0),this.button=N.button,this.key=N.key||"",this.ctrlKey=N.ctrlKey,this.altKey=N.altKey,this.shiftKey=N.shiftKey,this.metaKey=N.metaKey,this.pointerId=N.pointerId||0,this.pointerType=N.pointerType,this.state=N.state,this.i=N,N.defaultPrevented&&we.Z.h.call(this)},we.prototype.h=function(){we.Z.h.call(this);const N=this.i;N.preventDefault?N.preventDefault():N.returnValue=!1};var $e="closure_listenable_"+(Math.random()*1e6|0),Me=0;function Ne(N,J,ae,me,Ke){this.listener=N,this.proxy=null,this.src=J,this.type=ae,this.capture=!!me,this.ha=Ke,this.key=++Me,this.da=this.fa=!1}function Ae(N){N.da=!0,N.listener=null,N.proxy=null,N.src=null,N.ha=null}function Fe(N,J,ae){for(const me in N)J.call(ae,N[me],me,N)}function Ie(N,J){for(const ae in N)J.call(void 0,N[ae],ae,N)}function qe(N){const J={};for(const ae in N)J[ae]=N[ae];return J}const dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wt(N,J){let ae,me;for(let Ke=1;Ke<arguments.length;Ke++){me=arguments[Ke];for(ae in me)N[ae]=me[ae];for(let it=0;it<dt.length;it++)ae=dt[it],Object.prototype.hasOwnProperty.call(me,ae)&&(N[ae]=me[ae])}}function xt(N){this.src=N,this.g={},this.h=0}xt.prototype.add=function(N,J,ae,me,Ke){const it=N.toString();N=this.g[it],N||(N=this.g[it]=[],this.h++);const Xt=Rt(N,J,me,Ke);return Xt>-1?(J=N[Xt],ae||(J.fa=!1)):(J=new Ne(J,this.src,it,!!me,Ke),J.fa=ae,N.push(J)),J};function At(N,J){const ae=J.type;if(ae in N.g){var me=N.g[ae],Ke=Array.prototype.indexOf.call(me,J,void 0),it;(it=Ke>=0)&&Array.prototype.splice.call(me,Ke,1),it&&(Ae(J),N.g[ae].length==0&&(delete N.g[ae],N.h--))}}function Rt(N,J,ae,me){for(let Ke=0;Ke<N.length;++Ke){const it=N[Ke];if(!it.da&&it.listener==J&&it.capture==!!ae&&it.ha==me)return Ke}return-1}var Et="closure_lm_"+(Math.random()*1e6|0),Ze={};function It(N,J,ae,me,Ke){if(Array.isArray(J)){for(let it=0;it<J.length;it++)It(N,J[it],ae,me,Ke);return null}return ae=Y(ae),N&&N[$e]?N.J(J,ae,d(me)?!!me.capture:!1,Ke):Lt(N,J,ae,!1,me,Ke)}function Lt(N,J,ae,me,Ke,it){if(!J)throw Error("Invalid event type");const Xt=d(Ke)?!!Ke.capture:!!Ke;let zn=Te(N);if(zn||(N[Et]=zn=new xt(N)),ae=zn.add(J,ae,me,Xt,it),ae.proxy)return ae;if(me=Yt(),ae.proxy=me,me.src=N,me.listener=ae,N.addEventListener)de||(Ke=Xt),Ke===void 0&&(Ke=!1),N.addEventListener(J.toString(),me,Ke);else if(N.attachEvent)N.attachEvent(wt(J.toString()),me);else if(N.addListener&&N.removeListener)N.addListener(me);else throw Error("addEventListener and attachEvent are unavailable.");return ae}function Yt(){function N(ae){return J.call(N.src,N.listener,ae)}const J=Ee;return N}function ht(N,J,ae,me,Ke){if(Array.isArray(J))for(var it=0;it<J.length;it++)ht(N,J[it],ae,me,Ke);else me=d(me)?!!me.capture:!!me,ae=Y(ae),N&&N[$e]?(N=N.i,it=String(J).toString(),it in N.g&&(J=N.g[it],ae=Rt(J,ae,me,Ke),ae>-1&&(Ae(J[ae]),Array.prototype.splice.call(J,ae,1),J.length==0&&(delete N.g[it],N.h--)))):N&&(N=Te(N))&&(J=N.g[J.toString()],N=-1,J&&(N=Rt(J,ae,me,Ke)),(ae=N>-1?J[N]:null)&&yt(ae))}function yt(N){if(typeof N!="number"&&N&&!N.da){var J=N.src;if(J&&J[$e])At(J.i,N);else{var ae=N.type,me=N.proxy;J.removeEventListener?J.removeEventListener(ae,me,N.capture):J.detachEvent?J.detachEvent(wt(ae),me):J.addListener&&J.removeListener&&J.removeListener(me),(ae=Te(J))?(At(ae,N),ae.h==0&&(ae.src=null,J[Et]=null)):Ae(N)}}}function wt(N){return N in Ze?Ze[N]:Ze[N]="on"+N}function Ee(N,J){if(N.da)N=!0;else{J=new we(J,this);const ae=N.listener,me=N.ha||N.src;N.fa&&yt(N),N=ae.call(me,J)}return N}function Te(N){return N=N[Et],N instanceof xt?N:null}var Gt="__closure_events_fn_"+(Math.random()*1e9>>>0);function Y(N){return typeof N=="function"?N:(N[Gt]||(N[Gt]=function(J){return N.handleEvent(J)}),N[Gt])}function te(){j.call(this),this.i=new xt(this),this.M=this,this.G=null}b(te,j),te.prototype[$e]=!0,te.prototype.removeEventListener=function(N,J,ae,me){ht(this,N,J,ae,me)};function ce(N,J){var ae,me=N.G;if(me)for(ae=[];me;me=me.G)ae.push(me);if(N=N.M,me=J.type||J,typeof J=="string")J=new ee(J,N);else if(J instanceof ee)J.target=J.target||N;else{var Ke=J;J=new ee(me,N),Wt(J,Ke)}Ke=!0;let it,Xt;if(ae)for(Xt=ae.length-1;Xt>=0;Xt--)it=J.g=ae[Xt],Ke=xe(it,me,!0,J)&&Ke;if(it=J.g=N,Ke=xe(it,me,!0,J)&&Ke,Ke=xe(it,me,!1,J)&&Ke,ae)for(Xt=0;Xt<ae.length;Xt++)it=J.g=ae[Xt],Ke=xe(it,me,!1,J)&&Ke}te.prototype.N=function(){if(te.Z.N.call(this),this.i){var N=this.i;for(const J in N.g){const ae=N.g[J];for(let me=0;me<ae.length;me++)Ae(ae[me]);delete N.g[J],N.h--}}this.G=null},te.prototype.J=function(N,J,ae,me){return this.i.add(String(N),J,!1,ae,me)},te.prototype.K=function(N,J,ae,me){return this.i.add(String(N),J,!0,ae,me)};function xe(N,J,ae,me){if(J=N.i.g[String(J)],!J)return!0;J=J.concat();let Ke=!0;for(let it=0;it<J.length;++it){const Xt=J[it];if(Xt&&!Xt.da&&Xt.capture==ae){const zn=Xt.listener,xi=Xt.ha||Xt.src;Xt.fa&&At(N.i,Xt),Ke=zn.call(xi,me)!==!1&&Ke}}return Ke&&!me.defaultPrevented}function Re(N,J){if(typeof N!="function")if(N&&typeof N.handleEvent=="function")N=g(N.handleEvent,N);else throw Error("Invalid listener argument");return Number(J)>2147483647?-1:u.setTimeout(N,J||0)}function We(N){N.g=Re(()=>{N.g=null,N.i&&(N.i=!1,We(N))},N.l);const J=N.h;N.h=null,N.m.apply(null,J)}class at extends j{constructor(J,ae){super(),this.m=J,this.l=ae,this.h=null,this.i=!1,this.g=null}j(J){this.h=arguments,this.g?this.i=!0:We(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(N){j.call(this),this.h=N,this.g={}}b(ln,j);var ve=[];function ue(N){Fe(N.g,function(J,ae){this.g.hasOwnProperty(ae)&&yt(J)},N),N.g={}}ln.prototype.N=function(){ln.Z.N.call(this),ue(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Oe=u.JSON.stringify,ut=u.JSON.parse,vt=class{stringify(N){return u.JSON.stringify(N,void 0)}parse(N){return u.JSON.parse(N,void 0)}};function pt(){}function cn(){}var Tt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Zt(){ee.call(this,"d")}b(Zt,ee);function kn(){ee.call(this,"c")}b(kn,ee);var Ft={},vn=null;function jn(){return vn=vn||new te}Ft.Ia="serverreachability";function Pe(N){ee.call(this,Ft.Ia,N)}b(Pe,ee);function ft(N){const J=jn();ce(J,new Pe(J))}Ft.STAT_EVENT="statevent";function Pt(N,J){ee.call(this,Ft.STAT_EVENT,N),this.stat=J}b(Pt,ee);function Dt(N){const J=jn();ce(J,new Pt(J,N))}Ft.Ja="timingevent";function qt(N,J){ee.call(this,Ft.Ja,N),this.size=J}b(qt,ee);function sn(N,J){if(typeof N!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){N()},J)}function Rn(){this.g=!0}Rn.prototype.ua=function(){this.g=!1};function tn(N,J,ae,me,Ke,it){N.info(function(){if(N.g)if(it){var Xt="",zn=it.split("&");for(let Ii=0;Ii<zn.length;Ii++){var xi=zn[Ii].split("=");if(xi.length>1){const lr=xi[0];xi=xi[1];const so=lr.split("_");Xt=so.length>=2&&so[1]=="type"?Xt+(lr+"="+xi+"&"):Xt+(lr+"=redacted&")}}}else Xt=null;else Xt=it;return"XMLHTTP REQ ("+me+") [attempt "+Ke+"]: "+J+`
`+ae+`
`+Xt})}function Jt(N,J,ae,me,Ke,it,Xt){N.info(function(){return"XMLHTTP RESP ("+me+") [ attempt "+Ke+"]: "+J+`
`+ae+`
`+it+" "+Xt})}function fn(N,J,ae,me){N.info(function(){return"XMLHTTP TEXT ("+J+"): "+ar(N,ae)+(me?" "+me:"")})}function ei(N,J){N.info(function(){return"TIMEOUT: "+J})}Rn.prototype.info=function(){};function ar(N,J){if(!N.g)return J;if(!J)return null;try{const it=JSON.parse(J);if(it){for(N=0;N<it.length;N++)if(Array.isArray(it[N])){var ae=it[N];if(!(ae.length<2)){var me=ae[1];if(Array.isArray(me)&&!(me.length<1)){var Ke=me[0];if(Ke!="noop"&&Ke!="stop"&&Ke!="close")for(let Xt=1;Xt<me.length;Xt++)me[Xt]=""}}}}return Oe(it)}catch{return J}}var ta={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},yc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Dl;function qr(){}b(qr,pt),qr.prototype.g=function(){return new XMLHttpRequest},Dl=new qr;function hn(N){return encodeURIComponent(String(N))}function al(N){var J=1;N=N.split(":");const ae=[];for(;J>0&&N.length;)ae.push(N.shift()),J--;return N.length&&ae.push(N.join(":")),ae}function ks(N,J,ae,me){this.j=N,this.i=J,this.l=ae,this.S=me||1,this.V=new ln(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Fl}function Fl(){this.i=null,this.g="",this.h=!1}var Io={},So={};function na(N,J,ae){N.M=1,N.A=jt(Hn(J)),N.u=ae,N.R=!0,ro(N,null)}function ro(N,J){N.F=Date.now(),ll(N),N.B=Hn(N.A);var ae=N.B,me=N.S;Array.isArray(me)||(me=[String(me)]),Ih(ae.i,"t",me),N.C=0,ae=N.j.L,N.h=new Fl,N.g=xu(N.j,ae?J:null,!N.u),N.P>0&&(N.O=new at(g(N.Y,N,N.g),N.P)),J=N.V,ae=N.g,me=N.ba;var Ke="readystatechange";Array.isArray(Ke)||(Ke&&(ve[0]=Ke.toString()),Ke=ve);for(let it=0;it<Ke.length;it++){const Xt=It(ae,Ke[it],me||J.handleEvent,!1,J.h||J);if(!Xt)break;J.g[Xt.key]=Xt}J=N.J?qe(N.J):{},N.u?(N.v||(N.v="POST"),J["Content-Type"]="application/x-www-form-urlencoded",N.g.ea(N.B,N.v,N.u,J)):(N.v="GET",N.g.ea(N.B,N.v,null,J)),ft(),tn(N.i,N.v,N.B,N.l,N.S,N.u)}ks.prototype.ba=function(N){N=N.target;const J=this.O;J&&Mo(N)==3?J.j():this.Y(N)},ks.prototype.Y=function(N){try{if(N==this.g)e:{const zn=Mo(this.g),xi=this.g.ya(),Ii=this.g.ca();if(!(zn<3)&&(zn!=3||this.g&&(this.h.h||this.g.la()||mu(this.g)))){this.K||zn!=4||xi==7||(xi==8||Ii<=0?ft(3):ft(2)),Ol(this);var J=this.g.ca();this.X=J;var ae=Ac(this);if(this.o=J==200,Jt(this.i,this.v,this.B,this.l,this.S,zn,J),this.o){if(this.U&&!this.L){t:{if(this.g){var me,Ke=this.g;if((me=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(me)){var it=me;break t}}it=null}if(N=it)fn(this.i,this.l,N,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ze(this,N);else{this.o=!1,this.m=3,Dt(12),pe(this),Vl(this);break e}}if(this.R){N=!0;let lr;for(;!this.K&&this.C<ae.length;)if(lr=_h(this,ae),lr==So){zn==4&&(this.m=4,Dt(14),N=!1),fn(this.i,this.l,null,"[Incomplete Response]");break}else if(lr==Io){this.m=4,Dt(15),fn(this.i,this.l,ae,"[Invalid Chunk]"),N=!1;break}else fn(this.i,this.l,lr,null),ze(this,lr);if(uu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),zn!=4||ae.length!=0||this.h.h||(this.m=1,Dt(16),N=!1),this.o=this.o&&N,!N)fn(this.i,this.l,ae,"[Invalid Chunked Response]"),pe(this),Vl(this);else if(ae.length>0&&!this.W){this.W=!0;var Xt=this.j;Xt.g==this&&Xt.aa&&!Xt.P&&(Xt.j.info("Great, no buffering proxy detected. Bytes received: "+ae.length),qd(Xt),Xt.P=!0,Dt(11))}}else fn(this.i,this.l,ae,null),ze(this,ae);zn==4&&pe(this),this.o&&!this.K&&(zn==4?Ls(this.j,this):(this.o=!1,ll(this)))}else gu(this.g),J==400&&ae.indexOf("Unknown SID")>0?(this.m=3,Dt(12)):(this.m=0,Dt(13)),pe(this),Vl(this)}}}catch{}finally{}};function Ac(N){if(!uu(N))return N.g.la();const J=mu(N.g);if(J==="")return"";let ae="";const me=J.length,Ke=Mo(N.g)==4;if(!N.h.i){if(typeof TextDecoder>"u")return pe(N),Vl(N),"";N.h.i=new u.TextDecoder}for(let it=0;it<me;it++)N.h.h=!0,ae+=N.h.i.decode(J[it],{stream:!(Ke&&it==me-1)});return J.length=0,N.h.g+=ae,N.C=0,N.h.g}function uu(N){return N.g?N.v=="GET"&&N.M!=2&&N.j.Aa:!1}function _h(N,J){var ae=N.C,me=J.indexOf(`
`,ae);return me==-1?So:(ae=Number(J.substring(ae,me)),isNaN(ae)?Io:(me+=1,me+ae>J.length?So:(J=J.slice(me,me+ae),N.C=me+ae,J)))}ks.prototype.cancel=function(){this.K=!0,pe(this)};function ll(N){N.T=Date.now()+N.H,hu(N,N.H)}function hu(N,J){if(N.D!=null)throw Error("WatchDog timer not null");N.D=sn(g(N.aa,N),J)}function Ol(N){N.D&&(u.clearTimeout(N.D),N.D=null)}ks.prototype.aa=function(){this.D=null;const N=Date.now();N-this.T>=0?(ei(this.i,this.B),this.M!=2&&(ft(),Dt(17)),pe(this),this.m=2,Vl(this)):hu(this,this.T-N)};function Vl(N){N.j.I==0||N.K||Ls(N.j,N)}function pe(N){Ol(N);var J=N.O;J&&typeof J.dispose=="function"&&J.dispose(),N.O=null,ue(N.V),N.g&&(J=N.g,N.g=null,J.abort(),J.dispose())}function ze(N,J){try{var ae=N.j;if(ae.I!=0&&(ae.g==N||Kt(ae.h,N))){if(!N.L&&Kt(ae.h,N)&&ae.I==3){try{var me=ae.Ba.g.parse(J)}catch{me=null}if(Array.isArray(me)&&me.length==3){var Ke=me;if(Ke[0]==0){e:if(!ae.v){if(ae.g)if(ae.g.F+3e3<N.F)vu(ae),Ec(ae);else break e;Yd(ae),Dt(18)}}else ae.xa=Ke[1],0<ae.xa-ae.K&&Ke[2]<37500&&ae.F&&ae.A==0&&!ae.C&&(ae.C=sn(g(ae.Va,ae),6e3));Nt(ae.h)<=1&&ae.ta&&(ae.ta=void 0)}else sa(ae,11)}else if((N.L||ae.g==N)&&vu(ae),!oe(J))for(Ke=ae.Ba.g.parse(J),J=0;J<Ke.length;J++){let Ii=Ke[J];const lr=Ii[0];if(!(lr<=ae.K))if(ae.K=lr,Ii=Ii[1],ae.I==2)if(Ii[0]=="c"){ae.M=Ii[1],ae.ba=Ii[2];const so=Ii[3];so!=null&&(ae.ka=so,ae.j.info("VER="+ae.ka));const Ro=Ii[4];Ro!=null&&(ae.za=Ro,ae.j.info("SVER="+ae.za));const oo=Ii[5];oo!=null&&typeof oo=="number"&&oo>0&&(me=1.5*oo,ae.O=me,ae.j.info("backChannelRequestTimeoutMs_="+me)),me=ae;const oa=N.g;if(oa){const Lh=oa.g?oa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lh){var it=me.h;it.g||Lh.indexOf("spdy")==-1&&Lh.indexOf("quic")==-1&&Lh.indexOf("h2")==-1||(it.j=it.l,it.g=new Set,it.h&&(on(it,it.h),it.h=null))}if(me.G){const Bh=oa.g?oa.g.getResponseHeader("X-HTTP-Session-Id"):null;Bh&&(me.wa=Bh,Ht(me.J,me.G,Bh))}}ae.I=3,ae.l&&ae.l.ra(),ae.aa&&(ae.T=Date.now()-N.F,ae.j.info("Handshake RTT: "+ae.T+"ms")),me=ae;var Xt=N;if(me.na=Rh(me,me.L?me.ba:null,me.W),Xt.L){dn(me.h,Xt);var zn=Xt,xi=me.O;xi&&(zn.H=xi),zn.D&&(Ol(zn),ll(zn)),me.g=Xt}else jd(me);ae.i.length>0&&ra(ae)}else Ii[0]!="stop"&&Ii[0]!="close"||sa(ae,7);else ae.I==3&&(Ii[0]=="stop"||Ii[0]=="close"?Ii[0]=="stop"?sa(ae,7):ui(ae):Ii[0]!="noop"&&ae.l&&ae.l.qa(Ii),ae.A=0)}}ft(4)}catch{}}var nt=class{constructor(N,J){this.g=N,this.map=J}};function rt(N){this.l=N||10,u.PerformanceNavigationTiming?(N=u.performance.getEntriesByType("navigation"),N=N.length>0&&(N[0].nextHopProtocol=="hq"||N[0].nextHopProtocol=="h2")):N=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=N?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ge(N){return N.h?!0:N.g?N.g.size>=N.j:!1}function Nt(N){return N.h?1:N.g?N.g.size:0}function Kt(N,J){return N.h?N.h==J:N.g?N.g.has(J):!1}function on(N,J){N.g?N.g.add(J):N.h=J}function dn(N,J){N.h&&N.h==J?N.h=null:N.g&&N.g.has(J)&&N.g.delete(J)}rt.prototype.cancel=function(){if(this.i=Ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const N of this.g.values())N.cancel();this.g.clear()}};function Ln(N){if(N.h!=null)return N.i.concat(N.h.G);if(N.g!=null&&N.g.size!==0){let J=N.i;for(const ae of N.g.values())J=J.concat(ae.G);return J}return S(N.i)}var Sn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function zt(N,J){if(N){N=N.split("&");for(let ae=0;ae<N.length;ae++){const me=N[ae].indexOf("=");let Ke,it=null;me>=0?(Ke=N[ae].substring(0,me),it=N[ae].substring(me+1)):Ke=N[ae],J(Ke,it?decodeURIComponent(it.replace(/\+/g," ")):"")}}}function gn(N){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let J;N instanceof gn?(this.l=N.l,Ci(this,N.j),this.o=N.o,this.g=N.g,bi(this,N.u),this.h=N.h,Yn(this,cl(N.i)),this.m=N.m):N&&(J=String(N).match(Sn))?(this.l=!1,Ci(this,J[1]||"",!0),this.o=us(J[2]||""),this.g=us(J[3]||"",!0),bi(this,J[4]),this.h=us(J[5]||"",!0),Yn(this,J[6]||"",!0),this.m=us(J[7]||"")):(this.l=!1,this.i=new pr(null,this.l))}gn.prototype.toString=function(){const N=[];var J=this.j;J&&N.push(ti(J,Jr,!0),":");var ae=this.g;return(ae||J=="file")&&(N.push("//"),(J=this.o)&&N.push(ti(J,Jr,!0),"@"),N.push(hn(ae).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ae=this.u,ae!=null&&N.push(":",String(ae))),(ae=this.h)&&(this.g&&ae.charAt(0)!="/"&&N.push("/"),N.push(ti(ae,ae.charAt(0)=="/"?ds:hs,!0))),(ae=this.i.toString())&&N.push("?",ae),(ae=this.m)&&N.push("#",ti(ae,Vi)),N.join("")},gn.prototype.resolve=function(N){const J=Hn(this);let ae=!!N.j;ae?Ci(J,N.j):ae=!!N.o,ae?J.o=N.o:ae=!!N.g,ae?J.g=N.g:ae=N.u!=null;var me=N.h;if(ae)bi(J,N.u);else if(ae=!!N.h){if(me.charAt(0)!="/")if(this.g&&!this.h)me="/"+me;else{var Ke=J.h.lastIndexOf("/");Ke!=-1&&(me=J.h.slice(0,Ke+1)+me)}if(Ke=me,Ke==".."||Ke==".")me="";else if(Ke.indexOf("./")!=-1||Ke.indexOf("/.")!=-1){me=Ke.lastIndexOf("/",0)==0,Ke=Ke.split("/");const it=[];for(let Xt=0;Xt<Ke.length;){const zn=Ke[Xt++];zn=="."?me&&Xt==Ke.length&&it.push(""):zn==".."?((it.length>1||it.length==1&&it[0]!="")&&it.pop(),me&&Xt==Ke.length&&it.push("")):(it.push(zn),me=!0)}me=it.join("/")}else me=Ke}return ae?J.h=me:ae=N.i.toString()!=="",ae?Yn(J,cl(N.i)):ae=!!N.m,ae&&(J.m=N.m),J};function Hn(N){return new gn(N)}function Ci(N,J,ae){N.j=ae?us(J,!0):J,N.j&&(N.j=N.j.replace(/:$/,""))}function bi(N,J){if(J){if(J=Number(J),isNaN(J)||J<0)throw Error("Bad port number "+J);N.u=J}else N.u=null}function Yn(N,J,ae){J instanceof pr?(N.i=J,du(N.i,N.l)):(ae||(J=ti(J,Nn)),N.i=new pr(J,N.l))}function Ht(N,J,ae){N.i.set(J,ae)}function jt(N){return Ht(N,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),N}function us(N,J){return N?J?decodeURI(N.replace(/%25/g,"%2525")):decodeURIComponent(N):""}function ti(N,J,ae){return typeof N=="string"?(N=encodeURI(N).replace(J,Oi),ae&&(N=N.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N):null}function Oi(N){return N=N.charCodeAt(0),"%"+(N>>4&15).toString(16)+(N&15).toString(16)}var Jr=/[#\/\?@]/g,hs=/[#\?:]/g,ds=/[#\?]/g,Nn=/[#\?@]/g,Vi=/#/g;function pr(N,J){this.h=this.g=null,this.i=N||null,this.j=!!J}function mi(N){N.g||(N.g=new Map,N.h=0,N.i&&zt(N.i,function(J,ae){N.add(decodeURIComponent(J.replace(/\+/g," ")),ae)}))}n=pr.prototype,n.add=function(N,J){mi(this),this.i=null,N=To(this,N);let ae=this.g.get(N);return ae||this.g.set(N,ae=[]),ae.push(J),this.h+=1,this};function Qs(N,J){mi(N),J=To(N,J),N.g.has(J)&&(N.i=null,N.h-=N.g.get(J).length,N.g.delete(J))}function fs(N,J){return mi(N),J=To(N,J),N.g.has(J)}n.forEach=function(N,J){mi(this),this.g.forEach(function(ae,me){ae.forEach(function(Ke){N.call(J,Ke,me,this)},this)},this)};function Ba(N,J){mi(N);let ae=[];if(typeof J=="string")fs(N,J)&&(ae=ae.concat(N.g.get(To(N,J))));else for(N=Array.from(N.g.values()),J=0;J<N.length;J++)ae=ae.concat(N[J]);return ae}n.set=function(N,J){return mi(this),this.i=null,N=To(this,N),fs(this,N)&&(this.h-=this.g.get(N).length),this.g.set(N,[J]),this.h+=1,this},n.get=function(N,J){return N?(N=Ba(this,N),N.length>0?String(N[0]):J):J};function Ih(N,J,ae){Qs(N,J),ae.length>0&&(N.i=null,N.g.set(To(N,J),S(ae)),N.h+=ae.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const N=[],J=Array.from(this.g.keys());for(let me=0;me<J.length;me++){var ae=J[me];const Ke=hn(ae);ae=Ba(this,ae);for(let it=0;it<ae.length;it++){let Xt=Ke;ae[it]!==""&&(Xt+="="+hn(ae[it])),N.push(Xt)}}return this.i=N.join("&")};function cl(N){const J=new pr;return J.i=N.i,N.g&&(J.g=new Map(N.g),J.h=N.h),J}function To(N,J){return J=String(J),N.j&&(J=J.toLowerCase()),J}function du(N,J){J&&!N.j&&(mi(N),N.i=null,N.g.forEach(function(ae,me){const Ke=me.toLowerCase();me!=Ke&&(Qs(this,me),Ih(this,Ke,ae))},N)),N.j=J}function vc(N,J){const ae=new Rn;if(u.Image){const me=new Image;me.onload=x(Pa,ae,"TestLoadImage: loaded",!0,J,me),me.onerror=x(Pa,ae,"TestLoadImage: error",!1,J,me),me.onabort=x(Pa,ae,"TestLoadImage: abort",!1,J,me),me.ontimeout=x(Pa,ae,"TestLoadImage: timeout",!1,J,me),u.setTimeout(function(){me.ontimeout&&me.ontimeout()},1e4),me.src=N}else J(!1)}function Sh(N,J){const ae=new Rn,me=new AbortController,Ke=setTimeout(()=>{me.abort(),Pa(ae,"TestPingServer: timeout",!1,J)},1e4);fetch(N,{signal:me.signal}).then(it=>{clearTimeout(Ke),it.ok?Pa(ae,"TestPingServer: ok",!0,J):Pa(ae,"TestPingServer: server error",!1,J)}).catch(()=>{clearTimeout(Ke),Pa(ae,"TestPingServer: error",!1,J)})}function Pa(N,J,ae,me,Ke){try{Ke&&(Ke.onload=null,Ke.onerror=null,Ke.onabort=null,Ke.ontimeout=null),me(ae)}catch{}}function Zd(){this.g=new vt}function Xn(N){this.i=N.Sb||null,this.h=N.ab||!1}b(Xn,pt),Xn.prototype.g=function(){return new ps(this.i,this.h)};function ps(N,J){te.call(this),this.H=N,this.o=J,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}b(ps,te),n=ps.prototype,n.open=function(N,J){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=N,this.D=J,this.readyState=1,hl(this)},n.send=function(N){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const J={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};N&&(J.body=N),(this.H||u).fetch(new Request(this.D,J)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ul(this)),this.readyState=0},n.Pa=function(N){if(this.g&&(this.l=N,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=N.headers,this.readyState=2,hl(this)),this.g&&(this.readyState=3,hl(this),this.g)))if(this.responseType==="arraybuffer")N.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in N){if(this.j=N.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ki(this)}else N.text().then(this.Oa.bind(this),this.ga.bind(this))};function ki(N){N.j.read().then(N.Ma.bind(N)).catch(N.ga.bind(N))}n.Ma=function(N){if(this.g){if(this.o&&N.value)this.response.push(N.value);else if(!this.o){var J=N.value?N.value:new Uint8Array(0);(J=this.B.decode(J,{stream:!N.done}))&&(this.response=this.responseText+=J)}N.done?ul(this):hl(this),this.readyState==3&&ki(this)}},n.Oa=function(N){this.g&&(this.response=this.responseText=N,ul(this))},n.Na=function(N){this.g&&(this.response=N,ul(this))},n.ga=function(){this.g&&ul(this)};function ul(N){N.readyState=4,N.l=null,N.j=null,N.B=null,hl(N)}n.setRequestHeader=function(N,J){this.A.append(N,J)},n.getResponseHeader=function(N){return this.h&&this.h.get(N.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const N=[],J=this.h.entries();for(var ae=J.next();!ae.done;)ae=ae.value,N.push(ae[0]+": "+ae[1]),ae=J.next();return N.join(`\r
`)};function hl(N){N.onreadystatechange&&N.onreadystatechange.call(N)}Object.defineProperty(ps.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(N){this.m=N?"include":"same-origin"}});function bc(N){let J="";return Fe(N,function(ae,me){J+=me,J+=":",J+=ae,J+=`\r
`}),J}function xc(N,J,ae){e:{for(me in ae){var me=!1;break e}me=!0}me||(ae=bc(ae),typeof N=="string"?ae!=null&&hn(ae):Ht(N,J,ae))}function Ui(N){te.call(this),this.headers=new Map,this.L=N||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}b(Ui,te);var fu=/^https?$/i,Ul=["POST","PUT"];n=Ui.prototype,n.Fa=function(N){this.H=N},n.ea=function(N,J,ae,me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+N);J=J?J.toUpperCase():"GET",this.D=N,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Dl.g(),this.g.onreadystatechange=E(g(this.Ca,this));try{this.B=!0,this.g.open(J,String(N),!0),this.B=!1}catch(it){mr(this,it);return}if(N=ae||"",ae=new Map(this.headers),me)if(Object.getPrototypeOf(me)===Object.prototype)for(var Ke in me)ae.set(Ke,me[Ke]);else if(typeof me.keys=="function"&&typeof me.get=="function")for(const it of me.keys())ae.set(it,me.get(it));else throw Error("Unknown input type for opt_headers: "+String(me));me=Array.from(ae.keys()).find(it=>it.toLowerCase()=="content-type"),Ke=u.FormData&&N instanceof u.FormData,!(Array.prototype.indexOf.call(Ul,J,void 0)>=0)||me||Ke||ae.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[it,Xt]of ae)this.g.setRequestHeader(it,Xt);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(N),this.v=!1}catch(it){mr(this,it)}};function mr(N,J){N.h=!1,N.g&&(N.j=!0,N.g.abort(),N.j=!1),N.l=J,N.o=5,ia(N),pu(N)}function ia(N){N.A||(N.A=!0,ce(N,"complete"),ce(N,"error"))}n.abort=function(N){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=N||7,ce(this,"complete"),ce(this,"abort"),pu(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pu(this,!0)),Ui.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?wc(this):this.Xa())},n.Xa=function(){wc(this)};function wc(N){if(N.h&&typeof l<"u"){if(N.v&&Mo(N)==4)setTimeout(N.Ca.bind(N),0);else if(ce(N,"readystatechange"),Mo(N)==4){N.h=!1;try{const it=N.ca();e:switch(it){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var J=!0;break e;default:J=!1}var ae;if(!(ae=J)){var me;if(me=it===0){let Xt=String(N.D).match(Sn)[1]||null;!Xt&&u.self&&u.self.location&&(Xt=u.self.location.protocol.slice(0,-1)),me=!fu.test(Xt?Xt.toLowerCase():"")}ae=me}if(ae)ce(N,"complete"),ce(N,"success");else{N.o=6;try{var Ke=Mo(N)>2?N.g.statusText:""}catch{Ke=""}N.l=Ke+" ["+N.ca()+"]",ia(N)}}finally{pu(N)}}}}function pu(N,J){if(N.g){N.m&&(clearTimeout(N.m),N.m=null);const ae=N.g;N.g=null,J||ce(N,"ready");try{ae.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Mo(N){return N.g?N.g.readyState:0}n.ca=function(){try{return Mo(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(N){if(this.g){var J=this.g.responseText;return N&&J.indexOf(N)==0&&(J=J.substring(N.length)),ut(J)}};function mu(N){try{if(!N.g)return null;if("response"in N.g)return N.g.response;switch(N.F){case"":case"text":return N.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in N.g)return N.g.mozResponseArrayBuffer}return null}catch{return null}}function gu(N){const J={};N=(N.g&&Mo(N)>=2&&N.g.getAllResponseHeaders()||"").split(`\r
`);for(let me=0;me<N.length;me++){if(oe(N[me]))continue;var ae=al(N[me]);const Ke=ae[0];if(ae=ae[1],typeof ae!="string")continue;ae=ae.trim();const it=J[Ke]||[];J[Ke]=it,it.push(ae)}Ie(J,function(me){return me.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Cc(N,J,ae){return ae&&ae.internalChannelParams&&ae.internalChannelParams[N]||J}function Th(N){this.za=0,this.i=[],this.j=new Rn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Cc("failFast",!1,N),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Cc("baseRetryDelayMs",5e3,N),this.Za=Cc("retryDelaySeedMs",1e4,N),this.Ta=Cc("forwardChannelMaxRetries",2,N),this.va=Cc("forwardChannelRequestTimeoutMs",2e4,N),this.ma=N&&N.xmlHttpFactory||void 0,this.Ua=N&&N.Rb||void 0,this.Aa=N&&N.useFetchStreams||!1,this.O=void 0,this.L=N&&N.supportsCrossDomainXhr||!1,this.M="",this.h=new rt(N&&N.concurrentRequestLimit),this.Ba=new Zd,this.S=N&&N.fastHandshake||!1,this.R=N&&N.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=N&&N.Pb||!1,N&&N.ua&&this.j.ua(),N&&N.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&N&&N.detectBufferingProxy||!1,this.ia=void 0,N&&N.longPollingTimeout&&N.longPollingTimeout>0&&(this.ia=N.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Th.prototype,n.ka=8,n.I=1,n.connect=function(N,J,ae,me){Dt(0),this.W=N,this.H=J||{},ae&&me!==void 0&&(this.H.OSID=ae,this.H.OAID=me),this.F=this.X,this.J=Rh(this,null,this.W),ra(this)};function ui(N){if(Rs(N),N.I==3){var J=N.V++,ae=Hn(N.J);if(Ht(ae,"SID",N.M),Ht(ae,"RID",J),Ht(ae,"TYPE","terminate"),Na(N,ae),J=new ks(N,N.j,J),J.M=2,J.A=jt(Hn(ae)),ae=!1,u.navigator&&u.navigator.sendBeacon)try{ae=u.navigator.sendBeacon(J.A.toString(),"")}catch{}!ae&&u.Image&&(new Image().src=J.A,ae=!0),ae||(J.g=xu(J.j,null),J.g.ea(J.A)),J.F=Date.now(),ll(J)}ko(N)}function Ec(N){N.g&&(qd(N),N.g.cancel(),N.g=null)}function Rs(N){Ec(N),N.v&&(u.clearTimeout(N.v),N.v=null),vu(N),N.h.cancel(),N.m&&(typeof N.m=="number"&&u.clearTimeout(N.m),N.m=null)}function ra(N){if(!Ge(N.h)&&!N.m){N.m=!0;var J=N.Ea;q||Q(),ne||(q(),ne=!0),K.add(J,N),N.D=0}}function Mh(N,J){return Nt(N.h)>=N.h.j-(N.m?1:0)?!1:N.m?(N.i=J.G.concat(N.i),!0):N.I==1||N.I==2||N.D>=(N.Sa?0:N.Ta)?!1:(N.m=sn(g(N.Ea,N,J),bu(N,N.D)),N.D++,!0)}n.Ea=function(N){if(this.m)if(this.m=null,this.I==1){if(!N){this.V=Math.floor(Math.random()*1e5),N=this.V++;const Ke=new ks(this,this.j,N);let it=this.o;if(this.U&&(it?(it=qe(it),Wt(it,this.U)):it=this.U),this.u!==null||this.R||(Ke.J=it,it=null),this.S)e:{for(var J=0,ae=0;ae<this.i.length;ae++){t:{var me=this.i[ae];if("__data__"in me.map&&(me=me.map.__data__,typeof me=="string")){me=me.length;break t}me=void 0}if(me===void 0)break;if(J+=me,J>4096){J=ae;break e}if(J===4096||ae===this.i.length-1){J=ae+1;break e}}J=1e3}else J=1e3;J=kh(this,Ke,J),ae=Hn(this.J),Ht(ae,"RID",N),Ht(ae,"CVER",22),this.G&&Ht(ae,"X-HTTP-Session-Id",this.G),Na(this,ae),it&&(this.R?J="headers="+hn(bc(it))+"&"+J:this.u&&xc(ae,this.u,it)),on(this.h,Ke),this.Ra&&Ht(ae,"TYPE","init"),this.S?(Ht(ae,"$req",J),Ht(ae,"SID","null"),Ke.U=!0,na(Ke,ae,null)):na(Ke,ae,J),this.I=2}}else this.I==3&&(N?yu(this,N):this.i.length==0||Ge(this.h)||yu(this))};function yu(N,J){var ae;J?ae=J.l:ae=N.V++;const me=Hn(N.J);Ht(me,"SID",N.M),Ht(me,"RID",ae),Ht(me,"AID",N.K),Na(N,me),N.u&&N.o&&xc(me,N.u,N.o),ae=new ks(N,N.j,ae,N.D+1),N.u===null&&(ae.J=N.o),J&&(N.i=J.G.concat(N.i)),J=kh(N,ae,1e3),ae.H=Math.round(N.va*.5)+Math.round(N.va*.5*Math.random()),on(N.h,ae),na(ae,me,J)}function Na(N,J){N.H&&Fe(N.H,function(ae,me){Ht(J,me,ae)}),N.l&&Fe({},function(ae,me){Ht(J,me,ae)})}function kh(N,J,ae){ae=Math.min(N.i.length,ae);const me=N.l?g(N.l.Ka,N.l,N):null;e:{var Ke=N.i;let zn=-1;for(;;){const xi=["count="+ae];zn==-1?ae>0?(zn=Ke[0].g,xi.push("ofs="+zn)):zn=0:xi.push("ofs="+zn);let Ii=!0;for(let lr=0;lr<ae;lr++){var it=Ke[lr].g;const so=Ke[lr].map;if(it-=zn,it<0)zn=Math.max(0,Ke[lr].g-100),Ii=!1;else try{it="req"+it+"_"||"";try{var Xt=so instanceof Map?so:Object.entries(so);for(const[Ro,oo]of Xt){let oa=oo;d(oo)&&(oa=Oe(oo)),xi.push(it+Ro+"="+encodeURIComponent(oa))}}catch(Ro){throw xi.push(it+"type="+encodeURIComponent("_badmap")),Ro}}catch{me&&me(so)}}if(Ii){Xt=xi.join("&");break e}}Xt=void 0}return N=N.i.splice(0,ae),J.G=N,Xt}function jd(N){if(!N.g&&!N.v){N.Y=1;var J=N.Da;q||Q(),ne||(q(),ne=!0),K.add(J,N),N.A=0}}function Yd(N){return N.g||N.v||N.A>=3?!1:(N.Y++,N.v=sn(g(N.Da,N),bu(N,N.A)),N.A++,!0)}n.Da=function(){if(this.v=null,Au(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var N=4*this.T;this.j.info("BP detection timer enabled: "+N),this.B=sn(g(this.Wa,this),N)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Dt(10),Ec(this),Au(this))};function qd(N){N.B!=null&&(u.clearTimeout(N.B),N.B=null)}function Au(N){N.g=new ks(N,N.j,"rpc",N.Y),N.u===null&&(N.g.J=N.o),N.g.P=0;var J=Hn(N.na);Ht(J,"RID","rpc"),Ht(J,"SID",N.M),Ht(J,"AID",N.K),Ht(J,"CI",N.F?"0":"1"),!N.F&&N.ia&&Ht(J,"TO",N.ia),Ht(J,"TYPE","xmlhttp"),Na(N,J),N.u&&N.o&&xc(J,N.u,N.o),N.O&&(N.g.H=N.O);var ae=N.g;N=N.ba,ae.M=1,ae.A=jt(Hn(J)),ae.u=null,ae.R=!0,ro(ae,N)}n.Va=function(){this.C!=null&&(this.C=null,Ec(this),Yd(this),Dt(19))};function vu(N){N.C!=null&&(u.clearTimeout(N.C),N.C=null)}function Ls(N,J){var ae=null;if(N.g==J){vu(N),qd(N),N.g=null;var me=2}else if(Kt(N.h,J))ae=J.G,dn(N.h,J),me=1;else return;if(N.I!=0){if(J.o)if(me==1){ae=J.u?J.u.length:0,J=Date.now()-J.F;var Ke=N.D;me=jn(),ce(me,new qt(me,ae)),ra(N)}else jd(N);else if(Ke=J.m,Ke==3||Ke==0&&J.X>0||!(me==1&&Mh(N,J)||me==2&&Yd(N)))switch(ae&&ae.length>0&&(J=N.h,J.i=J.i.concat(ae)),Ke){case 1:sa(N,5);break;case 4:sa(N,10);break;case 3:sa(N,6);break;default:sa(N,2)}}}function bu(N,J){let ae=N.Qa+Math.floor(Math.random()*N.Za);return N.isActive()||(ae*=2),ae*J}function sa(N,J){if(N.j.info("Error code "+J),J==2){var ae=g(N.bb,N),me=N.Ua;const Ke=!me;me=new gn(me||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ci(me,"https"),jt(me),Ke?vc(me.toString(),ae):Sh(me.toString(),ae)}else Dt(2);N.I=0,N.l&&N.l.pa(J),ko(N),Rs(N)}n.bb=function(N){N?(this.j.info("Successfully pinged google.com"),Dt(2)):(this.j.info("Failed to ping google.com"),Dt(1))};function ko(N){if(N.I=0,N.ja=[],N.l){const J=Ln(N.h);(J.length!=0||N.i.length!=0)&&(M(N.ja,J),M(N.ja,N.i),N.h.i.length=0,S(N.i),N.i.length=0),N.l.oa()}}function Rh(N,J,ae){var me=ae instanceof gn?Hn(ae):new gn(ae);if(me.g!="")J&&(me.g=J+"."+me.g),bi(me,me.u);else{var Ke=u.location;me=Ke.protocol,J=J?J+"."+Ke.hostname:Ke.hostname,Ke=+Ke.port;const it=new gn(null);me&&Ci(it,me),J&&(it.g=J),Ke&&bi(it,Ke),ae&&(it.h=ae),me=it}return ae=N.G,J=N.wa,ae&&J&&Ht(me,ae,J),Ht(me,"VER",N.ka),Na(N,me),me}function xu(N,J,ae){if(J&&!N.L)throw Error("Can't create secondary domain capable XhrIo object.");return J=N.Aa&&!N.ma?new Ui(new Xn({ab:ae})):new Ui(N.ma),J.Fa(N.L),J}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wu(){}n=wu.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function zl(){}zl.prototype.g=function(N,J){return new es(N,J)};function es(N,J){te.call(this),this.g=new Th(J),this.l=N,this.h=J&&J.messageUrlParams||null,N=J&&J.messageHeaders||null,J&&J.clientProtocolHeaderRequired&&(N?N["X-Client-Protocol"]="webchannel":N={"X-Client-Protocol":"webchannel"}),this.g.o=N,N=J&&J.initMessageHeaders||null,J&&J.messageContentType&&(N?N["X-WebChannel-Content-Type"]=J.messageContentType:N={"X-WebChannel-Content-Type":J.messageContentType}),J&&J.sa&&(N?N["X-WebChannel-Client-Profile"]=J.sa:N={"X-WebChannel-Client-Profile":J.sa}),this.g.U=N,(N=J&&J.Qb)&&!oe(N)&&(this.g.u=N),this.A=J&&J.supportsCrossDomainXhr||!1,this.v=J&&J.sendRawJson||!1,(J=J&&J.httpSessionIdParam)&&!oe(J)&&(this.g.G=J,N=this.h,N!==null&&J in N&&(N=this.h,J in N&&delete N[J])),this.j=new Ic(this)}b(es,te),es.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},es.prototype.close=function(){ui(this.g)},es.prototype.o=function(N){var J=this.g;if(typeof N=="string"){var ae={};ae.__data__=N,N=ae}else this.v&&(ae={},ae.__data__=Oe(N),N=ae);J.i.push(new nt(J.Ya++,N)),J.I==3&&ra(J)},es.prototype.N=function(){this.g.l=null,delete this.j,ui(this.g),delete this.g,es.Z.N.call(this)};function _c(N){Zt.call(this),N.__headers__&&(this.headers=N.__headers__,this.statusCode=N.__status__,delete N.__headers__,delete N.__status__);var J=N.__sm__;if(J){e:{for(const ae in J){N=ae;break e}N=void 0}(this.i=N)&&(N=this.i,J=J!==null&&N in J?J[N]:void 0),this.data=J}else this.data=N}b(_c,Zt);function Cu(){kn.call(this),this.status=1}b(Cu,kn);function Ic(N){this.g=N}b(Ic,wu),Ic.prototype.ra=function(){ce(this.g,"a")},Ic.prototype.qa=function(N){ce(this.g,new _c(N))},Ic.prototype.pa=function(N){ce(this.g,new Cu)},Ic.prototype.oa=function(){ce(this.g,"b")},zl.prototype.createWebChannel=zl.prototype.g,es.prototype.send=es.prototype.o,es.prototype.open=es.prototype.m,es.prototype.close=es.prototype.close,hee=function(){return new zl},uee=function(){return jn()},cee=Ft,bD={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ta.NO_ERROR=0,ta.TIMEOUT=8,ta.HTTP_ERROR=6,eI=ta,yc.COMPLETE="complete",lee=yc,cn.EventType=Tt,Tt.OPEN="a",Tt.CLOSE="b",Tt.ERROR="c",Tt.MESSAGE="d",te.prototype.listen=te.prototype.J,Jb=cn,Ui.prototype.listenOnce=Ui.prototype.K,Ui.prototype.getLastError=Ui.prototype.Ha,Ui.prototype.getLastErrorCode=Ui.prototype.ya,Ui.prototype.getStatus=Ui.prototype.ca,Ui.prototype.getResponseJson=Ui.prototype.La,Ui.prototype.getResponseText=Ui.prototype.la,Ui.prototype.send=Ui.prototype.ea,Ui.prototype.setWithCredentials=Ui.prototype.Fa,aee=Ui}).apply(typeof fE<"u"?fE:typeof self<"u"?self:typeof window<"u"?window:{});const XQ="@firebase/firestore",$Q="4.9.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ko=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ko.UNAUTHENTICATED=new Ko(null),Ko.GOOGLE_CREDENTIALS=new Ko("google-credentials-uid"),Ko.FIRST_PARTY=new Ko("first-party-uid"),Ko.MOCK_USER=new Ko("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QA="12.3.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg=new iO("@firebase/firestore");function Ry(){return Qg.logLevel}function bn(n,...e){if(Qg.logLevel<=Si.DEBUG){const t=e.map(oO);Qg.debug(`Firestore (${QA}): ${n}`,...t)}}function Od(n,...e){if(Qg.logLevel<=Si.ERROR){const t=e.map(oO);Qg.error(`Firestore (${QA}): ${n}`,...t)}}function LA(n,...e){if(Qg.logLevel<=Si.WARN){const t=e.map(oO);Qg.warn(`Firestore (${QA}): ${n}`,...t)}}function oO(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kn(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,dee(n,i,t)}function dee(n,e,t){let i=`FIRESTORE (${QA}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw Od(i),new Error(i)}function qi(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||dee(e,s,i)}function li(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _n extends xh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fee{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class JUe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ko.UNAUTHENTICATED))}shutdown(){}}class eze{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tze{constructor(e){this.t=e,this.currentUser=Ko.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){qi(this.o===void 0,42304);let i=this.i;const s=p=>this.i!==i?(i=this.i,t(p)):Promise.resolve();let l=new Cp;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Cp,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const p=l;e.enqueueRetryable(async()=>{await p.promise,await s(this.currentUser)})},d=p=>{bn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=p,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(p=>d(p)),setTimeout(()=>{if(!this.auth){const p=this.t.getImmediate({optional:!0});p?d(p):(bn("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Cp)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(bn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(qi(typeof i.accessToken=="string",31837,{l:i}),new fee(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return qi(e===null||typeof e=="string",2055,{h:e}),new Ko(e)}}class nze{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=Ko.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ize{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new nze(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ko.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class QQ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rze{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ac(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){qi(this.o===void 0,3512);const i=l=>{l.error!=null&&bn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.m;return this.m=l.token,bn("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>i(l))};const s=l=>{bn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(l=>s(l)),setTimeout(()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?s(l):bn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new QQ(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(qi(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new QQ(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sze(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=sze(40);for(let l=0;l<s.length;++l)i.length<20&&s[l]<t&&(i+=e.charAt(s[l]%62))}return i}}function Ti(n,e){return n<e?-1:n>e?1:0}function xD(n,e){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++){const s=n.charAt(i),l=e.charAt(i);if(s!==l)return oB(s)===oB(l)?Ti(s,l):oB(s)?1:-1}return Ti(n.length,e.length)}const oze=55296,aze=57343;function oB(n){const e=n.charCodeAt(0);return e>=oze&&e<=aze}function BA(n,e,t){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KQ="__name__";class qu{constructor(e,t,i){t===void 0?t=0:t>e.length&&Kn(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&Kn(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return qu.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof qu?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const l=qu.compareSegments(e.get(s),t.get(s));if(l!==0)return l}return Ti(e.length,t.length)}static compareSegments(e,t){const i=qu.isNumericId(e),s=qu.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?qu.extractNumericId(e).compare(qu.extractNumericId(t)):xD(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return wp.fromString(e.substring(4,e.length-2))}}class _r extends qu{construct(e,t,i){return new _r(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new _n(kt.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(s=>s.length>0))}return new _r(t)}static emptyPath(){return new _r([])}}const lze=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class bo extends qu{construct(e,t,i){return new bo(e,t,i)}static isValidIdentifier(e){return lze.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),bo.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===KQ}static keyField(){return new bo([KQ])}static fromServerFormat(e){const t=[];let i="",s=0;const l=()=>{if(i.length===0)throw new _n(kt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let u=!1;for(;s<e.length;){const d=e[s];if(d==="\\"){if(s+1===e.length)throw new _n(kt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const p=e[s+1];if(p!=="\\"&&p!=="."&&p!=="`")throw new _n(kt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=p,s+=2}else d==="`"?(u=!u,s++):d!=="."||u?(i+=d,s++):(l(),s++)}if(l(),u)throw new _n(kt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new bo(t)}static emptyPath(){return new bo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e){this.path=e}static fromPath(e){return new Un(_r.fromString(e))}static fromName(e){return new Un(_r.fromString(e).popFirst(5))}static empty(){return new Un(_r.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&_r.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return _r.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Un(new _r(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pee(n,e,t){if(!t)throw new _n(kt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function cze(n,e,t,i){if(e===!0&&i===!0)throw new _n(kt.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ZQ(n){if(!Un.isDocumentKey(n))throw new _n(kt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jQ(n){if(Un.isDocumentKey(n))throw new _n(kt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function mee(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function lO(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Kn(12329,{type:typeof n})}function Ep(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _n(kt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=lO(n);throw new _n(kt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ss(n,e){const t={typeString:n};return e&&(t.value=e),t}function Y1(n,e){if(!mee(n))throw new _n(kt.INVALID_ARGUMENT,"JSON must be an object");let t;for(const i in e)if(e[i]){const s=e[i].typeString,l="value"in e[i]?{value:e[i].value}:void 0;if(!(i in n)){t=`JSON missing required field: '${i}'`;break}const u=n[i];if(s&&typeof u!==s){t=`JSON field '${i}' must be a ${s}.`;break}if(l!==void 0&&u!==l.value){t=`Expected '${i}' field to equal '${l.value}'`;break}}if(t)throw new _n(kt.INVALID_ARGUMENT,t);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YQ=-62135596800,qQ=1e6;class Ir{static now(){return Ir.fromMillis(Date.now())}static fromDate(e){return Ir.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*qQ);return new Ir(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _n(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _n(kt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<YQ)throw new _n(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _n(kt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/qQ}_compareTo(e){return this.seconds===e.seconds?Ti(this.nanoseconds,e.nanoseconds):Ti(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Ir._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Y1(e,Ir._jsonSchema))return new Ir(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-YQ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Ir._jsonSchemaVersion="firestore/timestamp/1.0",Ir._jsonSchema={type:Ss("string",Ir._jsonSchemaVersion),seconds:Ss("number"),nanoseconds:Ss("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{static fromTimestamp(e){return new ii(e)}static min(){return new ii(new Ir(0,0))}static max(){return new ii(new Ir(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1=-1;function uze(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=ii.fromTimestamp(i===1e9?new Ir(t+1,0):new Ir(t,i));return new Dp(s,Un.empty(),e)}function hze(n){return new Dp(n.readTime,n.key,o1)}class Dp{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Dp(ii.min(),Un.empty(),o1)}static max(){return new Dp(ii.max(),Un.empty(),o1)}}function dze(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Un.comparator(n.documentKey,e.documentKey),t!==0?t:Ti(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fze="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pze{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KA(n){if(n.code!==kt.FAILED_PRECONDITION||n.message!==fze)throw n;bn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Kn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new _t((i,s)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(i,s)},this.catchCallback=l=>{this.wrapFailure(t,l).next(i,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof _t?t:_t.resolve(t)}catch(t){return _t.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):_t.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):_t.reject(t)}static resolve(e){return new _t((t,i)=>{t(e)})}static reject(e){return new _t((t,i)=>{i(e)})}static waitFor(e){return new _t((t,i)=>{let s=0,l=0,u=!1;e.forEach(d=>{++s,d.next(()=>{++l,u&&l===s&&t()},p=>i(p))}),u=!0,l===s&&t()})}static or(e){let t=_t.resolve(!1);for(const i of e)t=t.next(s=>s?_t.resolve(s):i());return t}static forEach(e,t){const i=[];return e.forEach((s,l)=>{i.push(t.call(this,s,l))}),this.waitFor(i)}static mapArray(e,t){return new _t((i,s)=>{const l=e.length,u=new Array(l);let d=0;for(let p=0;p<l;p++){const g=p;t(e[g]).next(x=>{u[g]=x,++d,d===l&&i(u)},x=>s(x))}})}static doWhile(e,t){return new _t((i,s)=>{const l=()=>{e()===!0?t().next(()=>{l()},s):i()};l()})}}function mze(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function ZA(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>t.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}qS.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cO=-1;function JS(n){return n==null}function n2(n){return n===0&&1/n==-1/0}function gze(n){return typeof n=="number"&&Number.isInteger(n)&&!n2(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gee="";function yze(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=JQ(e)),e=Aze(n.get(t),e);return JQ(e)}function Aze(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const l=n.charAt(s);switch(l){case"\0":t+="";break;case gee:t+="";break;default:t+=l}}return t}function JQ(n){return n+gee+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eK(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function l0(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function yee(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e,t){this.comparator=e,this.root=t||yo.EMPTY}insert(e,t){return new zr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,yo.BLACK,null,null))}remove(e){return new zr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yo.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new pE(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new pE(this.root,e,this.comparator,!1)}getReverseIterator(){return new pE(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new pE(this.root,e,this.comparator,!0)}}class pE{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?i(e.key,t):1,t&&s&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class yo{constructor(e,t,i,s,l){this.key=e,this.value=t,this.color=i??yo.RED,this.left=s??yo.EMPTY,this.right=l??yo.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,l){return new yo(e??this.key,t??this.value,i??this.color,s??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const l=i(e,s.key);return s=l<0?s.copy(null,null,null,s.left.insert(e,t,i),null):l===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yo.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return yo.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,yo.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,yo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Kn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Kn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Kn(27949);return e+(this.isRed()?0:1)}}yo.EMPTY=null,yo.RED=!0,yo.BLACK=!1;yo.EMPTY=new class{constructor(){this.size=0}get key(){throw Kn(57766)}get value(){throw Kn(16141)}get color(){throw Kn(16727)}get left(){throw Kn(29726)}get right(){throw Kn(36894)}copy(e,t,i,s,l){return this}insert(e,t,i){return new yo(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e){this.comparator=e,this.data=new zr(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tK(this.data.getIterator())}getIteratorFrom(e){return new tK(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Hs)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,l=i.getNext().key;if(this.comparator(s,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Hs(this.comparator);return t.data=e,t}}class tK{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e){this.fields=e,e.sort(bo.comparator)}static empty(){return new Jc([])}unionWith(e){let t=new Hs(bo.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Jc(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return BA(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aee extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new Aee("Invalid base64 string: "+l):l}}(e);return new _o(t)}static fromUint8Array(e){const t=function(s){let l="";for(let u=0;u<s.length;++u)l+=String.fromCharCode(s[u]);return l}(e);return new _o(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ti(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}_o.EMPTY_BYTE_STRING=new _o("");const vze=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Fp(n){if(qi(!!n,39018),typeof n=="string"){let e=0;const t=vze.exec(n);if(qi(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ss(n.seconds),nanos:ss(n.nanos)}}function ss(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Op(n){return typeof n=="string"?_o.fromBase64String(n):_o.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vee="server_timestamp",bee="__type__",xee="__previous_value__",wee="__local_write_time__";function uO(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[bee])==null?void 0:i.stringValue)===vee}function eT(n){const e=n.mapValue.fields[xee];return uO(e)?eT(e):e}function a1(n){const e=Fp(n.mapValue.fields[wee].timestampValue);return new Ir(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bze{constructor(e,t,i,s,l,u,d,p,g,x){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=d,this.longPollingOptions=p,this.useFetchStreams=g,this.isUsingEmulator=x}}const i2="(default)";class l1{constructor(e,t){this.projectId=e,this.database=t||i2}static empty(){return new l1("","")}get isDefaultDatabase(){return this.database===i2}isEqual(e){return e instanceof l1&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cee="__type__",xze="__max__",mE={mapValue:{}},Eee="__vector__",r2="value";function Vp(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?uO(n)?4:Cze(n)?9007199254740991:wze(n)?10:11:Kn(28295,{value:n})}function yh(n,e){if(n===e)return!0;const t=Vp(n);if(t!==Vp(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return a1(n).isEqual(a1(e));case 3:return function(s,l){if(typeof s.timestampValue=="string"&&typeof l.timestampValue=="string"&&s.timestampValue.length===l.timestampValue.length)return s.timestampValue===l.timestampValue;const u=Fp(s.timestampValue),d=Fp(l.timestampValue);return u.seconds===d.seconds&&u.nanos===d.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,l){return Op(s.bytesValue).isEqual(Op(l.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,l){return ss(s.geoPointValue.latitude)===ss(l.geoPointValue.latitude)&&ss(s.geoPointValue.longitude)===ss(l.geoPointValue.longitude)}(n,e);case 2:return function(s,l){if("integerValue"in s&&"integerValue"in l)return ss(s.integerValue)===ss(l.integerValue);if("doubleValue"in s&&"doubleValue"in l){const u=ss(s.doubleValue),d=ss(l.doubleValue);return u===d?n2(u)===n2(d):isNaN(u)&&isNaN(d)}return!1}(n,e);case 9:return BA(n.arrayValue.values||[],e.arrayValue.values||[],yh);case 10:case 11:return function(s,l){const u=s.mapValue.fields||{},d=l.mapValue.fields||{};if(eK(u)!==eK(d))return!1;for(const p in u)if(u.hasOwnProperty(p)&&(d[p]===void 0||!yh(u[p],d[p])))return!1;return!0}(n,e);default:return Kn(52216,{left:n})}}function c1(n,e){return(n.values||[]).find(t=>yh(t,e))!==void 0}function PA(n,e){if(n===e)return 0;const t=Vp(n),i=Vp(e);if(t!==i)return Ti(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return Ti(n.booleanValue,e.booleanValue);case 2:return function(l,u){const d=ss(l.integerValue||l.doubleValue),p=ss(u.integerValue||u.doubleValue);return d<p?-1:d>p?1:d===p?0:isNaN(d)?isNaN(p)?0:-1:1}(n,e);case 3:return nK(n.timestampValue,e.timestampValue);case 4:return nK(a1(n),a1(e));case 5:return xD(n.stringValue,e.stringValue);case 6:return function(l,u){const d=Op(l),p=Op(u);return d.compareTo(p)}(n.bytesValue,e.bytesValue);case 7:return function(l,u){const d=l.split("/"),p=u.split("/");for(let g=0;g<d.length&&g<p.length;g++){const x=Ti(d[g],p[g]);if(x!==0)return x}return Ti(d.length,p.length)}(n.referenceValue,e.referenceValue);case 8:return function(l,u){const d=Ti(ss(l.latitude),ss(u.latitude));return d!==0?d:Ti(ss(l.longitude),ss(u.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return iK(n.arrayValue,e.arrayValue);case 10:return function(l,u){var E,S,M,R;const d=l.fields||{},p=u.fields||{},g=(E=d[r2])==null?void 0:E.arrayValue,x=(S=p[r2])==null?void 0:S.arrayValue,b=Ti(((M=g==null?void 0:g.values)==null?void 0:M.length)||0,((R=x==null?void 0:x.values)==null?void 0:R.length)||0);return b!==0?b:iK(g,x)}(n.mapValue,e.mapValue);case 11:return function(l,u){if(l===mE.mapValue&&u===mE.mapValue)return 0;if(l===mE.mapValue)return 1;if(u===mE.mapValue)return-1;const d=l.fields||{},p=Object.keys(d),g=u.fields||{},x=Object.keys(g);p.sort(),x.sort();for(let b=0;b<p.length&&b<x.length;++b){const E=xD(p[b],x[b]);if(E!==0)return E;const S=PA(d[p[b]],g[x[b]]);if(S!==0)return S}return Ti(p.length,x.length)}(n.mapValue,e.mapValue);default:throw Kn(23264,{he:t})}}function nK(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Ti(n,e);const t=Fp(n),i=Fp(e),s=Ti(t.seconds,i.seconds);return s!==0?s:Ti(t.nanos,i.nanos)}function iK(n,e){const t=n.values||[],i=e.values||[];for(let s=0;s<t.length&&s<i.length;++s){const l=PA(t[s],i[s]);if(l)return l}return Ti(t.length,i.length)}function NA(n){return wD(n)}function wD(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=Fp(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Op(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Un.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",s=!0;for(const l of t.values||[])s?s=!1:i+=",",i+=wD(l);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let s="{",l=!0;for(const u of i)l?l=!1:s+=",",s+=`${u}:${wD(t.fields[u])}`;return s+"}"}(n.mapValue):Kn(61005,{value:n})}function tI(n){switch(Vp(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=eT(n);return e?16+tI(e):16;case 5:return 2*n.stringValue.length;case 6:return Op(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((s,l)=>s+tI(l),0)}(n.arrayValue);case 10:case 11:return function(i){let s=0;return l0(i.fields,(l,u)=>{s+=l.length+tI(u)}),s}(n.mapValue);default:throw Kn(13486,{value:n})}}function CD(n){return!!n&&"integerValue"in n}function hO(n){return!!n&&"arrayValue"in n}function rK(n){return!!n&&"nullValue"in n}function sK(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function nI(n){return!!n&&"mapValue"in n}function wze(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)==null?void 0:t.fields)||{})[Cee])==null?void 0:i.stringValue)===Eee}function xx(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return l0(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=xx(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xx(n.arrayValue.values[t]);return e}return{...n}}function Cze(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===xze}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e){this.value=e}static empty(){return new lc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!nI(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xx(t)}setAll(e){let t=bo.emptyPath(),i={},s=[];e.forEach((u,d)=>{if(!t.isImmediateParentOf(d)){const p=this.getFieldsMap(t);this.applyChanges(p,i,s),i={},s=[],t=d.popLast()}u?i[d.lastSegment()]=xx(u):s.push(d.lastSegment())});const l=this.getFieldsMap(t);this.applyChanges(l,i,s)}delete(e){const t=this.field(e.popLast());nI(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return yh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];nI(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){l0(t,(s,l)=>e[s]=l);for(const s of i)delete e[s]}clone(){return new lc(xx(this.value))}}function _ee(n){const e=[];return l0(n.fields,(t,i)=>{const s=new bo([t]);if(nI(i)){const l=_ee(i.mapValue).fields;if(l.length===0)e.push(s);else for(const u of l)e.push(s.child(u))}else e.push(s)}),new Jc(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t,i,s,l,u,d){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=l,this.data=u,this.documentState=d}static newInvalidDocument(e){return new jo(e,0,ii.min(),ii.min(),ii.min(),lc.empty(),0)}static newFoundDocument(e,t,i,s){return new jo(e,1,t,ii.min(),i,s,0)}static newNoDocument(e,t){return new jo(e,2,t,ii.min(),ii.min(),lc.empty(),0)}static newUnknownDocument(e,t){return new jo(e,3,t,ii.min(),ii.min(),lc.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ii.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ii.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof jo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new jo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s2{constructor(e,t){this.position=e,this.inclusive=t}}function oK(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const l=e[s],u=n.position[s];if(l.field.isKeyField()?i=Un.comparator(Un.fromName(u.referenceValue),t.key):i=PA(u,t.data.field(l.field)),l.dir==="desc"&&(i*=-1),i!==0)break}return i}function aK(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!yh(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o2{constructor(e,t="asc"){this.field=e,this.dir=t}}function Eze(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iee{}class zs extends Iee{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Ize(e,t,i):t==="array-contains"?new Mze(e,i):t==="in"?new kze(e,i):t==="not-in"?new Rze(e,i):t==="array-contains-any"?new Lze(e,i):new zs(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Sze(e,i):new Tze(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(PA(t,this.value)):t!==null&&Vp(this.value)===Vp(t)&&this.matchesComparison(PA(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Kn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ah extends Iee{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ah(e,t)}matches(e){return See(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function See(n){return n.op==="and"}function Tee(n){return _ze(n)&&See(n)}function _ze(n){for(const e of n.filters)if(e instanceof Ah)return!1;return!0}function ED(n){if(n instanceof zs)return n.field.canonicalString()+n.op.toString()+NA(n.value);if(Tee(n))return n.filters.map(e=>ED(e)).join(",");{const e=n.filters.map(t=>ED(t)).join(",");return`${n.op}(${e})`}}function Mee(n,e){return n instanceof zs?function(i,s){return s instanceof zs&&i.op===s.op&&i.field.isEqual(s.field)&&yh(i.value,s.value)}(n,e):n instanceof Ah?function(i,s){return s instanceof Ah&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce((l,u,d)=>l&&Mee(u,s.filters[d]),!0):!1}(n,e):void Kn(19439)}function kee(n){return n instanceof zs?function(t){return`${t.field.canonicalString()} ${t.op} ${NA(t.value)}`}(n):n instanceof Ah?function(t){return t.op.toString()+" {"+t.getFilters().map(kee).join(" ,")+"}"}(n):"Filter"}class Ize extends zs{constructor(e,t,i){super(e,t,i),this.key=Un.fromName(i.referenceValue)}matches(e){const t=Un.comparator(e.key,this.key);return this.matchesComparison(t)}}class Sze extends zs{constructor(e,t){super(e,"in",t),this.keys=Ree("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Tze extends zs{constructor(e,t){super(e,"not-in",t),this.keys=Ree("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ree(n,e){var t;return(((t=e.arrayValue)==null?void 0:t.values)||[]).map(i=>Un.fromName(i.referenceValue))}class Mze extends zs{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return hO(t)&&c1(t.arrayValue,this.value)}}class kze extends zs{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&c1(this.value.arrayValue,t)}}class Rze extends zs{constructor(e,t){super(e,"not-in",t)}matches(e){if(c1(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!c1(this.value.arrayValue,t)}}class Lze extends zs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!hO(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>c1(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bze{constructor(e,t=null,i=[],s=[],l=null,u=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=l,this.startAt=u,this.endAt=d,this.Te=null}}function lK(n,e=null,t=[],i=[],s=null,l=null,u=null){return new Bze(n,e,t,i,s,l,u)}function dO(n){const e=li(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>ED(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(l){return l.field.canonicalString()+l.dir}(i)).join(","),JS(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>NA(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>NA(i)).join(",")),e.Te=t}return e.Te}function fO(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Eze(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Mee(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!aK(n.startAt,e.startAt)&&aK(n.endAt,e.endAt)}function _D(n){return Un.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(e,t=null,i=[],s=[],l=null,u="F",d=null,p=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=l,this.limitType=u,this.startAt=d,this.endAt=p,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Pze(n,e,t,i,s,l,u,d){return new tT(n,e,t,i,s,l,u,d)}function nT(n){return new tT(n)}function cK(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Nze(n){return n.collectionGroup!==null}function wx(n){const e=li(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),t.add(l.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let d=new Hs(bo.comparator);return u.filters.forEach(p=>{p.getFlattenedFilters().forEach(g=>{g.isInequality()&&(d=d.add(g.field))})}),d})(e).forEach(l=>{t.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new o2(l,i))}),t.has(bo.keyField().canonicalString())||e.Ie.push(new o2(bo.keyField(),i))}return e.Ie}function ch(n){const e=li(n);return e.Ee||(e.Ee=Dze(e,wx(n))),e.Ee}function Dze(n,e){if(n.limitType==="F")return lK(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const l=s.dir==="desc"?"asc":"desc";return new o2(s.field,l)});const t=n.endAt?new s2(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new s2(n.startAt.position,n.startAt.inclusive):null;return lK(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function ID(n,e,t){return new tT(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function iT(n,e){return fO(ch(n),ch(e))&&n.limitType===e.limitType}function Lee(n){return`${dO(ch(n))}|lt:${n.limitType}`}function Ly(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(s=>kee(s)).join(", ")}]`),JS(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(s=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(s)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(s=>NA(s)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(s=>NA(s)).join(",")),`Target(${i})`}(ch(n))}; limitType=${n.limitType})`}function rT(n,e){return e.isFoundDocument()&&function(i,s){const l=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(l):Un.isDocumentKey(i.path)?i.path.isEqual(l):i.path.isImmediateParentOf(l)}(n,e)&&function(i,s){for(const l of wx(i))if(!l.field.isKeyField()&&s.data.field(l.field)===null)return!1;return!0}(n,e)&&function(i,s){for(const l of i.filters)if(!l.matches(s))return!1;return!0}(n,e)&&function(i,s){return!(i.startAt&&!function(u,d,p){const g=oK(u,d,p);return u.inclusive?g<=0:g<0}(i.startAt,wx(i),s)||i.endAt&&!function(u,d,p){const g=oK(u,d,p);return u.inclusive?g>=0:g>0}(i.endAt,wx(i),s))}(n,e)}function Fze(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Bee(n){return(e,t)=>{let i=!1;for(const s of wx(n)){const l=Oze(s,e,t);if(l!==0)return l;i=i||s.field.isKeyField()}return 0}}function Oze(n,e,t){const i=n.field.isKeyField()?Un.comparator(e.key,t.key):function(l,u,d){const p=u.data.field(l),g=d.data.field(l);return p!==null&&g!==null?PA(p,g):Kn(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Kn(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,l]of i)if(this.equalsFn(s,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let l=0;l<s.length;l++)if(this.equalsFn(s[l][0],e))return void(s[l]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){l0(this.inner,(t,i)=>{for(const[s,l]of i)e(s,l)})}isEmpty(){return yee(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vze=new zr(Un.comparator);function Vd(){return Vze}const Pee=new zr(Un.comparator);function ex(...n){let e=Pee;for(const t of n)e=e.insert(t.key,t);return e}function Nee(n){let e=Pee;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function Ig(){return Cx()}function Dee(){return Cx()}function Cx(){return new c0(n=>n.toString(),(n,e)=>n.isEqual(e))}const Uze=new zr(Un.comparator),zze=new Hs(Un.comparator);function Mi(...n){let e=zze;for(const t of n)e=e.add(t);return e}const Gze=new Hs(Ti);function Wze(){return Gze}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:n2(e)?"-0":e}}function Fee(n){return{integerValue:""+n}}function Oee(n,e){return gze(e)?Fee(e):pO(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(){this._=void 0}}function Hze(n,e,t){return n instanceof u1?function(s,l){const u={fields:{[bee]:{stringValue:vee},[wee]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return l&&uO(l)&&(l=eT(l)),l&&(u.fields[xee]=l),{mapValue:u}}(t,e):n instanceof h1?Uee(n,e):n instanceof d1?zee(n,e):function(s,l){const u=Vee(s,l),d=uK(u)+uK(s.Ae);return CD(u)&&CD(s.Ae)?Fee(d):pO(s.serializer,d)}(n,e)}function Xze(n,e,t){return n instanceof h1?Uee(n,e):n instanceof d1?zee(n,e):t}function Vee(n,e){return n instanceof f1?function(i){return CD(i)||function(l){return!!l&&"doubleValue"in l}(i)}(e)?e:{integerValue:0}:null}class u1 extends sT{}class h1 extends sT{constructor(e){super(),this.elements=e}}function Uee(n,e){const t=Gee(e);for(const i of n.elements)t.some(s=>yh(s,i))||t.push(i);return{arrayValue:{values:t}}}class d1 extends sT{constructor(e){super(),this.elements=e}}function zee(n,e){let t=Gee(e);for(const i of n.elements)t=t.filter(s=>!yh(s,i));return{arrayValue:{values:t}}}class f1 extends sT{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function uK(n){return ss(n.integerValue||n.doubleValue)}function Gee(n){return hO(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wee{constructor(e,t){this.field=e,this.transform=t}}function $ze(n,e){return n.field.isEqual(e.field)&&function(i,s){return i instanceof h1&&s instanceof h1||i instanceof d1&&s instanceof d1?BA(i.elements,s.elements,yh):i instanceof f1&&s instanceof f1?yh(i.Ae,s.Ae):i instanceof u1&&s instanceof u1}(n.transform,e.transform)}class Qze{constructor(e,t){this.version=e,this.transformResults=t}}class Id{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Id}static exists(e){return new Id(void 0,e)}static updateTime(e){return new Id(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function iI(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class oT{}function Hee(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new $ee(n.key,Id.none()):new q1(n.key,n.data,Id.none());{const t=n.data,i=lc.empty();let s=new Hs(bo.comparator);for(let l of e.fields)if(!s.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?i.delete(l):i.set(l,u),s=s.add(l)}return new u0(n.key,i,new Jc(s.toArray()),Id.none())}}function Kze(n,e,t){n instanceof q1?function(s,l,u){const d=s.value.clone(),p=dK(s.fieldTransforms,l,u.transformResults);d.setAll(p),l.convertToFoundDocument(u.version,d).setHasCommittedMutations()}(n,e,t):n instanceof u0?function(s,l,u){if(!iI(s.precondition,l))return void l.convertToUnknownDocument(u.version);const d=dK(s.fieldTransforms,l,u.transformResults),p=l.data;p.setAll(Xee(s)),p.setAll(d),l.convertToFoundDocument(u.version,p).setHasCommittedMutations()}(n,e,t):function(s,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()}(0,e,t)}function Ex(n,e,t,i){return n instanceof q1?function(l,u,d,p){if(!iI(l.precondition,u))return d;const g=l.value.clone(),x=fK(l.fieldTransforms,p,u);return g.setAll(x),u.convertToFoundDocument(u.version,g).setHasLocalMutations(),null}(n,e,t,i):n instanceof u0?function(l,u,d,p){if(!iI(l.precondition,u))return d;const g=fK(l.fieldTransforms,p,u),x=u.data;return x.setAll(Xee(l)),x.setAll(g),u.convertToFoundDocument(u.version,x).setHasLocalMutations(),d===null?null:d.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map(b=>b.field))}(n,e,t,i):function(l,u,d){return iI(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):d}(n,e,t)}function Zze(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),l=Vee(i.transform,s||null);l!=null&&(t===null&&(t=lc.empty()),t.set(i.field,l))}return t||null}function hK(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&BA(i,s,(l,u)=>$ze(l,u))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class q1 extends oT{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class u0 extends oT{constructor(e,t,i,s,l=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function Xee(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function dK(n,e,t){const i=new Map;qi(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const l=n[s],u=l.transform,d=e.data.field(l.field);i.set(l.field,Xze(u,d,t[s]))}return i}function fK(n,e,t){const i=new Map;for(const s of n){const l=s.transform,u=t.data.field(s.field);i.set(s.field,Hze(l,u,e))}return i}class $ee extends oT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jze extends oT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yze{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const l=this.mutations[s];l.key.isEqual(e.key)&&Kze(l,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Ex(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Ex(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=Dee();return this.mutations.forEach(s=>{const l=e.get(s.key),u=l.overlayedDocument;let d=this.applyToLocalView(u,l.mutatedFields);d=t.has(s.key)?null:d;const p=Hee(u,d);p!==null&&i.set(s.key,p),u.isValidDocument()||u.convertToNoDocument(ii.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Mi())}isEqual(e){return this.batchId===e.batchId&&BA(this.mutations,e.mutations,(t,i)=>hK(t,i))&&BA(this.baseMutations,e.baseMutations,(t,i)=>hK(t,i))}}class mO{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){qi(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let s=function(){return Uze}();const l=e.mutations;for(let u=0;u<l.length;u++)s=s.insert(l[u].key,i[u].version);return new mO(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qze{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jze{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Es,Ni;function eGe(n){switch(n){case kt.OK:return Kn(64938);case kt.CANCELLED:case kt.UNKNOWN:case kt.DEADLINE_EXCEEDED:case kt.RESOURCE_EXHAUSTED:case kt.INTERNAL:case kt.UNAVAILABLE:case kt.UNAUTHENTICATED:return!1;case kt.INVALID_ARGUMENT:case kt.NOT_FOUND:case kt.ALREADY_EXISTS:case kt.PERMISSION_DENIED:case kt.FAILED_PRECONDITION:case kt.ABORTED:case kt.OUT_OF_RANGE:case kt.UNIMPLEMENTED:case kt.DATA_LOSS:return!0;default:return Kn(15467,{code:n})}}function Qee(n){if(n===void 0)return Od("GRPC error has no .code"),kt.UNKNOWN;switch(n){case Es.OK:return kt.OK;case Es.CANCELLED:return kt.CANCELLED;case Es.UNKNOWN:return kt.UNKNOWN;case Es.DEADLINE_EXCEEDED:return kt.DEADLINE_EXCEEDED;case Es.RESOURCE_EXHAUSTED:return kt.RESOURCE_EXHAUSTED;case Es.INTERNAL:return kt.INTERNAL;case Es.UNAVAILABLE:return kt.UNAVAILABLE;case Es.UNAUTHENTICATED:return kt.UNAUTHENTICATED;case Es.INVALID_ARGUMENT:return kt.INVALID_ARGUMENT;case Es.NOT_FOUND:return kt.NOT_FOUND;case Es.ALREADY_EXISTS:return kt.ALREADY_EXISTS;case Es.PERMISSION_DENIED:return kt.PERMISSION_DENIED;case Es.FAILED_PRECONDITION:return kt.FAILED_PRECONDITION;case Es.ABORTED:return kt.ABORTED;case Es.OUT_OF_RANGE:return kt.OUT_OF_RANGE;case Es.UNIMPLEMENTED:return kt.UNIMPLEMENTED;case Es.DATA_LOSS:return kt.DATA_LOSS;default:return Kn(39323,{code:n})}}(Ni=Es||(Es={}))[Ni.OK=0]="OK",Ni[Ni.CANCELLED=1]="CANCELLED",Ni[Ni.UNKNOWN=2]="UNKNOWN",Ni[Ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ni[Ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ni[Ni.NOT_FOUND=5]="NOT_FOUND",Ni[Ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ni[Ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ni[Ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ni[Ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ni[Ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ni[Ni.ABORTED=10]="ABORTED",Ni[Ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ni[Ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ni[Ni.INTERNAL=13]="INTERNAL",Ni[Ni.UNAVAILABLE=14]="UNAVAILABLE",Ni[Ni.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tGe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nGe=new wp([4294967295,4294967295],0);function pK(n){const e=tGe().encode(n),t=new oee;return t.update(e),new Uint8Array(t.digest())}function mK(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),i=e.getUint32(4,!0),s=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new wp([t,i],0),new wp([s,l],0)]}class gO{constructor(e,t,i){if(this.bitmap=e,this.padding=t,this.hashCount=i,t<0||t>=8)throw new tx(`Invalid padding: ${t}`);if(i<0)throw new tx(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new tx(`Invalid hash count: ${i}`);if(e.length===0&&t!==0)throw new tx(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=wp.fromNumber(this.ge)}ye(e,t,i){let s=e.add(t.multiply(wp.fromNumber(i)));return s.compare(nGe)===1&&(s=new wp([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=pK(e),[i,s]=mK(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(i,s,l);if(!this.we(u))return!1}return!0}static create(e,t,i){const s=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new gO(l,s,t);return i.forEach(d=>u.insert(d)),u}insert(e){if(this.ge===0)return;const t=pK(e),[i,s]=mK(t);for(let l=0;l<this.hashCount;l++){const u=this.ye(i,s,l);this.Se(u)}}Se(e){const t=Math.floor(e/8),i=e%8;this.bitmap[t]|=1<<i}}class tx extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT{constructor(e,t,i,s,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const s=new Map;return s.set(e,J1.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new aT(ii.min(),s,new zr(Ti),Vd(),Mi())}}class J1{constructor(e,t,i,s,l){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new J1(i,t,Mi(),Mi(),Mi())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e,t,i,s){this.be=e,this.removedTargetIds=t,this.key=i,this.De=s}}class Kee{constructor(e,t){this.targetId=e,this.Ce=t}}class Zee{constructor(e,t,i=_o.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=s}}class gK{constructor(){this.ve=0,this.Fe=yK(),this.Me=_o.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Mi(),t=Mi(),i=Mi();return this.Fe.forEach((s,l)=>{switch(l){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:i=i.add(s);break;default:Kn(38017,{changeType:l})}}),new J1(this.Me,this.xe,e,t,i)}qe(){this.Oe=!1,this.Fe=yK()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,qi(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class iGe{constructor(e){this.Ge=e,this.ze=new Map,this.je=Vd(),this.Je=gE(),this.He=gE(),this.Ye=new zr(Ti)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const i=this.nt(t);switch(e.state){case 0:this.rt(t)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),i.Le(e.resumeToken));break;default:Kn(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((i,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,i=e.Ce.count,s=this.ot(t);if(s){const l=s.target;if(_D(l))if(i===0){const u=new Un(l.path);this.et(t,u,jo.newNoDocument(u,ii.min()))}else qi(i===1,20013,{expectedCount:i});else{const u=this._t(t);if(u!==i){const d=this.ut(e),p=d?this.ct(d,e,u):1;if(p!==0){this.it(t);const g=p===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,g)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:i="",padding:s=0},hashCount:l=0}=t;let u,d;try{u=Op(i).toUint8Array()}catch(p){if(p instanceof Aee)return LA("Decoding the base64 bloom filter in existence filter failed ("+p.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw p}try{d=new gO(u,s,l)}catch(p){return LA(p instanceof tx?"BloomFilter error: ":"Applying bloom filter failed: ",p),null}return d.ge===0?null:d}ct(e,t,i){return t.Ce.count===i-this.Pt(e,t.targetId)?0:2}Pt(e,t){const i=this.Ge.getRemoteKeysForTarget(t);let s=0;return i.forEach(l=>{const u=this.Ge.ht(),d=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(d)||(this.et(t,l,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((l,u)=>{const d=this.ot(u);if(d){if(l.current&&_D(d.target)){const p=new Un(d.target.path);this.It(p).has(u)||this.Et(u,p)||this.et(u,p,jo.newNoDocument(p,e))}l.Be&&(t.set(u,l.ke()),l.qe())}});let i=Mi();this.He.forEach((l,u)=>{let d=!0;u.forEachWhile(p=>{const g=this.ot(p);return!g||g.purpose==="TargetPurposeLimboResolution"||(d=!1,!1)}),d&&(i=i.add(l))}),this.je.forEach((l,u)=>u.setReadTime(e));const s=new aT(e,t,this.Ye,this.je,i);return this.je=Vd(),this.Je=gE(),this.He=gE(),this.Ye=new zr(Ti),s}Xe(e,t){if(!this.rt(e))return;const i=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,i),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,i){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),i&&(this.je=this.je.insert(t,i))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new gK,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Hs(Ti),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Hs(Ti),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||bn("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new gK),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function gE(){return new zr(Un.comparator)}function yK(){return new zr(Un.comparator)}const rGe={asc:"ASCENDING",desc:"DESCENDING"},sGe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oGe={and:"AND",or:"OR"};class aGe{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function SD(n,e){return n.useProto3Json||JS(e)?e:{value:e}}function a2(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function jee(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function lGe(n,e){return a2(n,e.toTimestamp())}function uh(n){return qi(!!n,49232),ii.fromTimestamp(function(t){const i=Fp(t);return new Ir(i.seconds,i.nanos)}(n))}function yO(n,e){return TD(n,e).canonicalString()}function TD(n,e){const t=function(s){return new _r(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Yee(n){const e=_r.fromString(n);return qi(nte(e),10190,{key:e.toString()}),e}function MD(n,e){return yO(n.databaseId,e.path)}function aB(n,e){const t=Yee(e);if(t.get(1)!==n.databaseId.projectId)throw new _n(kt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _n(kt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Un(Jee(t))}function qee(n,e){return yO(n.databaseId,e)}function cGe(n){const e=Yee(n);return e.length===4?_r.emptyPath():Jee(e)}function kD(n){return new _r(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Jee(n){return qi(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function AK(n,e,t){return{name:MD(n,e),fields:t.value.mapValue.fields}}function uGe(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(g){return g==="NO_CHANGE"?0:g==="ADD"?1:g==="REMOVE"?2:g==="CURRENT"?3:g==="RESET"?4:Kn(39313,{state:g})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],l=function(g,x){return g.useProto3Json?(qi(x===void 0||typeof x=="string",58123),_o.fromBase64String(x||"")):(qi(x===void 0||x instanceof Buffer||x instanceof Uint8Array,16193),_o.fromUint8Array(x||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,d=u&&function(g){const x=g.code===void 0?kt.UNKNOWN:Qee(g.code);return new _n(x,g.message||"")}(u);t=new Zee(i,s,l,d||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=aB(n,i.document.name),l=uh(i.document.updateTime),u=i.document.createTime?uh(i.document.createTime):ii.min(),d=new lc({mapValue:{fields:i.document.fields}}),p=jo.newFoundDocument(s,l,u,d),g=i.targetIds||[],x=i.removedTargetIds||[];t=new rI(g,x,p.key,p)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=aB(n,i.document),l=i.readTime?uh(i.readTime):ii.min(),u=jo.newNoDocument(s,l),d=i.removedTargetIds||[];t=new rI([],d,u.key,u)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=aB(n,i.document),l=i.removedTargetIds||[];t=new rI([],l,s,null)}else{if(!("filter"in e))return Kn(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:s=0,unchangedNames:l}=i,u=new Jze(s,l),d=i.targetId;t=new Kee(d,u)}}return t}function hGe(n,e){let t;if(e instanceof q1)t={update:AK(n,e.key,e.value)};else if(e instanceof $ee)t={delete:MD(n,e.key)};else if(e instanceof u0)t={update:AK(n,e.key,e.data),updateMask:bGe(e.fieldMask)};else{if(!(e instanceof jze))return Kn(16599,{Vt:e.type});t={verify:MD(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(l,u){const d=u.transform;if(d instanceof u1)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(d instanceof h1)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:d.elements}};if(d instanceof d1)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:d.elements}};if(d instanceof f1)return{fieldPath:u.field.canonicalString(),increment:d.Ae};throw Kn(20930,{transform:u.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(s,l){return l.updateTime!==void 0?{updateTime:lGe(s,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Kn(27497)}(n,e.precondition)),t}function dGe(n,e){return n&&n.length>0?(qi(e!==void 0,14353),n.map(t=>function(s,l){let u=s.updateTime?uh(s.updateTime):uh(l);return u.isEqual(ii.min())&&(u=uh(l)),new Qze(u,s.transformResults||[])}(t,e))):[]}function fGe(n,e){return{documents:[qee(n,e.path)]}}function pGe(n,e){const t={structuredQuery:{}},i=e.path;let s;e.collectionGroup!==null?(s=i,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=i.popLast(),t.structuredQuery.from=[{collectionId:i.lastSegment()}]),t.parent=qee(n,s);const l=function(g){if(g.length!==0)return tte(Ah.create(g,"and"))}(e.filters);l&&(t.structuredQuery.where=l);const u=function(g){if(g.length!==0)return g.map(x=>function(E){return{field:By(E.field),direction:yGe(E.dir)}}(x))}(e.orderBy);u&&(t.structuredQuery.orderBy=u);const d=SD(n,e.limit);return d!==null&&(t.structuredQuery.limit=d),e.startAt&&(t.structuredQuery.startAt=function(g){return{before:g.inclusive,values:g.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(g){return{before:!g.inclusive,values:g.position}}(e.endAt)),{ft:t,parent:s}}function mGe(n){let e=cGe(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){qi(i===1,65062);const x=t.from[0];x.allDescendants?s=x.collectionId:e=e.child(x.collectionId)}let l=[];t.where&&(l=function(b){const E=ete(b);return E instanceof Ah&&Tee(E)?E.getFilters():[E]}(t.where));let u=[];t.orderBy&&(u=function(b){return b.map(E=>function(M){return new o2(Py(M.field),function(P){switch(P){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(M.direction))}(E))}(t.orderBy));let d=null;t.limit&&(d=function(b){let E;return E=typeof b=="object"?b.value:b,JS(E)?null:E}(t.limit));let p=null;t.startAt&&(p=function(b){const E=!!b.before,S=b.values||[];return new s2(S,E)}(t.startAt));let g=null;return t.endAt&&(g=function(b){const E=!b.before,S=b.values||[];return new s2(S,E)}(t.endAt)),Pze(e,s,u,l,d,"F",p,g)}function gGe(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Kn(28987,{purpose:s})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ete(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=Py(t.unaryFilter.field);return zs.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=Py(t.unaryFilter.field);return zs.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=Py(t.unaryFilter.field);return zs.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=Py(t.unaryFilter.field);return zs.create(u,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Kn(61313);default:return Kn(60726)}}(n):n.fieldFilter!==void 0?function(t){return zs.create(Py(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Kn(58110);default:return Kn(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Ah.create(t.compositeFilter.filters.map(i=>ete(i)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Kn(1026)}}(t.compositeFilter.op))}(n):Kn(30097,{filter:n})}function yGe(n){return rGe[n]}function AGe(n){return sGe[n]}function vGe(n){return oGe[n]}function By(n){return{fieldPath:n.canonicalString()}}function Py(n){return bo.fromServerFormat(n.fieldPath)}function tte(n){return n instanceof zs?function(t){if(t.op==="=="){if(sK(t.value))return{unaryFilter:{field:By(t.field),op:"IS_NAN"}};if(rK(t.value))return{unaryFilter:{field:By(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sK(t.value))return{unaryFilter:{field:By(t.field),op:"IS_NOT_NAN"}};if(rK(t.value))return{unaryFilter:{field:By(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:By(t.field),op:AGe(t.op),value:t.value}}}(n):n instanceof Ah?function(t){const i=t.getFilters().map(s=>tte(s));return i.length===1?i[0]:{compositeFilter:{op:vGe(t.op),filters:i}}}(n):Kn(54877,{filter:n})}function bGe(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function nte(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cp{constructor(e,t,i,s,l=ii.min(),u=ii.min(),d=_o.EMPTY_BYTE_STRING,p=null){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=d,this.expectedCount=p}withSequenceNumber(e){return new cp(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cp(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xGe{constructor(e){this.yt=e}}function wGe(n){const e=mGe({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ID(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CGe{constructor(){this.Cn=new EGe}addToCollectionParentIndex(e,t){return this.Cn.add(t),_t.resolve()}getCollectionParents(e,t){return _t.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return _t.resolve()}deleteFieldIndex(e,t){return _t.resolve()}deleteAllFieldIndexes(e){return _t.resolve()}createTargetIndexes(e,t){return _t.resolve()}getDocumentsMatchingTarget(e,t){return _t.resolve(null)}getIndexType(e,t){return _t.resolve(0)}getFieldIndexes(e,t){return _t.resolve([])}getNextCollectionGroupToUpdate(e){return _t.resolve(null)}getMinOffset(e,t){return _t.resolve(Dp.min())}getMinOffsetFromCollectionGroup(e,t){return _t.resolve(Dp.min())}updateCollectionGroup(e,t,i){return _t.resolve()}updateIndexEntries(e,t){return _t.resolve()}}class EGe{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new Hs(_r.comparator),l=!s.has(i);return this.index[t]=s.add(i),l}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new Hs(_r.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vK={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ite=41943040;class Qa{static withCacheSize(e){return new Qa(e,Qa.DEFAULT_COLLECTION_PERCENTILE,Qa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qa.DEFAULT_COLLECTION_PERCENTILE=10,Qa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qa.DEFAULT=new Qa(ite,Qa.DEFAULT_COLLECTION_PERCENTILE,Qa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qa.DISABLED=new Qa(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new DA(0)}static cr(){return new DA(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bK="LruGarbageCollector",_Ge=1048576;function xK([n,e],[t,i]){const s=Ti(n,t);return s===0?Ti(e,i):s}class IGe{constructor(e){this.Ir=e,this.buffer=new Hs(xK),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();xK(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class SGe{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){bn(bK,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ZA(t)?bn(bK,"Ignoring IndexedDB error during garbage collection: ",t):await KA(t)}await this.Vr(3e5)})}}class TGe{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return _t.resolve(qS.ce);const i=new IGe(t);return this.mr.forEachTarget(e,s=>i.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>i.Ar(s))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.mr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(bn("LruGarbageCollector","Garbage collection skipped; disabled"),_t.resolve(vK)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(bn("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),vK):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let i,s,l,u,d,p,g;const x=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(b=>(b>this.params.maximumSequenceNumbersToCollect?(bn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),s=this.params.maximumSequenceNumbersToCollect):s=b,u=Date.now(),this.nthSequenceNumber(e,s))).next(b=>(i=b,d=Date.now(),this.removeTargets(e,i,t))).next(b=>(l=b,p=Date.now(),this.removeOrphanedDocuments(e,i))).next(b=>(g=Date.now(),Ry()<=Si.DEBUG&&bn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-x}ms
	Determined least recently used ${s} in `+(d-u)+`ms
	Removed ${l} targets in `+(p-d)+`ms
	Removed ${b} documents in `+(g-p)+`ms
Total Duration: ${g-x}ms`),_t.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:l,documentsRemoved:b})))}}function MGe(n,e){return new TGe(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kGe{constructor(){this.changes=new c0(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,jo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?_t.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RGe{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LGe{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(i=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(i!==null&&Ex(i.mutation,s,Jc.empty(),Ir.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,Mi()).next(()=>i))}getLocalViewOfDocuments(e,t,i=Mi()){const s=Ig();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,i).next(l=>{let u=ex();return l.forEach((d,p)=>{u=u.insert(d,p.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const i=Ig();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,Mi()))}populateOverlays(e,t,i){const s=[];return i.forEach(l=>{t.has(l)||s.push(l)}),this.documentOverlayCache.getOverlays(e,s).next(l=>{l.forEach((u,d)=>{t.set(u,d)})})}computeViews(e,t,i,s){let l=Vd();const u=Cx(),d=function(){return Cx()}();return t.forEach((p,g)=>{const x=i.get(g.key);s.has(g.key)&&(x===void 0||x.mutation instanceof u0)?l=l.insert(g.key,g):x!==void 0?(u.set(g.key,x.mutation.getFieldMask()),Ex(x.mutation,g,x.mutation.getFieldMask(),Ir.now())):u.set(g.key,Jc.empty())}),this.recalculateAndSaveOverlays(e,l).next(p=>(p.forEach((g,x)=>u.set(g,x)),t.forEach((g,x)=>d.set(g,new RGe(x,u.get(g)??null))),d))}recalculateAndSaveOverlays(e,t){const i=Cx();let s=new zr((u,d)=>u-d),l=Mi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const d of u)d.keys().forEach(p=>{const g=t.get(p);if(g===null)return;let x=i.get(p)||Jc.empty();x=d.applyToLocalView(g,x),i.set(p,x);const b=(s.get(d.batchId)||Mi()).add(p);s=s.insert(d.batchId,b)})}).next(()=>{const u=[],d=s.getReverseIterator();for(;d.hasNext();){const p=d.getNext(),g=p.key,x=p.value,b=Dee();x.forEach(E=>{if(!l.has(E)){const S=Hee(t.get(E),i.get(E));S!==null&&b.set(E,S),l=l.add(E)}}),u.push(this.documentOverlayCache.saveOverlays(e,g,b))}return _t.waitFor(u)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,s){return function(u){return Un.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Nze(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next(l=>{const u=s-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-l.size):_t.resolve(Ig());let d=o1,p=l;return u.next(g=>_t.forEach(g,(x,b)=>(d<b.largestBatchId&&(d=b.largestBatchId),l.get(x)?_t.resolve():this.remoteDocumentCache.getEntry(e,x).next(E=>{p=p.insert(x,E)}))).next(()=>this.populateOverlays(e,g,l)).next(()=>this.computeViews(e,p,g,Mi())).next(x=>({batchId:d,changes:Nee(x)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Un(t)).next(i=>{let s=ex();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const l=t.collectionGroup;let u=ex();return this.indexManager.getCollectionParents(e,l).next(d=>_t.forEach(d,p=>{const g=function(b,E){return new tT(E,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)}(t,p.child(l));return this.getDocumentsMatchingCollectionQuery(e,g,i,s).next(x=>{x.forEach((b,E)=>{u=u.insert(b,E)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(e,t,i,s){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,l,s))).next(u=>{l.forEach((p,g)=>{const x=g.getKey();u.get(x)===null&&(u=u.insert(x,jo.newInvalidDocument(x)))});let d=ex();return u.forEach((p,g)=>{const x=l.get(p);x!==void 0&&Ex(x.mutation,g,Jc.empty(),Ir.now()),rT(t,g)&&(d=d.insert(p,g))}),d})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BGe{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return _t.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:uh(s.createTime)}}(t)),_t.resolve()}getNamedQuery(e,t){return _t.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(s){return{name:s.name,query:wGe(s.bundledQuery),readTime:uh(s.readTime)}}(t)),_t.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PGe{constructor(){this.overlays=new zr(Un.comparator),this.qr=new Map}getOverlay(e,t){return _t.resolve(this.overlays.get(t))}getOverlays(e,t){const i=Ig();return _t.forEach(t,s=>this.getOverlay(e,s).next(l=>{l!==null&&i.set(s,l)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((s,l)=>{this.St(e,t,l)}),_t.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.qr.get(i);return s!==void 0&&(s.forEach(l=>this.overlays=this.overlays.remove(l)),this.qr.delete(i)),_t.resolve()}getOverlaysForCollection(e,t,i){const s=Ig(),l=t.length+1,u=new Un(t.child("")),d=this.overlays.getIteratorFrom(u);for(;d.hasNext();){const p=d.getNext().value,g=p.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===l&&p.largestBatchId>i&&s.set(p.getKey(),p)}return _t.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let l=new zr((g,x)=>g-x);const u=this.overlays.getIterator();for(;u.hasNext();){const g=u.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>i){let x=l.get(g.largestBatchId);x===null&&(x=Ig(),l=l.insert(g.largestBatchId,x)),x.set(g.getKey(),g)}}const d=Ig(),p=l.getIterator();for(;p.hasNext()&&(p.getNext().value.forEach((g,x)=>d.set(g,x)),!(d.size()>=s)););return _t.resolve(d)}St(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const u=this.qr.get(s.largestBatchId).delete(i.key);this.qr.set(s.largestBatchId,u)}this.overlays=this.overlays.insert(i.key,new qze(t,i));let l=this.qr.get(t);l===void 0&&(l=Mi(),this.qr.set(t,l)),this.qr.set(t,l.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NGe{constructor(){this.sessionToken=_o.EMPTY_BYTE_STRING}getSessionToken(e){return _t.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,_t.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(){this.Qr=new Hs(to.$r),this.Ur=new Hs(to.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const i=new to(e,t);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.Gr(new to(e,t))}zr(e,t){e.forEach(i=>this.removeReference(i,t))}jr(e){const t=new Un(new _r([])),i=new to(t,e),s=new to(t,e+1),l=[];return this.Ur.forEachInRange([i,s],u=>{this.Gr(u),l.push(u.key)}),l}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Un(new _r([])),i=new to(t,e),s=new to(t,e+1);let l=Mi();return this.Ur.forEachInRange([i,s],u=>{l=l.add(u.key)}),l}containsKey(e){const t=new to(e,0),i=this.Qr.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class to{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Un.comparator(e.key,t.key)||Ti(e.Yr,t.Yr)}static Kr(e,t){return Ti(e.Yr,t.Yr)||Un.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DGe{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Hs(to.$r)}checkEmpty(e){return _t.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new Yze(l,t,i,s);this.mutationQueue.push(u);for(const d of s)this.Zr=this.Zr.add(new to(d.key,l)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return _t.resolve(u)}lookupMutationBatch(e,t){return _t.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.ei(i),l=s<0?0:s;return _t.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return _t.resolve(this.mutationQueue.length===0?cO:this.tr-1)}getAllMutationBatches(e){return _t.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new to(t,0),s=new to(t,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([i,s],u=>{const d=this.Xr(u.Yr);l.push(d)}),_t.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Hs(Ti);return t.forEach(s=>{const l=new to(s,0),u=new to(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,u],d=>{i=i.add(d.Yr)})}),_t.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let l=i;Un.isDocumentKey(l)||(l=l.child(""));const u=new to(new Un(l),0);let d=new Hs(Ti);return this.Zr.forEachWhile(p=>{const g=p.key.path;return!!i.isPrefixOf(g)&&(g.length===s&&(d=d.add(p.Yr)),!0)},u),_t.resolve(this.ti(d))}ti(e){const t=[];return e.forEach(i=>{const s=this.Xr(i);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){qi(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return _t.forEach(t.mutations,s=>{const l=new to(s.key,t.batchId);return i=i.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=i})}ir(e){}containsKey(e,t){const i=new to(t,0),s=this.Zr.firstAfterOrEqual(i);return _t.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,_t.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FGe{constructor(e){this.ri=e,this.docs=function(){return new zr(Un.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),l=s?s.size:0,u=this.ri(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return _t.resolve(i?i.document.mutableCopy():jo.newInvalidDocument(t))}getEntries(e,t){let i=Vd();return t.forEach(s=>{const l=this.docs.get(s);i=i.insert(s,l?l.document.mutableCopy():jo.newInvalidDocument(s))}),_t.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let l=Vd();const u=t.path,d=new Un(u.child("__id-9223372036854775808__")),p=this.docs.getIteratorFrom(d);for(;p.hasNext();){const{key:g,value:{document:x}}=p.getNext();if(!u.isPrefixOf(g.path))break;g.path.length>u.length+1||dze(hze(x),i)<=0||(s.has(x.key)||rT(t,x))&&(l=l.insert(x.key,x.mutableCopy()))}return _t.resolve(l)}getAllFromCollectionGroup(e,t,i,s){Kn(9500)}ii(e,t){return _t.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new OGe(this)}getSize(e){return _t.resolve(this.size)}}class OGe extends kGe{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(i)}),_t.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VGe{constructor(e){this.persistence=e,this.si=new c0(t=>dO(t),fO),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.oi=0,this._i=new AO,this.targetCount=0,this.ai=DA.ur()}forEachTarget(e,t){return this.si.forEach((i,s)=>t(s)),_t.resolve()}getLastRemoteSnapshotVersion(e){return _t.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return _t.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),_t.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.oi&&(this.oi=t),_t.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new DA(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,_t.resolve()}updateTargetData(e,t){return this.Pr(t),_t.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,_t.resolve()}removeTargets(e,t,i){let s=0;const l=[];return this.si.forEach((u,d)=>{d.sequenceNumber<=t&&i.get(d.targetId)===null&&(this.si.delete(u),l.push(this.removeMatchingKeysForTargetId(e,d.targetId)),s++)}),_t.waitFor(l).next(()=>s)}getTargetCount(e){return _t.resolve(this.targetCount)}getTargetData(e,t){const i=this.si.get(t)||null;return _t.resolve(i)}addMatchingKeys(e,t,i){return this._i.Wr(t,i),_t.resolve()}removeMatchingKeys(e,t,i){this._i.zr(t,i);const s=this.persistence.referenceDelegate,l=[];return s&&t.forEach(u=>{l.push(s.markPotentiallyOrphaned(e,u))}),_t.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),_t.resolve()}getMatchingKeysForTargetId(e,t){const i=this._i.Hr(t);return _t.resolve(i)}containsKey(e,t){return _t.resolve(this._i.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rte{constructor(e,t){this.ui={},this.overlays={},this.ci=new qS(0),this.li=!1,this.li=!0,this.hi=new NGe,this.referenceDelegate=e(this),this.Pi=new VGe(this),this.indexManager=new CGe,this.remoteDocumentCache=function(s){return new FGe(s)}(i=>this.referenceDelegate.Ti(i)),this.serializer=new xGe(t),this.Ii=new BGe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new PGe,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ui[e.toKey()];return i||(i=new DGe(t,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,i){bn("MemoryPersistence","Starting transaction:",e);const s=new UGe(this.ci.next());return this.referenceDelegate.Ei(),i(s).next(l=>this.referenceDelegate.di(s).next(()=>l)).toPromise().then(l=>(s.raiseOnCommittedEvent(),l))}Ai(e,t){return _t.or(Object.values(this.ui).map(i=>()=>i.containsKey(e,t)))}}class UGe extends pze{constructor(e){super(),this.currentSequenceNumber=e}}class vO{constructor(e){this.persistence=e,this.Ri=new AO,this.Vi=null}static mi(e){return new vO(e)}get fi(){if(this.Vi)return this.Vi;throw Kn(60996)}addReference(e,t,i){return this.Ri.addReference(i,t),this.fi.delete(i.toString()),_t.resolve()}removeReference(e,t,i){return this.Ri.removeReference(i,t),this.fi.add(i.toString()),_t.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),_t.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(s=>this.fi.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(l=>this.fi.add(l.toString()))}).next(()=>i.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _t.forEach(this.fi,i=>{const s=Un.fromPath(i);return this.gi(e,s).next(l=>{l||t.removeEntry(s,ii.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(i=>{i?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return _t.or([()=>_t.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class l2{constructor(e,t){this.persistence=e,this.pi=new c0(i=>yze(i.path),(i,s)=>i.isEqual(s)),this.garbageCollector=MGe(this,t)}static mi(e,t){return new l2(e,t)}Ei(){}di(e){return _t.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}wr(e){let t=0;return this.pr(e,i=>{t++}).next(()=>t)}pr(e,t){return _t.forEach(this.pi,(i,s)=>this.br(e,i,s).next(l=>l?_t.resolve():t(s)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const s=this.persistence.getRemoteDocumentCache(),l=s.newChangeBuffer();return s.ii(e,u=>this.br(e,u,t).next(d=>{d||(i++,l.removeEntry(u,ii.min()))})).next(()=>l.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),_t.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),_t.resolve()}removeReference(e,t,i){return this.pi.set(i,e.currentSequenceNumber),_t.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),_t.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=tI(e.data.value)),t}br(e,t,i){return _t.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return _t.resolve(s!==void 0&&s>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Es=i,this.ds=s}static As(e,t){let i=Mi(),s=Mi();for(const l of t.docChanges)switch(l.type){case 0:i=i.add(l.doc.key);break;case 1:s=s.add(l.doc.key)}return new bO(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zGe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GGe{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return NVe()?8:mze(Jo())>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,i,s){const l={result:null};return this.ys(e,t).next(u=>{l.result=u}).next(()=>{if(!l.result)return this.ws(e,t,s,i).next(u=>{l.result=u})}).next(()=>{if(l.result)return;const u=new zGe;return this.Ss(e,t,u).next(d=>{if(l.result=d,this.Vs)return this.bs(e,t,u,d.size)})}).next(()=>l.result)}bs(e,t,i,s){return i.documentReadCount<this.fs?(Ry()<=Si.DEBUG&&bn("QueryEngine","SDK will not create cache indexes for query:",Ly(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),_t.resolve()):(Ry()<=Si.DEBUG&&bn("QueryEngine","Query:",Ly(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.gs*s?(Ry()<=Si.DEBUG&&bn("QueryEngine","The SDK decides to create cache indexes for query:",Ly(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ch(t))):_t.resolve())}ys(e,t){if(cK(t))return _t.resolve(null);let i=ch(t);return this.indexManager.getIndexType(e,i).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=ID(t,null,"F"),i=ch(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(l=>{const u=Mi(...l);return this.ps.getDocuments(e,u).next(d=>this.indexManager.getMinOffset(e,i).next(p=>{const g=this.Ds(t,d);return this.Cs(t,g,u,p.readTime)?this.ys(e,ID(t,null,"F")):this.vs(e,g,t,p)}))})))}ws(e,t,i,s){return cK(t)||s.isEqual(ii.min())?_t.resolve(null):this.ps.getDocuments(e,i).next(l=>{const u=this.Ds(t,l);return this.Cs(t,u,i,s)?_t.resolve(null):(Ry()<=Si.DEBUG&&bn("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ly(t)),this.vs(e,u,t,uze(s,o1)).next(d=>d))})}Ds(e,t){let i=new Hs(Bee(e));return t.forEach((s,l)=>{rT(e,l)&&(i=i.add(l))}),i}Cs(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(s)>0)}Ss(e,t,i){return Ry()<=Si.DEBUG&&bn("QueryEngine","Using full collection scan to execute query:",Ly(t)),this.ps.getDocumentsMatchingQuery(e,t,Dp.min(),i)}vs(e,t,i,s){return this.ps.getDocumentsMatchingQuery(e,i,s).next(l=>(t.forEach(u=>{l=l.insert(u.key,u)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xO="LocalStore",WGe=3e8;class HGe{constructor(e,t,i,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new zr(Ti),this.xs=new c0(l=>dO(l),fO),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new LGe(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function XGe(n,e,t,i){return new HGe(n,e,t,i)}async function ste(n,e){const t=li(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(l=>(s=l,t.Bs(e),t.mutationQueue.getAllMutationBatches(i))).next(l=>{const u=[],d=[];let p=Mi();for(const g of s){u.push(g.batchId);for(const x of g.mutations)p=p.add(x.key)}for(const g of l){d.push(g.batchId);for(const x of g.mutations)p=p.add(x.key)}return t.localDocuments.getDocuments(i,p).next(g=>({Ls:g,removedBatchIds:u,addedBatchIds:d}))})})}function $Ge(n,e){const t=li(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),l=t.Ns.newChangeBuffer({trackRemovals:!0});return function(d,p,g,x){const b=g.batch,E=b.keys();let S=_t.resolve();return E.forEach(M=>{S=S.next(()=>x.getEntry(p,M)).next(R=>{const P=g.docVersions.get(M);qi(P!==null,48541),R.version.compareTo(P)<0&&(b.applyToRemoteDocument(R,g),R.isValidDocument()&&(R.setReadTime(g.commitVersion),x.addEntry(R)))})}),S.next(()=>d.mutationQueue.removeMutationBatch(p,b))}(t,i,e,l).next(()=>l.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(d){let p=Mi();for(let g=0;g<d.mutationResults.length;++g)d.mutationResults[g].transformResults.length>0&&(p=p.add(d.batch.mutations[g].key));return p}(e))).next(()=>t.localDocuments.getDocuments(i,s))})}function ote(n){const e=li(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}function QGe(n,e){const t=li(n),i=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const u=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const d=[];e.targetChanges.forEach((x,b)=>{const E=s.get(b);if(!E)return;d.push(t.Pi.removeMatchingKeys(l,x.removedDocuments,b).next(()=>t.Pi.addMatchingKeys(l,x.addedDocuments,b)));let S=E.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(b)!==null?S=S.withResumeToken(_o.EMPTY_BYTE_STRING,ii.min()).withLastLimboFreeSnapshotVersion(ii.min()):x.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(x.resumeToken,i)),s=s.insert(b,S),function(R,P,k){return R.resumeToken.approximateByteSize()===0||P.snapshotVersion.toMicroseconds()-R.snapshotVersion.toMicroseconds()>=WGe?!0:k.addedDocuments.size+k.modifiedDocuments.size+k.removedDocuments.size>0}(E,S,x)&&d.push(t.Pi.updateTargetData(l,S))});let p=Vd(),g=Mi();if(e.documentUpdates.forEach(x=>{e.resolvedLimboDocuments.has(x)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(l,x))}),d.push(KGe(l,u,e.documentUpdates).next(x=>{p=x.ks,g=x.qs})),!i.isEqual(ii.min())){const x=t.Pi.getLastRemoteSnapshotVersion(l).next(b=>t.Pi.setTargetsMetadata(l,l.currentSequenceNumber,i));d.push(x)}return _t.waitFor(d).next(()=>u.apply(l)).next(()=>t.localDocuments.getLocalViewOfDocuments(l,p,g)).next(()=>p)}).then(l=>(t.Ms=s,l))}function KGe(n,e,t){let i=Mi(),s=Mi();return t.forEach(l=>i=i.add(l)),e.getEntries(n,i).next(l=>{let u=Vd();return t.forEach((d,p)=>{const g=l.get(d);p.isFoundDocument()!==g.isFoundDocument()&&(s=s.add(d)),p.isNoDocument()&&p.version.isEqual(ii.min())?(e.removeEntry(d,p.readTime),u=u.insert(d,p)):!g.isValidDocument()||p.version.compareTo(g.version)>0||p.version.compareTo(g.version)===0&&g.hasPendingWrites?(e.addEntry(p),u=u.insert(d,p)):bn(xO,"Ignoring outdated watch update for ",d,". Current version:",g.version," Watch version:",p.version)}),{ks:u,qs:s}})}function ZGe(n,e){const t=li(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=cO),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function jGe(n,e){const t=li(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return t.Pi.getTargetData(i,e).next(l=>l?(s=l,_t.resolve(s)):t.Pi.allocateTargetId(i).next(u=>(s=new cp(e,u,"TargetPurposeListen",i.currentSequenceNumber),t.Pi.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=t.Ms.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(i.targetId,i),t.xs.set(e,i.targetId)),i})}async function RD(n,e,t){const i=li(n),s=i.Ms.get(e),l=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",l,u=>i.persistence.referenceDelegate.removeTarget(u,s))}catch(u){if(!ZA(u))throw u;bn(xO,`Failed to update sequence numbers for target ${e}: ${u}`)}i.Ms=i.Ms.remove(e),i.xs.delete(s.target)}function wK(n,e,t){const i=li(n);let s=ii.min(),l=Mi();return i.persistence.runTransaction("Execute query","readwrite",u=>function(p,g,x){const b=li(p),E=b.xs.get(x);return E!==void 0?_t.resolve(b.Ms.get(E)):b.Pi.getTargetData(g,x)}(i,u,ch(e)).next(d=>{if(d)return s=d.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(u,d.targetId).next(p=>{l=p})}).next(()=>i.Fs.getDocumentsMatchingQuery(u,e,t?s:ii.min(),t?l:Mi())).next(d=>(YGe(i,Fze(e),d),{documents:d,Qs:l})))}function YGe(n,e,t){let i=n.Os.get(e)||ii.min();t.forEach((s,l)=>{l.readTime.compareTo(i)>0&&(i=l.readTime)}),n.Os.set(e,i)}class CK{constructor(){this.activeTargetIds=Wze()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class qGe{constructor(){this.Mo=new CK,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,i){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new CK,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JGe{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EK="ConnectivityMonitor";class _K{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){bn(EK,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){bn(EK,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yE=null;function LD(){return yE===null?yE=function(){return 268435456+Math.round(2147483648*Math.random())}():yE++,"0x"+yE.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lB="RestConnection",e5e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class t5e{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${i}/databases/${s}`,this.Wo=this.databaseId.database===i2?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Go(e,t,i,s,l){const u=LD(),d=this.zo(e,t.toUriEncodedString());bn(lB,`Sending RPC '${e}' ${u}:`,d,i);const p={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(p,s,l);const{host:g}=new URL(d),x=o0(g);return this.Jo(e,d,p,i,x).then(b=>(bn(lB,`Received RPC '${e}' ${u}: `,b),b),b=>{throw LA(lB,`RPC '${e}' ${u} failed with error: `,b,"url: ",d,"request:",i),b})}Ho(e,t,i,s,l,u){return this.Go(e,t,i,s,l)}jo(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+QA}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,l)=>e[l]=s),i&&i.headers.forEach((s,l)=>e[l]=s)}zo(e,t){const i=e5e[e];return`${this.Uo}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5e{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="WebChannelConnection";class i5e extends t5e{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,s,l){const u=LD();return new Promise((d,p)=>{const g=new aee;g.setWithCredentials(!0),g.listenOnce(lee.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case eI.NO_ERROR:const b=g.getResponseJson();bn(Go,`XHR for RPC '${e}' ${u} received:`,JSON.stringify(b)),d(b);break;case eI.TIMEOUT:bn(Go,`RPC '${e}' ${u} timed out`),p(new _n(kt.DEADLINE_EXCEEDED,"Request time out"));break;case eI.HTTP_ERROR:const E=g.getStatus();if(bn(Go,`RPC '${e}' ${u} failed with status:`,E,"response text:",g.getResponseText()),E>0){let S=g.getResponseJson();Array.isArray(S)&&(S=S[0]);const M=S==null?void 0:S.error;if(M&&M.status&&M.message){const R=function(k){const F=k.toLowerCase().replace(/_/g,"-");return Object.values(kt).indexOf(F)>=0?F:kt.UNKNOWN}(M.status);p(new _n(R,M.message))}else p(new _n(kt.UNKNOWN,"Server responded with status "+g.getStatus()))}else p(new _n(kt.UNAVAILABLE,"Connection failed."));break;default:Kn(9055,{l_:e,streamId:u,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{bn(Go,`RPC '${e}' ${u} completed.`)}});const x=JSON.stringify(s);bn(Go,`RPC '${e}' ${u} sending request:`,s),g.send(t,"POST",x,i,15)})}T_(e,t,i){const s=LD(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=hee(),d=uee(),p={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(p.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(p.useFetchStreams=!0),this.jo(p.initMessageHeaders,t,i),p.encodeInitMessageHeaders=!0;const x=l.join("");bn(Go,`Creating RPC '${e}' stream ${s}: ${x}`,p);const b=u.createWebChannel(x,p);this.I_(b);let E=!1,S=!1;const M=new n5e({Yo:P=>{S?bn(Go,`Not sending because RPC '${e}' stream ${s} is closed:`,P):(E||(bn(Go,`Opening RPC '${e}' stream ${s} transport.`),b.open(),E=!0),bn(Go,`RPC '${e}' stream ${s} sending:`,P),b.send(P))},Zo:()=>b.close()}),R=(P,k,F)=>{P.listen(k,V=>{try{F(V)}catch(G){setTimeout(()=>{throw G},0)}})};return R(b,Jb.EventType.OPEN,()=>{S||(bn(Go,`RPC '${e}' stream ${s} transport opened.`),M.o_())}),R(b,Jb.EventType.CLOSE,()=>{S||(S=!0,bn(Go,`RPC '${e}' stream ${s} transport closed`),M.a_(),this.E_(b))}),R(b,Jb.EventType.ERROR,P=>{S||(S=!0,LA(Go,`RPC '${e}' stream ${s} transport errored. Name:`,P.name,"Message:",P.message),M.a_(new _n(kt.UNAVAILABLE,"The operation could not be completed")))}),R(b,Jb.EventType.MESSAGE,P=>{var k;if(!S){const F=P.data[0];qi(!!F,16349);const V=F,G=(V==null?void 0:V.error)||((k=V[0])==null?void 0:k.error);if(G){bn(Go,`RPC '${e}' stream ${s} received error:`,G);const q=G.status;let ne=function(H){const j=Es[H];if(j!==void 0)return Qee(j)}(q),K=G.message;ne===void 0&&(ne=kt.INTERNAL,K="Unknown error status: "+q+" with message "+G.message),S=!0,M.a_(new _n(ne,K)),b.close()}else bn(Go,`RPC '${e}' stream ${s} received:`,F),M.u_(F)}}),R(d,cee.STAT_EVENT,P=>{P.stat===bD.PROXY?bn(Go,`RPC '${e}' stream ${s} detected buffering proxy`):P.stat===bD.NOPROXY&&bn(Go,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{M.__()},0),M}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function cB(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lT(n){return new aGe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ate{constructor(e,t,i=1e3,s=1.5,l=6e4){this.Mi=e,this.timerId=t,this.d_=i,this.A_=s,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-i);s>0&&bn("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IK="PersistentStream";class lte{constructor(e,t,i,s,l,u,d,p){this.Mi=e,this.S_=i,this.b_=s,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=d,this.listener=p,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ate(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===kt.RESOURCE_EXHAUSTED?(Od(t.toString()),Od("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===kt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.D_===t&&this.G_(i,s)},i=>{e(()=>{const s=new _n(kt.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(s)})})}G_(e,t){const i=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{i(()=>this.listener.Xo())}),this.stream.t_(()=>{i(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{i(()=>this.z_(s))}),this.stream.onMessage(s=>{i(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return bn(IK,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(bn(IK,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class r5e extends lte{constructor(e,t,i,s,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,s,u),this.serializer=l}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=uGe(this.serializer,e),i=function(l){if(!("targetChange"in l))return ii.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?ii.min():u.readTime?uh(u.readTime):ii.min()}(e);return this.listener.H_(t,i)}Y_(e){const t={};t.database=kD(this.serializer),t.addTarget=function(l,u){let d;const p=u.target;if(d=_D(p)?{documents:fGe(l,p)}:{query:pGe(l,p).ft},d.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){d.resumeToken=jee(l,u.resumeToken);const g=SD(l,u.expectedCount);g!==null&&(d.expectedCount=g)}else if(u.snapshotVersion.compareTo(ii.min())>0){d.readTime=a2(l,u.snapshotVersion.toTimestamp());const g=SD(l,u.expectedCount);g!==null&&(d.expectedCount=g)}return d}(this.serializer,e);const i=gGe(this.serializer,e);i&&(t.labels=i),this.q_(t)}Z_(e){const t={};t.database=kD(this.serializer),t.removeTarget=e,this.q_(t)}}class s5e extends lte{constructor(e,t,i,s,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,u),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return qi(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,qi(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){qi(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=dGe(e.writeResults,e.commitTime),i=uh(e.commitTime);return this.listener.na(i,t)}ra(){const e={};e.database=kD(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>hGe(this.serializer,i))};this.q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5e{}class a5e extends o5e{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new _n(kt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.Go(e,TD(t,i),s,l,u)).catch(l=>{throw l.name==="FirebaseError"?(l.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new _n(kt.UNKNOWN,l.toString())})}Ho(e,t,i,s,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,d])=>this.connection.Ho(e,TD(t,i),s,u,d,l)).catch(u=>{throw u.name==="FirebaseError"?(u.code===kt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new _n(kt.UNKNOWN,u.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class l5e{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Od(t),this.aa=!1):bn("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kg="RemoteStore";class c5e{constructor(e,t,i,s,l){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo(u=>{i.enqueueAndForget(async()=>{h0(this)&&(bn(Kg,"Restarting streams for network reachability change."),await async function(p){const g=li(p);g.Ea.add(4),await ew(g),g.Ra.set("Unknown"),g.Ea.delete(4),await cT(g)}(this))})}),this.Ra=new l5e(i,s)}}async function cT(n){if(h0(n))for(const e of n.da)await e(!0)}async function ew(n){for(const e of n.da)await e(!1)}function cte(n,e){const t=li(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),_O(t)?EO(t):jA(t).O_()&&CO(t,e))}function wO(n,e){const t=li(n),i=jA(t);t.Ia.delete(e),i.O_()&&ute(t,e),t.Ia.size===0&&(i.O_()?i.L_():h0(t)&&t.Ra.set("Unknown"))}function CO(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ii.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}jA(n).Y_(e)}function ute(n,e){n.Va.Ue(e),jA(n).Z_(e)}function EO(n){n.Va=new iGe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),jA(n).start(),n.Ra.ua()}function _O(n){return h0(n)&&!jA(n).x_()&&n.Ia.size>0}function h0(n){return li(n).Ea.size===0}function hte(n){n.Va=void 0}async function u5e(n){n.Ra.set("Online")}async function h5e(n){n.Ia.forEach((e,t)=>{CO(n,e)})}async function d5e(n,e){hte(n),_O(n)?(n.Ra.ha(e),EO(n)):n.Ra.set("Unknown")}async function f5e(n,e,t){if(n.Ra.set("Online"),e instanceof Zee&&e.state===2&&e.cause)try{await async function(s,l){const u=l.cause;for(const d of l.targetIds)s.Ia.has(d)&&(await s.remoteSyncer.rejectListen(d,u),s.Ia.delete(d),s.Va.removeTarget(d))}(n,e)}catch(i){bn(Kg,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await c2(n,i)}else if(e instanceof rI?n.Va.Ze(e):e instanceof Kee?n.Va.st(e):n.Va.tt(e),!t.isEqual(ii.min()))try{const i=await ote(n.localStore);t.compareTo(i)>=0&&await function(l,u){const d=l.Va.Tt(u);return d.targetChanges.forEach((p,g)=>{if(p.resumeToken.approximateByteSize()>0){const x=l.Ia.get(g);x&&l.Ia.set(g,x.withResumeToken(p.resumeToken,u))}}),d.targetMismatches.forEach((p,g)=>{const x=l.Ia.get(p);if(!x)return;l.Ia.set(p,x.withResumeToken(_o.EMPTY_BYTE_STRING,x.snapshotVersion)),ute(l,p);const b=new cp(x.target,p,g,x.sequenceNumber);CO(l,b)}),l.remoteSyncer.applyRemoteEvent(d)}(n,t)}catch(i){bn(Kg,"Failed to raise snapshot:",i),await c2(n,i)}}async function c2(n,e,t){if(!ZA(e))throw e;n.Ea.add(1),await ew(n),n.Ra.set("Offline"),t||(t=()=>ote(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{bn(Kg,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await cT(n)})}function dte(n,e){return e().catch(t=>c2(n,t,e))}async function uT(n){const e=li(n),t=Up(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:cO;for(;p5e(e);)try{const s=await ZGe(e.localStore,i);if(s===null){e.Ta.length===0&&t.L_();break}i=s.batchId,m5e(e,s)}catch(s){await c2(e,s)}fte(e)&&pte(e)}function p5e(n){return h0(n)&&n.Ta.length<10}function m5e(n,e){n.Ta.push(e);const t=Up(n);t.O_()&&t.X_&&t.ea(e.mutations)}function fte(n){return h0(n)&&!Up(n).x_()&&n.Ta.length>0}function pte(n){Up(n).start()}async function g5e(n){Up(n).ra()}async function y5e(n){const e=Up(n);for(const t of n.Ta)e.ea(t.mutations)}async function A5e(n,e,t){const i=n.Ta.shift(),s=mO.from(i,e,t);await dte(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await uT(n)}async function v5e(n,e){e&&Up(n).X_&&await async function(i,s){if(function(u){return eGe(u)&&u!==kt.ABORTED}(s.code)){const l=i.Ta.shift();Up(i).B_(),await dte(i,()=>i.remoteSyncer.rejectFailedWrite(l.batchId,s)),await uT(i)}}(n,e),fte(n)&&pte(n)}async function SK(n,e){const t=li(n);t.asyncQueue.verifyOperationInProgress(),bn(Kg,"RemoteStore received new credentials");const i=h0(t);t.Ea.add(3),await ew(t),i&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await cT(t)}async function b5e(n,e){const t=li(n);e?(t.Ea.delete(2),await cT(t)):e||(t.Ea.add(2),await ew(t),t.Ra.set("Unknown"))}function jA(n){return n.ma||(n.ma=function(t,i,s){const l=li(t);return l.sa(),new r5e(i,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,s)}(n.datastore,n.asyncQueue,{Xo:u5e.bind(null,n),t_:h5e.bind(null,n),r_:d5e.bind(null,n),H_:f5e.bind(null,n)}),n.da.push(async e=>{e?(n.ma.B_(),_O(n)?EO(n):n.Ra.set("Unknown")):(await n.ma.stop(),hte(n))})),n.ma}function Up(n){return n.fa||(n.fa=function(t,i,s){const l=li(t);return l.sa(),new s5e(i,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,s)}(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:g5e.bind(null,n),r_:v5e.bind(null,n),ta:y5e.bind(null,n),na:A5e.bind(null,n)}),n.da.push(async e=>{e?(n.fa.B_(),await uT(n)):(await n.fa.stop(),n.Ta.length>0&&(bn(Kg,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))})),n.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(e,t,i,s,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=l,this.deferred=new Cp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,l){const u=Date.now()+i,d=new IO(e,t,u,s,l);return d.start(i),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new _n(kt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function SO(n,e){if(Od("AsyncQueue",`${e}: ${n}`),ZA(n))return new _n(kt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{static emptySet(e){return new fA(e.comparator)}constructor(e){this.comparator=e?(t,i)=>e(t,i)||Un.comparator(t.key,i.key):(t,i)=>Un.comparator(t.key,i.key),this.keyedMap=ex(),this.sortedSet=new zr(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fA)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,l=i.getNext().key;if(!s.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new fA;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TK{constructor(){this.ga=new zr(Un.comparator)}track(e){const t=e.doc.key,i=this.ga.get(t);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(t,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(t):e.type===1&&i.type===2?this.ga=this.ga.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Kn(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,i)=>{e.push(i)}),e}}class FA{constructor(e,t,i,s,l,u,d,p,g){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=d,this.excludesMetadataChanges=p,this.hasCachedResults=g}static fromInitialDocuments(e,t,i,s,l){const u=[];return t.forEach(d=>{u.push({type:0,doc:d})}),new FA(e,t,fA.emptySet(t),u,i,s,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&iT(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==i[s].type||!t[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5e{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class w5e{constructor(){this.queries=MK(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,i){const s=li(t),l=s.queries;s.queries=MK(),l.forEach((u,d)=>{for(const p of d.Sa)p.onError(i)})})(this,new _n(kt.ABORTED,"Firestore shutting down"))}}function MK(){return new c0(n=>Lee(n),iT)}async function mte(n,e){const t=li(n);let i=3;const s=e.query;let l=t.queries.get(s);l?!l.ba()&&e.Da()&&(i=2):(l=new x5e,i=e.Da()?0:1);try{switch(i){case 0:l.wa=await t.onListen(s,!0);break;case 1:l.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(u){const d=SO(u,`Initialization of query '${Ly(e.query)}' failed`);return void e.onError(d)}t.queries.set(s,l),l.Sa.push(e),e.va(t.onlineState),l.wa&&e.Fa(l.wa)&&TO(t)}async function gte(n,e){const t=li(n),i=e.query;let s=3;const l=t.queries.get(i);if(l){const u=l.Sa.indexOf(e);u>=0&&(l.Sa.splice(u,1),l.Sa.length===0?s=e.Da()?0:1:!l.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(i),t.onUnlisten(i,!0);case 1:return t.queries.delete(i),t.onUnlisten(i,!1);case 2:return t.onLastRemoteStoreUnlisten(i);default:return}}function C5e(n,e){const t=li(n);let i=!1;for(const s of e){const l=s.query,u=t.queries.get(l);if(u){for(const d of u.Sa)d.Fa(s)&&(i=!0);u.wa=s}}i&&TO(t)}function E5e(n,e,t){const i=li(n),s=i.queries.get(e);if(s)for(const l of s.Sa)l.onError(t);i.queries.delete(e)}function TO(n){n.Ca.forEach(e=>{e.next()})}var BD,kK;(kK=BD||(BD={})).Ma="default",kK.Cache="cache";class yte{constructor(e,t,i){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new FA(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const i=t!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=FA.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==BD.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ate{constructor(e){this.key=e}}class vte{constructor(e){this.key=e}}class _5e{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Mi(),this.mutatedKeys=Mi(),this.eu=Bee(e),this.tu=new fA(this.eu)}get nu(){return this.Ya}ru(e,t){const i=t?t.iu:new TK,s=t?t.tu:this.tu;let l=t?t.mutatedKeys:this.mutatedKeys,u=s,d=!1;const p=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,g=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((x,b)=>{const E=s.get(x),S=rT(this.query,b)?b:null,M=!!E&&this.mutatedKeys.has(E.key),R=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let P=!1;E&&S?E.data.isEqual(S.data)?M!==R&&(i.track({type:3,doc:S}),P=!0):this.su(E,S)||(i.track({type:2,doc:S}),P=!0,(p&&this.eu(S,p)>0||g&&this.eu(S,g)<0)&&(d=!0)):!E&&S?(i.track({type:0,doc:S}),P=!0):E&&!S&&(i.track({type:1,doc:E}),P=!0,(p||g)&&(d=!0)),P&&(S?(u=u.add(S),l=R?l.add(x):l.delete(x)):(u=u.delete(x),l=l.delete(x)))}),this.query.limit!==null)for(;u.size>this.query.limit;){const x=this.query.limitType==="F"?u.last():u.first();u=u.delete(x.key),l=l.delete(x.key),i.track({type:1,doc:x})}return{tu:u,iu:i,Cs:d,mutatedKeys:l}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i,s){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const u=e.iu.ya();u.sort((x,b)=>function(S,M){const R=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kn(20277,{Rt:P})}};return R(S)-R(M)}(x.type,b.type)||this.eu(x.doc,b.doc)),this.ou(i),s=s??!1;const d=t&&!s?this._u():[],p=this.Xa.size===0&&this.current&&!s?1:0,g=p!==this.Za;return this.Za=p,u.length!==0||g?{snapshot:new FA(this.query,e.tu,l,u,e.mutatedKeys,p===0,g,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:d}:{au:d}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new TK,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(t=>this.Ya=this.Ya.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ya=this.Ya.delete(t)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Mi(),this.tu.forEach(i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))});const t=[];return e.forEach(i=>{this.Xa.has(i)||t.push(new vte(i))}),this.Xa.forEach(i=>{e.has(i)||t.push(new Ate(i))}),t}cu(e){this.Ya=e.Qs,this.Xa=Mi();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return FA.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const MO="SyncEngine";class I5e{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class S5e{constructor(e){this.key=e,this.hu=!1}}class T5e{constructor(e,t,i,s,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.Pu={},this.Tu=new c0(d=>Lee(d),iT),this.Iu=new Map,this.Eu=new Set,this.du=new zr(Un.comparator),this.Au=new Map,this.Ru=new AO,this.Vu={},this.mu=new Map,this.fu=DA.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function M5e(n,e,t=!0){const i=_te(n);let s;const l=i.Tu.get(e);return l?(i.sharedClientState.addLocalQueryTarget(l.targetId),s=l.view.lu()):s=await bte(i,e,t,!0),s}async function k5e(n,e){const t=_te(n);await bte(t,e,!0,!1)}async function bte(n,e,t,i){const s=await jGe(n.localStore,ch(e)),l=s.targetId,u=n.sharedClientState.addLocalQueryTarget(l,t);let d;return i&&(d=await R5e(n,e,l,u==="current",s.resumeToken)),n.isPrimaryClient&&t&&cte(n.remoteStore,s),d}async function R5e(n,e,t,i,s){n.pu=(b,E,S)=>async function(R,P,k,F){let V=P.view.ru(k);V.Cs&&(V=await wK(R.localStore,P.query,!1).then(({documents:K})=>P.view.ru(K,V)));const G=F&&F.targetChanges.get(P.targetId),q=F&&F.targetMismatches.get(P.targetId)!=null,ne=P.view.applyChanges(V,R.isPrimaryClient,G,q);return LK(R,P.targetId,ne.au),ne.snapshot}(n,b,E,S);const l=await wK(n.localStore,e,!0),u=new _5e(e,l.Qs),d=u.ru(l.documents),p=J1.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",s),g=u.applyChanges(d,n.isPrimaryClient,p);LK(n,t,g.au);const x=new I5e(e,t,u);return n.Tu.set(e,x),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),g.snapshot}async function L5e(n,e,t){const i=li(n),s=i.Tu.get(e),l=i.Iu.get(s.targetId);if(l.length>1)return i.Iu.set(s.targetId,l.filter(u=>!iT(u,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await RD(i.localStore,s.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(s.targetId),t&&wO(i.remoteStore,s.targetId),PD(i,s.targetId)}).catch(KA)):(PD(i,s.targetId),await RD(i.localStore,s.targetId,!0))}async function B5e(n,e){const t=li(n),i=t.Tu.get(e),s=t.Iu.get(i.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(i.targetId),wO(t.remoteStore,i.targetId))}async function P5e(n,e,t){const i=z5e(n);try{const s=await function(u,d){const p=li(u),g=Ir.now(),x=d.reduce((S,M)=>S.add(M.key),Mi());let b,E;return p.persistence.runTransaction("Locally write mutations","readwrite",S=>{let M=Vd(),R=Mi();return p.Ns.getEntries(S,x).next(P=>{M=P,M.forEach((k,F)=>{F.isValidDocument()||(R=R.add(k))})}).next(()=>p.localDocuments.getOverlayedDocuments(S,M)).next(P=>{b=P;const k=[];for(const F of d){const V=Zze(F,b.get(F.key).overlayedDocument);V!=null&&k.push(new u0(F.key,V,_ee(V.value.mapValue),Id.exists(!0)))}return p.mutationQueue.addMutationBatch(S,g,k,d)}).next(P=>{E=P;const k=P.applyToLocalDocumentSet(b,R);return p.documentOverlayCache.saveOverlays(S,P.batchId,k)})}).then(()=>({batchId:E.batchId,changes:Nee(b)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(u,d,p){let g=u.Vu[u.currentUser.toKey()];g||(g=new zr(Ti)),g=g.insert(d,p),u.Vu[u.currentUser.toKey()]=g}(i,s.batchId,t),await tw(i,s.changes),await uT(i.remoteStore)}catch(s){const l=SO(s,"Failed to persist write");t.reject(l)}}async function xte(n,e){const t=li(n);try{const i=await QGe(t.localStore,e);e.targetChanges.forEach((s,l)=>{const u=t.Au.get(l);u&&(qi(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?u.hu=!0:s.modifiedDocuments.size>0?qi(u.hu,14607):s.removedDocuments.size>0&&(qi(u.hu,42227),u.hu=!1))}),await tw(t,i,e)}catch(i){await KA(i)}}function RK(n,e,t){const i=li(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.Tu.forEach((l,u)=>{const d=u.view.va(e);d.snapshot&&s.push(d.snapshot)}),function(u,d){const p=li(u);p.onlineState=d;let g=!1;p.queries.forEach((x,b)=>{for(const E of b.Sa)E.va(d)&&(g=!0)}),g&&TO(p)}(i.eventManager,e),s.length&&i.Pu.H_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function N5e(n,e,t){const i=li(n);i.sharedClientState.updateQueryState(e,"rejected",t);const s=i.Au.get(e),l=s&&s.key;if(l){let u=new zr(Un.comparator);u=u.insert(l,jo.newNoDocument(l,ii.min()));const d=Mi().add(l),p=new aT(ii.min(),new Map,new zr(Ti),u,d);await xte(i,p),i.du=i.du.remove(l),i.Au.delete(e),kO(i)}else await RD(i.localStore,e,!1).then(()=>PD(i,e,t)).catch(KA)}async function D5e(n,e){const t=li(n),i=e.batch.batchId;try{const s=await $Ge(t.localStore,e);Cte(t,i,null),wte(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await tw(t,s)}catch(s){await KA(s)}}async function F5e(n,e,t){const i=li(n);try{const s=await function(u,d){const p=li(u);return p.persistence.runTransaction("Reject batch","readwrite-primary",g=>{let x;return p.mutationQueue.lookupMutationBatch(g,d).next(b=>(qi(b!==null,37113),x=b.keys(),p.mutationQueue.removeMutationBatch(g,b))).next(()=>p.mutationQueue.performConsistencyCheck(g)).next(()=>p.documentOverlayCache.removeOverlaysForBatchId(g,x,d)).next(()=>p.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,x)).next(()=>p.localDocuments.getDocuments(g,x))})}(i.localStore,e);Cte(i,e,t),wte(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await tw(i,s)}catch(s){await KA(s)}}function wte(n,e){(n.mu.get(e)||[]).forEach(t=>{t.resolve()}),n.mu.delete(e)}function Cte(n,e,t){const i=li(n);let s=i.Vu[i.currentUser.toKey()];if(s){const l=s.get(e);l&&(t?l.reject(t):l.resolve(),s=s.remove(e)),i.Vu[i.currentUser.toKey()]=s}}function PD(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.Iu.get(e))n.Tu.delete(i),t&&n.Pu.yu(i,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach(i=>{n.Ru.containsKey(i)||Ete(n,i)})}function Ete(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(wO(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),kO(n))}function LK(n,e,t){for(const i of t)i instanceof Ate?(n.Ru.addReference(i.key,e),O5e(n,i)):i instanceof vte?(bn(MO,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,e),n.Ru.containsKey(i.key)||Ete(n,i.key)):Kn(19791,{wu:i})}function O5e(n,e){const t=e.key,i=t.path.canonicalString();n.du.get(t)||n.Eu.has(i)||(bn(MO,"New document in limbo: "+t),n.Eu.add(i),kO(n))}function kO(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new Un(_r.fromString(e)),i=n.fu.next();n.Au.set(i,new S5e(t)),n.du=n.du.insert(t,i),cte(n.remoteStore,new cp(ch(nT(t.path)),i,"TargetPurposeLimboResolution",qS.ce))}}async function tw(n,e,t){const i=li(n),s=[],l=[],u=[];i.Tu.isEmpty()||(i.Tu.forEach((d,p)=>{u.push(i.pu(p,e,t).then(g=>{var x;if((g||t)&&i.isPrimaryClient){const b=g?!g.fromCache:(x=t==null?void 0:t.targetChanges.get(p.targetId))==null?void 0:x.current;i.sharedClientState.updateQueryState(p.targetId,b?"current":"not-current")}if(g){s.push(g);const b=bO.As(p.targetId,g);l.push(b)}}))}),await Promise.all(u),i.Pu.H_(s),await async function(p,g){const x=li(p);try{await x.persistence.runTransaction("notifyLocalViewChanges","readwrite",b=>_t.forEach(g,E=>_t.forEach(E.Es,S=>x.persistence.referenceDelegate.addReference(b,E.targetId,S)).next(()=>_t.forEach(E.ds,S=>x.persistence.referenceDelegate.removeReference(b,E.targetId,S)))))}catch(b){if(!ZA(b))throw b;bn(xO,"Failed to update sequence numbers: "+b)}for(const b of g){const E=b.targetId;if(!b.fromCache){const S=x.Ms.get(E),M=S.snapshotVersion,R=S.withLastLimboFreeSnapshotVersion(M);x.Ms=x.Ms.insert(E,R)}}}(i.localStore,l))}async function V5e(n,e){const t=li(n);if(!t.currentUser.isEqual(e)){bn(MO,"User change. New user:",e.toKey());const i=await ste(t.localStore,e);t.currentUser=e,function(l,u){l.mu.forEach(d=>{d.forEach(p=>{p.reject(new _n(kt.CANCELLED,u))})}),l.mu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await tw(t,i.Ls)}}function U5e(n,e){const t=li(n),i=t.Au.get(e);if(i&&i.hu)return Mi().add(i.key);{let s=Mi();const l=t.Iu.get(e);if(!l)return s;for(const u of l){const d=t.Tu.get(u);s=s.unionWith(d.view.nu)}return s}}function _te(n){const e=li(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=xte.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=U5e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=N5e.bind(null,e),e.Pu.H_=C5e.bind(null,e.eventManager),e.Pu.yu=E5e.bind(null,e.eventManager),e}function z5e(n){const e=li(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=D5e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=F5e.bind(null,e),e}class u2{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lT(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return XGe(this.persistence,new GGe,e.initialUser,this.serializer)}Cu(e){return new rte(vO.mi,this.serializer)}Du(e){return new qGe}async terminate(){var e,t;(e=this.gcScheduler)==null||e.stop(),(t=this.indexBackfillerScheduler)==null||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}u2.provider={build:()=>new u2};class G5e extends u2{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){qi(this.persistence.referenceDelegate instanceof l2,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new SGe(i,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Qa.withCacheSize(this.cacheSizeBytes):Qa.DEFAULT;return new rte(i=>l2.mi(i,t),this.serializer)}}class ND{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>RK(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=V5e.bind(null,this.syncEngine),await b5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new w5e}()}createDatastore(e){const t=lT(e.databaseInfo.databaseId),i=function(l){return new i5e(l)}(e.databaseInfo);return function(l,u,d,p){return new a5e(l,u,d,p)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,s,l,u,d){return new c5e(i,s,l,u,d)}(this.localStore,this.datastore,e.asyncQueue,t=>RK(this.syncEngine,t,0),function(){return _K.v()?new _K:new JGe}())}createSyncEngine(e,t){return function(s,l,u,d,p,g,x){const b=new T5e(s,l,u,d,p,g);return x&&(b.gu=!0),b}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const l=li(s);bn(Kg,"RemoteStore shutting down."),l.Ea.add(5),await ew(l),l.Aa.shutdown(),l.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(t=this.eventManager)==null||t.terminate()}}ND.provider={build:()=>new ND};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ite{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Od("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zp="FirestoreClient";class W5e{constructor(e,t,i,s,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Ko.UNAUTHENTICATED,this.clientId=aO.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(i,async u=>{bn(zp,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(i,u=>(bn(zp,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Cp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=SO(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function uB(n,e){n.asyncQueue.verifyOperationInProgress(),bn(zp,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await ste(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function BK(n,e){n.asyncQueue.verifyOperationInProgress();const t=await H5e(n);bn(zp,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>SK(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>SK(e.remoteStore,s)),n._onlineComponents=e}async function H5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){bn(zp,"Using user provided OfflineComponentProvider");try{await uB(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===kt.FAILED_PRECONDITION||s.code===kt.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;LA("Error using user provided cache. Falling back to memory cache: "+t),await uB(n,new u2)}}else bn(zp,"Using default OfflineComponentProvider"),await uB(n,new G5e(void 0));return n._offlineComponents}async function Ste(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(bn(zp,"Using user provided OnlineComponentProvider"),await BK(n,n._uninitializedComponentsProvider._online)):(bn(zp,"Using default OnlineComponentProvider"),await BK(n,new ND))),n._onlineComponents}function X5e(n){return Ste(n).then(e=>e.syncEngine)}async function DD(n){const e=await Ste(n),t=e.eventManager;return t.onListen=M5e.bind(null,e.syncEngine),t.onUnlisten=L5e.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=k5e.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=B5e.bind(null,e.syncEngine),t}function $5e(n,e,t={}){const i=new Cp;return n.asyncQueue.enqueueAndForget(async()=>function(l,u,d,p,g){const x=new Ite({next:E=>{x.Nu(),u.enqueueAndForget(()=>gte(l,b));const S=E.docs.has(d);!S&&E.fromCache?g.reject(new _n(kt.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&E.fromCache&&p&&p.source==="server"?g.reject(new _n(kt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):g.resolve(E)},error:E=>g.reject(E)}),b=new yte(nT(d.path),x,{includeMetadataChanges:!0,qa:!0});return mte(l,b)}(await DD(n),n.asyncQueue,e,t,i)),i.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tte(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PK=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mte="firestore.googleapis.com",NK=!0;class DK{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new _n(kt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Mte,this.ssl=NK}else this.host=e.host,this.ssl=e.ssl??NK;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=ite;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<_Ge)throw new _n(kt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}cze("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Tte(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new _n(kt.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,s){return i.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hT{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new DK({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new _n(kt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new _n(kt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new DK(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new JUe;switch(i.type){case"firstParty":return new ize(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new _n(kt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=PK.get(t);i&&(bn("ComponentProvider","Removing Datastore"),PK.delete(t),i.terminate())}(this),Promise.resolve()}}function Q5e(n,e,t,i={}){var g;n=Ep(n,hT);const s=o0(e),l=n._getSettings(),u={...l,emulatorOptions:n._getEmulatorOptions()},d=`${e}:${t}`;s&&(tO(`https://${d}`),nO("Firestore",!0)),l.host!==Mte&&l.host!==d&&LA("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const p={...l,host:d,ssl:s,emulatorOptions:i};if(!Xg(p,u)&&(n._setSettings(p),i.mockUserToken)){let x,b;if(typeof i.mockUserToken=="string")x=i.mockUserToken,b=Ko.MOCK_USER;else{x=eee(i.mockUserToken,(g=n._app)==null?void 0:g.options.projectId);const E=i.mockUserToken.sub||i.mockUserToken.user_id;if(!E)throw new _n(kt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");b=new Ko(E)}n._authCredentials=new eze(new fee(x,b))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dT{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new dT(this.firestore,e,this._query)}}class Ts{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _p(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ts(this.firestore,e,this._key)}toJSON(){return{type:Ts._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,i){if(Y1(t,Ts._jsonSchema))return new Ts(e,i||null,new Un(_r.fromString(t.referencePath)))}}Ts._jsonSchemaVersion="firestore/documentReference/1.0",Ts._jsonSchema={type:Ss("string",Ts._jsonSchemaVersion),referencePath:Ss("string")};class _p extends dT{constructor(e,t,i){super(e,t,nT(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ts(this.firestore,null,new Un(e))}withConverter(e){return new _p(this.firestore,e,this._path)}}function FK(n,e,...t){if(n=sl(n),pee("collection","path",e),n instanceof hT){const i=_r.fromString(e,...t);return jQ(i),new _p(n,null,i)}{if(!(n instanceof Ts||n instanceof _p))throw new _n(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(_r.fromString(e,...t));return jQ(i),new _p(n.firestore,null,i)}}function jf(n,e,...t){if(n=sl(n),arguments.length===1&&(e=aO.newId()),pee("doc","path",e),n instanceof hT){const i=_r.fromString(e,...t);return ZQ(i),new Ts(n,null,new Un(i))}{if(!(n instanceof Ts||n instanceof _p))throw new _n(kt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(_r.fromString(e,...t));return ZQ(i),new Ts(n.firestore,n instanceof _p?n.converter:null,new Un(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OK="AsyncQueue";class VK{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ate(this,"async_queue_retry"),this._c=()=>{const i=cB();i&&bn(OK,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const t=cB();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=cB();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Cp;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!ZA(e))throw e;bn(OK,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,Od("INTERNAL UNHANDLED ERROR: ",UK(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=t,t}enqueueAfterDelay(e,t,i){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=IO.createAndSchedule(this,e,t,i,l=>this.hc(l));return this.tc.push(s),s}uc(){this.nc&&Kn(47125,{Pc:UK(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function UK(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zK(n){return function(t,i){if(typeof t!="object"||t===null)return!1;const s=t;for(const l of i)if(l in s&&typeof s[l]=="function")return!0;return!1}(n,["next","error","complete"])}class p1 extends hT{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new VK,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new VK(e),this._firestoreClient=void 0,await e}}}function K5e(n,e){const t=typeof n=="object"?n:sO(),i=typeof n=="string"?n:i2,s=YS(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const l=YJ("firestore");l&&Q5e(s,...l)}return s}function RO(n){if(n._terminated)throw new _n(kt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Z5e(n),n._firestoreClient}function Z5e(n){var i,s,l;const e=n._freezeSettings(),t=function(d,p,g,x){return new bze(d,p,g,x.host,x.ssl,x.experimentalForceLongPolling,x.experimentalAutoDetectLongPolling,Tte(x.experimentalLongPollingOptions),x.useFetchStreams,x.isUsingEmulator)}(n._databaseId,((i=n._app)==null?void 0:i.options.appId)||"",n._persistenceKey,e);n._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((l=e.localCache)!=null&&l._onlineComponentProvider)&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new W5e(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&function(d){const p=d==null?void 0:d._online.build();return{_offline:d==null?void 0:d._offline.build(p),_online:p}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cc(_o.fromBase64String(e))}catch(t){throw new _n(kt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new cc(_o.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:cc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Y1(e,cc._jsonSchema))return cc.fromBase64String(e.bytes)}}cc._jsonSchemaVersion="firestore/bytes/1.0",cc._jsonSchema={type:Ss("string",cc._jsonSchemaVersion),bytes:Ss("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LO{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new _n(kt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new bo(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fT{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _n(kt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _n(kt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ti(this._lat,e._lat)||Ti(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:hh._jsonSchemaVersion}}static fromJSON(e){if(Y1(e,hh._jsonSchema))return new hh(e.latitude,e.longitude)}}hh._jsonSchemaVersion="firestore/geoPoint/1.0",hh._jsonSchema={type:Ss("string",hh._jsonSchemaVersion),latitude:Ss("number"),longitude:Ss("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dh{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,s){if(i.length!==s.length)return!1;for(let l=0;l<i.length;++l)if(i[l]!==s[l])return!1;return!0}(this._values,e._values)}toJSON(){return{type:dh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Y1(e,dh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new dh(e.vectorValues);throw new _n(kt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}dh._jsonSchemaVersion="firestore/vectorValue/1.0",dh._jsonSchema={type:Ss("string",dh._jsonSchemaVersion),vectorValues:Ss("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j5e=/^__.*__$/;class Y5e{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new u0(e,this.data,this.fieldMask,t,this.fieldTransforms):new q1(e,this.data,t,this.fieldTransforms)}}function kte(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kn(40011,{Ac:n})}}class BO{constructor(e,t,i,s,l,u){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new BO({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),i=this.Vc({path:t,fc:!1});return i.gc(e),i}yc(e){var s;const t=(s=this.path)==null?void 0:s.child(e),i=this.Vc({path:t,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return h2(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(kte(this.Ac)&&j5e.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class q5e{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||lT(e)}Cc(e,t,i,s=!1){return new BO({Ac:e,methodName:t,Dc:i,path:bo.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function J5e(n){const e=n._freezeSettings(),t=lT(n._databaseId);return new q5e(n._databaseId,!!e.ignoreUndefinedProperties,t)}function eWe(n,e,t,i,s,l={}){const u=n.Cc(l.merge||l.mergeFields?2:0,e,t,s);Pte("Data must be an object, but it was:",u,i);const d=Lte(i,u);let p,g;if(l.merge)p=new Jc(u.fieldMask),g=u.fieldTransforms;else if(l.mergeFields){const x=[];for(const b of l.mergeFields){const E=tWe(e,b,t);if(!u.contains(E))throw new _n(kt.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);iWe(x,E)||x.push(E)}p=new Jc(x),g=u.fieldTransforms.filter(b=>p.covers(b.field))}else p=null,g=u.fieldTransforms;return new Y5e(new lc(d),p,g)}class PO extends fT{_toFieldTransform(e){return new Wee(e.path,new u1)}isEqual(e){return e instanceof PO}}class NO extends fT{constructor(e,t){super(e),this.Fc=t}_toFieldTransform(e){const t=new f1(e.serializer,Oee(e.serializer,this.Fc));return new Wee(e.path,t)}isEqual(e){return e instanceof NO&&this.Fc===e.Fc}}function Rte(n,e){if(Bte(n=sl(n)))return Pte("Unsupported field value:",e,n),Lte(n,e);if(n instanceof fT)return function(i,s){if(!kte(s.Ac))throw s.Sc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${i._methodName}() is not currently supported inside arrays`);const l=i._toFieldTransform(s);l&&s.fieldTransforms.push(l)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(i,s){const l=[];let u=0;for(const d of i){let p=Rte(d,s.wc(u));p==null&&(p={nullValue:"NULL_VALUE"}),l.push(p),u++}return{arrayValue:{values:l}}}(n,e)}return function(i,s){if((i=sl(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return Oee(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const l=Ir.fromDate(i);return{timestampValue:a2(s.serializer,l)}}if(i instanceof Ir){const l=new Ir(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:a2(s.serializer,l)}}if(i instanceof hh)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof cc)return{bytesValue:jee(s.serializer,i._byteString)};if(i instanceof Ts){const l=s.databaseId,u=i.firestore._databaseId;if(!u.isEqual(l))throw s.Sc(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:yO(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof dh)return function(u,d){return{mapValue:{fields:{[Cee]:{stringValue:Eee},[r2]:{arrayValue:{values:u.toArray().map(g=>{if(typeof g!="number")throw d.Sc("VectorValues must only contain numeric values.");return pO(d.serializer,g)})}}}}}}(i,s);throw s.Sc(`Unsupported field value: ${lO(i)}`)}(n,e)}function Lte(n,e){const t={};return yee(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):l0(n,(i,s)=>{const l=Rte(s,e.mc(i));l!=null&&(t[i]=l)}),{mapValue:{fields:t}}}function Bte(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Ir||n instanceof hh||n instanceof cc||n instanceof Ts||n instanceof fT||n instanceof dh)}function Pte(n,e,t){if(!Bte(t)||!mee(t)){const i=lO(t);throw i==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+i)}}function tWe(n,e,t){if((e=sl(e))instanceof LO)return e._internalPath;if(typeof e=="string")return Nte(n,e);throw h2("Field path arguments must be of type string or ",n,!1,void 0,t)}const nWe=new RegExp("[~\\*/\\[\\]]");function Nte(n,e,t){if(e.search(nWe)>=0)throw h2(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new LO(...e.split("."))._internalPath}catch{throw h2(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function h2(n,e,t,i,s){const l=i&&!i.isEmpty(),u=s!==void 0;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let p="";return(l||u)&&(p+=" (found",l&&(p+=` in field ${i}`),u&&(p+=` in document ${s}`),p+=")"),new _n(kt.INVALID_ARGUMENT,d+n+p)}function iWe(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dte{constructor(e,t,i,s,l){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Ts(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new rWe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Fte("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class rWe extends Dte{data(){return super.data()}}function Fte(n,e){return typeof e=="string"?Nte(n,e):e instanceof LO?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sWe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new _n(kt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class oWe{convertValue(e,t="none"){switch(Vp(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ss(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Op(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Kn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const i={};return l0(e,(s,l)=>{i[s]=this.convertValue(l,t)}),i}convertVectorValue(e){var i,s,l;const t=(l=(s=(i=e.fields)==null?void 0:i[r2].arrayValue)==null?void 0:s.values)==null?void 0:l.map(u=>ss(u.doubleValue));return new dh(t)}convertGeoPoint(e){return new hh(ss(e.latitude),ss(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=eT(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(a1(e));default:return null}}convertTimestamp(e){const t=Fp(e);return new Ir(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=_r.fromString(e);qi(nte(i),9688,{name:e});const s=new l1(i.get(1),i.get(3)),l=new Un(i.popFirst(5));return s.isEqual(t)||Od(`Document ${l} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aWe(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class nx{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Pg extends Dte{constructor(e,t,i,s,l,u){super(e,t,i,s,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new sI(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Fte("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(kt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Pg._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}Pg._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pg._jsonSchema={type:Ss("string",Pg._jsonSchemaVersion),bundleSource:Ss("string","DocumentSnapshot"),bundleName:Ss("string"),bundle:Ss("string")};class sI extends Pg{data(e={}){return super.data(e)}}class pA{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new nx(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new sI(this._firestore,this._userDataWriter,i.key,i,new nx(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _n(kt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,l){if(s._snapshot.oldDocs.isEmpty()){let u=0;return s._snapshot.docChanges.map(d=>{const p=new sI(s._firestore,s._userDataWriter,d.doc.key,d.doc,new nx(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);return d.doc,{type:"added",doc:p,oldIndex:-1,newIndex:u++}})}{let u=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(d=>l||d.type!==3).map(d=>{const p=new sI(s._firestore,s._userDataWriter,d.doc.key,d.doc,new nx(s._snapshot.mutatedKeys.has(d.doc.key),s._snapshot.fromCache),s.query.converter);let g=-1,x=-1;return d.type!==0&&(g=u.indexOf(d.doc.key),u=u.delete(d.doc.key)),d.type!==1&&(u=u.add(d.doc),x=u.indexOf(d.doc.key)),{type:lWe(d.type),doc:p,oldIndex:g,newIndex:x}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new _n(kt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=pA._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=aO.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],i=[],s=[];return this.docs.forEach(l=>{l._document!==null&&(t.push(l._document),i.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),s.push(l.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function lWe(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kn(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GK(n){n=Ep(n,Ts);const e=Ep(n.firestore,p1);return $5e(RO(e),n._key).then(t=>Vte(e,n,t))}pA._jsonSchemaVersion="firestore/querySnapshot/1.0",pA._jsonSchema={type:Ss("string",pA._jsonSchemaVersion),bundleSource:Ss("string","QuerySnapshot"),bundleName:Ss("string"),bundle:Ss("string")};class Ote extends oWe{constructor(e){super(),this.firestore=e}convertBytes(e){return new cc(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ts(this.firestore,null,t)}}function Jy(n,e,t){n=Ep(n,Ts);const i=Ep(n.firestore,p1),s=aWe(n.converter,e,t);return cWe(i,[eWe(J5e(i),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,Id.none())])}function WK(n,...e){var p,g,x;n=sl(n);let t={includeMetadataChanges:!1,source:"default"},i=0;typeof e[i]!="object"||zK(e[i])||(t=e[i++]);const s={includeMetadataChanges:t.includeMetadataChanges,source:t.source};if(zK(e[i])){const b=e[i];e[i]=(p=b.next)==null?void 0:p.bind(b),e[i+1]=(g=b.error)==null?void 0:g.bind(b),e[i+2]=(x=b.complete)==null?void 0:x.bind(b)}let l,u,d;if(n instanceof Ts)u=Ep(n.firestore,p1),d=nT(n._key.path),l={next:b=>{e[i]&&e[i](Vte(u,n,b))},error:e[i+1],complete:e[i+2]};else{const b=Ep(n,dT);u=Ep(b.firestore,p1),d=b._query;const E=new Ote(u);l={next:S=>{e[i]&&e[i](new pA(u,E,b,S))},error:e[i+1],complete:e[i+2]},sWe(n._query)}return function(E,S,M,R){const P=new Ite(R),k=new yte(S,P,M);return E.asyncQueue.enqueueAndForget(async()=>mte(await DD(E),k)),()=>{P.Nu(),E.asyncQueue.enqueueAndForget(async()=>gte(await DD(E),k))}}(RO(u),d,s,l)}function cWe(n,e){return function(i,s){const l=new Cp;return i.asyncQueue.enqueueAndForget(async()=>P5e(await X5e(i),s,l)),l.promise}(RO(n),e)}function Vte(n,e,t){const i=t.docs.get(e._key),s=new Ote(n);return new Pg(n,s,e._key,i,new nx(t.hasPendingWrites,t.fromCache),e.converter)}function AE(){return new PO("serverTimestamp")}function HK(n){return new NO("increment",n)}(function(e,t=!0){(function(s){QA=s})(a0),$g(new Np("firestore",(i,{instanceIdentifier:s,options:l})=>{const u=i.getProvider("app").getImmediate(),d=new p1(new tze(i.getProvider("auth-internal")),new rze(u,i.getProvider("app-check-internal")),function(g,x){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new _n(kt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new l1(g.options.projectId,x)}(u,s),u);return l={useFetchStreams:t,...l},d._setSettings(l),d},"PUBLIC").setMultipleInstances(!0)),lh(XQ,$Q,e),lh(XQ,$Q,"esm2020")})();function Ute(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const uWe=Ute,zte=new Z1("auth","Firebase",Ute());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d2=new iO("@firebase/auth");function hWe(n,...e){d2.logLevel<=Si.WARN&&d2.warn(`Auth (${a0}): ${n}`,...e)}function oI(n,...e){d2.logLevel<=Si.ERROR&&d2.error(`Auth (${a0}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ud(n,...e){throw DO(n,...e)}function fh(n,...e){return DO(n,...e)}function Gte(n,e,t){const i={...uWe(),[e]:t};return new Z1("auth","Firebase",i).create(e,{appName:n.name})}function Ip(n){return Gte(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function DO(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return zte.create(n,...e)}function Jn(n,e,...t){if(!n)throw DO(e,...t)}function yd(n){const e="INTERNAL ASSERTION FAILED: "+n;throw oI(e),new Error(e)}function zd(n,e){n||yd(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FD(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.href)||""}function dWe(){return XK()==="http:"||XK()==="https:"}function XK(){var n;return typeof self<"u"&&((n=self.location)==null?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fWe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(dWe()||LVe()||"connection"in navigator)?navigator.onLine:!0}function pWe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nw{constructor(e,t){this.shortDelay=e,this.longDelay=t,zd(t>e,"Short delay should be less than long delay!"),this.isMobile=MVe()||BVe()}get(){return fWe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FO(n,e){zd(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wte{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;yd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;yd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;yd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mWe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gWe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],yWe=new nw(3e4,6e4);function pT(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function YA(n,e,t,i,s={}){return Hte(n,s,async()=>{let l={},u={};i&&(e==="GET"?u=i:l={body:JSON.stringify(i)});const d=j1({key:n.config.apiKey,...u}).slice(1),p=await n._getAdditionalHeaders();p["Content-Type"]="application/json",n.languageCode&&(p["X-Firebase-Locale"]=n.languageCode);const g={method:e,headers:p,...l};return RVe()||(g.referrerPolicy="no-referrer"),n.emulatorConfig&&o0(n.emulatorConfig.host)&&(g.credentials="include"),Wte.fetch()(await $te(n,n.config.apiHost,t,d),g)})}async function Hte(n,e,t){n._canInitEmulator=!1;const i={...mWe,...e};try{const s=new AWe(n),l=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw vE(n,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const d=l.ok?u.errorMessage:u.error.message,[p,g]=d.split(" : ");if(p==="FEDERATED_USER_ID_ALREADY_LINKED")throw vE(n,"credential-already-in-use",u);if(p==="EMAIL_EXISTS")throw vE(n,"email-already-in-use",u);if(p==="USER_DISABLED")throw vE(n,"user-disabled",u);const x=i[p]||p.toLowerCase().replace(/[_\s]+/g,"-");if(g)throw Gte(n,x,g);Ud(n,x)}}catch(s){if(s instanceof xh)throw s;Ud(n,"network-request-failed",{message:String(s)})}}async function Xte(n,e,t,i,s={}){const l=await YA(n,e,t,i,s);return"mfaPendingCredential"in l&&Ud(n,"multi-factor-auth-required",{_serverResponse:l}),l}async function $te(n,e,t,i){const s=`${e}${t}?${i}`,l=n,u=l.config.emulator?FO(n.config,s):`${n.config.apiScheme}://${s}`;return gWe.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class AWe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(fh(this.auth,"network-request-failed")),yWe.get())})}}function vE(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=fh(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vWe(n,e){return YA(n,"POST","/v1/accounts:delete",e)}async function f2(n,e){return YA(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _x(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function bWe(n,e=!1){const t=sl(n),i=await t.getIdToken(e),s=OO(i);Jn(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const l=typeof s.firebase=="object"?s.firebase:void 0,u=l==null?void 0:l.sign_in_provider;return{claims:s,token:i,authTime:_x(hB(s.auth_time)),issuedAtTime:_x(hB(s.iat)),expirationTime:_x(hB(s.exp)),signInProvider:u||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function hB(n){return Number(n)*1e3}function OO(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return oI("JWT malformed, contained fewer than 3 sections"),null;try{const s=ZJ(t);return s?JSON.parse(s):(oI("Failed to decode base64 JWT payload"),null)}catch(s){return oI("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function $K(n){const e=OO(n);return Jn(e,"internal-error"),Jn(typeof e.exp<"u","internal-error"),Jn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m1(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof xh&&xWe(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function xWe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wWe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OD{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=_x(this.lastLoginAt),this.creationTime=_x(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function p2(n){var b;const e=n.auth,t=await n.getIdToken(),i=await m1(n,f2(e,{idToken:t}));Jn(i==null?void 0:i.users.length,e,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const l=(b=s.providerUserInfo)!=null&&b.length?Qte(s.providerUserInfo):[],u=EWe(n.providerData,l),d=n.isAnonymous,p=!(n.email&&s.passwordHash)&&!(u!=null&&u.length),g=d?p:!1,x={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:u,metadata:new OD(s.createdAt,s.lastLoginAt),isAnonymous:g};Object.assign(n,x)}async function CWe(n){const e=sl(n);await p2(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function EWe(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function Qte(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _We(n,e){const t=await Hte(n,{},async()=>{const i=j1({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:l}=n.config,u=await $te(n,s,"/v1/token",`key=${l}`),d=await n._getAdditionalHeaders();d["Content-Type"]="application/x-www-form-urlencoded";const p={method:"POST",headers:d,body:i};return n.emulatorConfig&&o0(n.emulatorConfig.host)&&(p.credentials="include"),Wte.fetch()(u,p)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function IWe(n,e){return YA(n,"POST","/v2/accounts:revokeToken",pT(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Jn(e.idToken,"internal-error"),Jn(typeof e.idToken<"u","internal-error"),Jn(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):$K(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Jn(e.length!==0,"internal-error");const t=$K(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Jn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:l}=await _We(e,t);this.updateTokensAndExpiration(i,s,Number(l))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:l}=t,u=new mA;return i&&(Jn(typeof i=="string","internal-error",{appName:e}),u.refreshToken=i),s&&(Jn(typeof s=="string","internal-error",{appName:e}),u.accessToken=s),l&&(Jn(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new mA,this.toJSON())}_performRefresh(){return yd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bf(n,e){Jn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class eu{constructor({uid:e,auth:t,stsTokenManager:i,...s}){this.providerId="firebase",this.proactiveRefresh=new wWe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new OD(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await m1(this,this.stsTokenManager.getToken(this.auth,e));return Jn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return bWe(this,e)}reload(){return CWe(this)}_assign(e){this!==e&&(Jn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new eu({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Jn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await p2(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ac(this.auth.app))return Promise.reject(Ip(this.auth));const e=await this.getIdToken();return await m1(this,vWe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const i=t.displayName??void 0,s=t.email??void 0,l=t.phoneNumber??void 0,u=t.photoURL??void 0,d=t.tenantId??void 0,p=t._redirectEventId??void 0,g=t.createdAt??void 0,x=t.lastLoginAt??void 0,{uid:b,emailVerified:E,isAnonymous:S,providerData:M,stsTokenManager:R}=t;Jn(b&&R,e,"internal-error");const P=mA.fromJSON(this.name,R);Jn(typeof b=="string",e,"internal-error"),Bf(i,e.name),Bf(s,e.name),Jn(typeof E=="boolean",e,"internal-error"),Jn(typeof S=="boolean",e,"internal-error"),Bf(l,e.name),Bf(u,e.name),Bf(d,e.name),Bf(p,e.name),Bf(g,e.name),Bf(x,e.name);const k=new eu({uid:b,auth:e,email:s,emailVerified:E,displayName:i,isAnonymous:S,photoURL:u,phoneNumber:l,tenantId:d,stsTokenManager:P,createdAt:g,lastLoginAt:x});return M&&Array.isArray(M)&&(k.providerData=M.map(F=>({...F}))),p&&(k._redirectEventId=p),k}static async _fromIdTokenResponse(e,t,i=!1){const s=new mA;s.updateFromServerResponse(t);const l=new eu({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await p2(l),l}static async _fromGetAccountInfoResponse(e,t,i){const s=t.users[0];Jn(s.localId!==void 0,"internal-error");const l=s.providerUserInfo!==void 0?Qte(s.providerUserInfo):[],u=!(s.email&&s.passwordHash)&&!(l!=null&&l.length),d=new mA;d.updateFromIdToken(i);const p=new eu({uid:s.localId,auth:e,stsTokenManager:d,isAnonymous:u}),g={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new OD(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(l!=null&&l.length)};return Object.assign(p,g),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QK=new Map;function Ad(n){zd(n instanceof Function,"Expected a class definition");let e=QK.get(n);return e?(zd(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,QK.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kte{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Kte.type="NONE";const KK=Kte;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aI(n,e,t){return`firebase:${n}:${e}:${t}`}class gA{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:l}=this.auth;this.fullUserKey=aI(this.userKey,s.apiKey,l),this.fullPersistenceKey=aI("persistence",s.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await f2(this.auth,{idToken:e}).catch(()=>{});return t?eu._fromGetAccountInfoResponse(this.auth,t,e):null}return eu._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new gA(Ad(KK),e,i);const s=(await Promise.all(t.map(async g=>{if(await g._isAvailable())return g}))).filter(g=>g);let l=s[0]||Ad(KK);const u=aI(i,e.config.apiKey,e.name);let d=null;for(const g of t)try{const x=await g._get(u);if(x){let b;if(typeof x=="string"){const E=await f2(e,{idToken:x}).catch(()=>{});if(!E)break;b=await eu._fromGetAccountInfoResponse(e,E,x)}else b=eu._fromJSON(e,x);g!==l&&(d=b),l=g;break}}catch{}const p=s.filter(g=>g._shouldAllowMigration);return!l._shouldAllowMigration||!p.length?new gA(l,e,i):(l=p[0],d&&await l._set(u,d.toJSON()),await Promise.all(t.map(async g=>{if(g!==l)try{await g._remove(u)}catch{}})),new gA(l,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZK(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qte(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Zte(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(ene(e))return"Blackberry";if(tne(e))return"Webos";if(jte(e))return"Safari";if((e.includes("chrome/")||Yte(e))&&!e.includes("edge/"))return"Chrome";if(Jte(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Zte(n=Jo()){return/firefox\//i.test(n)}function jte(n=Jo()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Yte(n=Jo()){return/crios\//i.test(n)}function qte(n=Jo()){return/iemobile/i.test(n)}function Jte(n=Jo()){return/android/i.test(n)}function ene(n=Jo()){return/blackberry/i.test(n)}function tne(n=Jo()){return/webos/i.test(n)}function VO(n=Jo()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function SWe(n=Jo()){var e;return VO(n)&&!!((e=window.navigator)!=null&&e.standalone)}function TWe(){return PVe()&&document.documentMode===10}function nne(n=Jo()){return VO(n)||Jte(n)||tne(n)||ene(n)||/windows phone/i.test(n)||qte(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ine(n,e=[]){let t;switch(n){case"Browser":t=ZK(Jo());break;case"Worker":t=`${ZK(Jo())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${a0}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MWe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=l=>new Promise((u,d)=>{try{const p=e(l);u(p)}catch(p){d(p)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kWe(n,e={}){return YA(n,"GET","/v2/passwordPolicy",pT(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RWe=6;class LWe{constructor(e){var i;const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??RWe,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((i=e.allowedNonAlphanumericCharacters)==null?void 0:i.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let s=0;s<e.length;s++)i=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,s,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BWe{constructor(e,t,i,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new jK(this),this.idTokenSubscription=new jK(this),this.beforeStateQueue=new MWe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=zte,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ad(t)),this._initializationPromise=this.queue(async()=>{var i,s,l;if(!this._deleted&&(this.persistenceManager=await gA.create(this,e),(i=this._resolvePersistenceManagerAvailable)==null||i.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((l=this.currentUser)==null?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await f2(this,{idToken:e}),i=await eu._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var l;if(ac(this.app)){const u=this.app.settings.authIdToken;return u?new Promise(d=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(u).then(d,d))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let i=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const u=(l=this.redirectUser)==null?void 0:l._redirectEventId,d=i==null?void 0:i._redirectEventId,p=await this.tryRedirectSignIn(e);(!u||u===d)&&(p!=null&&p.user)&&(i=p.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(u){i=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(u))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Jn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await p2(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=pWe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ac(this.app))return Promise.reject(Ip(this));const t=e?sl(e):null;return t&&Jn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Jn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ac(this.app)?Promise.reject(Ip(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ac(this.app)?Promise.reject(Ip(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ad(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await kWe(this),t=new LWe(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Z1("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),await IWe(this,i)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ad(e)||this._popupRedirectResolver;Jn(t,this,"argument-error"),this.redirectPersistenceManager=await gA.create(this,[Ad(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)==null?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)==null?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((t=this.currentUser)==null?void 0:t.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const d=this._isInitialized?Promise.resolve():this._initializationPromise;if(Jn(d,this,"internal-error"),d.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const p=e.addObserver(t,i,s);return()=>{u=!0,p()}}else{const p=e.addObserver(t);return()=>{u=!0,p()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Jn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ine(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;if(ac(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:t.getToken());return e!=null&&e.error&&hWe(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function mT(n){return sl(n)}class jK{constructor(e){this.auth=e,this.observer=null,this.addObserver=GVe(t=>this.observer=t)}get next(){return Jn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UO={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function PWe(n){UO=n}function NWe(n){return UO.loadJS(n)}function DWe(){return UO.gapiScript}function FWe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OWe(n,e){const t=YS(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),l=t.getOptions();if(Xg(l,e??{}))return s;Ud(s,"already-initialized")}return t.initialize({options:e})}function VWe(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(Ad);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}function UWe(n,e,t){const i=mT(n);Jn(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!1,l=rne(e),{host:u,port:d}=zWe(e),p=d===null?"":`:${d}`,g={url:`${l}//${u}${p}/`},x=Object.freeze({host:u,port:d,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator){Jn(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),Jn(Xg(g,i.config.emulator)&&Xg(x,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=g,i.emulatorConfig=x,i.settings.appVerificationDisabledForTesting=!0,o0(u)?(tO(`${l}//${u}${p}`),nO("Auth",!0)):GWe()}function rne(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function zWe(n){const e=rne(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const l=s[1];return{host:l,port:YK(i.substr(l.length+1))}}else{const[l,u]=i.split(":");return{host:l,port:YK(u)}}}function YK(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function GWe(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sne{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yd("not implemented")}_getIdTokenResponse(e){return yd("not implemented")}_linkToIdToken(e,t){return yd("not implemented")}_getReauthenticationResolver(e){return yd("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yA(n,e){return Xte(n,"POST","/v1/accounts:signInWithIdp",pT(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WWe="http://localhost";class Zg extends sne{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Zg(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ud("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s,...l}=t;if(!i||!s)return null;const u=new Zg(i,s);return u.idToken=l.idToken||void 0,u.accessToken=l.accessToken||void 0,u.secret=l.secret,u.nonce=l.nonce,u.pendingToken=l.pendingToken||null,u}_getIdTokenResponse(e){const t=this.buildRequest();return yA(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,yA(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,yA(e,t)}buildRequest(){const e={requestUri:WWe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=j1(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class one{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iw extends one{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tp extends iw{constructor(){super("facebook.com")}static credential(e){return Zg._fromParams({providerId:tp.PROVIDER_ID,signInMethod:tp.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tp.credentialFromTaggedObject(e)}static credentialFromError(e){return tp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tp.credential(e.oauthAccessToken)}catch{return null}}}tp.FACEBOOK_SIGN_IN_METHOD="facebook.com";tp.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class np extends iw{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Zg._fromParams({providerId:np.PROVIDER_ID,signInMethod:np.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return np.credentialFromTaggedObject(e)}static credentialFromError(e){return np.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return np.credential(t,i)}catch{return null}}}np.GOOGLE_SIGN_IN_METHOD="google.com";np.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ip extends iw{constructor(){super("github.com")}static credential(e){return Zg._fromParams({providerId:ip.PROVIDER_ID,signInMethod:ip.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ip.credentialFromTaggedObject(e)}static credentialFromError(e){return ip.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ip.credential(e.oauthAccessToken)}catch{return null}}}ip.GITHUB_SIGN_IN_METHOD="github.com";ip.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp extends iw{constructor(){super("twitter.com")}static credential(e,t){return Zg._fromParams({providerId:rp.PROVIDER_ID,signInMethod:rp.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rp.credentialFromTaggedObject(e)}static credentialFromError(e){return rp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return rp.credential(t,i)}catch{return null}}}rp.TWITTER_SIGN_IN_METHOD="twitter.com";rp.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HWe(n,e){return Xte(n,"POST","/v1/accounts:signUp",pT(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const l=await eu._fromIdTokenResponse(e,i,s),u=qK(i);return new Gp({user:l,providerId:u,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=qK(i);return new Gp({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function qK(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XWe(n){var s;if(ac(n.app))return Promise.reject(Ip(n));const e=mT(n);if(await e._initializationPromise,(s=e.currentUser)!=null&&s.isAnonymous)return new Gp({user:e.currentUser,providerId:null,operationType:"signIn"});const t=await HWe(e,{returnSecureToken:!0}),i=await Gp._fromIdTokenResponse(e,"signIn",t,!0);return await e._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2 extends xh{constructor(e,t,i,s){super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,m2.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new m2(e,t,i,s)}}function ane(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?m2._fromErrorAndOperation(n,l,e,i):l})}async function $We(n,e,t=!1){const i=await m1(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Gp._forOperation(n,"link",i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QWe(n,e,t=!1){const{auth:i}=n;if(ac(i.app))return Promise.reject(Ip(i));const s="reauthenticate";try{const l=await m1(n,ane(i,s,e,n),t);Jn(l.idToken,i,"internal-error");const u=OO(l.idToken);Jn(u,i,"internal-error");const{sub:d}=u;return Jn(n.uid===d,i,"user-mismatch"),Gp._forOperation(n,s,l)}catch(l){throw(l==null?void 0:l.code)==="auth/user-not-found"&&Ud(i,"user-mismatch"),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KWe(n,e,t=!1){if(ac(n.app))return Promise.reject(Ip(n));const i="signIn",s=await ane(n,i,e),l=await Gp._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(l.user),l}function ZWe(n,e,t,i){return sl(n).onIdTokenChanged(e,t,i)}function jWe(n,e,t){return sl(n).beforeAuthStateChanged(e,t)}function YWe(n,e,t,i){return sl(n).onAuthStateChanged(e,t,i)}const g2="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lne{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(g2,"1"),this.storage.removeItem(g2),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qWe=1e3,JWe=10;class cne extends lne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nne(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((u,d,p)=>{this.notifyListeners(u,p)});return}const i=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const u=this.storage.getItem(i);!t&&this.localCache[i]===u||this.notifyListeners(i,u)},l=this.storage.getItem(i);TWe()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,JWe):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},qWe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}cne.type="LOCAL";const e4e=cne;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class une extends lne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}une.type="SESSION";const hne=une;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t4e(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new gT(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:l}=t.data,u=this.handlersMap[s];if(!(u!=null&&u.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const d=Array.from(u).map(async g=>g(t.origin,l)),p=await t4e(d);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:p})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gT.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zO(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n4e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let l,u;return new Promise((d,p)=>{const g=zO("",20);s.port1.start();const x=setTimeout(()=>{p(new Error("unsupported_event"))},i);u={messageChannel:s,onMessage(b){const E=b;if(E.data.eventId===g)switch(E.data.status){case"ack":clearTimeout(x),l=setTimeout(()=>{p(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),d(E.data.response);break;default:clearTimeout(x),clearTimeout(l),p(new Error("invalid_response"));break}}},this.handlers.add(u),s.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:g,data:t},[s.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(){return window}function i4e(n){ph().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dne(){return typeof ph().WorkerGlobalScope<"u"&&typeof ph().importScripts=="function"}async function r4e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function s4e(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)==null?void 0:n.controller)||null}function o4e(){return dne()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fne="firebaseLocalStorageDb",a4e=1,y2="firebaseLocalStorage",pne="fbase_key";class rw{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function yT(n,e){return n.transaction([y2],e?"readwrite":"readonly").objectStore(y2)}function l4e(){const n=indexedDB.deleteDatabase(fne);return new rw(n).toPromise()}function VD(){const n=indexedDB.open(fne,a4e);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(y2,{keyPath:pne})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(y2)?e(i):(i.close(),await l4e(),e(await VD()))})})}async function JK(n,e,t){const i=yT(n,!0).put({[pne]:e,value:t});return new rw(i).toPromise()}async function c4e(n,e){const t=yT(n,!1).get(e),i=await new rw(t).toPromise();return i===void 0?null:i.value}function e6(n,e){const t=yT(n,!0).delete(e);return new rw(t).toPromise()}const u4e=800,h4e=3;class mne{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await VD(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>h4e)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return dne()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gT._getInstance(o4e()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await r4e(),!this.activeServiceWorker)return;this.sender=new n4e(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(t=e[0])!=null&&t.fulfilled&&(i=e[0])!=null&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||s4e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await VD();return await JK(e,g2,"1"),await e6(e,g2),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>JK(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>c4e(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>e6(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const l=yT(s,!1).getAll();return new rw(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;if(e.length!==0)for(const{fbase_key:s,value:l}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(l)&&(this.notifyListeners(s,l),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),u4e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mne.type="LOCAL";const d4e=mne;new nw(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f4e(n,e){return e?Ad(e):(Jn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GO extends sne{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return yA(e,this._buildIdpRequest())}_linkToIdToken(e,t){return yA(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return yA(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function p4e(n){return KWe(n.auth,new GO(n),n.bypassAuthState)}function m4e(n){const{auth:e,user:t}=n;return Jn(t,e,"internal-error"),QWe(t,new GO(n),n.bypassAuthState)}async function g4e(n){const{auth:e,user:t}=n;return Jn(t,e,"internal-error"),$We(t,new GO(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gne{constructor(e,t,i,s,l=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:l,error:u,type:d}=e;if(u){this.reject(u);return}const p={auth:this.auth,requestUri:t,sessionId:i,tenantId:l||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(d)(p))}catch(g){this.reject(g)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return p4e;case"linkViaPopup":case"linkViaRedirect":return g4e;case"reauthViaPopup":case"reauthViaRedirect":return m4e;default:Ud(this.auth,"internal-error")}}resolve(e){zd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y4e=new nw(2e3,1e4);class eA extends gne{constructor(e,t,i,s,l){super(e,t,s,l),this.provider=i,this.authWindow=null,this.pollId=null,eA.currentPopupAction&&eA.currentPopupAction.cancel(),eA.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Jn(e,this.auth,"internal-error"),e}async onExecution(){zd(this.filter.length===1,"Popup operations only handle one event");const e=zO();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(fh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(fh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,eA.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if((i=(t=this.authWindow)==null?void 0:t.window)!=null&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,y4e.get())};e()}}eA.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4e="pendingRedirect",lI=new Map;class v4e extends gne{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=lI.get(this.auth._key());if(!e){try{const i=await b4e(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}lI.set(this.auth._key(),e)}return this.bypassAuthState||lI.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function b4e(n,e){const t=C4e(e),i=w4e(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}function x4e(n,e){lI.set(n._key(),e)}function w4e(n){return Ad(n._redirectPersistence)}function C4e(n){return aI(A4e,n.config.apiKey,n.name)}async function E4e(n,e,t=!1){if(ac(n.app))return Promise.reject(Ip(n));const i=mT(n),s=f4e(i,e),u=await new v4e(i,s,t).execute();return u&&!t&&(delete u.user._redirectEventId,await i._persistUserIfCurrent(u.user),await i._setRedirectUser(null,e)),u}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _4e=10*60*1e3;class I4e{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!S4e(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!yne(e)){const s=((i=e.error.code)==null?void 0:i.split("auth/")[1])||"internal-error";t.onError(fh(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=_4e&&this.cachedEventUids.clear(),this.cachedEventUids.has(t6(e))}saveEventToCache(e){this.cachedEventUids.add(t6(e)),this.lastProcessedEventTime=Date.now()}}function t6(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function yne({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function S4e(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return yne(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T4e(n,e={}){return YA(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M4e=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,k4e=/^https?/;async function R4e(n){if(n.config.emulator)return;const{authorizedDomains:e}=await T4e(n);for(const t of e)try{if(L4e(t))return}catch{}Ud(n,"unauthorized-domain")}function L4e(n){const e=FD(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const u=new URL(n);return u.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&u.hostname===i}if(!k4e.test(t))return!1;if(M4e.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B4e=new nw(3e4,6e4);function n6(){const n=ph().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function P4e(n){return new Promise((e,t)=>{var s,l,u;function i(){n6(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{n6(),t(fh(n,"network-request-failed"))},timeout:B4e.get()})}if((l=(s=ph().gapi)==null?void 0:s.iframes)!=null&&l.Iframe)e(gapi.iframes.getContext());else if((u=ph().gapi)!=null&&u.load)i();else{const d=FWe("iframefcb");return ph()[d]=()=>{gapi.load?i():t(fh(n,"network-request-failed"))},NWe(`${DWe()}?onload=${d}`).catch(p=>t(p))}}).catch(e=>{throw cI=null,e})}let cI=null;function N4e(n){return cI=cI||P4e(n),cI}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4e=new nw(5e3,15e3),F4e="__/auth/iframe",O4e="emulator/auth/iframe",V4e={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},U4e=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function z4e(n){const e=n.config;Jn(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?FO(e,O4e):`https://${n.config.authDomain}/${F4e}`,i={apiKey:e.apiKey,appName:n.name,v:a0},s=U4e.get(n.config.apiHost);s&&(i.eid=s);const l=n._getFrameworks();return l.length&&(i.fw=l.join(",")),`${t}?${j1(i).slice(1)}`}async function G4e(n){const e=await N4e(n),t=ph().gapi;return Jn(t,n,"internal-error"),e.open({where:document.body,url:z4e(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:V4e,dontclear:!0},i=>new Promise(async(s,l)=>{await i.restyle({setHideOnLeave:!1});const u=fh(n,"network-request-failed"),d=ph().setTimeout(()=>{l(u)},D4e.get());function p(){ph().clearTimeout(d),s(i)}i.ping(p).then(p,()=>{l(u)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4e={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},H4e=500,X4e=600,$4e="_blank",Q4e="http://localhost";class i6{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function K4e(n,e,t,i=H4e,s=X4e){const l=Math.max((window.screen.availHeight-s)/2,0).toString(),u=Math.max((window.screen.availWidth-i)/2,0).toString();let d="";const p={...W4e,width:i.toString(),height:s.toString(),top:l,left:u},g=Jo().toLowerCase();t&&(d=Yte(g)?$4e:t),Zte(g)&&(e=e||Q4e,p.scrollbars="yes");const x=Object.entries(p).reduce((E,[S,M])=>`${E}${S}=${M},`,"");if(SWe(g)&&d!=="_self")return Z4e(e||"",d),new i6(null);const b=window.open(e||"",d,x);Jn(b,n,"popup-blocked");try{b.focus()}catch{}return new i6(b)}function Z4e(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j4e="__/auth/handler",Y4e="emulator/auth/handler",q4e=encodeURIComponent("fac");async function r6(n,e,t,i,s,l){Jn(n.config.authDomain,n,"auth-domain-config-required"),Jn(n.config.apiKey,n,"invalid-api-key");const u={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:a0,eventId:s};if(e instanceof one){e.setDefaultLanguage(n.languageCode),u.providerId=e.providerId||"",zVe(e.getCustomParameters())||(u.customParameters=JSON.stringify(e.getCustomParameters()));for(const[x,b]of Object.entries({}))u[x]=b}if(e instanceof iw){const x=e.getScopes().filter(b=>b!=="");x.length>0&&(u.scopes=x.join(","))}n.tenantId&&(u.tid=n.tenantId);const d=u;for(const x of Object.keys(d))d[x]===void 0&&delete d[x];const p=await n._getAppCheckToken(),g=p?`#${q4e}=${encodeURIComponent(p)}`:"";return`${J4e(n)}?${j1(d).slice(1)}${g}`}function J4e({config:n}){return n.emulator?FO(n,Y4e):`https://${n.authDomain}/${j4e}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dB="webStorageSupport";class e9e{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=hne,this._completeRedirectFn=E4e,this._overrideRedirectResult=x4e}async _openPopup(e,t,i,s){var u;zd((u=this.eventManagers[e._key()])==null?void 0:u.manager,"_initialize() not called before _openPopup()");const l=await r6(e,t,i,FD(),s);return K4e(e,l,zO())}async _openRedirect(e,t,i,s){await this._originValidation(e);const l=await r6(e,t,i,FD(),s);return i4e(l),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:l}=this.eventManagers[t];return s?Promise.resolve(s):(zd(l,"If manager is not set, promise should be"),l)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await G4e(e),i=new I4e(e);return t.register("authEvent",s=>(Jn(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(dB,{type:dB},s=>{var u;const l=(u=s==null?void 0:s[0])==null?void 0:u[dB];l!==void 0&&t(!!l),Ud(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=R4e(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nne()||jte()||VO()}}const t9e=e9e;var s6="@firebase/auth",o6="1.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n9e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Jn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i9e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function r9e(n){$g(new Np("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:d}=i.options;Jn(u&&!u.includes(":"),"invalid-api-key",{appName:i.name});const p={apiKey:u,authDomain:d,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ine(n)},g=new BWe(i,s,l,p);return VWe(g,t),g},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),$g(new Np("auth-internal",e=>{const t=mT(e.getProvider("auth").getImmediate());return(i=>new n9e(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),lh(s6,o6,i9e(n)),lh(s6,o6,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s9e=5*60,o9e=JJ("authIdTokenMaxAge")||s9e;let a6=null;const a9e=n=>async e=>{const t=e&&await e.getIdTokenResult(),i=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(i&&i>o9e)return;const s=t==null?void 0:t.token;a6!==s&&(a6=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function l9e(n=sO()){const e=YS(n,"auth");if(e.isInitialized())return e.getImmediate();const t=OWe(n,{popupRedirectResolver:t9e,persistence:[d4e,e4e,hne]}),i=JJ("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(i,location.origin);if(location.origin===l.origin){const u=a9e(l.toString());jWe(t,u,()=>u(t.currentUser)),ZWe(t,d=>u(d))}}const s=jJ("auth");return s&&UWe(t,`http://${s}`),t}function c9e(){var n;return((n=document.getElementsByTagName("head"))==null?void 0:n[0])??document}PWe({loadJS(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const l=fh("internal-error");l.customData=s,t(l)},i.type="text/javascript",i.charset="UTF-8",c9e().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});r9e("Browser");var u9e="firebase",h9e="12.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lh(u9e,h9e,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ane="firebasestorage.googleapis.com",d9e="storageBucket",f9e=2*60*1e3,p9e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh extends xh{constructor(e,t,i=0){super(fB(e),`Firebase Storage: ${t} (${fB(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wh.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return fB(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var vh;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(vh||(vh={}));function fB(n){return"storage/"+n}function m9e(){const n="An unknown error occurred, please check the error payload for server response.";return new wh(vh.UNKNOWN,n)}function g9e(){return new wh(vh.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function y9e(){return new wh(vh.CANCELED,"User canceled the upload/download.")}function A9e(n){return new wh(vh.INVALID_URL,"Invalid URL '"+n+"'.")}function v9e(n){return new wh(vh.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function l6(n){return new wh(vh.INVALID_ARGUMENT,n)}function vne(){return new wh(vh.APP_DELETED,"The Firebase app was deleted.")}function b9e(n){return new wh(vh.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=tu.makeFromUrl(e,t)}catch{return new tu(e,"")}if(i.path==="")return i;throw v9e(e)}static makeFromUrl(e,t){let i=null;const s="([A-Za-z0-9.\\-_]+)";function l(G){G.path.charAt(G.path.length-1)==="/"&&(G.path_=G.path_.slice(0,-1))}const u="(/(.*))?$",d=new RegExp("^gs://"+s+u,"i"),p={bucket:1,path:3};function g(G){G.path_=decodeURIComponent(G.path)}const x="v[A-Za-z0-9_]+",b=t.replace(/[.]/g,"\\."),E="(/([^?#]*).*)?$",S=new RegExp(`^https?://${b}/${x}/b/${s}/o${E}`,"i"),M={bucket:1,path:3},R=t===Ane?"(?:storage.googleapis.com|storage.cloud.google.com)":t,P="([^?#]*)",k=new RegExp(`^https?://${R}/${s}/${P}`,"i"),V=[{regex:d,indices:p,postModify:l},{regex:S,indices:M,postModify:g},{regex:k,indices:{bucket:1,path:2},postModify:g}];for(let G=0;G<V.length;G++){const q=V[G],ne=q.regex.exec(e);if(ne){const K=ne[q.indices.bucket];let Q=ne[q.indices.path];Q||(Q=""),i=new tu(K,Q),q.postModify(i);break}}if(i==null)throw A9e(e);return i}}class x9e{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w9e(n,e,t){let i=1,s=null,l=null,u=!1,d=0;function p(){return d===2}let g=!1;function x(...P){g||(g=!0,e.apply(null,P))}function b(P){s=setTimeout(()=>{s=null,n(S,p())},P)}function E(){l&&clearTimeout(l)}function S(P,...k){if(g){E();return}if(P){E(),x.call(null,P,...k);return}if(p()||u){E(),x.call(null,P,...k);return}i<64&&(i*=2);let V;d===1?(d=2,V=0):V=(i+Math.random())*1e3,b(V)}let M=!1;function R(P){M||(M=!0,E(),!g&&(s!==null?(P||(d=2),clearTimeout(s),b(0)):P||(d=1)))}return b(0),l=setTimeout(()=>{u=!0,R(!0)},t),R}function C9e(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E9e(n){return n!==void 0}function c6(n,e,t,i){if(i<e)throw l6(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw l6(`Invalid value for '${n}'. Expected ${t} or less.`)}function _9e(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const s=e(i)+"="+e(n[i]);t=t+s+"&"}return t=t.slice(0,-1),t}var A2;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(A2||(A2={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I9e(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,l=e.indexOf(n)!==-1;return t||s||l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S9e{constructor(e,t,i,s,l,u,d,p,g,x,b,E=!0,S=!1){this.url_=e,this.method_=t,this.headers_=i,this.body_=s,this.successCodes_=l,this.additionalRetryCodes_=u,this.callback_=d,this.errorCallback_=p,this.timeout_=g,this.progressCallback_=x,this.connectionFactory_=b,this.retry=E,this.isUsingEmulator=S,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((M,R)=>{this.resolve_=M,this.reject_=R,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new bE(!1,null,!0));return}const l=this.connectionFactory_();this.pendingConnection_=l;const u=d=>{const p=d.loaded,g=d.lengthComputable?d.total:-1;this.progressCallback_!==null&&this.progressCallback_(p,g)};this.progressCallback_!==null&&l.addUploadProgressListener(u),l.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&l.removeUploadProgressListener(u),this.pendingConnection_=null;const d=l.getErrorCode()===A2.NO_ERROR,p=l.getStatus();if(!d||I9e(p,this.additionalRetryCodes_)&&this.retry){const x=l.getErrorCode()===A2.ABORT;i(!1,new bE(!1,null,x));return}const g=this.successCodes_.indexOf(p)!==-1;i(!0,new bE(g,l))})},t=(i,s)=>{const l=this.resolve_,u=this.reject_,d=s.connection;if(s.wasSuccessCode)try{const p=this.callback_(d,d.getResponse());E9e(p)?l(p):l()}catch(p){u(p)}else if(d!==null){const p=m9e();p.serverResponse=d.getErrorText(),this.errorCallback_?u(this.errorCallback_(d,p)):u(p)}else if(s.canceled){const p=this.appDelete_?vne():y9e();u(p)}else{const p=g9e();u(p)}};this.canceled_?t(!1,new bE(!1,null,!0)):this.backoffId_=w9e(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&C9e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class bE{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function T9e(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function M9e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function k9e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function R9e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function L9e(n,e,t,i,s,l,u=!0,d=!1){const p=_9e(n.urlParams),g=n.url+p,x=Object.assign({},n.headers);return k9e(x,e),T9e(x,t),M9e(x,l),R9e(x,i),new S9e(g,n.method,x,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,u,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B9e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function P9e(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2{constructor(e,t){this._service=e,t instanceof tu?this._location=t:this._location=tu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new v2(e,t)}get root(){const e=new tu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return P9e(this._location.path)}get storage(){return this._service}get parent(){const e=B9e(this._location.path);if(e===null)return null;const t=new tu(this._location.bucket,e);return new v2(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw b9e(e)}}function u6(n,e){const t=e==null?void 0:e[d9e];return t==null?null:tu.makeFromBucketSpec(t,n)}function N9e(n,e,t,i={}){n.host=`${e}:${t}`;const s=o0(e);s&&(tO(`https://${n.host}/b`),nO("Storage",!0)),n._isUsingEmulator=!0,n._protocol=s?"https":"http";const{mockUserToken:l}=i;l&&(n._overrideAuthToken=typeof l=="string"?l:eee(l,n.app.options.projectId))}class D9e{constructor(e,t,i,s,l,u=!1){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=s,this._firebaseVersion=l,this._isUsingEmulator=u,this._bucket=null,this._host=Ane,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=f9e,this._maxUploadRetryTime=p9e,this._requests=new Set,s!=null?this._bucket=tu.makeFromBucketSpec(s,this._host):this._bucket=u6(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=tu.makeFromBucketSpec(this._url,e):this._bucket=u6(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){c6("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){c6("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){if(ac(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new v2(this,e)}_makeRequest(e,t,i,s,l=!0){if(this._deleted)return new x9e(vne());{const u=L9e(e,this._appId,i,s,t,this._firebaseVersion,l,this._isUsingEmulator);return this._requests.add(u),u.getPromise().then(()=>this._requests.delete(u),()=>this._requests.delete(u)),u}}async makeRequestWithTokens(e,t){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,s).getPromise()}}const h6="@firebase/storage",d6="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bne="storage";function F9e(n=sO(),e){n=sl(n);const i=YS(n,bne).getImmediate({identifier:e}),s=YJ("storage");return s&&O9e(i,...s),i}function O9e(n,e,t,i={}){N9e(n,e,t,i)}function V9e(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new D9e(t,i,s,e,a0)}function U9e(){$g(new Np(bne,V9e,"PUBLIC").setMultipleInstances(!0)),lh(h6,d6,""),lh(h6,d6,"esm2020")}U9e();const z9e={apiKey:"AIzaSyCES_Zfi78paxI--dycL2LmBK0-g4fvvEM",authDomain:"famu-nodes.firebaseapp.com",projectId:"famu-nodes",storageBucket:"famu-nodes.firebasestorage.app",messagingSenderId:"67316044555",appId:"1:67316044555:web:72a88c28871236912f480e",measurementId:"G-LB6V1P1JVW"},WO=iee(z9e),eh=K5e(WO),f6=l9e(WO);F9e(WO);const UD={vysocany:{id:"vysocany",name:"Vysoany",center:[50.109,14.505],zoom:15,description:"Prague industrial district"},palmovka:{id:"palmovka",name:"Palmovka",center:[50.1036,14.47],zoom:15,description:"Prague metro hub"},podebrady:{id:"podebrady",name:"Podbrady",center:[50.1465,15.1215],zoom:16,description:"Spa town east of Prague"}},G9e="vysocany",xne=UD[G9e].center,wne=15,W9e=13,H9e=18,p6={tileUrl:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:"&copy; OpenStreetMap &copy; CARTO"},Sp=["red","blue"],X9e={sticker:{points:25,radius:4},small:{points:50,radius:5},medium:{points:100,radius:6},large:{points:200,radius:8}},m6=[{name:"Kikova",location:[50.0905,14.4528]},{name:"Invalidovna",location:[50.0942,14.4665]},{name:"Palmovka",location:[50.1036,14.4744]},{name:"eskomoravsk",location:[50.1069,14.4892]},{name:"Vysoansk",location:[50.1097,14.4989]},{name:"Kolbenova",location:[50.1084,14.5113]},{name:"Hloubtn",location:[50.1064,14.5194]},{name:"Rajsk zahrada",location:[50.1028,14.5339]},{name:"ern Most",location:[50.1011,14.5582]}],pB=[{id:"art-01",name:"Kolbenova 1",location:[50.110192,14.503811],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-02",name:"Kolbenova 2",location:[50.110203,14.503764],size:"small",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-03",name:"Kolbenova 3",location:[50.109847,14.50425],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-04",name:"Kolbenova 4",location:[50.109981,14.504933],size:"sticker",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-05",name:"Kolbenova 5",location:[50.109764,14.505742],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-06",name:"Kolbenova 6",location:[50.109672,14.505847],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-07",name:"Hloubtn 1",location:[50.110383,14.508192],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-08",name:"Hloubtn 2",location:[50.110508,14.509567],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-09",name:"Vysoany 1",location:[50.110817,14.505475],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-10",name:"Vysoany 2",location:[50.110986,14.504672],size:"small",status:"ghost",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-11",name:"Vysoany 3",location:[50.110706,14.504081],size:"sticker",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-12",name:"Vysoany 4",location:[50.110217,14.50365],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-13",name:"Vysoany 5",location:[50.1096,14.505878],size:"small",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-14",name:"Vysoany 6",location:[50.109736,14.508125],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-15",name:"Vysoany 7",location:[50.109908,14.508189],size:"medium",status:"ghost",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-16",name:"Vysoany 8",location:[50.109517,14.509489],size:"sticker",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-17",name:"Hloubtn 3",location:[50.110383,14.509569],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-18",name:"Hloubtn 4",location:[50.110369,14.509569],size:"small",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-19",name:"Hloubtn 5",location:[50.110717,14.509906],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-20",name:"Harfa",location:[50.109428,14.498994],size:"medium",status:"active",mhd:"tram12",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-21",name:"Harfa 2",location:[50.110039,14.504783],size:"small",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-22",name:"Karln",location:[50.091603,14.440019],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Karln",hood:"palmovka"},{id:"art-23",name:"Palmovka 1",location:[50.103611,14.46465],size:"medium",status:"active",mhd:"tram12",capturedBy:null,area:"Palmovka",hood:"palmovka"},{id:"art-24",name:"Libe 1",location:[50.110244,14.477544],size:"small",status:"active",mhd:"tram12",capturedBy:null,area:"Libe",hood:"palmovka"},{id:"art-25",name:"Palmovka 2",location:[50.103378,14.472653],size:"medium",status:"ghost",mhd:"metroB",capturedBy:null,area:"Palmovka",hood:"palmovka"},{id:"art-26",name:"Palmovka 3",location:[50.103625,14.470758],size:"sticker",status:"active",mhd:"metroB",capturedBy:null,area:"Palmovka",hood:"palmovka"},{id:"art-27",name:"Palmovka 4",location:[50.103608,14.47075],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Palmovka",hood:"palmovka"},{id:"art-28",name:"Vysoany 9",location:[50.111042,14.503097],size:"large",status:"active",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-29",name:"Hloubtn 6",location:[50.108322,14.507908],size:"medium",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-30",name:"Prosek",location:[50.112683,14.499019],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Prosek",hood:"vysocany"},{id:"art-31",name:"Hloubtn 7",location:[50.108422,14.507728],size:"small",status:"active",mhd:"metroB",capturedBy:null,area:"Hloubtn",hood:"vysocany"},{id:"art-32",name:"Vysoany 10",location:[50.109811,14.504333],size:"sticker",status:"ghost",mhd:"metroB",capturedBy:null,area:"Vysoany",hood:"vysocany"},{id:"art-33",name:"Palmovka 5",location:[50.103458,14.463819],size:"medium",status:"active",mhd:"tram12",capturedBy:null,area:"Palmovka",hood:"palmovka"},{id:"art-34",name:"Podbrady 1",location:[50.14585,15.117822],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-35",name:"Podbrady 2",location:[50.147622,15.118736],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-36",name:"Podbrady 3",location:[50.14875,15.121333],size:"large",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-37",name:"Podbrady 4",location:[50.148394,15.123386],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-38",name:"Podbrady 5",location:[50.148381,15.124169],size:"small",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-39",name:"Podbrady 6",location:[50.148353,15.124464],size:"large",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-40",name:"Podbrady 7",location:[50.147914,15.125636],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-41",name:"Podbrady 8",location:[50.148311,15.125564],size:"sticker",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-42",name:"Podbrady 9",location:[50.147572,15.125086],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-43",name:"Podbrady 10",location:[50.145967,15.124406],size:"large",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-44",name:"Podbrady 11",location:[50.143106,15.121906],size:"medium",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"},{id:"art-45",name:"Podbrady 12",location:[50.143394,15.116619],size:"small",status:"active",mhd:null,capturedBy:null,area:"Podbrady",hood:"podebrady"}];function HO(n){var e;return((e=X9e[n.size])==null?void 0:e.points)||100}function $9e(n,e,t=.001,i=16){const s=[];for(let l=0;l<i;l++){const u=l/i*2*Math.PI;s.push([n+t*Math.cos(u),e+t*1.6*Math.sin(u)])}return s}function Q9e(n){if(n.length<3)return n;let e=0;for(let l=1;l<n.length;l++)(n[l][0]<n[e][0]||n[l][0]===n[e][0]&&n[l][1]<n[e][1])&&(e=l);[n[0],n[e]]=[n[e],n[0]];const t=n[0],i=n.slice(1).sort((l,u)=>{const d=Math.atan2(l[1]-t[1],l[0]-t[0]),p=Math.atan2(u[1]-t[1],u[0]-t[0]);return d-p}),s=[t];for(const l of i){for(;s.length>1;){const u=s[s.length-2],d=s[s.length-1];if((d[0]-u[0])*(l[1]-u[1])-(d[1]-u[1])*(l[0]-u[0])<=0)s.pop();else break}s.push(l)}return s}function K9e(n,e){if(n.length<3)return n;const t=n.reduce((s,l)=>s+l[0],0)/n.length,i=n.reduce((s,l)=>s+l[1],0)/n.length;return n.map(s=>{const l=s[0]-t,u=s[1]-i,d=Math.sqrt(l*l+u*u);if(d===0)return s;const p=(d+e)/d;return[t+l*p,i+u*p]})}function Z9e(n){const e={};Sp.forEach(i=>e[i]=[]);const t={};return Sp.forEach(i=>t[i]=[]),n.forEach(i=>{i.capturedBy&&t[i.capturedBy]&&t[i.capturedBy].push(i)}),Sp.forEach(i=>{const s=t[i];if(s.length!==0)if(s.length===1){const l=s[0];e[i].push({polygon:$9e(l.location[0],l.location[1],.0015,12),points:s})}else{const l=s.map(p=>p.location),u=Q9e([...l]),d=K9e(u,.001);e[i].push({polygon:d,points:s})}}),e}function Ny(n){const e={red:"#ff6b6b",blue:"#4dabf7",green:"#51cf66",yellow:"#fcc419",neutral:"#495057"};return e[n]||e.neutral}function Cne(n){const e={};return Sp.forEach(t=>e[t]=0),n.forEach(t=>{if(t.capturedBy&&e[t.capturedBy]!==void 0){const i=HO(t),s=t.status==="ghost"?Math.floor(i/2):i;e[t.capturedBy]+=s}}),e}const Ene=Le.createContext(null),Pf={player:"streetart-ctf-player",captures:"streetart-ctf-captures"},mB="streetart-captures",j9e="streetart-teams",Rr={red:{hex:"#ff6b6b",rgb:[1,.42,.42]},blue:{hex:"#4dabf7",rgb:[.3,.67,.97]},neutral:{hex:"#495057",rgb:[.29,.31,.34]}};function gB(n,e){try{const t=localStorage.getItem(n);return t?JSON.parse(t):e}catch{return e}}function yB(n,e){try{localStorage.setItem(n,JSON.stringify(e))}catch(t){console.warn("Failed to save to localStorage:",t)}}function Y9e({children:n}){const[e,t]=Le.useState(null),[i,s]=Le.useState(!0),[l,u]=Le.useState(()=>gB(Pf.player,{id:`player-${Date.now()}`,name:"Street Artist",team:null,score:0,capturedArt:[]})),[d,p]=Le.useState(()=>{const oe=gB(Pf.captures,{});return pB.map(we=>({...we,capturedBy:oe[we.id]||null}))}),[g,x]=Le.useState(null),[b,E]=Le.useState(!1),[S,M]=Le.useState(null);Le.useEffect(()=>{const oe=YWe(f6,we=>{we?(t(we),u($e=>({...$e,id:we.uid}))):XWe(f6).catch($e=>{console.warn("Firebase auth failed, using offline mode:",$e),s(!1)})});return()=>oe()},[]),Le.useEffect(()=>{if(!e)return;const oe=FK(eh,mB),we=WK(oe,$e=>{const Me={};$e.forEach(Ne=>{const Ae=Ne.data();Ae.capturedBy&&(Me[Ne.id]=Ae.capturedBy)}),p(pB.map(Ne=>({...Ne,capturedBy:Me[Ne.id]||null}))),yB(Pf.captures,Me),s(!0),console.log(" Firebase: Synced",Object.keys(Me).length,"captures")},$e=>{console.warn("Firestore sync error:",$e),s(!1)});return()=>we()},[e]);const[R,P]=Le.useState({red:0,blue:0});Le.useEffect(()=>{const oe=FK(eh,j9e),we=WK(oe,$e=>{const Me={red:0,blue:0};$e.forEach(Ne=>{const Ae=Ne.data();(Ne.id==="red"||Ne.id==="blue")&&(Me[Ne.id]=Ae.score||0)}),P(Me),console.log(" Team scores:",Me)});return()=>we()},[]),Le.useEffect(()=>{yB(Pf.player,l)},[l]);const k=Le.useCallback(async oe=>{if(!(!e||!i))try{await Jy(jf(eh,mB,"global"),oe,{merge:!0})}catch(we){console.warn("Failed to sync to Firebase:",we)}},[e,i]),F=Cne(d),V={red:Math.max(R.red,F.red),blue:Math.max(R.blue,F.blue)},G=Le.useCallback(oe=>{Sp.includes(oe)&&u(we=>({...we,team:oe}))},[]),q=Le.useCallback(oe=>{u(we=>({...we,name:oe}))},[]),ne=Le.useCallback((oe,we,$e=50)=>{let Me=null,Ne=1/0;return d.forEach(Ae=>{const Fe=(Ae.location[0]-oe)*111e3,Ie=(Ae.location[1]-we)*111e3*Math.cos(oe*Math.PI/180),qe=Math.sqrt(Fe*Fe+Ie*Ie);qe<Ne&&qe<=$e&&(Ne=qe,Me={...Ae,distance:Math.round(qe)})}),Me},[d]),K=Le.useCallback(oe=>{if(!l.team)return{success:!1,message:"Join a team first!"};const we=d.find(Ae=>Ae.id===oe);if(!we)return{success:!1,message:"Art not found"};if(we.capturedBy===l.team)return{success:!1,message:"Already yours!"};if(we.status==="ghost")return{success:!1,message:"This art no longer exists"};const $e=HO(we),Me=we.capturedBy;p(Ae=>Ae.map(Fe=>Fe.id===oe?{...Fe,capturedBy:l.team}:Fe)),u(Ae=>({...Ae,score:Ae.score+$e,capturedArt:[...Ae.capturedArt.filter(Fe=>Fe!==oe),oe]})),k({[oe]:l.team});const Ne=gB(Pf.captures,{});return yB(Pf.captures,{...Ne,[oe]:l.team}),{success:!0,art:we,points:$e,previousTeam:Me,message:Me?`Stolen from ${Me}!`:"Captured!"}},[l.team,d,k]),Q=Le.useCallback(async(oe,we)=>{E(!0);const $e=ne(we.lat,we.lng,100);if(!$e){E(!1),x({success:!1,message:"No street art nearby. Get closer!"});return}M({art:$e,photo:oe,location:we}),E(!1)},[ne]),H=Le.useCallback(()=>{if(!S)return;const oe=K(S.art.id);x(oe),M(null)},[S,K]),j=Le.useCallback(()=>{M(null),x(null)},[]),ee=Le.useCallback(async()=>{if(localStorage.removeItem(Pf.player),localStorage.removeItem(Pf.captures),e&&i)try{await Jy(jf(eh,mB,"global"),{})}catch(oe){console.warn("Failed to reset Firebase:",oe)}u({id:(e==null?void 0:e.uid)||`player-${Date.now()}`,name:"Street Artist",team:null,score:0,capturedArt:[]}),p(pB.map(oe=>({...oe,capturedBy:null}))),x(null),M(null)},[e,i]),de={player:l,artPoints:d,teamScores:V,globalTeamScores:R,scanResult:g,isScanning:b,pendingCapture:S,isOnline:i,teams:Sp,joinTeam:G,setPlayerName:q,captureArt:K,startCapture:Q,confirmCapture:H,cancelCapture:j,findNearestArt:ne,setScanResult:x,resetAll:ee,TEAM_COLORS:Rr};return he.jsx(Ene.Provider,{value:de,children:n})}function Kd(){const n=Le.useContext(Ene);if(!n)throw new Error("useGame must be used within a GameProvider");return n}/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var q9e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J9e=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),or=(n,e)=>{const t=Le.forwardRef(({color:i="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:u,className:d="",children:p,...g},x)=>Le.createElement("svg",{ref:x,...q9e,width:s,height:s,stroke:i,strokeWidth:u?Number(l)*24/Number(s):l,className:["lucide",`lucide-${J9e(n)}`,d].join(" "),...g},[...e.map(([b,E])=>Le.createElement(b,E)),...Array.isArray(p)?p:[p]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eHe=or("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tHe=or("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ne=or("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nHe=or("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AA=or("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iHe=or("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rHe=or("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sHe=or("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oHe=or("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aHe=or("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lHe=or("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cHe=or("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uHe=or("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XO=or("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $O=or("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b2=or("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ine=or("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sne=or("Scan",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hHe=or("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dHe=or("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fHe=or("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QO=or("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pHe=or("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=or("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tne=or("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mne=or("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mHe=or("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]);/**
 * @license lucide-react v0.299.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gHe=or("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),g6=["Swift","Bold","Neon","Urban","Wild","Cosmic","Pixel","Mystic","Shadow","Electric"],y6=["Artist","Hunter","Rebel","Ghost","Ninja","Pirate","Wizard","Rogue","Phoenix","Storm"];function yHe(){const n=g6[Math.floor(Math.random()*g6.length)],e=y6[Math.floor(Math.random()*y6.length)],t=Math.floor(Math.random()*99)+1;return`${n}${e}${t}`}function AHe(){const n=H1(),{player:e,joinTeam:t,setPlayerName:i}=Kd(),[s,l]=Le.useState(0),[u,d]=Le.useState(e.name||""),[p,g]=Le.useState(null);Le.useEffect(()=>{e.team&&e.name&&e.name!=="Street Artist"&&n("/map")},[]);const x=()=>{d(yHe())},b=()=>{if(s===1&&u.trim()&&i(u.trim()),s===2&&p&&t(p),s===3){n("/map");return}l(s+1)},E=()=>s===1?u.trim().length>=2:s===2?p!==null:!0;return he.jsxs("div",{className:"h-screen bg-gradient-to-b from-[#0a0a0f] via-[#12121a] to-[#0a0a0f] flex flex-col overflow-hidden",children:[he.jsx("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 flex gap-2 z-10",children:[0,1,2,3].map(S=>he.jsx("div",{className:`w-2 h-2 rounded-full transition-all duration-300 ${S===s?"bg-white w-6":S<s?"bg-white/60":"bg-white/20"}`},S))}),he.jsxs(RA,{mode:"wait",children:[s===0&&he.jsxs(Mn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col items-center justify-center p-6 text-center overflow-y-auto",children:[he.jsx(Mn.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,type:"spring"},className:"w-24 h-24 rounded-3xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center mb-8 shadow-2xl shadow-purple-500/30",children:he.jsx(QO,{size:48,className:"text-white"})}),he.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Street Art CTF"}),he.jsx("p",{className:"text-white/60 text-lg mb-2",children:"Capture the Flag"}),he.jsx("p",{className:"text-white/40 max-w-xs mb-8",children:"Scan real street art to capture territory for your team. The city is your battlefield."}),he.jsxs("div",{className:"flex flex-col gap-4 w-full max-w-xs",children:[he.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:he.jsx(_ne,{size:24,className:"text-blue-400"})}),he.jsxs("div",{className:"text-left",children:[he.jsx("div",{className:"font-medium",children:"Scan Art"}),he.jsx("div",{className:"text-sm text-white/50",children:"Find & capture street art"})]})]}),he.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center",children:he.jsx($O,{size:24,className:"text-green-400"})}),he.jsxs("div",{className:"text-left",children:[he.jsx("div",{className:"font-medium",children:"Control Territory"}),he.jsx("div",{className:"text-sm text-white/50",children:"Expand your team's area"})]})]}),he.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-white/5 border border-white/10",children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center",children:he.jsx(Mne,{size:24,className:"text-yellow-400"})}),he.jsxs("div",{className:"text-left",children:[he.jsx("div",{className:"font-medium",children:"Win Together"}),he.jsx("div",{className:"text-sm text-white/50",children:"Lead your team to victory"})]})]})]})]},"intro"),s===1&&he.jsxs(Mn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col items-center justify-center p-6 text-center overflow-y-auto",children:[he.jsx("h1",{className:"text-2xl font-bold mb-2",children:"What's your name?"}),he.jsx("p",{className:"text-white/50 mb-8",children:"This is how others will see you"}),he.jsx("div",{className:"w-full max-w-xs mb-4",children:he.jsx("input",{type:"text",value:u,onChange:S=>d(S.target.value),placeholder:"Enter your name...",maxLength:20,className:"w-full px-4 py-4 rounded-xl bg-white/5 border border-white/10 text-center text-xl font-medium placeholder:text-white/30 focus:outline-none focus:border-purple-500/50 focus:ring-2 focus:ring-purple-500/20"})}),he.jsxs("button",{onClick:x,className:"flex items-center gap-2 px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-white/60 hover:bg-white/10 transition-colors",children:[he.jsx(fHe,{size:16}),"Generate random name"]})]},"name"),s===2&&he.jsxs(Mn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col items-center justify-center p-6 text-center overflow-y-auto",children:[he.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Choose your team"}),he.jsx("p",{className:"text-white/50 mb-8",children:"Fight for territory together"}),he.jsxs("div",{className:"flex gap-4 w-full max-w-sm",children:[he.jsxs(Mn.button,{whileTap:{scale:.95},onClick:()=>g("red"),className:`flex-1 p-6 rounded-2xl border-2 transition-all ${p==="red"?"bg-red-500/20 border-red-500 shadow-lg shadow-red-500/30":"bg-white/5 border-white/10 hover:border-red-500/50"}`,children:[he.jsx("div",{className:`w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4 ${p==="red"?"bg-red-500":"bg-red-500/30"}`,children:he.jsx("span",{className:"text-3xl",children:""})}),he.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"#ff6b6b"},children:"Red Team"}),he.jsx("div",{className:"text-sm text-white/50",children:"The Flames"})]}),he.jsxs(Mn.button,{whileTap:{scale:.95},onClick:()=>g("blue"),className:`flex-1 p-6 rounded-2xl border-2 transition-all ${p==="blue"?"bg-blue-500/20 border-blue-500 shadow-lg shadow-blue-500/30":"bg-white/5 border-white/10 hover:border-blue-500/50"}`,children:[he.jsx("div",{className:`w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4 ${p==="blue"?"bg-blue-500":"bg-blue-500/30"}`,children:he.jsx("span",{className:"text-3xl",children:""})}),he.jsx("div",{className:"font-bold text-lg mb-1",style:{color:"#4dabf7"},children:"Blue Team"}),he.jsx("div",{className:"text-sm text-white/50",children:"The Waves"})]})]})]},"team"),s===3&&he.jsxs(Mn.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex-1 flex flex-col items-center justify-center p-6 text-center overflow-y-auto",children:[he.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center mb-6 ${p==="red"?"bg-red-500/20":"bg-blue-500/20"}`,children:he.jsx("span",{className:"text-4xl",children:p==="red"?"":""})}),he.jsxs("h1",{className:"text-2xl font-bold mb-2",children:["Welcome, ",u,"!"]}),he.jsxs("p",{className:"text-white/50 mb-8",children:["You're on Team ",he.jsx("span",{style:{color:p==="red"?"#ff6b6b":"#4dabf7"},className:"font-bold",children:p==="red"?"Red":"Blue"})]}),he.jsxs("div",{className:"w-full max-w-xs space-y-4 mb-8",children:[he.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 text-left",children:[he.jsx("div",{className:"font-medium mb-1",children:" How to Play"}),he.jsx("div",{className:"text-sm text-white/50",children:"Find street art around you. Point your camera at it to scan and capture it for your team."})]}),he.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 text-left",children:[he.jsx("div",{className:"font-medium mb-1",children:" Check the Map"}),he.jsx("div",{className:"text-sm text-white/50",children:"See which art is nearby and which territories each team controls."})]}),he.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 text-left",children:[he.jsx("div",{className:"font-medium mb-1",children:" Score Points"}),he.jsx("div",{className:"text-sm text-white/50",children:"Each capture earns points. Big murals = more points. Steal from enemies for bonus!"})]})]})]},"tutorial")]}),he.jsx("div",{className:"p-4 pb-6 flex-shrink-0",style:{paddingBottom:"max(24px, env(safe-area-inset-bottom))"},children:he.jsxs(Mn.button,{whileTap:{scale:.98},onClick:b,disabled:!E(),className:`w-full py-4 rounded-2xl font-bold text-lg flex items-center justify-center gap-2 transition-all ${E()?"bg-white text-black":"bg-white/10 text-white/30 cursor-not-allowed"}`,children:[s===3?"Let's Go!":"Continue",he.jsx(AA,{size:20})]})})]})}const A6=[{color:"red",name:"Crimson",icon:""},{color:"blue",name:"Azure",icon:""}];function vHe(){var b;const n=H1(),{player:e,joinTeam:t,teamScores:i,artPoints:s,resetAll:l,isOnline:u}=Kd(),d=E=>{t(E)},p={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.08,delayChildren:.1}}},g={hidden:{opacity:0,y:30},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:100,damping:15}}},x=Object.values(i).reduce((E,S)=>E+S,0);return he.jsxs(Mn.div,{className:"flex-1 overflow-y-auto pb-24 px-5 pt-12",initial:"hidden",animate:"visible",exit:{opacity:0,y:20},variants:p,children:[he.jsxs(Mn.div,{className:"text-center mb-10",variants:g,children:[he.jsxs(Mn.div,{className:"relative inline-block mb-6",animate:{y:[0,-8,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},children:[he.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center mx-auto backdrop-blur-sm border border-white/10",children:he.jsx("span",{className:"text-4xl",children:""})}),he.jsx(Mn.div,{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-green-400",animate:{scale:[1,1.2,1],opacity:[1,.7,1]},transition:{duration:2,repeat:1/0}})]}),he.jsx("h1",{className:"text-4xl font-bold gradient-text mb-3",children:"Street Art CTF"}),he.jsx("p",{className:"text-white/50 text-sm max-w-xs mx-auto",children:"Capture the city, one masterpiece at a time"}),he.jsxs("div",{className:`inline-flex items-center gap-1.5 mt-3 px-3 py-1 rounded-full text-xs ${u?"bg-green-500/20 text-green-400":"bg-yellow-500/20 text-yellow-400"}`,children:[u?he.jsx(iHe,{size:12}):he.jsx(mHe,{size:12}),u?"Synced":"Offline"]})]}),e.team?he.jsxs(Mn.div,{className:"mb-8 p-5 rounded-2xl relative overflow-hidden",variants:g,style:{background:`linear-gradient(135deg, ${Rr[e.team].hex}15 0%, transparent 100%)`,border:`1px solid ${Rr[e.team].hex}30`},children:[he.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 opacity-20 blur-3xl",style:{backgroundColor:Rr[e.team].hex}}),he.jsxs("div",{className:"relative flex items-center justify-between",children:[he.jsxs("div",{children:[he.jsx("p",{className:"text-xs text-white/40 uppercase tracking-wider mb-1",children:"Your Team"}),he.jsx("p",{className:"text-2xl font-bold",style:{color:Rr[e.team].hex},children:(b=A6.find(E=>E.color===e.team))==null?void 0:b.name})]}),he.jsxs("div",{className:"text-right",children:[he.jsx("p",{className:"text-xs text-white/40 uppercase tracking-wider mb-1",children:"Score"}),he.jsx("p",{className:"text-3xl font-bold text-white",children:e.score})]})]})]}):he.jsxs(Mn.div,{variants:g,className:"mb-8",children:[he.jsxs("div",{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-2xl p-4 mb-6",children:[he.jsx("h3",{className:"font-bold text-white mb-2",children:" Welcome, Street Artist!"}),he.jsxs("p",{className:"text-sm text-white/60 leading-relaxed",children:["Explore the city, find street art, and capture it for your team! Get within ",he.jsx("span",{className:"text-purple-400 font-medium",children:"100m"})," of an art piece, take a photo, and claim it."]})]}),he.jsxs("div",{className:"flex items-center gap-2 mb-5",children:[he.jsx(Mne,{size:18,className:"text-white/40"}),he.jsx("h2",{className:"text-sm font-medium text-white/40 uppercase tracking-wider",children:"Choose Your Side"})]}),he.jsx("div",{className:"grid grid-cols-2 gap-3",children:A6.map(({color:E,name:S,icon:M},R)=>he.jsxs(Mn.button,{onClick:()=>d(E),className:"group relative p-5 rounded-2xl text-left overflow-hidden",style:{background:`linear-gradient(135deg, ${Rr[E].hex}15 0%, transparent 100%)`,border:`1px solid ${Rr[E].hex}30`},whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:R*.05},children:[he.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${Rr[E].hex}20 0%, transparent 70%)`}}),he.jsxs("div",{className:"relative",children:[he.jsx("span",{className:"text-2xl font-bold",style:{color:Rr[E].hex},children:M}),he.jsx("p",{className:"font-semibold mt-3 text-white",children:S}),he.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[he.jsxs("span",{className:"text-xs text-white/40",children:[i[E]," pts"]}),he.jsx("div",{className:"flex-1 h-1 rounded-full bg-white/10 overflow-hidden",children:he.jsx(Mn.div,{className:"h-full rounded-full",style:{backgroundColor:Rr[E].hex},initial:{width:0},animate:{width:`${i[E]/x*100}%`},transition:{duration:.8,delay:.3}})})]})]})]},E))})]}),he.jsxs(Mn.div,{className:"space-y-3 mb-8",variants:g,children:[he.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[he.jsx(QO,{size:18,className:"text-white/40"}),he.jsx("h2",{className:"text-sm font-medium text-white/40 uppercase tracking-wider",children:"Quick Actions"})]}),he.jsxs(Mn.button,{onClick:()=>n("/map"),className:"w-full group p-4 rounded-2xl flex items-center gap-4 bg-white/[0.03] border border-white/[0.06] hover:bg-white/[0.06] hover:border-white/10 transition-all duration-300",whileTap:{scale:.98},disabled:!e.team,children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/20",children:he.jsx($O,{size:22,className:"text-white"})}),he.jsxs("div",{className:"flex-1 text-left",children:[he.jsx("p",{className:"font-semibold text-white",children:"Explore Map"}),he.jsx("p",{className:"text-sm text-white/40",children:"View sectors & tram lines"})]}),he.jsx(AA,{size:20,className:"text-white/20 group-hover:text-white/40 group-hover:translate-x-1 transition-all"})]}),he.jsxs(Mn.button,{onClick:()=>n("/scanner"),className:"w-full group p-4 rounded-2xl flex items-center gap-4 bg-white/[0.03] border border-white/[0.06] hover:bg-white/[0.06] hover:border-white/10 transition-all duration-300",whileTap:{scale:.98},disabled:!e.team,children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 flex items-center justify-center shadow-lg shadow-emerald-500/20",children:he.jsx(Sne,{size:22,className:"text-white"})}),he.jsxs("div",{className:"flex-1 text-left",children:[he.jsx("p",{className:"font-semibold text-white",children:"Scan Art"}),he.jsx("p",{className:"text-sm text-white/40",children:"Capture for your team"})]}),he.jsx(AA,{size:20,className:"text-white/20 group-hover:text-white/40 group-hover:translate-x-1 transition-all"})]}),he.jsxs(Mn.button,{onClick:()=>n("/leaderboard"),className:"w-full group p-4 rounded-2xl flex items-center gap-4 bg-white/[0.03] border border-white/[0.06] hover:bg-white/[0.06] hover:border-white/10 transition-all duration-300",whileTap:{scale:.98},children:[he.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg shadow-amber-500/20",children:he.jsx(AT,{size:22,className:"text-white"})}),he.jsxs("div",{className:"flex-1 text-left",children:[he.jsx("p",{className:"font-semibold text-white",children:"Leaderboard"}),he.jsx("p",{className:"text-sm text-white/40",children:"See team rankings"})]}),he.jsx(AA,{size:20,className:"text-white/20 group-hover:text-white/40 group-hover:translate-x-1 transition-all"})]})]}),he.jsxs(Mn.div,{variants:g,children:[he.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[he.jsx(b2,{size:18,className:"text-white/40"}),he.jsx("h2",{className:"text-sm font-medium text-white/40 uppercase tracking-wider",children:"Game Stats"})]}),he.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:s.length,label:"Art Spots",color:"from-purple-500/20 to-pink-500/20"},{value:s.filter(E=>E.capturedBy).length,label:"Captured",color:"from-green-500/20 to-emerald-500/20"},{value:e.capturedArt.length,label:"Your Claims",color:"from-blue-500/20 to-indigo-500/20"}].map((E,S)=>he.jsxs(Mn.div,{className:`p-4 rounded-2xl text-center bg-gradient-to-br ${E.color} border border-white/[0.06]`,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.4+S*.1},children:[he.jsx("p",{className:"text-2xl font-bold text-white",children:E.value}),he.jsx("p",{className:"text-xs text-white/40 mt-1",children:E.label})]},E.label))})]}),he.jsx(Mn.div,{variants:g,className:"mt-6",children:he.jsxs(Mn.button,{onClick:l,className:"w-full p-3 rounded-xl flex items-center justify-center gap-2 bg-white/[0.02] border border-white/[0.04] text-white/30 hover:text-white/50 hover:bg-white/[0.04] transition-all text-sm",whileTap:{scale:.98},children:[he.jsx(Ine,{size:14}),"Reset Game Data"]})})]})}function bHe(n,e){const t=Le.useRef(e);Le.useEffect(function(){e!==t.current&&n.attributionControl!=null&&(t.current!=null&&n.attributionControl.removeAttribution(t.current),e!=null&&n.attributionControl.addAttribution(e)),t.current=e},[n,e])}function xHe(n,e,t){e.center!==t.center&&n.setLatLng(e.center),e.radius!=null&&e.radius!==t.radius&&n.setRadius(e.radius)}const wHe=1;function CHe(n){return Object.freeze({__version:wHe,map:n})}function KO(n,e){return Object.freeze({...n,...e})}const kne=Le.createContext(null),Rne=kne.Provider;function ZO(){const n=Le.useContext(kne);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function EHe(n){function e(t,i){const{instance:s,context:l}=n(t).current;return Le.useImperativeHandle(i,()=>s),t.children==null?null:Vg.createElement(Rne,{value:l},t.children)}return Le.forwardRef(e)}function _He(n){function e(t,i){const{instance:s}=n(t).current;return Le.useImperativeHandle(i,()=>s),null}return Le.forwardRef(e)}function Lne(n,e){const t=Le.useRef();Le.useEffect(function(){return e!=null&&n.instance.on(e),t.current=e,function(){t.current!=null&&n.instance.off(t.current),t.current=null}},[n,e])}function jO(n,e){const t=n.pane??e.pane;return t?{...n,pane:t}:n}var zD={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,e){(function(t,i){i(e)})(xg,function(t){var i="1.9.4";function s(v){var I,D,$,ie;for(D=1,$=arguments.length;D<$;D++){ie=arguments[D];for(I in ie)v[I]=ie[I]}return v}var l=Object.create||function(){function v(){}return function(I){return v.prototype=I,new v}}();function u(v,I){var D=Array.prototype.slice;if(v.bind)return v.bind.apply(v,D.call(arguments,1));var $=D.call(arguments,2);return function(){return v.apply(I,$.length?$.concat(D.call(arguments)):arguments)}}var d=0;function p(v){return"_leaflet_id"in v||(v._leaflet_id=++d),v._leaflet_id}function g(v,I,D){var $,ie,fe,_e;return _e=function(){$=!1,ie&&(fe.apply(D,ie),ie=!1)},fe=function(){$?ie=arguments:(v.apply(D,arguments),setTimeout(_e,I),$=!0)},fe}function x(v,I,D){var $=I[1],ie=I[0],fe=$-ie;return v===$&&D?v:((v-ie)%fe+fe)%fe+ie}function b(){return!1}function E(v,I){if(I===!1)return v;var D=Math.pow(10,I===void 0?6:I);return Math.round(v*D)/D}function S(v){return v.trim?v.trim():v.replace(/^\s+|\s+$/g,"")}function M(v){return S(v).split(/\s+/)}function R(v,I){Object.prototype.hasOwnProperty.call(v,"options")||(v.options=v.options?l(v.options):{});for(var D in I)v.options[D]=I[D];return v.options}function P(v,I,D){var $=[];for(var ie in v)$.push(encodeURIComponent(D?ie.toUpperCase():ie)+"="+encodeURIComponent(v[ie]));return(!I||I.indexOf("?")===-1?"?":"&")+$.join("&")}var k=/\{ *([\w_ -]+) *\}/g;function F(v,I){return v.replace(k,function(D,$){var ie=I[$];if(ie===void 0)throw new Error("No value provided for variable "+D);return typeof ie=="function"&&(ie=ie(I)),ie})}var V=Array.isArray||function(v){return Object.prototype.toString.call(v)==="[object Array]"};function G(v,I){for(var D=0;D<v.length;D++)if(v[D]===I)return D;return-1}var q="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function ne(v){return window["webkit"+v]||window["moz"+v]||window["ms"+v]}var K=0;function Q(v){var I=+new Date,D=Math.max(0,16-(I-K));return K=I+D,window.setTimeout(v,D)}var H=window.requestAnimationFrame||ne("RequestAnimationFrame")||Q,j=window.cancelAnimationFrame||ne("CancelAnimationFrame")||ne("CancelRequestAnimationFrame")||function(v){window.clearTimeout(v)};function ee(v,I,D){if(D&&H===Q)v.call(I);else return H.call(window,u(v,I))}function de(v){v&&j.call(window,v)}var oe={__proto__:null,extend:s,create:l,bind:u,get lastId(){return d},stamp:p,throttle:g,wrapNum:x,falseFn:b,formatNum:E,trim:S,splitWords:M,setOptions:R,getParamString:P,template:F,isArray:V,indexOf:G,emptyImageUrl:q,requestFn:H,cancelFn:j,requestAnimFrame:ee,cancelAnimFrame:de};function we(){}we.extend=function(v){var I=function(){R(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},D=I.__super__=this.prototype,$=l(D);$.constructor=I,I.prototype=$;for(var ie in this)Object.prototype.hasOwnProperty.call(this,ie)&&ie!=="prototype"&&ie!=="__super__"&&(I[ie]=this[ie]);return v.statics&&s(I,v.statics),v.includes&&($e(v.includes),s.apply(null,[$].concat(v.includes))),s($,v),delete $.statics,delete $.includes,$.options&&($.options=D.options?l(D.options):{},s($.options,v.options)),$._initHooks=[],$.callInitHooks=function(){if(!this._initHooksCalled){D.callInitHooks&&D.callInitHooks.call(this),this._initHooksCalled=!0;for(var fe=0,_e=$._initHooks.length;fe<_e;fe++)$._initHooks[fe].call(this)}},I},we.include=function(v){var I=this.prototype.options;return s(this.prototype,v),v.options&&(this.prototype.options=I,this.mergeOptions(v.options)),this},we.mergeOptions=function(v){return s(this.prototype.options,v),this},we.addInitHook=function(v){var I=Array.prototype.slice.call(arguments,1),D=typeof v=="function"?v:function(){this[v].apply(this,I)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(D),this};function $e(v){if(!(typeof L>"u"||!L||!L.Mixin)){v=V(v)?v:[v];for(var I=0;I<v.length;I++)v[I]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Me={on:function(v,I,D){if(typeof v=="object")for(var $ in v)this._on($,v[$],I);else{v=M(v);for(var ie=0,fe=v.length;ie<fe;ie++)this._on(v[ie],I,D)}return this},off:function(v,I,D){if(!arguments.length)delete this._events;else if(typeof v=="object")for(var $ in v)this._off($,v[$],I);else{v=M(v);for(var ie=arguments.length===1,fe=0,_e=v.length;fe<_e;fe++)ie?this._off(v[fe]):this._off(v[fe],I,D)}return this},_on:function(v,I,D,$){if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}if(this._listens(v,I,D)===!1){D===this&&(D=void 0);var ie={fn:I,ctx:D};$&&(ie.once=!0),this._events=this._events||{},this._events[v]=this._events[v]||[],this._events[v].push(ie)}},_off:function(v,I,D){var $,ie,fe;if(this._events&&($=this._events[v],!!$)){if(arguments.length===1){if(this._firingCount)for(ie=0,fe=$.length;ie<fe;ie++)$[ie].fn=b;delete this._events[v];return}if(typeof I!="function"){console.warn("wrong listener type: "+typeof I);return}var _e=this._listens(v,I,D);if(_e!==!1){var je=$[_e];this._firingCount&&(je.fn=b,this._events[v]=$=$.slice()),$.splice(_e,1)}}},fire:function(v,I,D){if(!this.listens(v,D))return this;var $=s({},I,{type:v,target:this,sourceTarget:I&&I.sourceTarget||this});if(this._events){var ie=this._events[v];if(ie){this._firingCount=this._firingCount+1||1;for(var fe=0,_e=ie.length;fe<_e;fe++){var je=ie[fe],Je=je.fn;je.once&&this.off(v,Je,je.ctx),Je.call(je.ctx||this,$)}this._firingCount--}}return D&&this._propagateEvent($),this},listens:function(v,I,D,$){typeof v!="string"&&console.warn('"string" type argument expected');var ie=I;typeof I!="function"&&($=!!I,ie=void 0,D=void 0);var fe=this._events&&this._events[v];if(fe&&fe.length&&this._listens(v,ie,D)!==!1)return!0;if($){for(var _e in this._eventParents)if(this._eventParents[_e].listens(v,I,D,$))return!0}return!1},_listens:function(v,I,D){if(!this._events)return!1;var $=this._events[v]||[];if(!I)return!!$.length;D===this&&(D=void 0);for(var ie=0,fe=$.length;ie<fe;ie++)if($[ie].fn===I&&$[ie].ctx===D)return ie;return!1},once:function(v,I,D){if(typeof v=="object")for(var $ in v)this._on($,v[$],I,!0);else{v=M(v);for(var ie=0,fe=v.length;ie<fe;ie++)this._on(v[ie],I,D,!0)}return this},addEventParent:function(v){return this._eventParents=this._eventParents||{},this._eventParents[p(v)]=v,this},removeEventParent:function(v){return this._eventParents&&delete this._eventParents[p(v)],this},_propagateEvent:function(v){for(var I in this._eventParents)this._eventParents[I].fire(v.type,s({layer:v.target,propagatedFrom:v.target},v),!0)}};Me.addEventListener=Me.on,Me.removeEventListener=Me.clearAllEventListeners=Me.off,Me.addOneTimeEventListener=Me.once,Me.fireEvent=Me.fire,Me.hasEventListeners=Me.listens;var Ne=we.extend(Me);function Ae(v,I,D){this.x=D?Math.round(v):v,this.y=D?Math.round(I):I}var Fe=Math.trunc||function(v){return v>0?Math.floor(v):Math.ceil(v)};Ae.prototype={clone:function(){return new Ae(this.x,this.y)},add:function(v){return this.clone()._add(Ie(v))},_add:function(v){return this.x+=v.x,this.y+=v.y,this},subtract:function(v){return this.clone()._subtract(Ie(v))},_subtract:function(v){return this.x-=v.x,this.y-=v.y,this},divideBy:function(v){return this.clone()._divideBy(v)},_divideBy:function(v){return this.x/=v,this.y/=v,this},multiplyBy:function(v){return this.clone()._multiplyBy(v)},_multiplyBy:function(v){return this.x*=v,this.y*=v,this},scaleBy:function(v){return new Ae(this.x*v.x,this.y*v.y)},unscaleBy:function(v){return new Ae(this.x/v.x,this.y/v.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Fe(this.x),this.y=Fe(this.y),this},distanceTo:function(v){v=Ie(v);var I=v.x-this.x,D=v.y-this.y;return Math.sqrt(I*I+D*D)},equals:function(v){return v=Ie(v),v.x===this.x&&v.y===this.y},contains:function(v){return v=Ie(v),Math.abs(v.x)<=Math.abs(this.x)&&Math.abs(v.y)<=Math.abs(this.y)},toString:function(){return"Point("+E(this.x)+", "+E(this.y)+")"}};function Ie(v,I,D){return v instanceof Ae?v:V(v)?new Ae(v[0],v[1]):v==null?v:typeof v=="object"&&"x"in v&&"y"in v?new Ae(v.x,v.y):new Ae(v,I,D)}function qe(v,I){if(v)for(var D=I?[v,I]:v,$=0,ie=D.length;$<ie;$++)this.extend(D[$])}qe.prototype={extend:function(v){var I,D;if(!v)return this;if(v instanceof Ae||typeof v[0]=="number"||"x"in v)I=D=Ie(v);else if(v=dt(v),I=v.min,D=v.max,!I||!D)return this;return!this.min&&!this.max?(this.min=I.clone(),this.max=D.clone()):(this.min.x=Math.min(I.x,this.min.x),this.max.x=Math.max(D.x,this.max.x),this.min.y=Math.min(I.y,this.min.y),this.max.y=Math.max(D.y,this.max.y)),this},getCenter:function(v){return Ie((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,v)},getBottomLeft:function(){return Ie(this.min.x,this.max.y)},getTopRight:function(){return Ie(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(v){var I,D;return typeof v[0]=="number"||v instanceof Ae?v=Ie(v):v=dt(v),v instanceof qe?(I=v.min,D=v.max):I=D=v,I.x>=this.min.x&&D.x<=this.max.x&&I.y>=this.min.y&&D.y<=this.max.y},intersects:function(v){v=dt(v);var I=this.min,D=this.max,$=v.min,ie=v.max,fe=ie.x>=I.x&&$.x<=D.x,_e=ie.y>=I.y&&$.y<=D.y;return fe&&_e},overlaps:function(v){v=dt(v);var I=this.min,D=this.max,$=v.min,ie=v.max,fe=ie.x>I.x&&$.x<D.x,_e=ie.y>I.y&&$.y<D.y;return fe&&_e},isValid:function(){return!!(this.min&&this.max)},pad:function(v){var I=this.min,D=this.max,$=Math.abs(I.x-D.x)*v,ie=Math.abs(I.y-D.y)*v;return dt(Ie(I.x-$,I.y-ie),Ie(D.x+$,D.y+ie))},equals:function(v){return v?(v=dt(v),this.min.equals(v.getTopLeft())&&this.max.equals(v.getBottomRight())):!1}};function dt(v,I){return!v||v instanceof qe?v:new qe(v,I)}function Wt(v,I){if(v)for(var D=I?[v,I]:v,$=0,ie=D.length;$<ie;$++)this.extend(D[$])}Wt.prototype={extend:function(v){var I=this._southWest,D=this._northEast,$,ie;if(v instanceof At)$=v,ie=v;else if(v instanceof Wt){if($=v._southWest,ie=v._northEast,!$||!ie)return this}else return v?this.extend(Rt(v)||xt(v)):this;return!I&&!D?(this._southWest=new At($.lat,$.lng),this._northEast=new At(ie.lat,ie.lng)):(I.lat=Math.min($.lat,I.lat),I.lng=Math.min($.lng,I.lng),D.lat=Math.max(ie.lat,D.lat),D.lng=Math.max(ie.lng,D.lng)),this},pad:function(v){var I=this._southWest,D=this._northEast,$=Math.abs(I.lat-D.lat)*v,ie=Math.abs(I.lng-D.lng)*v;return new Wt(new At(I.lat-$,I.lng-ie),new At(D.lat+$,D.lng+ie))},getCenter:function(){return new At((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new At(this.getNorth(),this.getWest())},getSouthEast:function(){return new At(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(v){typeof v[0]=="number"||v instanceof At||"lat"in v?v=Rt(v):v=xt(v);var I=this._southWest,D=this._northEast,$,ie;return v instanceof Wt?($=v.getSouthWest(),ie=v.getNorthEast()):$=ie=v,$.lat>=I.lat&&ie.lat<=D.lat&&$.lng>=I.lng&&ie.lng<=D.lng},intersects:function(v){v=xt(v);var I=this._southWest,D=this._northEast,$=v.getSouthWest(),ie=v.getNorthEast(),fe=ie.lat>=I.lat&&$.lat<=D.lat,_e=ie.lng>=I.lng&&$.lng<=D.lng;return fe&&_e},overlaps:function(v){v=xt(v);var I=this._southWest,D=this._northEast,$=v.getSouthWest(),ie=v.getNorthEast(),fe=ie.lat>I.lat&&$.lat<D.lat,_e=ie.lng>I.lng&&$.lng<D.lng;return fe&&_e},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(v,I){return v?(v=xt(v),this._southWest.equals(v.getSouthWest(),I)&&this._northEast.equals(v.getNorthEast(),I)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function xt(v,I){return v instanceof Wt?v:new Wt(v,I)}function At(v,I,D){if(isNaN(v)||isNaN(I))throw new Error("Invalid LatLng object: ("+v+", "+I+")");this.lat=+v,this.lng=+I,D!==void 0&&(this.alt=+D)}At.prototype={equals:function(v,I){if(!v)return!1;v=Rt(v);var D=Math.max(Math.abs(this.lat-v.lat),Math.abs(this.lng-v.lng));return D<=(I===void 0?1e-9:I)},toString:function(v){return"LatLng("+E(this.lat,v)+", "+E(this.lng,v)+")"},distanceTo:function(v){return Ze.distance(this,Rt(v))},wrap:function(){return Ze.wrapLatLng(this)},toBounds:function(v){var I=180*v/40075017,D=I/Math.cos(Math.PI/180*this.lat);return xt([this.lat-I,this.lng-D],[this.lat+I,this.lng+D])},clone:function(){return new At(this.lat,this.lng,this.alt)}};function Rt(v,I,D){return v instanceof At?v:V(v)&&typeof v[0]!="object"?v.length===3?new At(v[0],v[1],v[2]):v.length===2?new At(v[0],v[1]):null:v==null?v:typeof v=="object"&&"lat"in v?new At(v.lat,"lng"in v?v.lng:v.lon,v.alt):I===void 0?null:new At(v,I,D)}var Et={latLngToPoint:function(v,I){var D=this.projection.project(v),$=this.scale(I);return this.transformation._transform(D,$)},pointToLatLng:function(v,I){var D=this.scale(I),$=this.transformation.untransform(v,D);return this.projection.unproject($)},project:function(v){return this.projection.project(v)},unproject:function(v){return this.projection.unproject(v)},scale:function(v){return 256*Math.pow(2,v)},zoom:function(v){return Math.log(v/256)/Math.LN2},getProjectedBounds:function(v){if(this.infinite)return null;var I=this.projection.bounds,D=this.scale(v),$=this.transformation.transform(I.min,D),ie=this.transformation.transform(I.max,D);return new qe($,ie)},infinite:!1,wrapLatLng:function(v){var I=this.wrapLng?x(v.lng,this.wrapLng,!0):v.lng,D=this.wrapLat?x(v.lat,this.wrapLat,!0):v.lat,$=v.alt;return new At(D,I,$)},wrapLatLngBounds:function(v){var I=v.getCenter(),D=this.wrapLatLng(I),$=I.lat-D.lat,ie=I.lng-D.lng;if($===0&&ie===0)return v;var fe=v.getSouthWest(),_e=v.getNorthEast(),je=new At(fe.lat-$,fe.lng-ie),Je=new At(_e.lat-$,_e.lng-ie);return new Wt(je,Je)}},Ze=s({},Et,{wrapLng:[-180,180],R:6371e3,distance:function(v,I){var D=Math.PI/180,$=v.lat*D,ie=I.lat*D,fe=Math.sin((I.lat-v.lat)*D/2),_e=Math.sin((I.lng-v.lng)*D/2),je=fe*fe+Math.cos($)*Math.cos(ie)*_e*_e,Je=2*Math.atan2(Math.sqrt(je),Math.sqrt(1-je));return this.R*Je}}),It=6378137,Lt={R:It,MAX_LATITUDE:85.0511287798,project:function(v){var I=Math.PI/180,D=this.MAX_LATITUDE,$=Math.max(Math.min(D,v.lat),-D),ie=Math.sin($*I);return new Ae(this.R*v.lng*I,this.R*Math.log((1+ie)/(1-ie))/2)},unproject:function(v){var I=180/Math.PI;return new At((2*Math.atan(Math.exp(v.y/this.R))-Math.PI/2)*I,v.x*I/this.R)},bounds:function(){var v=It*Math.PI;return new qe([-v,-v],[v,v])}()};function Yt(v,I,D,$){if(V(v)){this._a=v[0],this._b=v[1],this._c=v[2],this._d=v[3];return}this._a=v,this._b=I,this._c=D,this._d=$}Yt.prototype={transform:function(v,I){return this._transform(v.clone(),I)},_transform:function(v,I){return I=I||1,v.x=I*(this._a*v.x+this._b),v.y=I*(this._c*v.y+this._d),v},untransform:function(v,I){return I=I||1,new Ae((v.x/I-this._b)/this._a,(v.y/I-this._d)/this._c)}};function ht(v,I,D,$){return new Yt(v,I,D,$)}var yt=s({},Ze,{code:"EPSG:3857",projection:Lt,transformation:function(){var v=.5/(Math.PI*Lt.R);return ht(v,.5,-v,.5)}()}),wt=s({},yt,{code:"EPSG:900913"});function Ee(v){return document.createElementNS("http://www.w3.org/2000/svg",v)}function Te(v,I){var D="",$,ie,fe,_e,je,Je;for($=0,fe=v.length;$<fe;$++){for(je=v[$],ie=0,_e=je.length;ie<_e;ie++)Je=je[ie],D+=(ie?"L":"M")+Je.x+" "+Je.y;D+=I?hn.svg?"z":"x":""}return D||"M0 0"}var Gt=document.documentElement.style,Y="ActiveXObject"in window,te=Y&&!document.addEventListener,ce="msLaunchUri"in navigator&&!("documentMode"in document),xe=qr("webkit"),Re=qr("android"),We=qr("android 2")||qr("android 3"),at=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ln=Re&&qr("Google")&&at<537&&!("AudioNode"in window),ve=!!window.opera,ue=!ce&&qr("chrome"),Oe=qr("gecko")&&!xe&&!ve&&!Y,ut=!ue&&qr("safari"),vt=qr("phantom"),pt="OTransition"in Gt,cn=navigator.platform.indexOf("Win")===0,Tt=Y&&"transition"in Gt,Zt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!We,kn="MozPerspective"in Gt,Ft=!window.L_DISABLE_3D&&(Tt||Zt||kn)&&!pt&&!vt,vn=typeof orientation<"u"||qr("mobile"),jn=vn&&xe,Pe=vn&&Zt,ft=!window.PointerEvent&&window.MSPointerEvent,Pt=!!(window.PointerEvent||ft),Dt="ontouchstart"in window||!!window.TouchEvent,qt=!window.L_NO_TOUCH&&(Dt||Pt),sn=vn&&ve,Rn=vn&&Oe,tn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Jt=function(){var v=!1;try{var I=Object.defineProperty({},"passive",{get:function(){v=!0}});window.addEventListener("testPassiveEventSupport",b,I),window.removeEventListener("testPassiveEventSupport",b,I)}catch{}return v}(),fn=function(){return!!document.createElement("canvas").getContext}(),ei=!!(document.createElementNS&&Ee("svg").createSVGRect),ar=!!ei&&function(){var v=document.createElement("div");return v.innerHTML="<svg/>",(v.firstChild&&v.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),ta=!ei&&function(){try{var v=document.createElement("div");v.innerHTML='<v:shape adj="1"/>';var I=v.firstChild;return I.style.behavior="url(#default#VML)",I&&typeof I.adj=="object"}catch{return!1}}(),yc=navigator.platform.indexOf("Mac")===0,Dl=navigator.platform.indexOf("Linux")===0;function qr(v){return navigator.userAgent.toLowerCase().indexOf(v)>=0}var hn={ie:Y,ielt9:te,edge:ce,webkit:xe,android:Re,android23:We,androidStock:ln,opera:ve,chrome:ue,gecko:Oe,safari:ut,phantom:vt,opera12:pt,win:cn,ie3d:Tt,webkit3d:Zt,gecko3d:kn,any3d:Ft,mobile:vn,mobileWebkit:jn,mobileWebkit3d:Pe,msPointer:ft,pointer:Pt,touch:qt,touchNative:Dt,mobileOpera:sn,mobileGecko:Rn,retina:tn,passiveEvents:Jt,canvas:fn,svg:ei,vml:ta,inlineSvg:ar,mac:yc,linux:Dl},al=hn.msPointer?"MSPointerDown":"pointerdown",ks=hn.msPointer?"MSPointerMove":"pointermove",Fl=hn.msPointer?"MSPointerUp":"pointerup",Io=hn.msPointer?"MSPointerCancel":"pointercancel",So={touchstart:al,touchmove:ks,touchend:Fl,touchcancel:Io},na={touchstart:ze,touchmove:pe,touchend:pe,touchcancel:pe},ro={},Ac=!1;function uu(v,I,D){return I==="touchstart"&&Vl(),na[I]?(D=na[I].bind(this,D),v.addEventListener(So[I],D,!1),D):(console.warn("wrong event specified:",I),b)}function _h(v,I,D){if(!So[I]){console.warn("wrong event specified:",I);return}v.removeEventListener(So[I],D,!1)}function ll(v){ro[v.pointerId]=v}function hu(v){ro[v.pointerId]&&(ro[v.pointerId]=v)}function Ol(v){delete ro[v.pointerId]}function Vl(){Ac||(document.addEventListener(al,ll,!0),document.addEventListener(ks,hu,!0),document.addEventListener(Fl,Ol,!0),document.addEventListener(Io,Ol,!0),Ac=!0)}function pe(v,I){if(I.pointerType!==(I.MSPOINTER_TYPE_MOUSE||"mouse")){I.touches=[];for(var D in ro)I.touches.push(ro[D]);I.changedTouches=[I],v(I)}}function ze(v,I){I.MSPOINTER_TYPE_TOUCH&&I.pointerType===I.MSPOINTER_TYPE_TOUCH&&mr(I),pe(v,I)}function nt(v){var I={},D,$;for($ in v)D=v[$],I[$]=D&&D.bind?D.bind(v):D;return v=I,I.type="dblclick",I.detail=2,I.isTrusted=!1,I._simulated=!0,I}var rt=200;function Ge(v,I){v.addEventListener("dblclick",I);var D=0,$;function ie(fe){if(fe.detail!==1){$=fe.detail;return}if(!(fe.pointerType==="mouse"||fe.sourceCapabilities&&!fe.sourceCapabilities.firesTouchEvents)){var _e=wc(fe);if(!(_e.some(function(Je){return Je instanceof HTMLLabelElement&&Je.attributes.for})&&!_e.some(function(Je){return Je instanceof HTMLInputElement||Je instanceof HTMLSelectElement}))){var je=Date.now();je-D<=rt?($++,$===2&&I(nt(fe))):$=1,D=je}}}return v.addEventListener("click",ie),{dblclick:I,simDblclick:ie}}function Nt(v,I){v.removeEventListener("dblclick",I.dblclick),v.removeEventListener("click",I.simDblclick)}var Kt=hs(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),on=hs(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),dn=on==="webkitTransition"||on==="OTransition"?on+"End":"transitionend";function Ln(v){return typeof v=="string"?document.getElementById(v):v}function Sn(v,I){var D=v.style[I]||v.currentStyle&&v.currentStyle[I];if((!D||D==="auto")&&document.defaultView){var $=document.defaultView.getComputedStyle(v,null);D=$?$[I]:null}return D==="auto"?null:D}function zt(v,I,D){var $=document.createElement(v);return $.className=I||"",D&&D.appendChild($),$}function gn(v){var I=v.parentNode;I&&I.removeChild(v)}function Hn(v){for(;v.firstChild;)v.removeChild(v.firstChild)}function Ci(v){var I=v.parentNode;I&&I.lastChild!==v&&I.appendChild(v)}function bi(v){var I=v.parentNode;I&&I.firstChild!==v&&I.insertBefore(v,I.firstChild)}function Yn(v,I){if(v.classList!==void 0)return v.classList.contains(I);var D=ti(v);return D.length>0&&new RegExp("(^|\\s)"+I+"(\\s|$)").test(D)}function Ht(v,I){if(v.classList!==void 0)for(var D=M(I),$=0,ie=D.length;$<ie;$++)v.classList.add(D[$]);else if(!Yn(v,I)){var fe=ti(v);us(v,(fe?fe+" ":"")+I)}}function jt(v,I){v.classList!==void 0?v.classList.remove(I):us(v,S((" "+ti(v)+" ").replace(" "+I+" "," ")))}function us(v,I){v.className.baseVal===void 0?v.className=I:v.className.baseVal=I}function ti(v){return v.correspondingElement&&(v=v.correspondingElement),v.className.baseVal===void 0?v.className:v.className.baseVal}function Oi(v,I){"opacity"in v.style?v.style.opacity=I:"filter"in v.style&&Jr(v,I)}function Jr(v,I){var D=!1,$="DXImageTransform.Microsoft.Alpha";try{D=v.filters.item($)}catch{if(I===1)return}I=Math.round(I*100),D?(D.Enabled=I!==100,D.Opacity=I):v.style.filter+=" progid:"+$+"(opacity="+I+")"}function hs(v){for(var I=document.documentElement.style,D=0;D<v.length;D++)if(v[D]in I)return v[D];return!1}function ds(v,I,D){var $=I||new Ae(0,0);v.style[Kt]=(hn.ie3d?"translate("+$.x+"px,"+$.y+"px)":"translate3d("+$.x+"px,"+$.y+"px,0)")+(D?" scale("+D+")":"")}function Nn(v,I){v._leaflet_pos=I,hn.any3d?ds(v,I):(v.style.left=I.x+"px",v.style.top=I.y+"px")}function Vi(v){return v._leaflet_pos||new Ae(0,0)}var pr,mi,Qs;if("onselectstart"in document)pr=function(){Xn(window,"selectstart",mr)},mi=function(){ki(window,"selectstart",mr)};else{var fs=hs(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);pr=function(){if(fs){var v=document.documentElement.style;Qs=v[fs],v[fs]="none"}},mi=function(){fs&&(document.documentElement.style[fs]=Qs,Qs=void 0)}}function Ba(){Xn(window,"dragstart",mr)}function Ih(){ki(window,"dragstart",mr)}var cl,To;function du(v){for(;v.tabIndex===-1;)v=v.parentNode;v.style&&(vc(),cl=v,To=v.style.outlineStyle,v.style.outlineStyle="none",Xn(window,"keydown",vc))}function vc(){cl&&(cl.style.outlineStyle=To,cl=void 0,To=void 0,ki(window,"keydown",vc))}function Sh(v){do v=v.parentNode;while((!v.offsetWidth||!v.offsetHeight)&&v!==document.body);return v}function Pa(v){var I=v.getBoundingClientRect();return{x:I.width/v.offsetWidth||1,y:I.height/v.offsetHeight||1,boundingClientRect:I}}var Zd={__proto__:null,TRANSFORM:Kt,TRANSITION:on,TRANSITION_END:dn,get:Ln,getStyle:Sn,create:zt,remove:gn,empty:Hn,toFront:Ci,toBack:bi,hasClass:Yn,addClass:Ht,removeClass:jt,setClass:us,getClass:ti,setOpacity:Oi,testProp:hs,setTransform:ds,setPosition:Nn,getPosition:Vi,get disableTextSelection(){return pr},get enableTextSelection(){return mi},disableImageDrag:Ba,enableImageDrag:Ih,preventOutline:du,restoreOutline:vc,getSizedParentNode:Sh,getScale:Pa};function Xn(v,I,D,$){if(I&&typeof I=="object")for(var ie in I)bc(v,ie,I[ie],D);else{I=M(I);for(var fe=0,_e=I.length;fe<_e;fe++)bc(v,I[fe],D,$)}return this}var ps="_leaflet_events";function ki(v,I,D,$){if(arguments.length===1)ul(v),delete v[ps];else if(I&&typeof I=="object")for(var ie in I)xc(v,ie,I[ie],D);else if(I=M(I),arguments.length===2)ul(v,function(je){return G(I,je)!==-1});else for(var fe=0,_e=I.length;fe<_e;fe++)xc(v,I[fe],D,$);return this}function ul(v,I){for(var D in v[ps]){var $=D.split(/\d/)[0];(!I||I($))&&xc(v,$,null,null,D)}}var hl={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function bc(v,I,D,$){var ie=I+p(D)+($?"_"+p($):"");if(v[ps]&&v[ps][ie])return this;var fe=function(je){return D.call($||v,je||window.event)},_e=fe;!hn.touchNative&&hn.pointer&&I.indexOf("touch")===0?fe=uu(v,I,fe):hn.touch&&I==="dblclick"?fe=Ge(v,fe):"addEventListener"in v?I==="touchstart"||I==="touchmove"||I==="wheel"||I==="mousewheel"?v.addEventListener(hl[I]||I,fe,hn.passiveEvents?{passive:!1}:!1):I==="mouseenter"||I==="mouseleave"?(fe=function(je){je=je||window.event,gu(v,je)&&_e(je)},v.addEventListener(hl[I],fe,!1)):v.addEventListener(I,_e,!1):v.attachEvent("on"+I,fe),v[ps]=v[ps]||{},v[ps][ie]=fe}function xc(v,I,D,$,ie){ie=ie||I+p(D)+($?"_"+p($):"");var fe=v[ps]&&v[ps][ie];if(!fe)return this;!hn.touchNative&&hn.pointer&&I.indexOf("touch")===0?_h(v,I,fe):hn.touch&&I==="dblclick"?Nt(v,fe):"removeEventListener"in v?v.removeEventListener(hl[I]||I,fe,!1):v.detachEvent("on"+I,fe),v[ps][ie]=null}function Ui(v){return v.stopPropagation?v.stopPropagation():v.originalEvent?v.originalEvent._stopped=!0:v.cancelBubble=!0,this}function fu(v){return bc(v,"wheel",Ui),this}function Ul(v){return Xn(v,"mousedown touchstart dblclick contextmenu",Ui),v._leaflet_disable_click=!0,this}function mr(v){return v.preventDefault?v.preventDefault():v.returnValue=!1,this}function ia(v){return mr(v),Ui(v),this}function wc(v){if(v.composedPath)return v.composedPath();for(var I=[],D=v.target;D;)I.push(D),D=D.parentNode;return I}function pu(v,I){if(!I)return new Ae(v.clientX,v.clientY);var D=Pa(I),$=D.boundingClientRect;return new Ae((v.clientX-$.left)/D.x-I.clientLeft,(v.clientY-$.top)/D.y-I.clientTop)}var Mo=hn.linux&&hn.chrome?window.devicePixelRatio:hn.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function mu(v){return hn.edge?v.wheelDeltaY/2:v.deltaY&&v.deltaMode===0?-v.deltaY/Mo:v.deltaY&&v.deltaMode===1?-v.deltaY*20:v.deltaY&&v.deltaMode===2?-v.deltaY*60:v.deltaX||v.deltaZ?0:v.wheelDelta?(v.wheelDeltaY||v.wheelDelta)/2:v.detail&&Math.abs(v.detail)<32765?-v.detail*20:v.detail?v.detail/-32765*60:0}function gu(v,I){var D=I.relatedTarget;if(!D)return!0;try{for(;D&&D!==v;)D=D.parentNode}catch{return!1}return D!==v}var Cc={__proto__:null,on:Xn,off:ki,stopPropagation:Ui,disableScrollPropagation:fu,disableClickPropagation:Ul,preventDefault:mr,stop:ia,getPropagationPath:wc,getMousePosition:pu,getWheelDelta:mu,isExternalTarget:gu,addListener:Xn,removeListener:ki},Th=Ne.extend({run:function(v,I,D,$){this.stop(),this._el=v,this._inProgress=!0,this._duration=D||.25,this._easeOutPower=1/Math.max($||.5,.2),this._startPos=Vi(v),this._offset=I.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ee(this._animate,this),this._step()},_step:function(v){var I=+new Date-this._startTime,D=this._duration*1e3;I<D?this._runFrame(this._easeOut(I/D),v):(this._runFrame(1),this._complete())},_runFrame:function(v,I){var D=this._startPos.add(this._offset.multiplyBy(v));I&&D._round(),Nn(this._el,D),this.fire("step")},_complete:function(){de(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(v){return 1-Math.pow(1-v,this._easeOutPower)}}),ui=Ne.extend({options:{crs:yt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(v,I){I=R(this,I),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(v),this._initLayout(),this._onResize=u(this._onResize,this),this._initEvents(),I.maxBounds&&this.setMaxBounds(I.maxBounds),I.zoom!==void 0&&(this._zoom=this._limitZoom(I.zoom)),I.center&&I.zoom!==void 0&&this.setView(Rt(I.center),I.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=on&&hn.any3d&&!hn.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Xn(this._proxy,dn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(v,I,D){if(I=I===void 0?this._zoom:this._limitZoom(I),v=this._limitCenter(Rt(v),I,this.options.maxBounds),D=D||{},this._stop(),this._loaded&&!D.reset&&D!==!0){D.animate!==void 0&&(D.zoom=s({animate:D.animate},D.zoom),D.pan=s({animate:D.animate,duration:D.duration},D.pan));var $=this._zoom!==I?this._tryAnimatedZoom&&this._tryAnimatedZoom(v,I,D.zoom):this._tryAnimatedPan(v,D.pan);if($)return clearTimeout(this._sizeTimer),this}return this._resetView(v,I,D.pan&&D.pan.noMoveStart),this},setZoom:function(v,I){return this._loaded?this.setView(this.getCenter(),v,{zoom:I}):(this._zoom=v,this)},zoomIn:function(v,I){return v=v||(hn.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+v,I)},zoomOut:function(v,I){return v=v||(hn.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-v,I)},setZoomAround:function(v,I,D){var $=this.getZoomScale(I),ie=this.getSize().divideBy(2),fe=v instanceof Ae?v:this.latLngToContainerPoint(v),_e=fe.subtract(ie).multiplyBy(1-1/$),je=this.containerPointToLatLng(ie.add(_e));return this.setView(je,I,{zoom:D})},_getBoundsCenterZoom:function(v,I){I=I||{},v=v.getBounds?v.getBounds():xt(v);var D=Ie(I.paddingTopLeft||I.padding||[0,0]),$=Ie(I.paddingBottomRight||I.padding||[0,0]),ie=this.getBoundsZoom(v,!1,D.add($));if(ie=typeof I.maxZoom=="number"?Math.min(I.maxZoom,ie):ie,ie===1/0)return{center:v.getCenter(),zoom:ie};var fe=$.subtract(D).divideBy(2),_e=this.project(v.getSouthWest(),ie),je=this.project(v.getNorthEast(),ie),Je=this.unproject(_e.add(je).divideBy(2).add(fe),ie);return{center:Je,zoom:ie}},fitBounds:function(v,I){if(v=xt(v),!v.isValid())throw new Error("Bounds are not valid.");var D=this._getBoundsCenterZoom(v,I);return this.setView(D.center,D.zoom,I)},fitWorld:function(v){return this.fitBounds([[-90,-180],[90,180]],v)},panTo:function(v,I){return this.setView(v,this._zoom,{pan:I})},panBy:function(v,I){if(v=Ie(v).round(),I=I||{},!v.x&&!v.y)return this.fire("moveend");if(I.animate!==!0&&!this.getSize().contains(v))return this._resetView(this.unproject(this.project(this.getCenter()).add(v)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Th,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),I.noMoveStart||this.fire("movestart"),I.animate!==!1){Ht(this._mapPane,"leaflet-pan-anim");var D=this._getMapPanePos().subtract(v).round();this._panAnim.run(this._mapPane,D,I.duration||.25,I.easeLinearity)}else this._rawPanBy(v),this.fire("move").fire("moveend");return this},flyTo:function(v,I,D){if(D=D||{},D.animate===!1||!hn.any3d)return this.setView(v,I,D);this._stop();var $=this.project(this.getCenter()),ie=this.project(v),fe=this.getSize(),_e=this._zoom;v=Rt(v),I=I===void 0?_e:I;var je=Math.max(fe.x,fe.y),Je=je*this.getZoomScale(_e,I),Ct=ie.distanceTo($)||1,yn=1.42,On=yn*yn;function gi(Gr){var w0=Gr?-1:1,lM=Gr?Je:je,cM=Je*Je-je*je+w0*On*On*Ct*Ct,uM=2*lM*On*Ct,C0=cM/uM,cf=Math.sqrt(C0*C0+1)-C0,mv=cf<1e-9?-18:Math.log(cf);return mv}function uo(Gr){return(Math.exp(Gr)-Math.exp(-Gr))/2}function ms(Gr){return(Math.exp(Gr)+Math.exp(-Gr))/2}function Oa(Gr){return uo(Gr)/ms(Gr)}var Br=gi(0);function lf(Gr){return je*(ms(Br)/ms(Br+yn*Gr))}function Uh(Gr){return je*(ms(Br)*Oa(Br+yn*Gr)-uo(Br))/On}function ho(Gr){return 1-Math.pow(1-Gr,1.5)}var Tu=Date.now(),Tc=(gi(1)-Br)/yn,Va=D.duration?1e3*D.duration:1e3*Tc*.8;function Mu(){var Gr=(Date.now()-Tu)/Va,w0=ho(Gr)*Tc;Gr<=1?(this._flyToFrame=ee(Mu,this),this._move(this.unproject($.add(ie.subtract($).multiplyBy(Uh(w0)/Ct)),_e),this.getScaleZoom(je/lf(w0),_e),{flyTo:!0})):this._move(v,I)._moveEnd(!0)}return this._moveStart(!0,D.noMoveStart),Mu.call(this),this},flyToBounds:function(v,I){var D=this._getBoundsCenterZoom(v,I);return this.flyTo(D.center,D.zoom,I)},setMaxBounds:function(v){return v=xt(v),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),v.isValid()?(this.options.maxBounds=v,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(v){var I=this.options.minZoom;return this.options.minZoom=v,this._loaded&&I!==v&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(v):this},setMaxZoom:function(v){var I=this.options.maxZoom;return this.options.maxZoom=v,this._loaded&&I!==v&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(v):this},panInsideBounds:function(v,I){this._enforcingBounds=!0;var D=this.getCenter(),$=this._limitCenter(D,this._zoom,xt(v));return D.equals($)||this.panTo($,I),this._enforcingBounds=!1,this},panInside:function(v,I){I=I||{};var D=Ie(I.paddingTopLeft||I.padding||[0,0]),$=Ie(I.paddingBottomRight||I.padding||[0,0]),ie=this.project(this.getCenter()),fe=this.project(v),_e=this.getPixelBounds(),je=dt([_e.min.add(D),_e.max.subtract($)]),Je=je.getSize();if(!je.contains(fe)){this._enforcingBounds=!0;var Ct=fe.subtract(je.getCenter()),yn=je.extend(fe).getSize().subtract(Je);ie.x+=Ct.x<0?-yn.x:yn.x,ie.y+=Ct.y<0?-yn.y:yn.y,this.panTo(this.unproject(ie),I),this._enforcingBounds=!1}return this},invalidateSize:function(v){if(!this._loaded)return this;v=s({animate:!1,pan:!0},v===!0?{animate:!0}:v);var I=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var D=this.getSize(),$=I.divideBy(2).round(),ie=D.divideBy(2).round(),fe=$.subtract(ie);return!fe.x&&!fe.y?this:(v.animate&&v.pan?this.panBy(fe):(v.pan&&this._rawPanBy(fe),this.fire("move"),v.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(u(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:I,newSize:D}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(v){if(v=this._locateOptions=s({timeout:1e4,watch:!1},v),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var I=u(this._handleGeolocationResponse,this),D=u(this._handleGeolocationError,this);return v.watch?this._locationWatchId=navigator.geolocation.watchPosition(I,D,v):navigator.geolocation.getCurrentPosition(I,D,v),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(v){if(this._container._leaflet_id){var I=v.code,D=v.message||(I===1?"permission denied":I===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:I,message:"Geolocation error: "+D+"."})}},_handleGeolocationResponse:function(v){if(this._container._leaflet_id){var I=v.coords.latitude,D=v.coords.longitude,$=new At(I,D),ie=$.toBounds(v.coords.accuracy*2),fe=this._locateOptions;if(fe.setView){var _e=this.getBoundsZoom(ie);this.setView($,fe.maxZoom?Math.min(_e,fe.maxZoom):_e)}var je={latlng:$,bounds:ie,timestamp:v.timestamp};for(var Je in v.coords)typeof v.coords[Je]=="number"&&(je[Je]=v.coords[Je]);this.fire("locationfound",je)}},addHandler:function(v,I){if(!I)return this;var D=this[v]=new I(this);return this._handlers.push(D),this.options[v]&&D.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),gn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(de(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var v;for(v in this._layers)this._layers[v].remove();for(v in this._panes)gn(this._panes[v]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(v,I){var D="leaflet-pane"+(v?" leaflet-"+v.replace("Pane","")+"-pane":""),$=zt("div",D,I||this._mapPane);return v&&(this._panes[v]=$),$},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var v=this.getPixelBounds(),I=this.unproject(v.getBottomLeft()),D=this.unproject(v.getTopRight());return new Wt(I,D)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(v,I,D){v=xt(v),D=Ie(D||[0,0]);var $=this.getZoom()||0,ie=this.getMinZoom(),fe=this.getMaxZoom(),_e=v.getNorthWest(),je=v.getSouthEast(),Je=this.getSize().subtract(D),Ct=dt(this.project(je,$),this.project(_e,$)).getSize(),yn=hn.any3d?this.options.zoomSnap:1,On=Je.x/Ct.x,gi=Je.y/Ct.y,uo=I?Math.max(On,gi):Math.min(On,gi);return $=this.getScaleZoom(uo,$),yn&&($=Math.round($/(yn/100))*(yn/100),$=I?Math.ceil($/yn)*yn:Math.floor($/yn)*yn),Math.max(ie,Math.min(fe,$))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ae(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(v,I){var D=this._getTopLeftPoint(v,I);return new qe(D,D.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(v){return this.options.crs.getProjectedBounds(v===void 0?this.getZoom():v)},getPane:function(v){return typeof v=="string"?this._panes[v]:v},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(v,I){var D=this.options.crs;return I=I===void 0?this._zoom:I,D.scale(v)/D.scale(I)},getScaleZoom:function(v,I){var D=this.options.crs;I=I===void 0?this._zoom:I;var $=D.zoom(v*D.scale(I));return isNaN($)?1/0:$},project:function(v,I){return I=I===void 0?this._zoom:I,this.options.crs.latLngToPoint(Rt(v),I)},unproject:function(v,I){return I=I===void 0?this._zoom:I,this.options.crs.pointToLatLng(Ie(v),I)},layerPointToLatLng:function(v){var I=Ie(v).add(this.getPixelOrigin());return this.unproject(I)},latLngToLayerPoint:function(v){var I=this.project(Rt(v))._round();return I._subtract(this.getPixelOrigin())},wrapLatLng:function(v){return this.options.crs.wrapLatLng(Rt(v))},wrapLatLngBounds:function(v){return this.options.crs.wrapLatLngBounds(xt(v))},distance:function(v,I){return this.options.crs.distance(Rt(v),Rt(I))},containerPointToLayerPoint:function(v){return Ie(v).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(v){return Ie(v).add(this._getMapPanePos())},containerPointToLatLng:function(v){var I=this.containerPointToLayerPoint(Ie(v));return this.layerPointToLatLng(I)},latLngToContainerPoint:function(v){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Rt(v)))},mouseEventToContainerPoint:function(v){return pu(v,this._container)},mouseEventToLayerPoint:function(v){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(v))},mouseEventToLatLng:function(v){return this.layerPointToLatLng(this.mouseEventToLayerPoint(v))},_initContainer:function(v){var I=this._container=Ln(v);if(I){if(I._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Xn(I,"scroll",this._onScroll,this),this._containerId=p(I)},_initLayout:function(){var v=this._container;this._fadeAnimated=this.options.fadeAnimation&&hn.any3d,Ht(v,"leaflet-container"+(hn.touch?" leaflet-touch":"")+(hn.retina?" leaflet-retina":"")+(hn.ielt9?" leaflet-oldie":"")+(hn.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var I=Sn(v,"position");I!=="absolute"&&I!=="relative"&&I!=="fixed"&&I!=="sticky"&&(v.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var v=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Nn(this._mapPane,new Ae(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ht(v.markerPane,"leaflet-zoom-hide"),Ht(v.shadowPane,"leaflet-zoom-hide"))},_resetView:function(v,I,D){Nn(this._mapPane,new Ae(0,0));var $=!this._loaded;this._loaded=!0,I=this._limitZoom(I),this.fire("viewprereset");var ie=this._zoom!==I;this._moveStart(ie,D)._move(v,I)._moveEnd(ie),this.fire("viewreset"),$&&this.fire("load")},_moveStart:function(v,I){return v&&this.fire("zoomstart"),I||this.fire("movestart"),this},_move:function(v,I,D,$){I===void 0&&(I=this._zoom);var ie=this._zoom!==I;return this._zoom=I,this._lastCenter=v,this._pixelOrigin=this._getNewPixelOrigin(v),$?D&&D.pinch&&this.fire("zoom",D):((ie||D&&D.pinch)&&this.fire("zoom",D),this.fire("move",D)),this},_moveEnd:function(v){return v&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return de(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(v){Nn(this._mapPane,this._getMapPanePos().subtract(v))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(v){this._targets={},this._targets[p(this._container)]=this;var I=v?ki:Xn;I(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&I(window,"resize",this._onResize,this),hn.any3d&&this.options.transform3DLimit&&(v?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){de(this._resizeRequest),this._resizeRequest=ee(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var v=this._getMapPanePos();Math.max(Math.abs(v.x),Math.abs(v.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(v,I){for(var D=[],$,ie=I==="mouseout"||I==="mouseover",fe=v.target||v.srcElement,_e=!1;fe;){if($=this._targets[p(fe)],$&&(I==="click"||I==="preclick")&&this._draggableMoved($)){_e=!0;break}if($&&$.listens(I,!0)&&(ie&&!gu(fe,v)||(D.push($),ie))||fe===this._container)break;fe=fe.parentNode}return!D.length&&!_e&&!ie&&this.listens(I,!0)&&(D=[this]),D},_isClickDisabled:function(v){for(;v&&v!==this._container;){if(v._leaflet_disable_click)return!0;v=v.parentNode}},_handleDOMEvent:function(v){var I=v.target||v.srcElement;if(!(!this._loaded||I._leaflet_disable_events||v.type==="click"&&this._isClickDisabled(I))){var D=v.type;D==="mousedown"&&du(I),this._fireDOMEvent(v,D)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(v,I,D){if(v.type==="click"){var $=s({},v);$.type="preclick",this._fireDOMEvent($,$.type,D)}var ie=this._findEventTargets(v,I);if(D){for(var fe=[],_e=0;_e<D.length;_e++)D[_e].listens(I,!0)&&fe.push(D[_e]);ie=fe.concat(ie)}if(ie.length){I==="contextmenu"&&mr(v);var je=ie[0],Je={originalEvent:v};if(v.type!=="keypress"&&v.type!=="keydown"&&v.type!=="keyup"){var Ct=je.getLatLng&&(!je._radius||je._radius<=10);Je.containerPoint=Ct?this.latLngToContainerPoint(je.getLatLng()):this.mouseEventToContainerPoint(v),Je.layerPoint=this.containerPointToLayerPoint(Je.containerPoint),Je.latlng=Ct?je.getLatLng():this.layerPointToLatLng(Je.layerPoint)}for(_e=0;_e<ie.length;_e++)if(ie[_e].fire(I,Je,!0),Je.originalEvent._stopped||ie[_e].options.bubblingMouseEvents===!1&&G(this._mouseEvents,I)!==-1)return}},_draggableMoved:function(v){return v=v.dragging&&v.dragging.enabled()?v:this,v.dragging&&v.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var v=0,I=this._handlers.length;v<I;v++)this._handlers[v].disable()},whenReady:function(v,I){return this._loaded?v.call(I||this,{target:this}):this.on("load",v,I),this},_getMapPanePos:function(){return Vi(this._mapPane)||new Ae(0,0)},_moved:function(){var v=this._getMapPanePos();return v&&!v.equals([0,0])},_getTopLeftPoint:function(v,I){var D=v&&I!==void 0?this._getNewPixelOrigin(v,I):this.getPixelOrigin();return D.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(v,I){var D=this.getSize()._divideBy(2);return this.project(v,I)._subtract(D)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(v,I,D){var $=this._getNewPixelOrigin(D,I);return this.project(v,I)._subtract($)},_latLngBoundsToNewLayerBounds:function(v,I,D){var $=this._getNewPixelOrigin(D,I);return dt([this.project(v.getSouthWest(),I)._subtract($),this.project(v.getNorthWest(),I)._subtract($),this.project(v.getSouthEast(),I)._subtract($),this.project(v.getNorthEast(),I)._subtract($)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(v){return this.latLngToLayerPoint(v).subtract(this._getCenterLayerPoint())},_limitCenter:function(v,I,D){if(!D)return v;var $=this.project(v,I),ie=this.getSize().divideBy(2),fe=new qe($.subtract(ie),$.add(ie)),_e=this._getBoundsOffset(fe,D,I);return Math.abs(_e.x)<=1&&Math.abs(_e.y)<=1?v:this.unproject($.add(_e),I)},_limitOffset:function(v,I){if(!I)return v;var D=this.getPixelBounds(),$=new qe(D.min.add(v),D.max.add(v));return v.add(this._getBoundsOffset($,I))},_getBoundsOffset:function(v,I,D){var $=dt(this.project(I.getNorthEast(),D),this.project(I.getSouthWest(),D)),ie=$.min.subtract(v.min),fe=$.max.subtract(v.max),_e=this._rebound(ie.x,-fe.x),je=this._rebound(ie.y,-fe.y);return new Ae(_e,je)},_rebound:function(v,I){return v+I>0?Math.round(v-I)/2:Math.max(0,Math.ceil(v))-Math.max(0,Math.floor(I))},_limitZoom:function(v){var I=this.getMinZoom(),D=this.getMaxZoom(),$=hn.any3d?this.options.zoomSnap:1;return $&&(v=Math.round(v/$)*$),Math.max(I,Math.min(D,v))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){jt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(v,I){var D=this._getCenterOffset(v)._trunc();return(I&&I.animate)!==!0&&!this.getSize().contains(D)?!1:(this.panBy(D,I),!0)},_createAnimProxy:function(){var v=this._proxy=zt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(v),this.on("zoomanim",function(I){var D=Kt,$=this._proxy.style[D];ds(this._proxy,this.project(I.center,I.zoom),this.getZoomScale(I.zoom,1)),$===this._proxy.style[D]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){gn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var v=this.getCenter(),I=this.getZoom();ds(this._proxy,this.project(v,I),this.getZoomScale(I,1))},_catchTransitionEnd:function(v){this._animatingZoom&&v.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(v,I,D){if(this._animatingZoom)return!0;if(D=D||{},!this._zoomAnimated||D.animate===!1||this._nothingToAnimate()||Math.abs(I-this._zoom)>this.options.zoomAnimationThreshold)return!1;var $=this.getZoomScale(I),ie=this._getCenterOffset(v)._divideBy(1-1/$);return D.animate!==!0&&!this.getSize().contains(ie)?!1:(ee(function(){this._moveStart(!0,D.noMoveStart||!1)._animateZoom(v,I,!0)},this),!0)},_animateZoom:function(v,I,D,$){this._mapPane&&(D&&(this._animatingZoom=!0,this._animateToCenter=v,this._animateToZoom=I,Ht(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:v,zoom:I,noUpdate:$}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(u(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&jt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ec(v,I){return new ui(v,I)}var Rs=we.extend({options:{position:"topright"},initialize:function(v){R(this,v)},getPosition:function(){return this.options.position},setPosition:function(v){var I=this._map;return I&&I.removeControl(this),this.options.position=v,I&&I.addControl(this),this},getContainer:function(){return this._container},addTo:function(v){this.remove(),this._map=v;var I=this._container=this.onAdd(v),D=this.getPosition(),$=v._controlCorners[D];return Ht(I,"leaflet-control"),D.indexOf("bottom")!==-1?$.insertBefore(I,$.firstChild):$.appendChild(I),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(gn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(v){this._map&&v&&v.screenX>0&&v.screenY>0&&this._map.getContainer().focus()}}),ra=function(v){return new Rs(v)};ui.include({addControl:function(v){return v.addTo(this),this},removeControl:function(v){return v.remove(),this},_initControlPos:function(){var v=this._controlCorners={},I="leaflet-",D=this._controlContainer=zt("div",I+"control-container",this._container);function $(ie,fe){var _e=I+ie+" "+I+fe;v[ie+fe]=zt("div",_e,D)}$("top","left"),$("top","right"),$("bottom","left"),$("bottom","right")},_clearControlPos:function(){for(var v in this._controlCorners)gn(this._controlCorners[v]);gn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Mh=Rs.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(v,I,D,$){return D<$?-1:$<D?1:0}},initialize:function(v,I,D){R(this,D),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var $ in v)this._addLayer(v[$],$);for($ in I)this._addLayer(I[$],$,!0)},onAdd:function(v){this._initLayout(),this._update(),this._map=v,v.on("zoomend",this._checkDisabledLayers,this);for(var I=0;I<this._layers.length;I++)this._layers[I].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(v){return Rs.prototype.addTo.call(this,v),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var v=0;v<this._layers.length;v++)this._layers[v].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(v,I){return this._addLayer(v,I),this._map?this._update():this},addOverlay:function(v,I){return this._addLayer(v,I,!0),this._map?this._update():this},removeLayer:function(v){v.off("add remove",this._onLayerChange,this);var I=this._getLayer(p(v));return I&&this._layers.splice(this._layers.indexOf(I),1),this._map?this._update():this},expand:function(){Ht(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var v=this._map.getSize().y-(this._container.offsetTop+50);return v<this._section.clientHeight?(Ht(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=v+"px"):jt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return jt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var v="leaflet-control-layers",I=this._container=zt("div",v),D=this.options.collapsed;I.setAttribute("aria-haspopup",!0),Ul(I),fu(I);var $=this._section=zt("section",v+"-list");D&&(this._map.on("click",this.collapse,this),Xn(I,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ie=this._layersLink=zt("a",v+"-toggle",I);ie.href="#",ie.title="Layers",ie.setAttribute("role","button"),Xn(ie,{keydown:function(fe){fe.keyCode===13&&this._expandSafely()},click:function(fe){mr(fe),this._expandSafely()}},this),D||this.expand(),this._baseLayersList=zt("div",v+"-base",$),this._separator=zt("div",v+"-separator",$),this._overlaysList=zt("div",v+"-overlays",$),I.appendChild($)},_getLayer:function(v){for(var I=0;I<this._layers.length;I++)if(this._layers[I]&&p(this._layers[I].layer)===v)return this._layers[I]},_addLayer:function(v,I,D){this._map&&v.on("add remove",this._onLayerChange,this),this._layers.push({layer:v,name:I,overlay:D}),this.options.sortLayers&&this._layers.sort(u(function($,ie){return this.options.sortFunction($.layer,ie.layer,$.name,ie.name)},this)),this.options.autoZIndex&&v.setZIndex&&(this._lastZIndex++,v.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Hn(this._baseLayersList),Hn(this._overlaysList),this._layerControlInputs=[];var v,I,D,$,ie=0;for(D=0;D<this._layers.length;D++)$=this._layers[D],this._addItem($),I=I||$.overlay,v=v||!$.overlay,ie+=$.overlay?0:1;return this.options.hideSingleBase&&(v=v&&ie>1,this._baseLayersList.style.display=v?"":"none"),this._separator.style.display=I&&v?"":"none",this},_onLayerChange:function(v){this._handlingClick||this._update();var I=this._getLayer(p(v.target)),D=I.overlay?v.type==="add"?"overlayadd":"overlayremove":v.type==="add"?"baselayerchange":null;D&&this._map.fire(D,I)},_createRadioElement:function(v,I){var D='<input type="radio" class="leaflet-control-layers-selector" name="'+v+'"'+(I?' checked="checked"':"")+"/>",$=document.createElement("div");return $.innerHTML=D,$.firstChild},_addItem:function(v){var I=document.createElement("label"),D=this._map.hasLayer(v.layer),$;v.overlay?($=document.createElement("input"),$.type="checkbox",$.className="leaflet-control-layers-selector",$.defaultChecked=D):$=this._createRadioElement("leaflet-base-layers_"+p(this),D),this._layerControlInputs.push($),$.layerId=p(v.layer),Xn($,"click",this._onInputClick,this);var ie=document.createElement("span");ie.innerHTML=" "+v.name;var fe=document.createElement("span");I.appendChild(fe),fe.appendChild($),fe.appendChild(ie);var _e=v.overlay?this._overlaysList:this._baseLayersList;return _e.appendChild(I),this._checkDisabledLayers(),I},_onInputClick:function(){if(!this._preventClick){var v=this._layerControlInputs,I,D,$=[],ie=[];this._handlingClick=!0;for(var fe=v.length-1;fe>=0;fe--)I=v[fe],D=this._getLayer(I.layerId).layer,I.checked?$.push(D):I.checked||ie.push(D);for(fe=0;fe<ie.length;fe++)this._map.hasLayer(ie[fe])&&this._map.removeLayer(ie[fe]);for(fe=0;fe<$.length;fe++)this._map.hasLayer($[fe])||this._map.addLayer($[fe]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var v=this._layerControlInputs,I,D,$=this._map.getZoom(),ie=v.length-1;ie>=0;ie--)I=v[ie],D=this._getLayer(I.layerId).layer,I.disabled=D.options.minZoom!==void 0&&$<D.options.minZoom||D.options.maxZoom!==void 0&&$>D.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var v=this._section;this._preventClick=!0,Xn(v,"click",mr),this.expand();var I=this;setTimeout(function(){ki(v,"click",mr),I._preventClick=!1})}}),yu=function(v,I,D){return new Mh(v,I,D)},Na=Rs.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(v){var I="leaflet-control-zoom",D=zt("div",I+" leaflet-bar"),$=this.options;return this._zoomInButton=this._createButton($.zoomInText,$.zoomInTitle,I+"-in",D,this._zoomIn),this._zoomOutButton=this._createButton($.zoomOutText,$.zoomOutTitle,I+"-out",D,this._zoomOut),this._updateDisabled(),v.on("zoomend zoomlevelschange",this._updateDisabled,this),D},onRemove:function(v){v.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(v){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(v.shiftKey?3:1))},_zoomOut:function(v){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(v.shiftKey?3:1))},_createButton:function(v,I,D,$,ie){var fe=zt("a",D,$);return fe.innerHTML=v,fe.href="#",fe.title=I,fe.setAttribute("role","button"),fe.setAttribute("aria-label",I),Ul(fe),Xn(fe,"click",ia),Xn(fe,"click",ie,this),Xn(fe,"click",this._refocusOnMap,this),fe},_updateDisabled:function(){var v=this._map,I="leaflet-disabled";jt(this._zoomInButton,I),jt(this._zoomOutButton,I),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||v._zoom===v.getMinZoom())&&(Ht(this._zoomOutButton,I),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||v._zoom===v.getMaxZoom())&&(Ht(this._zoomInButton,I),this._zoomInButton.setAttribute("aria-disabled","true"))}});ui.mergeOptions({zoomControl:!0}),ui.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Na,this.addControl(this.zoomControl))});var kh=function(v){return new Na(v)},jd=Rs.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(v){var I="leaflet-control-scale",D=zt("div",I),$=this.options;return this._addScales($,I+"-line",D),v.on($.updateWhenIdle?"moveend":"move",this._update,this),v.whenReady(this._update,this),D},onRemove:function(v){v.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(v,I,D){v.metric&&(this._mScale=zt("div",I,D)),v.imperial&&(this._iScale=zt("div",I,D))},_update:function(){var v=this._map,I=v.getSize().y/2,D=v.distance(v.containerPointToLatLng([0,I]),v.containerPointToLatLng([this.options.maxWidth,I]));this._updateScales(D)},_updateScales:function(v){this.options.metric&&v&&this._updateMetric(v),this.options.imperial&&v&&this._updateImperial(v)},_updateMetric:function(v){var I=this._getRoundNum(v),D=I<1e3?I+" m":I/1e3+" km";this._updateScale(this._mScale,D,I/v)},_updateImperial:function(v){var I=v*3.2808399,D,$,ie;I>5280?(D=I/5280,$=this._getRoundNum(D),this._updateScale(this._iScale,$+" mi",$/D)):(ie=this._getRoundNum(I),this._updateScale(this._iScale,ie+" ft",ie/I))},_updateScale:function(v,I,D){v.style.width=Math.round(this.options.maxWidth*D)+"px",v.innerHTML=I},_getRoundNum:function(v){var I=Math.pow(10,(Math.floor(v)+"").length-1),D=v/I;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:1,I*D}}),Yd=function(v){return new jd(v)},qd='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Au=Rs.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(hn.inlineSvg?qd+" ":"")+"Leaflet</a>"},initialize:function(v){R(this,v),this._attributions={}},onAdd:function(v){v.attributionControl=this,this._container=zt("div","leaflet-control-attribution"),Ul(this._container);for(var I in v._layers)v._layers[I].getAttribution&&this.addAttribution(v._layers[I].getAttribution());return this._update(),v.on("layeradd",this._addAttribution,this),this._container},onRemove:function(v){v.off("layeradd",this._addAttribution,this)},_addAttribution:function(v){v.layer.getAttribution&&(this.addAttribution(v.layer.getAttribution()),v.layer.once("remove",function(){this.removeAttribution(v.layer.getAttribution())},this))},setPrefix:function(v){return this.options.prefix=v,this._update(),this},addAttribution:function(v){return v?(this._attributions[v]||(this._attributions[v]=0),this._attributions[v]++,this._update(),this):this},removeAttribution:function(v){return v?(this._attributions[v]&&(this._attributions[v]--,this._update()),this):this},_update:function(){if(this._map){var v=[];for(var I in this._attributions)this._attributions[I]&&v.push(I);var D=[];this.options.prefix&&D.push(this.options.prefix),v.length&&D.push(v.join(", ")),this._container.innerHTML=D.join(' <span aria-hidden="true">|</span> ')}}});ui.mergeOptions({attributionControl:!0}),ui.addInitHook(function(){this.options.attributionControl&&new Au().addTo(this)});var vu=function(v){return new Au(v)};Rs.Layers=Mh,Rs.Zoom=Na,Rs.Scale=jd,Rs.Attribution=Au,ra.layers=yu,ra.zoom=kh,ra.scale=Yd,ra.attribution=vu;var Ls=we.extend({initialize:function(v){this._map=v},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ls.addTo=function(v,I){return v.addHandler(I,this),this};var bu={Events:Me},sa=hn.touch?"touchstart mousedown":"mousedown",ko=Ne.extend({options:{clickTolerance:3},initialize:function(v,I,D,$){R(this,$),this._element=v,this._dragStartTarget=I||v,this._preventOutline=D},enable:function(){this._enabled||(Xn(this._dragStartTarget,sa,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ko._dragging===this&&this.finishDrag(!0),ki(this._dragStartTarget,sa,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(v){if(this._enabled&&(this._moved=!1,!Yn(this._element,"leaflet-zoom-anim"))){if(v.touches&&v.touches.length!==1){ko._dragging===this&&this.finishDrag();return}if(!(ko._dragging||v.shiftKey||v.which!==1&&v.button!==1&&!v.touches)&&(ko._dragging=this,this._preventOutline&&du(this._element),Ba(),pr(),!this._moving)){this.fire("down");var I=v.touches?v.touches[0]:v,D=Sh(this._element);this._startPoint=new Ae(I.clientX,I.clientY),this._startPos=Vi(this._element),this._parentScale=Pa(D);var $=v.type==="mousedown";Xn(document,$?"mousemove":"touchmove",this._onMove,this),Xn(document,$?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(v){if(this._enabled){if(v.touches&&v.touches.length>1){this._moved=!0;return}var I=v.touches&&v.touches.length===1?v.touches[0]:v,D=new Ae(I.clientX,I.clientY)._subtract(this._startPoint);!D.x&&!D.y||Math.abs(D.x)+Math.abs(D.y)<this.options.clickTolerance||(D.x/=this._parentScale.x,D.y/=this._parentScale.y,mr(v),this._moved||(this.fire("dragstart"),this._moved=!0,Ht(document.body,"leaflet-dragging"),this._lastTarget=v.target||v.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ht(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(D),this._moving=!0,this._lastEvent=v,this._updatePosition())}},_updatePosition:function(){var v={originalEvent:this._lastEvent};this.fire("predrag",v),Nn(this._element,this._newPos),this.fire("drag",v)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(v){jt(document.body,"leaflet-dragging"),this._lastTarget&&(jt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),ki(document,"mousemove touchmove",this._onMove,this),ki(document,"mouseup touchend touchcancel",this._onUp,this),Ih(),mi();var I=this._moved&&this._moving;this._moving=!1,ko._dragging=!1,I&&this.fire("dragend",{noInertia:v,distance:this._newPos.distanceTo(this._startPos)})}});function Rh(v,I,D){var $,ie=[1,4,2,8],fe,_e,je,Je,Ct,yn,On,gi;for(fe=0,yn=v.length;fe<yn;fe++)v[fe]._code=it(v[fe],I);for(je=0;je<4;je++){for(On=ie[je],$=[],fe=0,yn=v.length,_e=yn-1;fe<yn;_e=fe++)Je=v[fe],Ct=v[_e],Je._code&On?Ct._code&On||(gi=Ke(Ct,Je,On,I,D),gi._code=it(gi,I),$.push(gi)):(Ct._code&On&&(gi=Ke(Ct,Je,On,I,D),gi._code=it(gi,I),$.push(gi)),$.push(Je));v=$}return v}function xu(v,I){var D,$,ie,fe,_e,je,Je,Ct,yn;if(!v||v.length===0)throw new Error("latlngs not passed");xi(v)||(console.warn("latlngs are not flat! Only the first ring will be used"),v=v[0]);var On=Rt([0,0]),gi=xt(v),uo=gi.getNorthWest().distanceTo(gi.getSouthWest())*gi.getNorthEast().distanceTo(gi.getNorthWest());uo<1700&&(On=wu(v));var ms=v.length,Oa=[];for(D=0;D<ms;D++){var Br=Rt(v[D]);Oa.push(I.project(Rt([Br.lat-On.lat,Br.lng-On.lng])))}for(je=Je=Ct=0,D=0,$=ms-1;D<ms;$=D++)ie=Oa[D],fe=Oa[$],_e=ie.y*fe.x-fe.y*ie.x,Je+=(ie.x+fe.x)*_e,Ct+=(ie.y+fe.y)*_e,je+=_e*3;je===0?yn=Oa[0]:yn=[Je/je,Ct/je];var lf=I.unproject(Ie(yn));return Rt([lf.lat+On.lat,lf.lng+On.lng])}function wu(v){for(var I=0,D=0,$=0,ie=0;ie<v.length;ie++){var fe=Rt(v[ie]);I+=fe.lat,D+=fe.lng,$++}return Rt([I/$,D/$])}var zl={__proto__:null,clipPolygon:Rh,polygonCenter:xu,centroid:wu};function es(v,I){if(!I||!v.length)return v.slice();var D=I*I;return v=J(v,D),v=Ic(v,D),v}function _c(v,I,D){return Math.sqrt(zn(v,I,D,!0))}function Cu(v,I,D){return zn(v,I,D)}function Ic(v,I){var D=v.length,$=typeof Uint8Array<"u"?Uint8Array:Array,ie=new $(D);ie[0]=ie[D-1]=1,N(v,ie,I,0,D-1);var fe,_e=[];for(fe=0;fe<D;fe++)ie[fe]&&_e.push(v[fe]);return _e}function N(v,I,D,$,ie){var fe=0,_e,je,Je;for(je=$+1;je<=ie-1;je++)Je=zn(v[je],v[$],v[ie],!0),Je>fe&&(_e=je,fe=Je);fe>D&&(I[_e]=1,N(v,I,D,$,_e),N(v,I,D,_e,ie))}function J(v,I){for(var D=[v[0]],$=1,ie=0,fe=v.length;$<fe;$++)Xt(v[$],v[ie])>I&&(D.push(v[$]),ie=$);return ie<fe-1&&D.push(v[fe-1]),D}var ae;function me(v,I,D,$,ie){var fe=$?ae:it(v,D),_e=it(I,D),je,Je,Ct;for(ae=_e;;){if(!(fe|_e))return[v,I];if(fe&_e)return!1;je=fe||_e,Je=Ke(v,I,je,D,ie),Ct=it(Je,D),je===fe?(v=Je,fe=Ct):(I=Je,_e=Ct)}}function Ke(v,I,D,$,ie){var fe=I.x-v.x,_e=I.y-v.y,je=$.min,Je=$.max,Ct,yn;return D&8?(Ct=v.x+fe*(Je.y-v.y)/_e,yn=Je.y):D&4?(Ct=v.x+fe*(je.y-v.y)/_e,yn=je.y):D&2?(Ct=Je.x,yn=v.y+_e*(Je.x-v.x)/fe):D&1&&(Ct=je.x,yn=v.y+_e*(je.x-v.x)/fe),new Ae(Ct,yn,ie)}function it(v,I){var D=0;return v.x<I.min.x?D|=1:v.x>I.max.x&&(D|=2),v.y<I.min.y?D|=4:v.y>I.max.y&&(D|=8),D}function Xt(v,I){var D=I.x-v.x,$=I.y-v.y;return D*D+$*$}function zn(v,I,D,$){var ie=I.x,fe=I.y,_e=D.x-ie,je=D.y-fe,Je=_e*_e+je*je,Ct;return Je>0&&(Ct=((v.x-ie)*_e+(v.y-fe)*je)/Je,Ct>1?(ie=D.x,fe=D.y):Ct>0&&(ie+=_e*Ct,fe+=je*Ct)),_e=v.x-ie,je=v.y-fe,$?_e*_e+je*je:new Ae(ie,fe)}function xi(v){return!V(v[0])||typeof v[0][0]!="object"&&typeof v[0][0]<"u"}function Ii(v){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),xi(v)}function lr(v,I){var D,$,ie,fe,_e,je,Je,Ct;if(!v||v.length===0)throw new Error("latlngs not passed");xi(v)||(console.warn("latlngs are not flat! Only the first ring will be used"),v=v[0]);var yn=Rt([0,0]),On=xt(v),gi=On.getNorthWest().distanceTo(On.getSouthWest())*On.getNorthEast().distanceTo(On.getNorthWest());gi<1700&&(yn=wu(v));var uo=v.length,ms=[];for(D=0;D<uo;D++){var Oa=Rt(v[D]);ms.push(I.project(Rt([Oa.lat-yn.lat,Oa.lng-yn.lng])))}for(D=0,$=0;D<uo-1;D++)$+=ms[D].distanceTo(ms[D+1])/2;if($===0)Ct=ms[0];else for(D=0,fe=0;D<uo-1;D++)if(_e=ms[D],je=ms[D+1],ie=_e.distanceTo(je),fe+=ie,fe>$){Je=(fe-$)/ie,Ct=[je.x-Je*(je.x-_e.x),je.y-Je*(je.y-_e.y)];break}var Br=I.unproject(Ie(Ct));return Rt([Br.lat+yn.lat,Br.lng+yn.lng])}var so={__proto__:null,simplify:es,pointToSegmentDistance:_c,closestPointOnSegment:Cu,clipSegment:me,_getEdgeIntersection:Ke,_getBitCode:it,_sqClosestPointOnSegment:zn,isFlat:xi,_flat:Ii,polylineCenter:lr},Ro={project:function(v){return new Ae(v.lng,v.lat)},unproject:function(v){return new At(v.y,v.x)},bounds:new qe([-180,-90],[180,90])},oo={R:6378137,R_MINOR:6356752314245179e-9,bounds:new qe([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(v){var I=Math.PI/180,D=this.R,$=v.lat*I,ie=this.R_MINOR/D,fe=Math.sqrt(1-ie*ie),_e=fe*Math.sin($),je=Math.tan(Math.PI/4-$/2)/Math.pow((1-_e)/(1+_e),fe/2);return $=-D*Math.log(Math.max(je,1e-10)),new Ae(v.lng*I*D,$)},unproject:function(v){for(var I=180/Math.PI,D=this.R,$=this.R_MINOR/D,ie=Math.sqrt(1-$*$),fe=Math.exp(-v.y/D),_e=Math.PI/2-2*Math.atan(fe),je=0,Je=.1,Ct;je<15&&Math.abs(Je)>1e-7;je++)Ct=ie*Math.sin(_e),Ct=Math.pow((1-Ct)/(1+Ct),ie/2),Je=Math.PI/2-2*Math.atan(fe*Ct)-_e,_e+=Je;return new At(_e*I,v.x*I/D)}},oa={__proto__:null,LonLat:Ro,Mercator:oo,SphericalMercator:Lt},Lh=s({},Ze,{code:"EPSG:3395",projection:oo,transformation:function(){var v=.5/(Math.PI*oo.R);return ht(v,.5,-v,.5)}()}),Bh=s({},Ze,{code:"EPSG:4326",projection:Ro,transformation:ht(1/180,1,-1/180,.5)}),yw=s({},Et,{projection:Ro,transformation:ht(1,0,-1,0),scale:function(v){return Math.pow(2,v)},zoom:function(v){return Math.log(v)/Math.LN2},distance:function(v,I){var D=I.lng-v.lng,$=I.lat-v.lat;return Math.sqrt(D*D+$*$)},infinite:!0});Et.Earth=Ze,Et.EPSG3395=Lh,Et.EPSG3857=yt,Et.EPSG900913=wt,Et.EPSG4326=Bh,Et.Simple=yw;var Da=Ne.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(v){return v.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(v){return v&&v.removeLayer(this),this},getPane:function(v){return this._map.getPane(v?this.options[v]||v:this.options.pane)},addInteractiveTarget:function(v){return this._map._targets[p(v)]=this,this},removeInteractiveTarget:function(v){return delete this._map._targets[p(v)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(v){var I=v.target;if(I.hasLayer(this)){if(this._map=I,this._zoomAnimated=I._zoomAnimated,this.getEvents){var D=this.getEvents();I.on(D,this),this.once("remove",function(){I.off(D,this)},this)}this.onAdd(I),this.fire("add"),I.fire("layeradd",{layer:this})}}});ui.include({addLayer:function(v){if(!v._layerAdd)throw new Error("The provided object is not a Layer.");var I=p(v);return this._layers[I]?this:(this._layers[I]=v,v._mapToAdd=this,v.beforeAdd&&v.beforeAdd(this),this.whenReady(v._layerAdd,v),this)},removeLayer:function(v){var I=p(v);return this._layers[I]?(this._loaded&&v.onRemove(this),delete this._layers[I],this._loaded&&(this.fire("layerremove",{layer:v}),v.fire("remove")),v._map=v._mapToAdd=null,this):this},hasLayer:function(v){return p(v)in this._layers},eachLayer:function(v,I){for(var D in this._layers)v.call(I,this._layers[D]);return this},_addLayers:function(v){v=v?V(v)?v:[v]:[];for(var I=0,D=v.length;I<D;I++)this.addLayer(v[I])},_addZoomLimit:function(v){(!isNaN(v.options.maxZoom)||!isNaN(v.options.minZoom))&&(this._zoomBoundLayers[p(v)]=v,this._updateZoomLevels())},_removeZoomLimit:function(v){var I=p(v);this._zoomBoundLayers[I]&&(delete this._zoomBoundLayers[I],this._updateZoomLevels())},_updateZoomLevels:function(){var v=1/0,I=-1/0,D=this._getZoomSpan();for(var $ in this._zoomBoundLayers){var ie=this._zoomBoundLayers[$].options;v=ie.minZoom===void 0?v:Math.min(v,ie.minZoom),I=ie.maxZoom===void 0?I:Math.max(I,ie.maxZoom)}this._layersMaxZoom=I===-1/0?void 0:I,this._layersMinZoom=v===1/0?void 0:v,D!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Ph=Da.extend({initialize:function(v,I){R(this,I),this._layers={};var D,$;if(v)for(D=0,$=v.length;D<$;D++)this.addLayer(v[D])},addLayer:function(v){var I=this.getLayerId(v);return this._layers[I]=v,this._map&&this._map.addLayer(v),this},removeLayer:function(v){var I=v in this._layers?v:this.getLayerId(v);return this._map&&this._layers[I]&&this._map.removeLayer(this._layers[I]),delete this._layers[I],this},hasLayer:function(v){var I=typeof v=="number"?v:this.getLayerId(v);return I in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(v){var I=Array.prototype.slice.call(arguments,1),D,$;for(D in this._layers)$=this._layers[D],$[v]&&$[v].apply($,I);return this},onAdd:function(v){this.eachLayer(v.addLayer,v)},onRemove:function(v){this.eachLayer(v.removeLayer,v)},eachLayer:function(v,I){for(var D in this._layers)v.call(I,this._layers[D]);return this},getLayer:function(v){return this._layers[v]},getLayers:function(){var v=[];return this.eachLayer(v.push,v),v},setZIndex:function(v){return this.invoke("setZIndex",v)},getLayerId:function(v){return p(v)}}),nm=function(v,I){return new Ph(v,I)},dl=Ph.extend({addLayer:function(v){return this.hasLayer(v)?this:(v.addEventParent(this),Ph.prototype.addLayer.call(this,v),this.fire("layeradd",{layer:v}))},removeLayer:function(v){return this.hasLayer(v)?(v in this._layers&&(v=this._layers[v]),v.removeEventParent(this),Ph.prototype.removeLayer.call(this,v),this.fire("layerremove",{layer:v})):this},setStyle:function(v){return this.invoke("setStyle",v)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var v=new Wt;for(var I in this._layers){var D=this._layers[I];v.extend(D.getBounds?D.getBounds():D.getLatLng())}return v}}),sv=function(v,I){return new dl(v,I)},Eu=we.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(v){R(this,v)},createIcon:function(v){return this._createIcon("icon",v)},createShadow:function(v){return this._createIcon("shadow",v)},_createIcon:function(v,I){var D=this._getIconUrl(v);if(!D){if(v==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var $=this._createImg(D,I&&I.tagName==="IMG"?I:null);return this._setIconStyles($,v),(this.options.crossOrigin||this.options.crossOrigin==="")&&($.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),$},_setIconStyles:function(v,I){var D=this.options,$=D[I+"Size"];typeof $=="number"&&($=[$,$]);var ie=Ie($),fe=Ie(I==="shadow"&&D.shadowAnchor||D.iconAnchor||ie&&ie.divideBy(2,!0));v.className="leaflet-marker-"+I+" "+(D.className||""),fe&&(v.style.marginLeft=-fe.x+"px",v.style.marginTop=-fe.y+"px"),ie&&(v.style.width=ie.x+"px",v.style.height=ie.y+"px")},_createImg:function(v,I){return I=I||document.createElement("img"),I.src=v,I},_getIconUrl:function(v){return hn.retina&&this.options[v+"RetinaUrl"]||this.options[v+"Url"]}});function Aw(v){return new Eu(v)}var Jd=Eu.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(v){return typeof Jd.imagePath!="string"&&(Jd.imagePath=this._detectIconPath()),(this.options.imagePath||Jd.imagePath)+Eu.prototype._getIconUrl.call(this,v)},_stripUrl:function(v){var I=function(D,$,ie){var fe=$.exec(D);return fe&&fe[ie]};return v=I(v,/^url\((['"])?(.+)\1\)$/,2),v&&I(v,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var v=zt("div","leaflet-default-icon-path",document.body),I=Sn(v,"background-image")||Sn(v,"backgroundImage");if(document.body.removeChild(v),I=this._stripUrl(I),I)return I;var D=document.querySelector('link[href$="leaflet.css"]');return D?D.href.substring(0,D.href.length-11-1):""}}),ov=Ls.extend({initialize:function(v){this._marker=v},addHooks:function(){var v=this._marker._icon;this._draggable||(this._draggable=new ko(v,v,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ht(v,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&jt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(v){var I=this._marker,D=I._map,$=this._marker.options.autoPanSpeed,ie=this._marker.options.autoPanPadding,fe=Vi(I._icon),_e=D.getPixelBounds(),je=D.getPixelOrigin(),Je=dt(_e.min._subtract(je).add(ie),_e.max._subtract(je).subtract(ie));if(!Je.contains(fe)){var Ct=Ie((Math.max(Je.max.x,fe.x)-Je.max.x)/(_e.max.x-Je.max.x)-(Math.min(Je.min.x,fe.x)-Je.min.x)/(_e.min.x-Je.min.x),(Math.max(Je.max.y,fe.y)-Je.max.y)/(_e.max.y-Je.max.y)-(Math.min(Je.min.y,fe.y)-Je.min.y)/(_e.min.y-Je.min.y)).multiplyBy($);D.panBy(Ct,{animate:!1}),this._draggable._newPos._add(Ct),this._draggable._startPos._add(Ct),Nn(I._icon,this._draggable._newPos),this._onDrag(v),this._panRequest=ee(this._adjustPan.bind(this,v))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(v){this._marker.options.autoPan&&(de(this._panRequest),this._panRequest=ee(this._adjustPan.bind(this,v)))},_onDrag:function(v){var I=this._marker,D=I._shadow,$=Vi(I._icon),ie=I._map.layerPointToLatLng($);D&&Nn(D,$),I._latlng=ie,v.latlng=ie,v.oldLatLng=this._oldLatLng,I.fire("move",v).fire("drag",v)},_onDragEnd:function(v){de(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",v)}}),_u=Da.extend({options:{icon:new Jd,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(v,I){R(this,I),this._latlng=Rt(v)},onAdd:function(v){this._zoomAnimated=this._zoomAnimated&&v.options.markerZoomAnimation,this._zoomAnimated&&v.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(v){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&v.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(v){var I=this._latlng;return this._latlng=Rt(v),this.update(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},setZIndexOffset:function(v){return this.options.zIndexOffset=v,this.update()},getIcon:function(){return this.options.icon},setIcon:function(v){return this.options.icon=v,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var v=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(v)}return this},_initIcon:function(){var v=this.options,I="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),D=v.icon.createIcon(this._icon),$=!1;D!==this._icon&&(this._icon&&this._removeIcon(),$=!0,v.title&&(D.title=v.title),D.tagName==="IMG"&&(D.alt=v.alt||"")),Ht(D,I),v.keyboard&&(D.tabIndex="0",D.setAttribute("role","button")),this._icon=D,v.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Xn(D,"focus",this._panOnFocus,this);var ie=v.icon.createShadow(this._shadow),fe=!1;ie!==this._shadow&&(this._removeShadow(),fe=!0),ie&&(Ht(ie,I),ie.alt=""),this._shadow=ie,v.opacity<1&&this._updateOpacity(),$&&this.getPane().appendChild(this._icon),this._initInteraction(),ie&&fe&&this.getPane(v.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ki(this._icon,"focus",this._panOnFocus,this),gn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&gn(this._shadow),this._shadow=null},_setPos:function(v){this._icon&&Nn(this._icon,v),this._shadow&&Nn(this._shadow,v),this._zIndex=v.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(v){this._icon&&(this._icon.style.zIndex=this._zIndex+v)},_animateZoom:function(v){var I=this._map._latLngToNewLayerPoint(this._latlng,v.zoom,v.center).round();this._setPos(I)},_initInteraction:function(){if(this.options.interactive&&(Ht(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),ov)){var v=this.options.draggable;this.dragging&&(v=this.dragging.enabled(),this.dragging.disable()),this.dragging=new ov(this),v&&this.dragging.enable()}},setOpacity:function(v){return this.options.opacity=v,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var v=this.options.opacity;this._icon&&Oi(this._icon,v),this._shadow&&Oi(this._shadow,v)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var v=this._map;if(v){var I=this.options.icon.options,D=I.iconSize?Ie(I.iconSize):Ie(0,0),$=I.iconAnchor?Ie(I.iconAnchor):Ie(0,0);v.panInside(this._latlng,{paddingTopLeft:$,paddingBottomRight:D.subtract($)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function im(v,I){return new _u(v,I)}var Fa=Da.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(v){this._renderer=v.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(v){return R(this,v),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&v&&Object.prototype.hasOwnProperty.call(v,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Iu=Fa.extend({options:{fill:!0,radius:10},initialize:function(v,I){R(this,I),this._latlng=Rt(v),this._radius=this.options.radius},setLatLng:function(v){var I=this._latlng;return this._latlng=Rt(v),this.redraw(),this.fire("move",{oldLatLng:I,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(v){return this.options.radius=this._radius=v,this.redraw()},getRadius:function(){return this._radius},setStyle:function(v){var I=v&&v.radius||this._radius;return Fa.prototype.setStyle.call(this,v),this.setRadius(I),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var v=this._radius,I=this._radiusY||v,D=this._clickTolerance(),$=[v+D,I+D];this._pxBounds=new qe(this._point.subtract($),this._point.add($))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(v){return v.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function av(v,I){return new Iu(v,I)}var rm=Iu.extend({initialize:function(v,I,D){if(typeof I=="number"&&(I=s({},D,{radius:I})),R(this,I),this._latlng=Rt(v),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(v){return this._mRadius=v,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var v=[this._radius,this._radiusY||this._radius];return new Wt(this._map.layerPointToLatLng(this._point.subtract(v)),this._map.layerPointToLatLng(this._point.add(v)))},setStyle:Fa.prototype.setStyle,_project:function(){var v=this._latlng.lng,I=this._latlng.lat,D=this._map,$=D.options.crs;if($.distance===Ze.distance){var ie=Math.PI/180,fe=this._mRadius/Ze.R/ie,_e=D.project([I+fe,v]),je=D.project([I-fe,v]),Je=_e.add(je).divideBy(2),Ct=D.unproject(Je).lat,yn=Math.acos((Math.cos(fe*ie)-Math.sin(I*ie)*Math.sin(Ct*ie))/(Math.cos(I*ie)*Math.cos(Ct*ie)))/ie;(isNaN(yn)||yn===0)&&(yn=fe/Math.cos(Math.PI/180*I)),this._point=Je.subtract(D.getPixelOrigin()),this._radius=isNaN(yn)?0:Je.x-D.project([Ct,v-yn]).x,this._radiusY=Je.y-_e.y}else{var On=$.unproject($.project(this._latlng).subtract([this._mRadius,0]));this._point=D.latLngToLayerPoint(this._latlng),this._radius=this._point.x-D.latLngToLayerPoint(On).x}this._updateBounds()}});function ef(v,I,D){return new rm(v,I,D)}var fl=Fa.extend({options:{smoothFactor:1,noClip:!1},initialize:function(v,I){R(this,I),this._setLatLngs(v)},getLatLngs:function(){return this._latlngs},setLatLngs:function(v){return this._setLatLngs(v),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(v){for(var I=1/0,D=null,$=zn,ie,fe,_e=0,je=this._parts.length;_e<je;_e++)for(var Je=this._parts[_e],Ct=1,yn=Je.length;Ct<yn;Ct++){ie=Je[Ct-1],fe=Je[Ct];var On=$(v,ie,fe,!0);On<I&&(I=On,D=$(v,ie,fe))}return D&&(D.distance=Math.sqrt(I)),D},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return lr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(v,I){return I=I||this._defaultShape(),v=Rt(v),I.push(v),this._bounds.extend(v),this.redraw()},_setLatLngs:function(v){this._bounds=new Wt,this._latlngs=this._convertLatLngs(v)},_defaultShape:function(){return xi(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(v){for(var I=[],D=xi(v),$=0,ie=v.length;$<ie;$++)D?(I[$]=Rt(v[$]),this._bounds.extend(I[$])):I[$]=this._convertLatLngs(v[$]);return I},_project:function(){var v=new qe;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,v),this._bounds.isValid()&&v.isValid()&&(this._rawPxBounds=v,this._updateBounds())},_updateBounds:function(){var v=this._clickTolerance(),I=new Ae(v,v);this._rawPxBounds&&(this._pxBounds=new qe([this._rawPxBounds.min.subtract(I),this._rawPxBounds.max.add(I)]))},_projectLatlngs:function(v,I,D){var $=v[0]instanceof At,ie=v.length,fe,_e;if($){for(_e=[],fe=0;fe<ie;fe++)_e[fe]=this._map.latLngToLayerPoint(v[fe]),D.extend(_e[fe]);I.push(_e)}else for(fe=0;fe<ie;fe++)this._projectLatlngs(v[fe],I,D)},_clipPoints:function(){var v=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(v))){if(this.options.noClip){this._parts=this._rings;return}var I=this._parts,D,$,ie,fe,_e,je,Je;for(D=0,ie=0,fe=this._rings.length;D<fe;D++)for(Je=this._rings[D],$=0,_e=Je.length;$<_e-1;$++)je=me(Je[$],Je[$+1],v,$,!0),je&&(I[ie]=I[ie]||[],I[ie].push(je[0]),(je[1]!==Je[$+1]||$===_e-2)&&(I[ie].push(je[1]),ie++))}},_simplifyPoints:function(){for(var v=this._parts,I=this.options.smoothFactor,D=0,$=v.length;D<$;D++)v[D]=es(v[D],I)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(v,I){var D,$,ie,fe,_e,je,Je=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(v))return!1;for(D=0,fe=this._parts.length;D<fe;D++)for(je=this._parts[D],$=0,_e=je.length,ie=_e-1;$<_e;ie=$++)if(!(!I&&$===0)&&_c(v,je[ie],je[$])<=Je)return!0;return!1}});function m0(v,I){return new fl(v,I)}fl._flat=Ii;var Sc=fl.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xu(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(v){var I=fl.prototype._convertLatLngs.call(this,v),D=I.length;return D>=2&&I[0]instanceof At&&I[0].equals(I[D-1])&&I.pop(),I},_setLatLngs:function(v){fl.prototype._setLatLngs.call(this,v),xi(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return xi(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var v=this._renderer._bounds,I=this.options.weight,D=new Ae(I,I);if(v=new qe(v.min.subtract(D),v.max.add(D)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(v))){if(this.options.noClip){this._parts=this._rings;return}for(var $=0,ie=this._rings.length,fe;$<ie;$++)fe=Rh(this._rings[$],v,!0),fe.length&&this._parts.push(fe)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(v){var I=!1,D,$,ie,fe,_e,je,Je,Ct;if(!this._pxBounds||!this._pxBounds.contains(v))return!1;for(fe=0,Je=this._parts.length;fe<Je;fe++)for(D=this._parts[fe],_e=0,Ct=D.length,je=Ct-1;_e<Ct;je=_e++)$=D[_e],ie=D[je],$.y>v.y!=ie.y>v.y&&v.x<(ie.x-$.x)*(v.y-$.y)/(ie.y-$.y)+$.x&&(I=!I);return I||fl.prototype._containsPoint.call(this,v,!0)}});function g0(v,I){return new Sc(v,I)}var aa=dl.extend({initialize:function(v,I){R(this,I),this._layers={},v&&this.addData(v)},addData:function(v){var I=V(v)?v:v.features,D,$,ie;if(I){for(D=0,$=I.length;D<$;D++)ie=I[D],(ie.geometries||ie.geometry||ie.features||ie.coordinates)&&this.addData(ie);return this}var fe=this.options;if(fe.filter&&!fe.filter(v))return this;var _e=tf(v,fe);return _e?(_e.feature=Dh(v),_e.defaultOptions=_e.options,this.resetStyle(_e),fe.onEachFeature&&fe.onEachFeature(v,_e),this.addLayer(_e)):this},resetStyle:function(v){return v===void 0?this.eachLayer(this.resetStyle,this):(v.options=s({},v.defaultOptions),this._setLayerStyle(v,this.options.style),this)},setStyle:function(v){return this.eachLayer(function(I){this._setLayerStyle(I,v)},this)},_setLayerStyle:function(v,I){v.setStyle&&(typeof I=="function"&&(I=I(v.feature)),v.setStyle(I))}});function tf(v,I){var D=v.type==="Feature"?v.geometry:v,$=D?D.coordinates:null,ie=[],fe=I&&I.pointToLayer,_e=I&&I.coordsToLatLng||nf,je,Je,Ct,yn;if(!$&&!D)return null;switch(D.type){case"Point":return je=_e($),y0(fe,v,je,I);case"MultiPoint":for(Ct=0,yn=$.length;Ct<yn;Ct++)je=_e($[Ct]),ie.push(y0(fe,v,je,I));return new dl(ie);case"LineString":case"MultiLineString":return Je=Nh($,D.type==="LineString"?0:1,_e),new fl(Je,I);case"Polygon":case"MultiPolygon":return Je=Nh($,D.type==="Polygon"?1:2,_e),new Sc(Je,I);case"GeometryCollection":for(Ct=0,yn=D.geometries.length;Ct<yn;Ct++){var On=tf({geometry:D.geometries[Ct],type:"Feature",properties:v.properties},I);On&&ie.push(On)}return new dl(ie);case"FeatureCollection":for(Ct=0,yn=D.features.length;Ct<yn;Ct++){var gi=tf(D.features[Ct],I);gi&&ie.push(gi)}return new dl(ie);default:throw new Error("Invalid GeoJSON object.")}}function y0(v,I,D,$){return v?v(I,D):new _u(D,$&&$.markersInheritOptions&&$)}function nf(v){return new At(v[1],v[0],v[2])}function Nh(v,I,D){for(var $=[],ie=0,fe=v.length,_e;ie<fe;ie++)_e=I?Nh(v[ie],I-1,D):(D||nf)(v[ie]),$.push(_e);return $}function A0(v,I){return v=Rt(v),v.alt!==void 0?[E(v.lng,I),E(v.lat,I),E(v.alt,I)]:[E(v.lng,I),E(v.lat,I)]}function Ks(v,I,D,$){for(var ie=[],fe=0,_e=v.length;fe<_e;fe++)ie.push(I?Ks(v[fe],xi(v[fe])?0:I-1,D,$):A0(v[fe],$));return!I&&D&&ie.length>0&&ie.push(ie[0].slice()),ie}function rf(v,I){return v.feature?s({},v.feature,{geometry:I}):Dh(I)}function Dh(v){return v.type==="Feature"||v.type==="FeatureCollection"?v:{type:"Feature",properties:{},geometry:v}}var sm={toGeoJSON:function(v){return rf(this,{type:"Point",coordinates:A0(this.getLatLng(),v)})}};_u.include(sm),rm.include(sm),Iu.include(sm),fl.include({toGeoJSON:function(v){var I=!xi(this._latlngs),D=Ks(this._latlngs,I?1:0,!1,v);return rf(this,{type:(I?"Multi":"")+"LineString",coordinates:D})}}),Sc.include({toGeoJSON:function(v){var I=!xi(this._latlngs),D=I&&!xi(this._latlngs[0]),$=Ks(this._latlngs,D?2:I?1:0,!0,v);return I||($=[$]),rf(this,{type:(D?"Multi":"")+"Polygon",coordinates:$})}}),Ph.include({toMultiPoint:function(v){var I=[];return this.eachLayer(function(D){I.push(D.toGeoJSON(v).geometry.coordinates)}),rf(this,{type:"MultiPoint",coordinates:I})},toGeoJSON:function(v){var I=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(I==="MultiPoint")return this.toMultiPoint(v);var D=I==="GeometryCollection",$=[];return this.eachLayer(function(ie){if(ie.toGeoJSON){var fe=ie.toGeoJSON(v);if(D)$.push(fe.geometry);else{var _e=Dh(fe);_e.type==="FeatureCollection"?$.push.apply($,_e.features):$.push(_e)}}}),D?rf(this,{geometries:$,type:"GeometryCollection"}):{type:"FeatureCollection",features:$}}});function v0(v,I){return new aa(v,I)}var vw=v0,om=Da.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(v,I,D){this._url=v,this._bounds=xt(I),R(this,D)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ht(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){gn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(v){return this.options.opacity=v,this._image&&this._updateOpacity(),this},setStyle:function(v){return v.opacity&&this.setOpacity(v.opacity),this},bringToFront:function(){return this._map&&Ci(this._image),this},bringToBack:function(){return this._map&&bi(this._image),this},setUrl:function(v){return this._url=v,this._image&&(this._image.src=v),this},setBounds:function(v){return this._bounds=xt(v),this._map&&this._reset(),this},getEvents:function(){var v={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(v.zoomanim=this._animateZoom),v},setZIndex:function(v){return this.options.zIndex=v,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var v=this._url.tagName==="IMG",I=this._image=v?this._url:zt("img");if(Ht(I,"leaflet-image-layer"),this._zoomAnimated&&Ht(I,"leaflet-zoom-animated"),this.options.className&&Ht(I,this.options.className),I.onselectstart=b,I.onmousemove=b,I.onload=u(this.fire,this,"load"),I.onerror=u(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(I.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),v){this._url=I.src;return}I.src=this._url,I.alt=this.options.alt},_animateZoom:function(v){var I=this._map.getZoomScale(v.zoom),D=this._map._latLngBoundsToNewLayerBounds(this._bounds,v.zoom,v.center).min;ds(this._image,D,I)},_reset:function(){var v=this._image,I=new qe(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),D=I.getSize();Nn(v,I.min),v.style.width=D.x+"px",v.style.height=D.y+"px"},_updateOpacity:function(){Oi(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var v=this.options.errorOverlayUrl;v&&this._url!==v&&(this._url=v,this._image.src=v)},getCenter:function(){return this._bounds.getCenter()}}),la=function(v,I,D){return new om(v,I,D)},bw=om.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var v=this._url.tagName==="VIDEO",I=this._image=v?this._url:zt("video");if(Ht(I,"leaflet-image-layer"),this._zoomAnimated&&Ht(I,"leaflet-zoom-animated"),this.options.className&&Ht(I,this.options.className),I.onselectstart=b,I.onmousemove=b,I.onloadeddata=u(this.fire,this,"load"),v){for(var D=I.getElementsByTagName("source"),$=[],ie=0;ie<D.length;ie++)$.push(D[ie].src);this._url=D.length>0?$:[I.src];return}V(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(I.style,"objectFit")&&(I.style.objectFit="fill"),I.autoplay=!!this.options.autoplay,I.loop=!!this.options.loop,I.muted=!!this.options.muted,I.playsInline=!!this.options.playsInline;for(var fe=0;fe<this._url.length;fe++){var _e=zt("source");_e.src=this._url[fe],I.appendChild(_e)}}});function xw(v,I,D){return new bw(v,I,D)}var lv=om.extend({_initImage:function(){var v=this._image=this._url;Ht(v,"leaflet-image-layer"),this._zoomAnimated&&Ht(v,"leaflet-zoom-animated"),this.options.className&&Ht(v,this.options.className),v.onselectstart=b,v.onmousemove=b}});function Fh(v,I,D){return new lv(v,I,D)}var Gl=Da.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(v,I){v&&(v instanceof At||V(v))?(this._latlng=Rt(v),R(this,I)):(R(this,v),this._source=I),this.options.content&&(this._content=this.options.content)},openOn:function(v){return v=arguments.length?v:this._source._map,v.hasLayer(this)||v.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(v){return this._map?this.close():(arguments.length?this._source=v:v=this._source,this._prepareOpen(),this.openOn(v._map)),this},onAdd:function(v){this._zoomAnimated=v._zoomAnimated,this._container||this._initLayout(),v._fadeAnimated&&Oi(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),v._fadeAnimated&&Oi(this._container,1),this.bringToFront(),this.options.interactive&&(Ht(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(v){v._fadeAnimated?(Oi(this._container,0),this._removeTimeout=setTimeout(u(gn,void 0,this._container),200)):gn(this._container),this.options.interactive&&(jt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(v){return this._latlng=Rt(v),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(v){return this._content=v,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var v={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(v.zoomanim=this._animateZoom),v},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Ci(this._container),this},bringToBack:function(){return this._map&&bi(this._container),this},_prepareOpen:function(v){var I=this._source;if(!I._map)return!1;if(I instanceof dl){I=null;var D=this._source._layers;for(var $ in D)if(D[$]._map){I=D[$];break}if(!I)return!1;this._source=I}if(!v)if(I.getCenter)v=I.getCenter();else if(I.getLatLng)v=I.getLatLng();else if(I.getBounds)v=I.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(v),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var v=this._contentNode,I=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof I=="string")v.innerHTML=I;else{for(;v.hasChildNodes();)v.removeChild(v.firstChild);v.appendChild(I)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var v=this._map.latLngToLayerPoint(this._latlng),I=Ie(this.options.offset),D=this._getAnchor();this._zoomAnimated?Nn(this._container,v.add(D)):I=I.add(v).add(D);var $=this._containerBottom=-I.y,ie=this._containerLeft=-Math.round(this._containerWidth/2)+I.x;this._container.style.bottom=$+"px",this._container.style.left=ie+"px"}},_getAnchor:function(){return[0,0]}});ui.include({_initOverlay:function(v,I,D,$){var ie=I;return ie instanceof v||(ie=new v($).setContent(I)),D&&ie.setLatLng(D),ie}}),Da.include({_initOverlay:function(v,I,D,$){var ie=D;return ie instanceof v?(R(ie,$),ie._source=this):(ie=I&&!$?I:new v($,this),ie.setContent(D)),ie}});var b0=Gl.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(v){return v=arguments.length?v:this._source._map,!v.hasLayer(this)&&v._popup&&v._popup.options.autoClose&&v.removeLayer(v._popup),v._popup=this,Gl.prototype.openOn.call(this,v)},onAdd:function(v){Gl.prototype.onAdd.call(this,v),v.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Fa||this._source.on("preclick",Ui))},onRemove:function(v){Gl.prototype.onRemove.call(this,v),v.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Fa||this._source.off("preclick",Ui))},getEvents:function(){var v=Gl.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(v.preclick=this.close),this.options.keepInView&&(v.moveend=this._adjustPan),v},_initLayout:function(){var v="leaflet-popup",I=this._container=zt("div",v+" "+(this.options.className||"")+" leaflet-zoom-animated"),D=this._wrapper=zt("div",v+"-content-wrapper",I);if(this._contentNode=zt("div",v+"-content",D),Ul(I),fu(this._contentNode),Xn(I,"contextmenu",Ui),this._tipContainer=zt("div",v+"-tip-container",I),this._tip=zt("div",v+"-tip",this._tipContainer),this.options.closeButton){var $=this._closeButton=zt("a",v+"-close-button",I);$.setAttribute("role","button"),$.setAttribute("aria-label","Close popup"),$.href="#close",$.innerHTML='<span aria-hidden="true">&#215;</span>',Xn($,"click",function(ie){mr(ie),this.close()},this)}},_updateLayout:function(){var v=this._contentNode,I=v.style;I.width="",I.whiteSpace="nowrap";var D=v.offsetWidth;D=Math.min(D,this.options.maxWidth),D=Math.max(D,this.options.minWidth),I.width=D+1+"px",I.whiteSpace="",I.height="";var $=v.offsetHeight,ie=this.options.maxHeight,fe="leaflet-popup-scrolled";ie&&$>ie?(I.height=ie+"px",Ht(v,fe)):jt(v,fe),this._containerWidth=this._container.offsetWidth},_animateZoom:function(v){var I=this._map._latLngToNewLayerPoint(this._latlng,v.zoom,v.center),D=this._getAnchor();Nn(this._container,I.add(D))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var v=this._map,I=parseInt(Sn(this._container,"marginBottom"),10)||0,D=this._container.offsetHeight+I,$=this._containerWidth,ie=new Ae(this._containerLeft,-D-this._containerBottom);ie._add(Vi(this._container));var fe=v.layerPointToContainerPoint(ie),_e=Ie(this.options.autoPanPadding),je=Ie(this.options.autoPanPaddingTopLeft||_e),Je=Ie(this.options.autoPanPaddingBottomRight||_e),Ct=v.getSize(),yn=0,On=0;fe.x+$+Je.x>Ct.x&&(yn=fe.x+$-Ct.x+Je.x),fe.x-yn-je.x<0&&(yn=fe.x-je.x),fe.y+D+Je.y>Ct.y&&(On=fe.y+D-Ct.y+Je.y),fe.y-On-je.y<0&&(On=fe.y-je.y),(yn||On)&&(this.options.keepInView&&(this._autopanning=!0),v.fire("autopanstart").panBy([yn,On]))}},_getAnchor:function(){return Ie(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ww=function(v,I){return new b0(v,I)};ui.mergeOptions({closePopupOnClick:!0}),ui.include({openPopup:function(v,I,D){return this._initOverlay(b0,v,I,D).openOn(this),this},closePopup:function(v){return v=arguments.length?v:this._popup,v&&v.close(),this}}),Da.include({bindPopup:function(v,I){return this._popup=this._initOverlay(b0,this._popup,v,I),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(v){return this._popup&&(this instanceof dl||(this._popup._source=this),this._popup._prepareOpen(v||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(v){return this._popup&&this._popup.setContent(v),this},getPopup:function(){return this._popup},_openPopup:function(v){if(!(!this._popup||!this._map)){ia(v);var I=v.layer||v.target;if(this._popup._source===I&&!(I instanceof Fa)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(v.latlng);return}this._popup._source=I,this.openPopup(v.latlng)}},_movePopup:function(v){this._popup.setLatLng(v.latlng)},_onKeyPress:function(v){v.originalEvent.keyCode===13&&this._openPopup(v)}});var ao=Gl.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(v){Gl.prototype.onAdd.call(this,v),this.setOpacity(this.options.opacity),v.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(v){Gl.prototype.onRemove.call(this,v),v.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var v=Gl.prototype.getEvents.call(this);return this.options.permanent||(v.preclick=this.close),v},_initLayout:function(){var v="leaflet-tooltip",I=v+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=zt("div",I),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+p(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(v){var I,D,$=this._map,ie=this._container,fe=$.latLngToContainerPoint($.getCenter()),_e=$.layerPointToContainerPoint(v),je=this.options.direction,Je=ie.offsetWidth,Ct=ie.offsetHeight,yn=Ie(this.options.offset),On=this._getAnchor();je==="top"?(I=Je/2,D=Ct):je==="bottom"?(I=Je/2,D=0):je==="center"?(I=Je/2,D=Ct/2):je==="right"?(I=0,D=Ct/2):je==="left"?(I=Je,D=Ct/2):_e.x<fe.x?(je="right",I=0,D=Ct/2):(je="left",I=Je+(yn.x+On.x)*2,D=Ct/2),v=v.subtract(Ie(I,D,!0)).add(yn).add(On),jt(ie,"leaflet-tooltip-right"),jt(ie,"leaflet-tooltip-left"),jt(ie,"leaflet-tooltip-top"),jt(ie,"leaflet-tooltip-bottom"),Ht(ie,"leaflet-tooltip-"+je),Nn(ie,v)},_updatePosition:function(){var v=this._map.latLngToLayerPoint(this._latlng);this._setPosition(v)},setOpacity:function(v){this.options.opacity=v,this._container&&Oi(this._container,v)},_animateZoom:function(v){var I=this._map._latLngToNewLayerPoint(this._latlng,v.zoom,v.center);this._setPosition(I)},_getAnchor:function(){return Ie(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ir=function(v,I){return new ao(v,I)};ui.include({openTooltip:function(v,I,D){return this._initOverlay(ao,v,I,D).openOn(this),this},closeTooltip:function(v){return v.close(),this}}),Da.include({bindTooltip:function(v,I){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ao,this._tooltip,v,I),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(v){if(!(!v&&this._tooltipHandlersAdded)){var I=v?"off":"on",D={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?D.add=this._openTooltip:(D.mouseover=this._openTooltip,D.mouseout=this.closeTooltip,D.click=this._openTooltip,this._map?this._addFocusListeners():D.add=this._addFocusListeners),this._tooltip.options.sticky&&(D.mousemove=this._moveTooltip),this[I](D),this._tooltipHandlersAdded=!v}},openTooltip:function(v){return this._tooltip&&(this instanceof dl||(this._tooltip._source=this),this._tooltip._prepareOpen(v)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(v){return this._tooltip&&this._tooltip.setContent(v),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(v){var I=typeof v.getElement=="function"&&v.getElement();I&&(Xn(I,"focus",function(){this._tooltip._source=v,this.openTooltip()},this),Xn(I,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(v){var I=typeof v.getElement=="function"&&v.getElement();I&&I.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(v){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var I=this;this._map.once("moveend",function(){I._openOnceFlag=!1,I._openTooltip(v)});return}this._tooltip._source=v.layer||v.target,this.openTooltip(this._tooltip.options.sticky?v.latlng:void 0)}},_moveTooltip:function(v){var I=v.latlng,D,$;this._tooltip.options.sticky&&v.originalEvent&&(D=this._map.mouseEventToContainerPoint(v.originalEvent),$=this._map.containerPointToLayerPoint(D),I=this._map.layerPointToLatLng($)),this._tooltip.setLatLng(I)}});var lo=Eu.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(v){var I=v&&v.tagName==="DIV"?v:document.createElement("div"),D=this.options;if(D.html instanceof Element?(Hn(I),I.appendChild(D.html)):I.innerHTML=D.html!==!1?D.html:"",D.bgPos){var $=Ie(D.bgPos);I.style.backgroundPosition=-$.x+"px "+-$.y+"px"}return this._setIconStyles(I,"icon"),I},createShadow:function(){return null}});function Cw(v){return new lo(v)}Eu.Default=Jd;var sf=Da.extend({options:{tileSize:256,opacity:1,updateWhenIdle:hn.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(v){R(this,v)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(v){v._addZoomLimit(this)},onRemove:function(v){this._removeAllTiles(),gn(this._container),v._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Ci(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(bi(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(v){return this.options.opacity=v,this._updateOpacity(),this},setZIndex:function(v){return this.options.zIndex=v,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var v=this._clampZoom(this._map.getZoom());v!==this._tileZoom&&(this._tileZoom=v,this._updateLevels()),this._update()}return this},getEvents:function(){var v={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=g(this._onMoveEnd,this.options.updateInterval,this)),v.move=this._onMove),this._zoomAnimated&&(v.zoomanim=this._animateZoom),v},createTile:function(){return document.createElement("div")},getTileSize:function(){var v=this.options.tileSize;return v instanceof Ae?v:new Ae(v,v)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(v){for(var I=this.getPane().children,D=-v(-1/0,1/0),$=0,ie=I.length,fe;$<ie;$++)fe=I[$].style.zIndex,I[$]!==this._container&&fe&&(D=v(D,+fe));isFinite(D)&&(this.options.zIndex=D+v(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!hn.ielt9){Oi(this._container,this.options.opacity);var v=+new Date,I=!1,D=!1;for(var $ in this._tiles){var ie=this._tiles[$];if(!(!ie.current||!ie.loaded)){var fe=Math.min(1,(v-ie.loaded)/200);Oi(ie.el,fe),fe<1?I=!0:(ie.active?D=!0:this._onOpaqueTile(ie),ie.active=!0)}}D&&!this._noPrune&&this._pruneTiles(),I&&(de(this._fadeFrame),this._fadeFrame=ee(this._updateOpacity,this))}},_onOpaqueTile:b,_initContainer:function(){this._container||(this._container=zt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var v=this._tileZoom,I=this.options.maxZoom;if(v!==void 0){for(var D in this._levels)D=Number(D),this._levels[D].el.children.length||D===v?(this._levels[D].el.style.zIndex=I-Math.abs(v-D),this._onUpdateLevel(D)):(gn(this._levels[D].el),this._removeTilesAtZoom(D),this._onRemoveLevel(D),delete this._levels[D]);var $=this._levels[v],ie=this._map;return $||($=this._levels[v]={},$.el=zt("div","leaflet-tile-container leaflet-zoom-animated",this._container),$.el.style.zIndex=I,$.origin=ie.project(ie.unproject(ie.getPixelOrigin()),v).round(),$.zoom=v,this._setZoomTransform($,ie.getCenter(),ie.getZoom()),b($.el.offsetWidth),this._onCreateLevel($)),this._level=$,$}},_onUpdateLevel:b,_onRemoveLevel:b,_onCreateLevel:b,_pruneTiles:function(){if(this._map){var v,I,D=this._map.getZoom();if(D>this.options.maxZoom||D<this.options.minZoom){this._removeAllTiles();return}for(v in this._tiles)I=this._tiles[v],I.retain=I.current;for(v in this._tiles)if(I=this._tiles[v],I.current&&!I.active){var $=I.coords;this._retainParent($.x,$.y,$.z,$.z-5)||this._retainChildren($.x,$.y,$.z,$.z+2)}for(v in this._tiles)this._tiles[v].retain||this._removeTile(v)}},_removeTilesAtZoom:function(v){for(var I in this._tiles)this._tiles[I].coords.z===v&&this._removeTile(I)},_removeAllTiles:function(){for(var v in this._tiles)this._removeTile(v)},_invalidateAll:function(){for(var v in this._levels)gn(this._levels[v].el),this._onRemoveLevel(Number(v)),delete this._levels[v];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(v,I,D,$){var ie=Math.floor(v/2),fe=Math.floor(I/2),_e=D-1,je=new Ae(+ie,+fe);je.z=+_e;var Je=this._tileCoordsToKey(je),Ct=this._tiles[Je];return Ct&&Ct.active?(Ct.retain=!0,!0):(Ct&&Ct.loaded&&(Ct.retain=!0),_e>$?this._retainParent(ie,fe,_e,$):!1)},_retainChildren:function(v,I,D,$){for(var ie=2*v;ie<2*v+2;ie++)for(var fe=2*I;fe<2*I+2;fe++){var _e=new Ae(ie,fe);_e.z=D+1;var je=this._tileCoordsToKey(_e),Je=this._tiles[je];if(Je&&Je.active){Je.retain=!0;continue}else Je&&Je.loaded&&(Je.retain=!0);D+1<$&&this._retainChildren(ie,fe,D+1,$)}},_resetView:function(v){var I=v&&(v.pinch||v.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),I,I)},_animateZoom:function(v){this._setView(v.center,v.zoom,!0,v.noUpdate)},_clampZoom:function(v){var I=this.options;return I.minNativeZoom!==void 0&&v<I.minNativeZoom?I.minNativeZoom:I.maxNativeZoom!==void 0&&I.maxNativeZoom<v?I.maxNativeZoom:v},_setView:function(v,I,D,$){var ie=Math.round(I);this.options.maxZoom!==void 0&&ie>this.options.maxZoom||this.options.minZoom!==void 0&&ie<this.options.minZoom?ie=void 0:ie=this._clampZoom(ie);var fe=this.options.updateWhenZooming&&ie!==this._tileZoom;(!$||fe)&&(this._tileZoom=ie,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ie!==void 0&&this._update(v),D||this._pruneTiles(),this._noPrune=!!D),this._setZoomTransforms(v,I)},_setZoomTransforms:function(v,I){for(var D in this._levels)this._setZoomTransform(this._levels[D],v,I)},_setZoomTransform:function(v,I,D){var $=this._map.getZoomScale(D,v.zoom),ie=v.origin.multiplyBy($).subtract(this._map._getNewPixelOrigin(I,D)).round();hn.any3d?ds(v.el,ie,$):Nn(v.el,ie)},_resetGrid:function(){var v=this._map,I=v.options.crs,D=this._tileSize=this.getTileSize(),$=this._tileZoom,ie=this._map.getPixelWorldBounds(this._tileZoom);ie&&(this._globalTileRange=this._pxBoundsToTileRange(ie)),this._wrapX=I.wrapLng&&!this.options.noWrap&&[Math.floor(v.project([0,I.wrapLng[0]],$).x/D.x),Math.ceil(v.project([0,I.wrapLng[1]],$).x/D.y)],this._wrapY=I.wrapLat&&!this.options.noWrap&&[Math.floor(v.project([I.wrapLat[0],0],$).y/D.x),Math.ceil(v.project([I.wrapLat[1],0],$).y/D.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(v){var I=this._map,D=I._animatingZoom?Math.max(I._animateToZoom,I.getZoom()):I.getZoom(),$=I.getZoomScale(D,this._tileZoom),ie=I.project(v,this._tileZoom).floor(),fe=I.getSize().divideBy($*2);return new qe(ie.subtract(fe),ie.add(fe))},_update:function(v){var I=this._map;if(I){var D=this._clampZoom(I.getZoom());if(v===void 0&&(v=I.getCenter()),this._tileZoom!==void 0){var $=this._getTiledPixelBounds(v),ie=this._pxBoundsToTileRange($),fe=ie.getCenter(),_e=[],je=this.options.keepBuffer,Je=new qe(ie.getBottomLeft().subtract([je,-je]),ie.getTopRight().add([je,-je]));if(!(isFinite(ie.min.x)&&isFinite(ie.min.y)&&isFinite(ie.max.x)&&isFinite(ie.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ct in this._tiles){var yn=this._tiles[Ct].coords;(yn.z!==this._tileZoom||!Je.contains(new Ae(yn.x,yn.y)))&&(this._tiles[Ct].current=!1)}if(Math.abs(D-this._tileZoom)>1){this._setView(v,D);return}for(var On=ie.min.y;On<=ie.max.y;On++)for(var gi=ie.min.x;gi<=ie.max.x;gi++){var uo=new Ae(gi,On);if(uo.z=this._tileZoom,!!this._isValidTile(uo)){var ms=this._tiles[this._tileCoordsToKey(uo)];ms?ms.current=!0:_e.push(uo)}}if(_e.sort(function(Br,lf){return Br.distanceTo(fe)-lf.distanceTo(fe)}),_e.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Oa=document.createDocumentFragment();for(gi=0;gi<_e.length;gi++)this._addTile(_e[gi],Oa);this._level.el.appendChild(Oa)}}}},_isValidTile:function(v){var I=this._map.options.crs;if(!I.infinite){var D=this._globalTileRange;if(!I.wrapLng&&(v.x<D.min.x||v.x>D.max.x)||!I.wrapLat&&(v.y<D.min.y||v.y>D.max.y))return!1}if(!this.options.bounds)return!0;var $=this._tileCoordsToBounds(v);return xt(this.options.bounds).overlaps($)},_keyToBounds:function(v){return this._tileCoordsToBounds(this._keyToTileCoords(v))},_tileCoordsToNwSe:function(v){var I=this._map,D=this.getTileSize(),$=v.scaleBy(D),ie=$.add(D),fe=I.unproject($,v.z),_e=I.unproject(ie,v.z);return[fe,_e]},_tileCoordsToBounds:function(v){var I=this._tileCoordsToNwSe(v),D=new Wt(I[0],I[1]);return this.options.noWrap||(D=this._map.wrapLatLngBounds(D)),D},_tileCoordsToKey:function(v){return v.x+":"+v.y+":"+v.z},_keyToTileCoords:function(v){var I=v.split(":"),D=new Ae(+I[0],+I[1]);return D.z=+I[2],D},_removeTile:function(v){var I=this._tiles[v];I&&(gn(I.el),delete this._tiles[v],this.fire("tileunload",{tile:I.el,coords:this._keyToTileCoords(v)}))},_initTile:function(v){Ht(v,"leaflet-tile");var I=this.getTileSize();v.style.width=I.x+"px",v.style.height=I.y+"px",v.onselectstart=b,v.onmousemove=b,hn.ielt9&&this.options.opacity<1&&Oi(v,this.options.opacity)},_addTile:function(v,I){var D=this._getTilePos(v),$=this._tileCoordsToKey(v),ie=this.createTile(this._wrapCoords(v),u(this._tileReady,this,v));this._initTile(ie),this.createTile.length<2&&ee(u(this._tileReady,this,v,null,ie)),Nn(ie,D),this._tiles[$]={el:ie,coords:v,current:!0},I.appendChild(ie),this.fire("tileloadstart",{tile:ie,coords:v})},_tileReady:function(v,I,D){I&&this.fire("tileerror",{error:I,tile:D,coords:v});var $=this._tileCoordsToKey(v);D=this._tiles[$],D&&(D.loaded=+new Date,this._map._fadeAnimated?(Oi(D.el,0),de(this._fadeFrame),this._fadeFrame=ee(this._updateOpacity,this)):(D.active=!0,this._pruneTiles()),I||(Ht(D.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:D.el,coords:v})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),hn.ielt9||!this._map._fadeAnimated?ee(this._pruneTiles,this):setTimeout(u(this._pruneTiles,this),250)))},_getTilePos:function(v){return v.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(v){var I=new Ae(this._wrapX?x(v.x,this._wrapX):v.x,this._wrapY?x(v.y,this._wrapY):v.y);return I.z=v.z,I},_pxBoundsToTileRange:function(v){var I=this.getTileSize();return new qe(v.min.unscaleBy(I).floor(),v.max.unscaleBy(I).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var v in this._tiles)if(!this._tiles[v].loaded)return!1;return!0}});function Oh(v){return new sf(v)}var Bs=sf.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(v,I){this._url=v,I=R(this,I),I.detectRetina&&hn.retina&&I.maxZoom>0?(I.tileSize=Math.floor(I.tileSize/2),I.zoomReverse?(I.zoomOffset--,I.minZoom=Math.min(I.maxZoom,I.minZoom+1)):(I.zoomOffset++,I.maxZoom=Math.max(I.minZoom,I.maxZoom-1)),I.minZoom=Math.max(0,I.minZoom)):I.zoomReverse?I.minZoom=Math.min(I.maxZoom,I.minZoom):I.maxZoom=Math.max(I.minZoom,I.maxZoom),typeof I.subdomains=="string"&&(I.subdomains=I.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(v,I){return this._url===v&&I===void 0&&(I=!0),this._url=v,I||this.redraw(),this},createTile:function(v,I){var D=document.createElement("img");return Xn(D,"load",u(this._tileOnLoad,this,I,D)),Xn(D,"error",u(this._tileOnError,this,I,D)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(D.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(D.referrerPolicy=this.options.referrerPolicy),D.alt="",D.src=this.getTileUrl(v),D},getTileUrl:function(v){var I={r:hn.retina?"@2x":"",s:this._getSubdomain(v),x:v.x,y:v.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var D=this._globalTileRange.max.y-v.y;this.options.tms&&(I.y=D),I["-y"]=D}return F(this._url,s(I,this.options))},_tileOnLoad:function(v,I){hn.ielt9?setTimeout(u(v,this,null,I),0):v(null,I)},_tileOnError:function(v,I,D){var $=this.options.errorTileUrl;$&&I.getAttribute("src")!==$&&(I.src=$),v(D,I)},_onTileRemove:function(v){v.tile.onload=null},_getZoomForUrl:function(){var v=this._tileZoom,I=this.options.maxZoom,D=this.options.zoomReverse,$=this.options.zoomOffset;return D&&(v=I-v),v+$},_getSubdomain:function(v){var I=Math.abs(v.x+v.y)%this.options.subdomains.length;return this.options.subdomains[I]},_abortLoading:function(){var v,I;for(v in this._tiles)if(this._tiles[v].coords.z!==this._tileZoom&&(I=this._tiles[v].el,I.onload=b,I.onerror=b,!I.complete)){I.src=q;var D=this._tiles[v].coords;gn(I),delete this._tiles[v],this.fire("tileabort",{tile:I,coords:D})}},_removeTile:function(v){var I=this._tiles[v];if(I)return I.el.setAttribute("src",q),sf.prototype._removeTile.call(this,v)},_tileReady:function(v,I,D){if(!(!this._map||D&&D.getAttribute("src")===q))return sf.prototype._tileReady.call(this,v,I,D)}});function Ji(v,I){return new Bs(v,I)}var am=Bs.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(v,I){this._url=v;var D=s({},this.defaultWmsParams);for(var $ in I)$ in this.options||(D[$]=I[$]);I=R(this,I);var ie=I.detectRetina&&hn.retina?2:1,fe=this.getTileSize();D.width=fe.x*ie,D.height=fe.y*ie,this.wmsParams=D},onAdd:function(v){this._crs=this.options.crs||v.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var I=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[I]=this._crs.code,Bs.prototype.onAdd.call(this,v)},getTileUrl:function(v){var I=this._tileCoordsToNwSe(v),D=this._crs,$=dt(D.project(I[0]),D.project(I[1])),ie=$.min,fe=$.max,_e=(this._wmsVersion>=1.3&&this._crs===Bh?[ie.y,ie.x,fe.y,fe.x]:[ie.x,ie.y,fe.x,fe.y]).join(","),je=Bs.prototype.getTileUrl.call(this,v);return je+P(this.wmsParams,je,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+_e},setParams:function(v,I){return s(this.wmsParams,v),I||this.redraw(),this}});function cv(v,I){return new am(v,I)}Bs.WMS=am,Ji.wms=cv;var ts=Da.extend({options:{padding:.1},initialize:function(v){R(this,v),p(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ht(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var v={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(v.zoomanim=this._onAnimZoom),v},_onAnimZoom:function(v){this._updateTransform(v.center,v.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(v,I){var D=this._map.getZoomScale(I,this._zoom),$=this._map.getSize().multiplyBy(.5+this.options.padding),ie=this._map.project(this._center,I),fe=$.multiplyBy(-D).add(ie).subtract(this._map._getNewPixelOrigin(v,I));hn.any3d?ds(this._container,fe,D):Nn(this._container,fe)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var v in this._layers)this._layers[v]._reset()},_onZoomEnd:function(){for(var v in this._layers)this._layers[v]._project()},_updatePaths:function(){for(var v in this._layers)this._layers[v]._update()},_update:function(){var v=this.options.padding,I=this._map.getSize(),D=this._map.containerPointToLayerPoint(I.multiplyBy(-v)).round();this._bounds=new qe(D,D.add(I.multiplyBy(1+v*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),uv=ts.extend({options:{tolerance:0},getEvents:function(){var v=ts.prototype.getEvents.call(this);return v.viewprereset=this._onViewPreReset,v},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ts.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var v=this._container=document.createElement("canvas");Xn(v,"mousemove",this._onMouseMove,this),Xn(v,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Xn(v,"mouseout",this._handleMouseOut,this),v._leaflet_disable_events=!0,this._ctx=v.getContext("2d")},_destroyContainer:function(){de(this._redrawRequest),delete this._ctx,gn(this._container),ki(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var v;this._redrawBounds=null;for(var I in this._layers)v=this._layers[I],v._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ts.prototype._update.call(this);var v=this._bounds,I=this._container,D=v.getSize(),$=hn.retina?2:1;Nn(I,v.min),I.width=$*D.x,I.height=$*D.y,I.style.width=D.x+"px",I.style.height=D.y+"px",hn.retina&&this._ctx.scale(2,2),this._ctx.translate(-v.min.x,-v.min.y),this.fire("update")}},_reset:function(){ts.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(v){this._updateDashArray(v),this._layers[p(v)]=v;var I=v._order={layer:v,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=I),this._drawLast=I,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(v){this._requestRedraw(v)},_removePath:function(v){var I=v._order,D=I.next,$=I.prev;D?D.prev=$:this._drawLast=$,$?$.next=D:this._drawFirst=D,delete v._order,delete this._layers[p(v)],this._requestRedraw(v)},_updatePath:function(v){this._extendRedrawBounds(v),v._project(),v._update(),this._requestRedraw(v)},_updateStyle:function(v){this._updateDashArray(v),this._requestRedraw(v)},_updateDashArray:function(v){if(typeof v.options.dashArray=="string"){var I=v.options.dashArray.split(/[, ]+/),D=[],$,ie;for(ie=0;ie<I.length;ie++){if($=Number(I[ie]),isNaN($))return;D.push($)}v.options._dashArray=D}else v.options._dashArray=v.options.dashArray},_requestRedraw:function(v){this._map&&(this._extendRedrawBounds(v),this._redrawRequest=this._redrawRequest||ee(this._redraw,this))},_extendRedrawBounds:function(v){if(v._pxBounds){var I=(v.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new qe,this._redrawBounds.extend(v._pxBounds.min.subtract([I,I])),this._redrawBounds.extend(v._pxBounds.max.add([I,I]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var v=this._redrawBounds;if(v){var I=v.getSize();this._ctx.clearRect(v.min.x,v.min.y,I.x,I.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var v,I=this._redrawBounds;if(this._ctx.save(),I){var D=I.getSize();this._ctx.beginPath(),this._ctx.rect(I.min.x,I.min.y,D.x,D.y),this._ctx.clip()}this._drawing=!0;for(var $=this._drawFirst;$;$=$.next)v=$.layer,(!I||v._pxBounds&&v._pxBounds.intersects(I))&&v._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(v,I){if(this._drawing){var D,$,ie,fe,_e=v._parts,je=_e.length,Je=this._ctx;if(je){for(Je.beginPath(),D=0;D<je;D++){for($=0,ie=_e[D].length;$<ie;$++)fe=_e[D][$],Je[$?"lineTo":"moveTo"](fe.x,fe.y);I&&Je.closePath()}this._fillStroke(Je,v)}}},_updateCircle:function(v){if(!(!this._drawing||v._empty())){var I=v._point,D=this._ctx,$=Math.max(Math.round(v._radius),1),ie=(Math.max(Math.round(v._radiusY),1)||$)/$;ie!==1&&(D.save(),D.scale(1,ie)),D.beginPath(),D.arc(I.x,I.y/ie,$,0,Math.PI*2,!1),ie!==1&&D.restore(),this._fillStroke(D,v)}},_fillStroke:function(v,I){var D=I.options;D.fill&&(v.globalAlpha=D.fillOpacity,v.fillStyle=D.fillColor||D.color,v.fill(D.fillRule||"evenodd")),D.stroke&&D.weight!==0&&(v.setLineDash&&v.setLineDash(I.options&&I.options._dashArray||[]),v.globalAlpha=D.opacity,v.lineWidth=D.weight,v.strokeStyle=D.color,v.lineCap=D.lineCap,v.lineJoin=D.lineJoin,v.stroke())},_onClick:function(v){for(var I=this._map.mouseEventToLayerPoint(v),D,$,ie=this._drawFirst;ie;ie=ie.next)D=ie.layer,D.options.interactive&&D._containsPoint(I)&&(!(v.type==="click"||v.type==="preclick")||!this._map._draggableMoved(D))&&($=D);this._fireEvent($?[$]:!1,v)},_onMouseMove:function(v){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var I=this._map.mouseEventToLayerPoint(v);this._handleMouseHover(v,I)}},_handleMouseOut:function(v){var I=this._hoveredLayer;I&&(jt(this._container,"leaflet-interactive"),this._fireEvent([I],v,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(v,I){if(!this._mouseHoverThrottled){for(var D,$,ie=this._drawFirst;ie;ie=ie.next)D=ie.layer,D.options.interactive&&D._containsPoint(I)&&($=D);$!==this._hoveredLayer&&(this._handleMouseOut(v),$&&(Ht(this._container,"leaflet-interactive"),this._fireEvent([$],v,"mouseover"),this._hoveredLayer=$)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,v),this._mouseHoverThrottled=!0,setTimeout(u(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(v,I,D){this._map._fireDOMEvent(I,D||I.type,v)},_bringToFront:function(v){var I=v._order;if(I){var D=I.next,$=I.prev;if(D)D.prev=$;else return;$?$.next=D:D&&(this._drawFirst=D),I.prev=this._drawLast,this._drawLast.next=I,I.next=null,this._drawLast=I,this._requestRedraw(v)}},_bringToBack:function(v){var I=v._order;if(I){var D=I.next,$=I.prev;if($)$.next=D;else return;D?D.prev=$:$&&(this._drawLast=$),I.prev=null,I.next=this._drawFirst,this._drawFirst.prev=I,this._drawFirst=I,this._requestRedraw(v)}}});function Ew(v){return hn.canvas?new uv(v):null}var Wl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(v){return document.createElement("<lvml:"+v+' class="lvml">')}}catch{}return function(v){return document.createElement("<"+v+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),_w={_initContainer:function(){this._container=zt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ts.prototype._update.call(this),this.fire("update"))},_initPath:function(v){var I=v._container=Wl("shape");Ht(I,"leaflet-vml-shape "+(this.options.className||"")),I.coordsize="1 1",v._path=Wl("path"),I.appendChild(v._path),this._updateStyle(v),this._layers[p(v)]=v},_addPath:function(v){var I=v._container;this._container.appendChild(I),v.options.interactive&&v.addInteractiveTarget(I)},_removePath:function(v){var I=v._container;gn(I),v.removeInteractiveTarget(I),delete this._layers[p(v)]},_updateStyle:function(v){var I=v._stroke,D=v._fill,$=v.options,ie=v._container;ie.stroked=!!$.stroke,ie.filled=!!$.fill,$.stroke?(I||(I=v._stroke=Wl("stroke")),ie.appendChild(I),I.weight=$.weight+"px",I.color=$.color,I.opacity=$.opacity,$.dashArray?I.dashStyle=V($.dashArray)?$.dashArray.join(" "):$.dashArray.replace(/( *, *)/g," "):I.dashStyle="",I.endcap=$.lineCap.replace("butt","flat"),I.joinstyle=$.lineJoin):I&&(ie.removeChild(I),v._stroke=null),$.fill?(D||(D=v._fill=Wl("fill")),ie.appendChild(D),D.color=$.fillColor||$.color,D.opacity=$.fillOpacity):D&&(ie.removeChild(D),v._fill=null)},_updateCircle:function(v){var I=v._point.round(),D=Math.round(v._radius),$=Math.round(v._radiusY||D);this._setPath(v,v._empty()?"M0 0":"AL "+I.x+","+I.y+" "+D+","+$+" 0,"+65535*360)},_setPath:function(v,I){v._path.v=I},_bringToFront:function(v){Ci(v._container)},_bringToBack:function(v){bi(v._container)}},lm=hn.vml?Wl:Ee,of=ts.extend({_initContainer:function(){this._container=lm("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=lm("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){gn(this._container),ki(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ts.prototype._update.call(this);var v=this._bounds,I=v.getSize(),D=this._container;(!this._svgSize||!this._svgSize.equals(I))&&(this._svgSize=I,D.setAttribute("width",I.x),D.setAttribute("height",I.y)),Nn(D,v.min),D.setAttribute("viewBox",[v.min.x,v.min.y,I.x,I.y].join(" ")),this.fire("update")}},_initPath:function(v){var I=v._path=lm("path");v.options.className&&Ht(I,v.options.className),v.options.interactive&&Ht(I,"leaflet-interactive"),this._updateStyle(v),this._layers[p(v)]=v},_addPath:function(v){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(v._path),v.addInteractiveTarget(v._path)},_removePath:function(v){gn(v._path),v.removeInteractiveTarget(v._path),delete this._layers[p(v)]},_updatePath:function(v){v._project(),v._update()},_updateStyle:function(v){var I=v._path,D=v.options;I&&(D.stroke?(I.setAttribute("stroke",D.color),I.setAttribute("stroke-opacity",D.opacity),I.setAttribute("stroke-width",D.weight),I.setAttribute("stroke-linecap",D.lineCap),I.setAttribute("stroke-linejoin",D.lineJoin),D.dashArray?I.setAttribute("stroke-dasharray",D.dashArray):I.removeAttribute("stroke-dasharray"),D.dashOffset?I.setAttribute("stroke-dashoffset",D.dashOffset):I.removeAttribute("stroke-dashoffset")):I.setAttribute("stroke","none"),D.fill?(I.setAttribute("fill",D.fillColor||D.color),I.setAttribute("fill-opacity",D.fillOpacity),I.setAttribute("fill-rule",D.fillRule||"evenodd")):I.setAttribute("fill","none"))},_updatePoly:function(v,I){this._setPath(v,Te(v._parts,I))},_updateCircle:function(v){var I=v._point,D=Math.max(Math.round(v._radius),1),$=Math.max(Math.round(v._radiusY),1)||D,ie="a"+D+","+$+" 0 1,0 ",fe=v._empty()?"M0 0":"M"+(I.x-D)+","+I.y+ie+D*2+",0 "+ie+-D*2+",0 ";this._setPath(v,fe)},_setPath:function(v,I){v._path.setAttribute("d",I)},_bringToFront:function(v){Ci(v._path)},_bringToBack:function(v){bi(v._path)}});hn.vml&&of.include(_w);function ca(v){return hn.svg||hn.vml?new of(v):null}ui.include({getRenderer:function(v){var I=v.options.renderer||this._getPaneRenderer(v.options.pane)||this.options.renderer||this._renderer;return I||(I=this._renderer=this._createRenderer()),this.hasLayer(I)||this.addLayer(I),I},_getPaneRenderer:function(v){if(v==="overlayPane"||v===void 0)return!1;var I=this._paneRenderers[v];return I===void 0&&(I=this._createRenderer({pane:v}),this._paneRenderers[v]=I),I},_createRenderer:function(v){return this.options.preferCanvas&&Ew(v)||ca(v)}});var Su=Sc.extend({initialize:function(v,I){Sc.prototype.initialize.call(this,this._boundsToLatLngs(v),I)},setBounds:function(v){return this.setLatLngs(this._boundsToLatLngs(v))},_boundsToLatLngs:function(v){return v=xt(v),[v.getSouthWest(),v.getNorthWest(),v.getNorthEast(),v.getSouthEast()]}});function af(v,I){return new Su(v,I)}of.create=lm,of.pointsToPath=Te,aa.geometryToLayer=tf,aa.coordsToLatLng=nf,aa.coordsToLatLngs=Nh,aa.latLngToCoords=A0,aa.latLngsToCoords=Ks,aa.getFeature=rf,aa.asFeature=Dh,ui.mergeOptions({boxZoom:!0});var hv=Ls.extend({initialize:function(v){this._map=v,this._container=v._container,this._pane=v._panes.overlayPane,this._resetStateTimeout=0,v.on("unload",this._destroy,this)},addHooks:function(){Xn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ki(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){gn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(v){if(!v.shiftKey||v.which!==1&&v.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),pr(),Ba(),this._startPoint=this._map.mouseEventToContainerPoint(v),Xn(document,{contextmenu:ia,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(v){this._moved||(this._moved=!0,this._box=zt("div","leaflet-zoom-box",this._container),Ht(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(v);var I=new qe(this._point,this._startPoint),D=I.getSize();Nn(this._box,I.min),this._box.style.width=D.x+"px",this._box.style.height=D.y+"px"},_finish:function(){this._moved&&(gn(this._box),jt(this._container,"leaflet-crosshair")),mi(),Ih(),ki(document,{contextmenu:ia,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(v){if(!(v.which!==1&&v.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(u(this._resetState,this),0);var I=new Wt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(I).fire("boxzoomend",{boxZoomBounds:I})}},_onKeyDown:function(v){v.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ui.addInitHook("addHandler","boxZoom",hv),ui.mergeOptions({doubleClickZoom:!0});var x0=Ls.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(v){var I=this._map,D=I.getZoom(),$=I.options.zoomDelta,ie=v.originalEvent.shiftKey?D-$:D+$;I.options.doubleClickZoom==="center"?I.setZoom(ie):I.setZoomAround(v.containerPoint,ie)}});ui.addInitHook("addHandler","doubleClickZoom",x0),ui.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var dv=Ls.extend({addHooks:function(){if(!this._draggable){var v=this._map;this._draggable=new ko(v._mapPane,v._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),v.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),v.on("zoomend",this._onZoomEnd,this),v.whenReady(this._onZoomEnd,this))}Ht(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){jt(this._map._container,"leaflet-grab"),jt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var v=this._map;if(v._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var I=xt(this._map.options.maxBounds);this._offsetLimit=dt(this._map.latLngToContainerPoint(I.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(I.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;v.fire("movestart").fire("dragstart"),v.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(v){if(this._map.options.inertia){var I=this._lastTime=+new Date,D=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(D),this._times.push(I),this._prunePositions(I)}this._map.fire("move",v).fire("drag",v)},_prunePositions:function(v){for(;this._positions.length>1&&v-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var v=this._map.getSize().divideBy(2),I=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=I.subtract(v).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(v,I){return v-(v-I)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var v=this._draggable._newPos.subtract(this._draggable._startPos),I=this._offsetLimit;v.x<I.min.x&&(v.x=this._viscousLimit(v.x,I.min.x)),v.y<I.min.y&&(v.y=this._viscousLimit(v.y,I.min.y)),v.x>I.max.x&&(v.x=this._viscousLimit(v.x,I.max.x)),v.y>I.max.y&&(v.y=this._viscousLimit(v.y,I.max.y)),this._draggable._newPos=this._draggable._startPos.add(v)}},_onPreDragWrap:function(){var v=this._worldWidth,I=Math.round(v/2),D=this._initialWorldOffset,$=this._draggable._newPos.x,ie=($-I+D)%v+I-D,fe=($+I+D)%v-I-D,_e=Math.abs(ie+D)<Math.abs(fe+D)?ie:fe;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=_e},_onDragEnd:function(v){var I=this._map,D=I.options,$=!D.inertia||v.noInertia||this._times.length<2;if(I.fire("dragend",v),$)I.fire("moveend");else{this._prunePositions(+new Date);var ie=this._lastPos.subtract(this._positions[0]),fe=(this._lastTime-this._times[0])/1e3,_e=D.easeLinearity,je=ie.multiplyBy(_e/fe),Je=je.distanceTo([0,0]),Ct=Math.min(D.inertiaMaxSpeed,Je),yn=je.multiplyBy(Ct/Je),On=Ct/(D.inertiaDeceleration*_e),gi=yn.multiplyBy(-On/2).round();!gi.x&&!gi.y?I.fire("moveend"):(gi=I._limitOffset(gi,I.options.maxBounds),ee(function(){I.panBy(gi,{duration:On,easeLinearity:_e,noMoveStart:!0,animate:!0})}))}}});ui.addInitHook("addHandler","dragging",dv),ui.mergeOptions({keyboard:!0,keyboardPanDelta:80});var fv=Ls.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(v){this._map=v,this._setPanDelta(v.options.keyboardPanDelta),this._setZoomDelta(v.options.zoomDelta)},addHooks:function(){var v=this._map._container;v.tabIndex<=0&&(v.tabIndex="0"),Xn(v,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),ki(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var v=document.body,I=document.documentElement,D=v.scrollTop||I.scrollTop,$=v.scrollLeft||I.scrollLeft;this._map._container.focus(),window.scrollTo($,D)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(v){var I=this._panKeys={},D=this.keyCodes,$,ie;for($=0,ie=D.left.length;$<ie;$++)I[D.left[$]]=[-1*v,0];for($=0,ie=D.right.length;$<ie;$++)I[D.right[$]]=[v,0];for($=0,ie=D.down.length;$<ie;$++)I[D.down[$]]=[0,v];for($=0,ie=D.up.length;$<ie;$++)I[D.up[$]]=[0,-1*v]},_setZoomDelta:function(v){var I=this._zoomKeys={},D=this.keyCodes,$,ie;for($=0,ie=D.zoomIn.length;$<ie;$++)I[D.zoomIn[$]]=v;for($=0,ie=D.zoomOut.length;$<ie;$++)I[D.zoomOut[$]]=-v},_addHooks:function(){Xn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){ki(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(v){if(!(v.altKey||v.ctrlKey||v.metaKey)){var I=v.keyCode,D=this._map,$;if(I in this._panKeys){if(!D._panAnim||!D._panAnim._inProgress)if($=this._panKeys[I],v.shiftKey&&($=Ie($).multiplyBy(3)),D.options.maxBounds&&($=D._limitOffset(Ie($),D.options.maxBounds)),D.options.worldCopyJump){var ie=D.wrapLatLng(D.unproject(D.project(D.getCenter()).add($)));D.panTo(ie)}else D.panBy($)}else if(I in this._zoomKeys)D.setZoom(D.getZoom()+(v.shiftKey?3:1)*this._zoomKeys[I]);else if(I===27&&D._popup&&D._popup.options.closeOnEscapeKey)D.closePopup();else return;ia(v)}}});ui.addInitHook("addHandler","keyboard",fv),ui.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var co=Ls.extend({addHooks:function(){Xn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){ki(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(v){var I=mu(v),D=this._map.options.wheelDebounceTime;this._delta+=I,this._lastMousePos=this._map.mouseEventToContainerPoint(v),this._startTime||(this._startTime=+new Date);var $=Math.max(D-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(u(this._performZoom,this),$),ia(v)},_performZoom:function(){var v=this._map,I=v.getZoom(),D=this._map.options.zoomSnap||0;v._stop();var $=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ie=4*Math.log(2/(1+Math.exp(-Math.abs($))))/Math.LN2,fe=D?Math.ceil(ie/D)*D:ie,_e=v._limitZoom(I+(this._delta>0?fe:-fe))-I;this._delta=0,this._startTime=null,_e&&(v.options.scrollWheelZoom==="center"?v.setZoom(I+_e):v.setZoomAround(this._lastMousePos,I+_e))}});ui.addInitHook("addHandler","scrollWheelZoom",co);var en=600;ui.mergeOptions({tapHold:hn.touchNative&&hn.safari&&hn.mobile,tapTolerance:15});var pv=Ls.extend({addHooks:function(){Xn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ki(this._map._container,"touchstart",this._onDown,this)},_onDown:function(v){if(clearTimeout(this._holdTimeout),v.touches.length===1){var I=v.touches[0];this._startPos=this._newPos=new Ae(I.clientX,I.clientY),this._holdTimeout=setTimeout(u(function(){this._cancel(),this._isTapValid()&&(Xn(document,"touchend",mr),Xn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",I))},this),en),Xn(document,"touchend touchcancel contextmenu",this._cancel,this),Xn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function v(){ki(document,"touchend",mr),ki(document,"touchend touchcancel",v)},_cancel:function(){clearTimeout(this._holdTimeout),ki(document,"touchend touchcancel contextmenu",this._cancel,this),ki(document,"touchmove",this._onMove,this)},_onMove:function(v){var I=v.touches[0];this._newPos=new Ae(I.clientX,I.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(v,I){var D=new MouseEvent(v,{bubbles:!0,cancelable:!0,view:window,screenX:I.screenX,screenY:I.screenY,clientX:I.clientX,clientY:I.clientY});D._simulated=!0,I.target.dispatchEvent(D)}});ui.addInitHook("addHandler","tapHold",pv),ui.mergeOptions({touchZoom:hn.touch,bounceAtZoomLimits:!0});var Iw=Ls.extend({addHooks:function(){Ht(this._map._container,"leaflet-touch-zoom"),Xn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){jt(this._map._container,"leaflet-touch-zoom"),ki(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(v){var I=this._map;if(!(!v.touches||v.touches.length!==2||I._animatingZoom||this._zooming)){var D=I.mouseEventToContainerPoint(v.touches[0]),$=I.mouseEventToContainerPoint(v.touches[1]);this._centerPoint=I.getSize()._divideBy(2),this._startLatLng=I.containerPointToLatLng(this._centerPoint),I.options.touchZoom!=="center"&&(this._pinchStartLatLng=I.containerPointToLatLng(D.add($)._divideBy(2))),this._startDist=D.distanceTo($),this._startZoom=I.getZoom(),this._moved=!1,this._zooming=!0,I._stop(),Xn(document,"touchmove",this._onTouchMove,this),Xn(document,"touchend touchcancel",this._onTouchEnd,this),mr(v)}},_onTouchMove:function(v){if(!(!v.touches||v.touches.length!==2||!this._zooming)){var I=this._map,D=I.mouseEventToContainerPoint(v.touches[0]),$=I.mouseEventToContainerPoint(v.touches[1]),ie=D.distanceTo($)/this._startDist;if(this._zoom=I.getScaleZoom(ie,this._startZoom),!I.options.bounceAtZoomLimits&&(this._zoom<I.getMinZoom()&&ie<1||this._zoom>I.getMaxZoom()&&ie>1)&&(this._zoom=I._limitZoom(this._zoom)),I.options.touchZoom==="center"){if(this._center=this._startLatLng,ie===1)return}else{var fe=D._add($)._divideBy(2)._subtract(this._centerPoint);if(ie===1&&fe.x===0&&fe.y===0)return;this._center=I.unproject(I.project(this._pinchStartLatLng,this._zoom).subtract(fe),this._zoom)}this._moved||(I._moveStart(!0,!1),this._moved=!0),de(this._animRequest);var _e=u(I._move,I,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ee(_e,this,!0),mr(v)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,de(this._animRequest),ki(document,"touchmove",this._onTouchMove,this),ki(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ui.addInitHook("addHandler","touchZoom",Iw),ui.BoxZoom=hv,ui.DoubleClickZoom=x0,ui.Drag=dv,ui.Keyboard=fv,ui.ScrollWheelZoom=co,ui.TapHold=pv,ui.TouchZoom=Iw,t.Bounds=qe,t.Browser=hn,t.CRS=Et,t.Canvas=uv,t.Circle=rm,t.CircleMarker=Iu,t.Class=we,t.Control=Rs,t.DivIcon=lo,t.DivOverlay=Gl,t.DomEvent=Cc,t.DomUtil=Zd,t.Draggable=ko,t.Evented=Ne,t.FeatureGroup=dl,t.GeoJSON=aa,t.GridLayer=sf,t.Handler=Ls,t.Icon=Eu,t.ImageOverlay=om,t.LatLng=At,t.LatLngBounds=Wt,t.Layer=Da,t.LayerGroup=Ph,t.LineUtil=so,t.Map=ui,t.Marker=_u,t.Mixin=bu,t.Path=Fa,t.Point=Ae,t.PolyUtil=zl,t.Polygon=Sc,t.Polyline=fl,t.Popup=b0,t.PosAnimation=Th,t.Projection=oa,t.Rectangle=Su,t.Renderer=ts,t.SVG=of,t.SVGOverlay=lv,t.TileLayer=Bs,t.Tooltip=ao,t.Transformation=Yt,t.Util=oe,t.VideoOverlay=bw,t.bind=u,t.bounds=dt,t.canvas=Ew,t.circle=ef,t.circleMarker=av,t.control=ra,t.divIcon=Cw,t.extend=s,t.featureGroup=sv,t.geoJSON=v0,t.geoJson=vw,t.gridLayer=Oh,t.icon=Aw,t.imageOverlay=la,t.latLng=Rt,t.latLngBounds=xt,t.layerGroup=nm,t.map=Ec,t.marker=im,t.point=Ie,t.polygon=g0,t.polyline=m0,t.popup=ww,t.rectangle=af,t.setOptions=R,t.stamp=p,t.svg=ca,t.svgOverlay=Fh,t.tileLayer=Ji,t.tooltip=ir,t.transformation=ht,t.version=i,t.videoOverlay=xw;var Vh=window.L;t.noConflict=function(){return window.L=Vh,this},window.L=t})})(zD,zD.exports);var qA=zD.exports;const Bne=t7(qA);function vT(n,e,t){return Object.freeze({instance:n,context:e,container:t})}function Pne(n,e){return e==null?function(i,s){const l=Le.useRef();return l.current||(l.current=n(i,s)),l}:function(i,s){const l=Le.useRef();l.current||(l.current=n(i,s));const u=Le.useRef(i),{instance:d}=l.current;return Le.useEffect(function(){u.current!==i&&(e(d,i,u.current),u.current=i)},[d,i,s]),l}}function Nne(n,e){Le.useEffect(function(){return(e.layerContainer??e.map).addLayer(n.instance),function(){var l;(l=e.layerContainer)==null||l.removeLayer(n.instance),e.map.removeLayer(n.instance)}},[e,n])}function IHe(n){return function(t){const i=ZO(),s=n(jO(t,i),i);return bHe(i.map,t.attribution),Lne(s.current,t.eventHandlers),Nne(s.current,i),s}}function SHe(n,e){const t=Le.useRef();Le.useEffect(function(){if(e.pathOptions!==t.current){const s=e.pathOptions??{};n.instance.setStyle(s),t.current=s}},[n,e])}function THe(n){return function(t){const i=ZO(),s=n(jO(t,i),i);return Lne(s.current,t.eventHandlers),Nne(s.current,i),SHe(s.current,t),s}}function YO(n,e){const t=Pne(n,e),i=THe(t);return EHe(i)}function MHe(n,e){const t=Pne(n,e),i=IHe(t);return _He(i)}function kHe(n,e,t){const{opacity:i,zIndex:s}=e;i!=null&&i!==t.opacity&&n.setOpacity(i),s!=null&&s!==t.zIndex&&n.setZIndex(s)}function bT(){return ZO().map}function RHe(n){const e=bT();return Le.useEffect(function(){return e.on(n),function(){e.off(n)}},[e,n]),e}const GD=YO(function({center:e,children:t,...i},s){const l=new qA.CircleMarker(e,i);return vT(l,KO(s,{overlayContainer:l}))},xHe);function WD(){return WD=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},WD.apply(this,arguments)}function LHe({bounds:n,boundsOptions:e,center:t,children:i,className:s,id:l,placeholder:u,style:d,whenReady:p,zoom:g,...x},b){const[E]=Le.useState({className:s,id:l,style:d}),[S,M]=Le.useState(null);Le.useImperativeHandle(b,()=>(S==null?void 0:S.map)??null,[S]);const R=Le.useCallback(k=>{if(k!==null&&S===null){const F=new qA.Map(k,x);t!=null&&g!=null?F.setView(t,g):n!=null&&F.fitBounds(n,e),p!=null&&F.whenReady(p),M(CHe(F))}},[]);Le.useEffect(()=>()=>{S==null||S.map.remove()},[S]);const P=S?Vg.createElement(Rne,{value:S},i):u??null;return Vg.createElement("div",WD({},E,{ref:R}),P)}const BHe=Le.forwardRef(LHe),PHe=YO(function({positions:e,...t},i){const s=new qA.Polygon(e,t);return vT(s,KO(i,{overlayContainer:s}))},function(e,t,i){t.positions!==i.positions&&e.setLatLngs(t.positions)}),NHe=YO(function({positions:e,...t},i){const s=new qA.Polyline(e,t);return vT(s,KO(i,{overlayContainer:s}))},function(e,t,i){t.positions!==i.positions&&e.setLatLngs(t.positions)}),DHe=MHe(function({url:e,...t},i){const s=new qA.TileLayer(e,jO(t,i));return vT(s,i)},function(e,t,i){kHe(e,t,i);const{url:s}=t;s!=null&&s!==i.url&&e.setUrl(s)});delete Bne.Icon.Default.prototype._getIconUrl;Bne.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});function FHe({devMode:n}){const[e,t]=Le.useState(wne),[i,s]=Le.useState(xne);return RHe({zoomend:l=>t(l.target.getZoom()),moveend:l=>{const u=l.target.getCenter();s([u.lat.toFixed(6),u.lng.toFixed(6)])}}),n?he.jsx("div",{className:"absolute bottom-24 left-4 z-[1000] bg-black/80 backdrop-blur-sm rounded-lg px-2 py-1 border border-purple-500/30",children:he.jsxs("div",{className:"text-[10px] font-mono text-purple-400",children:[he.jsxs("div",{children:["zoom: ",e]}),he.jsxs("div",{children:["lat: ",i[0]]}),he.jsxs("div",{children:["lng: ",i[1]]})]})}):null}function OHe({hood:n}){const e=bT();return Le.useEffect(()=>{n&&e.flyTo(n.center,n.zoom,{duration:1.5})},[n,e]),null}function VHe({onShow:n}){const e=bT(),[t,i]=Le.useState(null);if(Le.useEffect(()=>{const l=localStorage.getItem("streetart-ctf-lastCapture");if(l){const u=JSON.parse(l);i(u),localStorage.removeItem("streetart-ctf-lastCapture"),u.location&&setTimeout(()=>{e.flyTo(u.location,17,{duration:1.5}),n&&n(u)},500)}},[e,n]),!t)return null;const s=t.team==="red"?"#ff6b6b":"#4dabf7";return he.jsx(GD,{center:t.location,radius:30,pathOptions:{color:s,fillColor:s,fillOpacity:.3,weight:3,className:"capture-pulse"}})}function UHe(){const n=bT(),[e,t]=Le.useState(!1),i=()=>{t(!0),n.locate({setView:!0,maxZoom:16}),setTimeout(()=>t(!1),2e3)};return he.jsx(Mn.button,{onClick:i,className:"absolute bottom-24 right-4 z-[1000] w-12 h-12 rounded-xl bg-black/80 backdrop-blur-sm border border-white/10 flex items-center justify-center",whileTap:{scale:.95},children:he.jsx(Mn.div,{animate:e?{rotate:360}:{},transition:{duration:1,repeat:e?1/0:0},children:he.jsx(sHe,{size:20,className:"text-white"})})})}function zHe({point:n,onClose:e}){const t=n.capturedBy?Ny(n.capturedBy):"#495057",i=HO(n),s=n.status==="ghost";return he.jsx(Mn.div,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{type:"spring",stiffness:300,damping:30},className:"absolute bottom-20 left-4 right-4 z-[1000]",children:he.jsxs("div",{className:"bg-black/90 backdrop-blur-xl rounded-2xl p-4 border",style:{borderColor:`${t}40`},children:[he.jsx("button",{onClick:e,className:"absolute top-3 right-3 w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center hover:bg-white/10 transition-colors",children:he.jsx(gHe,{size:16,className:"text-white/50"})}),he.jsxs("div",{className:"flex items-start gap-3",children:[he.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center",style:{backgroundColor:`${t}20`,border:`1px solid ${t}40`},children:s?he.jsx(lHe,{size:20,className:"text-white/30"}):n.capturedBy?he.jsx(QO,{size:20,style:{color:t}}):he.jsx(XO,{size:20,style:{color:t}})}),he.jsxs("div",{className:"flex-1",children:[he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("h3",{className:"font-bold text-lg text-white",children:n.name}),s&&he.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-white/10 text-white/40",children:"GHOST"})]}),he.jsx("p",{className:"text-sm text-white/40",children:n.area}),he.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[he.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-white/5 text-white/50 capitalize",children:n.size}),n.mhd&&he.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${n.mhd==="metroB"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:n.mhd==="metroB"?" Metro B":" Tram 12"})]}),he.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[he.jsxs("span",{className:"text-lg font-bold",style:{color:t},children:[i," pts"]}),n.capturedBy?he.jsxs("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:`${t}20`,color:t},children:["Captured by ",n.capturedBy]}):he.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-white/10 text-white/60",children:s?"Gone":"Unclaimed"})]})]})]})]})})}const AB=[null,...Sp];function GHe(){const{player:n,artPoints:e,captureArt:t}=Kd(),[i,s]=Le.useState(null),[l,u]=Le.useState(!1),[d,p]=Le.useState(e),[g,x]=Le.useState(UD.vysocany);Le.useEffect(()=>{p(e)},[e]);const b=k=>{l?p(F=>F.map(V=>{if(V.id===k.id){const q=(AB.indexOf(V.capturedBy)+1)%AB.length;return{...V,capturedBy:AB[q]}}return V})):s(k)},E=()=>{p(e.map(k=>({...k,capturedBy:null})))},S=l?d:e,M=Le.useMemo(()=>Z9e(S),[S]),R=Le.useMemo(()=>Cne(S),[S]),P=Object.values(R).reduce((k,F)=>k+F,0)||1;return he.jsxs("div",{className:"relative w-full h-full",children:[he.jsx("div",{className:"absolute top-4 left-4 right-4 z-[1000] flex gap-0.5 h-1.5 rounded-full overflow-hidden bg-black/40 backdrop-blur-sm",children:Object.entries(R).map(([k,F])=>{const V=F/P*100;return he.jsx(Mn.div,{className:"h-full",style:{backgroundColor:Ny(k)},initial:{width:0},animate:{width:`${V}%`},transition:{duration:.8}},k)})}),he.jsxs("div",{className:"absolute top-10 left-4 z-[1000] bg-black/80 backdrop-blur-sm rounded-xl p-3 border border-white/10",children:[he.jsx("p",{className:"text-[10px] text-white/40 uppercase tracking-wider mb-2",children:"Teams"}),he.jsx("div",{className:"space-y-1.5",children:Sp.map(k=>he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:Ny(k)}}),he.jsx("span",{className:"text-xs text-white/70 capitalize font-medium",children:k}),he.jsxs("span",{className:"text-xs text-white/40 ml-auto",children:[R[k]||0," pts"]})]},k))}),he.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[he.jsx("p",{className:"text-[10px] text-white/40 uppercase tracking-wider mb-1.5",children:"Points"}),he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-white/40"}),he.jsx("span",{className:"text-xs text-white/40",children:"Active"})]}),he.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[he.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-dashed border-white/20"}),he.jsx("span",{className:"text-xs text-white/30",children:"Ghost"})]})]}),he.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10",children:[he.jsx("p",{className:"text-[10px] text-white/40 uppercase tracking-wider mb-1.5",children:"Transport"}),he.jsxs("div",{className:"flex items-center gap-2",children:[he.jsx("div",{className:"w-4 h-0.5 bg-yellow-500"}),he.jsx("span",{className:"text-xs text-yellow-500/70",children:"Metro B"})]})]})]}),he.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 z-[1000] flex gap-1 bg-black/80 backdrop-blur-sm rounded-xl p-1 border border-white/10",children:Object.values(UD).map(k=>he.jsx(Mn.button,{onClick:()=>x(k),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${g.id===k.id?"bg-white/20 text-white":"text-white/50 hover:text-white/70"}`,whileTap:{scale:.95},children:k.name},k.id))}),he.jsxs("div",{className:"absolute top-10 right-4 z-[1000] flex flex-col gap-2",children:[he.jsx(Mn.button,{onClick:()=>u(!l),className:`w-10 h-10 rounded-xl backdrop-blur-sm border flex items-center justify-center transition-colors ${l?"bg-purple-500/30 border-purple-500/50 text-purple-400":"bg-black/80 border-white/10 text-white/50"}`,whileTap:{scale:.95},title:"Developer Mode",children:he.jsx(rHe,{size:18})}),l&&he.jsx(Mn.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},onClick:E,className:"w-10 h-10 rounded-xl bg-black/80 backdrop-blur-sm border border-white/10 flex items-center justify-center text-white/50 hover:text-white/80 transition-colors",whileTap:{scale:.95},title:"Reset All Points",children:he.jsx(Ine,{size:18})})]}),he.jsx(RA,{children:l&&he.jsx(Mn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-4 left-1/2 -translate-x-1/2 z-[1000] px-3 py-1.5 rounded-full bg-purple-500/20 border border-purple-500/30 backdrop-blur-sm",children:he.jsx("span",{className:"text-xs text-purple-400 font-medium",children:"DEV MODE  Click points to cycle teams"})})}),he.jsxs(BHe,{center:xne,zoom:wne,minZoom:W9e,maxZoom:H9e,className:"w-full h-full",zoomControl:!1,attributionControl:!1,style:{background:"#0a0a0f"},children:[he.jsx(DHe,{url:p6.tileUrl,attribution:p6.attribution}),he.jsx(UHe,{}),he.jsx(FHe,{devMode:l}),he.jsx(OHe,{hood:g}),he.jsx(VHe,{}),he.jsx(NHe,{positions:m6.map(k=>k.location),pathOptions:{color:"#eab308",weight:4,opacity:.5}}),m6.map(k=>he.jsx(GD,{center:k.location,radius:5,pathOptions:{color:"#eab308",fillColor:"#1a1a2e",fillOpacity:1,weight:2}},k.name)),Object.entries(M).map(([k,F])=>F.map((V,G)=>he.jsx(PHe,{positions:V.polygon,pathOptions:{color:Ny(k),fillColor:Ny(k),fillOpacity:.25,weight:2,opacity:.7,interactive:!1}},`${k}-territory-${G}`))),S.map(k=>{const F=k.capturedBy?Ny(k.capturedBy):"#ffffff",V=!!k.capturedBy,G=k.status==="ghost";return he.jsx(GD,{center:k.location,radius:8,pathOptions:{color:l?"#a855f7":G?"#6b7280":F,fillColor:V?F:G?"#374151":"#0a0a0f",fillOpacity:G?.4:V?.8:1,weight:l?3:2,opacity:G?.5:1,dashArray:G?"3, 3":void 0},eventHandlers:{click:q=>{q.originalEvent.stopPropagation(),b(k)}}},k.id)})]}),he.jsx(RA,{children:i&&he.jsx(zHe,{point:i,onClose:()=>s(null)})})]})}function WHe(){return he.jsx(Mn.div,{className:"flex-1 relative",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:he.jsx(GHe,{})})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const xT="173",HHe={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},XHe={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Dne=0,HD=1,Fne=2,$He=3,QHe=0,qO=1,One=2,Yu=3,Gd=0,Ta=1,nh=2,Sd=0,Ng=1,XD=2,$D=3,QD=4,Vne=5,sp=100,Une=101,zne=102,Gne=103,Wne=104,Hne=200,Xne=201,$ne=202,Qne=203,x2=204,w2=205,Kne=206,Zne=207,jne=208,Yne=209,qne=210,Jne=211,eie=212,tie=213,nie=214,C2=0,E2=1,_2=2,jg=3,I2=4,S2=5,T2=6,M2=7,sw=0,iie=1,rie=2,Td=0,sie=1,oie=2,aie=3,lie=4,cie=5,uie=6,hie=7,KD="attached",die="detached",wT=300,Wd=301,Wp=302,g1=303,y1=304,JA=306,A1=1e3,hc=1001,v1=1002,Co=1003,JO=1004,KHe=1004,tA=1005,ZHe=1005,Ws=1006,Ix=1007,jHe=1007,ih=1008,YHe=1008,bh=1009,eV=1010,tV=1011,OA=1012,CT=1013,Hd=1014,Ca=1015,ev=1016,ET=1017,_T=1018,Tp=1020,nV=35902,iV=1021,rV=1022,Ia=1023,sV=1024,oV=1025,Mp=1026,kp=1027,IT=1028,ow=1029,aV=1030,ST=1031,qHe=1032,TT=1033,Sx=33776,Tx=33777,Mx=33778,kx=33779,k2=35840,R2=35841,L2=35842,B2=35843,P2=36196,N2=37492,D2=37496,F2=37808,O2=37809,V2=37810,U2=37811,z2=37812,G2=37813,W2=37814,H2=37815,X2=37816,$2=37817,Q2=37818,K2=37819,Z2=37820,j2=37821,Rx=36492,Y2=36494,q2=36495,lV=36283,J2=36284,eS=36285,tS=36286,fie=2200,pie=2201,mie=2202,b1=2300,nS=2301,uI=2302,Sg=2400,Tg=2401,x1=2402,MT=2500,cV=2501,JHe=0,eXe=1,tXe=2,gie=3200,yie=3201,nXe=3202,iXe=3203,qp=0,Aie=1,dd="",Za="srgb",Yg="srgb-linear",w1="linear",tr="srgb",rXe=0,Ag=7680,sXe=7681,oXe=7682,aXe=7683,lXe=34055,cXe=34056,uXe=5386,hXe=512,dXe=513,fXe=514,pXe=515,mXe=516,gXe=517,yXe=518,ZD=519,vie=512,bie=513,xie=514,uV=515,wie=516,Cie=517,Eie=518,_ie=519,C1=35044,AXe=35048,vXe=35040,bXe=35045,xXe=35049,wXe=35041,CXe=35046,EXe=35050,_Xe=35042,IXe="100",jD="300 es",nu=2e3,E1=2001,SXe={COMPUTE:"compute",RENDER:"render"};class Ch{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const s=i[e];if(s!==void 0){const l=s.indexOf(t);l!==-1&&s.splice(l,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let l=0,u=s.length;l<u;l++)s[l].call(this,e);e.target=null}}}const Wo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let v6=1234567;const Dg=Math.PI/180,VA=180/Math.PI;function Ml(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Wo[n&255]+Wo[n>>8&255]+Wo[n>>16&255]+Wo[n>>24&255]+"-"+Wo[e&255]+Wo[e>>8&255]+"-"+Wo[e>>16&15|64]+Wo[e>>24&255]+"-"+Wo[t&63|128]+Wo[t>>8&255]+"-"+Wo[t>>16&255]+Wo[t>>24&255]+Wo[i&255]+Wo[i>>8&255]+Wo[i>>16&255]+Wo[i>>24&255]).toLowerCase()}function ai(n,e,t){return Math.max(e,Math.min(t,n))}function hV(n,e){return(n%e+e)%e}function TXe(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function MXe(n,e,t){return n!==e?(t-n)/(e-n):0}function Lx(n,e,t){return(1-t)*n+t*e}function kXe(n,e,t,i){return Lx(n,e,1-Math.exp(-t*i))}function RXe(n,e=1){return e-Math.abs(hV(n,e*2)-e)}function LXe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function BXe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function PXe(n,e){return n+Math.floor(Math.random()*(e-n+1))}function NXe(n,e){return n+Math.random()*(e-n)}function DXe(n){return n*(.5-Math.random())}function FXe(n){n!==void 0&&(v6=n);let e=v6+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function OXe(n){return n*Dg}function VXe(n){return n*VA}function UXe(n){return(n&n-1)===0&&n!==0}function zXe(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function GXe(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function WXe(n,e,t,i,s){const l=Math.cos,u=Math.sin,d=l(t/2),p=u(t/2),g=l((e+i)/2),x=u((e+i)/2),b=l((e-i)/2),E=u((e-i)/2),S=l((i-e)/2),M=u((i-e)/2);switch(s){case"XYX":n.set(d*x,p*b,p*E,d*g);break;case"YZY":n.set(p*E,d*x,p*b,d*g);break;case"ZXZ":n.set(p*b,p*E,d*x,d*g);break;case"XZX":n.set(d*x,p*M,p*S,d*g);break;case"YXY":n.set(p*S,d*x,p*M,d*g);break;case"ZYZ":n.set(p*M,p*S,d*x,d*g);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ea(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function di(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const HXe={DEG2RAD:Dg,RAD2DEG:VA,generateUUID:Ml,clamp:ai,euclideanModulo:hV,mapLinear:TXe,inverseLerp:MXe,lerp:Lx,damp:kXe,pingpong:RXe,smoothstep:LXe,smootherstep:BXe,randInt:PXe,randFloat:NXe,randFloatSpread:DXe,seededRandom:FXe,degToRad:OXe,radToDeg:VXe,isPowerOfTwo:UXe,ceilPowerOfTwo:zXe,floorPowerOfTwo:GXe,setQuaternionFromProperEuler:WXe,normalize:di,denormalize:Ea};class St{constructor(e=0,t=0){St.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=ai(this.x,e.x,t.x),this.y=ai(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=ai(this.x,e,t),this.y=ai(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ai(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ai(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),l=this.x-e.x,u=this.y-e.y;return this.x=l*i-u*s+e.x,this.y=l*s+u*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class oi{constructor(e,t,i,s,l,u,d,p,g){oi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,l,u,d,p,g)}set(e,t,i,s,l,u,d,p,g){const x=this.elements;return x[0]=e,x[1]=s,x[2]=d,x[3]=t,x[4]=l,x[5]=p,x[6]=i,x[7]=u,x[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,l=this.elements,u=i[0],d=i[3],p=i[6],g=i[1],x=i[4],b=i[7],E=i[2],S=i[5],M=i[8],R=s[0],P=s[3],k=s[6],F=s[1],V=s[4],G=s[7],q=s[2],ne=s[5],K=s[8];return l[0]=u*R+d*F+p*q,l[3]=u*P+d*V+p*ne,l[6]=u*k+d*G+p*K,l[1]=g*R+x*F+b*q,l[4]=g*P+x*V+b*ne,l[7]=g*k+x*G+b*K,l[2]=E*R+S*F+M*q,l[5]=E*P+S*V+M*ne,l[8]=E*k+S*G+M*K,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],l=e[3],u=e[4],d=e[5],p=e[6],g=e[7],x=e[8];return t*u*x-t*d*g-i*l*x+i*d*p+s*l*g-s*u*p}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],l=e[3],u=e[4],d=e[5],p=e[6],g=e[7],x=e[8],b=x*u-d*g,E=d*p-x*l,S=g*l-u*p,M=t*b+i*E+s*S;if(M===0)return this.set(0,0,0,0,0,0,0,0,0);const R=1/M;return e[0]=b*R,e[1]=(s*g-x*i)*R,e[2]=(d*i-s*u)*R,e[3]=E*R,e[4]=(x*t-s*p)*R,e[5]=(s*l-d*t)*R,e[6]=S*R,e[7]=(i*p-g*t)*R,e[8]=(u*t-i*l)*R,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,l,u,d){const p=Math.cos(l),g=Math.sin(l);return this.set(i*p,i*g,-i*(p*u+g*d)+u+e,-s*g,s*p,-s*(-g*u+p*d)+d+t,0,0,1),this}scale(e,t){return this.premultiply(vB.makeScale(e,t)),this}rotate(e){return this.premultiply(vB.makeRotation(-e)),this}translate(e,t){return this.premultiply(vB.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const vB=new oi;function Iie(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const XXe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function nA(n,e){return new XXe[n](e)}function _1(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Sie(){const n=_1("canvas");return n.style.display="block",n}const b6={};function Dy(n){n in b6||(b6[n]=!0,console.warn(n))}function $Xe(n,e,t){return new Promise(function(i,s){function l(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(l,t);break;default:i()}}setTimeout(l,t)})}function QXe(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function KXe(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const x6=new oi().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),w6=new oi().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function ZXe(){const n={enabled:!0,workingColorSpace:Yg,spaces:{},convert:function(s,l,u){return this.enabled===!1||l===u||!l||!u||(this.spaces[l].transfer===tr&&(s.r=Md(s.r),s.g=Md(s.g),s.b=Md(s.b)),this.spaces[l].primaries!==this.spaces[u].primaries&&(s.applyMatrix3(this.spaces[l].toXYZ),s.applyMatrix3(this.spaces[u].fromXYZ)),this.spaces[u].transfer===tr&&(s.r=vA(s.r),s.g=vA(s.g),s.b=vA(s.b))),s},fromWorkingColorSpace:function(s,l){return this.convert(s,this.workingColorSpace,l)},toWorkingColorSpace:function(s,l){return this.convert(s,l,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===dd?w1:this.spaces[s].transfer},getLuminanceCoefficients:function(s,l=this.workingColorSpace){return s.fromArray(this.spaces[l].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,l,u){return s.copy(this.spaces[l].toXYZ).multiply(this.spaces[u].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[Yg]:{primaries:e,whitePoint:i,transfer:w1,toXYZ:x6,fromXYZ:w6,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Za},outputColorSpaceConfig:{drawingBufferColorSpace:Za}},[Za]:{primaries:e,whitePoint:i,transfer:tr,toXYZ:x6,fromXYZ:w6,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Za}}}),n}const Fi=ZXe();function Md(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function vA(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let oy;class Tie{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{oy===void 0&&(oy=_1("canvas")),oy.width=e.width,oy.height=e.height;const i=oy.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=oy}return t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=_1("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),l=s.data;for(let u=0;u<l.length;u++)l[u]=Md(l[u]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Md(t[i]/255)*255):t[i]=Md(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let jXe=0;class Mg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:jXe++}),this.uuid=Ml(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let l;if(Array.isArray(s)){l=[];for(let u=0,d=s.length;u<d;u++)s[u].isDataTexture?l.push(bB(s[u].image)):l.push(bB(s[u]))}else l=bB(s);i.url=l}return t||(e.images[this.uuid]=i),i}}function bB(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Tie.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let YXe=0;class Yr extends Ch{constructor(e=Yr.DEFAULT_IMAGE,t=Yr.DEFAULT_MAPPING,i=hc,s=hc,l=Ws,u=ih,d=Ia,p=bh,g=Yr.DEFAULT_ANISOTROPY,x=dd){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:YXe++}),this.uuid=Ml(),this.name="",this.source=new Mg(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=l,this.minFilter=u,this.anisotropy=g,this.format=d,this.internalFormat=null,this.type=p,this.offset=new St(0,0),this.repeat=new St(1,1),this.center=new St(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new oi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wT)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case A1:e.x=e.x-Math.floor(e.x);break;case hc:e.x=e.x<0?0:1;break;case v1:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case A1:e.y=e.y-Math.floor(e.y);break;case hc:e.y=e.y<0?0:1;break;case v1:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Yr.DEFAULT_IMAGE=null;Yr.DEFAULT_MAPPING=wT;Yr.DEFAULT_ANISOTROPY=1;class Wi{constructor(e=0,t=0,i=0,s=1){Wi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,l=this.w,u=e.elements;return this.x=u[0]*t+u[4]*i+u[8]*s+u[12]*l,this.y=u[1]*t+u[5]*i+u[9]*s+u[13]*l,this.z=u[2]*t+u[6]*i+u[10]*s+u[14]*l,this.w=u[3]*t+u[7]*i+u[11]*s+u[15]*l,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,l;const p=e.elements,g=p[0],x=p[4],b=p[8],E=p[1],S=p[5],M=p[9],R=p[2],P=p[6],k=p[10];if(Math.abs(x-E)<.01&&Math.abs(b-R)<.01&&Math.abs(M-P)<.01){if(Math.abs(x+E)<.1&&Math.abs(b+R)<.1&&Math.abs(M+P)<.1&&Math.abs(g+S+k-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const V=(g+1)/2,G=(S+1)/2,q=(k+1)/2,ne=(x+E)/4,K=(b+R)/4,Q=(M+P)/4;return V>G&&V>q?V<.01?(i=0,s=.707106781,l=.707106781):(i=Math.sqrt(V),s=ne/i,l=K/i):G>q?G<.01?(i=.707106781,s=0,l=.707106781):(s=Math.sqrt(G),i=ne/s,l=Q/s):q<.01?(i=.707106781,s=.707106781,l=0):(l=Math.sqrt(q),i=K/l,s=Q/l),this.set(i,s,l,t),this}let F=Math.sqrt((P-M)*(P-M)+(b-R)*(b-R)+(E-x)*(E-x));return Math.abs(F)<.001&&(F=1),this.x=(P-M)/F,this.y=(b-R)/F,this.z=(E-x)/F,this.w=Math.acos((g+S+k-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=ai(this.x,e.x,t.x),this.y=ai(this.y,e.y,t.y),this.z=ai(this.z,e.z,t.z),this.w=ai(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=ai(this.x,e,t),this.y=ai(this.y,e,t),this.z=ai(this.z,e,t),this.w=ai(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ai(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class kT extends Ch{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Wi(0,0,e,t),this.scissorTest=!1,this.viewport=new Wi(0,0,e,t);const s={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ws,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const l=new Yr(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);l.flipY=!1,l.generateMipmaps=i.generateMipmaps,l.internalFormat=i.internalFormat,this.textures=[];const u=i.count;for(let d=0;d<u;d++)this.textures[d]=l.clone(),this.textures[d].isRenderTargetTexture=!0,this.textures[d].renderTarget=this;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,l=this.textures.length;s<l;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,s=e.textures.length;i<s;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const t=Object.assign({},e.texture.image);return this.texture.source=new Mg(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ou extends kT{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class aw extends Yr{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Co,this.minFilter=Co,this.wrapR=hc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class qXe extends ou{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new aw(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class RT extends Yr{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Co,this.minFilter=Co,this.wrapR=hc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class JXe extends ou{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new RT(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class il{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,l,u,d){let p=i[s+0],g=i[s+1],x=i[s+2],b=i[s+3];const E=l[u+0],S=l[u+1],M=l[u+2],R=l[u+3];if(d===0){e[t+0]=p,e[t+1]=g,e[t+2]=x,e[t+3]=b;return}if(d===1){e[t+0]=E,e[t+1]=S,e[t+2]=M,e[t+3]=R;return}if(b!==R||p!==E||g!==S||x!==M){let P=1-d;const k=p*E+g*S+x*M+b*R,F=k>=0?1:-1,V=1-k*k;if(V>Number.EPSILON){const q=Math.sqrt(V),ne=Math.atan2(q,k*F);P=Math.sin(P*ne)/q,d=Math.sin(d*ne)/q}const G=d*F;if(p=p*P+E*G,g=g*P+S*G,x=x*P+M*G,b=b*P+R*G,P===1-d){const q=1/Math.sqrt(p*p+g*g+x*x+b*b);p*=q,g*=q,x*=q,b*=q}}e[t]=p,e[t+1]=g,e[t+2]=x,e[t+3]=b}static multiplyQuaternionsFlat(e,t,i,s,l,u){const d=i[s],p=i[s+1],g=i[s+2],x=i[s+3],b=l[u],E=l[u+1],S=l[u+2],M=l[u+3];return e[t]=d*M+x*b+p*S-g*E,e[t+1]=p*M+x*E+g*b-d*S,e[t+2]=g*M+x*S+d*E-p*b,e[t+3]=x*M-d*b-p*E-g*S,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,l=e._z,u=e._order,d=Math.cos,p=Math.sin,g=d(i/2),x=d(s/2),b=d(l/2),E=p(i/2),S=p(s/2),M=p(l/2);switch(u){case"XYZ":this._x=E*x*b+g*S*M,this._y=g*S*b-E*x*M,this._z=g*x*M+E*S*b,this._w=g*x*b-E*S*M;break;case"YXZ":this._x=E*x*b+g*S*M,this._y=g*S*b-E*x*M,this._z=g*x*M-E*S*b,this._w=g*x*b+E*S*M;break;case"ZXY":this._x=E*x*b-g*S*M,this._y=g*S*b+E*x*M,this._z=g*x*M+E*S*b,this._w=g*x*b-E*S*M;break;case"ZYX":this._x=E*x*b-g*S*M,this._y=g*S*b+E*x*M,this._z=g*x*M-E*S*b,this._w=g*x*b+E*S*M;break;case"YZX":this._x=E*x*b+g*S*M,this._y=g*S*b+E*x*M,this._z=g*x*M-E*S*b,this._w=g*x*b-E*S*M;break;case"XZY":this._x=E*x*b-g*S*M,this._y=g*S*b-E*x*M,this._z=g*x*M+E*S*b,this._w=g*x*b+E*S*M;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],l=t[8],u=t[1],d=t[5],p=t[9],g=t[2],x=t[6],b=t[10],E=i+d+b;if(E>0){const S=.5/Math.sqrt(E+1);this._w=.25/S,this._x=(x-p)*S,this._y=(l-g)*S,this._z=(u-s)*S}else if(i>d&&i>b){const S=2*Math.sqrt(1+i-d-b);this._w=(x-p)/S,this._x=.25*S,this._y=(s+u)/S,this._z=(l+g)/S}else if(d>b){const S=2*Math.sqrt(1+d-i-b);this._w=(l-g)/S,this._x=(s+u)/S,this._y=.25*S,this._z=(p+x)/S}else{const S=2*Math.sqrt(1+b-i-d);this._w=(u-s)/S,this._x=(l+g)/S,this._y=(p+x)/S,this._z=.25*S}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ai(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,l=e._z,u=e._w,d=t._x,p=t._y,g=t._z,x=t._w;return this._x=i*x+u*d+s*g-l*p,this._y=s*x+u*p+l*d-i*g,this._z=l*x+u*g+i*p-s*d,this._w=u*x-i*d-s*p-l*g,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,l=this._z,u=this._w;let d=u*e._w+i*e._x+s*e._y+l*e._z;if(d<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,d=-d):this.copy(e),d>=1)return this._w=u,this._x=i,this._y=s,this._z=l,this;const p=1-d*d;if(p<=Number.EPSILON){const S=1-t;return this._w=S*u+t*this._w,this._x=S*i+t*this._x,this._y=S*s+t*this._y,this._z=S*l+t*this._z,this.normalize(),this}const g=Math.sqrt(p),x=Math.atan2(g,d),b=Math.sin((1-t)*x)/g,E=Math.sin(t*x)/g;return this._w=u*b+this._w*E,this._x=i*b+this._x*E,this._y=s*b+this._y*E,this._z=l*b+this._z*E,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),l=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),l*Math.sin(t),l*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ce{constructor(e=0,t=0,i=0){Ce.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(C6.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(C6.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,l=e.elements;return this.x=l[0]*t+l[3]*i+l[6]*s,this.y=l[1]*t+l[4]*i+l[7]*s,this.z=l[2]*t+l[5]*i+l[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,l=e.elements,u=1/(l[3]*t+l[7]*i+l[11]*s+l[15]);return this.x=(l[0]*t+l[4]*i+l[8]*s+l[12])*u,this.y=(l[1]*t+l[5]*i+l[9]*s+l[13])*u,this.z=(l[2]*t+l[6]*i+l[10]*s+l[14])*u,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,l=e.x,u=e.y,d=e.z,p=e.w,g=2*(u*s-d*i),x=2*(d*t-l*s),b=2*(l*i-u*t);return this.x=t+p*g+u*b-d*x,this.y=i+p*x+d*g-l*b,this.z=s+p*b+l*x-u*g,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*s,this.y=l[1]*t+l[5]*i+l[9]*s,this.z=l[2]*t+l[6]*i+l[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=ai(this.x,e.x,t.x),this.y=ai(this.y,e.y,t.y),this.z=ai(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=ai(this.x,e,t),this.y=ai(this.y,e,t),this.z=ai(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ai(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,l=e.z,u=t.x,d=t.y,p=t.z;return this.x=s*p-l*d,this.y=l*u-i*p,this.z=i*d-s*u,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return xB.copy(this).projectOnVector(e),this.sub(xB)}reflect(e){return this.sub(xB.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ai(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const xB=new Ce,C6=new il;class Ma{constructor(e=new Ce(1/0,1/0,1/0),t=new Ce(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Gc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Gc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Gc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const l=i.getAttribute("position");if(t===!0&&l!==void 0&&e.isInstancedMesh!==!0)for(let u=0,d=l.count;u<d;u++)e.isMesh===!0?e.getVertexPosition(u,Gc):Gc.fromBufferAttribute(l,u),Gc.applyMatrix4(e.matrixWorld),this.expandByPoint(Gc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),xE.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),xE.copy(i.boundingBox)),xE.applyMatrix4(e.matrixWorld),this.union(xE)}const s=e.children;for(let l=0,u=s.length;l<u;l++)this.expandByObject(s[l],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Gc),Gc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Eb),wE.subVectors(this.max,Eb),ay.subVectors(e.a,Eb),ly.subVectors(e.b,Eb),cy.subVectors(e.c,Eb),Nf.subVectors(ly,ay),Df.subVectors(cy,ly),Wm.subVectors(ay,cy);let t=[0,-Nf.z,Nf.y,0,-Df.z,Df.y,0,-Wm.z,Wm.y,Nf.z,0,-Nf.x,Df.z,0,-Df.x,Wm.z,0,-Wm.x,-Nf.y,Nf.x,0,-Df.y,Df.x,0,-Wm.y,Wm.x,0];return!wB(t,ay,ly,cy,wE)||(t=[1,0,0,0,1,0,0,0,1],!wB(t,ay,ly,cy,wE))?!1:(CE.crossVectors(Nf,Df),t=[CE.x,CE.y,CE.z],wB(t,ay,ly,cy,wE))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Gc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Gc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ed[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ed[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ed[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ed[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ed[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ed[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ed[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ed[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ed),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ed=[new Ce,new Ce,new Ce,new Ce,new Ce,new Ce,new Ce,new Ce],Gc=new Ce,xE=new Ma,ay=new Ce,ly=new Ce,cy=new Ce,Nf=new Ce,Df=new Ce,Wm=new Ce,Eb=new Ce,wE=new Ce,CE=new Ce,Hm=new Ce;function wB(n,e,t,i,s){for(let l=0,u=n.length-3;l<=u;l+=3){Hm.fromArray(n,l);const d=s.x*Math.abs(Hm.x)+s.y*Math.abs(Hm.y)+s.z*Math.abs(Hm.z),p=e.dot(Hm),g=t.dot(Hm),x=i.dot(Hm);if(Math.max(-Math.max(p,g,x),Math.min(p,g,x))>d)return!1}return!0}const e$e=new Ma,_b=new Ce,CB=new Ce;class Yo{constructor(e=new Ce,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):e$e.setFromPoints(e).getCenter(i);let s=0;for(let l=0,u=e.length;l<u;l++)s=Math.max(s,i.distanceToSquared(e[l]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_b.subVectors(e,this.center);const t=_b.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(_b,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(CB.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_b.copy(e.center).add(CB)),this.expandByPoint(_b.copy(e.center).sub(CB))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const td=new Ce,EB=new Ce,EE=new Ce,Ff=new Ce,_B=new Ce,_E=new Ce,IB=new Ce;class tv{constructor(e=new Ce,t=new Ce(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,td)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=td.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(td.copy(this.origin).addScaledVector(this.direction,t),td.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){EB.copy(e).add(t).multiplyScalar(.5),EE.copy(t).sub(e).normalize(),Ff.copy(this.origin).sub(EB);const l=e.distanceTo(t)*.5,u=-this.direction.dot(EE),d=Ff.dot(this.direction),p=-Ff.dot(EE),g=Ff.lengthSq(),x=Math.abs(1-u*u);let b,E,S,M;if(x>0)if(b=u*p-d,E=u*d-p,M=l*x,b>=0)if(E>=-M)if(E<=M){const R=1/x;b*=R,E*=R,S=b*(b+u*E+2*d)+E*(u*b+E+2*p)+g}else E=l,b=Math.max(0,-(u*E+d)),S=-b*b+E*(E+2*p)+g;else E=-l,b=Math.max(0,-(u*E+d)),S=-b*b+E*(E+2*p)+g;else E<=-M?(b=Math.max(0,-(-u*l+d)),E=b>0?-l:Math.min(Math.max(-l,-p),l),S=-b*b+E*(E+2*p)+g):E<=M?(b=0,E=Math.min(Math.max(-l,-p),l),S=E*(E+2*p)+g):(b=Math.max(0,-(u*l+d)),E=b>0?l:Math.min(Math.max(-l,-p),l),S=-b*b+E*(E+2*p)+g);else E=u>0?-l:l,b=Math.max(0,-(u*E+d)),S=-b*b+E*(E+2*p)+g;return i&&i.copy(this.origin).addScaledVector(this.direction,b),s&&s.copy(EB).addScaledVector(EE,E),S}intersectSphere(e,t){td.subVectors(e.center,this.origin);const i=td.dot(this.direction),s=td.dot(td)-i*i,l=e.radius*e.radius;if(s>l)return null;const u=Math.sqrt(l-s),d=i-u,p=i+u;return p<0?null:d<0?this.at(p,t):this.at(d,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,l,u,d,p;const g=1/this.direction.x,x=1/this.direction.y,b=1/this.direction.z,E=this.origin;return g>=0?(i=(e.min.x-E.x)*g,s=(e.max.x-E.x)*g):(i=(e.max.x-E.x)*g,s=(e.min.x-E.x)*g),x>=0?(l=(e.min.y-E.y)*x,u=(e.max.y-E.y)*x):(l=(e.max.y-E.y)*x,u=(e.min.y-E.y)*x),i>u||l>s||((l>i||isNaN(i))&&(i=l),(u<s||isNaN(s))&&(s=u),b>=0?(d=(e.min.z-E.z)*b,p=(e.max.z-E.z)*b):(d=(e.max.z-E.z)*b,p=(e.min.z-E.z)*b),i>p||d>s)||((d>i||i!==i)&&(i=d),(p<s||s!==s)&&(s=p),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,td)!==null}intersectTriangle(e,t,i,s,l){_B.subVectors(t,e),_E.subVectors(i,e),IB.crossVectors(_B,_E);let u=this.direction.dot(IB),d;if(u>0){if(s)return null;d=1}else if(u<0)d=-1,u=-u;else return null;Ff.subVectors(this.origin,e);const p=d*this.direction.dot(_E.crossVectors(Ff,_E));if(p<0)return null;const g=d*this.direction.dot(_B.cross(Ff));if(g<0||p+g>u)return null;const x=-d*Ff.dot(IB);return x<0?null:this.at(x/u,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Zn{constructor(e,t,i,s,l,u,d,p,g,x,b,E,S,M,R,P){Zn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,l,u,d,p,g,x,b,E,S,M,R,P)}set(e,t,i,s,l,u,d,p,g,x,b,E,S,M,R,P){const k=this.elements;return k[0]=e,k[4]=t,k[8]=i,k[12]=s,k[1]=l,k[5]=u,k[9]=d,k[13]=p,k[2]=g,k[6]=x,k[10]=b,k[14]=E,k[3]=S,k[7]=M,k[11]=R,k[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Zn().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/uy.setFromMatrixColumn(e,0).length(),l=1/uy.setFromMatrixColumn(e,1).length(),u=1/uy.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*l,t[5]=i[5]*l,t[6]=i[6]*l,t[7]=0,t[8]=i[8]*u,t[9]=i[9]*u,t[10]=i[10]*u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,l=e.z,u=Math.cos(i),d=Math.sin(i),p=Math.cos(s),g=Math.sin(s),x=Math.cos(l),b=Math.sin(l);if(e.order==="XYZ"){const E=u*x,S=u*b,M=d*x,R=d*b;t[0]=p*x,t[4]=-p*b,t[8]=g,t[1]=S+M*g,t[5]=E-R*g,t[9]=-d*p,t[2]=R-E*g,t[6]=M+S*g,t[10]=u*p}else if(e.order==="YXZ"){const E=p*x,S=p*b,M=g*x,R=g*b;t[0]=E+R*d,t[4]=M*d-S,t[8]=u*g,t[1]=u*b,t[5]=u*x,t[9]=-d,t[2]=S*d-M,t[6]=R+E*d,t[10]=u*p}else if(e.order==="ZXY"){const E=p*x,S=p*b,M=g*x,R=g*b;t[0]=E-R*d,t[4]=-u*b,t[8]=M+S*d,t[1]=S+M*d,t[5]=u*x,t[9]=R-E*d,t[2]=-u*g,t[6]=d,t[10]=u*p}else if(e.order==="ZYX"){const E=u*x,S=u*b,M=d*x,R=d*b;t[0]=p*x,t[4]=M*g-S,t[8]=E*g+R,t[1]=p*b,t[5]=R*g+E,t[9]=S*g-M,t[2]=-g,t[6]=d*p,t[10]=u*p}else if(e.order==="YZX"){const E=u*p,S=u*g,M=d*p,R=d*g;t[0]=p*x,t[4]=R-E*b,t[8]=M*b+S,t[1]=b,t[5]=u*x,t[9]=-d*x,t[2]=-g*x,t[6]=S*b+M,t[10]=E-R*b}else if(e.order==="XZY"){const E=u*p,S=u*g,M=d*p,R=d*g;t[0]=p*x,t[4]=-b,t[8]=g*x,t[1]=E*b+R,t[5]=u*x,t[9]=S*b-M,t[2]=M*b-S,t[6]=d*x,t[10]=R*b+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(t$e,e,n$e)}lookAt(e,t,i){const s=this.elements;return wl.subVectors(e,t),wl.lengthSq()===0&&(wl.z=1),wl.normalize(),Of.crossVectors(i,wl),Of.lengthSq()===0&&(Math.abs(i.z)===1?wl.x+=1e-4:wl.z+=1e-4,wl.normalize(),Of.crossVectors(i,wl)),Of.normalize(),IE.crossVectors(wl,Of),s[0]=Of.x,s[4]=IE.x,s[8]=wl.x,s[1]=Of.y,s[5]=IE.y,s[9]=wl.y,s[2]=Of.z,s[6]=IE.z,s[10]=wl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,l=this.elements,u=i[0],d=i[4],p=i[8],g=i[12],x=i[1],b=i[5],E=i[9],S=i[13],M=i[2],R=i[6],P=i[10],k=i[14],F=i[3],V=i[7],G=i[11],q=i[15],ne=s[0],K=s[4],Q=s[8],H=s[12],j=s[1],ee=s[5],de=s[9],oe=s[13],we=s[2],$e=s[6],Me=s[10],Ne=s[14],Ae=s[3],Fe=s[7],Ie=s[11],qe=s[15];return l[0]=u*ne+d*j+p*we+g*Ae,l[4]=u*K+d*ee+p*$e+g*Fe,l[8]=u*Q+d*de+p*Me+g*Ie,l[12]=u*H+d*oe+p*Ne+g*qe,l[1]=x*ne+b*j+E*we+S*Ae,l[5]=x*K+b*ee+E*$e+S*Fe,l[9]=x*Q+b*de+E*Me+S*Ie,l[13]=x*H+b*oe+E*Ne+S*qe,l[2]=M*ne+R*j+P*we+k*Ae,l[6]=M*K+R*ee+P*$e+k*Fe,l[10]=M*Q+R*de+P*Me+k*Ie,l[14]=M*H+R*oe+P*Ne+k*qe,l[3]=F*ne+V*j+G*we+q*Ae,l[7]=F*K+V*ee+G*$e+q*Fe,l[11]=F*Q+V*de+G*Me+q*Ie,l[15]=F*H+V*oe+G*Ne+q*qe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],l=e[12],u=e[1],d=e[5],p=e[9],g=e[13],x=e[2],b=e[6],E=e[10],S=e[14],M=e[3],R=e[7],P=e[11],k=e[15];return M*(+l*p*b-s*g*b-l*d*E+i*g*E+s*d*S-i*p*S)+R*(+t*p*S-t*g*E+l*u*E-s*u*S+s*g*x-l*p*x)+P*(+t*g*b-t*d*S-l*u*b+i*u*S+l*d*x-i*g*x)+k*(-s*d*x-t*p*b+t*d*E+s*u*b-i*u*E+i*p*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],l=e[3],u=e[4],d=e[5],p=e[6],g=e[7],x=e[8],b=e[9],E=e[10],S=e[11],M=e[12],R=e[13],P=e[14],k=e[15],F=b*P*g-R*E*g+R*p*S-d*P*S-b*p*k+d*E*k,V=M*E*g-x*P*g-M*p*S+u*P*S+x*p*k-u*E*k,G=x*R*g-M*b*g+M*d*S-u*R*S-x*d*k+u*b*k,q=M*b*p-x*R*p-M*d*E+u*R*E+x*d*P-u*b*P,ne=t*F+i*V+s*G+l*q;if(ne===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const K=1/ne;return e[0]=F*K,e[1]=(R*E*l-b*P*l-R*s*S+i*P*S+b*s*k-i*E*k)*K,e[2]=(d*P*l-R*p*l+R*s*g-i*P*g-d*s*k+i*p*k)*K,e[3]=(b*p*l-d*E*l-b*s*g+i*E*g+d*s*S-i*p*S)*K,e[4]=V*K,e[5]=(x*P*l-M*E*l+M*s*S-t*P*S-x*s*k+t*E*k)*K,e[6]=(M*p*l-u*P*l-M*s*g+t*P*g+u*s*k-t*p*k)*K,e[7]=(u*E*l-x*p*l+x*s*g-t*E*g-u*s*S+t*p*S)*K,e[8]=G*K,e[9]=(M*b*l-x*R*l-M*i*S+t*R*S+x*i*k-t*b*k)*K,e[10]=(u*R*l-M*d*l+M*i*g-t*R*g-u*i*k+t*d*k)*K,e[11]=(x*d*l-u*b*l-x*i*g+t*b*g+u*i*S-t*d*S)*K,e[12]=q*K,e[13]=(x*R*s-M*b*s+M*i*E-t*R*E-x*i*P+t*b*P)*K,e[14]=(M*d*s-u*R*s-M*i*p+t*R*p+u*i*P-t*d*P)*K,e[15]=(u*b*s-x*d*s+x*i*p-t*b*p-u*i*E+t*d*E)*K,this}scale(e){const t=this.elements,i=e.x,s=e.y,l=e.z;return t[0]*=i,t[4]*=s,t[8]*=l,t[1]*=i,t[5]*=s,t[9]*=l,t[2]*=i,t[6]*=s,t[10]*=l,t[3]*=i,t[7]*=s,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),l=1-i,u=e.x,d=e.y,p=e.z,g=l*u,x=l*d;return this.set(g*u+i,g*d-s*p,g*p+s*d,0,g*d+s*p,x*d+i,x*p-s*u,0,g*p-s*d,x*p+s*u,l*p*p+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,l,u){return this.set(1,i,l,0,e,1,u,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,l=t._x,u=t._y,d=t._z,p=t._w,g=l+l,x=u+u,b=d+d,E=l*g,S=l*x,M=l*b,R=u*x,P=u*b,k=d*b,F=p*g,V=p*x,G=p*b,q=i.x,ne=i.y,K=i.z;return s[0]=(1-(R+k))*q,s[1]=(S+G)*q,s[2]=(M-V)*q,s[3]=0,s[4]=(S-G)*ne,s[5]=(1-(E+k))*ne,s[6]=(P+F)*ne,s[7]=0,s[8]=(M+V)*K,s[9]=(P-F)*K,s[10]=(1-(E+R))*K,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let l=uy.set(s[0],s[1],s[2]).length();const u=uy.set(s[4],s[5],s[6]).length(),d=uy.set(s[8],s[9],s[10]).length();this.determinant()<0&&(l=-l),e.x=s[12],e.y=s[13],e.z=s[14],Wc.copy(this);const g=1/l,x=1/u,b=1/d;return Wc.elements[0]*=g,Wc.elements[1]*=g,Wc.elements[2]*=g,Wc.elements[4]*=x,Wc.elements[5]*=x,Wc.elements[6]*=x,Wc.elements[8]*=b,Wc.elements[9]*=b,Wc.elements[10]*=b,t.setFromRotationMatrix(Wc),i.x=l,i.y=u,i.z=d,this}makePerspective(e,t,i,s,l,u,d=nu){const p=this.elements,g=2*l/(t-e),x=2*l/(i-s),b=(t+e)/(t-e),E=(i+s)/(i-s);let S,M;if(d===nu)S=-(u+l)/(u-l),M=-2*u*l/(u-l);else if(d===E1)S=-u/(u-l),M=-u*l/(u-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+d);return p[0]=g,p[4]=0,p[8]=b,p[12]=0,p[1]=0,p[5]=x,p[9]=E,p[13]=0,p[2]=0,p[6]=0,p[10]=S,p[14]=M,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(e,t,i,s,l,u,d=nu){const p=this.elements,g=1/(t-e),x=1/(i-s),b=1/(u-l),E=(t+e)*g,S=(i+s)*x;let M,R;if(d===nu)M=(u+l)*b,R=-2*b;else if(d===E1)M=l*b,R=-1*b;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+d);return p[0]=2*g,p[4]=0,p[8]=0,p[12]=-E,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-S,p[2]=0,p[6]=0,p[10]=R,p[14]=-M,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const uy=new Ce,Wc=new Zn,t$e=new Ce(0,0,0),n$e=new Ce(1,1,1),Of=new Ce,IE=new Ce,wl=new Ce,E6=new Zn,_6=new il;class Ll{constructor(e=0,t=0,i=0,s=Ll.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,l=s[0],u=s[4],d=s[8],p=s[1],g=s[5],x=s[9],b=s[2],E=s[6],S=s[10];switch(t){case"XYZ":this._y=Math.asin(ai(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-x,S),this._z=Math.atan2(-u,l)):(this._x=Math.atan2(E,g),this._z=0);break;case"YXZ":this._x=Math.asin(-ai(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(d,S),this._z=Math.atan2(p,g)):(this._y=Math.atan2(-b,l),this._z=0);break;case"ZXY":this._x=Math.asin(ai(E,-1,1)),Math.abs(E)<.9999999?(this._y=Math.atan2(-b,S),this._z=Math.atan2(-u,g)):(this._y=0,this._z=Math.atan2(p,l));break;case"ZYX":this._y=Math.asin(-ai(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(E,S),this._z=Math.atan2(p,l)):(this._x=0,this._z=Math.atan2(-u,g));break;case"YZX":this._z=Math.asin(ai(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,g),this._y=Math.atan2(-b,l)):(this._x=0,this._y=Math.atan2(d,S));break;case"XZY":this._z=Math.asin(-ai(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(E,g),this._y=Math.atan2(d,l)):(this._x=Math.atan2(-x,S),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return E6.makeRotationFromQuaternion(e),this.setFromRotationMatrix(E6,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _6.setFromEuler(this),this.setFromQuaternion(_6,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ll.DEFAULT_ORDER="XYZ";class LT{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let i$e=0;const I6=new Ce,hy=new il,nd=new Zn,SE=new Ce,Ib=new Ce,r$e=new Ce,s$e=new il,S6=new Ce(1,0,0),T6=new Ce(0,1,0),M6=new Ce(0,0,1),k6={type:"added"},o$e={type:"removed"},dy={type:"childadded",child:null},SB={type:"childremoved",child:null};class Xi extends Ch{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:i$e++}),this.uuid=Ml(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xi.DEFAULT_UP.clone();const e=new Ce,t=new Ll,i=new il,s=new Ce(1,1,1);function l(){i.setFromEuler(t,!1)}function u(){t.setFromQuaternion(i,void 0,!1)}t._onChange(l),i._onChange(u),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Zn},normalMatrix:{value:new oi}}),this.matrix=new Zn,this.matrixWorld=new Zn,this.matrixAutoUpdate=Xi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Xi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new LT,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hy.setFromAxisAngle(e,t),this.quaternion.multiply(hy),this}rotateOnWorldAxis(e,t){return hy.setFromAxisAngle(e,t),this.quaternion.premultiply(hy),this}rotateX(e){return this.rotateOnAxis(S6,e)}rotateY(e){return this.rotateOnAxis(T6,e)}rotateZ(e){return this.rotateOnAxis(M6,e)}translateOnAxis(e,t){return I6.copy(e).applyQuaternion(this.quaternion),this.position.add(I6.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(S6,e)}translateY(e){return this.translateOnAxis(T6,e)}translateZ(e){return this.translateOnAxis(M6,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(nd.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?SE.copy(e):SE.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Ib.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?nd.lookAt(Ib,SE,this.up):nd.lookAt(SE,Ib,this.up),this.quaternion.setFromRotationMatrix(nd),s&&(nd.extractRotation(s.matrixWorld),hy.setFromRotationMatrix(nd),this.quaternion.premultiply(hy.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(k6),dy.child=e,this.dispatchEvent(dy),dy.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(o$e),SB.child=e,this.dispatchEvent(SB),SB.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),nd.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),nd.multiply(e.parent.matrixWorld)),e.applyMatrix4(nd),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(k6),dy.child=e,this.dispatchEvent(dy),dy.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const u=this.children[i].getObjectByProperty(e,t);if(u!==void 0)return u}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let l=0,u=s.length;l<u;l++)s[l].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ib,e,r$e),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ib,s$e,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let l=0,u=s.length;l<u;l++)s[l].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(d=>({boxInitialized:d.boxInitialized,boxMin:d.box.min.toArray(),boxMax:d.box.max.toArray(),sphereInitialized:d.sphereInitialized,sphereRadius:d.sphere.radius,sphereCenter:d.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function l(d,p){return d[p.uuid]===void 0&&(d[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=l(e.geometries,this.geometry);const d=this.geometry.parameters;if(d!==void 0&&d.shapes!==void 0){const p=d.shapes;if(Array.isArray(p))for(let g=0,x=p.length;g<x;g++){const b=p[g];l(e.shapes,b)}else l(e.shapes,p)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const d=[];for(let p=0,g=this.material.length;p<g;p++)d.push(l(e.materials,this.material[p]));s.material=d}else s.material=l(e.materials,this.material);if(this.children.length>0){s.children=[];for(let d=0;d<this.children.length;d++)s.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let d=0;d<this.animations.length;d++){const p=this.animations[d];s.animations.push(l(e.animations,p))}}if(t){const d=u(e.geometries),p=u(e.materials),g=u(e.textures),x=u(e.images),b=u(e.shapes),E=u(e.skeletons),S=u(e.animations),M=u(e.nodes);d.length>0&&(i.geometries=d),p.length>0&&(i.materials=p),g.length>0&&(i.textures=g),x.length>0&&(i.images=x),b.length>0&&(i.shapes=b),E.length>0&&(i.skeletons=E),S.length>0&&(i.animations=S),M.length>0&&(i.nodes=M)}return i.object=s,i;function u(d){const p=[];for(const g in d){const x=d[g];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Xi.DEFAULT_UP=new Ce(0,1,0);Xi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Xi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Hc=new Ce,id=new Ce,TB=new Ce,rd=new Ce,fy=new Ce,py=new Ce,R6=new Ce,MB=new Ce,kB=new Ce,RB=new Ce,LB=new Wi,BB=new Wi,PB=new Wi;class Ya{constructor(e=new Ce,t=new Ce,i=new Ce){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),Hc.subVectors(e,t),s.cross(Hc);const l=s.lengthSq();return l>0?s.multiplyScalar(1/Math.sqrt(l)):s.set(0,0,0)}static getBarycoord(e,t,i,s,l){Hc.subVectors(s,t),id.subVectors(i,t),TB.subVectors(e,t);const u=Hc.dot(Hc),d=Hc.dot(id),p=Hc.dot(TB),g=id.dot(id),x=id.dot(TB),b=u*g-d*d;if(b===0)return l.set(0,0,0),null;const E=1/b,S=(g*p-d*x)*E,M=(u*x-d*p)*E;return l.set(1-S-M,M,S)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,rd)===null?!1:rd.x>=0&&rd.y>=0&&rd.x+rd.y<=1}static getInterpolation(e,t,i,s,l,u,d,p){return this.getBarycoord(e,t,i,s,rd)===null?(p.x=0,p.y=0,"z"in p&&(p.z=0),"w"in p&&(p.w=0),null):(p.setScalar(0),p.addScaledVector(l,rd.x),p.addScaledVector(u,rd.y),p.addScaledVector(d,rd.z),p)}static getInterpolatedAttribute(e,t,i,s,l,u){return LB.setScalar(0),BB.setScalar(0),PB.setScalar(0),LB.fromBufferAttribute(e,t),BB.fromBufferAttribute(e,i),PB.fromBufferAttribute(e,s),u.setScalar(0),u.addScaledVector(LB,l.x),u.addScaledVector(BB,l.y),u.addScaledVector(PB,l.z),u}static isFrontFacing(e,t,i,s){return Hc.subVectors(i,t),id.subVectors(e,t),Hc.cross(id).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Hc.subVectors(this.c,this.b),id.subVectors(this.a,this.b),Hc.cross(id).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ya.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ya.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,l){return Ya.getInterpolation(e,this.a,this.b,this.c,t,i,s,l)}containsPoint(e){return Ya.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ya.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,l=this.c;let u,d;fy.subVectors(s,i),py.subVectors(l,i),MB.subVectors(e,i);const p=fy.dot(MB),g=py.dot(MB);if(p<=0&&g<=0)return t.copy(i);kB.subVectors(e,s);const x=fy.dot(kB),b=py.dot(kB);if(x>=0&&b<=x)return t.copy(s);const E=p*b-x*g;if(E<=0&&p>=0&&x<=0)return u=p/(p-x),t.copy(i).addScaledVector(fy,u);RB.subVectors(e,l);const S=fy.dot(RB),M=py.dot(RB);if(M>=0&&S<=M)return t.copy(l);const R=S*g-p*M;if(R<=0&&g>=0&&M<=0)return d=g/(g-M),t.copy(i).addScaledVector(py,d);const P=x*M-S*b;if(P<=0&&b-x>=0&&S-M>=0)return R6.subVectors(l,s),d=(b-x)/(b-x+(S-M)),t.copy(s).addScaledVector(R6,d);const k=1/(P+R+E);return u=R*k,d=E*k,t.copy(i).addScaledVector(fy,u).addScaledVector(py,d)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Mie={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vf={h:0,s:0,l:0},TE={h:0,s:0,l:0};function NB(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class An{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Za){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Fi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=Fi.workingColorSpace){return this.r=e,this.g=t,this.b=i,Fi.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=Fi.workingColorSpace){if(e=hV(e,1),t=ai(t,0,1),i=ai(i,0,1),t===0)this.r=this.g=this.b=i;else{const l=i<=.5?i*(1+t):i+t-i*t,u=2*i-l;this.r=NB(u,l,e+1/3),this.g=NB(u,l,e),this.b=NB(u,l,e-1/3)}return Fi.toWorkingColorSpace(this,s),this}setStyle(e,t=Za){function i(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const u=s[1],d=s[2];switch(u){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,t);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,t);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return i(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=s[1],u=l.length;if(u===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,t);if(u===6)return this.setHex(parseInt(l,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Za){const i=Mie[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Md(e.r),this.g=Md(e.g),this.b=Md(e.b),this}copyLinearToSRGB(e){return this.r=vA(e.r),this.g=vA(e.g),this.b=vA(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Za){return Fi.fromWorkingColorSpace(Ho.copy(this),e),Math.round(ai(Ho.r*255,0,255))*65536+Math.round(ai(Ho.g*255,0,255))*256+Math.round(ai(Ho.b*255,0,255))}getHexString(e=Za){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Fi.workingColorSpace){Fi.fromWorkingColorSpace(Ho.copy(this),t);const i=Ho.r,s=Ho.g,l=Ho.b,u=Math.max(i,s,l),d=Math.min(i,s,l);let p,g;const x=(d+u)/2;if(d===u)p=0,g=0;else{const b=u-d;switch(g=x<=.5?b/(u+d):b/(2-u-d),u){case i:p=(s-l)/b+(s<l?6:0);break;case s:p=(l-i)/b+2;break;case l:p=(i-s)/b+4;break}p/=6}return e.h=p,e.s=g,e.l=x,e}getRGB(e,t=Fi.workingColorSpace){return Fi.fromWorkingColorSpace(Ho.copy(this),t),e.r=Ho.r,e.g=Ho.g,e.b=Ho.b,e}getStyle(e=Za){Fi.fromWorkingColorSpace(Ho.copy(this),e);const t=Ho.r,i=Ho.g,s=Ho.b;return e!==Za?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(Vf),this.setHSL(Vf.h+e,Vf.s+t,Vf.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Vf),e.getHSL(TE);const i=Lx(Vf.h,TE.h,t),s=Lx(Vf.s,TE.s,t),l=Lx(Vf.l,TE.l,t);return this.setHSL(i,s,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,l=e.elements;return this.r=l[0]*t+l[3]*i+l[6]*s,this.g=l[1]*t+l[4]*i+l[7]*s,this.b=l[2]*t+l[5]*i+l[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ho=new An;An.NAMES=Mie;let a$e=0;class ea extends Ch{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:a$e++}),this.uuid=Ml(),this.name="",this.type="Material",this.blending=Ng,this.side=Gd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=x2,this.blendDst=w2,this.blendEquation=sp,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new An(0,0,0),this.blendAlpha=0,this.depthFunc=jg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ZD,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ag,this.stencilZFail=Ag,this.stencilZPass=Ag,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ng&&(i.blending=this.blending),this.side!==Gd&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==x2&&(i.blendSrc=this.blendSrc),this.blendDst!==w2&&(i.blendDst=this.blendDst),this.blendEquation!==sp&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==jg&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ZD&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ag&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Ag&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Ag&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(l){const u=[];for(const d in l){const p=l[d];delete p.metadata,u.push(p)}return u}if(t){const l=s(e.textures),u=s(e.images);l.length>0&&(i.textures=l),u.length>0&&(i.images=u)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let l=0;l!==s;++l)i[l]=t[l].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Jp extends ea{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new An(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ll,this.combine=sw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const fd=l$e();function l$e(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),s=new Uint32Array(512);for(let p=0;p<256;++p){const g=p-127;g<-27?(i[p]=0,i[p|256]=32768,s[p]=24,s[p|256]=24):g<-14?(i[p]=1024>>-g-14,i[p|256]=1024>>-g-14|32768,s[p]=-g-1,s[p|256]=-g-1):g<=15?(i[p]=g+15<<10,i[p|256]=g+15<<10|32768,s[p]=13,s[p|256]=13):g<128?(i[p]=31744,i[p|256]=64512,s[p]=24,s[p|256]=24):(i[p]=31744,i[p|256]=64512,s[p]=13,s[p|256]=13)}const l=new Uint32Array(2048),u=new Uint32Array(64),d=new Uint32Array(64);for(let p=1;p<1024;++p){let g=p<<13,x=0;for(;!(g&8388608);)g<<=1,x-=8388608;g&=-8388609,x+=947912704,l[p]=g|x}for(let p=1024;p<2048;++p)l[p]=939524096+(p-1024<<13);for(let p=1;p<31;++p)u[p]=p<<23;u[31]=1199570944,u[32]=2147483648;for(let p=33;p<63;++p)u[p]=2147483648+(p-32<<23);u[63]=3347054592;for(let p=1;p<64;++p)p!==32&&(d[p]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:l,exponentTable:u,offsetTable:d}}function $a(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=ai(n,-65504,65504),fd.floatView[0]=n;const e=fd.uint32View[0],t=e>>23&511;return fd.baseTable[t]+((e&8388607)>>fd.shiftTable[t])}function ix(n){const e=n>>10;return fd.uint32View[0]=fd.mantissaTable[fd.offsetTable[e]+(n&1023)]+fd.exponentTable[e],fd.floatView[0]}const c$e={toHalfFloat:$a,fromHalfFloat:ix},Cs=new Ce,ME=new St;let u$e=0;class sr{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:u$e++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=C1,this.updateRanges=[],this.gpuType=Ca,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,l=this.itemSize;s<l;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)ME.fromBufferAttribute(this,t),ME.applyMatrix3(e),this.setXY(t,ME.x,ME.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)Cs.fromBufferAttribute(this,t),Cs.applyMatrix3(e),this.setXYZ(t,Cs.x,Cs.y,Cs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Cs.fromBufferAttribute(this,t),Cs.applyMatrix4(e),this.setXYZ(t,Cs.x,Cs.y,Cs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Cs.fromBufferAttribute(this,t),Cs.applyNormalMatrix(e),this.setXYZ(t,Cs.x,Cs.y,Cs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Cs.fromBufferAttribute(this,t),Cs.transformDirection(e),this.setXYZ(t,Cs.x,Cs.y,Cs.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Ea(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=di(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Ea(t,this.array)),t}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Ea(t,this.array)),t}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Ea(t,this.array)),t}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Ea(t,this.array)),t}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,l){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array),l=di(l,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==C1&&(e.usage=this.usage),e}}class h$e extends sr{constructor(e,t,i){super(new Int8Array(e),t,i)}}class d$e extends sr{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class f$e extends sr{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class p$e extends sr{constructor(e,t,i){super(new Int16Array(e),t,i)}}class dV extends sr{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class m$e extends sr{constructor(e,t,i){super(new Int32Array(e),t,i)}}class fV extends sr{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class g$e extends sr{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=ix(this.array[e*this.itemSize]);return this.normalized&&(t=Ea(t,this.array)),t}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize]=$a(t),this}getY(e){let t=ix(this.array[e*this.itemSize+1]);return this.normalized&&(t=Ea(t,this.array)),t}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+1]=$a(t),this}getZ(e){let t=ix(this.array[e*this.itemSize+2]);return this.normalized&&(t=Ea(t,this.array)),t}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+2]=$a(t),this}getW(e){let t=ix(this.array[e*this.itemSize+3]);return this.normalized&&(t=Ea(t,this.array)),t}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.array[e*this.itemSize+3]=$a(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array)),this.array[e+0]=$a(t),this.array[e+1]=$a(i),this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array)),this.array[e+0]=$a(t),this.array[e+1]=$a(i),this.array[e+2]=$a(s),this}setXYZW(e,t,i,s,l){return e*=this.itemSize,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array),l=di(l,this.array)),this.array[e+0]=$a(t),this.array[e+1]=$a(i),this.array[e+2]=$a(s),this.array[e+3]=$a(l),this}}class En extends sr{constructor(e,t,i){super(new Float32Array(e),t,i)}}let y$e=0;const tc=new Zn,DB=new Xi,my=new Ce,Cl=new Ma,Sb=new Ma,eo=new Ce;class pi extends Ch{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:y$e++}),this.uuid=Ml(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Iie(e)?fV:dV)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const l=new oi().getNormalMatrix(e);i.applyNormalMatrix(l),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return tc.makeRotationFromQuaternion(e),this.applyMatrix4(tc),this}rotateX(e){return tc.makeRotationX(e),this.applyMatrix4(tc),this}rotateY(e){return tc.makeRotationY(e),this.applyMatrix4(tc),this}rotateZ(e){return tc.makeRotationZ(e),this.applyMatrix4(tc),this}translate(e,t,i){return tc.makeTranslation(e,t,i),this.applyMatrix4(tc),this}scale(e,t,i){return tc.makeScale(e,t,i),this.applyMatrix4(tc),this}lookAt(e){return DB.lookAt(e),DB.updateMatrix(),this.applyMatrix4(DB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(my).negate(),this.translate(my.x,my.y,my.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let s=0,l=e.length;s<l;s++){const u=e[s];i.push(u.x,u.y,u.z||0)}this.setAttribute("position",new En(i,3))}else{const i=Math.min(e.length,t.count);for(let s=0;s<i;s++){const l=e[s];t.setXYZ(s,l.x,l.y,l.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ma);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ce(-1/0,-1/0,-1/0),new Ce(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const l=t[i];Cl.setFromBufferAttribute(l),this.morphTargetsRelative?(eo.addVectors(this.boundingBox.min,Cl.min),this.boundingBox.expandByPoint(eo),eo.addVectors(this.boundingBox.max,Cl.max),this.boundingBox.expandByPoint(eo)):(this.boundingBox.expandByPoint(Cl.min),this.boundingBox.expandByPoint(Cl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Yo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ce,1/0);return}if(e){const i=this.boundingSphere.center;if(Cl.setFromBufferAttribute(e),t)for(let l=0,u=t.length;l<u;l++){const d=t[l];Sb.setFromBufferAttribute(d),this.morphTargetsRelative?(eo.addVectors(Cl.min,Sb.min),Cl.expandByPoint(eo),eo.addVectors(Cl.max,Sb.max),Cl.expandByPoint(eo)):(Cl.expandByPoint(Sb.min),Cl.expandByPoint(Sb.max))}Cl.getCenter(i);let s=0;for(let l=0,u=e.count;l<u;l++)eo.fromBufferAttribute(e,l),s=Math.max(s,i.distanceToSquared(eo));if(t)for(let l=0,u=t.length;l<u;l++){const d=t[l],p=this.morphTargetsRelative;for(let g=0,x=d.count;g<x;g++)eo.fromBufferAttribute(d,g),p&&(my.fromBufferAttribute(e,g),eo.add(my)),s=Math.max(s,i.distanceToSquared(eo))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,l=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new sr(new Float32Array(4*i.count),4));const u=this.getAttribute("tangent"),d=[],p=[];for(let Q=0;Q<i.count;Q++)d[Q]=new Ce,p[Q]=new Ce;const g=new Ce,x=new Ce,b=new Ce,E=new St,S=new St,M=new St,R=new Ce,P=new Ce;function k(Q,H,j){g.fromBufferAttribute(i,Q),x.fromBufferAttribute(i,H),b.fromBufferAttribute(i,j),E.fromBufferAttribute(l,Q),S.fromBufferAttribute(l,H),M.fromBufferAttribute(l,j),x.sub(g),b.sub(g),S.sub(E),M.sub(E);const ee=1/(S.x*M.y-M.x*S.y);isFinite(ee)&&(R.copy(x).multiplyScalar(M.y).addScaledVector(b,-S.y).multiplyScalar(ee),P.copy(b).multiplyScalar(S.x).addScaledVector(x,-M.x).multiplyScalar(ee),d[Q].add(R),d[H].add(R),d[j].add(R),p[Q].add(P),p[H].add(P),p[j].add(P))}let F=this.groups;F.length===0&&(F=[{start:0,count:e.count}]);for(let Q=0,H=F.length;Q<H;++Q){const j=F[Q],ee=j.start,de=j.count;for(let oe=ee,we=ee+de;oe<we;oe+=3)k(e.getX(oe+0),e.getX(oe+1),e.getX(oe+2))}const V=new Ce,G=new Ce,q=new Ce,ne=new Ce;function K(Q){q.fromBufferAttribute(s,Q),ne.copy(q);const H=d[Q];V.copy(H),V.sub(q.multiplyScalar(q.dot(H))).normalize(),G.crossVectors(ne,H);const ee=G.dot(p[Q])<0?-1:1;u.setXYZW(Q,V.x,V.y,V.z,ee)}for(let Q=0,H=F.length;Q<H;++Q){const j=F[Q],ee=j.start,de=j.count;for(let oe=ee,we=ee+de;oe<we;oe+=3)K(e.getX(oe+0)),K(e.getX(oe+1)),K(e.getX(oe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new sr(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let E=0,S=i.count;E<S;E++)i.setXYZ(E,0,0,0);const s=new Ce,l=new Ce,u=new Ce,d=new Ce,p=new Ce,g=new Ce,x=new Ce,b=new Ce;if(e)for(let E=0,S=e.count;E<S;E+=3){const M=e.getX(E+0),R=e.getX(E+1),P=e.getX(E+2);s.fromBufferAttribute(t,M),l.fromBufferAttribute(t,R),u.fromBufferAttribute(t,P),x.subVectors(u,l),b.subVectors(s,l),x.cross(b),d.fromBufferAttribute(i,M),p.fromBufferAttribute(i,R),g.fromBufferAttribute(i,P),d.add(x),p.add(x),g.add(x),i.setXYZ(M,d.x,d.y,d.z),i.setXYZ(R,p.x,p.y,p.z),i.setXYZ(P,g.x,g.y,g.z)}else for(let E=0,S=t.count;E<S;E+=3)s.fromBufferAttribute(t,E+0),l.fromBufferAttribute(t,E+1),u.fromBufferAttribute(t,E+2),x.subVectors(u,l),b.subVectors(s,l),x.cross(b),i.setXYZ(E+0,x.x,x.y,x.z),i.setXYZ(E+1,x.x,x.y,x.z),i.setXYZ(E+2,x.x,x.y,x.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)eo.fromBufferAttribute(e,t),eo.normalize(),e.setXYZ(t,eo.x,eo.y,eo.z)}toNonIndexed(){function e(d,p){const g=d.array,x=d.itemSize,b=d.normalized,E=new g.constructor(p.length*x);let S=0,M=0;for(let R=0,P=p.length;R<P;R++){d.isInterleavedBufferAttribute?S=p[R]*d.data.stride+d.offset:S=p[R]*x;for(let k=0;k<x;k++)E[M++]=g[S++]}return new sr(E,x,b)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new pi,i=this.index.array,s=this.attributes;for(const d in s){const p=s[d],g=e(p,i);t.setAttribute(d,g)}const l=this.morphAttributes;for(const d in l){const p=[],g=l[d];for(let x=0,b=g.length;x<b;x++){const E=g[x],S=e(E,i);p.push(S)}t.morphAttributes[d]=p}t.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let d=0,p=u.length;d<p;d++){const g=u[d];t.addGroup(g.start,g.count,g.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const p=this.parameters;for(const g in p)p[g]!==void 0&&(e[g]=p[g]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const p in i){const g=i[p];e.data.attributes[p]=g.toJSON(e.data)}const s={};let l=!1;for(const p in this.morphAttributes){const g=this.morphAttributes[p],x=[];for(let b=0,E=g.length;b<E;b++){const S=g[b];x.push(S.toJSON(e.data))}x.length>0&&(s[p]=x,l=!0)}l&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));const d=this.boundingSphere;return d!==null&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const g in s){const x=s[g];this.setAttribute(g,x.clone(t))}const l=e.morphAttributes;for(const g in l){const x=[],b=l[g];for(let E=0,S=b.length;E<S;E++)x.push(b[E].clone(t));this.morphAttributes[g]=x}this.morphTargetsRelative=e.morphTargetsRelative;const u=e.groups;for(let g=0,x=u.length;g<x;g++){const b=u[g];this.addGroup(b.start,b.count,b.materialIndex)}const d=e.boundingBox;d!==null&&(this.boundingBox=d.clone());const p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const L6=new Zn,Xm=new tv,kE=new Yo,B6=new Ce,RE=new Ce,LE=new Ce,BE=new Ce,FB=new Ce,PE=new Ce,P6=new Ce,NE=new Ce;class Ms extends Xi{constructor(e=new pi,t=new Jp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const d=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,l=i.morphAttributes.position,u=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const d=this.morphTargetInfluences;if(l&&d){PE.set(0,0,0);for(let p=0,g=l.length;p<g;p++){const x=d[p],b=l[p];x!==0&&(FB.fromBufferAttribute(b,e),u?PE.addScaledVector(FB,x):PE.addScaledVector(FB.sub(t),x))}t.add(PE)}return t}raycast(e,t){const i=this.geometry,s=this.material,l=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),kE.copy(i.boundingSphere),kE.applyMatrix4(l),Xm.copy(e.ray).recast(e.near),!(kE.containsPoint(Xm.origin)===!1&&(Xm.intersectSphere(kE,B6)===null||Xm.origin.distanceToSquared(B6)>(e.far-e.near)**2))&&(L6.copy(l).invert(),Xm.copy(e.ray).applyMatrix4(L6),!(i.boundingBox!==null&&Xm.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Xm)))}_computeIntersections(e,t,i){let s;const l=this.geometry,u=this.material,d=l.index,p=l.attributes.position,g=l.attributes.uv,x=l.attributes.uv1,b=l.attributes.normal,E=l.groups,S=l.drawRange;if(d!==null)if(Array.isArray(u))for(let M=0,R=E.length;M<R;M++){const P=E[M],k=u[P.materialIndex],F=Math.max(P.start,S.start),V=Math.min(d.count,Math.min(P.start+P.count,S.start+S.count));for(let G=F,q=V;G<q;G+=3){const ne=d.getX(G),K=d.getX(G+1),Q=d.getX(G+2);s=DE(this,k,e,i,g,x,b,ne,K,Q),s&&(s.faceIndex=Math.floor(G/3),s.face.materialIndex=P.materialIndex,t.push(s))}}else{const M=Math.max(0,S.start),R=Math.min(d.count,S.start+S.count);for(let P=M,k=R;P<k;P+=3){const F=d.getX(P),V=d.getX(P+1),G=d.getX(P+2);s=DE(this,u,e,i,g,x,b,F,V,G),s&&(s.faceIndex=Math.floor(P/3),t.push(s))}}else if(p!==void 0)if(Array.isArray(u))for(let M=0,R=E.length;M<R;M++){const P=E[M],k=u[P.materialIndex],F=Math.max(P.start,S.start),V=Math.min(p.count,Math.min(P.start+P.count,S.start+S.count));for(let G=F,q=V;G<q;G+=3){const ne=G,K=G+1,Q=G+2;s=DE(this,k,e,i,g,x,b,ne,K,Q),s&&(s.faceIndex=Math.floor(G/3),s.face.materialIndex=P.materialIndex,t.push(s))}}else{const M=Math.max(0,S.start),R=Math.min(p.count,S.start+S.count);for(let P=M,k=R;P<k;P+=3){const F=P,V=P+1,G=P+2;s=DE(this,u,e,i,g,x,b,F,V,G),s&&(s.faceIndex=Math.floor(P/3),t.push(s))}}}}function A$e(n,e,t,i,s,l,u,d){let p;if(e.side===Ta?p=i.intersectTriangle(u,l,s,!0,d):p=i.intersectTriangle(s,l,u,e.side===Gd,d),p===null)return null;NE.copy(d),NE.applyMatrix4(n.matrixWorld);const g=t.ray.origin.distanceTo(NE);return g<t.near||g>t.far?null:{distance:g,point:NE.clone(),object:n}}function DE(n,e,t,i,s,l,u,d,p,g){n.getVertexPosition(d,RE),n.getVertexPosition(p,LE),n.getVertexPosition(g,BE);const x=A$e(n,e,t,i,RE,LE,BE,P6);if(x){const b=new Ce;Ya.getBarycoord(P6,RE,LE,BE,b),s&&(x.uv=Ya.getInterpolatedAttribute(s,d,p,g,b,new St)),l&&(x.uv1=Ya.getInterpolatedAttribute(l,d,p,g,b,new St)),u&&(x.normal=Ya.getInterpolatedAttribute(u,d,p,g,b,new Ce),x.normal.dot(i.direction)>0&&x.normal.multiplyScalar(-1));const E={a:d,b:p,c:g,normal:new Ce,materialIndex:0};Ya.getNormal(RE,LE,BE,E.normal),x.face=E,x.barycoord=b}return x}class d0 extends pi{constructor(e=1,t=1,i=1,s=1,l=1,u=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:l,depthSegments:u};const d=this;s=Math.floor(s),l=Math.floor(l),u=Math.floor(u);const p=[],g=[],x=[],b=[];let E=0,S=0;M("z","y","x",-1,-1,i,t,e,u,l,0),M("z","y","x",1,-1,i,t,-e,u,l,1),M("x","z","y",1,1,e,i,t,s,u,2),M("x","z","y",1,-1,e,i,-t,s,u,3),M("x","y","z",1,-1,e,t,i,s,l,4),M("x","y","z",-1,-1,e,t,-i,s,l,5),this.setIndex(p),this.setAttribute("position",new En(g,3)),this.setAttribute("normal",new En(x,3)),this.setAttribute("uv",new En(b,2));function M(R,P,k,F,V,G,q,ne,K,Q,H){const j=G/K,ee=q/Q,de=G/2,oe=q/2,we=ne/2,$e=K+1,Me=Q+1;let Ne=0,Ae=0;const Fe=new Ce;for(let Ie=0;Ie<Me;Ie++){const qe=Ie*ee-oe;for(let dt=0;dt<$e;dt++){const Wt=dt*j-de;Fe[R]=Wt*F,Fe[P]=qe*V,Fe[k]=we,g.push(Fe.x,Fe.y,Fe.z),Fe[R]=0,Fe[P]=0,Fe[k]=ne>0?1:-1,x.push(Fe.x,Fe.y,Fe.z),b.push(dt/K),b.push(1-Ie/Q),Ne+=1}}for(let Ie=0;Ie<Q;Ie++)for(let qe=0;qe<K;qe++){const dt=E+qe+$e*Ie,Wt=E+qe+$e*(Ie+1),xt=E+(qe+1)+$e*(Ie+1),At=E+(qe+1)+$e*Ie;p.push(dt,Wt,At),p.push(Wt,xt,At),Ae+=6}d.addGroup(S,Ae,H),S+=Ae,E+=Ne}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new d0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function UA(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function va(n){const e={};for(let t=0;t<n.length;t++){const i=UA(n[t]);for(const s in i)e[s]=i[s]}return e}function v$e(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function kie(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Fi.workingColorSpace}const Rie={clone:UA,merge:va};var b$e=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,x$e=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class au extends ea{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=b$e,this.fragmentShader=x$e,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=UA(e.uniforms),this.uniformsGroups=v$e(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const u=this.uniforms[s].value;u&&u.isTexture?t.uniforms[s]={type:"t",value:u.toJSON(e).uuid}:u&&u.isColor?t.uniforms[s]={type:"c",value:u.getHex()}:u&&u.isVector2?t.uniforms[s]={type:"v2",value:u.toArray()}:u&&u.isVector3?t.uniforms[s]={type:"v3",value:u.toArray()}:u&&u.isVector4?t.uniforms[s]={type:"v4",value:u.toArray()}:u&&u.isMatrix3?t.uniforms[s]={type:"m3",value:u.toArray()}:u&&u.isMatrix4?t.uniforms[s]={type:"m4",value:u.toArray()}:t.uniforms[s]={value:u}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class BT extends Xi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Zn,this.projectionMatrix=new Zn,this.projectionMatrixInverse=new Zn,this.coordinateSystem=nu}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Uf=new Ce,N6=new St,D6=new St;class Ao extends BT{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=VA*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Dg*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return VA*2*Math.atan(Math.tan(Dg*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Uf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Uf.x,Uf.y).multiplyScalar(-e/Uf.z),Uf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Uf.x,Uf.y).multiplyScalar(-e/Uf.z)}getViewSize(e,t){return this.getViewBounds(e,N6,D6),t.subVectors(D6,N6)}setViewOffset(e,t,i,s,l,u){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=l,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Dg*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,l=-.5*s;const u=this.view;if(this.view!==null&&this.view.enabled){const p=u.fullWidth,g=u.fullHeight;l+=u.offsetX*s/p,t-=u.offsetY*i/g,s*=u.width/p,i*=u.height/g}const d=this.filmOffset;d!==0&&(l+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const gy=-90,yy=1;class Lie extends Xi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Ao(gy,yy,e,t);s.layers=this.layers,this.add(s);const l=new Ao(gy,yy,e,t);l.layers=this.layers,this.add(l);const u=new Ao(gy,yy,e,t);u.layers=this.layers,this.add(u);const d=new Ao(gy,yy,e,t);d.layers=this.layers,this.add(d);const p=new Ao(gy,yy,e,t);p.layers=this.layers,this.add(p);const g=new Ao(gy,yy,e,t);g.layers=this.layers,this.add(g)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,l,u,d,p]=t;for(const g of t)this.remove(g);if(e===nu)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),u.up.set(0,0,1),u.lookAt(0,-1,0),d.up.set(0,1,0),d.lookAt(0,0,1),p.up.set(0,1,0),p.lookAt(0,0,-1);else if(e===E1)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),u.up.set(0,0,-1),u.lookAt(0,-1,0),d.up.set(0,-1,0),d.lookAt(0,0,1),p.up.set(0,-1,0),p.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const g of t)this.add(g),g.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[l,u,d,p,g,x]=this.children,b=e.getRenderTarget(),E=e.getActiveCubeFace(),S=e.getActiveMipmapLevel(),M=e.xr.enabled;e.xr.enabled=!1;const R=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,l),e.setRenderTarget(i,1,s),e.render(t,u),e.setRenderTarget(i,2,s),e.render(t,d),e.setRenderTarget(i,3,s),e.render(t,p),e.setRenderTarget(i,4,s),e.render(t,g),i.texture.generateMipmaps=R,e.setRenderTarget(i,5,s),e.render(t,x),e.setRenderTarget(b,E,S),e.xr.enabled=M,i.texture.needsPMREMUpdate=!0}}class lw extends Yr{constructor(e,t,i,s,l,u,d,p,g,x){e=e!==void 0?e:[],t=t!==void 0?t:Wd,super(e,t,i,s,l,u,d,p,g,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Bie extends ou{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new lw(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ws}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new d0(5,5,5),l=new au({name:"CubemapFromEquirect",uniforms:UA(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Ta,blending:Sd});l.uniforms.tEquirect.value=t;const u=new Ms(s,l),d=t.minFilter;return t.minFilter===ih&&(t.minFilter=Ws),new Lie(1,10,this).update(e,u),t.minFilter=d,u.geometry.dispose(),u.material.dispose(),this}clear(e,t,i,s){const l=e.getRenderTarget();for(let u=0;u<6;u++)e.setRenderTarget(this,u),e.clear(t,i,s);e.setRenderTarget(l)}}class iA extends Xi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const w$e={type:"move"};class hI{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new iA,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new iA,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ce,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ce),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new iA,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ce,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ce),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,l=null,u=null;const d=this._targetRay,p=this._grip,g=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(g&&e.hand){u=!0;for(const R of e.hand.values()){const P=t.getJointPose(R,i),k=this._getHandJoint(g,R);P!==null&&(k.matrix.fromArray(P.transform.matrix),k.matrix.decompose(k.position,k.rotation,k.scale),k.matrixWorldNeedsUpdate=!0,k.jointRadius=P.radius),k.visible=P!==null}const x=g.joints["index-finger-tip"],b=g.joints["thumb-tip"],E=x.position.distanceTo(b.position),S=.02,M=.005;g.inputState.pinching&&E>S+M?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&E<=S-M&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else p!==null&&e.gripSpace&&(l=t.getPose(e.gripSpace,i),l!==null&&(p.matrix.fromArray(l.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,l.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(l.linearVelocity)):p.hasLinearVelocity=!1,l.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(l.angularVelocity)):p.hasAngularVelocity=!1));d!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&l!==null&&(s=l),s!==null&&(d.matrix.fromArray(s.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,s.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(s.linearVelocity)):d.hasLinearVelocity=!1,s.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(s.angularVelocity)):d.hasAngularVelocity=!1,this.dispatchEvent(w$e)))}return d!==null&&(d.visible=s!==null),p!==null&&(p.visible=l!==null),g!==null&&(g.visible=u!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new iA;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class PT{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new An(e),this.density=t}clone(){return new PT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class NT{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new An(e),this.near=t,this.far=i}clone(){return new NT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Pie extends Xi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ll,this.environmentIntensity=1,this.environmentRotation=new Ll,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class DT{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=C1,this.updateRanges=[],this.version=0,this.uuid=Ml()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,l=this.stride;s<l;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ml()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ml()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ya=new Ce;class qg{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ya.fromBufferAttribute(this,t),ya.applyMatrix4(e),this.setXYZ(t,ya.x,ya.y,ya.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ya.fromBufferAttribute(this,t),ya.applyNormalMatrix(e),this.setXYZ(t,ya.x,ya.y,ya.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ya.fromBufferAttribute(this,t),ya.transformDirection(e),this.setXYZ(t,ya.x,ya.y,ya.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Ea(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=di(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=di(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Ea(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Ea(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Ea(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Ea(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,l){return e=e*this.data.stride+this.offset,this.normalized&&(t=di(t,this.array),i=di(i,this.array),s=di(s,this.array),l=di(l,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=l,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[s+l])}return new sr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new qg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let l=0;l<this.itemSize;l++)t.push(this.data.array[s+l])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class pV extends ea{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new An(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Ay;const Tb=new Ce,vy=new Ce,by=new Ce,xy=new St,Mb=new St,Nie=new Zn,FE=new Ce,kb=new Ce,OE=new Ce,F6=new St,OB=new St,O6=new St;class Die extends Xi{constructor(e=new pV){if(super(),this.isSprite=!0,this.type="Sprite",Ay===void 0){Ay=new pi;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new DT(t,5);Ay.setIndex([0,1,2,0,2,3]),Ay.setAttribute("position",new qg(i,3,0,!1)),Ay.setAttribute("uv",new qg(i,2,3,!1))}this.geometry=Ay,this.material=e,this.center=new St(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vy.setFromMatrixScale(this.matrixWorld),Nie.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),by.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&vy.multiplyScalar(-by.z);const i=this.material.rotation;let s,l;i!==0&&(l=Math.cos(i),s=Math.sin(i));const u=this.center;VE(FE.set(-.5,-.5,0),by,u,vy,s,l),VE(kb.set(.5,-.5,0),by,u,vy,s,l),VE(OE.set(.5,.5,0),by,u,vy,s,l),F6.set(0,0),OB.set(1,0),O6.set(1,1);let d=e.ray.intersectTriangle(FE,kb,OE,!1,Tb);if(d===null&&(VE(kb.set(-.5,.5,0),by,u,vy,s,l),OB.set(0,1),d=e.ray.intersectTriangle(FE,OE,kb,!1,Tb),d===null))return;const p=e.ray.origin.distanceTo(Tb);p<e.near||p>e.far||t.push({distance:p,point:Tb.clone(),uv:Ya.getInterpolation(Tb,FE,kb,OE,F6,OB,O6,new St),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function VE(n,e,t,i,s,l){xy.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(Mb.x=l*xy.x-s*xy.y,Mb.y=s*xy.x+l*xy.y):Mb.copy(xy),n.copy(e),n.x+=Mb.x,n.y+=Mb.y,n.applyMatrix4(Nie)}const UE=new Ce,V6=new Ce;class Fie extends Xi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,s=t.length;i<s;i++){const l=t[i];this.addLevel(l.object.clone(),l.distance,l.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const s=this.levels;let l;for(l=0;l<s.length&&!(t<s[l].distance);l++);return s.splice(l,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const s=t.splice(i,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s;i++){let l=t[i].distance;if(t[i].object.visible&&(l-=l*t[i].hysteresis),e<l)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){UE.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(UE);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){UE.setFromMatrixPosition(e.matrixWorld),V6.setFromMatrixPosition(this.matrixWorld);const i=UE.distanceTo(V6)/e.zoom;t[0].object.visible=!0;let s,l;for(s=1,l=t.length;s<l;s++){let u=t[s].distance;if(t[s].object.visible&&(u-=u*t[s].hysteresis),i>=u)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<l;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let s=0,l=i.length;s<l;s++){const u=i[s];t.object.levels.push({object:u.object.uuid,distance:u.distance,hysteresis:u.hysteresis})}return t}}const U6=new Ce,z6=new Wi,G6=new Wi,C$e=new Ce,W6=new Zn,zE=new Ce,VB=new Yo,H6=new Zn,UB=new tv;class Oie extends Ms{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=KD,this.bindMatrix=new Zn,this.bindMatrixInverse=new Zn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ma),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,zE),this.boundingBox.expandByPoint(zE)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Yo),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,zE),this.boundingSphere.expandByPoint(zE)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),VB.copy(this.boundingSphere),VB.applyMatrix4(s),e.ray.intersectsSphere(VB)!==!1&&(H6.copy(s).invert(),UB.copy(e.ray).applyMatrix4(H6),!(this.boundingBox!==null&&UB.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,UB)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Wi,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const l=1/e.manhattanLength();l!==1/0?e.multiplyScalar(l):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===KD?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===die?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;z6.fromBufferAttribute(s.attributes.skinIndex,e),G6.fromBufferAttribute(s.attributes.skinWeight,e),U6.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let l=0;l<4;l++){const u=G6.getComponent(l);if(u!==0){const d=z6.getComponent(l);W6.multiplyMatrices(i.bones[d].matrixWorld,i.boneInverses[d]),t.addScaledVector(C$e.copy(U6).applyMatrix4(W6),u)}}return t.applyMatrix4(this.bindMatrixInverse)}}class mV extends Xi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class mh extends Yr{constructor(e=null,t=1,i=1,s,l,u,d,p,g=Co,x=Co,b,E){super(null,u,d,p,g,x,s,l,b,E),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const X6=new Zn,E$e=new Zn;class FT{constructor(e=[],t=[]){this.uuid=Ml(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Zn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Zn;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let l=0,u=e.length;l<u;l++){const d=e[l]?e[l].matrixWorld:E$e;X6.multiplyMatrices(d,t[l]),X6.toArray(i,l*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new FT(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new mh(t,e,e,Ia,Ca);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const l=e.bones[i];let u=t[l];u===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",l),u=new mV),this.bones.push(u),this.boneInverses.push(new Zn().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,l=t.length;s<l;s++){const u=t[s];e.bones.push(u.uuid);const d=i[s];e.boneInverses.push(d.toArray())}return e}}class zA extends sr{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const wy=new Zn,$6=new Zn,GE=[],Q6=new Ma,_$e=new Zn,Rb=new Ms,Lb=new Yo;class Vie extends Ms{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new zA(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,_$e)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Ma),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wy),Q6.copy(e.boundingBox).applyMatrix4(wy),this.boundingBox.union(Q6)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Yo),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wy),Lb.copy(e.boundingSphere).applyMatrix4(wy),this.boundingSphere.union(Lb)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,l=i.length+1,u=e*l+1;for(let d=0;d<i.length;d++)i[d]=s[u+d]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(Rb.geometry=this.geometry,Rb.material=this.material,Rb.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Lb.copy(this.boundingSphere),Lb.applyMatrix4(i),e.ray.intersectsSphere(Lb)!==!1))for(let l=0;l<s;l++){this.getMatrixAt(l,wy),$6.multiplyMatrices(i,wy),Rb.matrixWorld=$6,Rb.raycast(e,GE);for(let u=0,d=GE.length;u<d;u++){const p=GE[u];p.instanceId=l,p.object=this,t.push(p)}GE.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new zA(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new mh(new Float32Array(s*this.count),s,this.count,IT,Ca));const l=this.morphTexture.source.data.data;let u=0;for(let g=0;g<i.length;g++)u+=i[g];const d=this.geometry.morphTargetsRelative?1:1-u,p=s*e;l[p]=d,l.set(i,p+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const zB=new Ce,I$e=new Ce,S$e=new oi;class Yf{constructor(e=new Ce(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=zB.subVectors(i,t).cross(I$e.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(zB),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/s;return l<0||l>1?null:t.copy(e.start).addScaledVector(i,l)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||S$e.getNormalMatrix(e),s=this.coplanarPoint(zB).applyMatrix4(e),l=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const $m=new Yo,WE=new Ce;class cw{constructor(e=new Yf,t=new Yf,i=new Yf,s=new Yf,l=new Yf,u=new Yf){this.planes=[e,t,i,s,l,u]}set(e,t,i,s,l,u){const d=this.planes;return d[0].copy(e),d[1].copy(t),d[2].copy(i),d[3].copy(s),d[4].copy(l),d[5].copy(u),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=nu){const i=this.planes,s=e.elements,l=s[0],u=s[1],d=s[2],p=s[3],g=s[4],x=s[5],b=s[6],E=s[7],S=s[8],M=s[9],R=s[10],P=s[11],k=s[12],F=s[13],V=s[14],G=s[15];if(i[0].setComponents(p-l,E-g,P-S,G-k).normalize(),i[1].setComponents(p+l,E+g,P+S,G+k).normalize(),i[2].setComponents(p+u,E+x,P+M,G+F).normalize(),i[3].setComponents(p-u,E-x,P-M,G-F).normalize(),i[4].setComponents(p-d,E-b,P-R,G-V).normalize(),t===nu)i[5].setComponents(p+d,E+b,P+R,G+V).normalize();else if(t===E1)i[5].setComponents(d,b,R,V).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),$m.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),$m.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere($m)}intersectsSprite(e){return $m.center.set(0,0,0),$m.radius=.7071067811865476,$m.applyMatrix4(e.matrixWorld),this.intersectsSphere($m)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let l=0;l<6;l++)if(t[l].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(WE.x=s.normal.x>0?e.max.x:e.min.x,WE.y=s.normal.y>0?e.max.y:e.min.y,WE.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(WE)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function GB(n,e){return n-e}function T$e(n,e){return n.z-e.z}function M$e(n,e){return e.z-n.z}class k$e{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,s){const l=this.pool,u=this.list;this.index>=l.length&&l.push({start:-1,count:-1,z:-1,index:-1});const d=l[this.index];u.push(d),this.index++,d.start=e,d.count=t,d.z=i,d.index=s}reset(){this.list.length=0,this.index=0}}const Xa=new Zn,R$e=new An(1,1,1),WB=new cw,HE=new Ma,Qm=new Yo,Bb=new Ce,K6=new Ce,L$e=new Ce,HB=new k$e,Xo=new Ms,XE=[];function B$e(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const s=n.count;for(let l=0;l<s;l++)for(let u=0;u<i;u++)e.setComponent(l+t,u,n.getComponent(l,u))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function Km(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class Uie extends Ms{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(e,t,i=t*2,s){super(new pi,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new mh(t,e,e,Ia,Ca);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new mh(t,e,e,ow,Hd);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new mh(t,e,e,Ia,Ca);i.colorSpace=Fi.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const l in e.attributes){const u=e.getAttribute(l),{array:d,itemSize:p,normalized:g}=u,x=new d.constructor(i*p),b=new sr(x,p,g);t.setAttribute(l,b)}if(e.getIndex()!==null){const l=i>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new sr(l,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const s=e.getAttribute(i),l=t.getAttribute(i);if(s.itemSize!==l.itemSize||s.normalized!==l.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ma);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const l=t[i].geometryIndex;this.getMatrixAt(i,Xa),this.getBoundingBoxAt(l,HE).applyMatrix4(Xa),e.union(HE)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Yo);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const l=t[i].geometryIndex;this.getMatrixAt(i,Xa),this.getBoundingSphereAt(l,Qm).applyMatrix4(Xa),e.union(Qm)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(GB),s=this._availableInstanceIds.shift(),this._instanceInfo[s]=i):(s=this._instanceInfo.length,this._instanceInfo.push(i));const l=this._matricesTexture;Xa.identity().toArray(l.image.data,s*16),l.needsUpdate=!0;const u=this._colorsTexture;return u&&(R$e.toArray(u.image.data,s*4),u.needsUpdate=!0),this._visibilityChanged=!0,s}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const s={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},l=this._geometryInfo;s.vertexStart=this._nextVertexStart,s.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const u=e.getIndex();if(u!==null&&(s.indexStart=this._nextIndexStart,s.reservedIndexCount=i===-1?u.count:i),s.indexStart!==-1&&s.indexStart+s.reservedIndexCount>this._maxIndexCount||s.vertexStart+s.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let p;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(GB),p=this._availableGeometryIds.shift(),l[p]=s):(p=this._geometryCount,this._geometryCount++,l.push(s)),this.setGeometryAt(p,e),this._nextIndexStart=s.indexStart+s.reservedIndexCount,this._nextVertexStart=s.vertexStart+s.reservedVertexCount,p}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,s=i.getIndex()!==null,l=i.getIndex(),u=t.getIndex(),d=this._geometryInfo[e];if(s&&u.count>d.reservedIndexCount||t.attributes.position.count>d.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const p=d.vertexStart,g=d.reservedVertexCount;d.vertexCount=t.getAttribute("position").count;for(const x in i.attributes){const b=t.getAttribute(x),E=i.getAttribute(x);B$e(b,E,p);const S=b.itemSize;for(let M=b.count,R=g;M<R;M++){const P=p+M;for(let k=0;k<S;k++)E.setComponent(P,k,0)}E.needsUpdate=!0,E.addUpdateRange(p*S,g*S)}if(s){const x=d.indexStart,b=d.reservedIndexCount;d.indexCount=t.getIndex().count;for(let E=0;E<u.count;E++)l.setX(x+E,p+u.getX(E));for(let E=u.count,S=b;E<S;E++)l.setX(x+E,p);l.needsUpdate=!0,l.addUpdateRange(x,d.reservedIndexCount)}return d.start=s?d.indexStart:d.vertexStart,d.count=s?d.indexCount:d.vertexCount,d.boundingBox=null,t.boundingBox!==null&&(d.boundingBox=t.boundingBox.clone()),d.boundingSphere=null,t.boundingSphere!==null&&(d.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let s=0,l=i.length;s<l;s++)i[s].active&&i[s].geometryIndex===e&&this.deleteInstance(s);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const i=this._geometryInfo,s=i.map((u,d)=>d).sort((u,d)=>i[u].vertexStart-i[d].vertexStart),l=this.geometry;for(let u=0,d=i.length;u<d;u++){const p=s[u],g=i[p];if(g.active!==!1){if(l.index!==null){if(g.indexStart!==t){const{indexStart:x,vertexStart:b,reservedIndexCount:E}=g,S=l.index,M=S.array,R=e-b;for(let P=x;P<x+E;P++)M[P]=M[P]+R;S.array.copyWithin(t,x,x+E),S.addUpdateRange(t,E),g.indexStart=t}t+=g.reservedIndexCount}if(g.vertexStart!==e){const{vertexStart:x,reservedVertexCount:b}=g,E=l.attributes;for(const S in E){const M=E[S],{array:R,itemSize:P}=M;R.copyWithin(e*P,x*P,(x+b)*P),M.addUpdateRange(e*P,b*P)}g.vertexStart=e}e+=g.reservedVertexCount,g.start=l.index?g.indexStart:g.vertexStart,this._nextIndexStart=l.index?g.indexStart+g.reservedIndexCount:0,this._nextVertexStart=g.vertexStart+g.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[e];if(s.boundingBox===null){const l=new Ma,u=i.index,d=i.attributes.position;for(let p=s.start,g=s.start+s.count;p<g;p++){let x=p;u&&(x=u.getX(x)),l.expandByPoint(Bb.fromBufferAttribute(d,x))}s.boundingBox=l}return t.copy(s.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,s=this._geometryInfo[e];if(s.boundingSphere===null){const l=new Yo;this.getBoundingBoxAt(e,HE),HE.getCenter(l.center);const u=i.index,d=i.attributes.position;let p=0;for(let g=s.start,x=s.start+s.count;g<x;g++){let b=g;u&&(b=u.getX(b)),Bb.fromBufferAttribute(d,b),p=Math.max(p,l.center.distanceToSquared(Bb))}l.radius=Math.sqrt(p),s.boundingSphere=l}return t.copy(s.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const i=this._matricesTexture,s=this._matricesTexture.image.data;return t.toArray(s,e*16),i.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort(GB);t[t.length-1]===i.length;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const s=new Int32Array(e),l=new Int32Array(e);Km(this._multiDrawCounts,s),Km(this._multiDrawStarts,l),this._multiDrawCounts=s,this._multiDrawStarts=l,this._maxInstanceCount=e;const u=this._indirectTexture,d=this._matricesTexture,p=this._colorsTexture;u.dispose(),this._initIndirectTexture(),Km(u.image.data,this._indirectTexture.image.data),d.dispose(),this._initMatricesTexture(),Km(d.image.data,this._matricesTexture.image.data),p&&(p.dispose(),this._initColorsTexture(),Km(p.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(d=>d.active);if(Math.max(...i.map(d=>d.vertexStart+d.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(p=>p.indexStart+p.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const l=this.geometry;l.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new pi,this._initializeGeometry(l));const u=this.geometry;l.index&&Km(l.index.array,u.index.array);for(const d in l.attributes)Km(l.attributes[d].array,u.attributes[d].array)}raycast(e,t){const i=this._instanceInfo,s=this._geometryInfo,l=this.matrixWorld,u=this.geometry;Xo.material=this.material,Xo.geometry.index=u.index,Xo.geometry.attributes=u.attributes,Xo.geometry.boundingBox===null&&(Xo.geometry.boundingBox=new Ma),Xo.geometry.boundingSphere===null&&(Xo.geometry.boundingSphere=new Yo);for(let d=0,p=i.length;d<p;d++){if(!i[d].visible||!i[d].active)continue;const g=i[d].geometryIndex,x=s[g];Xo.geometry.setDrawRange(x.start,x.count),this.getMatrixAt(d,Xo.matrixWorld).premultiply(l),this.getBoundingBoxAt(g,Xo.geometry.boundingBox),this.getBoundingSphereAt(g,Xo.geometry.boundingSphere),Xo.raycast(e,XE);for(let b=0,E=XE.length;b<E;b++){const S=XE[b];S.object=this,S.batchId=d,t.push(S)}XE.length=0}Xo.material=null,Xo.geometry.index=null,Xo.geometry.attributes={},Xo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,i,s,l){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const u=s.getIndex(),d=u===null?1:u.array.BYTES_PER_ELEMENT,p=this._instanceInfo,g=this._multiDrawStarts,x=this._multiDrawCounts,b=this._geometryInfo,E=this.perObjectFrustumCulled,S=this._indirectTexture,M=S.image.data;E&&(Xa.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),WB.setFromProjectionMatrix(Xa,e.coordinateSystem));let R=0;if(this.sortObjects){Xa.copy(this.matrixWorld).invert(),Bb.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Xa),K6.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Xa);for(let F=0,V=p.length;F<V;F++)if(p[F].visible&&p[F].active){const G=p[F].geometryIndex;this.getMatrixAt(F,Xa),this.getBoundingSphereAt(G,Qm).applyMatrix4(Xa);let q=!1;if(E&&(q=!WB.intersectsSphere(Qm)),!q){const ne=b[G],K=L$e.subVectors(Qm.center,Bb).dot(K6);HB.push(ne.start,ne.count,K,F)}}const P=HB.list,k=this.customSort;k===null?P.sort(l.transparent?M$e:T$e):k.call(this,P,i);for(let F=0,V=P.length;F<V;F++){const G=P[F];g[R]=G.start*d,x[R]=G.count,M[R]=G.index,R++}HB.reset()}else for(let P=0,k=p.length;P<k;P++)if(p[P].visible&&p[P].active){const F=p[P].geometryIndex;let V=!1;if(E&&(this.getMatrixAt(P,Xa),this.getBoundingSphereAt(F,Qm).applyMatrix4(Xa),V=!WB.intersectsSphere(Qm)),!V){const G=b[F];g[R]=G.start*d,x[R]=G.count,M[R]=P,R++}}S.needsUpdate=!0,this._multiDrawCount=R,this._visibilityChanged=!1}onBeforeShadow(e,t,i,s,l,u){this.onBeforeRender(e,null,s,l,u)}}class La extends ea{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new An(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const iS=new Ce,rS=new Ce,Z6=new Zn,Pb=new tv,$E=new Yo,XB=new Ce,j6=new Ce;class Hp extends Xi{constructor(e=new pi,t=new La){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,l=t.count;s<l;s++)iS.fromBufferAttribute(t,s-1),rS.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=iS.distanceTo(rS);e.setAttribute("lineDistance",new En(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,l=e.params.Line.threshold,u=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),$E.copy(i.boundingSphere),$E.applyMatrix4(s),$E.radius+=l,e.ray.intersectsSphere($E)===!1)return;Z6.copy(s).invert(),Pb.copy(e.ray).applyMatrix4(Z6);const d=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=d*d,g=this.isLineSegments?2:1,x=i.index,E=i.attributes.position;if(x!==null){const S=Math.max(0,u.start),M=Math.min(x.count,u.start+u.count);for(let R=S,P=M-1;R<P;R+=g){const k=x.getX(R),F=x.getX(R+1),V=QE(this,e,Pb,p,k,F,R);V&&t.push(V)}if(this.isLineLoop){const R=x.getX(M-1),P=x.getX(S),k=QE(this,e,Pb,p,R,P,M-1);k&&t.push(k)}}else{const S=Math.max(0,u.start),M=Math.min(E.count,u.start+u.count);for(let R=S,P=M-1;R<P;R+=g){const k=QE(this,e,Pb,p,R,R+1,R);k&&t.push(k)}if(this.isLineLoop){const R=QE(this,e,Pb,p,M-1,S,M-1);R&&t.push(R)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const d=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function QE(n,e,t,i,s,l,u){const d=n.geometry.attributes.position;if(iS.fromBufferAttribute(d,s),rS.fromBufferAttribute(d,l),t.distanceSqToSegment(iS,rS,XB,j6)>i)return;XB.applyMatrix4(n.matrixWorld);const g=e.ray.origin.distanceTo(XB);if(!(g<e.near||g>e.far))return{distance:g,point:j6.clone().applyMatrix4(n.matrixWorld),index:u,face:null,faceIndex:null,barycoord:null,object:n}}const Y6=new Ce,q6=new Ce;class Eh extends Hp{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,l=t.count;s<l;s+=2)Y6.fromBufferAttribute(t,s),q6.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+Y6.distanceTo(q6);e.setAttribute("lineDistance",new En(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class zie extends Hp{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class gV extends ea{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new An(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const J6=new Zn,YD=new tv,KE=new Yo,ZE=new Ce;class Gie extends Xi{constructor(e=new pi,t=new gV){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,l=e.params.Points.threshold,u=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),KE.copy(i.boundingSphere),KE.applyMatrix4(s),KE.radius+=l,e.ray.intersectsSphere(KE)===!1)return;J6.copy(s).invert(),YD.copy(e.ray).applyMatrix4(J6);const d=l/((this.scale.x+this.scale.y+this.scale.z)/3),p=d*d,g=i.index,b=i.attributes.position;if(g!==null){const E=Math.max(0,u.start),S=Math.min(g.count,u.start+u.count);for(let M=E,R=S;M<R;M++){const P=g.getX(M);ZE.fromBufferAttribute(b,P),eZ(ZE,P,p,s,e,t,this)}}else{const E=Math.max(0,u.start),S=Math.min(b.count,u.start+u.count);for(let M=E,R=S;M<R;M++)ZE.fromBufferAttribute(b,M),eZ(ZE,M,p,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,u=s.length;l<u;l++){const d=s[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=l}}}}}function eZ(n,e,t,i,s,l,u){const d=YD.distanceSqToPoint(n);if(d<t){const p=new Ce;YD.closestPointToPoint(n,p),p.applyMatrix4(i);const g=s.ray.origin.distanceTo(p);if(g<s.near||g>s.far)return;l.push({distance:g,distanceToRay:Math.sqrt(d),point:p,index:e,face:null,faceIndex:null,barycoord:null,object:u})}}class Wie extends Yr{constructor(e,t,i,s,l,u,d,p,g){super(e,t,i,s,l,u,d,p,g),this.isVideoTexture=!0,this.minFilter=u!==void 0?u:Ws,this.magFilter=l!==void 0?l:Ws,this.generateMipmaps=!1;const x=this;function b(){x.needsUpdate=!0,e.requestVideoFrameCallback(b)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(b)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class P$e extends Wie{constructor(e,t,i,s,l,u,d,p){super({},e,t,i,s,l,u,d,p),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class N$e extends Yr{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Co,this.minFilter=Co,this.generateMipmaps=!1,this.needsUpdate=!0}}class OT extends Yr{constructor(e,t,i,s,l,u,d,p,g,x,b,E){super(null,u,d,p,g,x,s,l,b,E),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class D$e extends OT{constructor(e,t,i,s,l,u){super(e,t,i,l,u),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=hc,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class F$e extends OT{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Wd),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class O$e extends Yr{constructor(e,t,i,s,l,u,d,p,g){super(e,t,i,s,l,u,d,p,g),this.isCanvasTexture=!0,this.needsUpdate=!0}}class yV extends Yr{constructor(e,t,i,s,l,u,d,p,g,x=Mp){if(x!==Mp&&x!==kp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===Mp&&(i=Hd),i===void 0&&x===kp&&(i=Tp),super(null,s,l,u,d,p,x,i,g),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=d!==void 0?d:Co,this.minFilter=p!==void 0?p:Co,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class lu{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),l=0;t.push(0);for(let u=1;u<=e;u++)i=this.getPoint(u/e),l+=i.distanceTo(s),t.push(l),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const l=i.length;let u;t?u=t:u=e*i[l-1];let d=0,p=l-1,g;for(;d<=p;)if(s=Math.floor(d+(p-d)/2),g=i[s]-u,g<0)d=s+1;else if(g>0)p=s-1;else{p=s;break}if(s=p,i[s]===u)return s/(l-1);const x=i[s],E=i[s+1]-x,S=(u-x)/E;return(s+S)/(l-1)}getTangent(e,t){let s=e-1e-4,l=e+1e-4;s<0&&(s=0),l>1&&(l=1);const u=this.getPoint(s),d=this.getPoint(l),p=t||(u.isVector2?new St:new Ce);return p.copy(d).sub(u).normalize(),p}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Ce,s=[],l=[],u=[],d=new Ce,p=new Zn;for(let S=0;S<=e;S++){const M=S/e;s[S]=this.getTangentAt(M,new Ce)}l[0]=new Ce,u[0]=new Ce;let g=Number.MAX_VALUE;const x=Math.abs(s[0].x),b=Math.abs(s[0].y),E=Math.abs(s[0].z);x<=g&&(g=x,i.set(1,0,0)),b<=g&&(g=b,i.set(0,1,0)),E<=g&&i.set(0,0,1),d.crossVectors(s[0],i).normalize(),l[0].crossVectors(s[0],d),u[0].crossVectors(s[0],l[0]);for(let S=1;S<=e;S++){if(l[S]=l[S-1].clone(),u[S]=u[S-1].clone(),d.crossVectors(s[S-1],s[S]),d.length()>Number.EPSILON){d.normalize();const M=Math.acos(ai(s[S-1].dot(s[S]),-1,1));l[S].applyMatrix4(p.makeRotationAxis(d,M))}u[S].crossVectors(s[S],l[S])}if(t===!0){let S=Math.acos(ai(l[0].dot(l[e]),-1,1));S/=e,s[0].dot(d.crossVectors(l[0],l[e]))>0&&(S=-S);for(let M=1;M<=e;M++)l[M].applyMatrix4(p.makeRotationAxis(s[M],S*M)),u[M].crossVectors(s[M],l[M])}return{tangents:s,normals:l,binormals:u}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class VT extends lu{constructor(e=0,t=0,i=1,s=1,l=0,u=Math.PI*2,d=!1,p=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=l,this.aEndAngle=u,this.aClockwise=d,this.aRotation=p}getPoint(e,t=new St){const i=t,s=Math.PI*2;let l=this.aEndAngle-this.aStartAngle;const u=Math.abs(l)<Number.EPSILON;for(;l<0;)l+=s;for(;l>s;)l-=s;l<Number.EPSILON&&(u?l=0:l=s),this.aClockwise===!0&&!u&&(l===s?l=-s:l=l-s);const d=this.aStartAngle+e*l;let p=this.aX+this.xRadius*Math.cos(d),g=this.aY+this.yRadius*Math.sin(d);if(this.aRotation!==0){const x=Math.cos(this.aRotation),b=Math.sin(this.aRotation),E=p-this.aX,S=g-this.aY;p=E*x-S*b+this.aX,g=E*b+S*x+this.aY}return i.set(p,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Hie extends VT{constructor(e,t,i,s,l,u){super(e,t,i,i,s,l,u),this.isArcCurve=!0,this.type="ArcCurve"}}function AV(){let n=0,e=0,t=0,i=0;function s(l,u,d,p){n=l,e=d,t=-3*l+3*u-2*d-p,i=2*l-2*u+d+p}return{initCatmullRom:function(l,u,d,p,g){s(u,d,g*(d-l),g*(p-u))},initNonuniformCatmullRom:function(l,u,d,p,g,x,b){let E=(u-l)/g-(d-l)/(g+x)+(d-u)/x,S=(d-u)/x-(p-u)/(x+b)+(p-d)/b;E*=x,S*=x,s(u,d,E,S)},calc:function(l){const u=l*l,d=u*l;return n+e*l+t*u+i*d}}}const jE=new Ce,$B=new AV,QB=new AV,KB=new AV;class Xie extends lu{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new Ce){const i=t,s=this.points,l=s.length,u=(l-(this.closed?0:1))*e;let d=Math.floor(u),p=u-d;this.closed?d+=d>0?0:(Math.floor(Math.abs(d)/l)+1)*l:p===0&&d===l-1&&(d=l-2,p=1);let g,x;this.closed||d>0?g=s[(d-1)%l]:(jE.subVectors(s[0],s[1]).add(s[0]),g=jE);const b=s[d%l],E=s[(d+1)%l];if(this.closed||d+2<l?x=s[(d+2)%l]:(jE.subVectors(s[l-1],s[l-2]).add(s[l-1]),x=jE),this.curveType==="centripetal"||this.curveType==="chordal"){const S=this.curveType==="chordal"?.5:.25;let M=Math.pow(g.distanceToSquared(b),S),R=Math.pow(b.distanceToSquared(E),S),P=Math.pow(E.distanceToSquared(x),S);R<1e-4&&(R=1),M<1e-4&&(M=R),P<1e-4&&(P=R),$B.initNonuniformCatmullRom(g.x,b.x,E.x,x.x,M,R,P),QB.initNonuniformCatmullRom(g.y,b.y,E.y,x.y,M,R,P),KB.initNonuniformCatmullRom(g.z,b.z,E.z,x.z,M,R,P)}else this.curveType==="catmullrom"&&($B.initCatmullRom(g.x,b.x,E.x,x.x,this.tension),QB.initCatmullRom(g.y,b.y,E.y,x.y,this.tension),KB.initCatmullRom(g.z,b.z,E.z,x.z,this.tension));return i.set($B.calc(p),QB.calc(p),KB.calc(p)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new Ce().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function tZ(n,e,t,i,s){const l=(i-e)*.5,u=(s-t)*.5,d=n*n,p=n*d;return(2*t-2*i+l+u)*p+(-3*t+3*i-2*l-u)*d+l*n+t}function V$e(n,e){const t=1-n;return t*t*e}function U$e(n,e){return 2*(1-n)*n*e}function z$e(n,e){return n*n*e}function Bx(n,e,t,i){return V$e(n,e)+U$e(n,t)+z$e(n,i)}function G$e(n,e){const t=1-n;return t*t*t*e}function W$e(n,e){const t=1-n;return 3*t*t*n*e}function H$e(n,e){return 3*(1-n)*n*n*e}function X$e(n,e){return n*n*n*e}function Px(n,e,t,i,s){return G$e(n,e)+W$e(n,t)+H$e(n,i)+X$e(n,s)}class vV extends lu{constructor(e=new St,t=new St,i=new St,s=new St){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new St){const i=t,s=this.v0,l=this.v1,u=this.v2,d=this.v3;return i.set(Px(e,s.x,l.x,u.x,d.x),Px(e,s.y,l.y,u.y,d.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class $ie extends lu{constructor(e=new Ce,t=new Ce,i=new Ce,s=new Ce){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new Ce){const i=t,s=this.v0,l=this.v1,u=this.v2,d=this.v3;return i.set(Px(e,s.x,l.x,u.x,d.x),Px(e,s.y,l.y,u.y,d.y),Px(e,s.z,l.z,u.z,d.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class bV extends lu{constructor(e=new St,t=new St){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new St){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new St){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qie extends lu{constructor(e=new Ce,t=new Ce){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Ce){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Ce){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xV extends lu{constructor(e=new St,t=new St,i=new St){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new St){const i=t,s=this.v0,l=this.v1,u=this.v2;return i.set(Bx(e,s.x,l.x,u.x),Bx(e,s.y,l.y,u.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class wV extends lu{constructor(e=new Ce,t=new Ce,i=new Ce){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Ce){const i=t,s=this.v0,l=this.v1,u=this.v2;return i.set(Bx(e,s.x,l.x,u.x),Bx(e,s.y,l.y,u.y),Bx(e,s.z,l.z,u.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class CV extends lu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new St){const i=t,s=this.points,l=(s.length-1)*e,u=Math.floor(l),d=l-u,p=s[u===0?u:u-1],g=s[u],x=s[u>s.length-2?s.length-1:u+1],b=s[u>s.length-3?s.length-1:u+2];return i.set(tZ(d,p.x,g.x,x.x,b.x),tZ(d,p.y,g.y,x.y,b.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new St().fromArray(s))}return this}}var sS=Object.freeze({__proto__:null,ArcCurve:Hie,CatmullRomCurve3:Xie,CubicBezierCurve:vV,CubicBezierCurve3:$ie,EllipseCurve:VT,LineCurve:bV,LineCurve3:Qie,QuadraticBezierCurve:xV,QuadraticBezierCurve3:wV,SplineCurve:CV});class Kie extends lu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new sS[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let l=0;for(;l<s.length;){if(s[l]>=i){const u=s[l]-i,d=this.curves[l],p=d.getLength(),g=p===0?0:1-u/p;return d.getPointAt(g,t)}l++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,l=this.curves;s<l.length;s++){const u=l[s],d=u.isEllipseCurve?e*2:u.isLineCurve||u.isLineCurve3?1:u.isSplineCurve?e*u.points.length:e,p=u.getPoints(d);for(let g=0;g<p.length;g++){const x=p[g];i&&i.equals(x)||(t.push(x),i=x)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new sS[s.type]().fromJSON(s))}return this}}class I1 extends Kie{constructor(e){super(),this.type="Path",this.currentPoint=new St,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new bV(this.currentPoint.clone(),new St(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const l=new xV(this.currentPoint.clone(),new St(e,t),new St(i,s));return this.curves.push(l),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,l,u){const d=new vV(this.currentPoint.clone(),new St(e,t),new St(i,s),new St(l,u));return this.curves.push(d),this.currentPoint.set(l,u),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new CV(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,l,u){const d=this.currentPoint.x,p=this.currentPoint.y;return this.absarc(e+d,t+p,i,s,l,u),this}absarc(e,t,i,s,l,u){return this.absellipse(e,t,i,i,s,l,u),this}ellipse(e,t,i,s,l,u,d,p){const g=this.currentPoint.x,x=this.currentPoint.y;return this.absellipse(e+g,t+x,i,s,l,u,d,p),this}absellipse(e,t,i,s,l,u,d,p){const g=new VT(e,t,i,s,l,u,d,p);if(this.curves.length>0){const b=g.getPoint(0);b.equals(this.currentPoint)||this.lineTo(b.x,b.y)}this.curves.push(g);const x=g.getPoint(1);return this.currentPoint.copy(x),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class uw extends pi{constructor(e=[new St(0,-.5),new St(.5,0),new St(0,.5)],t=12,i=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:s},t=Math.floor(t),s=ai(s,0,Math.PI*2);const l=[],u=[],d=[],p=[],g=[],x=1/t,b=new Ce,E=new St,S=new Ce,M=new Ce,R=new Ce;let P=0,k=0;for(let F=0;F<=e.length-1;F++)switch(F){case 0:P=e[F+1].x-e[F].x,k=e[F+1].y-e[F].y,S.x=k*1,S.y=-P,S.z=k*0,R.copy(S),S.normalize(),p.push(S.x,S.y,S.z);break;case e.length-1:p.push(R.x,R.y,R.z);break;default:P=e[F+1].x-e[F].x,k=e[F+1].y-e[F].y,S.x=k*1,S.y=-P,S.z=k*0,M.copy(S),S.x+=R.x,S.y+=R.y,S.z+=R.z,S.normalize(),p.push(S.x,S.y,S.z),R.copy(M)}for(let F=0;F<=t;F++){const V=i+F*x*s,G=Math.sin(V),q=Math.cos(V);for(let ne=0;ne<=e.length-1;ne++){b.x=e[ne].x*G,b.y=e[ne].y,b.z=e[ne].x*q,u.push(b.x,b.y,b.z),E.x=F/t,E.y=ne/(e.length-1),d.push(E.x,E.y);const K=p[3*ne+0]*G,Q=p[3*ne+1],H=p[3*ne+0]*q;g.push(K,Q,H)}}for(let F=0;F<t;F++)for(let V=0;V<e.length-1;V++){const G=V+F*e.length,q=G,ne=G+e.length,K=G+e.length+1,Q=G+1;l.push(q,ne,Q),l.push(K,Q,ne)}this.setIndex(l),this.setAttribute("position",new En(u,3)),this.setAttribute("uv",new En(d,2)),this.setAttribute("normal",new En(g,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uw(e.points,e.segments,e.phiStart,e.phiLength)}}class UT extends uw{constructor(e=1,t=1,i=4,s=8){const l=new I1;l.absarc(0,-t/2,e,Math.PI*1.5,0),l.absarc(0,t/2,e,0,Math.PI*.5),super(l.getPoints(i),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:s}}static fromJSON(e){return new UT(e.radius,e.length,e.capSegments,e.radialSegments)}}class zT extends pi{constructor(e=1,t=32,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const l=[],u=[],d=[],p=[],g=new Ce,x=new St;u.push(0,0,0),d.push(0,0,1),p.push(.5,.5);for(let b=0,E=3;b<=t;b++,E+=3){const S=i+b/t*s;g.x=e*Math.cos(S),g.y=e*Math.sin(S),u.push(g.x,g.y,g.z),d.push(0,0,1),x.x=(u[E]/e+1)/2,x.y=(u[E+1]/e+1)/2,p.push(x.x,x.y)}for(let b=1;b<=t;b++)l.push(b,b+1,0);this.setIndex(l),this.setAttribute("position",new En(u,3)),this.setAttribute("normal",new En(d,3)),this.setAttribute("uv",new En(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class nv extends pi{constructor(e=1,t=1,i=1,s=32,l=1,u=!1,d=0,p=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:l,openEnded:u,thetaStart:d,thetaLength:p};const g=this;s=Math.floor(s),l=Math.floor(l);const x=[],b=[],E=[],S=[];let M=0;const R=[],P=i/2;let k=0;F(),u===!1&&(e>0&&V(!0),t>0&&V(!1)),this.setIndex(x),this.setAttribute("position",new En(b,3)),this.setAttribute("normal",new En(E,3)),this.setAttribute("uv",new En(S,2));function F(){const G=new Ce,q=new Ce;let ne=0;const K=(t-e)/i;for(let Q=0;Q<=l;Q++){const H=[],j=Q/l,ee=j*(t-e)+e;for(let de=0;de<=s;de++){const oe=de/s,we=oe*p+d,$e=Math.sin(we),Me=Math.cos(we);q.x=ee*$e,q.y=-j*i+P,q.z=ee*Me,b.push(q.x,q.y,q.z),G.set($e,K,Me).normalize(),E.push(G.x,G.y,G.z),S.push(oe,1-j),H.push(M++)}R.push(H)}for(let Q=0;Q<s;Q++)for(let H=0;H<l;H++){const j=R[H][Q],ee=R[H+1][Q],de=R[H+1][Q+1],oe=R[H][Q+1];(e>0||H!==0)&&(x.push(j,ee,oe),ne+=3),(t>0||H!==l-1)&&(x.push(ee,de,oe),ne+=3)}g.addGroup(k,ne,0),k+=ne}function V(G){const q=M,ne=new St,K=new Ce;let Q=0;const H=G===!0?e:t,j=G===!0?1:-1;for(let de=1;de<=s;de++)b.push(0,P*j,0),E.push(0,j,0),S.push(.5,.5),M++;const ee=M;for(let de=0;de<=s;de++){const we=de/s*p+d,$e=Math.cos(we),Me=Math.sin(we);K.x=H*Me,K.y=P*j,K.z=H*$e,b.push(K.x,K.y,K.z),E.push(0,j,0),ne.x=$e*.5+.5,ne.y=Me*.5*j+.5,S.push(ne.x,ne.y),M++}for(let de=0;de<s;de++){const oe=q+de,we=ee+de;G===!0?x.push(we,we+1,oe):x.push(we+1,we,oe),Q+=3}g.addGroup(k,Q,G===!0?1:2),k+=Q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nv(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class GT extends nv{constructor(e=1,t=1,i=32,s=1,l=!1,u=0,d=Math.PI*2){super(0,e,t,i,s,l,u,d),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:l,thetaStart:u,thetaLength:d}}static fromJSON(e){return new GT(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class em extends pi{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const l=[],u=[];d(s),g(i),x(),this.setAttribute("position",new En(l,3)),this.setAttribute("normal",new En(l.slice(),3)),this.setAttribute("uv",new En(u,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function d(F){const V=new Ce,G=new Ce,q=new Ce;for(let ne=0;ne<t.length;ne+=3)S(t[ne+0],V),S(t[ne+1],G),S(t[ne+2],q),p(V,G,q,F)}function p(F,V,G,q){const ne=q+1,K=[];for(let Q=0;Q<=ne;Q++){K[Q]=[];const H=F.clone().lerp(G,Q/ne),j=V.clone().lerp(G,Q/ne),ee=ne-Q;for(let de=0;de<=ee;de++)de===0&&Q===ne?K[Q][de]=H:K[Q][de]=H.clone().lerp(j,de/ee)}for(let Q=0;Q<ne;Q++)for(let H=0;H<2*(ne-Q)-1;H++){const j=Math.floor(H/2);H%2===0?(E(K[Q][j+1]),E(K[Q+1][j]),E(K[Q][j])):(E(K[Q][j+1]),E(K[Q+1][j+1]),E(K[Q+1][j]))}}function g(F){const V=new Ce;for(let G=0;G<l.length;G+=3)V.x=l[G+0],V.y=l[G+1],V.z=l[G+2],V.normalize().multiplyScalar(F),l[G+0]=V.x,l[G+1]=V.y,l[G+2]=V.z}function x(){const F=new Ce;for(let V=0;V<l.length;V+=3){F.x=l[V+0],F.y=l[V+1],F.z=l[V+2];const G=P(F)/2/Math.PI+.5,q=k(F)/Math.PI+.5;u.push(G,1-q)}M(),b()}function b(){for(let F=0;F<u.length;F+=6){const V=u[F+0],G=u[F+2],q=u[F+4],ne=Math.max(V,G,q),K=Math.min(V,G,q);ne>.9&&K<.1&&(V<.2&&(u[F+0]+=1),G<.2&&(u[F+2]+=1),q<.2&&(u[F+4]+=1))}}function E(F){l.push(F.x,F.y,F.z)}function S(F,V){const G=F*3;V.x=e[G+0],V.y=e[G+1],V.z=e[G+2]}function M(){const F=new Ce,V=new Ce,G=new Ce,q=new Ce,ne=new St,K=new St,Q=new St;for(let H=0,j=0;H<l.length;H+=9,j+=6){F.set(l[H+0],l[H+1],l[H+2]),V.set(l[H+3],l[H+4],l[H+5]),G.set(l[H+6],l[H+7],l[H+8]),ne.set(u[j+0],u[j+1]),K.set(u[j+2],u[j+3]),Q.set(u[j+4],u[j+5]),q.copy(F).add(V).add(G).divideScalar(3);const ee=P(q);R(ne,j+0,F,ee),R(K,j+2,V,ee),R(Q,j+4,G,ee)}}function R(F,V,G,q){q<0&&F.x===1&&(u[V]=F.x-1),G.x===0&&G.z===0&&(u[V]=q/2/Math.PI+.5)}function P(F){return Math.atan2(F.z,-F.x)}function k(F){return Math.atan2(-F.y,Math.sqrt(F.x*F.x+F.z*F.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new em(e.vertices,e.indices,e.radius,e.details)}}class WT extends em{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=1/i,l=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],u=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(l,u,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new WT(e.radius,e.detail)}}const YE=new Ce,qE=new Ce,ZB=new Ce,JE=new Ya;class Zie extends pi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),l=Math.cos(Dg*t),u=e.getIndex(),d=e.getAttribute("position"),p=u?u.count:d.count,g=[0,0,0],x=["a","b","c"],b=new Array(3),E={},S=[];for(let M=0;M<p;M+=3){u?(g[0]=u.getX(M),g[1]=u.getX(M+1),g[2]=u.getX(M+2)):(g[0]=M,g[1]=M+1,g[2]=M+2);const{a:R,b:P,c:k}=JE;if(R.fromBufferAttribute(d,g[0]),P.fromBufferAttribute(d,g[1]),k.fromBufferAttribute(d,g[2]),JE.getNormal(ZB),b[0]=`${Math.round(R.x*s)},${Math.round(R.y*s)},${Math.round(R.z*s)}`,b[1]=`${Math.round(P.x*s)},${Math.round(P.y*s)},${Math.round(P.z*s)}`,b[2]=`${Math.round(k.x*s)},${Math.round(k.y*s)},${Math.round(k.z*s)}`,!(b[0]===b[1]||b[1]===b[2]||b[2]===b[0]))for(let F=0;F<3;F++){const V=(F+1)%3,G=b[F],q=b[V],ne=JE[x[F]],K=JE[x[V]],Q=`${G}_${q}`,H=`${q}_${G}`;H in E&&E[H]?(ZB.dot(E[H].normal)<=l&&(S.push(ne.x,ne.y,ne.z),S.push(K.x,K.y,K.z)),E[H]=null):Q in E||(E[Q]={index0:g[F],index1:g[V],normal:ZB.clone()})}}for(const M in E)if(E[M]){const{index0:R,index1:P}=E[M];YE.fromBufferAttribute(d,R),qE.fromBufferAttribute(d,P),S.push(YE.x,YE.y,YE.z),S.push(qE.x,qE.y,qE.z)}this.setAttribute("position",new En(S,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Fg extends I1{constructor(e){super(e),this.uuid=Ml(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new I1().fromJSON(s))}return this}}const $$e={triangulate:function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let l=jie(n,0,s,t,!0);const u=[];if(!l||l.next===l.prev)return u;let d,p,g,x,b,E,S;if(i&&(l=Y$e(n,e,l,t)),n.length>80*t){d=g=n[0],p=x=n[1];for(let M=t;M<s;M+=t)b=n[M],E=n[M+1],b<d&&(d=b),E<p&&(p=E),b>g&&(g=b),E>x&&(x=E);S=Math.max(g-d,x-p),S=S!==0?32767/S:0}return S1(l,u,t,d,p,S,0),u}};function jie(n,e,t,i,s){let l,u;if(s===lQe(n,e,t,i)>0)for(l=e;l<t;l+=i)u=nZ(l,n[l],n[l+1],u);else for(l=t-i;l>=e;l-=i)u=nZ(l,n[l],n[l+1],u);return u&&HT(u,u.next)&&(M1(u),u=u.next),u}function Jg(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(HT(t,t.next)||Fr(t.prev,t,t.next)===0)){if(M1(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function S1(n,e,t,i,s,l,u){if(!n)return;!u&&l&&nQe(n,i,s,l);let d=n,p,g;for(;n.prev!==n.next;){if(p=n.prev,g=n.next,l?K$e(n,i,s,l):Q$e(n)){e.push(p.i/t|0),e.push(n.i/t|0),e.push(g.i/t|0),M1(n),n=g.next,d=g.next;continue}if(n=g,n===d){u?u===1?(n=Z$e(Jg(n),e,t),S1(n,e,t,i,s,l,2)):u===2&&j$e(n,e,t,i,s,l):S1(Jg(n),e,t,i,s,l,1);break}}}function Q$e(n){const e=n.prev,t=n,i=n.next;if(Fr(e,t,i)>=0)return!1;const s=e.x,l=t.x,u=i.x,d=e.y,p=t.y,g=i.y,x=s<l?s<u?s:u:l<u?l:u,b=d<p?d<g?d:g:p<g?p:g,E=s>l?s>u?s:u:l>u?l:u,S=d>p?d>g?d:g:p>g?p:g;let M=i.next;for(;M!==e;){if(M.x>=x&&M.x<=E&&M.y>=b&&M.y<=S&&rA(s,d,l,p,u,g,M.x,M.y)&&Fr(M.prev,M,M.next)>=0)return!1;M=M.next}return!0}function K$e(n,e,t,i){const s=n.prev,l=n,u=n.next;if(Fr(s,l,u)>=0)return!1;const d=s.x,p=l.x,g=u.x,x=s.y,b=l.y,E=u.y,S=d<p?d<g?d:g:p<g?p:g,M=x<b?x<E?x:E:b<E?b:E,R=d>p?d>g?d:g:p>g?p:g,P=x>b?x>E?x:E:b>E?b:E,k=qD(S,M,e,t,i),F=qD(R,P,e,t,i);let V=n.prevZ,G=n.nextZ;for(;V&&V.z>=k&&G&&G.z<=F;){if(V.x>=S&&V.x<=R&&V.y>=M&&V.y<=P&&V!==s&&V!==u&&rA(d,x,p,b,g,E,V.x,V.y)&&Fr(V.prev,V,V.next)>=0||(V=V.prevZ,G.x>=S&&G.x<=R&&G.y>=M&&G.y<=P&&G!==s&&G!==u&&rA(d,x,p,b,g,E,G.x,G.y)&&Fr(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;V&&V.z>=k;){if(V.x>=S&&V.x<=R&&V.y>=M&&V.y<=P&&V!==s&&V!==u&&rA(d,x,p,b,g,E,V.x,V.y)&&Fr(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;G&&G.z<=F;){if(G.x>=S&&G.x<=R&&G.y>=M&&G.y<=P&&G!==s&&G!==u&&rA(d,x,p,b,g,E,G.x,G.y)&&Fr(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function Z$e(n,e,t){let i=n;do{const s=i.prev,l=i.next.next;!HT(s,l)&&Yie(s,i,i.next,l)&&T1(s,l)&&T1(l,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(l.i/t|0),M1(i),M1(i.next),i=n=l),i=i.next}while(i!==n);return Jg(i)}function j$e(n,e,t,i,s,l){let u=n;do{let d=u.next.next;for(;d!==u.prev;){if(u.i!==d.i&&sQe(u,d)){let p=qie(u,d);u=Jg(u,u.next),p=Jg(p,p.next),S1(u,e,t,i,s,l,0),S1(p,e,t,i,s,l,0);return}d=d.next}u=u.next}while(u!==n)}function Y$e(n,e,t,i){const s=[];let l,u,d,p,g;for(l=0,u=e.length;l<u;l++)d=e[l]*i,p=l<u-1?e[l+1]*i:n.length,g=jie(n,d,p,i,!1),g===g.next&&(g.steiner=!0),s.push(rQe(g));for(s.sort(q$e),l=0;l<s.length;l++)t=J$e(s[l],t);return t}function q$e(n,e){return n.x-e.x}function J$e(n,e){const t=eQe(n,e);if(!t)return e;const i=qie(t,n);return Jg(i,i.next),Jg(t,t.next)}function eQe(n,e){let t=e,i=-1/0,s;const l=n.x,u=n.y;do{if(u<=t.y&&u>=t.next.y&&t.next.y!==t.y){const E=t.x+(u-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(E<=l&&E>i&&(i=E,s=t.x<t.next.x?t:t.next,E===l))return s}t=t.next}while(t!==e);if(!s)return null;const d=s,p=s.x,g=s.y;let x=1/0,b;t=s;do l>=t.x&&t.x>=p&&l!==t.x&&rA(u<g?l:i,u,p,g,u<g?i:l,u,t.x,t.y)&&(b=Math.abs(u-t.y)/(l-t.x),T1(t,n)&&(b<x||b===x&&(t.x>s.x||t.x===s.x&&tQe(s,t)))&&(s=t,x=b)),t=t.next;while(t!==d);return s}function tQe(n,e){return Fr(n.prev,n,e.prev)<0&&Fr(e.next,n,n.next)<0}function nQe(n,e,t,i){let s=n;do s.z===0&&(s.z=qD(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,iQe(s)}function iQe(n){let e,t,i,s,l,u,d,p,g=1;do{for(t=n,n=null,l=null,u=0;t;){for(u++,i=t,d=0,e=0;e<g&&(d++,i=i.nextZ,!!i);e++);for(p=g;d>0||p>0&&i;)d!==0&&(p===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,d--):(s=i,i=i.nextZ,p--),l?l.nextZ=s:n=s,s.prevZ=l,l=s;t=i}l.nextZ=null,g*=2}while(u>1);return n}function qD(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function rQe(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function rA(n,e,t,i,s,l,u,d){return(s-u)*(e-d)>=(n-u)*(l-d)&&(n-u)*(i-d)>=(t-u)*(e-d)&&(t-u)*(l-d)>=(s-u)*(i-d)}function sQe(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!oQe(n,e)&&(T1(n,e)&&T1(e,n)&&aQe(n,e)&&(Fr(n.prev,n,e.prev)||Fr(n,e.prev,e))||HT(n,e)&&Fr(n.prev,n,n.next)>0&&Fr(e.prev,e,e.next)>0)}function Fr(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function HT(n,e){return n.x===e.x&&n.y===e.y}function Yie(n,e,t,i){const s=t_(Fr(n,e,t)),l=t_(Fr(n,e,i)),u=t_(Fr(t,i,n)),d=t_(Fr(t,i,e));return!!(s!==l&&u!==d||s===0&&e_(n,t,e)||l===0&&e_(n,i,e)||u===0&&e_(t,n,i)||d===0&&e_(t,e,i))}function e_(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function t_(n){return n>0?1:n<0?-1:0}function oQe(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Yie(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function T1(n,e){return Fr(n.prev,n,n.next)<0?Fr(n,e,n.next)>=0&&Fr(n,n.prev,e)>=0:Fr(n,e,n.prev)<0||Fr(n,n.next,e)<0}function aQe(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,l=(n.y+e.y)/2;do t.y>l!=t.next.y>l&&t.next.y!==t.y&&s<(t.next.x-t.x)*(l-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function qie(n,e){const t=new JD(n.i,n.x,n.y),i=new JD(e.i,e.x,e.y),s=n.next,l=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,l.next=i,i.prev=l,i}function nZ(n,e,t,i){const s=new JD(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function M1(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function JD(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lQe(n,e,t,i){let s=0;for(let l=e,u=t-i;l<t;l+=i)s+=(n[u]-n[l])*(n[l+1]+n[u+1]),u=l;return s}class gh{static area(e){const t=e.length;let i=0;for(let s=t-1,l=0;l<t;s=l++)i+=e[s].x*e[l].y-e[l].x*e[s].y;return i*.5}static isClockWise(e){return gh.area(e)<0}static triangulateShape(e,t){const i=[],s=[],l=[];iZ(e),rZ(i,e);let u=e.length;t.forEach(iZ);for(let p=0;p<t.length;p++)s.push(u),u+=t[p].length,rZ(i,t[p]);const d=$$e.triangulate(i,s);for(let p=0;p<d.length;p+=3)l.push(d.slice(p,p+3));return l}}function iZ(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function rZ(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class XT extends pi{constructor(e=new Fg([new St(.5,.5),new St(-.5,.5),new St(-.5,-.5),new St(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],l=[];for(let d=0,p=e.length;d<p;d++){const g=e[d];u(g)}this.setAttribute("position",new En(s,3)),this.setAttribute("uv",new En(l,2)),this.computeVertexNormals();function u(d){const p=[],g=t.curveSegments!==void 0?t.curveSegments:12,x=t.steps!==void 0?t.steps:1,b=t.depth!==void 0?t.depth:1;let E=t.bevelEnabled!==void 0?t.bevelEnabled:!0,S=t.bevelThickness!==void 0?t.bevelThickness:.2,M=t.bevelSize!==void 0?t.bevelSize:S-.1,R=t.bevelOffset!==void 0?t.bevelOffset:0,P=t.bevelSegments!==void 0?t.bevelSegments:3;const k=t.extrudePath,F=t.UVGenerator!==void 0?t.UVGenerator:cQe;let V,G=!1,q,ne,K,Q;k&&(V=k.getSpacedPoints(x),G=!0,E=!1,q=k.computeFrenetFrames(x,!1),ne=new Ce,K=new Ce,Q=new Ce),E||(P=0,S=0,M=0,R=0);const H=d.extractPoints(g);let j=H.shape;const ee=H.holes;if(!gh.isClockWise(j)){j=j.reverse();for(let ht=0,yt=ee.length;ht<yt;ht++){const wt=ee[ht];gh.isClockWise(wt)&&(ee[ht]=wt.reverse())}}const oe=gh.triangulateShape(j,ee),we=j;for(let ht=0,yt=ee.length;ht<yt;ht++){const wt=ee[ht];j=j.concat(wt)}function $e(ht,yt,wt){return yt||console.error("THREE.ExtrudeGeometry: vec does not exist"),ht.clone().addScaledVector(yt,wt)}const Me=j.length,Ne=oe.length;function Ae(ht,yt,wt){let Ee,Te,Gt;const Y=ht.x-yt.x,te=ht.y-yt.y,ce=wt.x-ht.x,xe=wt.y-ht.y,Re=Y*Y+te*te,We=Y*xe-te*ce;if(Math.abs(We)>Number.EPSILON){const at=Math.sqrt(Re),ln=Math.sqrt(ce*ce+xe*xe),ve=yt.x-te/at,ue=yt.y+Y/at,Oe=wt.x-xe/ln,ut=wt.y+ce/ln,vt=((Oe-ve)*xe-(ut-ue)*ce)/(Y*xe-te*ce);Ee=ve+Y*vt-ht.x,Te=ue+te*vt-ht.y;const pt=Ee*Ee+Te*Te;if(pt<=2)return new St(Ee,Te);Gt=Math.sqrt(pt/2)}else{let at=!1;Y>Number.EPSILON?ce>Number.EPSILON&&(at=!0):Y<-Number.EPSILON?ce<-Number.EPSILON&&(at=!0):Math.sign(te)===Math.sign(xe)&&(at=!0),at?(Ee=-te,Te=Y,Gt=Math.sqrt(Re)):(Ee=Y,Te=te,Gt=Math.sqrt(Re/2))}return new St(Ee/Gt,Te/Gt)}const Fe=[];for(let ht=0,yt=we.length,wt=yt-1,Ee=ht+1;ht<yt;ht++,wt++,Ee++)wt===yt&&(wt=0),Ee===yt&&(Ee=0),Fe[ht]=Ae(we[ht],we[wt],we[Ee]);const Ie=[];let qe,dt=Fe.concat();for(let ht=0,yt=ee.length;ht<yt;ht++){const wt=ee[ht];qe=[];for(let Ee=0,Te=wt.length,Gt=Te-1,Y=Ee+1;Ee<Te;Ee++,Gt++,Y++)Gt===Te&&(Gt=0),Y===Te&&(Y=0),qe[Ee]=Ae(wt[Ee],wt[Gt],wt[Y]);Ie.push(qe),dt=dt.concat(qe)}for(let ht=0;ht<P;ht++){const yt=ht/P,wt=S*Math.cos(yt*Math.PI/2),Ee=M*Math.sin(yt*Math.PI/2)+R;for(let Te=0,Gt=we.length;Te<Gt;Te++){const Y=$e(we[Te],Fe[Te],Ee);Et(Y.x,Y.y,-wt)}for(let Te=0,Gt=ee.length;Te<Gt;Te++){const Y=ee[Te];qe=Ie[Te];for(let te=0,ce=Y.length;te<ce;te++){const xe=$e(Y[te],qe[te],Ee);Et(xe.x,xe.y,-wt)}}}const Wt=M+R;for(let ht=0;ht<Me;ht++){const yt=E?$e(j[ht],dt[ht],Wt):j[ht];G?(K.copy(q.normals[0]).multiplyScalar(yt.x),ne.copy(q.binormals[0]).multiplyScalar(yt.y),Q.copy(V[0]).add(K).add(ne),Et(Q.x,Q.y,Q.z)):Et(yt.x,yt.y,0)}for(let ht=1;ht<=x;ht++)for(let yt=0;yt<Me;yt++){const wt=E?$e(j[yt],dt[yt],Wt):j[yt];G?(K.copy(q.normals[ht]).multiplyScalar(wt.x),ne.copy(q.binormals[ht]).multiplyScalar(wt.y),Q.copy(V[ht]).add(K).add(ne),Et(Q.x,Q.y,Q.z)):Et(wt.x,wt.y,b/x*ht)}for(let ht=P-1;ht>=0;ht--){const yt=ht/P,wt=S*Math.cos(yt*Math.PI/2),Ee=M*Math.sin(yt*Math.PI/2)+R;for(let Te=0,Gt=we.length;Te<Gt;Te++){const Y=$e(we[Te],Fe[Te],Ee);Et(Y.x,Y.y,b+wt)}for(let Te=0,Gt=ee.length;Te<Gt;Te++){const Y=ee[Te];qe=Ie[Te];for(let te=0,ce=Y.length;te<ce;te++){const xe=$e(Y[te],qe[te],Ee);G?Et(xe.x,xe.y+V[x-1].y,V[x-1].x+wt):Et(xe.x,xe.y,b+wt)}}}xt(),At();function xt(){const ht=s.length/3;if(E){let yt=0,wt=Me*yt;for(let Ee=0;Ee<Ne;Ee++){const Te=oe[Ee];Ze(Te[2]+wt,Te[1]+wt,Te[0]+wt)}yt=x+P*2,wt=Me*yt;for(let Ee=0;Ee<Ne;Ee++){const Te=oe[Ee];Ze(Te[0]+wt,Te[1]+wt,Te[2]+wt)}}else{for(let yt=0;yt<Ne;yt++){const wt=oe[yt];Ze(wt[2],wt[1],wt[0])}for(let yt=0;yt<Ne;yt++){const wt=oe[yt];Ze(wt[0]+Me*x,wt[1]+Me*x,wt[2]+Me*x)}}i.addGroup(ht,s.length/3-ht,0)}function At(){const ht=s.length/3;let yt=0;Rt(we,yt),yt+=we.length;for(let wt=0,Ee=ee.length;wt<Ee;wt++){const Te=ee[wt];Rt(Te,yt),yt+=Te.length}i.addGroup(ht,s.length/3-ht,1)}function Rt(ht,yt){let wt=ht.length;for(;--wt>=0;){const Ee=wt;let Te=wt-1;Te<0&&(Te=ht.length-1);for(let Gt=0,Y=x+P*2;Gt<Y;Gt++){const te=Me*Gt,ce=Me*(Gt+1),xe=yt+Ee+te,Re=yt+Te+te,We=yt+Te+ce,at=yt+Ee+ce;It(xe,Re,We,at)}}}function Et(ht,yt,wt){p.push(ht),p.push(yt),p.push(wt)}function Ze(ht,yt,wt){Lt(ht),Lt(yt),Lt(wt);const Ee=s.length/3,Te=F.generateTopUV(i,s,Ee-3,Ee-2,Ee-1);Yt(Te[0]),Yt(Te[1]),Yt(Te[2])}function It(ht,yt,wt,Ee){Lt(ht),Lt(yt),Lt(Ee),Lt(yt),Lt(wt),Lt(Ee);const Te=s.length/3,Gt=F.generateSideWallUV(i,s,Te-6,Te-3,Te-2,Te-1);Yt(Gt[0]),Yt(Gt[1]),Yt(Gt[3]),Yt(Gt[1]),Yt(Gt[2]),Yt(Gt[3])}function Lt(ht){s.push(p[ht*3+0]),s.push(p[ht*3+1]),s.push(p[ht*3+2])}function Yt(ht){l.push(ht.x),l.push(ht.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return uQe(t,i,e)}static fromJSON(e,t){const i=[];for(let l=0,u=e.shapes.length;l<u;l++){const d=t[e.shapes[l]];i.push(d)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new sS[s.type]().fromJSON(s)),new XT(i,e.options)}}const cQe={generateTopUV:function(n,e,t,i,s){const l=e[t*3],u=e[t*3+1],d=e[i*3],p=e[i*3+1],g=e[s*3],x=e[s*3+1];return[new St(l,u),new St(d,p),new St(g,x)]},generateSideWallUV:function(n,e,t,i,s,l){const u=e[t*3],d=e[t*3+1],p=e[t*3+2],g=e[i*3],x=e[i*3+1],b=e[i*3+2],E=e[s*3],S=e[s*3+1],M=e[s*3+2],R=e[l*3],P=e[l*3+1],k=e[l*3+2];return Math.abs(d-x)<Math.abs(u-g)?[new St(u,1-p),new St(g,1-b),new St(E,1-M),new St(R,1-k)]:[new St(d,1-p),new St(x,1-b),new St(S,1-M),new St(P,1-k)]}};function uQe(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const l=n[i];t.shapes.push(l.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class $T extends em{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],l=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,l,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $T(e.radius,e.detail)}}class hw extends em{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hw(e.radius,e.detail)}}class iv extends pi{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const l=e/2,u=t/2,d=Math.floor(i),p=Math.floor(s),g=d+1,x=p+1,b=e/d,E=t/p,S=[],M=[],R=[],P=[];for(let k=0;k<x;k++){const F=k*E-u;for(let V=0;V<g;V++){const G=V*b-l;M.push(G,-F,0),R.push(0,0,1),P.push(V/d),P.push(1-k/p)}}for(let k=0;k<p;k++)for(let F=0;F<d;F++){const V=F+g*k,G=F+g*(k+1),q=F+1+g*(k+1),ne=F+1+g*k;S.push(V,G,ne),S.push(G,q,ne)}this.setIndex(S),this.setAttribute("position",new En(M,3)),this.setAttribute("normal",new En(R,3)),this.setAttribute("uv",new En(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iv(e.width,e.height,e.widthSegments,e.heightSegments)}}class QT extends pi{constructor(e=.5,t=1,i=32,s=1,l=0,u=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:s,thetaStart:l,thetaLength:u},i=Math.max(3,i),s=Math.max(1,s);const d=[],p=[],g=[],x=[];let b=e;const E=(t-e)/s,S=new Ce,M=new St;for(let R=0;R<=s;R++){for(let P=0;P<=i;P++){const k=l+P/i*u;S.x=b*Math.cos(k),S.y=b*Math.sin(k),p.push(S.x,S.y,S.z),g.push(0,0,1),M.x=(S.x/t+1)/2,M.y=(S.y/t+1)/2,x.push(M.x,M.y)}b+=E}for(let R=0;R<s;R++){const P=R*(i+1);for(let k=0;k<i;k++){const F=k+P,V=F,G=F+i+1,q=F+i+2,ne=F+1;d.push(V,G,ne),d.push(G,q,ne)}}this.setIndex(d),this.setAttribute("position",new En(p,3)),this.setAttribute("normal",new En(g,3)),this.setAttribute("uv",new En(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new QT(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class KT extends pi{constructor(e=new Fg([new St(0,.5),new St(-.5,-.5),new St(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],l=[],u=[];let d=0,p=0;if(Array.isArray(e)===!1)g(e);else for(let x=0;x<e.length;x++)g(e[x]),this.addGroup(d,p,x),d+=p,p=0;this.setIndex(i),this.setAttribute("position",new En(s,3)),this.setAttribute("normal",new En(l,3)),this.setAttribute("uv",new En(u,2));function g(x){const b=s.length/3,E=x.extractPoints(t);let S=E.shape;const M=E.holes;gh.isClockWise(S)===!1&&(S=S.reverse());for(let P=0,k=M.length;P<k;P++){const F=M[P];gh.isClockWise(F)===!0&&(M[P]=F.reverse())}const R=gh.triangulateShape(S,M);for(let P=0,k=M.length;P<k;P++){const F=M[P];S=S.concat(F)}for(let P=0,k=S.length;P<k;P++){const F=S[P];s.push(F.x,F.y,0),l.push(0,0,1),u.push(F.x,F.y)}for(let P=0,k=R.length;P<k;P++){const F=R[P],V=F[0]+b,G=F[1]+b,q=F[2]+b;i.push(V,G,q),p+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return hQe(t,e)}static fromJSON(e,t){const i=[];for(let s=0,l=e.shapes.length;s<l;s++){const u=t[e.shapes[s]];i.push(u)}return new KT(i,e.curveSegments)}}function hQe(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class dw extends pi{constructor(e=1,t=32,i=16,s=0,l=Math.PI*2,u=0,d=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:l,thetaStart:u,thetaLength:d},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const p=Math.min(u+d,Math.PI);let g=0;const x=[],b=new Ce,E=new Ce,S=[],M=[],R=[],P=[];for(let k=0;k<=i;k++){const F=[],V=k/i;let G=0;k===0&&u===0?G=.5/t:k===i&&p===Math.PI&&(G=-.5/t);for(let q=0;q<=t;q++){const ne=q/t;b.x=-e*Math.cos(s+ne*l)*Math.sin(u+V*d),b.y=e*Math.cos(u+V*d),b.z=e*Math.sin(s+ne*l)*Math.sin(u+V*d),M.push(b.x,b.y,b.z),E.copy(b).normalize(),R.push(E.x,E.y,E.z),P.push(ne+G,1-V),F.push(g++)}x.push(F)}for(let k=0;k<i;k++)for(let F=0;F<t;F++){const V=x[k][F+1],G=x[k][F],q=x[k+1][F],ne=x[k+1][F+1];(k!==0||u>0)&&S.push(V,G,ne),(k!==i-1||p<Math.PI)&&S.push(G,q,ne)}this.setIndex(S),this.setAttribute("position",new En(M,3)),this.setAttribute("normal",new En(R,3)),this.setAttribute("uv",new En(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dw(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class ZT extends em{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ZT(e.radius,e.detail)}}class jT extends pi{constructor(e=1,t=.4,i=12,s=48,l=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:l},i=Math.floor(i),s=Math.floor(s);const u=[],d=[],p=[],g=[],x=new Ce,b=new Ce,E=new Ce;for(let S=0;S<=i;S++)for(let M=0;M<=s;M++){const R=M/s*l,P=S/i*Math.PI*2;b.x=(e+t*Math.cos(P))*Math.cos(R),b.y=(e+t*Math.cos(P))*Math.sin(R),b.z=t*Math.sin(P),d.push(b.x,b.y,b.z),x.x=e*Math.cos(R),x.y=e*Math.sin(R),E.subVectors(b,x).normalize(),p.push(E.x,E.y,E.z),g.push(M/s),g.push(S/i)}for(let S=1;S<=i;S++)for(let M=1;M<=s;M++){const R=(s+1)*S+M-1,P=(s+1)*(S-1)+M-1,k=(s+1)*(S-1)+M,F=(s+1)*S+M;u.push(R,P,F),u.push(P,k,F)}this.setIndex(u),this.setAttribute("position",new En(d,3)),this.setAttribute("normal",new En(p,3)),this.setAttribute("uv",new En(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new jT(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class YT extends pi{constructor(e=1,t=.4,i=64,s=8,l=2,u=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:s,p:l,q:u},i=Math.floor(i),s=Math.floor(s);const d=[],p=[],g=[],x=[],b=new Ce,E=new Ce,S=new Ce,M=new Ce,R=new Ce,P=new Ce,k=new Ce;for(let V=0;V<=i;++V){const G=V/i*l*Math.PI*2;F(G,l,u,e,S),F(G+.01,l,u,e,M),P.subVectors(M,S),k.addVectors(M,S),R.crossVectors(P,k),k.crossVectors(R,P),R.normalize(),k.normalize();for(let q=0;q<=s;++q){const ne=q/s*Math.PI*2,K=-t*Math.cos(ne),Q=t*Math.sin(ne);b.x=S.x+(K*k.x+Q*R.x),b.y=S.y+(K*k.y+Q*R.y),b.z=S.z+(K*k.z+Q*R.z),p.push(b.x,b.y,b.z),E.subVectors(b,S).normalize(),g.push(E.x,E.y,E.z),x.push(V/i),x.push(q/s)}}for(let V=1;V<=i;V++)for(let G=1;G<=s;G++){const q=(s+1)*(V-1)+(G-1),ne=(s+1)*V+(G-1),K=(s+1)*V+G,Q=(s+1)*(V-1)+G;d.push(q,ne,Q),d.push(ne,K,Q)}this.setIndex(d),this.setAttribute("position",new En(p,3)),this.setAttribute("normal",new En(g,3)),this.setAttribute("uv",new En(x,2));function F(V,G,q,ne,K){const Q=Math.cos(V),H=Math.sin(V),j=q/G*V,ee=Math.cos(j);K.x=ne*(2+ee)*.5*Q,K.y=ne*(2+ee)*H*.5,K.z=ne*Math.sin(j)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new YT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class qT extends pi{constructor(e=new wV(new Ce(-1,-1,0),new Ce(-1,1,0),new Ce(1,1,0)),t=64,i=1,s=8,l=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:s,closed:l};const u=e.computeFrenetFrames(t,l);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;const d=new Ce,p=new Ce,g=new St;let x=new Ce;const b=[],E=[],S=[],M=[];R(),this.setIndex(M),this.setAttribute("position",new En(b,3)),this.setAttribute("normal",new En(E,3)),this.setAttribute("uv",new En(S,2));function R(){for(let V=0;V<t;V++)P(V);P(l===!1?t:0),F(),k()}function P(V){x=e.getPointAt(V/t,x);const G=u.normals[V],q=u.binormals[V];for(let ne=0;ne<=s;ne++){const K=ne/s*Math.PI*2,Q=Math.sin(K),H=-Math.cos(K);p.x=H*G.x+Q*q.x,p.y=H*G.y+Q*q.y,p.z=H*G.z+Q*q.z,p.normalize(),E.push(p.x,p.y,p.z),d.x=x.x+i*p.x,d.y=x.y+i*p.y,d.z=x.z+i*p.z,b.push(d.x,d.y,d.z)}}function k(){for(let V=1;V<=t;V++)for(let G=1;G<=s;G++){const q=(s+1)*(V-1)+(G-1),ne=(s+1)*V+(G-1),K=(s+1)*V+G,Q=(s+1)*(V-1)+G;M.push(q,ne,Q),M.push(ne,K,Q)}}function F(){for(let V=0;V<=t;V++)for(let G=0;G<=s;G++)g.x=V/t,g.y=G/s,S.push(g.x,g.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new qT(new sS[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Jie extends pi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,s=new Ce,l=new Ce;if(e.index!==null){const u=e.attributes.position,d=e.index;let p=e.groups;p.length===0&&(p=[{start:0,count:d.count,materialIndex:0}]);for(let g=0,x=p.length;g<x;++g){const b=p[g],E=b.start,S=b.count;for(let M=E,R=E+S;M<R;M+=3)for(let P=0;P<3;P++){const k=d.getX(M+P),F=d.getX(M+(P+1)%3);s.fromBufferAttribute(u,k),l.fromBufferAttribute(u,F),sZ(s,l,i)===!0&&(t.push(s.x,s.y,s.z),t.push(l.x,l.y,l.z))}}}else{const u=e.attributes.position;for(let d=0,p=u.count/3;d<p;d++)for(let g=0;g<3;g++){const x=3*d+g,b=3*d+(g+1)%3;s.fromBufferAttribute(u,x),l.fromBufferAttribute(u,b),sZ(s,l,i)===!0&&(t.push(s.x,s.y,s.z),t.push(l.x,l.y,l.z))}}this.setAttribute("position",new En(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function sZ(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(s)===!0?!1:(t.add(i),t.add(s),!0)}var oZ=Object.freeze({__proto__:null,BoxGeometry:d0,CapsuleGeometry:UT,CircleGeometry:zT,ConeGeometry:GT,CylinderGeometry:nv,DodecahedronGeometry:WT,EdgesGeometry:Zie,ExtrudeGeometry:XT,IcosahedronGeometry:$T,LatheGeometry:uw,OctahedronGeometry:hw,PlaneGeometry:iv,PolyhedronGeometry:em,RingGeometry:QT,ShapeGeometry:KT,SphereGeometry:dw,TetrahedronGeometry:ZT,TorusGeometry:jT,TorusKnotGeometry:YT,TubeGeometry:qT,WireframeGeometry:Jie});class ere extends ea{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new An(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class tre extends au{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class EV extends ea{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new An(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new An(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ll,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nre extends EV{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new St(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ai(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new An(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new An(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new An(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ire extends ea{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new An(16777215),this.specular=new An(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new An(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ll,this.combine=sw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rre extends ea{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new An(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new An(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class sre extends ea{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class ore extends ea{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new An(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new An(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ll,this.combine=sw,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class _V extends ea{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=gie,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class IV extends ea{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class are extends ea{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new An(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=qp,this.normalScale=new St(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class lre extends La{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function kg(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function cre(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function ure(n){function e(s,l){return n[s]-n[l]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function e3(n,e,t){const i=n.length,s=new n.constructor(i);for(let l=0,u=0;u!==i;++l){const d=t[l]*e;for(let p=0;p!==e;++p)s[u++]=n[d+p]}return s}function SV(n,e,t,i){let s=1,l=n[0];for(;l!==void 0&&l[i]===void 0;)l=n[s++];if(l===void 0)return;let u=l[i];if(u!==void 0)if(Array.isArray(u))do u=l[i],u!==void 0&&(e.push(l.time),t.push.apply(t,u)),l=n[s++];while(l!==void 0);else if(u.toArray!==void 0)do u=l[i],u!==void 0&&(e.push(l.time),u.toArray(t,t.length)),l=n[s++];while(l!==void 0);else do u=l[i],u!==void 0&&(e.push(l.time),t.push(u)),l=n[s++];while(l!==void 0)}function dQe(n,e,t,i,s=30){const l=n.clone();l.name=e;const u=[];for(let p=0;p<l.tracks.length;++p){const g=l.tracks[p],x=g.getValueSize(),b=[],E=[];for(let S=0;S<g.times.length;++S){const M=g.times[S]*s;if(!(M<t||M>=i)){b.push(g.times[S]);for(let R=0;R<x;++R)E.push(g.values[S*x+R])}}b.length!==0&&(g.times=kg(b,g.times.constructor),g.values=kg(E,g.values.constructor),u.push(g))}l.tracks=u;let d=1/0;for(let p=0;p<l.tracks.length;++p)d>l.tracks[p].times[0]&&(d=l.tracks[p].times[0]);for(let p=0;p<l.tracks.length;++p)l.tracks[p].shift(-1*d);return l.resetDuration(),l}function fQe(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,l=e/i;for(let u=0;u<s;++u){const d=t.tracks[u],p=d.ValueTypeName;if(p==="bool"||p==="string")continue;const g=n.tracks.find(function(k){return k.name===d.name&&k.ValueTypeName===p});if(g===void 0)continue;let x=0;const b=d.getValueSize();d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(x=b/3);let E=0;const S=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(E=S/3);const M=d.times.length-1;let R;if(l<=d.times[0]){const k=x,F=b-x;R=d.values.slice(k,F)}else if(l>=d.times[M]){const k=M*b+x,F=k+b-x;R=d.values.slice(k,F)}else{const k=d.createInterpolant(),F=x,V=b-x;k.evaluate(l),R=k.resultBuffer.slice(F,V)}p==="quaternion"&&new il().fromArray(R).normalize().conjugate().toArray(R);const P=g.times.length;for(let k=0;k<P;++k){const F=k*S+E;if(p==="quaternion")il.multiplyQuaternionsFlat(g.values,F,R,0,g.values,F);else{const V=S-E*2;for(let G=0;G<V;++G)g.values[F+G]-=R[G]}}}return n.blendMode=cV,n}const pQe={convertArray:kg,isTypedArray:cre,getKeyframeOrder:ure,sortedArray:e3,flattenJSON:SV,subclip:dQe,makeClipAdditive:fQe};class fw{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],l=t[i-1];e:{t:{let u;n:{i:if(!(e<s)){for(let d=i+2;;){if(s===void 0){if(e<l)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===d)break;if(l=s,s=t[++i],e<s)break t}u=t.length;break n}if(!(e>=l)){const d=t[1];e<d&&(i=2,l=d);for(let p=i-2;;){if(l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===p)break;if(s=l,l=t[--i-1],e>=l)break t}u=i,i=0;break n}break e}for(;i<u;){const d=i+u>>>1;e<t[d]?u=d:i=d+1}if(s=t[i],l=t[i-1],l===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,l,s)}return this.interpolate_(i,l,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,l=e*s;for(let u=0;u!==s;++u)t[u]=i[l+u];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class hre extends fw{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Sg,endingEnd:Sg}}intervalChanged_(e,t,i){const s=this.parameterPositions;let l=e-2,u=e+1,d=s[l],p=s[u];if(d===void 0)switch(this.getSettings_().endingStart){case Tg:l=e,d=2*t-i;break;case x1:l=s.length-2,d=t+s[l]-s[l+1];break;default:l=e,d=i}if(p===void 0)switch(this.getSettings_().endingEnd){case Tg:u=e,p=2*i-t;break;case x1:u=1,p=i+s[1]-s[0];break;default:u=e-1,p=t}const g=(i-t)*.5,x=this.valueSize;this._weightPrev=g/(t-d),this._weightNext=g/(p-i),this._offsetPrev=l*x,this._offsetNext=u*x}interpolate_(e,t,i,s){const l=this.resultBuffer,u=this.sampleValues,d=this.valueSize,p=e*d,g=p-d,x=this._offsetPrev,b=this._offsetNext,E=this._weightPrev,S=this._weightNext,M=(i-t)/(s-t),R=M*M,P=R*M,k=-E*P+2*E*R-E*M,F=(1+E)*P+(-1.5-2*E)*R+(-.5+E)*M+1,V=(-1-S)*P+(1.5+S)*R+.5*M,G=S*P-S*R;for(let q=0;q!==d;++q)l[q]=k*u[x+q]+F*u[g+q]+V*u[p+q]+G*u[b+q];return l}}class TV extends fw{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const l=this.resultBuffer,u=this.sampleValues,d=this.valueSize,p=e*d,g=p-d,x=(i-t)/(s-t),b=1-x;for(let E=0;E!==d;++E)l[E]=u[g+E]*b+u[p+E]*x;return l}}class dre extends fw{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class cu{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=kg(t,this.TimeBufferType),this.values=kg(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:kg(e.times,Array),values:kg(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new dre(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new TV(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new hre(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case b1:t=this.InterpolantFactoryMethodDiscrete;break;case nS:t=this.InterpolantFactoryMethodLinear;break;case uI:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return b1;case this.InterpolantFactoryMethodLinear:return nS;case this.InterpolantFactoryMethodSmooth:return uI}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let l=0,u=s-1;for(;l!==s&&i[l]<e;)++l;for(;u!==-1&&i[u]>t;)--u;if(++u,l!==0||u!==s){l>=u&&(u=Math.max(u,1),l=u-1);const d=this.getValueSize();this.times=i.slice(l,u),this.values=this.values.slice(l*d,u*d)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,l=i.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let u=null;for(let d=0;d!==l;d++){const p=i[d];if(typeof p=="number"&&isNaN(p)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,d,p),e=!1;break}if(u!==null&&u>p){console.error("THREE.KeyframeTrack: Out of order keys.",this,d,p,u),e=!1;break}u=p}if(s!==void 0&&cre(s))for(let d=0,p=s.length;d!==p;++d){const g=s[d];if(isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,g),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===uI,l=e.length-1;let u=1;for(let d=1;d<l;++d){let p=!1;const g=e[d],x=e[d+1];if(g!==x&&(d!==1||g!==e[0]))if(s)p=!0;else{const b=d*i,E=b-i,S=b+i;for(let M=0;M!==i;++M){const R=t[b+M];if(R!==t[E+M]||R!==t[S+M]){p=!0;break}}}if(p){if(d!==u){e[u]=e[d];const b=d*i,E=u*i;for(let S=0;S!==i;++S)t[E+S]=t[b+S]}++u}}if(l>0){e[u]=e[l];for(let d=l*i,p=u*i,g=0;g!==i;++g)t[p+g]=t[d+g];++u}return u!==e.length?(this.times=e.slice(0,u),this.values=t.slice(0,u*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}cu.prototype.TimeBufferType=Float32Array;cu.prototype.ValueBufferType=Float32Array;cu.prototype.DefaultInterpolation=nS;class f0 extends cu{constructor(e,t,i){super(e,t,i)}}f0.prototype.ValueTypeName="bool";f0.prototype.ValueBufferType=Array;f0.prototype.DefaultInterpolation=b1;f0.prototype.InterpolantFactoryMethodLinear=void 0;f0.prototype.InterpolantFactoryMethodSmooth=void 0;class MV extends cu{}MV.prototype.ValueTypeName="color";class k1 extends cu{}k1.prototype.ValueTypeName="number";class fre extends fw{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const l=this.resultBuffer,u=this.sampleValues,d=this.valueSize,p=(i-t)/(s-t);let g=e*d;for(let x=g+d;g!==x;g+=4)il.slerpFlat(l,0,u,g-d,u,g,p);return l}}class pw extends cu{InterpolantFactoryMethodLinear(e){return new fre(this.times,this.values,this.getValueSize(),e)}}pw.prototype.ValueTypeName="quaternion";pw.prototype.InterpolantFactoryMethodSmooth=void 0;class p0 extends cu{constructor(e,t,i){super(e,t,i)}}p0.prototype.ValueTypeName="string";p0.prototype.ValueBufferType=Array;p0.prototype.DefaultInterpolation=b1;p0.prototype.InterpolantFactoryMethodLinear=void 0;p0.prototype.InterpolantFactoryMethodSmooth=void 0;class R1 extends cu{}R1.prototype.ValueTypeName="vector";class L1{constructor(e="",t=-1,i=[],s=MT){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Ml(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let u=0,d=i.length;u!==d;++u)t.push(gQe(i[u]).scale(s));const l=new this(e.name,e.duration,t,e.blendMode);return l.uuid=e.uuid,l}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let l=0,u=i.length;l!==u;++l)t.push(cu.toJSON(i[l]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const l=t.length,u=[];for(let d=0;d<l;d++){let p=[],g=[];p.push((d+l-1)%l,d,(d+1)%l),g.push(0,1,0);const x=ure(p);p=e3(p,1,x),g=e3(g,1,x),!s&&p[0]===0&&(p.push(l),g.push(g[0])),u.push(new k1(".morphTargetInfluences["+t[d].name+"]",p,g).scale(1/i))}return new this(e,-1,u)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},l=/^([\w-]*?)([\d]+)$/;for(let d=0,p=e.length;d<p;d++){const g=e[d],x=g.name.match(l);if(x&&x.length>1){const b=x[1];let E=s[b];E||(s[b]=E=[]),E.push(g)}}const u=[];for(const d in s)u.push(this.CreateFromMorphTargetSequence(d,s[d],t,i));return u}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(b,E,S,M,R){if(S.length!==0){const P=[],k=[];SV(S,P,k,M),P.length!==0&&R.push(new b(E,P,k))}},s=[],l=e.name||"default",u=e.fps||30,d=e.blendMode;let p=e.length||-1;const g=e.hierarchy||[];for(let b=0;b<g.length;b++){const E=g[b].keys;if(!(!E||E.length===0))if(E[0].morphTargets){const S={};let M;for(M=0;M<E.length;M++)if(E[M].morphTargets)for(let R=0;R<E[M].morphTargets.length;R++)S[E[M].morphTargets[R]]=-1;for(const R in S){const P=[],k=[];for(let F=0;F!==E[M].morphTargets.length;++F){const V=E[M];P.push(V.time),k.push(V.morphTarget===R?1:0)}s.push(new k1(".morphTargetInfluence["+R+"]",P,k))}p=S.length*u}else{const S=".bones["+t[b].name+"]";i(R1,S+".position",E,"pos",s),i(pw,S+".quaternion",E,"rot",s),i(R1,S+".scale",E,"scl",s)}}return s.length===0?null:new this(l,p,s,d)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const l=this.tracks[i];t=Math.max(t,l.times[l.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mQe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return k1;case"vector":case"vector2":case"vector3":case"vector4":return R1;case"color":return MV;case"quaternion":return pw;case"bool":case"boolean":return f0;case"string":return p0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function gQe(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=mQe(n.type);if(n.times===void 0){const t=[],i=[];SV(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const vd={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class kV{constructor(e,t,i){const s=this;let l=!1,u=0,d=0,p;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(x){d++,l===!1&&s.onStart!==void 0&&s.onStart(x,u,d),l=!0},this.itemEnd=function(x){u++,s.onProgress!==void 0&&s.onProgress(x,u,d),u===d&&(l=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(x){s.onError!==void 0&&s.onError(x)},this.resolveURL=function(x){return p?p(x):x},this.setURLModifier=function(x){return p=x,this},this.addHandler=function(x,b){return g.push(x,b),this},this.removeHandler=function(x){const b=g.indexOf(x);return b!==-1&&g.splice(b,2),this},this.getHandler=function(x){for(let b=0,E=g.length;b<E;b+=2){const S=g[b],M=g[b+1];if(S.global&&(S.lastIndex=0),S.test(x))return M}return null}}}const pre=new kV;class ol{constructor(e){this.manager=e!==void 0?e:pre,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,l){i.load(e,s,t,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ol.DEFAULT_MATERIAL_NAME="__DEFAULT";const sd={};class yQe extends Error{constructor(e,t){super(e),this.response=t}}class Xd extends ol{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=vd.get(e);if(l!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(l),this.manager.itemEnd(e)},0),l;if(sd[e]!==void 0){sd[e].push({onLoad:t,onProgress:i,onError:s});return}sd[e]=[],sd[e].push({onLoad:t,onProgress:i,onError:s});const u=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),d=this.mimeType,p=this.responseType;fetch(u).then(g=>{if(g.status===200||g.status===0){if(g.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||g.body===void 0||g.body.getReader===void 0)return g;const x=sd[e],b=g.body.getReader(),E=g.headers.get("X-File-Size")||g.headers.get("Content-Length"),S=E?parseInt(E):0,M=S!==0;let R=0;const P=new ReadableStream({start(k){F();function F(){b.read().then(({done:V,value:G})=>{if(V)k.close();else{R+=G.byteLength;const q=new ProgressEvent("progress",{lengthComputable:M,loaded:R,total:S});for(let ne=0,K=x.length;ne<K;ne++){const Q=x[ne];Q.onProgress&&Q.onProgress(q)}k.enqueue(G),F()}},V=>{k.error(V)})}}});return new Response(P)}else throw new yQe(`fetch for "${g.url}" responded with ${g.status}: ${g.statusText}`,g)}).then(g=>{switch(p){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"document":return g.text().then(x=>new DOMParser().parseFromString(x,d));case"json":return g.json();default:if(d===void 0)return g.text();{const b=/charset="?([^;"\s]*)"?/i.exec(d),E=b&&b[1]?b[1].toLowerCase():void 0,S=new TextDecoder(E);return g.arrayBuffer().then(M=>S.decode(M))}}}).then(g=>{vd.add(e,g);const x=sd[e];delete sd[e];for(let b=0,E=x.length;b<E;b++){const S=x[b];S.onLoad&&S.onLoad(g)}}).catch(g=>{const x=sd[e];if(x===void 0)throw this.manager.itemError(e),g;delete sd[e];for(let b=0,E=x.length;b<E;b++){const S=x[b];S.onError&&S.onError(g)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=new Xd(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{t(l.parse(JSON.parse(d)))}catch(p){s?s(p):console.error(p),l.manager.itemError(e)}},i,s)}parse(e){const t=[];for(let i=0;i<e.length;i++){const s=L1.parse(e[i]);t.push(s)}return t}}class vQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=[],d=new OT,p=new Xd(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(l.withCredentials);let g=0;function x(b){p.load(e[b],function(E){const S=l.parse(E,!0);u[b]={width:S.width,height:S.height,format:S.format,mipmaps:S.mipmaps},g+=1,g===6&&(S.mipmapCount===1&&(d.minFilter=Ws),d.image=u,d.format=S.format,d.needsUpdate=!0,t&&t(d))},i,s)}if(Array.isArray(e))for(let b=0,E=e.length;b<E;++b)x(b);else p.load(e,function(b){const E=l.parse(b,!0);if(E.isCubemap){const S=E.mipmaps.length/E.mipmapCount;for(let M=0;M<S;M++){u[M]={mipmaps:[]};for(let R=0;R<E.mipmapCount;R++)u[M].mipmaps.push(E.mipmaps[M*E.mipmapCount+R]),u[M].format=E.format,u[M].width=E.width,u[M].height=E.height}d.image=u}else d.image.width=E.width,d.image.height=E.height,d.mipmaps=E.mipmaps;E.mipmapCount===1&&(d.minFilter=Ws),d.format=E.format,d.needsUpdate=!0,t&&t(d)},i,s);return d}}class B1 extends ol{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,u=vd.get(e);if(u!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(u),l.manager.itemEnd(e)},0),u;const d=_1("img");function p(){x(),vd.add(e,this),t&&t(this),l.manager.itemEnd(e)}function g(b){x(),s&&s(b),l.manager.itemError(e),l.manager.itemEnd(e)}function x(){d.removeEventListener("load",p,!1),d.removeEventListener("error",g,!1)}return d.addEventListener("load",p,!1),d.addEventListener("error",g,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(d.crossOrigin=this.crossOrigin),l.manager.itemStart(e),d.src=e,d}}class bQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=new lw;l.colorSpace=Za;const u=new B1(this.manager);u.setCrossOrigin(this.crossOrigin),u.setPath(this.path);let d=0;function p(g){u.load(e[g],function(x){l.images[g]=x,d++,d===6&&(l.needsUpdate=!0,t&&t(l))},void 0,s)}for(let g=0;g<e.length;++g)p(g);return l}}class xQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=new mh,d=new Xd(this.manager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(l.withCredentials),d.load(e,function(p){let g;try{g=l.parse(p)}catch(x){if(s!==void 0)s(x);else{console.error(x);return}}g.image!==void 0?u.image=g.image:g.data!==void 0&&(u.image.width=g.width,u.image.height=g.height,u.image.data=g.data),u.wrapS=g.wrapS!==void 0?g.wrapS:hc,u.wrapT=g.wrapT!==void 0?g.wrapT:hc,u.magFilter=g.magFilter!==void 0?g.magFilter:Ws,u.minFilter=g.minFilter!==void 0?g.minFilter:Ws,u.anisotropy=g.anisotropy!==void 0?g.anisotropy:1,g.colorSpace!==void 0&&(u.colorSpace=g.colorSpace),g.flipY!==void 0&&(u.flipY=g.flipY),g.format!==void 0&&(u.format=g.format),g.type!==void 0&&(u.type=g.type),g.mipmaps!==void 0&&(u.mipmaps=g.mipmaps,u.minFilter=ih),g.mipmapCount===1&&(u.minFilter=Ws),g.generateMipmaps!==void 0&&(u.generateMipmaps=g.generateMipmaps),u.needsUpdate=!0,t&&t(u,g)},i,s),u}}class wQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=new Yr,u=new B1(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(e,function(d){l.image=d,l.needsUpdate=!0,t!==void 0&&t(l)},i,s),l}}class tm extends Xi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new An(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class mre extends tm{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Xi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new An(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const jB=new Zn,aZ=new Ce,lZ=new Ce;class RV{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new St(512,512),this.map=null,this.mapPass=null,this.matrix=new Zn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new cw,this._frameExtents=new St(1,1),this._viewportCount=1,this._viewports=[new Wi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;aZ.setFromMatrixPosition(e.matrixWorld),t.position.copy(aZ),lZ.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(lZ),t.updateMatrixWorld(),jB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jB),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(jB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class CQe extends RV{constructor(){super(new Ao(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=VA*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,l=e.distance||t.far;(i!==t.fov||s!==t.aspect||l!==t.far)&&(t.fov=i,t.aspect=s,t.far=l,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class gre extends tm{constructor(e,t,i=0,s=Math.PI/3,l=0,u=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Xi.DEFAULT_UP),this.updateMatrix(),this.target=new Xi,this.distance=i,this.angle=s,this.penumbra=l,this.decay=u,this.map=null,this.shadow=new CQe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const cZ=new Zn,Nb=new Ce,YB=new Ce;class EQe extends RV{constructor(){super(new Ao(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new St(4,2),this._viewportCount=6,this._viewports=[new Wi(2,1,1,1),new Wi(0,1,1,1),new Wi(3,1,1,1),new Wi(1,1,1,1),new Wi(3,0,1,1),new Wi(1,0,1,1)],this._cubeDirections=[new Ce(1,0,0),new Ce(-1,0,0),new Ce(0,0,1),new Ce(0,0,-1),new Ce(0,1,0),new Ce(0,-1,0)],this._cubeUps=[new Ce(0,1,0),new Ce(0,1,0),new Ce(0,1,0),new Ce(0,1,0),new Ce(0,0,1),new Ce(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,l=e.distance||i.far;l!==i.far&&(i.far=l,i.updateProjectionMatrix()),Nb.setFromMatrixPosition(e.matrixWorld),i.position.copy(Nb),YB.copy(i.position),YB.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(YB),i.updateMatrixWorld(),s.makeTranslation(-Nb.x,-Nb.y,-Nb.z),cZ.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cZ)}}class yre extends tm{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new EQe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class JT extends BT{constructor(e=-1,t=1,i=1,s=-1,l=.1,u=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=l,this.far=u,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,l,u){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=l,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let l=i-e,u=i+e,d=s+t,p=s-t;if(this.view!==null&&this.view.enabled){const g=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=g*this.view.offsetX,u=l+g*this.view.width,d-=x*this.view.offsetY,p=d-x*this.view.height}this.projectionMatrix.makeOrthographic(l,u,d,p,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class _Qe extends RV{constructor(){super(new JT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Are extends tm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xi.DEFAULT_UP),this.updateMatrix(),this.target=new Xi,this.shadow=new _Qe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class vre extends tm{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class bre extends tm{constructor(e,t,i=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class xre{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Ce)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,l=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.282095),t.addScaledVector(u[1],.488603*s),t.addScaledVector(u[2],.488603*l),t.addScaledVector(u[3],.488603*i),t.addScaledVector(u[4],1.092548*(i*s)),t.addScaledVector(u[5],1.092548*(s*l)),t.addScaledVector(u[6],.315392*(3*l*l-1)),t.addScaledVector(u[7],1.092548*(i*l)),t.addScaledVector(u[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,l=e.z,u=this.coefficients;return t.copy(u[0]).multiplyScalar(.886227),t.addScaledVector(u[1],2*.511664*s),t.addScaledVector(u[2],2*.511664*l),t.addScaledVector(u[3],2*.511664*i),t.addScaledVector(u[4],2*.429043*i*s),t.addScaledVector(u[5],2*.429043*s*l),t.addScaledVector(u[6],.743125*l*l-.247708),t.addScaledVector(u[7],2*.429043*i*l),t.addScaledVector(u[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,l=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*l,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*l,t[6]=.315392*(3*l*l-1),t[7]=1.092548*i*l,t[8]=.546274*(i*i-s*s)}}class wre extends tm{constructor(e=new xre,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class eM extends ol{constructor(e){super(e),this.textures={}}load(e,t,i,s){const l=this,u=new Xd(l.manager);u.setPath(l.path),u.setRequestHeader(l.requestHeader),u.setWithCredentials(l.withCredentials),u.load(e,function(d){try{t(l.parse(JSON.parse(d)))}catch(p){s?s(p):console.error(p),l.manager.itemError(e)}},i,s)}parse(e){const t=this.textures;function i(l){return t[l]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",l),t[l]}const s=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new An().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const l in e.uniforms){const u=e.uniforms[l];switch(s.uniforms[l]={},u.type){case"t":s.uniforms[l].value=i(u.value);break;case"c":s.uniforms[l].value=new An().setHex(u.value);break;case"v2":s.uniforms[l].value=new St().fromArray(u.value);break;case"v3":s.uniforms[l].value=new Ce().fromArray(u.value);break;case"v4":s.uniforms[l].value=new Wi().fromArray(u.value);break;case"m3":s.uniforms[l].value=new oi().fromArray(u.value);break;case"m4":s.uniforms[l].value=new Zn().fromArray(u.value);break;default:s.uniforms[l].value=u.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const l in e.extensions)s.extensions[l]=e.extensions[l];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let l=e.normalScale;Array.isArray(l)===!1&&(l=[l,l]),s.normalScale=new St().fromArray(l)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new St().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return eM.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:ere,SpriteMaterial:pV,RawShaderMaterial:tre,ShaderMaterial:au,PointsMaterial:gV,MeshPhysicalMaterial:nre,MeshStandardMaterial:EV,MeshPhongMaterial:ire,MeshToonMaterial:rre,MeshNormalMaterial:sre,MeshLambertMaterial:ore,MeshDepthMaterial:_V,MeshDistanceMaterial:IV,MeshBasicMaterial:Jp,MeshMatcapMaterial:are,LineDashedMaterial:lre,LineBasicMaterial:La,Material:ea};return new t[e]}}class t3{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Cre extends pi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Ere extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=new Xd(l.manager);u.setPath(l.path),u.setRequestHeader(l.requestHeader),u.setWithCredentials(l.withCredentials),u.load(e,function(d){try{t(l.parse(JSON.parse(d)))}catch(p){s?s(p):console.error(p),l.manager.itemError(e)}},i,s)}parse(e){const t={},i={};function s(S,M){if(t[M]!==void 0)return t[M];const P=S.interleavedBuffers[M],k=l(S,P.buffer),F=nA(P.type,k),V=new DT(F,P.stride);return V.uuid=P.uuid,t[M]=V,V}function l(S,M){if(i[M]!==void 0)return i[M];const P=S.arrayBuffers[M],k=new Uint32Array(P).buffer;return i[M]=k,k}const u=e.isInstancedBufferGeometry?new Cre:new pi,d=e.data.index;if(d!==void 0){const S=nA(d.type,d.array);u.setIndex(new sr(S,1))}const p=e.data.attributes;for(const S in p){const M=p[S];let R;if(M.isInterleavedBufferAttribute){const P=s(e.data,M.data);R=new qg(P,M.itemSize,M.offset,M.normalized)}else{const P=nA(M.type,M.array),k=M.isInstancedBufferAttribute?zA:sr;R=new k(P,M.itemSize,M.normalized)}M.name!==void 0&&(R.name=M.name),M.usage!==void 0&&R.setUsage(M.usage),u.setAttribute(S,R)}const g=e.data.morphAttributes;if(g)for(const S in g){const M=g[S],R=[];for(let P=0,k=M.length;P<k;P++){const F=M[P];let V;if(F.isInterleavedBufferAttribute){const G=s(e.data,F.data);V=new qg(G,F.itemSize,F.offset,F.normalized)}else{const G=nA(F.type,F.array);V=new sr(G,F.itemSize,F.normalized)}F.name!==void 0&&(V.name=F.name),R.push(V)}u.morphAttributes[S]=R}e.data.morphTargetsRelative&&(u.morphTargetsRelative=!0);const b=e.data.groups||e.data.drawcalls||e.data.offsets;if(b!==void 0)for(let S=0,M=b.length;S!==M;++S){const R=b[S];u.addGroup(R.start,R.count,R.materialIndex)}const E=e.data.boundingSphere;if(E!==void 0){const S=new Ce;E.center!==void 0&&S.fromArray(E.center),u.boundingSphere=new Yo(S,E.radius)}return e.name&&(u.name=e.name),e.userData&&(u.userData=e.userData),u}}class IQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=this.path===""?t3.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||u;const d=new Xd(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(p){let g=null;try{g=JSON.parse(p)}catch(b){s!==void 0&&s(b),console.error("THREE:ObjectLoader: Can't parse "+e+".",b.message);return}const x=g.metadata;if(x===void 0||x.type===void 0||x.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}l.parse(g,t)},i,s)}async loadAsync(e,t){const i=this,s=this.path===""?t3.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const l=new Xd(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials);const u=await l.loadAsync(e,t),d=JSON.parse(u),p=d.metadata;if(p===void 0||p.type===void 0||p.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(d)}parse(e,t){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),l=this.parseGeometries(e.geometries,s),u=this.parseImages(e.images,function(){t!==void 0&&t(g)}),d=this.parseTextures(e.textures,u),p=this.parseMaterials(e.materials,d),g=this.parseObject(e.object,l,p,d,i),x=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,x),this.bindLightTargets(g),t!==void 0){let b=!1;for(const E in u)if(u[E].data instanceof HTMLImageElement){b=!0;break}b===!1&&t(g)}return g}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),l=await this.parseImagesAsync(e.images),u=this.parseTextures(e.textures,l),d=this.parseMaterials(e.materials,u),p=this.parseObject(e.object,s,d,u,t),g=this.parseSkeletons(e.skeletons,p);return this.bindSkeletons(p,g),this.bindLightTargets(p),p}parseShapes(e){const t={};if(e!==void 0)for(let i=0,s=e.length;i<s;i++){const l=new Fg().fromJSON(e[i]);t[l.uuid]=l}return t}parseSkeletons(e,t){const i={},s={};if(t.traverse(function(l){l.isBone&&(s[l.uuid]=l)}),e!==void 0)for(let l=0,u=e.length;l<u;l++){const d=new FT().fromJSON(e[l],s);i[d.uuid]=d}return i}parseGeometries(e,t){const i={};if(e!==void 0){const l=new Ere;for(let u=0,d=e.length;u<d;u++){let p;const g=e[u];switch(g.type){case"BufferGeometry":case"InstancedBufferGeometry":p=l.parse(g);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var s=new THREE.LegacyJSONLoader;p=s.parse(g,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:g.type in oZ?p=oZ[g.type].fromJSON(g,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${g.type}"`)}p.uuid=g.uuid,g.name!==void 0&&(p.name=g.name),g.userData!==void 0&&(p.userData=g.userData),i[g.uuid]=p}}return i}parseMaterials(e,t){const i={},s={};if(e!==void 0){const l=new eM;l.setTextures(t);for(let u=0,d=e.length;u<d;u++){const p=e[u];i[p.uuid]===void 0&&(i[p.uuid]=l.parse(p)),s[p.uuid]=i[p.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const s=e[i],l=L1.parse(s);t[l.uuid]=l}return t}parseImages(e,t){const i=this,s={};let l;function u(p){return i.manager.itemStart(p),l.load(p,function(){i.manager.itemEnd(p)},void 0,function(){i.manager.itemError(p),i.manager.itemEnd(p)})}function d(p){if(typeof p=="string"){const g=p,x=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:i.resourcePath+g;return u(x)}else return p.data?{data:nA(p.type,p.data),width:p.width,height:p.height}:null}if(e!==void 0&&e.length>0){const p=new kV(t);l=new B1(p),l.setCrossOrigin(this.crossOrigin);for(let g=0,x=e.length;g<x;g++){const b=e[g],E=b.url;if(Array.isArray(E)){const S=[];for(let M=0,R=E.length;M<R;M++){const P=E[M],k=d(P);k!==null&&(k instanceof HTMLImageElement?S.push(k):S.push(new mh(k.data,k.width,k.height)))}s[b.uuid]=new Mg(S)}else{const S=d(b.url);s[b.uuid]=new Mg(S)}}}return s}async parseImagesAsync(e){const t=this,i={};let s;async function l(u){if(typeof u=="string"){const d=u,p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:t.resourcePath+d;return await s.loadAsync(p)}else return u.data?{data:nA(u.type,u.data),width:u.width,height:u.height}:null}if(e!==void 0&&e.length>0){s=new B1(this.manager),s.setCrossOrigin(this.crossOrigin);for(let u=0,d=e.length;u<d;u++){const p=e[u],g=p.url;if(Array.isArray(g)){const x=[];for(let b=0,E=g.length;b<E;b++){const S=g[b],M=await l(S);M!==null&&(M instanceof HTMLImageElement?x.push(M):x.push(new mh(M.data,M.width,M.height)))}i[p.uuid]=new Mg(x)}else{const x=await l(p.url);i[p.uuid]=new Mg(x)}}}return i}parseTextures(e,t){function i(l,u){return typeof l=="number"?l:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",l),u[l])}const s={};if(e!==void 0)for(let l=0,u=e.length;l<u;l++){const d=e[l];d.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',d.uuid),t[d.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",d.image);const p=t[d.image],g=p.data;let x;Array.isArray(g)?(x=new lw,g.length===6&&(x.needsUpdate=!0)):(g&&g.data?x=new mh:x=new Yr,g&&(x.needsUpdate=!0)),x.source=p,x.uuid=d.uuid,d.name!==void 0&&(x.name=d.name),d.mapping!==void 0&&(x.mapping=i(d.mapping,SQe)),d.channel!==void 0&&(x.channel=d.channel),d.offset!==void 0&&x.offset.fromArray(d.offset),d.repeat!==void 0&&x.repeat.fromArray(d.repeat),d.center!==void 0&&x.center.fromArray(d.center),d.rotation!==void 0&&(x.rotation=d.rotation),d.wrap!==void 0&&(x.wrapS=i(d.wrap[0],uZ),x.wrapT=i(d.wrap[1],uZ)),d.format!==void 0&&(x.format=d.format),d.internalFormat!==void 0&&(x.internalFormat=d.internalFormat),d.type!==void 0&&(x.type=d.type),d.colorSpace!==void 0&&(x.colorSpace=d.colorSpace),d.minFilter!==void 0&&(x.minFilter=i(d.minFilter,hZ)),d.magFilter!==void 0&&(x.magFilter=i(d.magFilter,hZ)),d.anisotropy!==void 0&&(x.anisotropy=d.anisotropy),d.flipY!==void 0&&(x.flipY=d.flipY),d.generateMipmaps!==void 0&&(x.generateMipmaps=d.generateMipmaps),d.premultiplyAlpha!==void 0&&(x.premultiplyAlpha=d.premultiplyAlpha),d.unpackAlignment!==void 0&&(x.unpackAlignment=d.unpackAlignment),d.compareFunction!==void 0&&(x.compareFunction=d.compareFunction),d.userData!==void 0&&(x.userData=d.userData),s[d.uuid]=x}return s}parseObject(e,t,i,s,l){let u;function d(E){return t[E]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",E),t[E]}function p(E){if(E!==void 0){if(Array.isArray(E)){const S=[];for(let M=0,R=E.length;M<R;M++){const P=E[M];i[P]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",P),S.push(i[P])}return S}return i[E]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",E),i[E]}}function g(E){return s[E]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",E),s[E]}let x,b;switch(e.type){case"Scene":u=new Pie,e.background!==void 0&&(Number.isInteger(e.background)?u.background=new An(e.background):u.background=g(e.background)),e.environment!==void 0&&(u.environment=g(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?u.fog=new NT(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(u.fog=new PT(e.fog.color,e.fog.density)),e.fog.name!==""&&(u.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(u.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(u.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&u.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(u.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&u.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":u=new Ao(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(u.focus=e.focus),e.zoom!==void 0&&(u.zoom=e.zoom),e.filmGauge!==void 0&&(u.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(u.filmOffset=e.filmOffset),e.view!==void 0&&(u.view=Object.assign({},e.view));break;case"OrthographicCamera":u=new JT(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(u.zoom=e.zoom),e.view!==void 0&&(u.view=Object.assign({},e.view));break;case"AmbientLight":u=new vre(e.color,e.intensity);break;case"DirectionalLight":u=new Are(e.color,e.intensity),u.target=e.target||"";break;case"PointLight":u=new yre(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":u=new bre(e.color,e.intensity,e.width,e.height);break;case"SpotLight":u=new gre(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),u.target=e.target||"";break;case"HemisphereLight":u=new mre(e.color,e.groundColor,e.intensity);break;case"LightProbe":u=new wre().fromJSON(e);break;case"SkinnedMesh":x=d(e.geometry),b=p(e.material),u=new Oie(x,b),e.bindMode!==void 0&&(u.bindMode=e.bindMode),e.bindMatrix!==void 0&&u.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(u.skeleton=e.skeleton);break;case"Mesh":x=d(e.geometry),b=p(e.material),u=new Ms(x,b);break;case"InstancedMesh":x=d(e.geometry),b=p(e.material);const E=e.count,S=e.instanceMatrix,M=e.instanceColor;u=new Vie(x,b,E),u.instanceMatrix=new zA(new Float32Array(S.array),16),M!==void 0&&(u.instanceColor=new zA(new Float32Array(M.array),M.itemSize));break;case"BatchedMesh":x=d(e.geometry),b=p(e.material),u=new Uie(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,b),u.geometry=x,u.perObjectFrustumCulled=e.perObjectFrustumCulled,u.sortObjects=e.sortObjects,u._drawRanges=e.drawRanges,u._reservedRanges=e.reservedRanges,u._visibility=e.visibility,u._active=e.active,u._bounds=e.bounds.map(R=>{const P=new Ma;P.min.fromArray(R.boxMin),P.max.fromArray(R.boxMax);const k=new Yo;return k.radius=R.sphereRadius,k.center.fromArray(R.sphereCenter),{boxInitialized:R.boxInitialized,box:P,sphereInitialized:R.sphereInitialized,sphere:k}}),u._maxInstanceCount=e.maxInstanceCount,u._maxVertexCount=e.maxVertexCount,u._maxIndexCount=e.maxIndexCount,u._geometryInitialized=e.geometryInitialized,u._geometryCount=e.geometryCount,u._matricesTexture=g(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(u._colorsTexture=g(e.colorsTexture.uuid));break;case"LOD":u=new Fie;break;case"Line":u=new Hp(d(e.geometry),p(e.material));break;case"LineLoop":u=new zie(d(e.geometry),p(e.material));break;case"LineSegments":u=new Eh(d(e.geometry),p(e.material));break;case"PointCloud":case"Points":u=new Gie(d(e.geometry),p(e.material));break;case"Sprite":u=new Die(p(e.material));break;case"Group":u=new iA;break;case"Bone":u=new mV;break;default:u=new Xi}if(u.uuid=e.uuid,e.name!==void 0&&(u.name=e.name),e.matrix!==void 0?(u.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(u.matrixAutoUpdate=e.matrixAutoUpdate),u.matrixAutoUpdate&&u.matrix.decompose(u.position,u.quaternion,u.scale)):(e.position!==void 0&&u.position.fromArray(e.position),e.rotation!==void 0&&u.rotation.fromArray(e.rotation),e.quaternion!==void 0&&u.quaternion.fromArray(e.quaternion),e.scale!==void 0&&u.scale.fromArray(e.scale)),e.up!==void 0&&u.up.fromArray(e.up),e.castShadow!==void 0&&(u.castShadow=e.castShadow),e.receiveShadow!==void 0&&(u.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(u.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(u.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(u.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(u.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&u.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(u.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(u.visible=e.visible),e.frustumCulled!==void 0&&(u.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(u.renderOrder=e.renderOrder),e.userData!==void 0&&(u.userData=e.userData),e.layers!==void 0&&(u.layers.mask=e.layers),e.children!==void 0){const E=e.children;for(let S=0;S<E.length;S++)u.add(this.parseObject(E[S],t,i,s,l))}if(e.animations!==void 0){const E=e.animations;for(let S=0;S<E.length;S++){const M=E[S];u.animations.push(l[M])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(u.autoUpdate=e.autoUpdate);const E=e.levels;for(let S=0;S<E.length;S++){const M=E[S],R=u.getObjectByProperty("uuid",M.object);R!==void 0&&u.addLevel(R,M.distance,M.hysteresis)}}return u}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=t[i.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(s,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,s=e.getObjectByProperty("uuid",i);s!==void 0?t.target=s:t.target=new Xi}})}}const SQe={UVMapping:wT,CubeReflectionMapping:Wd,CubeRefractionMapping:Wp,EquirectangularReflectionMapping:g1,EquirectangularRefractionMapping:y1,CubeUVReflectionMapping:JA},uZ={RepeatWrapping:A1,ClampToEdgeWrapping:hc,MirroredRepeatWrapping:v1},hZ={NearestFilter:Co,NearestMipmapNearestFilter:JO,NearestMipmapLinearFilter:tA,LinearFilter:Ws,LinearMipmapNearestFilter:Ix,LinearMipmapLinearFilter:ih};class TQe extends ol{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,u=vd.get(e);if(u!==void 0){if(l.manager.itemStart(e),u.then){u.then(g=>{t&&t(g),l.manager.itemEnd(e)}).catch(g=>{s&&s(g)});return}return setTimeout(function(){t&&t(u),l.manager.itemEnd(e)},0),u}const d={};d.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",d.headers=this.requestHeader;const p=fetch(e,d).then(function(g){return g.blob()}).then(function(g){return createImageBitmap(g,Object.assign(l.options,{colorSpaceConversion:"none"}))}).then(function(g){return vd.add(e,g),t&&t(g),l.manager.itemEnd(e),g}).catch(function(g){s&&s(g),vd.remove(e),l.manager.itemError(e),l.manager.itemEnd(e)});vd.add(e,p),l.manager.itemStart(e)}}let n_;class LV{static getContext(){return n_===void 0&&(n_=new(window.AudioContext||window.webkitAudioContext)),n_}static setContext(e){n_=e}}class MQe extends ol{constructor(e){super(e)}load(e,t,i,s){const l=this,u=new Xd(this.manager);u.setResponseType("arraybuffer"),u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(p){try{const g=p.slice(0);LV.getContext().decodeAudioData(g,function(b){t(b)}).catch(d)}catch(g){d(g)}},i,s);function d(p){s?s(p):console.error(p),l.manager.itemError(e)}}}const dZ=new Zn,fZ=new Zn,Zm=new Zn;class kQe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ao,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ao,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zm.copy(e.projectionMatrix);const s=t.eyeSep/2,l=s*t.near/t.focus,u=t.near*Math.tan(Dg*t.fov*.5)/t.zoom;let d,p;fZ.elements[12]=-s,dZ.elements[12]=s,d=-u*t.aspect+l,p=u*t.aspect+l,Zm.elements[0]=2*t.near/(p-d),Zm.elements[8]=(p+d)/(p-d),this.cameraL.projectionMatrix.copy(Zm),d=-u*t.aspect-l,p=u*t.aspect-l,Zm.elements[0]=2*t.near/(p-d),Zm.elements[8]=(p+d)/(p-d),this.cameraR.projectionMatrix.copy(Zm)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(fZ),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(dZ)}}class _re extends Ao{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class Ire{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=pZ(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=pZ();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function pZ(){return performance.now()}const jm=new Ce,mZ=new il,RQe=new Ce,Ym=new Ce;class LQe extends Xi{constructor(){super(),this.type="AudioListener",this.context=LV.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Ire}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(jm,mZ,RQe),Ym.set(0,0,-1).applyQuaternion(mZ),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(jm.x,s),t.positionY.linearRampToValueAtTime(jm.y,s),t.positionZ.linearRampToValueAtTime(jm.z,s),t.forwardX.linearRampToValueAtTime(Ym.x,s),t.forwardY.linearRampToValueAtTime(Ym.y,s),t.forwardZ.linearRampToValueAtTime(Ym.z,s),t.upX.linearRampToValueAtTime(i.x,s),t.upY.linearRampToValueAtTime(i.y,s),t.upZ.linearRampToValueAtTime(i.z,s)}else t.setPosition(jm.x,jm.y,jm.z),t.setOrientation(Ym.x,Ym.y,Ym.z,i.x,i.y,i.z)}}class Sre extends Xi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const qm=new Ce,gZ=new il,BQe=new Ce,Jm=new Ce;class PQe extends Sre{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(qm,gZ,BQe),Jm.set(0,0,1).applyQuaternion(gZ);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(qm.x,i),t.positionY.linearRampToValueAtTime(qm.y,i),t.positionZ.linearRampToValueAtTime(qm.z,i),t.orientationX.linearRampToValueAtTime(Jm.x,i),t.orientationY.linearRampToValueAtTime(Jm.y,i),t.orientationZ.linearRampToValueAtTime(Jm.z,i)}else t.setPosition(qm.x,qm.y,qm.z),t.setOrientation(Jm.x,Jm.y,Jm.z)}}class NQe{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class Tre{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,l,u;switch(t){case"quaternion":s=this._slerp,l=this._slerpAdditive,u=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,l=this._select,u=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,l=this._lerpAdditive,u=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=l,this._setIdentity=u,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,l=e*s+s;let u=this.cumulativeWeight;if(u===0){for(let d=0;d!==s;++d)i[l+d]=i[d];u=t}else{u+=t;const d=t/u;this._mixBufferRegion(i,l,0,d,s)}this.cumulativeWeight=u}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,l=this.cumulativeWeight,u=this.cumulativeWeightAdditive,d=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,l<1){const p=t*this._origIndex;this._mixBufferRegion(i,s,p,1-l,t)}u>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let p=t,g=t+t;p!==g;++p)if(i[p]!==i[p+t]){d.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let l=i,u=s;l!==u;++l)t[l]=t[s+l%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,l){if(s>=.5)for(let u=0;u!==l;++u)e[t+u]=e[i+u]}_slerp(e,t,i,s){il.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,l){const u=this._workIndex*l;il.multiplyQuaternionsFlat(e,u,e,t,e,i),il.slerpFlat(e,t,e,t,e,u,s)}_lerp(e,t,i,s,l){const u=1-s;for(let d=0;d!==l;++d){const p=t+d;e[p]=e[p]*u+e[i+d]*s}}_lerpAdditive(e,t,i,s,l){for(let u=0;u!==l;++u){const d=t+u;e[d]=e[d]+e[i+u]*s}}}const BV="\\[\\]\\.:\\/",DQe=new RegExp("["+BV+"]","g"),PV="[^"+BV+"]",FQe="[^"+BV.replace("\\.","")+"]",OQe=/((?:WC+[\/:])*)/.source.replace("WC",PV),VQe=/(WCOD+)?/.source.replace("WCOD",FQe),UQe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PV),zQe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PV),GQe=new RegExp("^"+OQe+VQe+UQe+zQe+"$"),WQe=["material","materials","bones","map"];class HQe{constructor(e,t,i){const s=i||Gi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,l=i.length;s!==l;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Gi{constructor(e,t,i){this.path=t,this.parsedPath=i||Gi.parseTrackName(t),this.node=Gi.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Gi.Composite(e,t,i):new Gi(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(DQe,"")}static parseTrackName(e){const t=GQe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const l=i.nodeName.substring(s+1);WQe.indexOf(l)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=l)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(l){for(let u=0;u<l.length;u++){const d=l[u];if(d.name===t||d.uuid===t)return d;const p=i(d.children);if(p)return p}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,l=i.length;s!==l;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let l=t.propertyIndex;if(e||(e=Gi.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let g=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let x=0;x<e.length;x++)if(e[x].name===g){g=x;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(g!==void 0){if(e[g]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[g]}}const u=e[s];if(u===void 0){const g=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+s+" but it wasn't found.",e);return}let d=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?d=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(d=this.Versioning.MatrixWorldNeedsUpdate);let p=this.BindingType.Direct;if(l!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[l]!==void 0&&(l=e.morphTargetDictionary[l])}p=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=l}else u.fromArray!==void 0&&u.toArray!==void 0?(p=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(p=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=s;this.getValue=this.GetterByBindingType[p],this.setValue=this.SetterByBindingTypeAndVersioning[p][d]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Gi.Composite=HQe;Gi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Gi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Gi.prototype.GetterByBindingType=[Gi.prototype._getValue_direct,Gi.prototype._getValue_array,Gi.prototype._getValue_arrayElement,Gi.prototype._getValue_toArray];Gi.prototype.SetterByBindingTypeAndVersioning=[[Gi.prototype._setValue_direct,Gi.prototype._setValue_direct_setNeedsUpdate,Gi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Gi.prototype._setValue_array,Gi.prototype._setValue_array_setNeedsUpdate,Gi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Gi.prototype._setValue_arrayElement,Gi.prototype._setValue_arrayElement_setNeedsUpdate,Gi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Gi.prototype._setValue_fromArray,Gi.prototype._setValue_fromArray_setNeedsUpdate,Gi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class XQe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ml(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,s=arguments.length;i!==s;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,l=this._bindings,u=l.length;let d,p=e.length,g=this.nCachedObjects_;for(let x=0,b=arguments.length;x!==b;++x){const E=arguments[x],S=E.uuid;let M=t[S];if(M===void 0){M=p++,t[S]=M,e.push(E);for(let R=0,P=u;R!==P;++R)l[R].push(new Gi(E,i[R],s[R]))}else if(M<g){d=e[M];const R=--g,P=e[R];t[P.uuid]=M,e[M]=P,t[S]=R,e[R]=E;for(let k=0,F=u;k!==F;++k){const V=l[k],G=V[R];let q=V[M];V[M]=G,q===void 0&&(q=new Gi(E,i[k],s[k])),V[R]=q}}else e[M]!==d&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let l=this.nCachedObjects_;for(let u=0,d=arguments.length;u!==d;++u){const p=arguments[u],g=p.uuid,x=t[g];if(x!==void 0&&x>=l){const b=l++,E=e[b];t[E.uuid]=x,e[x]=E,t[g]=b,e[b]=p;for(let S=0,M=s;S!==M;++S){const R=i[S],P=R[b],k=R[x];R[x]=P,R[b]=k}}}this.nCachedObjects_=l}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let l=this.nCachedObjects_,u=e.length;for(let d=0,p=arguments.length;d!==p;++d){const g=arguments[d],x=g.uuid,b=t[x];if(b!==void 0)if(delete t[x],b<l){const E=--l,S=e[E],M=--u,R=e[M];t[S.uuid]=b,e[b]=S,t[R.uuid]=E,e[E]=R,e.pop();for(let P=0,k=s;P!==k;++P){const F=i[P],V=F[E],G=F[M];F[b]=V,F[E]=G,F.pop()}}else{const E=--u,S=e[E];E>0&&(t[S.uuid]=b),e[b]=S,e.pop();for(let M=0,R=s;M!==R;++M){const P=i[M];P[b]=P[E],P.pop()}}}this.nCachedObjects_=l}subscribe_(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const l=this._bindings;if(s!==void 0)return l[s];const u=this._paths,d=this._parsedPaths,p=this._objects,g=p.length,x=this.nCachedObjects_,b=new Array(g);s=l.length,i[e]=s,u.push(e),d.push(t),l.push(b);for(let E=x,S=p.length;E!==S;++E){const M=p[E];b[E]=new Gi(M,e,t)}return b}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const s=this._paths,l=this._parsedPaths,u=this._bindings,d=u.length-1,p=u[d],g=e[d];t[g]=i,u[i]=p,u.pop(),l[i]=l[d],l.pop(),s[i]=s[d],s.pop()}}}class Mre{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const l=t.tracks,u=l.length,d=new Array(u),p={endingStart:Sg,endingEnd:Sg};for(let g=0;g!==u;++g){const x=l[g].createInterpolant(null);d[g]=x,x.settings=p}this._interpolantSettings=p,this._interpolants=d,this._propertyBindings=new Array(u),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=pie,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,l=e._clip.duration,u=l/s,d=s/l;e.warp(1,u,t),this.warp(d,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,l=s.time,u=this.timeScale;let d=this._timeScaleInterpolant;d===null&&(d=s._lendControlInterpolant(),this._timeScaleInterpolant=d);const p=d.parameterPositions,g=d.sampleValues;return p[0]=l,p[1]=l+i,g[0]=e/u,g[1]=t/u,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const l=this._startTime;if(l!==null){const p=(e-l)*i;p<0||i===0?t=0:(this._startTime=null,t=i*p)}t*=this._updateTimeScale(e);const u=this._updateTime(t),d=this._updateWeight(e);if(d>0){const p=this._interpolants,g=this._propertyBindings;switch(this.blendMode){case cV:for(let x=0,b=p.length;x!==b;++x)p[x].evaluate(u),g[x].accumulateAdditive(d);break;case MT:default:for(let x=0,b=p.length;x!==b;++x)p[x].evaluate(u),g[x].accumulate(s,d)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,l=this._loopCount;const u=i===mie;if(e===0)return l===-1?s:u&&(l&1)===1?t-s:s;if(i===fie){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(l===-1&&(e>=0?(l=0,this._setEndings(!0,this.repetitions===0,u)):this._setEndings(this.repetitions===0,!0,u)),s>=t||s<0){const d=Math.floor(s/t);s-=t*d,l+=Math.abs(d);const p=this.repetitions-l;if(p<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(p===1){const g=e<0;this._setEndings(g,!g,u)}else this._setEndings(!1,!1,u);this._loopCount=l,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:d})}}else this.time=s;if(u&&(l&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=Tg,s.endingEnd=Tg):(e?s.endingStart=this.zeroSlopeAtStart?Tg:Sg:s.endingStart=x1,t?s.endingEnd=this.zeroSlopeAtEnd?Tg:Sg:s.endingEnd=x1)}_scheduleFading(e,t,i){const s=this._mixer,l=s.time;let u=this._weightInterpolant;u===null&&(u=s._lendControlInterpolant(),this._weightInterpolant=u);const d=u.parameterPositions,p=u.sampleValues;return d[0]=l,p[0]=t,d[1]=l+e,p[1]=i,this}}const $Qe=new Float32Array(1);class QQe extends Ch{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,l=s.length,u=e._propertyBindings,d=e._interpolants,p=i.uuid,g=this._bindingsByRootAndName;let x=g[p];x===void 0&&(x={},g[p]=x);for(let b=0;b!==l;++b){const E=s[b],S=E.name;let M=x[S];if(M!==void 0)++M.referenceCount,u[b]=M;else{if(M=u[b],M!==void 0){M._cacheIndex===null&&(++M.referenceCount,this._addInactiveBinding(M,p,S));continue}const R=t&&t._propertyBindings[b].binding.parsedPath;M=new Tre(Gi.create(i,S,R),E.ValueTypeName,E.getValueSize()),++M.referenceCount,this._addInactiveBinding(M,p,S),u[b]=M}d[b].resultBuffer=M.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,l=this._actionsByClip[s];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const l=t[i];l.useCount++===0&&(this._lendBinding(l),l.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const l=t[i];--l.useCount===0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,l=this._actionsByClip;let u=l[t];if(u===void 0)u={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[t]=u;else{const d=u.knownActions;e._byClipCacheIndex=d.length,d.push(e)}e._cacheIndex=s.length,s.push(e),u.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const l=e._clip.uuid,u=this._actionsByClip,d=u[l],p=d.knownActions,g=p[p.length-1],x=e._byClipCacheIndex;g._byClipCacheIndex=x,p[x]=g,p.pop(),e._byClipCacheIndex=null;const b=d.actionByRoot,E=(e._localRoot||this._root).uuid;delete b[E],p.length===0&&delete u[l],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const l=t[i];--l.referenceCount===0&&this._removeInactiveBinding(l)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=i,t[i]=l}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=i,t[i]=l}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,l=this._bindings;let u=s[t];u===void 0&&(u={},s[t]=u),u[i]=e,e._cacheIndex=l.length,l.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,l=i.path,u=this._bindingsByRootAndName,d=u[s],p=t[t.length-1],g=e._cacheIndex;p._cacheIndex=g,t[g]=p,t.pop(),delete d[l],Object.keys(d).length===0&&delete u[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=i,t[i]=l}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,l=t[s];e._cacheIndex=s,t[s]=e,l._cacheIndex=i,t[i]=l}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new TV(new Float32Array(2),new Float32Array(2),1,$Qe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,l=t[s];e.__cacheIndex=s,t[s]=e,l.__cacheIndex=i,t[i]=l}clipAction(e,t,i){const s=t||this._root,l=s.uuid;let u=typeof e=="string"?L1.findByName(s,e):e;const d=u!==null?u.uuid:e,p=this._actionsByClip[d];let g=null;if(i===void 0&&(u!==null?i=u.blendMode:i=MT),p!==void 0){const b=p.actionByRoot[l];if(b!==void 0&&b.blendMode===i)return b;g=p.knownActions[0],u===null&&(u=g._clip)}if(u===null)return null;const x=new Mre(this,u,t,i);return this._bindAction(x,g),this._addInactiveAction(x,d,l),x}existingAction(e,t){const i=t||this._root,s=i.uuid,l=typeof e=="string"?L1.findByName(i,e):e,u=l?l.uuid:e,d=this._actionsByClip[u];return d!==void 0&&d.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,l=Math.sign(e),u=this._accuIndex^=1;for(let g=0;g!==i;++g)t[g]._update(s,e,l,u);const d=this._bindings,p=this._nActiveBindings;for(let g=0;g!==p;++g)d[g].apply(u);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,l=s[i];if(l!==void 0){const u=l.knownActions;for(let d=0,p=u.length;d!==p;++d){const g=u[d];this._deactivateAction(g);const x=g._cacheIndex,b=t[t.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,b._cacheIndex=x,t[x]=b,t.pop(),this._removeInactiveBindingsForAction(g)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const u in i){const d=i[u].actionByRoot,p=d[t];p!==void 0&&(this._deactivateAction(p),this._removeInactiveAction(p))}const s=this._bindingsByRootAndName,l=s[t];if(l!==void 0)for(const u in l){const d=l[u];d.restoreOriginalState(),this._removeInactiveBinding(d)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class KQe extends kT{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isRenderTarget3D=!0,this.depth=i,this.texture=new RT(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class ZQe extends kT{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isRenderTargetArray=!0,this.depth=i,this.texture=new aw(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class NV{constructor(e){this.value=e}clone(){return new NV(this.value.clone===void 0?this.value:this.value.clone())}}let jQe=0;class YQe extends Ch{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:jQe++}),this.name="",this.usage=C1,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,s=t.length;i<s;i++){const l=Array.isArray(t[i])?t[i]:[t[i]];for(let u=0;u<l.length;u++)this.uniforms.push(l[u].clone())}return this}clone(){return new this.constructor().copy(this)}}class qQe extends DT{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class JQe{constructor(e,t,i,s,l){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=l,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const yZ=new Zn;class eKe{constructor(e,t,i=0,s=1/0){this.ray=new tv(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new LT,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return yZ.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(yZ),this}intersectObject(e,t=!0,i=[]){return n3(e,this,i,t),i.sort(AZ),i}intersectObjects(e,t=!0,i=[]){for(let s=0,l=e.length;s<l;s++)n3(e[s],this,i,t);return i.sort(AZ),i}}function AZ(n,e){return n.distance-e.distance}function n3(n,e,t,i){let s=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(s=!1),s===!0&&i===!0){const l=n.children;for(let u=0,d=l.length;u<d;u++)n3(l[u],e,t,!0)}}class tKe{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=ai(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ai(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class nKe{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class DV{constructor(e,t,i,s){DV.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,s){const l=this.elements;return l[0]=e,l[2]=t,l[1]=i,l[3]=s,this}}const vZ=new St;class iKe{constructor(e=new St(1/0,1/0),t=new St(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=vZ.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,vZ).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const bZ=new Ce,i_=new Ce;class rKe{constructor(e=new Ce,t=new Ce){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){bZ.subVectors(e,this.start),i_.subVectors(this.end,this.start);const i=i_.dot(i_);let l=i_.dot(bZ)/i;return t&&(l=ai(l,0,1)),l}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const xZ=new Ce;class sKe extends Xi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new pi,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let u=0,d=1,p=32;u<p;u++,d++){const g=u/p*Math.PI*2,x=d/p*Math.PI*2;s.push(Math.cos(g),Math.sin(g),1,Math.cos(x),Math.sin(x),1)}i.setAttribute("position",new En(s,3));const l=new La({fog:!1,toneMapped:!1});this.cone=new Eh(i,l),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),xZ.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xZ),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const zf=new Ce,r_=new Zn,qB=new Zn;class oKe extends Eh{constructor(e){const t=kre(e),i=new pi,s=[],l=[],u=new An(0,0,1),d=new An(0,1,0);for(let g=0;g<t.length;g++){const x=t[g];x.parent&&x.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),l.push(u.r,u.g,u.b),l.push(d.r,d.g,d.b))}i.setAttribute("position",new En(s,3)),i.setAttribute("color",new En(l,3));const p=new La({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,p),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");qB.copy(this.root.matrixWorld).invert();for(let l=0,u=0;l<t.length;l++){const d=t[l];d.parent&&d.parent.isBone&&(r_.multiplyMatrices(qB,d.matrixWorld),zf.setFromMatrixPosition(r_),s.setXYZ(u,zf.x,zf.y,zf.z),r_.multiplyMatrices(qB,d.parent.matrixWorld),zf.setFromMatrixPosition(r_),s.setXYZ(u+1,zf.x,zf.y,zf.z),u+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function kre(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,kre(n.children[t]));return e}class aKe extends Ms{constructor(e,t,i){const s=new dw(t,4,2),l=new Jp({wireframe:!0,fog:!1,toneMapped:!1});super(s,l),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const lKe=new Ce,wZ=new An,CZ=new An;class cKe extends Xi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const s=new hw(t);s.rotateY(Math.PI*.5),this.material=new Jp({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const l=s.getAttribute("position"),u=new Float32Array(l.count*3);s.setAttribute("color",new sr(u,3)),this.add(new Ms(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");wZ.copy(this.light.color),CZ.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const l=i<s/2?wZ:CZ;t.setXYZ(i,l.r,l.g,l.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(lKe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class uKe extends Eh{constructor(e=10,t=10,i=4473924,s=8947848){i=new An(i),s=new An(s);const l=t/2,u=e/t,d=e/2,p=[],g=[];for(let E=0,S=0,M=-d;E<=t;E++,M+=u){p.push(-d,0,M,d,0,M),p.push(M,0,-d,M,0,d);const R=E===l?i:s;R.toArray(g,S),S+=3,R.toArray(g,S),S+=3,R.toArray(g,S),S+=3,R.toArray(g,S),S+=3}const x=new pi;x.setAttribute("position",new En(p,3)),x.setAttribute("color",new En(g,3));const b=new La({vertexColors:!0,toneMapped:!1});super(x,b),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class hKe extends Eh{constructor(e=10,t=16,i=8,s=64,l=4473924,u=8947848){l=new An(l),u=new An(u);const d=[],p=[];if(t>1)for(let b=0;b<t;b++){const E=b/t*(Math.PI*2),S=Math.sin(E)*e,M=Math.cos(E)*e;d.push(0,0,0),d.push(S,0,M);const R=b&1?l:u;p.push(R.r,R.g,R.b),p.push(R.r,R.g,R.b)}for(let b=0;b<i;b++){const E=b&1?l:u,S=e-e/i*b;for(let M=0;M<s;M++){let R=M/s*(Math.PI*2),P=Math.sin(R)*S,k=Math.cos(R)*S;d.push(P,0,k),p.push(E.r,E.g,E.b),R=(M+1)/s*(Math.PI*2),P=Math.sin(R)*S,k=Math.cos(R)*S,d.push(P,0,k),p.push(E.r,E.g,E.b)}}const g=new pi;g.setAttribute("position",new En(d,3)),g.setAttribute("color",new En(p,3));const x=new La({vertexColors:!0,toneMapped:!1});super(g,x),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const EZ=new Ce,s_=new Ce,_Z=new Ce;class dKe extends Xi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new pi;s.setAttribute("position",new En([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const l=new La({fog:!1,toneMapped:!1});this.lightPlane=new Hp(s,l),this.add(this.lightPlane),s=new pi,s.setAttribute("position",new En([0,0,0,0,0,1],3)),this.targetLine=new Hp(s,l),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),EZ.setFromMatrixPosition(this.light.matrixWorld),s_.setFromMatrixPosition(this.light.target.matrixWorld),_Z.subVectors(s_,EZ),this.lightPlane.lookAt(s_),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(s_),this.targetLine.scale.z=_Z.length()}}const o_=new Ce,Zr=new BT;class fKe extends Eh{constructor(e){const t=new pi,i=new La({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],l=[],u={};d("n1","n2"),d("n2","n4"),d("n4","n3"),d("n3","n1"),d("f1","f2"),d("f2","f4"),d("f4","f3"),d("f3","f1"),d("n1","f1"),d("n2","f2"),d("n3","f3"),d("n4","f4"),d("p","n1"),d("p","n2"),d("p","n3"),d("p","n4"),d("u1","u2"),d("u2","u3"),d("u3","u1"),d("c","t"),d("p","c"),d("cn1","cn2"),d("cn3","cn4"),d("cf1","cf2"),d("cf3","cf4");function d(M,R){p(M),p(R)}function p(M){s.push(0,0,0),l.push(0,0,0),u[M]===void 0&&(u[M]=[]),u[M].push(s.length/3-1)}t.setAttribute("position",new En(s,3)),t.setAttribute("color",new En(l,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=u,this.update();const g=new An(16755200),x=new An(16711680),b=new An(43775),E=new An(16777215),S=new An(3355443);this.setColors(g,x,b,E,S)}setColors(e,t,i,s,l){const d=this.geometry.getAttribute("color");d.setXYZ(0,e.r,e.g,e.b),d.setXYZ(1,e.r,e.g,e.b),d.setXYZ(2,e.r,e.g,e.b),d.setXYZ(3,e.r,e.g,e.b),d.setXYZ(4,e.r,e.g,e.b),d.setXYZ(5,e.r,e.g,e.b),d.setXYZ(6,e.r,e.g,e.b),d.setXYZ(7,e.r,e.g,e.b),d.setXYZ(8,e.r,e.g,e.b),d.setXYZ(9,e.r,e.g,e.b),d.setXYZ(10,e.r,e.g,e.b),d.setXYZ(11,e.r,e.g,e.b),d.setXYZ(12,e.r,e.g,e.b),d.setXYZ(13,e.r,e.g,e.b),d.setXYZ(14,e.r,e.g,e.b),d.setXYZ(15,e.r,e.g,e.b),d.setXYZ(16,e.r,e.g,e.b),d.setXYZ(17,e.r,e.g,e.b),d.setXYZ(18,e.r,e.g,e.b),d.setXYZ(19,e.r,e.g,e.b),d.setXYZ(20,e.r,e.g,e.b),d.setXYZ(21,e.r,e.g,e.b),d.setXYZ(22,e.r,e.g,e.b),d.setXYZ(23,e.r,e.g,e.b),d.setXYZ(24,t.r,t.g,t.b),d.setXYZ(25,t.r,t.g,t.b),d.setXYZ(26,t.r,t.g,t.b),d.setXYZ(27,t.r,t.g,t.b),d.setXYZ(28,t.r,t.g,t.b),d.setXYZ(29,t.r,t.g,t.b),d.setXYZ(30,t.r,t.g,t.b),d.setXYZ(31,t.r,t.g,t.b),d.setXYZ(32,i.r,i.g,i.b),d.setXYZ(33,i.r,i.g,i.b),d.setXYZ(34,i.r,i.g,i.b),d.setXYZ(35,i.r,i.g,i.b),d.setXYZ(36,i.r,i.g,i.b),d.setXYZ(37,i.r,i.g,i.b),d.setXYZ(38,s.r,s.g,s.b),d.setXYZ(39,s.r,s.g,s.b),d.setXYZ(40,l.r,l.g,l.b),d.setXYZ(41,l.r,l.g,l.b),d.setXYZ(42,l.r,l.g,l.b),d.setXYZ(43,l.r,l.g,l.b),d.setXYZ(44,l.r,l.g,l.b),d.setXYZ(45,l.r,l.g,l.b),d.setXYZ(46,l.r,l.g,l.b),d.setXYZ(47,l.r,l.g,l.b),d.setXYZ(48,l.r,l.g,l.b),d.setXYZ(49,l.r,l.g,l.b),d.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;Zr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const l=this.camera.coordinateSystem===nu?-1:0;rs("c",t,e,Zr,0,0,l),rs("t",t,e,Zr,0,0,1),rs("n1",t,e,Zr,-1,-1,l),rs("n2",t,e,Zr,i,-1,l),rs("n3",t,e,Zr,-1,s,l),rs("n4",t,e,Zr,i,s,l),rs("f1",t,e,Zr,-1,-1,1),rs("f2",t,e,Zr,i,-1,1),rs("f3",t,e,Zr,-1,s,1),rs("f4",t,e,Zr,i,s,1),rs("u1",t,e,Zr,i*.7,s*1.1,l),rs("u2",t,e,Zr,-1*.7,s*1.1,l),rs("u3",t,e,Zr,0,s*2,l),rs("cf1",t,e,Zr,-1,0,1),rs("cf2",t,e,Zr,i,0,1),rs("cf3",t,e,Zr,0,-1,1),rs("cf4",t,e,Zr,0,s,1),rs("cn1",t,e,Zr,-1,0,l),rs("cn2",t,e,Zr,i,0,l),rs("cn3",t,e,Zr,0,-1,l),rs("cn4",t,e,Zr,0,s,l),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function rs(n,e,t,i,s,l,u){o_.set(s,l,u).unproject(i);const d=e[n];if(d!==void 0){const p=t.getAttribute("position");for(let g=0,x=d.length;g<x;g++)p.setXYZ(d[g],o_.x,o_.y,o_.z)}}const a_=new Ma;class pKe extends Eh{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),l=new pi;l.setIndex(new sr(i,1)),l.setAttribute("position",new sr(s,3)),super(l,new La({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&a_.setFromObject(this.object),a_.isEmpty())return;const t=a_.min,i=a_.max,s=this.geometry.attributes.position,l=s.array;l[0]=i.x,l[1]=i.y,l[2]=i.z,l[3]=t.x,l[4]=i.y,l[5]=i.z,l[6]=t.x,l[7]=t.y,l[8]=i.z,l[9]=i.x,l[10]=t.y,l[11]=i.z,l[12]=i.x,l[13]=i.y,l[14]=t.z,l[15]=t.x,l[16]=i.y,l[17]=t.z,l[18]=t.x,l[19]=t.y,l[20]=t.z,l[21]=i.x,l[22]=t.y,l[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class mKe extends Eh{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],l=new pi;l.setIndex(new sr(i,1)),l.setAttribute("position",new En(s,3)),super(l,new La({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class gKe extends Hp{constructor(e,t=1,i=16776960){const s=i,l=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],u=new pi;u.setAttribute("position",new En(l,3)),u.computeBoundingSphere(),super(u,new La({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const d=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],p=new pi;p.setAttribute("position",new En(d,3)),p.computeBoundingSphere(),this.add(new Ms(p,new Jp({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const IZ=new Ce;let l_,JB;class yKe extends Xi{constructor(e=new Ce(0,0,1),t=new Ce(0,0,0),i=1,s=16776960,l=i*.2,u=l*.2){super(),this.type="ArrowHelper",l_===void 0&&(l_=new pi,l_.setAttribute("position",new En([0,0,0,0,1,0],3)),JB=new nv(0,.5,1,5,1),JB.translate(0,-.5,0)),this.position.copy(t),this.line=new Hp(l_,new La({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ms(JB,new Jp({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,l,u)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{IZ.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(IZ,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AKe extends Eh{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new pi;s.setAttribute("position",new En(t,3)),s.setAttribute("color",new En(i,3));const l=new La({vertexColors:!0,toneMapped:!1});super(s,l),this.type="AxesHelper"}setColors(e,t,i){const s=new An,l=this.geometry.attributes.color.array;return s.set(e),s.toArray(l,0),s.toArray(l,3),s.set(t),s.toArray(l,6),s.toArray(l,9),s.set(i),s.toArray(l,12),s.toArray(l,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class vKe{constructor(){this.type="ShapePath",this.color=new An,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new I1,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this}bezierCurveTo(e,t,i,s,l,u){return this.currentPath.bezierCurveTo(e,t,i,s,l,u),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(k){const F=[];for(let V=0,G=k.length;V<G;V++){const q=k[V],ne=new Fg;ne.curves=q.curves,F.push(ne)}return F}function i(k,F){const V=F.length;let G=!1;for(let q=V-1,ne=0;ne<V;q=ne++){let K=F[q],Q=F[ne],H=Q.x-K.x,j=Q.y-K.y;if(Math.abs(j)>Number.EPSILON){if(j<0&&(K=F[ne],H=-H,Q=F[q],j=-j),k.y<K.y||k.y>Q.y)continue;if(k.y===K.y){if(k.x===K.x)return!0}else{const ee=j*(k.x-K.x)-H*(k.y-K.y);if(ee===0)return!0;if(ee<0)continue;G=!G}}else{if(k.y!==K.y)continue;if(Q.x<=k.x&&k.x<=K.x||K.x<=k.x&&k.x<=Q.x)return!0}}return G}const s=gh.isClockWise,l=this.subPaths;if(l.length===0)return[];let u,d,p;const g=[];if(l.length===1)return d=l[0],p=new Fg,p.curves=d.curves,g.push(p),g;let x=!s(l[0].getPoints());x=e?!x:x;const b=[],E=[];let S=[],M=0,R;E[M]=void 0,S[M]=[];for(let k=0,F=l.length;k<F;k++)d=l[k],R=d.getPoints(),u=s(R),u=e?!u:u,u?(!x&&E[M]&&M++,E[M]={s:new Fg,p:R},E[M].s.curves=d.curves,x&&M++,S[M]=[]):S[M].push({h:d,p:R[0]});if(!E[0])return t(l);if(E.length>1){let k=!1,F=0;for(let V=0,G=E.length;V<G;V++)b[V]=[];for(let V=0,G=E.length;V<G;V++){const q=S[V];for(let ne=0;ne<q.length;ne++){const K=q[ne];let Q=!0;for(let H=0;H<E.length;H++)i(K.p,E[H].p)&&(V!==H&&F++,Q?(Q=!1,b[H].push(K)):k=!0);Q&&b[V].push(K)}}F>0&&k===!1&&(S=b)}let P;for(let k=0,F=E.length;k<F;k++){p=E[k].s,g.push(p),P=S[k];for(let V=0,G=P.length;V<G;V++)p.holes.push(P[V].h)}return g}}class bKe extends Ch{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}function xKe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function wKe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function CKe(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function i3(n,e,t,i){const s=EKe(i);switch(t){case iV:return n*e;case sV:return n*e;case oV:return n*e*2;case IT:return n*e/s.components*s.byteLength;case ow:return n*e/s.components*s.byteLength;case aV:return n*e*2/s.components*s.byteLength;case ST:return n*e*2/s.components*s.byteLength;case rV:return n*e*3/s.components*s.byteLength;case Ia:return n*e*4/s.components*s.byteLength;case TT:return n*e*4/s.components*s.byteLength;case Sx:case Tx:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Mx:case kx:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case R2:case B2:return Math.max(n,16)*Math.max(e,8)/4;case k2:case L2:return Math.max(n,8)*Math.max(e,8)/2;case P2:case N2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case D2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case F2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case O2:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case V2:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case U2:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case z2:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case G2:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case W2:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case H2:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case X2:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case $2:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Q2:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case K2:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case Z2:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case j2:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case Rx:case Y2:case q2:return Math.ceil(n/4)*Math.ceil(e/4)*16;case lV:case J2:return Math.ceil(n/4)*Math.ceil(e/4)*8;case eS:case tS:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function EKe(n){switch(n){case bh:case eV:return{byteLength:1,components:1};case OA:case tV:case ev:return{byteLength:2,components:1};case ET:case _T:return{byteLength:2,components:4};case Hd:case CT:case Ca:return{byteLength:4,components:1};case nV:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}const _Ke={contain:xKe,cover:wKe,fill:CKe,getByteLength:i3};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xT}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xT);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Rre(){let n=null,e=!1,t=null,i=null;function s(l,u){t(l,u),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(l){t=l},setContext:function(l){n=l}}}function IKe(n){const e=new WeakMap;function t(d,p){const g=d.array,x=d.usage,b=g.byteLength,E=n.createBuffer();n.bindBuffer(p,E),n.bufferData(p,g,x),d.onUploadCallback();let S;if(g instanceof Float32Array)S=n.FLOAT;else if(g instanceof Uint16Array)d.isFloat16BufferAttribute?S=n.HALF_FLOAT:S=n.UNSIGNED_SHORT;else if(g instanceof Int16Array)S=n.SHORT;else if(g instanceof Uint32Array)S=n.UNSIGNED_INT;else if(g instanceof Int32Array)S=n.INT;else if(g instanceof Int8Array)S=n.BYTE;else if(g instanceof Uint8Array)S=n.UNSIGNED_BYTE;else if(g instanceof Uint8ClampedArray)S=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:E,type:S,bytesPerElement:g.BYTES_PER_ELEMENT,version:d.version,size:b}}function i(d,p,g){const x=p.array,b=p.updateRanges;if(n.bindBuffer(g,d),b.length===0)n.bufferSubData(g,0,x);else{b.sort((S,M)=>S.start-M.start);let E=0;for(let S=1;S<b.length;S++){const M=b[E],R=b[S];R.start<=M.start+M.count+1?M.count=Math.max(M.count,R.start+R.count-M.start):(++E,b[E]=R)}b.length=E+1;for(let S=0,M=b.length;S<M;S++){const R=b[S];n.bufferSubData(g,R.start*x.BYTES_PER_ELEMENT,x,R.start,R.count)}p.clearUpdateRanges()}p.onUploadCallback()}function s(d){return d.isInterleavedBufferAttribute&&(d=d.data),e.get(d)}function l(d){d.isInterleavedBufferAttribute&&(d=d.data);const p=e.get(d);p&&(n.deleteBuffer(p.buffer),e.delete(d))}function u(d,p){if(d.isInterleavedBufferAttribute&&(d=d.data),d.isGLBufferAttribute){const x=e.get(d);(!x||x.version<d.version)&&e.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}const g=e.get(d);if(g===void 0)e.set(d,t(d,p));else if(g.version<d.version){if(g.size!==d.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(g.buffer,d,p),g.version=d.version}}return{get:s,remove:l,update:u}}var SKe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TKe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,MKe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,kKe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,RKe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,LKe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,BKe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,PKe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,NKe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,DKe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,FKe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,OKe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,VKe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,UKe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,zKe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,GKe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,WKe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,HKe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,XKe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,$Ke=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,QKe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,KKe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,ZKe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,jKe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,YKe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,qKe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,JKe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,e6e=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,t6e=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,n6e=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,i6e="gl_FragColor = linearToOutputTexel( gl_FragColor );",r6e=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,s6e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,o6e=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,a6e=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,l6e=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,c6e=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,u6e=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,h6e=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,d6e=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,f6e=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,p6e=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,m6e=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,g6e=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,y6e=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,A6e=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,v6e=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,b6e=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,x6e=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,w6e=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,C6e=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,E6e=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,_6e=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,I6e=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,S6e=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,T6e=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,M6e=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,k6e=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,R6e=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,L6e=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,B6e=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,P6e=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,N6e=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,D6e=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,F6e=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,O6e=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,V6e=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,U6e=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,z6e=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,G6e=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,W6e=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,H6e=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,X6e=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,$6e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Q6e=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,K6e=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Z6e=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,j6e=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Y6e=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,q6e=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,J6e=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,eZe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,tZe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,nZe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,iZe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,rZe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,sZe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oZe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,aZe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,lZe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,cZe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,uZe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,hZe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,dZe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,fZe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,pZe=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,mZe=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,gZe=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,yZe=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,AZe=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,vZe=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,bZe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,xZe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,wZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,CZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,EZe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,_Ze=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const IZe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,SZe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TZe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MZe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kZe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,RZe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,LZe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,BZe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,PZe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,NZe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,DZe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,FZe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,OZe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VZe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UZe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,zZe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GZe=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WZe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,HZe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,XZe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$Ze=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,QZe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,KZe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ZZe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jZe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,YZe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qZe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,JZe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,e8e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,t8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,n8e=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,i8e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,r8e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,s8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,fi={alphahash_fragment:SKe,alphahash_pars_fragment:TKe,alphamap_fragment:MKe,alphamap_pars_fragment:kKe,alphatest_fragment:RKe,alphatest_pars_fragment:LKe,aomap_fragment:BKe,aomap_pars_fragment:PKe,batching_pars_vertex:NKe,batching_vertex:DKe,begin_vertex:FKe,beginnormal_vertex:OKe,bsdfs:VKe,iridescence_fragment:UKe,bumpmap_pars_fragment:zKe,clipping_planes_fragment:GKe,clipping_planes_pars_fragment:WKe,clipping_planes_pars_vertex:HKe,clipping_planes_vertex:XKe,color_fragment:$Ke,color_pars_fragment:QKe,color_pars_vertex:KKe,color_vertex:ZKe,common:jKe,cube_uv_reflection_fragment:YKe,defaultnormal_vertex:qKe,displacementmap_pars_vertex:JKe,displacementmap_vertex:e6e,emissivemap_fragment:t6e,emissivemap_pars_fragment:n6e,colorspace_fragment:i6e,colorspace_pars_fragment:r6e,envmap_fragment:s6e,envmap_common_pars_fragment:o6e,envmap_pars_fragment:a6e,envmap_pars_vertex:l6e,envmap_physical_pars_fragment:v6e,envmap_vertex:c6e,fog_vertex:u6e,fog_pars_vertex:h6e,fog_fragment:d6e,fog_pars_fragment:f6e,gradientmap_pars_fragment:p6e,lightmap_pars_fragment:m6e,lights_lambert_fragment:g6e,lights_lambert_pars_fragment:y6e,lights_pars_begin:A6e,lights_toon_fragment:b6e,lights_toon_pars_fragment:x6e,lights_phong_fragment:w6e,lights_phong_pars_fragment:C6e,lights_physical_fragment:E6e,lights_physical_pars_fragment:_6e,lights_fragment_begin:I6e,lights_fragment_maps:S6e,lights_fragment_end:T6e,logdepthbuf_fragment:M6e,logdepthbuf_pars_fragment:k6e,logdepthbuf_pars_vertex:R6e,logdepthbuf_vertex:L6e,map_fragment:B6e,map_pars_fragment:P6e,map_particle_fragment:N6e,map_particle_pars_fragment:D6e,metalnessmap_fragment:F6e,metalnessmap_pars_fragment:O6e,morphinstance_vertex:V6e,morphcolor_vertex:U6e,morphnormal_vertex:z6e,morphtarget_pars_vertex:G6e,morphtarget_vertex:W6e,normal_fragment_begin:H6e,normal_fragment_maps:X6e,normal_pars_fragment:$6e,normal_pars_vertex:Q6e,normal_vertex:K6e,normalmap_pars_fragment:Z6e,clearcoat_normal_fragment_begin:j6e,clearcoat_normal_fragment_maps:Y6e,clearcoat_pars_fragment:q6e,iridescence_pars_fragment:J6e,opaque_fragment:eZe,packing:tZe,premultiplied_alpha_fragment:nZe,project_vertex:iZe,dithering_fragment:rZe,dithering_pars_fragment:sZe,roughnessmap_fragment:oZe,roughnessmap_pars_fragment:aZe,shadowmap_pars_fragment:lZe,shadowmap_pars_vertex:cZe,shadowmap_vertex:uZe,shadowmask_pars_fragment:hZe,skinbase_vertex:dZe,skinning_pars_vertex:fZe,skinning_vertex:pZe,skinnormal_vertex:mZe,specularmap_fragment:gZe,specularmap_pars_fragment:yZe,tonemapping_fragment:AZe,tonemapping_pars_fragment:vZe,transmission_fragment:bZe,transmission_pars_fragment:xZe,uv_pars_fragment:wZe,uv_pars_vertex:CZe,uv_vertex:EZe,worldpos_vertex:_Ze,background_vert:IZe,background_frag:SZe,backgroundCube_vert:TZe,backgroundCube_frag:MZe,cube_vert:kZe,cube_frag:RZe,depth_vert:LZe,depth_frag:BZe,distanceRGBA_vert:PZe,distanceRGBA_frag:NZe,equirect_vert:DZe,equirect_frag:FZe,linedashed_vert:OZe,linedashed_frag:VZe,meshbasic_vert:UZe,meshbasic_frag:zZe,meshlambert_vert:GZe,meshlambert_frag:WZe,meshmatcap_vert:HZe,meshmatcap_frag:XZe,meshnormal_vert:$Ze,meshnormal_frag:QZe,meshphong_vert:KZe,meshphong_frag:ZZe,meshphysical_vert:jZe,meshphysical_frag:YZe,meshtoon_vert:qZe,meshtoon_frag:JZe,points_vert:e8e,points_frag:t8e,shadow_vert:n8e,shadow_frag:i8e,sprite_vert:r8e,sprite_frag:s8e},un={common:{diffuse:{value:new An(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new oi},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new oi}},envmap:{envMap:{value:null},envMapRotation:{value:new oi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new oi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new oi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new oi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new oi},normalScale:{value:new St(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new oi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new oi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new oi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new oi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new An(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new An(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0},uvTransform:{value:new oi}},sprite:{diffuse:{value:new An(16777215)},opacity:{value:1},center:{value:new St(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new oi},alphaMap:{value:null},alphaMapTransform:{value:new oi},alphaTest:{value:0}}},Yc={basic:{uniforms:va([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.fog]),vertexShader:fi.meshbasic_vert,fragmentShader:fi.meshbasic_frag},lambert:{uniforms:va([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new An(0)}}]),vertexShader:fi.meshlambert_vert,fragmentShader:fi.meshlambert_frag},phong:{uniforms:va([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new An(0)},specular:{value:new An(1118481)},shininess:{value:30}}]),vertexShader:fi.meshphong_vert,fragmentShader:fi.meshphong_frag},standard:{uniforms:va([un.common,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.roughnessmap,un.metalnessmap,un.fog,un.lights,{emissive:{value:new An(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:fi.meshphysical_vert,fragmentShader:fi.meshphysical_frag},toon:{uniforms:va([un.common,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.gradientmap,un.fog,un.lights,{emissive:{value:new An(0)}}]),vertexShader:fi.meshtoon_vert,fragmentShader:fi.meshtoon_frag},matcap:{uniforms:va([un.common,un.bumpmap,un.normalmap,un.displacementmap,un.fog,{matcap:{value:null}}]),vertexShader:fi.meshmatcap_vert,fragmentShader:fi.meshmatcap_frag},points:{uniforms:va([un.points,un.fog]),vertexShader:fi.points_vert,fragmentShader:fi.points_frag},dashed:{uniforms:va([un.common,un.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:fi.linedashed_vert,fragmentShader:fi.linedashed_frag},depth:{uniforms:va([un.common,un.displacementmap]),vertexShader:fi.depth_vert,fragmentShader:fi.depth_frag},normal:{uniforms:va([un.common,un.bumpmap,un.normalmap,un.displacementmap,{opacity:{value:1}}]),vertexShader:fi.meshnormal_vert,fragmentShader:fi.meshnormal_frag},sprite:{uniforms:va([un.sprite,un.fog]),vertexShader:fi.sprite_vert,fragmentShader:fi.sprite_frag},background:{uniforms:{uvTransform:{value:new oi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:fi.background_vert,fragmentShader:fi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new oi}},vertexShader:fi.backgroundCube_vert,fragmentShader:fi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:fi.cube_vert,fragmentShader:fi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:fi.equirect_vert,fragmentShader:fi.equirect_frag},distanceRGBA:{uniforms:va([un.common,un.displacementmap,{referencePosition:{value:new Ce},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:fi.distanceRGBA_vert,fragmentShader:fi.distanceRGBA_frag},shadow:{uniforms:va([un.lights,un.fog,{color:{value:new An(0)},opacity:{value:1}}]),vertexShader:fi.shadow_vert,fragmentShader:fi.shadow_frag}};Yc.physical={uniforms:va([Yc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new oi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new oi},clearcoatNormalScale:{value:new St(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new oi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new oi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new oi},sheen:{value:0},sheenColor:{value:new An(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new oi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new oi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new oi},transmissionSamplerSize:{value:new St},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new oi},attenuationDistance:{value:0},attenuationColor:{value:new An(0)},specularColor:{value:new An(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new oi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new oi},anisotropyVector:{value:new St},anisotropyMap:{value:null},anisotropyMapTransform:{value:new oi}}]),vertexShader:fi.meshphysical_vert,fragmentShader:fi.meshphysical_frag};const c_={r:0,b:0,g:0},eg=new Ll,o8e=new Zn;function a8e(n,e,t,i,s,l,u){const d=new An(0);let p=l===!0?0:1,g,x,b=null,E=0,S=null;function M(V){let G=V.isScene===!0?V.background:null;return G&&G.isTexture&&(G=(V.backgroundBlurriness>0?t:e).get(G)),G}function R(V){let G=!1;const q=M(V);q===null?k(d,p):q&&q.isColor&&(k(q,1),G=!0);const ne=n.xr.getEnvironmentBlendMode();ne==="additive"?i.buffers.color.setClear(0,0,0,1,u):ne==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,u),(n.autoClear||G)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function P(V,G){const q=M(G);q&&(q.isCubeTexture||q.mapping===JA)?(x===void 0&&(x=new Ms(new d0(1e4,1e4,1e4),new au({name:"BackgroundCubeMaterial",uniforms:UA(Yc.backgroundCube.uniforms),vertexShader:Yc.backgroundCube.vertexShader,fragmentShader:Yc.backgroundCube.fragmentShader,side:Ta,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(ne,K,Q){this.matrixWorld.copyPosition(Q.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(x)),eg.copy(G.backgroundRotation),eg.x*=-1,eg.y*=-1,eg.z*=-1,q.isCubeTexture&&q.isRenderTargetTexture===!1&&(eg.y*=-1,eg.z*=-1),x.material.uniforms.envMap.value=q,x.material.uniforms.flipEnvMap.value=q.isCubeTexture&&q.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=G.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,x.material.uniforms.backgroundRotation.value.setFromMatrix4(o8e.makeRotationFromEuler(eg)),x.material.toneMapped=Fi.getTransfer(q.colorSpace)!==tr,(b!==q||E!==q.version||S!==n.toneMapping)&&(x.material.needsUpdate=!0,b=q,E=q.version,S=n.toneMapping),x.layers.enableAll(),V.unshift(x,x.geometry,x.material,0,0,null)):q&&q.isTexture&&(g===void 0&&(g=new Ms(new iv(2,2),new au({name:"BackgroundMaterial",uniforms:UA(Yc.background.uniforms),vertexShader:Yc.background.vertexShader,fragmentShader:Yc.background.fragmentShader,side:Gd,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(g)),g.material.uniforms.t2D.value=q,g.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,g.material.toneMapped=Fi.getTransfer(q.colorSpace)!==tr,q.matrixAutoUpdate===!0&&q.updateMatrix(),g.material.uniforms.uvTransform.value.copy(q.matrix),(b!==q||E!==q.version||S!==n.toneMapping)&&(g.material.needsUpdate=!0,b=q,E=q.version,S=n.toneMapping),g.layers.enableAll(),V.unshift(g,g.geometry,g.material,0,0,null))}function k(V,G){V.getRGB(c_,kie(n)),i.buffers.color.setClear(c_.r,c_.g,c_.b,G,u)}function F(){x!==void 0&&(x.geometry.dispose(),x.material.dispose(),x=void 0),g!==void 0&&(g.geometry.dispose(),g.material.dispose(),g=void 0)}return{getClearColor:function(){return d},setClearColor:function(V,G=1){d.set(V),p=G,k(d,p)},getClearAlpha:function(){return p},setClearAlpha:function(V){p=V,k(d,p)},render:R,addToRenderList:P,dispose:F}}function l8e(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=E(null);let l=s,u=!1;function d(j,ee,de,oe,we){let $e=!1;const Me=b(oe,de,ee);l!==Me&&(l=Me,g(l.object)),$e=S(j,oe,de,we),$e&&M(j,oe,de,we),we!==null&&e.update(we,n.ELEMENT_ARRAY_BUFFER),($e||u)&&(u=!1,G(j,ee,de,oe),we!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(we).buffer))}function p(){return n.createVertexArray()}function g(j){return n.bindVertexArray(j)}function x(j){return n.deleteVertexArray(j)}function b(j,ee,de){const oe=de.wireframe===!0;let we=i[j.id];we===void 0&&(we={},i[j.id]=we);let $e=we[ee.id];$e===void 0&&($e={},we[ee.id]=$e);let Me=$e[oe];return Me===void 0&&(Me=E(p()),$e[oe]=Me),Me}function E(j){const ee=[],de=[],oe=[];for(let we=0;we<t;we++)ee[we]=0,de[we]=0,oe[we]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ee,enabledAttributes:de,attributeDivisors:oe,object:j,attributes:{},index:null}}function S(j,ee,de,oe){const we=l.attributes,$e=ee.attributes;let Me=0;const Ne=de.getAttributes();for(const Ae in Ne)if(Ne[Ae].location>=0){const Ie=we[Ae];let qe=$e[Ae];if(qe===void 0&&(Ae==="instanceMatrix"&&j.instanceMatrix&&(qe=j.instanceMatrix),Ae==="instanceColor"&&j.instanceColor&&(qe=j.instanceColor)),Ie===void 0||Ie.attribute!==qe||qe&&Ie.data!==qe.data)return!0;Me++}return l.attributesNum!==Me||l.index!==oe}function M(j,ee,de,oe){const we={},$e=ee.attributes;let Me=0;const Ne=de.getAttributes();for(const Ae in Ne)if(Ne[Ae].location>=0){let Ie=$e[Ae];Ie===void 0&&(Ae==="instanceMatrix"&&j.instanceMatrix&&(Ie=j.instanceMatrix),Ae==="instanceColor"&&j.instanceColor&&(Ie=j.instanceColor));const qe={};qe.attribute=Ie,Ie&&Ie.data&&(qe.data=Ie.data),we[Ae]=qe,Me++}l.attributes=we,l.attributesNum=Me,l.index=oe}function R(){const j=l.newAttributes;for(let ee=0,de=j.length;ee<de;ee++)j[ee]=0}function P(j){k(j,0)}function k(j,ee){const de=l.newAttributes,oe=l.enabledAttributes,we=l.attributeDivisors;de[j]=1,oe[j]===0&&(n.enableVertexAttribArray(j),oe[j]=1),we[j]!==ee&&(n.vertexAttribDivisor(j,ee),we[j]=ee)}function F(){const j=l.newAttributes,ee=l.enabledAttributes;for(let de=0,oe=ee.length;de<oe;de++)ee[de]!==j[de]&&(n.disableVertexAttribArray(de),ee[de]=0)}function V(j,ee,de,oe,we,$e,Me){Me===!0?n.vertexAttribIPointer(j,ee,de,we,$e):n.vertexAttribPointer(j,ee,de,oe,we,$e)}function G(j,ee,de,oe){R();const we=oe.attributes,$e=de.getAttributes(),Me=ee.defaultAttributeValues;for(const Ne in $e){const Ae=$e[Ne];if(Ae.location>=0){let Fe=we[Ne];if(Fe===void 0&&(Ne==="instanceMatrix"&&j.instanceMatrix&&(Fe=j.instanceMatrix),Ne==="instanceColor"&&j.instanceColor&&(Fe=j.instanceColor)),Fe!==void 0){const Ie=Fe.normalized,qe=Fe.itemSize,dt=e.get(Fe);if(dt===void 0)continue;const Wt=dt.buffer,xt=dt.type,At=dt.bytesPerElement,Rt=xt===n.INT||xt===n.UNSIGNED_INT||Fe.gpuType===CT;if(Fe.isInterleavedBufferAttribute){const Et=Fe.data,Ze=Et.stride,It=Fe.offset;if(Et.isInstancedInterleavedBuffer){for(let Lt=0;Lt<Ae.locationSize;Lt++)k(Ae.location+Lt,Et.meshPerAttribute);j.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=Et.meshPerAttribute*Et.count)}else for(let Lt=0;Lt<Ae.locationSize;Lt++)P(Ae.location+Lt);n.bindBuffer(n.ARRAY_BUFFER,Wt);for(let Lt=0;Lt<Ae.locationSize;Lt++)V(Ae.location+Lt,qe/Ae.locationSize,xt,Ie,Ze*At,(It+qe/Ae.locationSize*Lt)*At,Rt)}else{if(Fe.isInstancedBufferAttribute){for(let Et=0;Et<Ae.locationSize;Et++)k(Ae.location+Et,Fe.meshPerAttribute);j.isInstancedMesh!==!0&&oe._maxInstanceCount===void 0&&(oe._maxInstanceCount=Fe.meshPerAttribute*Fe.count)}else for(let Et=0;Et<Ae.locationSize;Et++)P(Ae.location+Et);n.bindBuffer(n.ARRAY_BUFFER,Wt);for(let Et=0;Et<Ae.locationSize;Et++)V(Ae.location+Et,qe/Ae.locationSize,xt,Ie,qe*At,qe/Ae.locationSize*Et*At,Rt)}}else if(Me!==void 0){const Ie=Me[Ne];if(Ie!==void 0)switch(Ie.length){case 2:n.vertexAttrib2fv(Ae.location,Ie);break;case 3:n.vertexAttrib3fv(Ae.location,Ie);break;case 4:n.vertexAttrib4fv(Ae.location,Ie);break;default:n.vertexAttrib1fv(Ae.location,Ie)}}}}F()}function q(){Q();for(const j in i){const ee=i[j];for(const de in ee){const oe=ee[de];for(const we in oe)x(oe[we].object),delete oe[we];delete ee[de]}delete i[j]}}function ne(j){if(i[j.id]===void 0)return;const ee=i[j.id];for(const de in ee){const oe=ee[de];for(const we in oe)x(oe[we].object),delete oe[we];delete ee[de]}delete i[j.id]}function K(j){for(const ee in i){const de=i[ee];if(de[j.id]===void 0)continue;const oe=de[j.id];for(const we in oe)x(oe[we].object),delete oe[we];delete de[j.id]}}function Q(){H(),u=!0,l!==s&&(l=s,g(l.object))}function H(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:d,reset:Q,resetDefaultState:H,dispose:q,releaseStatesOfGeometry:ne,releaseStatesOfProgram:K,initAttributes:R,enableAttribute:P,disableUnusedAttributes:F}}function c8e(n,e,t){let i;function s(g){i=g}function l(g,x){n.drawArrays(i,g,x),t.update(x,i,1)}function u(g,x,b){b!==0&&(n.drawArraysInstanced(i,g,x,b),t.update(x,i,b))}function d(g,x,b){if(b===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,g,0,x,0,b);let S=0;for(let M=0;M<b;M++)S+=x[M];t.update(S,i,1)}function p(g,x,b,E){if(b===0)return;const S=e.get("WEBGL_multi_draw");if(S===null)for(let M=0;M<g.length;M++)u(g[M],x[M],E[M]);else{S.multiDrawArraysInstancedWEBGL(i,g,0,x,0,E,0,b);let M=0;for(let R=0;R<b;R++)M+=x[R]*E[R];t.update(M,i,1)}}this.setMode=s,this.render=l,this.renderInstances=u,this.renderMultiDraw=d,this.renderMultiDrawInstances=p}function u8e(n,e,t,i){let s;function l(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const K=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(K.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function u(K){return!(K!==Ia&&i.convert(K)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function d(K){const Q=K===ev&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(K!==bh&&i.convert(K)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&K!==Ca&&!Q)}function p(K){if(K==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";K="mediump"}return K==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let g=t.precision!==void 0?t.precision:"highp";const x=p(g);x!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",x,"instead."),g=x);const b=t.logarithmicDepthBuffer===!0,E=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),S=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),M=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),R=n.getParameter(n.MAX_TEXTURE_SIZE),P=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),k=n.getParameter(n.MAX_VERTEX_ATTRIBS),F=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),V=n.getParameter(n.MAX_VARYING_VECTORS),G=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),q=M>0,ne=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:l,getMaxPrecision:p,textureFormatReadable:u,textureTypeReadable:d,precision:g,logarithmicDepthBuffer:b,reverseDepthBuffer:E,maxTextures:S,maxVertexTextures:M,maxTextureSize:R,maxCubemapSize:P,maxAttributes:k,maxVertexUniforms:F,maxVaryings:V,maxFragmentUniforms:G,vertexTextures:q,maxSamples:ne}}function h8e(n){const e=this;let t=null,i=0,s=!1,l=!1;const u=new Yf,d=new oi,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(b,E){const S=b.length!==0||E||i!==0||s;return s=E,i=b.length,S},this.beginShadows=function(){l=!0,x(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(b,E){t=x(b,E,0)},this.setState=function(b,E,S){const M=b.clippingPlanes,R=b.clipIntersection,P=b.clipShadows,k=n.get(b);if(!s||M===null||M.length===0||l&&!P)l?x(null):g();else{const F=l?0:i,V=F*4;let G=k.clippingState||null;p.value=G,G=x(M,E,V,S);for(let q=0;q!==V;++q)G[q]=t[q];k.clippingState=G,this.numIntersection=R?this.numPlanes:0,this.numPlanes+=F}};function g(){p.value!==t&&(p.value=t,p.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function x(b,E,S,M){const R=b!==null?b.length:0;let P=null;if(R!==0){if(P=p.value,M!==!0||P===null){const k=S+R*4,F=E.matrixWorldInverse;d.getNormalMatrix(F),(P===null||P.length<k)&&(P=new Float32Array(k));for(let V=0,G=S;V!==R;++V,G+=4)u.copy(b[V]).applyMatrix4(F,d),u.normal.toArray(P,G),P[G+3]=u.constant}p.value=P,p.needsUpdate=!0}return e.numPlanes=R,e.numIntersection=0,P}}function d8e(n){let e=new WeakMap;function t(u,d){return d===g1?u.mapping=Wd:d===y1&&(u.mapping=Wp),u}function i(u){if(u&&u.isTexture){const d=u.mapping;if(d===g1||d===y1)if(e.has(u)){const p=e.get(u).texture;return t(p,u.mapping)}else{const p=u.image;if(p&&p.height>0){const g=new Bie(p.height);return g.fromEquirectangularTexture(n,u),e.set(u,g),u.addEventListener("dispose",s),t(g.texture,u.mapping)}else return null}}return u}function s(u){const d=u.target;d.removeEventListener("dispose",s);const p=e.get(d);p!==void 0&&(e.delete(d),p.dispose())}function l(){e=new WeakMap}return{get:i,dispose:l}}const sA=4,SZ=[.125,.215,.35,.446,.526,.582],bg=20,eP=new JT,TZ=new An;let tP=null,nP=0,iP=0,rP=!1;const vg=(1+Math.sqrt(5))/2,Cy=1/vg,MZ=[new Ce(-vg,Cy,0),new Ce(vg,Cy,0),new Ce(-Cy,0,vg),new Ce(Cy,0,vg),new Ce(0,vg,-Cy),new Ce(0,vg,Cy),new Ce(-1,1,-1),new Ce(1,1,-1),new Ce(-1,1,1),new Ce(1,1,1)];class r3{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){tP=this._renderer.getRenderTarget(),nP=this._renderer.getActiveCubeFace(),iP=this._renderer.getActiveMipmapLevel(),rP=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,s,l),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LZ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=RZ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(tP,nP,iP),this._renderer.xr.enabled=rP,e.scissorTest=!1,u_(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Wd||e.mapping===Wp?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),tP=this._renderer.getRenderTarget(),nP=this._renderer.getActiveCubeFace(),iP=this._renderer.getActiveMipmapLevel(),rP=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ws,minFilter:Ws,generateMipmaps:!1,type:ev,format:Ia,colorSpace:Yg,depthBuffer:!1},s=kZ(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kZ(e,t,i);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=f8e(l)),this._blurMaterial=p8e(l,e,t)}return s}_compileMaterial(e){const t=new Ms(this._lodPlanes[0],e);this._renderer.compile(t,eP)}_sceneToCubeUV(e,t,i,s){const d=new Ao(90,1,t,i),p=[1,-1,1,1,1,1],g=[1,1,1,-1,-1,-1],x=this._renderer,b=x.autoClear,E=x.toneMapping;x.getClearColor(TZ),x.toneMapping=Td,x.autoClear=!1;const S=new Jp({name:"PMREM.Background",side:Ta,depthWrite:!1,depthTest:!1}),M=new Ms(new d0,S);let R=!1;const P=e.background;P?P.isColor&&(S.color.copy(P),e.background=null,R=!0):(S.color.copy(TZ),R=!0);for(let k=0;k<6;k++){const F=k%3;F===0?(d.up.set(0,p[k],0),d.lookAt(g[k],0,0)):F===1?(d.up.set(0,0,p[k]),d.lookAt(0,g[k],0)):(d.up.set(0,p[k],0),d.lookAt(0,0,g[k]));const V=this._cubeSize;u_(s,F*V,k>2?V:0,V,V),x.setRenderTarget(s),R&&x.render(M,d),x.render(e,d)}M.geometry.dispose(),M.material.dispose(),x.toneMapping=E,x.autoClear=b,e.background=P}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Wd||e.mapping===Wp;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=LZ()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=RZ());const l=s?this._cubemapMaterial:this._equirectMaterial,u=new Ms(this._lodPlanes[0],l),d=l.uniforms;d.envMap.value=e;const p=this._cubeSize;u_(t,0,0,3*p,2*p),i.setRenderTarget(t),i.render(u,eP)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let l=1;l<s;l++){const u=Math.sqrt(this._sigmas[l]*this._sigmas[l]-this._sigmas[l-1]*this._sigmas[l-1]),d=MZ[(s-l-1)%MZ.length];this._blur(e,l-1,l,u,d)}t.autoClear=i}_blur(e,t,i,s,l){const u=this._pingPongRenderTarget;this._halfBlur(e,u,t,i,s,"latitudinal",l),this._halfBlur(u,e,i,i,s,"longitudinal",l)}_halfBlur(e,t,i,s,l,u,d){const p=this._renderer,g=this._blurMaterial;u!=="latitudinal"&&u!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=3,b=new Ms(this._lodPlanes[s],g),E=g.uniforms,S=this._sizeLods[i]-1,M=isFinite(l)?Math.PI/(2*S):2*Math.PI/(2*bg-1),R=l/M,P=isFinite(l)?1+Math.floor(x*R):bg;P>bg&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${bg}`);const k=[];let F=0;for(let K=0;K<bg;++K){const Q=K/R,H=Math.exp(-Q*Q/2);k.push(H),K===0?F+=H:K<P&&(F+=2*H)}for(let K=0;K<k.length;K++)k[K]=k[K]/F;E.envMap.value=e.texture,E.samples.value=P,E.weights.value=k,E.latitudinal.value=u==="latitudinal",d&&(E.poleAxis.value=d);const{_lodMax:V}=this;E.dTheta.value=M,E.mipInt.value=V-i;const G=this._sizeLods[s],q=3*G*(s>V-sA?s-V+sA:0),ne=4*(this._cubeSize-G);u_(t,q,ne,3*G,2*G),p.setRenderTarget(t),p.render(b,eP)}}function f8e(n){const e=[],t=[],i=[];let s=n;const l=n-sA+1+SZ.length;for(let u=0;u<l;u++){const d=Math.pow(2,s);t.push(d);let p=1/d;u>n-sA?p=SZ[u-n+sA-1]:u===0&&(p=0),i.push(p);const g=1/(d-2),x=-g,b=1+g,E=[x,x,b,x,b,b,x,x,b,b,x,b],S=6,M=6,R=3,P=2,k=1,F=new Float32Array(R*M*S),V=new Float32Array(P*M*S),G=new Float32Array(k*M*S);for(let ne=0;ne<S;ne++){const K=ne%3*2/3-1,Q=ne>2?0:-1,H=[K,Q,0,K+2/3,Q,0,K+2/3,Q+1,0,K,Q,0,K+2/3,Q+1,0,K,Q+1,0];F.set(H,R*M*ne),V.set(E,P*M*ne);const j=[ne,ne,ne,ne,ne,ne];G.set(j,k*M*ne)}const q=new pi;q.setAttribute("position",new sr(F,R)),q.setAttribute("uv",new sr(V,P)),q.setAttribute("faceIndex",new sr(G,k)),e.push(q),s>sA&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function kZ(n,e,t){const i=new ou(n,e,t);return i.texture.mapping=JA,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function u_(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function p8e(n,e,t){const i=new Float32Array(bg),s=new Ce(0,1,0);return new au({name:"SphericalGaussianBlur",defines:{n:bg,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:FV(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Sd,depthTest:!1,depthWrite:!1})}function RZ(){return new au({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:FV(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Sd,depthTest:!1,depthWrite:!1})}function LZ(){return new au({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:FV(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Sd,depthTest:!1,depthWrite:!1})}function FV(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function m8e(n){let e=new WeakMap,t=null;function i(d){if(d&&d.isTexture){const p=d.mapping,g=p===g1||p===y1,x=p===Wd||p===Wp;if(g||x){let b=e.get(d);const E=b!==void 0?b.texture.pmremVersion:0;if(d.isRenderTargetTexture&&d.pmremVersion!==E)return t===null&&(t=new r3(n)),b=g?t.fromEquirectangular(d,b):t.fromCubemap(d,b),b.texture.pmremVersion=d.pmremVersion,e.set(d,b),b.texture;if(b!==void 0)return b.texture;{const S=d.image;return g&&S&&S.height>0||x&&S&&s(S)?(t===null&&(t=new r3(n)),b=g?t.fromEquirectangular(d):t.fromCubemap(d),b.texture.pmremVersion=d.pmremVersion,e.set(d,b),d.addEventListener("dispose",l),b.texture):null}}}return d}function s(d){let p=0;const g=6;for(let x=0;x<g;x++)d[x]!==void 0&&p++;return p===g}function l(d){const p=d.target;p.removeEventListener("dispose",l);const g=e.get(p);g!==void 0&&(e.delete(p),g.dispose())}function u(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:u}}function g8e(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const s=t(i);return s===null&&Dy("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function y8e(n,e,t,i){const s={},l=new WeakMap;function u(b){const E=b.target;E.index!==null&&e.remove(E.index);for(const M in E.attributes)e.remove(E.attributes[M]);E.removeEventListener("dispose",u),delete s[E.id];const S=l.get(E);S&&(e.remove(S),l.delete(E)),i.releaseStatesOfGeometry(E),E.isInstancedBufferGeometry===!0&&delete E._maxInstanceCount,t.memory.geometries--}function d(b,E){return s[E.id]===!0||(E.addEventListener("dispose",u),s[E.id]=!0,t.memory.geometries++),E}function p(b){const E=b.attributes;for(const S in E)e.update(E[S],n.ARRAY_BUFFER)}function g(b){const E=[],S=b.index,M=b.attributes.position;let R=0;if(S!==null){const F=S.array;R=S.version;for(let V=0,G=F.length;V<G;V+=3){const q=F[V+0],ne=F[V+1],K=F[V+2];E.push(q,ne,ne,K,K,q)}}else if(M!==void 0){const F=M.array;R=M.version;for(let V=0,G=F.length/3-1;V<G;V+=3){const q=V+0,ne=V+1,K=V+2;E.push(q,ne,ne,K,K,q)}}else return;const P=new(Iie(E)?fV:dV)(E,1);P.version=R;const k=l.get(b);k&&e.remove(k),l.set(b,P)}function x(b){const E=l.get(b);if(E){const S=b.index;S!==null&&E.version<S.version&&g(b)}else g(b);return l.get(b)}return{get:d,update:p,getWireframeAttribute:x}}function A8e(n,e,t){let i;function s(E){i=E}let l,u;function d(E){l=E.type,u=E.bytesPerElement}function p(E,S){n.drawElements(i,S,l,E*u),t.update(S,i,1)}function g(E,S,M){M!==0&&(n.drawElementsInstanced(i,S,l,E*u,M),t.update(S,i,M))}function x(E,S,M){if(M===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,S,0,l,E,0,M);let P=0;for(let k=0;k<M;k++)P+=S[k];t.update(P,i,1)}function b(E,S,M,R){if(M===0)return;const P=e.get("WEBGL_multi_draw");if(P===null)for(let k=0;k<E.length;k++)g(E[k]/u,S[k],R[k]);else{P.multiDrawElementsInstancedWEBGL(i,S,0,l,E,0,R,0,M);let k=0;for(let F=0;F<M;F++)k+=S[F]*R[F];t.update(k,i,1)}}this.setMode=s,this.setIndex=d,this.render=p,this.renderInstances=g,this.renderMultiDraw=x,this.renderMultiDrawInstances=b}function v8e(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(l,u,d){switch(t.calls++,u){case n.TRIANGLES:t.triangles+=d*(l/3);break;case n.LINES:t.lines+=d*(l/2);break;case n.LINE_STRIP:t.lines+=d*(l-1);break;case n.LINE_LOOP:t.lines+=d*l;break;case n.POINTS:t.points+=d*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",u);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function b8e(n,e,t){const i=new WeakMap,s=new Wi;function l(u,d,p){const g=u.morphTargetInfluences,x=d.morphAttributes.position||d.morphAttributes.normal||d.morphAttributes.color,b=x!==void 0?x.length:0;let E=i.get(d);if(E===void 0||E.count!==b){let j=function(){Q.dispose(),i.delete(d),d.removeEventListener("dispose",j)};var S=j;E!==void 0&&E.texture.dispose();const M=d.morphAttributes.position!==void 0,R=d.morphAttributes.normal!==void 0,P=d.morphAttributes.color!==void 0,k=d.morphAttributes.position||[],F=d.morphAttributes.normal||[],V=d.morphAttributes.color||[];let G=0;M===!0&&(G=1),R===!0&&(G=2),P===!0&&(G=3);let q=d.attributes.position.count*G,ne=1;q>e.maxTextureSize&&(ne=Math.ceil(q/e.maxTextureSize),q=e.maxTextureSize);const K=new Float32Array(q*ne*4*b),Q=new aw(K,q,ne,b);Q.type=Ca,Q.needsUpdate=!0;const H=G*4;for(let ee=0;ee<b;ee++){const de=k[ee],oe=F[ee],we=V[ee],$e=q*ne*4*ee;for(let Me=0;Me<de.count;Me++){const Ne=Me*H;M===!0&&(s.fromBufferAttribute(de,Me),K[$e+Ne+0]=s.x,K[$e+Ne+1]=s.y,K[$e+Ne+2]=s.z,K[$e+Ne+3]=0),R===!0&&(s.fromBufferAttribute(oe,Me),K[$e+Ne+4]=s.x,K[$e+Ne+5]=s.y,K[$e+Ne+6]=s.z,K[$e+Ne+7]=0),P===!0&&(s.fromBufferAttribute(we,Me),K[$e+Ne+8]=s.x,K[$e+Ne+9]=s.y,K[$e+Ne+10]=s.z,K[$e+Ne+11]=we.itemSize===4?s.w:1)}}E={count:b,texture:Q,size:new St(q,ne)},i.set(d,E),d.addEventListener("dispose",j)}if(u.isInstancedMesh===!0&&u.morphTexture!==null)p.getUniforms().setValue(n,"morphTexture",u.morphTexture,t);else{let M=0;for(let P=0;P<g.length;P++)M+=g[P];const R=d.morphTargetsRelative?1:1-M;p.getUniforms().setValue(n,"morphTargetBaseInfluence",R),p.getUniforms().setValue(n,"morphTargetInfluences",g)}p.getUniforms().setValue(n,"morphTargetsTexture",E.texture,t),p.getUniforms().setValue(n,"morphTargetsTextureSize",E.size)}return{update:l}}class x8e{constructor(e,t,i){if(this.renderer=e,this.DEFAULT_NUMVIEWS=2,this.maxNumViews=0,this.gl=i,this.extensions=t,this.available=this.extensions.has("OCULUS_multiview"),this.available){const l=this.extensions.get("OCULUS_multiview");this.maxNumViews=this.gl.getParameter(l.MAX_VIEWS_OVR),this.mat4=[],this.mat3=[],this.cameraArray=[];for(var s=0;s<this.maxNumViews;s++)this.mat4[s]=new Zn,this.mat3[s]=new oi}}getCameraArray(e){return e.isArrayCamera?e.cameras:(this.cameraArray[0]=e,this.cameraArray)}updateCameraProjectionMatricesUniform(e,t){for(var i=this.getCameraArray(e),s=0;s<i.length;s++)this.mat4[s].copy(i[s].projectionMatrix);t.setValue(this.gl,"projectionMatrices",this.mat4)}updateCameraViewMatricesUniform(e,t){for(var i=this.getCameraArray(e),s=0;s<i.length;s++)this.mat4[s].copy(i[s].matrixWorldInverse);t.setValue(this.gl,"viewMatrices",this.mat4)}updateObjectMatricesUniforms(e,t,i){for(var s=this.getCameraArray(t),l=0;l<s.length;l++)this.mat4[l].multiplyMatrices(s[l].matrixWorldInverse,e.matrixWorld),this.mat3[l].getNormalMatrix(this.mat4[l]);i.setValue(this.gl,"modelViewMatrices",this.mat4),i.setValue(this.gl,"normalMatrices",this.mat3)}}function w8e(n,e,t,i){let s=new WeakMap;function l(p){const g=i.render.frame,x=p.geometry,b=e.get(p,x);if(s.get(b)!==g&&(e.update(b),s.set(b,g)),p.isInstancedMesh&&(p.hasEventListener("dispose",d)===!1&&p.addEventListener("dispose",d),s.get(p)!==g&&(t.update(p.instanceMatrix,n.ARRAY_BUFFER),p.instanceColor!==null&&t.update(p.instanceColor,n.ARRAY_BUFFER),s.set(p,g))),p.isSkinnedMesh){const E=p.skeleton;s.get(E)!==g&&(E.update(),s.set(E,g))}return b}function u(){s=new WeakMap}function d(p){const g=p.target;g.removeEventListener("dispose",d),t.remove(g.instanceMatrix),g.instanceColor!==null&&t.remove(g.instanceColor)}return{update:l,dispose:u}}const Lre=new Yr,BZ=new yV(1,1),Bre=new aw,Pre=new RT,Nre=new lw,PZ=[],NZ=[],DZ=new Float32Array(16),FZ=new Float32Array(9),OZ=new Float32Array(4);function rv(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let l=PZ[s];if(l===void 0&&(l=new Float32Array(s),PZ[s]=l),e!==0){i.toArray(l,0);for(let u=1,d=0;u!==e;++u)d+=t,n[u].toArray(l,d)}return l}function Xs(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function $s(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function tM(n,e){let t=NZ[e];t===void 0&&(t=new Int32Array(e),NZ[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function C8e(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function E8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Xs(t,e))return;n.uniform2fv(this.addr,e),$s(t,e)}}function _8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Xs(t,e))return;n.uniform3fv(this.addr,e),$s(t,e)}}function I8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Xs(t,e))return;n.uniform4fv(this.addr,e),$s(t,e)}}function S8e(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Xs(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),$s(t,e)}else{if(Xs(t,i))return;OZ.set(i),n.uniformMatrix2fv(this.addr,!1,OZ),$s(t,i)}}function T8e(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Xs(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),$s(t,e)}else{if(Xs(t,i))return;FZ.set(i),n.uniformMatrix3fv(this.addr,!1,FZ),$s(t,i)}}function M8e(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Xs(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),$s(t,e)}else{if(Xs(t,i))return;DZ.set(i),n.uniformMatrix4fv(this.addr,!1,DZ),$s(t,i)}}function k8e(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function R8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Xs(t,e))return;n.uniform2iv(this.addr,e),$s(t,e)}}function L8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Xs(t,e))return;n.uniform3iv(this.addr,e),$s(t,e)}}function B8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Xs(t,e))return;n.uniform4iv(this.addr,e),$s(t,e)}}function P8e(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function N8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Xs(t,e))return;n.uniform2uiv(this.addr,e),$s(t,e)}}function D8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Xs(t,e))return;n.uniform3uiv(this.addr,e),$s(t,e)}}function F8e(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Xs(t,e))return;n.uniform4uiv(this.addr,e),$s(t,e)}}function O8e(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let l;this.type===n.SAMPLER_2D_SHADOW?(BZ.compareFunction=uV,l=BZ):l=Lre,t.setTexture2D(e||l,s)}function V8e(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||Pre,s)}function U8e(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||Nre,s)}function z8e(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||Bre,s)}function G8e(n){switch(n){case 5126:return C8e;case 35664:return E8e;case 35665:return _8e;case 35666:return I8e;case 35674:return S8e;case 35675:return T8e;case 35676:return M8e;case 5124:case 35670:return k8e;case 35667:case 35671:return R8e;case 35668:case 35672:return L8e;case 35669:case 35673:return B8e;case 5125:return P8e;case 36294:return N8e;case 36295:return D8e;case 36296:return F8e;case 35678:case 36198:case 36298:case 36306:case 35682:return O8e;case 35679:case 36299:case 36307:return V8e;case 35680:case 36300:case 36308:case 36293:return U8e;case 36289:case 36303:case 36311:case 36292:return z8e}}function W8e(n,e){n.uniform1fv(this.addr,e)}function H8e(n,e){const t=rv(e,this.size,2);n.uniform2fv(this.addr,t)}function X8e(n,e){const t=rv(e,this.size,3);n.uniform3fv(this.addr,t)}function $8e(n,e){const t=rv(e,this.size,4);n.uniform4fv(this.addr,t)}function Q8e(n,e){const t=rv(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function K8e(n,e){const t=rv(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Z8e(n,e){const t=rv(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function j8e(n,e){n.uniform1iv(this.addr,e)}function Y8e(n,e){n.uniform2iv(this.addr,e)}function q8e(n,e){n.uniform3iv(this.addr,e)}function J8e(n,e){n.uniform4iv(this.addr,e)}function eje(n,e){n.uniform1uiv(this.addr,e)}function tje(n,e){n.uniform2uiv(this.addr,e)}function nje(n,e){n.uniform3uiv(this.addr,e)}function ije(n,e){n.uniform4uiv(this.addr,e)}function rje(n,e,t){const i=this.cache,s=e.length,l=tM(t,s);Xs(i,l)||(n.uniform1iv(this.addr,l),$s(i,l));for(let u=0;u!==s;++u)t.setTexture2D(e[u]||Lre,l[u])}function sje(n,e,t){const i=this.cache,s=e.length,l=tM(t,s);Xs(i,l)||(n.uniform1iv(this.addr,l),$s(i,l));for(let u=0;u!==s;++u)t.setTexture3D(e[u]||Pre,l[u])}function oje(n,e,t){const i=this.cache,s=e.length,l=tM(t,s);Xs(i,l)||(n.uniform1iv(this.addr,l),$s(i,l));for(let u=0;u!==s;++u)t.setTextureCube(e[u]||Nre,l[u])}function aje(n,e,t){const i=this.cache,s=e.length,l=tM(t,s);Xs(i,l)||(n.uniform1iv(this.addr,l),$s(i,l));for(let u=0;u!==s;++u)t.setTexture2DArray(e[u]||Bre,l[u])}function lje(n){switch(n){case 5126:return W8e;case 35664:return H8e;case 35665:return X8e;case 35666:return $8e;case 35674:return Q8e;case 35675:return K8e;case 35676:return Z8e;case 5124:case 35670:return j8e;case 35667:case 35671:return Y8e;case 35668:case 35672:return q8e;case 35669:case 35673:return J8e;case 5125:return eje;case 36294:return tje;case 36295:return nje;case 36296:return ije;case 35678:case 36198:case 36298:case 36306:case 35682:return rje;case 35679:case 36299:case 36307:return sje;case 35680:case 36300:case 36308:case 36293:return oje;case 36289:case 36303:case 36311:case 36292:return aje}}class cje{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=G8e(t.type)}}class uje{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=lje(t.type)}}class hje{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let l=0,u=s.length;l!==u;++l){const d=s[l];d.setValue(e,t[d.id],i)}}}const sP=/(\w+)(\])?(\[|\.)?/g;function VZ(n,e){n.seq.push(e),n.map[e.id]=e}function dje(n,e,t){const i=n.name,s=i.length;for(sP.lastIndex=0;;){const l=sP.exec(i),u=sP.lastIndex;let d=l[1];const p=l[2]==="]",g=l[3];if(p&&(d=d|0),g===void 0||g==="["&&u+2===s){VZ(t,g===void 0?new cje(d,n,e):new uje(d,n,e));break}else{let b=t.map[d];b===void 0&&(b=new hje(d),VZ(t,b)),t=b}}}class dI{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const l=e.getActiveUniform(t,s),u=e.getUniformLocation(t,l.name);dje(l,u,this)}}setValue(e,t,i,s){const l=this.map[t];l!==void 0&&l.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let l=0,u=t.length;l!==u;++l){const d=t[l],p=i[d.id];p.needsUpdate!==!1&&d.setValue(e,p.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,l=e.length;s!==l;++s){const u=e[s];u.id in t&&i.push(u)}return i}}function UZ(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const fje=37297;let pje=0;function mje(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),l=Math.min(e+6,t.length);for(let u=s;u<l;u++){const d=u+1;i.push(`${d===e?">":" "} ${d}: ${t[u]}`)}return i.join(`
`)}const zZ=new oi;function gje(n){Fi._getMatrix(zZ,Fi.workingColorSpace,n);const e=`mat3( ${zZ.elements.map(t=>t.toFixed(4))} )`;switch(Fi.getTransfer(n)){case w1:return[e,"LinearTransferOETF"];case tr:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function GZ(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const l=/ERROR: 0:(\d+)/.exec(s);if(l){const u=parseInt(l[1]);return t.toUpperCase()+`

`+s+`

`+mje(n.getShaderSource(e),u)}else return s}function yje(n,e){const t=gje(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function Aje(n,e){let t;switch(e){case sie:t="Linear";break;case oie:t="Reinhard";break;case aie:t="Cineon";break;case lie:t="ACESFilmic";break;case uie:t="AgX";break;case hie:t="Neutral";break;case cie:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const h_=new Ce;function vje(){Fi.getLuminanceCoefficients(h_);const n=h_.x.toFixed(4),e=h_.y.toFixed(4),t=h_.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function bje(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(rx).join(`
`)}function xje(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function wje(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const l=n.getActiveAttrib(e,s),u=l.name;let d=1;l.type===n.FLOAT_MAT2&&(d=2),l.type===n.FLOAT_MAT3&&(d=3),l.type===n.FLOAT_MAT4&&(d=4),t[u]={type:l.type,location:n.getAttribLocation(e,u),locationSize:d}}return t}function rx(n){return n!==""}function WZ(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function HZ(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Cje=/^[ \t]*#include +<([\w\d./]+)>/gm;function s3(n){return n.replace(Cje,_je)}const Eje=new Map;function _je(n,e){let t=fi[e];if(t===void 0){const i=Eje.get(e);if(i!==void 0)t=fi[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return s3(t)}const Ije=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function XZ(n){return n.replace(Ije,Sje)}function Sje(n,e,t,i){let s="";for(let l=parseInt(e);l<parseInt(t);l++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return s}function $Z(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Tje(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===qO?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===One?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Yu&&(e="SHADOWMAP_TYPE_VSM"),e}function Mje(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Wd:case Wp:e="ENVMAP_TYPE_CUBE";break;case JA:e="ENVMAP_TYPE_CUBE_UV";break}return e}function kje(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Wp:e="ENVMAP_MODE_REFRACTION";break}return e}function Rje(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case sw:e="ENVMAP_BLENDING_MULTIPLY";break;case iie:e="ENVMAP_BLENDING_MIX";break;case rie:e="ENVMAP_BLENDING_ADD";break}return e}function Lje(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function Bje(n,e,t,i){const s=n.getContext(),l=t.defines;let u=t.vertexShader,d=t.fragmentShader;const p=Tje(t),g=Mje(t),x=kje(t),b=Rje(t),E=Lje(t),S=bje(t),M=xje(l),R=s.createProgram();let P,k,F=t.glslVersion?"#version "+t.glslVersion+`
`:"";const V=t.numMultiviewViews;t.isRawShaderMaterial?(P=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,M].filter(rx).join(`
`),P.length>0&&(P+=`
`),k=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,M].filter(rx).join(`
`),k.length>0&&(k+=`
`)):(P=[$Z(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,M,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+x:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(rx).join(`
`),k=[$Z(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,M,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.envMap?"#define "+x:"",t.envMap?"#define "+b:"",E?"#define CUBEUV_TEXEL_WIDTH "+E.texelWidth:"",E?"#define CUBEUV_TEXEL_HEIGHT "+E.texelHeight:"",E?"#define CUBEUV_MAX_MIP "+E.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Td?"#define TONE_MAPPING":"",t.toneMapping!==Td?fi.tonemapping_pars_fragment:"",t.toneMapping!==Td?Aje("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",fi.colorspace_pars_fragment,yje("linearToOutputTexel",t.outputColorSpace),vje(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(rx).join(`
`)),u=s3(u),u=WZ(u,t),u=HZ(u,t),d=s3(d),d=WZ(d,t),d=HZ(d,t),u=XZ(u),d=XZ(d),t.isRawShaderMaterial!==!0&&(F=`#version 300 es
`,P=[S,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,k=["#define varying in",t.glslVersion===jD?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===jD?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+k,V>0&&(P=["#extension GL_OVR_multiview : require","layout(num_views = "+V+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+P,P=P.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+V+"];","uniform mat4 projectionMatrices["+V+"];","uniform mat4 viewMatrices["+V+"];","uniform mat3 normalMatrices["+V+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),k=["#extension GL_OVR_multiview : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)+`
`+k,k=k.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+V+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`))));const G=F+P+u,q=F+k+d,ne=UZ(s,s.VERTEX_SHADER,G),K=UZ(s,s.FRAGMENT_SHADER,q);s.attachShader(R,ne),s.attachShader(R,K),t.index0AttributeName!==void 0?s.bindAttribLocation(R,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(R,0,"position"),s.linkProgram(R);function Q(de){if(n.debug.checkShaderErrors){const oe=s.getProgramInfoLog(R).trim(),we=s.getShaderInfoLog(ne).trim(),$e=s.getShaderInfoLog(K).trim();let Me=!0,Ne=!0;if(s.getProgramParameter(R,s.LINK_STATUS)===!1)if(Me=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,R,ne,K);else{const Ae=GZ(s,ne,"vertex"),Fe=GZ(s,K,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(R,s.VALIDATE_STATUS)+`

Material Name: `+de.name+`
Material Type: `+de.type+`

Program Info Log: `+oe+`
`+Ae+`
`+Fe)}else oe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",oe):(we===""||$e==="")&&(Ne=!1);Ne&&(de.diagnostics={runnable:Me,programLog:oe,vertexShader:{log:we,prefix:P},fragmentShader:{log:$e,prefix:k}})}s.deleteShader(ne),s.deleteShader(K),H=new dI(s,R),j=wje(s,R)}let H;this.getUniforms=function(){return H===void 0&&Q(this),H};let j;this.getAttributes=function(){return j===void 0&&Q(this),j};let ee=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ee===!1&&(ee=s.getProgramParameter(R,fje)),ee},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(R),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=pje++,this.cacheKey=e,this.usedTimes=1,this.program=R,this.vertexShader=ne,this.fragmentShader=K,this.numMultiviewViews=V,this}let Pje=0;class Nje{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),l=this._getShaderStage(i),u=this._getShaderCacheForMaterial(e);return u.has(s)===!1&&(u.add(s),s.usedTimes++),u.has(l)===!1&&(u.add(l),l.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new Dje(e),t.set(e,i)),i}}class Dje{constructor(e){this.id=Pje++,this.code=e,this.usedTimes=0}}function Fje(n,e,t,i,s,l,u){const d=new LT,p=new Nje,g=new Set,x=[],b=s.logarithmicDepthBuffer,E=s.vertexTextures;let S=s.precision;const M={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function R(H){return g.add(H),H===0?"uv":`uv${H}`}function P(H,j,ee,de,oe){const we=de.fog,$e=oe.geometry,Me=H.isMeshStandardMaterial?de.environment:null,Ne=(H.isMeshStandardMaterial?t:e).get(H.envMap||Me),Ae=Ne&&Ne.mapping===JA?Ne.image.height:null,Fe=M[H.type];H.precision!==null&&(S=s.getMaxPrecision(H.precision),S!==H.precision&&console.warn("THREE.WebGLProgram.getParameters:",H.precision,"not supported, using",S,"instead."));const Ie=$e.morphAttributes.position||$e.morphAttributes.normal||$e.morphAttributes.color,qe=Ie!==void 0?Ie.length:0;let dt=0;$e.morphAttributes.position!==void 0&&(dt=1),$e.morphAttributes.normal!==void 0&&(dt=2),$e.morphAttributes.color!==void 0&&(dt=3);let Wt,xt,At,Rt;if(Fe){const ei=Yc[Fe];Wt=ei.vertexShader,xt=ei.fragmentShader}else Wt=H.vertexShader,xt=H.fragmentShader,p.update(H),At=p.getVertexShaderID(H),Rt=p.getFragmentShaderID(H);const Et=n.getRenderTarget(),Ze=n.state.buffers.depth.getReversed(),It=Et&&Et.isWebGLMultiviewRenderTarget?Et.numViews:0,Lt=oe.isInstancedMesh===!0,Yt=oe.isBatchedMesh===!0,ht=!!H.map,yt=!!H.matcap,wt=!!Ne,Ee=!!H.aoMap,Te=!!H.lightMap,Gt=!!H.bumpMap,Y=!!H.normalMap,te=!!H.displacementMap,ce=!!H.emissiveMap,xe=!!H.metalnessMap,Re=!!H.roughnessMap,We=H.anisotropy>0,at=H.clearcoat>0,ln=H.dispersion>0,ve=H.iridescence>0,ue=H.sheen>0,Oe=H.transmission>0,ut=We&&!!H.anisotropyMap,vt=at&&!!H.clearcoatMap,pt=at&&!!H.clearcoatNormalMap,cn=at&&!!H.clearcoatRoughnessMap,Tt=ve&&!!H.iridescenceMap,Zt=ve&&!!H.iridescenceThicknessMap,kn=ue&&!!H.sheenColorMap,Ft=ue&&!!H.sheenRoughnessMap,vn=!!H.specularMap,jn=!!H.specularColorMap,Pe=!!H.specularIntensityMap,ft=Oe&&!!H.transmissionMap,Pt=Oe&&!!H.thicknessMap,Dt=!!H.gradientMap,qt=!!H.alphaMap,sn=H.alphaTest>0,Rn=!!H.alphaHash,tn=!!H.extensions;let Jt=Td;H.toneMapped&&(Et===null||Et.isXRRenderTarget===!0)&&(Jt=n.toneMapping);const fn={shaderID:Fe,shaderType:H.type,shaderName:H.name,vertexShader:Wt,fragmentShader:xt,defines:H.defines,customVertexShaderID:At,customFragmentShaderID:Rt,isRawShaderMaterial:H.isRawShaderMaterial===!0,glslVersion:H.glslVersion,precision:S,batching:Yt,batchingColor:Yt&&oe._colorsTexture!==null,instancing:Lt,instancingColor:Lt&&oe.instanceColor!==null,instancingMorph:Lt&&oe.morphTexture!==null,supportsVertexTextures:E,numMultiviewViews:It,outputColorSpace:Et===null?n.outputColorSpace:Et.isXRRenderTarget===!0?Et.texture.colorSpace:Yg,alphaToCoverage:!!H.alphaToCoverage,map:ht,matcap:yt,envMap:wt,envMapMode:wt&&Ne.mapping,envMapCubeUVHeight:Ae,aoMap:Ee,lightMap:Te,bumpMap:Gt,normalMap:Y,displacementMap:E&&te,emissiveMap:ce,normalMapObjectSpace:Y&&H.normalMapType===Aie,normalMapTangentSpace:Y&&H.normalMapType===qp,metalnessMap:xe,roughnessMap:Re,anisotropy:We,anisotropyMap:ut,clearcoat:at,clearcoatMap:vt,clearcoatNormalMap:pt,clearcoatRoughnessMap:cn,dispersion:ln,iridescence:ve,iridescenceMap:Tt,iridescenceThicknessMap:Zt,sheen:ue,sheenColorMap:kn,sheenRoughnessMap:Ft,specularMap:vn,specularColorMap:jn,specularIntensityMap:Pe,transmission:Oe,transmissionMap:ft,thicknessMap:Pt,gradientMap:Dt,opaque:H.transparent===!1&&H.blending===Ng&&H.alphaToCoverage===!1,alphaMap:qt,alphaTest:sn,alphaHash:Rn,combine:H.combine,mapUv:ht&&R(H.map.channel),aoMapUv:Ee&&R(H.aoMap.channel),lightMapUv:Te&&R(H.lightMap.channel),bumpMapUv:Gt&&R(H.bumpMap.channel),normalMapUv:Y&&R(H.normalMap.channel),displacementMapUv:te&&R(H.displacementMap.channel),emissiveMapUv:ce&&R(H.emissiveMap.channel),metalnessMapUv:xe&&R(H.metalnessMap.channel),roughnessMapUv:Re&&R(H.roughnessMap.channel),anisotropyMapUv:ut&&R(H.anisotropyMap.channel),clearcoatMapUv:vt&&R(H.clearcoatMap.channel),clearcoatNormalMapUv:pt&&R(H.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:cn&&R(H.clearcoatRoughnessMap.channel),iridescenceMapUv:Tt&&R(H.iridescenceMap.channel),iridescenceThicknessMapUv:Zt&&R(H.iridescenceThicknessMap.channel),sheenColorMapUv:kn&&R(H.sheenColorMap.channel),sheenRoughnessMapUv:Ft&&R(H.sheenRoughnessMap.channel),specularMapUv:vn&&R(H.specularMap.channel),specularColorMapUv:jn&&R(H.specularColorMap.channel),specularIntensityMapUv:Pe&&R(H.specularIntensityMap.channel),transmissionMapUv:ft&&R(H.transmissionMap.channel),thicknessMapUv:Pt&&R(H.thicknessMap.channel),alphaMapUv:qt&&R(H.alphaMap.channel),vertexTangents:!!$e.attributes.tangent&&(Y||We),vertexColors:H.vertexColors,vertexAlphas:H.vertexColors===!0&&!!$e.attributes.color&&$e.attributes.color.itemSize===4,pointsUvs:oe.isPoints===!0&&!!$e.attributes.uv&&(ht||qt),fog:!!we,useFog:H.fog===!0,fogExp2:!!we&&we.isFogExp2,flatShading:H.flatShading===!0,sizeAttenuation:H.sizeAttenuation===!0,logarithmicDepthBuffer:b,reverseDepthBuffer:Ze,skinning:oe.isSkinnedMesh===!0,morphTargets:$e.morphAttributes.position!==void 0,morphNormals:$e.morphAttributes.normal!==void 0,morphColors:$e.morphAttributes.color!==void 0,morphTargetsCount:qe,morphTextureStride:dt,numDirLights:j.directional.length,numPointLights:j.point.length,numSpotLights:j.spot.length,numSpotLightMaps:j.spotLightMap.length,numRectAreaLights:j.rectArea.length,numHemiLights:j.hemi.length,numDirLightShadows:j.directionalShadowMap.length,numPointLightShadows:j.pointShadowMap.length,numSpotLightShadows:j.spotShadowMap.length,numSpotLightShadowsWithMaps:j.numSpotLightShadowsWithMaps,numLightProbes:j.numLightProbes,numClippingPlanes:u.numPlanes,numClipIntersection:u.numIntersection,dithering:H.dithering,shadowMapEnabled:n.shadowMap.enabled&&ee.length>0,shadowMapType:n.shadowMap.type,toneMapping:Jt,decodeVideoTexture:ht&&H.map.isVideoTexture===!0&&Fi.getTransfer(H.map.colorSpace)===tr,decodeVideoTextureEmissive:ce&&H.emissiveMap.isVideoTexture===!0&&Fi.getTransfer(H.emissiveMap.colorSpace)===tr,premultipliedAlpha:H.premultipliedAlpha,doubleSided:H.side===nh,flipSided:H.side===Ta,useDepthPacking:H.depthPacking>=0,depthPacking:H.depthPacking||0,index0AttributeName:H.index0AttributeName,extensionClipCullDistance:tn&&H.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(tn&&H.extensions.multiDraw===!0||Yt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:H.customProgramCacheKey()};return fn.vertexUv1s=g.has(1),fn.vertexUv2s=g.has(2),fn.vertexUv3s=g.has(3),g.clear(),fn}function k(H){const j=[];if(H.shaderID?j.push(H.shaderID):(j.push(H.customVertexShaderID),j.push(H.customFragmentShaderID)),H.defines!==void 0)for(const ee in H.defines)j.push(ee),j.push(H.defines[ee]);return H.isRawShaderMaterial===!1&&(F(j,H),V(j,H),j.push(n.outputColorSpace)),j.push(H.customProgramCacheKey),j.join()}function F(H,j){H.push(j.precision),H.push(j.outputColorSpace),H.push(j.envMapMode),H.push(j.envMapCubeUVHeight),H.push(j.mapUv),H.push(j.alphaMapUv),H.push(j.lightMapUv),H.push(j.aoMapUv),H.push(j.bumpMapUv),H.push(j.normalMapUv),H.push(j.displacementMapUv),H.push(j.emissiveMapUv),H.push(j.metalnessMapUv),H.push(j.roughnessMapUv),H.push(j.anisotropyMapUv),H.push(j.clearcoatMapUv),H.push(j.clearcoatNormalMapUv),H.push(j.clearcoatRoughnessMapUv),H.push(j.iridescenceMapUv),H.push(j.iridescenceThicknessMapUv),H.push(j.sheenColorMapUv),H.push(j.sheenRoughnessMapUv),H.push(j.specularMapUv),H.push(j.specularColorMapUv),H.push(j.specularIntensityMapUv),H.push(j.transmissionMapUv),H.push(j.thicknessMapUv),H.push(j.combine),H.push(j.fogExp2),H.push(j.sizeAttenuation),H.push(j.morphTargetsCount),H.push(j.morphAttributeCount),H.push(j.numDirLights),H.push(j.numPointLights),H.push(j.numSpotLights),H.push(j.numSpotLightMaps),H.push(j.numHemiLights),H.push(j.numRectAreaLights),H.push(j.numDirLightShadows),H.push(j.numPointLightShadows),H.push(j.numSpotLightShadows),H.push(j.numSpotLightShadowsWithMaps),H.push(j.numLightProbes),H.push(j.shadowMapType),H.push(j.toneMapping),H.push(j.numClippingPlanes),H.push(j.numClipIntersection),H.push(j.depthPacking)}function V(H,j){d.disableAll(),j.supportsVertexTextures&&d.enable(0),j.instancing&&d.enable(1),j.instancingColor&&d.enable(2),j.instancingMorph&&d.enable(3),j.matcap&&d.enable(4),j.envMap&&d.enable(5),j.normalMapObjectSpace&&d.enable(6),j.normalMapTangentSpace&&d.enable(7),j.clearcoat&&d.enable(8),j.iridescence&&d.enable(9),j.alphaTest&&d.enable(10),j.vertexColors&&d.enable(11),j.vertexAlphas&&d.enable(12),j.vertexUv1s&&d.enable(13),j.vertexUv2s&&d.enable(14),j.vertexUv3s&&d.enable(15),j.vertexTangents&&d.enable(16),j.anisotropy&&d.enable(17),j.alphaHash&&d.enable(18),j.batching&&d.enable(19),j.dispersion&&d.enable(20),j.batchingColor&&d.enable(21),H.push(d.mask),d.disableAll(),j.fog&&d.enable(0),j.useFog&&d.enable(1),j.flatShading&&d.enable(2),j.logarithmicDepthBuffer&&d.enable(3),j.reverseDepthBuffer&&d.enable(4),j.skinning&&d.enable(5),j.morphTargets&&d.enable(6),j.morphNormals&&d.enable(7),j.morphColors&&d.enable(8),j.premultipliedAlpha&&d.enable(9),j.shadowMapEnabled&&d.enable(10),j.doubleSided&&d.enable(11),j.flipSided&&d.enable(12),j.useDepthPacking&&d.enable(13),j.dithering&&d.enable(14),j.transmission&&d.enable(15),j.sheen&&d.enable(16),j.opaque&&d.enable(17),j.pointsUvs&&d.enable(18),j.decodeVideoTexture&&d.enable(19),j.decodeVideoTextureEmissive&&d.enable(20),j.alphaToCoverage&&d.enable(21),j.numMultiviewViews&&d.enable(21),H.push(d.mask)}function G(H){const j=M[H.type];let ee;if(j){const de=Yc[j];ee=Rie.clone(de.uniforms)}else ee=H.uniforms;return ee}function q(H,j){let ee;for(let de=0,oe=x.length;de<oe;de++){const we=x[de];if(we.cacheKey===j){ee=we,++ee.usedTimes;break}}return ee===void 0&&(ee=new Bje(n,j,H,l),x.push(ee)),ee}function ne(H){if(--H.usedTimes===0){const j=x.indexOf(H);x[j]=x[x.length-1],x.pop(),H.destroy()}}function K(H){p.remove(H)}function Q(){p.dispose()}return{getParameters:P,getProgramCacheKey:k,getUniforms:G,acquireProgram:q,releaseProgram:ne,releaseShaderCache:K,programs:x,dispose:Q}}function Oje(){let n=new WeakMap;function e(u){return n.has(u)}function t(u){let d=n.get(u);return d===void 0&&(d={},n.set(u,d)),d}function i(u){n.delete(u)}function s(u,d,p){n.get(u)[d]=p}function l(){n=new WeakMap}return{has:e,get:t,remove:i,update:s,dispose:l}}function Vje(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function QZ(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function KZ(){const n=[];let e=0;const t=[],i=[],s=[];function l(){e=0,t.length=0,i.length=0,s.length=0}function u(b,E,S,M,R,P){let k=n[e];return k===void 0?(k={id:b.id,object:b,geometry:E,material:S,groupOrder:M,renderOrder:b.renderOrder,z:R,group:P},n[e]=k):(k.id=b.id,k.object=b,k.geometry=E,k.material=S,k.groupOrder=M,k.renderOrder=b.renderOrder,k.z=R,k.group=P),e++,k}function d(b,E,S,M,R,P){const k=u(b,E,S,M,R,P);S.transmission>0?i.push(k):S.transparent===!0?s.push(k):t.push(k)}function p(b,E,S,M,R,P){const k=u(b,E,S,M,R,P);S.transmission>0?i.unshift(k):S.transparent===!0?s.unshift(k):t.unshift(k)}function g(b,E){t.length>1&&t.sort(b||Vje),i.length>1&&i.sort(E||QZ),s.length>1&&s.sort(E||QZ)}function x(){for(let b=e,E=n.length;b<E;b++){const S=n[b];if(S.id===null)break;S.id=null,S.object=null,S.geometry=null,S.material=null,S.group=null}}return{opaque:t,transmissive:i,transparent:s,init:l,push:d,unshift:p,finish:x,sort:g}}function Uje(){let n=new WeakMap;function e(i,s){const l=n.get(i);let u;return l===void 0?(u=new KZ,n.set(i,[u])):s>=l.length?(u=new KZ,l.push(u)):u=l[s],u}function t(){n=new WeakMap}return{get:e,dispose:t}}function zje(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Ce,color:new An};break;case"SpotLight":t={position:new Ce,direction:new Ce,color:new An,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Ce,color:new An,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Ce,skyColor:new An,groundColor:new An};break;case"RectAreaLight":t={color:new An,position:new Ce,halfWidth:new Ce,halfHeight:new Ce};break}return n[e.id]=t,t}}}function Gje(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new St};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new St};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new St,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let Wje=0;function Hje(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Xje(n){const e=new zje,t=Gje(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let g=0;g<9;g++)i.probe.push(new Ce);const s=new Ce,l=new Zn,u=new Zn;function d(g){let x=0,b=0,E=0;for(let H=0;H<9;H++)i.probe[H].set(0,0,0);let S=0,M=0,R=0,P=0,k=0,F=0,V=0,G=0,q=0,ne=0,K=0;g.sort(Hje);for(let H=0,j=g.length;H<j;H++){const ee=g[H],de=ee.color,oe=ee.intensity,we=ee.distance,$e=ee.shadow&&ee.shadow.map?ee.shadow.map.texture:null;if(ee.isAmbientLight)x+=de.r*oe,b+=de.g*oe,E+=de.b*oe;else if(ee.isLightProbe){for(let Me=0;Me<9;Me++)i.probe[Me].addScaledVector(ee.sh.coefficients[Me],oe);K++}else if(ee.isDirectionalLight){const Me=e.get(ee);if(Me.color.copy(ee.color).multiplyScalar(ee.intensity),ee.castShadow){const Ne=ee.shadow,Ae=t.get(ee);Ae.shadowIntensity=Ne.intensity,Ae.shadowBias=Ne.bias,Ae.shadowNormalBias=Ne.normalBias,Ae.shadowRadius=Ne.radius,Ae.shadowMapSize=Ne.mapSize,i.directionalShadow[S]=Ae,i.directionalShadowMap[S]=$e,i.directionalShadowMatrix[S]=ee.shadow.matrix,F++}i.directional[S]=Me,S++}else if(ee.isSpotLight){const Me=e.get(ee);Me.position.setFromMatrixPosition(ee.matrixWorld),Me.color.copy(de).multiplyScalar(oe),Me.distance=we,Me.coneCos=Math.cos(ee.angle),Me.penumbraCos=Math.cos(ee.angle*(1-ee.penumbra)),Me.decay=ee.decay,i.spot[R]=Me;const Ne=ee.shadow;if(ee.map&&(i.spotLightMap[q]=ee.map,q++,Ne.updateMatrices(ee),ee.castShadow&&ne++),i.spotLightMatrix[R]=Ne.matrix,ee.castShadow){const Ae=t.get(ee);Ae.shadowIntensity=Ne.intensity,Ae.shadowBias=Ne.bias,Ae.shadowNormalBias=Ne.normalBias,Ae.shadowRadius=Ne.radius,Ae.shadowMapSize=Ne.mapSize,i.spotShadow[R]=Ae,i.spotShadowMap[R]=$e,G++}R++}else if(ee.isRectAreaLight){const Me=e.get(ee);Me.color.copy(de).multiplyScalar(oe),Me.halfWidth.set(ee.width*.5,0,0),Me.halfHeight.set(0,ee.height*.5,0),i.rectArea[P]=Me,P++}else if(ee.isPointLight){const Me=e.get(ee);if(Me.color.copy(ee.color).multiplyScalar(ee.intensity),Me.distance=ee.distance,Me.decay=ee.decay,ee.castShadow){const Ne=ee.shadow,Ae=t.get(ee);Ae.shadowIntensity=Ne.intensity,Ae.shadowBias=Ne.bias,Ae.shadowNormalBias=Ne.normalBias,Ae.shadowRadius=Ne.radius,Ae.shadowMapSize=Ne.mapSize,Ae.shadowCameraNear=Ne.camera.near,Ae.shadowCameraFar=Ne.camera.far,i.pointShadow[M]=Ae,i.pointShadowMap[M]=$e,i.pointShadowMatrix[M]=ee.shadow.matrix,V++}i.point[M]=Me,M++}else if(ee.isHemisphereLight){const Me=e.get(ee);Me.skyColor.copy(ee.color).multiplyScalar(oe),Me.groundColor.copy(ee.groundColor).multiplyScalar(oe),i.hemi[k]=Me,k++}}P>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=un.LTC_FLOAT_1,i.rectAreaLTC2=un.LTC_FLOAT_2):(i.rectAreaLTC1=un.LTC_HALF_1,i.rectAreaLTC2=un.LTC_HALF_2)),i.ambient[0]=x,i.ambient[1]=b,i.ambient[2]=E;const Q=i.hash;(Q.directionalLength!==S||Q.pointLength!==M||Q.spotLength!==R||Q.rectAreaLength!==P||Q.hemiLength!==k||Q.numDirectionalShadows!==F||Q.numPointShadows!==V||Q.numSpotShadows!==G||Q.numSpotMaps!==q||Q.numLightProbes!==K)&&(i.directional.length=S,i.spot.length=R,i.rectArea.length=P,i.point.length=M,i.hemi.length=k,i.directionalShadow.length=F,i.directionalShadowMap.length=F,i.pointShadow.length=V,i.pointShadowMap.length=V,i.spotShadow.length=G,i.spotShadowMap.length=G,i.directionalShadowMatrix.length=F,i.pointShadowMatrix.length=V,i.spotLightMatrix.length=G+q-ne,i.spotLightMap.length=q,i.numSpotLightShadowsWithMaps=ne,i.numLightProbes=K,Q.directionalLength=S,Q.pointLength=M,Q.spotLength=R,Q.rectAreaLength=P,Q.hemiLength=k,Q.numDirectionalShadows=F,Q.numPointShadows=V,Q.numSpotShadows=G,Q.numSpotMaps=q,Q.numLightProbes=K,i.version=Wje++)}function p(g,x){let b=0,E=0,S=0,M=0,R=0;const P=x.matrixWorldInverse;for(let k=0,F=g.length;k<F;k++){const V=g[k];if(V.isDirectionalLight){const G=i.directional[b];G.direction.setFromMatrixPosition(V.matrixWorld),s.setFromMatrixPosition(V.target.matrixWorld),G.direction.sub(s),G.direction.transformDirection(P),b++}else if(V.isSpotLight){const G=i.spot[S];G.position.setFromMatrixPosition(V.matrixWorld),G.position.applyMatrix4(P),G.direction.setFromMatrixPosition(V.matrixWorld),s.setFromMatrixPosition(V.target.matrixWorld),G.direction.sub(s),G.direction.transformDirection(P),S++}else if(V.isRectAreaLight){const G=i.rectArea[M];G.position.setFromMatrixPosition(V.matrixWorld),G.position.applyMatrix4(P),u.identity(),l.copy(V.matrixWorld),l.premultiply(P),u.extractRotation(l),G.halfWidth.set(V.width*.5,0,0),G.halfHeight.set(0,V.height*.5,0),G.halfWidth.applyMatrix4(u),G.halfHeight.applyMatrix4(u),M++}else if(V.isPointLight){const G=i.point[E];G.position.setFromMatrixPosition(V.matrixWorld),G.position.applyMatrix4(P),E++}else if(V.isHemisphereLight){const G=i.hemi[R];G.direction.setFromMatrixPosition(V.matrixWorld),G.direction.transformDirection(P),R++}}}return{setup:d,setupView:p,state:i}}function ZZ(n){const e=new Xje(n),t=[],i=[];function s(x){g.camera=x,t.length=0,i.length=0}function l(x){t.push(x)}function u(x){i.push(x)}function d(){e.setup(t)}function p(x){e.setupView(t,x)}const g={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:g,setupLights:d,setupLightsView:p,pushLight:l,pushShadow:u}}function $je(n){let e=new WeakMap;function t(s,l=0){const u=e.get(s);let d;return u===void 0?(d=new ZZ(n),e.set(s,[d])):l>=u.length?(d=new ZZ(n),u.push(d)):d=u[l],d}function i(){e=new WeakMap}return{get:t,dispose:i}}const Qje=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Kje=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Zje(n,e,t){let i=new cw;const s=new St,l=new St,u=new Wi,d=new _V({depthPacking:yie}),p=new IV,g={},x=t.maxTextureSize,b={[Gd]:Ta,[Ta]:Gd,[nh]:nh},E=new au({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new St},radius:{value:4}},vertexShader:Qje,fragmentShader:Kje}),S=E.clone();S.defines.HORIZONTAL_PASS=1;const M=new pi;M.setAttribute("position",new sr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const R=new Ms(M,E),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=qO;let k=this.type;this.render=function(ne,K,Q){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||ne.length===0)return;const H=n.getRenderTarget(),j=n.getActiveCubeFace(),ee=n.getActiveMipmapLevel(),de=n.state;de.setBlending(Sd),de.buffers.color.setClear(1,1,1,1),de.buffers.depth.setTest(!0),de.setScissorTest(!1);const oe=k!==Yu&&this.type===Yu,we=k===Yu&&this.type!==Yu;for(let $e=0,Me=ne.length;$e<Me;$e++){const Ne=ne[$e],Ae=Ne.shadow;if(Ae===void 0){console.warn("THREE.WebGLShadowMap:",Ne,"has no shadow.");continue}if(Ae.autoUpdate===!1&&Ae.needsUpdate===!1)continue;s.copy(Ae.mapSize);const Fe=Ae.getFrameExtents();if(s.multiply(Fe),l.copy(Ae.mapSize),(s.x>x||s.y>x)&&(s.x>x&&(l.x=Math.floor(x/Fe.x),s.x=l.x*Fe.x,Ae.mapSize.x=l.x),s.y>x&&(l.y=Math.floor(x/Fe.y),s.y=l.y*Fe.y,Ae.mapSize.y=l.y)),Ae.map===null||oe===!0||we===!0){const qe=this.type!==Yu?{minFilter:Co,magFilter:Co}:{};Ae.map!==null&&Ae.map.dispose(),Ae.map=new ou(s.x,s.y,qe),Ae.map.texture.name=Ne.name+".shadowMap",Ae.camera.updateProjectionMatrix()}n.setRenderTarget(Ae.map),n.clear();const Ie=Ae.getViewportCount();for(let qe=0;qe<Ie;qe++){const dt=Ae.getViewport(qe);u.set(l.x*dt.x,l.y*dt.y,l.x*dt.z,l.y*dt.w),de.viewport(u),Ae.updateMatrices(Ne,qe),i=Ae.getFrustum(),G(K,Q,Ae.camera,Ne,this.type)}Ae.isPointLightShadow!==!0&&this.type===Yu&&F(Ae,Q),Ae.needsUpdate=!1}k=this.type,P.needsUpdate=!1,n.setRenderTarget(H,j,ee)};function F(ne,K){const Q=e.update(R);E.defines.VSM_SAMPLES!==ne.blurSamples&&(E.defines.VSM_SAMPLES=ne.blurSamples,S.defines.VSM_SAMPLES=ne.blurSamples,E.needsUpdate=!0,S.needsUpdate=!0),ne.mapPass===null&&(ne.mapPass=new ou(s.x,s.y)),E.uniforms.shadow_pass.value=ne.map.texture,E.uniforms.resolution.value=ne.mapSize,E.uniforms.radius.value=ne.radius,n.setRenderTarget(ne.mapPass),n.clear(),n.renderBufferDirect(K,null,Q,E,R,null),S.uniforms.shadow_pass.value=ne.mapPass.texture,S.uniforms.resolution.value=ne.mapSize,S.uniforms.radius.value=ne.radius,n.setRenderTarget(ne.map),n.clear(),n.renderBufferDirect(K,null,Q,S,R,null)}function V(ne,K,Q,H){let j=null;const ee=Q.isPointLight===!0?ne.customDistanceMaterial:ne.customDepthMaterial;if(ee!==void 0)j=ee;else if(j=Q.isPointLight===!0?p:d,n.localClippingEnabled&&K.clipShadows===!0&&Array.isArray(K.clippingPlanes)&&K.clippingPlanes.length!==0||K.displacementMap&&K.displacementScale!==0||K.alphaMap&&K.alphaTest>0||K.map&&K.alphaTest>0){const de=j.uuid,oe=K.uuid;let we=g[de];we===void 0&&(we={},g[de]=we);let $e=we[oe];$e===void 0&&($e=j.clone(),we[oe]=$e,K.addEventListener("dispose",q)),j=$e}if(j.visible=K.visible,j.wireframe=K.wireframe,H===Yu?j.side=K.shadowSide!==null?K.shadowSide:K.side:j.side=K.shadowSide!==null?K.shadowSide:b[K.side],j.alphaMap=K.alphaMap,j.alphaTest=K.alphaTest,j.map=K.map,j.clipShadows=K.clipShadows,j.clippingPlanes=K.clippingPlanes,j.clipIntersection=K.clipIntersection,j.displacementMap=K.displacementMap,j.displacementScale=K.displacementScale,j.displacementBias=K.displacementBias,j.wireframeLinewidth=K.wireframeLinewidth,j.linewidth=K.linewidth,Q.isPointLight===!0&&j.isMeshDistanceMaterial===!0){const de=n.properties.get(j);de.light=Q}return j}function G(ne,K,Q,H,j){if(ne.visible===!1)return;if(ne.layers.test(K.layers)&&(ne.isMesh||ne.isLine||ne.isPoints)&&(ne.castShadow||ne.receiveShadow&&j===Yu)&&(!ne.frustumCulled||i.intersectsObject(ne))){ne.modelViewMatrix.multiplyMatrices(Q.matrixWorldInverse,ne.matrixWorld);const oe=e.update(ne),we=ne.material;if(Array.isArray(we)){const $e=oe.groups;for(let Me=0,Ne=$e.length;Me<Ne;Me++){const Ae=$e[Me],Fe=we[Ae.materialIndex];if(Fe&&Fe.visible){const Ie=V(ne,Fe,H,j);ne.onBeforeShadow(n,ne,K,Q,oe,Ie,Ae),n.renderBufferDirect(Q,null,oe,Ie,ne,Ae),ne.onAfterShadow(n,ne,K,Q,oe,Ie,Ae)}}}else if(we.visible){const $e=V(ne,we,H,j);ne.onBeforeShadow(n,ne,K,Q,oe,$e,null),n.renderBufferDirect(Q,null,oe,$e,ne,null),ne.onAfterShadow(n,ne,K,Q,oe,$e,null)}}const de=ne.children;for(let oe=0,we=de.length;oe<we;oe++)G(de[oe],K,Q,H,j)}function q(ne){ne.target.removeEventListener("dispose",q);for(const Q in g){const H=g[Q],j=ne.target.uuid;j in H&&(H[j].dispose(),delete H[j])}}}const jje={[C2]:E2,[_2]:T2,[I2]:M2,[jg]:S2,[E2]:C2,[T2]:_2,[M2]:I2,[S2]:jg};function Yje(n,e){function t(){let Pe=!1;const ft=new Wi;let Pt=null;const Dt=new Wi(0,0,0,0);return{setMask:function(qt){Pt!==qt&&!Pe&&(n.colorMask(qt,qt,qt,qt),Pt=qt)},setLocked:function(qt){Pe=qt},setClear:function(qt,sn,Rn,tn,Jt){Jt===!0&&(qt*=tn,sn*=tn,Rn*=tn),ft.set(qt,sn,Rn,tn),Dt.equals(ft)===!1&&(n.clearColor(qt,sn,Rn,tn),Dt.copy(ft))},reset:function(){Pe=!1,Pt=null,Dt.set(-1,0,0,0)}}}function i(){let Pe=!1,ft=!1,Pt=null,Dt=null,qt=null;return{setReversed:function(sn){if(ft!==sn){const Rn=e.get("EXT_clip_control");ft?Rn.clipControlEXT(Rn.LOWER_LEFT_EXT,Rn.ZERO_TO_ONE_EXT):Rn.clipControlEXT(Rn.LOWER_LEFT_EXT,Rn.NEGATIVE_ONE_TO_ONE_EXT);const tn=qt;qt=null,this.setClear(tn)}ft=sn},getReversed:function(){return ft},setTest:function(sn){sn?Et(n.DEPTH_TEST):Ze(n.DEPTH_TEST)},setMask:function(sn){Pt!==sn&&!Pe&&(n.depthMask(sn),Pt=sn)},setFunc:function(sn){if(ft&&(sn=jje[sn]),Dt!==sn){switch(sn){case C2:n.depthFunc(n.NEVER);break;case E2:n.depthFunc(n.ALWAYS);break;case _2:n.depthFunc(n.LESS);break;case jg:n.depthFunc(n.LEQUAL);break;case I2:n.depthFunc(n.EQUAL);break;case S2:n.depthFunc(n.GEQUAL);break;case T2:n.depthFunc(n.GREATER);break;case M2:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Dt=sn}},setLocked:function(sn){Pe=sn},setClear:function(sn){qt!==sn&&(ft&&(sn=1-sn),n.clearDepth(sn),qt=sn)},reset:function(){Pe=!1,Pt=null,Dt=null,qt=null,ft=!1}}}function s(){let Pe=!1,ft=null,Pt=null,Dt=null,qt=null,sn=null,Rn=null,tn=null,Jt=null;return{setTest:function(fn){Pe||(fn?Et(n.STENCIL_TEST):Ze(n.STENCIL_TEST))},setMask:function(fn){ft!==fn&&!Pe&&(n.stencilMask(fn),ft=fn)},setFunc:function(fn,ei,ar){(Pt!==fn||Dt!==ei||qt!==ar)&&(n.stencilFunc(fn,ei,ar),Pt=fn,Dt=ei,qt=ar)},setOp:function(fn,ei,ar){(sn!==fn||Rn!==ei||tn!==ar)&&(n.stencilOp(fn,ei,ar),sn=fn,Rn=ei,tn=ar)},setLocked:function(fn){Pe=fn},setClear:function(fn){Jt!==fn&&(n.clearStencil(fn),Jt=fn)},reset:function(){Pe=!1,ft=null,Pt=null,Dt=null,qt=null,sn=null,Rn=null,tn=null,Jt=null}}}const l=new t,u=new i,d=new s,p=new WeakMap,g=new WeakMap;let x={},b={},E=new WeakMap,S=[],M=null,R=!1,P=null,k=null,F=null,V=null,G=null,q=null,ne=null,K=new An(0,0,0),Q=0,H=!1,j=null,ee=null,de=null,oe=null,we=null;const $e=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Me=!1,Ne=0;const Ae=n.getParameter(n.VERSION);Ae.indexOf("WebGL")!==-1?(Ne=parseFloat(/^WebGL (\d)/.exec(Ae)[1]),Me=Ne>=1):Ae.indexOf("OpenGL ES")!==-1&&(Ne=parseFloat(/^OpenGL ES (\d)/.exec(Ae)[1]),Me=Ne>=2);let Fe=null,Ie={};const qe=n.getParameter(n.SCISSOR_BOX),dt=n.getParameter(n.VIEWPORT),Wt=new Wi().fromArray(qe),xt=new Wi().fromArray(dt);function At(Pe,ft,Pt,Dt){const qt=new Uint8Array(4),sn=n.createTexture();n.bindTexture(Pe,sn),n.texParameteri(Pe,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Pe,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Rn=0;Rn<Pt;Rn++)Pe===n.TEXTURE_3D||Pe===n.TEXTURE_2D_ARRAY?n.texImage3D(ft,0,n.RGBA,1,1,Dt,0,n.RGBA,n.UNSIGNED_BYTE,qt):n.texImage2D(ft+Rn,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,qt);return sn}const Rt={};Rt[n.TEXTURE_2D]=At(n.TEXTURE_2D,n.TEXTURE_2D,1),Rt[n.TEXTURE_CUBE_MAP]=At(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Rt[n.TEXTURE_2D_ARRAY]=At(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Rt[n.TEXTURE_3D]=At(n.TEXTURE_3D,n.TEXTURE_3D,1,1),l.setClear(0,0,0,1),u.setClear(1),d.setClear(0),Et(n.DEPTH_TEST),u.setFunc(jg),Te(!1),Gt(HD),Et(n.CULL_FACE),wt(Sd);function Et(Pe){x[Pe]!==!0&&(n.enable(Pe),x[Pe]=!0)}function Ze(Pe){x[Pe]!==!1&&(n.disable(Pe),x[Pe]=!1)}function It(Pe,ft){return b[Pe]!==ft?(n.bindFramebuffer(Pe,ft),b[Pe]=ft,Pe===n.DRAW_FRAMEBUFFER&&(b[n.FRAMEBUFFER]=ft),Pe===n.FRAMEBUFFER&&(b[n.DRAW_FRAMEBUFFER]=ft),!0):!1}function Lt(Pe,ft){let Pt=S,Dt=!1;if(Pe){Pt=E.get(ft),Pt===void 0&&(Pt=[],E.set(ft,Pt));const qt=Pe.textures;if(Pt.length!==qt.length||Pt[0]!==n.COLOR_ATTACHMENT0){for(let sn=0,Rn=qt.length;sn<Rn;sn++)Pt[sn]=n.COLOR_ATTACHMENT0+sn;Pt.length=qt.length,Dt=!0}}else Pt[0]!==n.BACK&&(Pt[0]=n.BACK,Dt=!0);Dt&&n.drawBuffers(Pt)}function Yt(Pe){return M!==Pe?(n.useProgram(Pe),M=Pe,!0):!1}const ht={[sp]:n.FUNC_ADD,[Une]:n.FUNC_SUBTRACT,[zne]:n.FUNC_REVERSE_SUBTRACT};ht[Gne]=n.MIN,ht[Wne]=n.MAX;const yt={[Hne]:n.ZERO,[Xne]:n.ONE,[$ne]:n.SRC_COLOR,[x2]:n.SRC_ALPHA,[qne]:n.SRC_ALPHA_SATURATE,[jne]:n.DST_COLOR,[Kne]:n.DST_ALPHA,[Qne]:n.ONE_MINUS_SRC_COLOR,[w2]:n.ONE_MINUS_SRC_ALPHA,[Yne]:n.ONE_MINUS_DST_COLOR,[Zne]:n.ONE_MINUS_DST_ALPHA,[Jne]:n.CONSTANT_COLOR,[eie]:n.ONE_MINUS_CONSTANT_COLOR,[tie]:n.CONSTANT_ALPHA,[nie]:n.ONE_MINUS_CONSTANT_ALPHA};function wt(Pe,ft,Pt,Dt,qt,sn,Rn,tn,Jt,fn){if(Pe===Sd){R===!0&&(Ze(n.BLEND),R=!1);return}if(R===!1&&(Et(n.BLEND),R=!0),Pe!==Vne){if(Pe!==P||fn!==H){if((k!==sp||G!==sp)&&(n.blendEquation(n.FUNC_ADD),k=sp,G=sp),fn)switch(Pe){case Ng:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case XD:n.blendFunc(n.ONE,n.ONE);break;case $D:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QD:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}else switch(Pe){case Ng:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case XD:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case $D:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case QD:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Pe);break}F=null,V=null,q=null,ne=null,K.set(0,0,0),Q=0,P=Pe,H=fn}return}qt=qt||ft,sn=sn||Pt,Rn=Rn||Dt,(ft!==k||qt!==G)&&(n.blendEquationSeparate(ht[ft],ht[qt]),k=ft,G=qt),(Pt!==F||Dt!==V||sn!==q||Rn!==ne)&&(n.blendFuncSeparate(yt[Pt],yt[Dt],yt[sn],yt[Rn]),F=Pt,V=Dt,q=sn,ne=Rn),(tn.equals(K)===!1||Jt!==Q)&&(n.blendColor(tn.r,tn.g,tn.b,Jt),K.copy(tn),Q=Jt),P=Pe,H=!1}function Ee(Pe,ft){Pe.side===nh?Ze(n.CULL_FACE):Et(n.CULL_FACE);let Pt=Pe.side===Ta;ft&&(Pt=!Pt),Te(Pt),Pe.blending===Ng&&Pe.transparent===!1?wt(Sd):wt(Pe.blending,Pe.blendEquation,Pe.blendSrc,Pe.blendDst,Pe.blendEquationAlpha,Pe.blendSrcAlpha,Pe.blendDstAlpha,Pe.blendColor,Pe.blendAlpha,Pe.premultipliedAlpha),u.setFunc(Pe.depthFunc),u.setTest(Pe.depthTest),u.setMask(Pe.depthWrite),l.setMask(Pe.colorWrite);const Dt=Pe.stencilWrite;d.setTest(Dt),Dt&&(d.setMask(Pe.stencilWriteMask),d.setFunc(Pe.stencilFunc,Pe.stencilRef,Pe.stencilFuncMask),d.setOp(Pe.stencilFail,Pe.stencilZFail,Pe.stencilZPass)),te(Pe.polygonOffset,Pe.polygonOffsetFactor,Pe.polygonOffsetUnits),Pe.alphaToCoverage===!0?Et(n.SAMPLE_ALPHA_TO_COVERAGE):Ze(n.SAMPLE_ALPHA_TO_COVERAGE)}function Te(Pe){j!==Pe&&(Pe?n.frontFace(n.CW):n.frontFace(n.CCW),j=Pe)}function Gt(Pe){Pe!==Dne?(Et(n.CULL_FACE),Pe!==ee&&(Pe===HD?n.cullFace(n.BACK):Pe===Fne?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ze(n.CULL_FACE),ee=Pe}function Y(Pe){Pe!==de&&(Me&&n.lineWidth(Pe),de=Pe)}function te(Pe,ft,Pt){Pe?(Et(n.POLYGON_OFFSET_FILL),(oe!==ft||we!==Pt)&&(n.polygonOffset(ft,Pt),oe=ft,we=Pt)):Ze(n.POLYGON_OFFSET_FILL)}function ce(Pe){Pe?Et(n.SCISSOR_TEST):Ze(n.SCISSOR_TEST)}function xe(Pe){Pe===void 0&&(Pe=n.TEXTURE0+$e-1),Fe!==Pe&&(n.activeTexture(Pe),Fe=Pe)}function Re(Pe,ft,Pt){Pt===void 0&&(Fe===null?Pt=n.TEXTURE0+$e-1:Pt=Fe);let Dt=Ie[Pt];Dt===void 0&&(Dt={type:void 0,texture:void 0},Ie[Pt]=Dt),(Dt.type!==Pe||Dt.texture!==ft)&&(Fe!==Pt&&(n.activeTexture(Pt),Fe=Pt),n.bindTexture(Pe,ft||Rt[Pe]),Dt.type=Pe,Dt.texture=ft)}function We(){const Pe=Ie[Fe];Pe!==void 0&&Pe.type!==void 0&&(n.bindTexture(Pe.type,null),Pe.type=void 0,Pe.texture=void 0)}function at(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ln(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ve(){try{n.texSubImage2D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ue(){try{n.texSubImage3D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Oe(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function ut(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function vt(){try{n.texStorage2D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function pt(){try{n.texStorage3D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function cn(){try{n.texImage2D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Tt(){try{n.texImage3D.apply(n,arguments)}catch(Pe){console.error("THREE.WebGLState:",Pe)}}function Zt(Pe){Wt.equals(Pe)===!1&&(n.scissor(Pe.x,Pe.y,Pe.z,Pe.w),Wt.copy(Pe))}function kn(Pe){xt.equals(Pe)===!1&&(n.viewport(Pe.x,Pe.y,Pe.z,Pe.w),xt.copy(Pe))}function Ft(Pe,ft){let Pt=g.get(ft);Pt===void 0&&(Pt=new WeakMap,g.set(ft,Pt));let Dt=Pt.get(Pe);Dt===void 0&&(Dt=n.getUniformBlockIndex(ft,Pe.name),Pt.set(Pe,Dt))}function vn(Pe,ft){const Dt=g.get(ft).get(Pe);p.get(ft)!==Dt&&(n.uniformBlockBinding(ft,Dt,Pe.__bindingPointIndex),p.set(ft,Dt))}function jn(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),u.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),x={},Fe=null,Ie={},b={},E=new WeakMap,S=[],M=null,R=!1,P=null,k=null,F=null,V=null,G=null,q=null,ne=null,K=new An(0,0,0),Q=0,H=!1,j=null,ee=null,de=null,oe=null,we=null,Wt.set(0,0,n.canvas.width,n.canvas.height),xt.set(0,0,n.canvas.width,n.canvas.height),l.reset(),u.reset(),d.reset()}return{buffers:{color:l,depth:u,stencil:d},enable:Et,disable:Ze,bindFramebuffer:It,drawBuffers:Lt,useProgram:Yt,setBlending:wt,setMaterial:Ee,setFlipSided:Te,setCullFace:Gt,setLineWidth:Y,setPolygonOffset:te,setScissorTest:ce,activeTexture:xe,bindTexture:Re,unbindTexture:We,compressedTexImage2D:at,compressedTexImage3D:ln,texImage2D:cn,texImage3D:Tt,updateUBOMapping:Ft,uniformBlockBinding:vn,texStorage2D:vt,texStorage3D:pt,texSubImage2D:ve,texSubImage3D:ue,compressedTexSubImage2D:Oe,compressedTexSubImage3D:ut,scissor:Zt,viewport:kn,reset:jn}}function qje(n,e,t,i,s,l,u){const d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=e.has("OCULUS_multiview")?e.get("OCULUS_multiview"):null,x=new St,b=new WeakMap;let E;const S=new WeakMap;let M=[],R=!1,P=!1;try{P=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function k(ve,ue){return P?new OffscreenCanvas(ve,ue):_1("canvas")}function F(ve,ue,Oe){let ut=1;const vt=ln(ve);if((vt.width>Oe||vt.height>Oe)&&(ut=Oe/Math.max(vt.width,vt.height)),ut<1)if(typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ve instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ve instanceof ImageBitmap||typeof VideoFrame<"u"&&ve instanceof VideoFrame){const pt=Math.floor(ut*vt.width),cn=Math.floor(ut*vt.height);E===void 0&&(E=k(pt,cn));const Tt=ue?k(pt,cn):E;return Tt.width=pt,Tt.height=cn,Tt.getContext("2d").drawImage(ve,0,0,pt,cn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+vt.width+"x"+vt.height+") to ("+pt+"x"+cn+")."),Tt}else return"data"in ve&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+vt.width+"x"+vt.height+")."),ve;return ve}function V(ve){return ve.generateMipmaps}function G(ve){n.generateMipmap(ve)}function q(ve){return ve.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:ve.isWebGL3DRenderTarget?n.TEXTURE_3D:ve.isWebGLArrayRenderTarget||ve.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function ne(ve,ue,Oe,ut,vt=!1){if(ve!==null){if(n[ve]!==void 0)return n[ve];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ve+"'")}let pt=ue;if(ue===n.RED&&(Oe===n.FLOAT&&(pt=n.R32F),Oe===n.HALF_FLOAT&&(pt=n.R16F),Oe===n.UNSIGNED_BYTE&&(pt=n.R8)),ue===n.RED_INTEGER&&(Oe===n.UNSIGNED_BYTE&&(pt=n.R8UI),Oe===n.UNSIGNED_SHORT&&(pt=n.R16UI),Oe===n.UNSIGNED_INT&&(pt=n.R32UI),Oe===n.BYTE&&(pt=n.R8I),Oe===n.SHORT&&(pt=n.R16I),Oe===n.INT&&(pt=n.R32I)),ue===n.RG&&(Oe===n.FLOAT&&(pt=n.RG32F),Oe===n.HALF_FLOAT&&(pt=n.RG16F),Oe===n.UNSIGNED_BYTE&&(pt=n.RG8)),ue===n.RG_INTEGER&&(Oe===n.UNSIGNED_BYTE&&(pt=n.RG8UI),Oe===n.UNSIGNED_SHORT&&(pt=n.RG16UI),Oe===n.UNSIGNED_INT&&(pt=n.RG32UI),Oe===n.BYTE&&(pt=n.RG8I),Oe===n.SHORT&&(pt=n.RG16I),Oe===n.INT&&(pt=n.RG32I)),ue===n.RGB_INTEGER&&(Oe===n.UNSIGNED_BYTE&&(pt=n.RGB8UI),Oe===n.UNSIGNED_SHORT&&(pt=n.RGB16UI),Oe===n.UNSIGNED_INT&&(pt=n.RGB32UI),Oe===n.BYTE&&(pt=n.RGB8I),Oe===n.SHORT&&(pt=n.RGB16I),Oe===n.INT&&(pt=n.RGB32I)),ue===n.RGBA_INTEGER&&(Oe===n.UNSIGNED_BYTE&&(pt=n.RGBA8UI),Oe===n.UNSIGNED_SHORT&&(pt=n.RGBA16UI),Oe===n.UNSIGNED_INT&&(pt=n.RGBA32UI),Oe===n.BYTE&&(pt=n.RGBA8I),Oe===n.SHORT&&(pt=n.RGBA16I),Oe===n.INT&&(pt=n.RGBA32I)),ue===n.RGB&&Oe===n.UNSIGNED_INT_5_9_9_9_REV&&(pt=n.RGB9_E5),ue===n.RGBA){const cn=vt?w1:Fi.getTransfer(ut);Oe===n.FLOAT&&(pt=n.RGBA32F),Oe===n.HALF_FLOAT&&(pt=n.RGBA16F),Oe===n.UNSIGNED_BYTE&&(pt=cn===tr?n.SRGB8_ALPHA8:n.RGBA8),Oe===n.UNSIGNED_SHORT_4_4_4_4&&(pt=n.RGBA4),Oe===n.UNSIGNED_SHORT_5_5_5_1&&(pt=n.RGB5_A1)}return(pt===n.R16F||pt===n.R32F||pt===n.RG16F||pt===n.RG32F||pt===n.RGBA16F||pt===n.RGBA32F)&&e.get("EXT_color_buffer_float"),pt}function K(ve,ue){let Oe;return ve?ue===null||ue===Hd||ue===Tp?Oe=n.DEPTH24_STENCIL8:ue===Ca?Oe=n.DEPTH32F_STENCIL8:ue===OA&&(Oe=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):ue===null||ue===Hd||ue===Tp?Oe=n.DEPTH_COMPONENT24:ue===Ca?Oe=n.DEPTH_COMPONENT32F:ue===OA&&(Oe=n.DEPTH_COMPONENT16),Oe}function Q(ve,ue){return V(ve)===!0||ve.isFramebufferTexture&&ve.minFilter!==Co&&ve.minFilter!==Ws?Math.log2(Math.max(ue.width,ue.height))+1:ve.mipmaps!==void 0&&ve.mipmaps.length>0?ve.mipmaps.length:ve.isCompressedTexture&&Array.isArray(ve.image)?ue.mipmaps.length:1}function H(ve){const ue=ve.target;ue.removeEventListener("dispose",H),ee(ue),ue.isVideoTexture&&b.delete(ue)}function j(ve){const ue=ve.target;ue.removeEventListener("dispose",j),oe(ue)}function ee(ve){const ue=i.get(ve);if(ue.__webglInit===void 0)return;const Oe=ve.source,ut=S.get(Oe);if(ut){const vt=ut[ue.__cacheKey];vt.usedTimes--,vt.usedTimes===0&&de(ve),Object.keys(ut).length===0&&S.delete(Oe)}i.remove(ve)}function de(ve){const ue=i.get(ve);n.deleteTexture(ue.__webglTexture);const Oe=ve.source,ut=S.get(Oe);delete ut[ue.__cacheKey],u.memory.textures--}function oe(ve){const ue=i.get(ve);if(ve.depthTexture&&(ve.depthTexture.dispose(),i.remove(ve.depthTexture)),ve.isWebGLCubeRenderTarget)for(let ut=0;ut<6;ut++){if(Array.isArray(ue.__webglFramebuffer[ut]))for(let vt=0;vt<ue.__webglFramebuffer[ut].length;vt++)n.deleteFramebuffer(ue.__webglFramebuffer[ut][vt]);else n.deleteFramebuffer(ue.__webglFramebuffer[ut]);ue.__webglDepthbuffer&&n.deleteRenderbuffer(ue.__webglDepthbuffer[ut])}else{if(Array.isArray(ue.__webglFramebuffer))for(let ut=0;ut<ue.__webglFramebuffer.length;ut++)n.deleteFramebuffer(ue.__webglFramebuffer[ut]);else n.deleteFramebuffer(ue.__webglFramebuffer);if(ue.__webglDepthbuffer&&n.deleteRenderbuffer(ue.__webglDepthbuffer),ue.__webglMultisampledFramebuffer&&n.deleteFramebuffer(ue.__webglMultisampledFramebuffer),ue.__webglColorRenderbuffer)for(let ut=0;ut<ue.__webglColorRenderbuffer.length;ut++)ue.__webglColorRenderbuffer[ut]&&n.deleteRenderbuffer(ue.__webglColorRenderbuffer[ut]);ue.__webglDepthRenderbuffer&&n.deleteRenderbuffer(ue.__webglDepthRenderbuffer)}const Oe=ve.textures;for(let ut=0,vt=Oe.length;ut<vt;ut++){const pt=i.get(Oe[ut]);pt.__webglTexture&&(n.deleteTexture(pt.__webglTexture),u.memory.textures--),i.remove(Oe[ut])}i.remove(ve)}let we=0;function $e(){we=0}function Me(){const ve=we;return ve>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ve+" texture units while this GPU supports only "+s.maxTextures),we+=1,ve}function Ne(ve){const ue=[];return ue.push(ve.wrapS),ue.push(ve.wrapT),ue.push(ve.wrapR||0),ue.push(ve.magFilter),ue.push(ve.minFilter),ue.push(ve.anisotropy),ue.push(ve.internalFormat),ue.push(ve.format),ue.push(ve.type),ue.push(ve.generateMipmaps),ue.push(ve.premultiplyAlpha),ue.push(ve.flipY),ue.push(ve.unpackAlignment),ue.push(ve.colorSpace),ue.join()}function Ae(ve,ue){const Oe=i.get(ve);if(ve.isVideoTexture&&We(ve),ve.isRenderTargetTexture===!1&&ve.version>0&&Oe.__version!==ve.version){const ut=ve.image;if(ut===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ut.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else if(It(Oe,ve,ue))return}t.bindTexture(n.TEXTURE_2D,Oe.__webglTexture,n.TEXTURE0+ue)}function Fe(ve,ue){const Oe=i.get(ve);if(ve.version>0&&Oe.__version!==ve.version){It(Oe,ve,ue);return}t.bindTexture(n.TEXTURE_2D_ARRAY,Oe.__webglTexture,n.TEXTURE0+ue)}function Ie(ve,ue){const Oe=i.get(ve);if(ve.version>0&&Oe.__version!==ve.version){It(Oe,ve,ue);return}t.bindTexture(n.TEXTURE_3D,Oe.__webglTexture,n.TEXTURE0+ue)}function qe(ve,ue){const Oe=i.get(ve);if(ve.version>0&&Oe.__version!==ve.version){Lt(Oe,ve,ue);return}t.bindTexture(n.TEXTURE_CUBE_MAP,Oe.__webglTexture,n.TEXTURE0+ue)}const dt={[A1]:n.REPEAT,[hc]:n.CLAMP_TO_EDGE,[v1]:n.MIRRORED_REPEAT},Wt={[Co]:n.NEAREST,[JO]:n.NEAREST_MIPMAP_NEAREST,[tA]:n.NEAREST_MIPMAP_LINEAR,[Ws]:n.LINEAR,[Ix]:n.LINEAR_MIPMAP_NEAREST,[ih]:n.LINEAR_MIPMAP_LINEAR},xt={[vie]:n.NEVER,[_ie]:n.ALWAYS,[bie]:n.LESS,[uV]:n.LEQUAL,[xie]:n.EQUAL,[Eie]:n.GEQUAL,[wie]:n.GREATER,[Cie]:n.NOTEQUAL};function At(ve,ue){if(ue.type===Ca&&e.has("OES_texture_float_linear")===!1&&(ue.magFilter===Ws||ue.magFilter===Ix||ue.magFilter===tA||ue.magFilter===ih||ue.minFilter===Ws||ue.minFilter===Ix||ue.minFilter===tA||ue.minFilter===ih)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ve,n.TEXTURE_WRAP_S,dt[ue.wrapS]),n.texParameteri(ve,n.TEXTURE_WRAP_T,dt[ue.wrapT]),(ve===n.TEXTURE_3D||ve===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ve,n.TEXTURE_WRAP_R,dt[ue.wrapR]),n.texParameteri(ve,n.TEXTURE_MAG_FILTER,Wt[ue.magFilter]),n.texParameteri(ve,n.TEXTURE_MIN_FILTER,Wt[ue.minFilter]),ue.compareFunction&&(n.texParameteri(ve,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ve,n.TEXTURE_COMPARE_FUNC,xt[ue.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(ue.magFilter===Co||ue.minFilter!==tA&&ue.minFilter!==ih||ue.type===Ca&&e.has("OES_texture_float_linear")===!1)return;if(ue.anisotropy>1||i.get(ue).__currentAnisotropy){const Oe=e.get("EXT_texture_filter_anisotropic");n.texParameterf(ve,Oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(ue.anisotropy,s.getMaxAnisotropy())),i.get(ue).__currentAnisotropy=ue.anisotropy}}}function Rt(ve,ue){let Oe=!1;ve.__webglInit===void 0&&(ve.__webglInit=!0,ue.addEventListener("dispose",H));const ut=ue.source;let vt=S.get(ut);vt===void 0&&(vt={},S.set(ut,vt));const pt=Ne(ue);if(pt!==ve.__cacheKey){vt[pt]===void 0&&(vt[pt]={texture:n.createTexture(),usedTimes:0},u.memory.textures++,Oe=!0),vt[pt].usedTimes++;const cn=vt[ve.__cacheKey];cn!==void 0&&(vt[ve.__cacheKey].usedTimes--,cn.usedTimes===0&&de(ue)),ve.__cacheKey=pt,ve.__webglTexture=vt[pt].texture}return Oe}function Et(ve){R=ve}function Ze(){const ve=R;R=!1;for(const ue of M)It(ue.textureProperties,ue.texture,ue.slot),ue.texture.isPendingDeferredUpload=!1;M=[],R=ve}function It(ve,ue,Oe){if(R)return ue.isPendingDeferredUpload||(ue.isPendingDeferredUpload=!0,M.push({textureProperties:ve,texture:ue,slot:Oe})),!1;let ut=n.TEXTURE_2D;(ue.isDataArrayTexture||ue.isCompressedArrayTexture)&&(ut=n.TEXTURE_2D_ARRAY),ue.isData3DTexture&&(ut=n.TEXTURE_3D);const vt=Rt(ve,ue),pt=ue.source;t.bindTexture(ut,ve.__webglTexture,n.TEXTURE0+Oe);const cn=i.get(pt);if(pt.version!==cn.__version||vt===!0){t.activeTexture(n.TEXTURE0+Oe);const Tt=Fi.getPrimaries(Fi.workingColorSpace),Zt=ue.colorSpace===dd?null:Fi.getPrimaries(ue.colorSpace),kn=ue.colorSpace===dd||Tt===Zt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,ue.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,ue.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,kn);let Ft=F(ue.image,!1,s.maxTextureSize);Ft=at(ue,Ft);const vn=l.convert(ue.format,ue.colorSpace),jn=l.convert(ue.type);let Pe=ne(ue.internalFormat,vn,jn,ue.colorSpace,ue.isVideoTexture);At(ut,ue);let ft;const Pt=ue.mipmaps,Dt=ue.isVideoTexture!==!0,qt=cn.__version===void 0||vt===!0,sn=pt.dataReady,Rn=Q(ue,Ft);if(ue.isDepthTexture)Pe=K(ue.format===kp,ue.type),qt&&(Dt?t.texStorage2D(n.TEXTURE_2D,1,Pe,Ft.width,Ft.height):t.texImage2D(n.TEXTURE_2D,0,Pe,Ft.width,Ft.height,0,vn,jn,null));else if(ue.isDataTexture)if(Pt.length>0){Dt&&qt&&t.texStorage2D(n.TEXTURE_2D,Rn,Pe,Pt[0].width,Pt[0].height);for(let tn=0,Jt=Pt.length;tn<Jt;tn++)ft=Pt[tn],Dt?sn&&t.texSubImage2D(n.TEXTURE_2D,tn,0,0,ft.width,ft.height,vn,jn,ft.data):t.texImage2D(n.TEXTURE_2D,tn,Pe,ft.width,ft.height,0,vn,jn,ft.data);ue.generateMipmaps=!1}else Dt?(qt&&t.texStorage2D(n.TEXTURE_2D,Rn,Pe,Ft.width,Ft.height),sn&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ft.width,Ft.height,vn,jn,Ft.data)):t.texImage2D(n.TEXTURE_2D,0,Pe,Ft.width,Ft.height,0,vn,jn,Ft.data);else if(ue.isCompressedTexture)if(ue.isCompressedArrayTexture){Dt&&qt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Rn,Pe,Pt[0].width,Pt[0].height,Ft.depth);for(let tn=0,Jt=Pt.length;tn<Jt;tn++)if(ft=Pt[tn],ue.format!==Ia)if(vn!==null)if(Dt){if(sn)if(ue.layerUpdates.size>0){const fn=i3(ft.width,ft.height,ue.format,ue.type);for(const ei of ue.layerUpdates){const ar=ft.data.subarray(ei*fn/ft.data.BYTES_PER_ELEMENT,(ei+1)*fn/ft.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,tn,0,0,ei,ft.width,ft.height,1,vn,ar)}ue.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,tn,0,0,0,ft.width,ft.height,Ft.depth,vn,ft.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,tn,Pe,ft.width,ft.height,Ft.depth,0,ft.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Dt?sn&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,tn,0,0,0,ft.width,ft.height,Ft.depth,vn,jn,ft.data):t.texImage3D(n.TEXTURE_2D_ARRAY,tn,Pe,ft.width,ft.height,Ft.depth,0,vn,jn,ft.data)}else{Dt&&qt&&t.texStorage2D(n.TEXTURE_2D,Rn,Pe,Pt[0].width,Pt[0].height);for(let tn=0,Jt=Pt.length;tn<Jt;tn++)ft=Pt[tn],ue.format!==Ia?vn!==null?Dt?sn&&t.compressedTexSubImage2D(n.TEXTURE_2D,tn,0,0,ft.width,ft.height,vn,ft.data):t.compressedTexImage2D(n.TEXTURE_2D,tn,Pe,ft.width,ft.height,0,ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Dt?sn&&t.texSubImage2D(n.TEXTURE_2D,tn,0,0,ft.width,ft.height,vn,jn,ft.data):t.texImage2D(n.TEXTURE_2D,tn,Pe,ft.width,ft.height,0,vn,jn,ft.data)}else if(ue.isDataArrayTexture)if(Dt){if(qt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Rn,Pe,Ft.width,Ft.height,Ft.depth),sn)if(ue.layerUpdates.size>0){const tn=i3(Ft.width,Ft.height,ue.format,ue.type);for(const Jt of ue.layerUpdates){const fn=Ft.data.subarray(Jt*tn/Ft.data.BYTES_PER_ELEMENT,(Jt+1)*tn/Ft.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Jt,Ft.width,Ft.height,1,vn,jn,fn)}ue.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Ft.width,Ft.height,Ft.depth,vn,jn,Ft.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,Pe,Ft.width,Ft.height,Ft.depth,0,vn,jn,Ft.data);else if(ue.isData3DTexture)Dt?(qt&&t.texStorage3D(n.TEXTURE_3D,Rn,Pe,Ft.width,Ft.height,Ft.depth),sn&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Ft.width,Ft.height,Ft.depth,vn,jn,Ft.data)):t.texImage3D(n.TEXTURE_3D,0,Pe,Ft.width,Ft.height,Ft.depth,0,vn,jn,Ft.data);else if(ue.isFramebufferTexture){if(qt)if(Dt)t.texStorage2D(n.TEXTURE_2D,Rn,Pe,Ft.width,Ft.height);else{let tn=Ft.width,Jt=Ft.height;for(let fn=0;fn<Rn;fn++)t.texImage2D(n.TEXTURE_2D,fn,Pe,tn,Jt,0,vn,jn,null),tn>>=1,Jt>>=1}}else if(Pt.length>0){if(Dt&&qt){const tn=ln(Pt[0]);t.texStorage2D(n.TEXTURE_2D,Rn,Pe,tn.width,tn.height)}for(let tn=0,Jt=Pt.length;tn<Jt;tn++)ft=Pt[tn],Dt?sn&&t.texSubImage2D(n.TEXTURE_2D,tn,0,0,vn,jn,ft):t.texImage2D(n.TEXTURE_2D,tn,Pe,vn,jn,ft);ue.generateMipmaps=!1}else if(Dt){if(qt){const tn=ln(Ft);t.texStorage2D(n.TEXTURE_2D,Rn,Pe,tn.width,tn.height)}sn&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,vn,jn,Ft)}else t.texImage2D(n.TEXTURE_2D,0,Pe,vn,jn,Ft);V(ue)&&G(ut),cn.__version=pt.version,ue.onUpdate&&ue.onUpdate(ue)}return ve.__version=ue.version,!0}function Lt(ve,ue,Oe){if(ue.image.length!==6)return;const ut=Rt(ve,ue),vt=ue.source;t.bindTexture(n.TEXTURE_CUBE_MAP,ve.__webglTexture,n.TEXTURE0+Oe);const pt=i.get(vt);if(vt.version!==pt.__version||ut===!0){t.activeTexture(n.TEXTURE0+Oe);const cn=Fi.getPrimaries(Fi.workingColorSpace),Tt=ue.colorSpace===dd?null:Fi.getPrimaries(ue.colorSpace),Zt=ue.colorSpace===dd||cn===Tt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,ue.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ue.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,ue.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Zt);const kn=ue.isCompressedTexture||ue.image[0].isCompressedTexture,Ft=ue.image[0]&&ue.image[0].isDataTexture,vn=[];for(let Jt=0;Jt<6;Jt++)!kn&&!Ft?vn[Jt]=F(ue.image[Jt],!0,s.maxCubemapSize):vn[Jt]=Ft?ue.image[Jt].image:ue.image[Jt],vn[Jt]=at(ue,vn[Jt]);const jn=vn[0],Pe=l.convert(ue.format,ue.colorSpace),ft=l.convert(ue.type),Pt=ne(ue.internalFormat,Pe,ft,ue.colorSpace),Dt=ue.isVideoTexture!==!0,qt=pt.__version===void 0||ut===!0,sn=vt.dataReady;let Rn=Q(ue,jn);At(n.TEXTURE_CUBE_MAP,ue);let tn;if(kn){Dt&&qt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Rn,Pt,jn.width,jn.height);for(let Jt=0;Jt<6;Jt++){tn=vn[Jt].mipmaps;for(let fn=0;fn<tn.length;fn++){const ei=tn[fn];ue.format!==Ia?Pe!==null?Dt?sn&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn,0,0,ei.width,ei.height,Pe,ei.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn,Pt,ei.width,ei.height,0,ei.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Dt?sn&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn,0,0,ei.width,ei.height,Pe,ft,ei.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn,Pt,ei.width,ei.height,0,Pe,ft,ei.data)}}}else{if(tn=ue.mipmaps,Dt&&qt){tn.length>0&&Rn++;const Jt=ln(vn[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Rn,Pt,Jt.width,Jt.height)}for(let Jt=0;Jt<6;Jt++)if(Ft){Dt?sn&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,0,0,0,vn[Jt].width,vn[Jt].height,Pe,ft,vn[Jt].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,0,Pt,vn[Jt].width,vn[Jt].height,0,Pe,ft,vn[Jt].data);for(let fn=0;fn<tn.length;fn++){const ar=tn[fn].image[Jt].image;Dt?sn&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn+1,0,0,ar.width,ar.height,Pe,ft,ar.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn+1,Pt,ar.width,ar.height,0,Pe,ft,ar.data)}}else{Dt?sn&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,0,0,0,Pe,ft,vn[Jt]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,0,Pt,Pe,ft,vn[Jt]);for(let fn=0;fn<tn.length;fn++){const ei=tn[fn];Dt?sn&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn+1,0,0,Pe,ft,ei.image[Jt]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Jt,fn+1,Pt,Pe,ft,ei.image[Jt])}}}V(ue)&&G(n.TEXTURE_CUBE_MAP),pt.__version=vt.version,ue.onUpdate&&ue.onUpdate(ue)}ve.__version=ue.version}function Yt(ve,ue,Oe,ut,vt,pt){const cn=l.convert(Oe.format,Oe.colorSpace),Tt=l.convert(Oe.type),Zt=ne(Oe.internalFormat,cn,Tt,Oe.colorSpace),kn=i.get(ue),Ft=i.get(Oe);if(Ft.__renderTarget=ue,!kn.__hasExternalTextures){const jn=Math.max(1,ue.width>>pt),Pe=Math.max(1,ue.height>>pt);ue.isWebGLMultiviewRenderTarget===!0?t.texStorage3D(n.TEXTURE_2D_ARRAY,0,Zt,ue.width,ue.height,ue.numViews):vt===n.TEXTURE_3D||vt===n.TEXTURE_2D_ARRAY?t.texImage3D(vt,pt,Zt,jn,Pe,ue.depth,0,cn,Tt,null):t.texImage2D(vt,pt,Zt,jn,Pe,0,cn,Tt,null)}t.bindFramebuffer(n.FRAMEBUFFER,ve);const vn=Re(ue);ue.isWebGLMultiviewRenderTarget===!0?vn?g.framebufferTextureMultisampleMultiviewOVR(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,Ft.__webglTexture,0,xe(ue),0,ue.numViews):g.framebufferTextureMultiviewOVR(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,Ft.__webglTexture,0,0,ue.numViews):(vt===n.TEXTURE_2D||vt>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&vt<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&(vn?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ut,vt,Ft.__webglTexture,0,xe(ue)):n.framebufferTexture2D(n.FRAMEBUFFER,ut,vt,Ft.__webglTexture,pt)),t.bindFramebuffer(n.FRAMEBUFFER,null)}function ht(ve,ue,Oe){if(n.bindRenderbuffer(n.RENDERBUFFER,ve),ue.isWebGLMultiviewRenderTarget===!0){const ut=Re(ue),vt=ue.numViews,pt=ue.depthTexture;let cn=n.DEPTH_COMPONENT24,Tt=n.DEPTH_ATTACHMENT;pt&&pt.isDepthTexture&&(pt.type===Ca?cn=n.DEPTH_COMPONENT32F:pt.type===Tp&&(cn=n.DEPTH24_STENCIL8,Tt=n.DEPTH_STENCIL_ATTACHMENT));let Zt=i.get(ue.depthTexture).__webglTexture;Zt===void 0&&(Zt=n.createTexture(),n.bindTexture(n.TEXTURE_2D_ARRAY,Zt),n.texStorage3D(n.TEXTURE_2D_ARRAY,1,cn,ue.width,ue.height,vt)),ut?g.framebufferTextureMultisampleMultiviewOVR(n.FRAMEBUFFER,Tt,Zt,0,xe(ue),0,vt):g.framebufferTextureMultiviewOVR(n.FRAMEBUFFER,Tt,Zt,0,0,vt)}else if(ue.depthBuffer){const ut=ue.depthTexture,vt=ut&&ut.isDepthTexture?ut.type:null,pt=K(ue.stencilBuffer,vt),cn=ue.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Tt=xe(ue);Re(ue)?d.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Tt,pt,ue.width,ue.height):Oe?n.renderbufferStorageMultisample(n.RENDERBUFFER,Tt,pt,ue.width,ue.height):n.renderbufferStorage(n.RENDERBUFFER,pt,ue.width,ue.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,cn,n.RENDERBUFFER,ve)}else{const ut=ue.textures;for(let vt=0;vt<ut.length;vt++){const pt=ut[vt],cn=l.convert(pt.format,pt.colorSpace),Tt=l.convert(pt.type),Zt=ne(pt.internalFormat,cn,Tt,pt.colorSpace),kn=xe(ue);Oe&&Re(ue)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,kn,Zt,ue.width,ue.height):Re(ue)?d.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,kn,Zt,ue.width,ue.height):n.renderbufferStorage(n.RENDERBUFFER,Zt,ue.width,ue.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function yt(ve,ue){if(ue&&ue.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,ve),!(ue.depthTexture&&ue.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ut=i.get(ue.depthTexture);ut.__renderTarget=ue,(!ut.__webglTexture||ue.depthTexture.image.width!==ue.width||ue.depthTexture.image.height!==ue.height)&&(ue.depthTexture.image.width=ue.width,ue.depthTexture.image.height=ue.height,ue.depthTexture.needsUpdate=!0),ue.depthTexture.image.depth!=1?Fe(ue.depthTexture,0):Ae(ue.depthTexture,0);const vt=ut.__webglTexture,pt=xe(ue);if(ue.isWebGLMultiviewRenderTarget===!0){const cn=Re(ue),Tt=ue.numViews;if(ue.depthTexture.format===Mp)cn?g.framebufferTextureMultisampleMultiviewOVR(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,vt,0,pt,0,Tt):g.framebufferTextureMultiviewOVR(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,vt,0,0,Tt);else if(ue.depthTexture.format===kp)cn?g.framebufferTextureMultisampleMultiviewOVR(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,vt,0,pt,0,Tt):g.framebufferTextureMultiviewOVR(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,vt,0,0,Tt);else throw new Error("Unknown depthTexture format")}else if(ue.depthTexture.format===Mp)Re(ue)?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,vt,0,pt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,vt,0);else if(ue.depthTexture.format===kp)Re(ue)?d.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,vt,0,pt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,vt,0);else throw new Error("Unknown depthTexture format")}function wt(ve){const ue=i.get(ve),Oe=ve.isWebGLCubeRenderTarget===!0;if(ue.__boundDepthTexture!==ve.depthTexture){const ut=ve.depthTexture;if(ue.__depthDisposeCallback&&ue.__depthDisposeCallback(),ut){const vt=()=>{delete ue.__boundDepthTexture,delete ue.__depthDisposeCallback,ut.removeEventListener("dispose",vt)};ut.addEventListener("dispose",vt),ue.__depthDisposeCallback=vt}ue.__boundDepthTexture=ut}if(ve.depthTexture&&!ue.__autoAllocateDepthBuffer){if(Oe)throw new Error("target.depthTexture not supported in Cube render targets");yt(ue.__webglFramebuffer,ve)}else if(Oe){ue.__webglDepthbuffer=[];for(let ut=0;ut<6;ut++)if(t.bindFramebuffer(n.FRAMEBUFFER,ue.__webglFramebuffer[ut]),ue.__webglDepthbuffer[ut]===void 0)ue.__webglDepthbuffer[ut]=n.createRenderbuffer(),ht(ue.__webglDepthbuffer[ut],ve,!1);else{const vt=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,pt=ue.__webglDepthbuffer[ut];n.bindRenderbuffer(n.RENDERBUFFER,pt),n.framebufferRenderbuffer(n.FRAMEBUFFER,vt,n.RENDERBUFFER,pt)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,ue.__webglFramebuffer),ue.__webglDepthbuffer===void 0)ue.__webglDepthbuffer=n.createRenderbuffer(),ht(ue.__webglDepthbuffer,ve,!1);else{const ut=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,vt=ue.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,vt),n.framebufferRenderbuffer(n.FRAMEBUFFER,ut,n.RENDERBUFFER,vt)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function Ee(ve,ue,Oe){const ut=i.get(ve);ue!==void 0&&Yt(ut.__webglFramebuffer,ve,ve.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Oe!==void 0&&wt(ve)}function Te(ve){const ue=ve.texture,Oe=i.get(ve),ut=i.get(ue);ve.addEventListener("dispose",j);const vt=ve.textures,pt=ve.isWebGLCubeRenderTarget===!0,cn=vt.length>1;if(cn||(ut.__webglTexture===void 0&&(ut.__webglTexture=n.createTexture()),ut.__version=ue.version,u.memory.textures++),pt){Oe.__webglFramebuffer=[];for(let Tt=0;Tt<6;Tt++)if(ue.mipmaps&&ue.mipmaps.length>0){Oe.__webglFramebuffer[Tt]=[];for(let Zt=0;Zt<ue.mipmaps.length;Zt++)Oe.__webglFramebuffer[Tt][Zt]=n.createFramebuffer()}else Oe.__webglFramebuffer[Tt]=n.createFramebuffer()}else{if(ue.mipmaps&&ue.mipmaps.length>0){Oe.__webglFramebuffer=[];for(let Tt=0;Tt<ue.mipmaps.length;Tt++)Oe.__webglFramebuffer[Tt]=n.createFramebuffer()}else Oe.__webglFramebuffer=n.createFramebuffer();if(cn)for(let Tt=0,Zt=vt.length;Tt<Zt;Tt++){const kn=i.get(vt[Tt]);kn.__webglTexture===void 0&&(kn.__webglTexture=n.createTexture(),u.memory.textures++)}if(ve.samples>0&&Re(ve)===!1){Oe.__webglMultisampledFramebuffer=n.createFramebuffer(),Oe.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,Oe.__webglMultisampledFramebuffer);for(let Tt=0;Tt<vt.length;Tt++){const Zt=vt[Tt];Oe.__webglColorRenderbuffer[Tt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Oe.__webglColorRenderbuffer[Tt]);const kn=l.convert(Zt.format,Zt.colorSpace),Ft=l.convert(Zt.type),vn=ne(Zt.internalFormat,kn,Ft,Zt.colorSpace,ve.isXRRenderTarget===!0),jn=xe(ve);n.renderbufferStorageMultisample(n.RENDERBUFFER,jn,vn,ve.width,ve.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Tt,n.RENDERBUFFER,Oe.__webglColorRenderbuffer[Tt])}n.bindRenderbuffer(n.RENDERBUFFER,null),ve.depthBuffer&&(Oe.__webglDepthRenderbuffer=n.createRenderbuffer(),ht(Oe.__webglDepthRenderbuffer,ve,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(pt){t.bindTexture(n.TEXTURE_CUBE_MAP,ut.__webglTexture),At(n.TEXTURE_CUBE_MAP,ue);for(let Tt=0;Tt<6;Tt++)if(ue.mipmaps&&ue.mipmaps.length>0)for(let Zt=0;Zt<ue.mipmaps.length;Zt++)Yt(Oe.__webglFramebuffer[Tt][Zt],ve,ue,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Tt,Zt);else Yt(Oe.__webglFramebuffer[Tt],ve,ue,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Tt,0);V(ue)&&G(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(cn){for(let Tt=0,Zt=vt.length;Tt<Zt;Tt++){const kn=vt[Tt],Ft=i.get(kn);t.bindTexture(n.TEXTURE_2D,Ft.__webglTexture),At(n.TEXTURE_2D,kn),Yt(Oe.__webglFramebuffer,ve,kn,n.COLOR_ATTACHMENT0+Tt,n.TEXTURE_2D,0),V(kn)&&G(n.TEXTURE_2D)}t.unbindTexture()}else{let Tt=n.TEXTURE_2D;if((ve.isWebGL3DRenderTarget||ve.isWebGLArrayRenderTarget)&&(Tt=ve.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),ve.isWebGLMultiviewRenderTarget===!0&&(Tt=n.TEXTURE_2D_ARRAY),t.bindTexture(Tt,ut.__webglTexture),At(Tt,ue),ue.mipmaps&&ue.mipmaps.length>0)for(let Zt=0;Zt<ue.mipmaps.length;Zt++)Yt(Oe.__webglFramebuffer[Zt],ve,ue,n.COLOR_ATTACHMENT0,Tt,Zt);else Yt(Oe.__webglFramebuffer,ve,ue,n.COLOR_ATTACHMENT0,Tt,0);V(ue)&&G(Tt),t.unbindTexture()}(ve.depthBuffer||ve.isWebGLMultiviewRenderTarget===!0)&&this.setupDepthRenderbuffer(ve)}function Gt(ve){const ue=ve.textures;for(let Oe=0,ut=ue.length;Oe<ut;Oe++){const vt=ue[Oe];if(V(vt)){const pt=q(ve),cn=i.get(vt).__webglTexture;t.bindTexture(pt,cn),G(pt),t.unbindTexture()}}}const Y=[],te=[];function ce(ve){if(ve.samples>0){if(Re(ve)===!1){const ue=ve.textures,Oe=ve.width,ut=ve.height;let vt=n.COLOR_BUFFER_BIT;const pt=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,cn=i.get(ve),Tt=ue.length>1;if(Tt)for(let Zt=0;Zt<ue.length;Zt++)t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Zt,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Zt,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,cn.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,cn.__webglFramebuffer);for(let Zt=0;Zt<ue.length;Zt++){if(ve.resolveDepthBuffer&&(ve.depthBuffer&&(vt|=n.DEPTH_BUFFER_BIT),ve.stencilBuffer&&ve.resolveStencilBuffer&&(vt|=n.STENCIL_BUFFER_BIT)),Tt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,cn.__webglColorRenderbuffer[Zt]);const kn=i.get(ue[Zt]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,kn,0)}n.blitFramebuffer(0,0,Oe,ut,0,0,Oe,ut,vt,n.NEAREST),p===!0&&(Y.length=0,te.length=0,Y.push(n.COLOR_ATTACHMENT0+Zt),ve.depthBuffer&&ve.resolveDepthBuffer===!1&&(Y.push(pt),te.push(pt),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,te)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Y))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Tt)for(let Zt=0;Zt<ue.length;Zt++){t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Zt,n.RENDERBUFFER,cn.__webglColorRenderbuffer[Zt]);const kn=i.get(ue[Zt]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,cn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Zt,n.TEXTURE_2D,kn,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,cn.__webglMultisampledFramebuffer)}else if(ve.depthBuffer&&ve.resolveDepthBuffer===!1&&p){const ue=ve.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[ue])}}}function xe(ve){return Math.min(s.maxSamples,ve.samples)}function Re(ve){const ue=i.get(ve);return ve.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&ue.__useRenderToTexture!==!1}function We(ve){const ue=u.render.frame;b.get(ve)!==ue&&(b.set(ve,ue),ve.update())}function at(ve,ue){const Oe=ve.colorSpace,ut=ve.format,vt=ve.type;return ve.isCompressedTexture===!0||ve.isVideoTexture===!0||Oe!==Yg&&Oe!==dd&&(Fi.getTransfer(Oe)===tr?(ut!==Ia||vt!==bh)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Oe)),ue}function ln(ve){return typeof HTMLImageElement<"u"&&ve instanceof HTMLImageElement?(x.width=ve.naturalWidth||ve.width,x.height=ve.naturalHeight||ve.height):typeof VideoFrame<"u"&&ve instanceof VideoFrame?(x.width=ve.displayWidth,x.height=ve.displayHeight):(x.width=ve.width,x.height=ve.height),x}this.allocateTextureUnit=Me,this.resetTextureUnits=$e,this.setTexture2D=Ae,this.setTexture2DArray=Fe,this.setTexture3D=Ie,this.setTextureCube=qe,this.rebindTextures=Ee,this.uploadTexture=It,this.setupRenderTarget=Te,this.updateRenderTargetMipmap=Gt,this.updateMultisampleRenderTarget=ce,this.setupDepthTexture=yt,this.setupDepthRenderbuffer=wt,this.setupFrameBufferTexture=Yt,this.useMultisampledRTT=Re,this.runDeferredUploads=Ze,this.setDeferTextureUploads=Et}function Dre(n,e){function t(i,s=dd){let l;const u=Fi.getTransfer(s);if(i===bh)return n.UNSIGNED_BYTE;if(i===ET)return n.UNSIGNED_SHORT_4_4_4_4;if(i===_T)return n.UNSIGNED_SHORT_5_5_5_1;if(i===nV)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===eV)return n.BYTE;if(i===tV)return n.SHORT;if(i===OA)return n.UNSIGNED_SHORT;if(i===CT)return n.INT;if(i===Hd)return n.UNSIGNED_INT;if(i===Ca)return n.FLOAT;if(i===ev)return n.HALF_FLOAT;if(i===iV)return n.ALPHA;if(i===rV)return n.RGB;if(i===Ia)return n.RGBA;if(i===sV)return n.LUMINANCE;if(i===oV)return n.LUMINANCE_ALPHA;if(i===Mp)return n.DEPTH_COMPONENT;if(i===kp)return n.DEPTH_STENCIL;if(i===IT)return n.RED;if(i===ow)return n.RED_INTEGER;if(i===aV)return n.RG;if(i===ST)return n.RG_INTEGER;if(i===TT)return n.RGBA_INTEGER;if(i===Sx||i===Tx||i===Mx||i===kx)if(u===tr)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(i===Sx)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Tx)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Mx)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===kx)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(i===Sx)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Tx)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Mx)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===kx)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===k2||i===R2||i===L2||i===B2)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(i===k2)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===R2)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===L2)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===B2)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===P2||i===N2||i===D2)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(i===P2||i===N2)return u===tr?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(i===D2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===F2||i===O2||i===V2||i===U2||i===z2||i===G2||i===W2||i===H2||i===X2||i===$2||i===Q2||i===K2||i===Z2||i===j2)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(i===F2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===O2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===V2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===U2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===z2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===G2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===W2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===H2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===X2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===$2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Q2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===K2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Z2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===j2)return u===tr?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===Rx||i===Y2||i===q2)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(i===Rx)return u===tr?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Y2)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===q2)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===lV||i===J2||i===eS||i===tS)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(i===Rx)return l.COMPRESSED_RED_RGTC1_EXT;if(i===J2)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===eS)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===tS)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Tp?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class Fre extends ou{constructor(e,t,i,s={}){super(e,t,s),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=i}copy(e){return super.copy(e),this.numViews=e.numViews,this}}Fre.prototype.isWebGLMultiviewRenderTarget=!0;const Jje=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,e7e=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class t7e{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const s=new Yr,l=e.properties.get(s);l.__webglTexture=t.texture,(t.depthNear!==i.depthNear||t.depthFar!==i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new au({vertexShader:Jje,fragmentShader:e7e,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ms(new iv(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class n7e extends Ch{constructor(e,t,i,s){super();const l=this;let u=null,d=1;var p=null;let g=null,x="local-floor",b=1,E=null,S=null;var M=[];let R=null,P=null,k=null,F=null;const V=new t7e,G=t.getContextAttributes();let q=null,ne=null;const K=[],Q=[],H=new St;let j=null;const ee=new Ao;ee.viewport=new Wi;const de=new Ao;de.viewport=new Wi;const oe=[ee,de],we=new _re;let $e=null,Me=null;this.cameraAutoUpdate=!0,this.layersEnabled=!1,this.enabled=!1,this.isPresenting=!1,this.isMultiview=!1,this.getCameraPose=function(){return S},this.getController=function(Ze){let It=K[Ze];return It===void 0&&(It=new hI,K[Ze]=It),It.getTargetRaySpace()},this.getControllerGrip=function(Ze){let It=K[Ze];return It===void 0&&(It=new hI,K[Ze]=It),It.getGripSpace()},this.getHand=function(Ze){let It=K[Ze];return It===void 0&&(It=new hI,K[Ze]=It),It.getHandSpace()};function Ne(Ze){const It=Q.indexOf(Ze.inputSource);if(It===-1)return;const Lt=K[It];Lt!==void 0&&(Lt.update(Ze.inputSource,Ze.frame,E||g),Lt.dispatchEvent({type:Ze.type,data:Ze.inputSource}))}function Ae(){u.removeEventListener("select",Ne),u.removeEventListener("selectstart",Ne),u.removeEventListener("selectend",Ne),u.removeEventListener("squeeze",Ne),u.removeEventListener("squeezestart",Ne),u.removeEventListener("squeezeend",Ne),u.removeEventListener("end",Ae),u.removeEventListener("inputsourceschange",Fe);for(let Ze=0;Ze<K.length;Ze++){const It=Q[Ze];It!==null&&(Q[Ze]=null,K[Ze].disconnect(It))}$e=null,Me=null,V.reset(),l.isPresenting=!1,e.setRenderTarget(q),k=null,P=null,R=null,u=null,ne=null,Et.stop(),e.setPixelRatio(j),e.setSize(H.width,H.height,!1),l.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ze){d=Ze,l.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ze){x=Ze,l.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return E||g},this.setReferenceSpace=function(Ze){E=Ze},this.getBaseLayer=function(){return P!==null?P:k},this.getBinding=function(){return R},this.getRenderTarget=function(){return ne},this.getFrame=function(){return F},this.getSession=function(){return u},this.setSession=async function(Ze){if(u=Ze,u!==null){if(q=e.getRenderTarget(),u.addEventListener("select",Ne),u.addEventListener("selectstart",Ne),u.addEventListener("selectend",Ne),u.addEventListener("squeeze",Ne),u.addEventListener("squeezestart",Ne),u.addEventListener("squeezeend",Ne),u.addEventListener("end",Ae),u.addEventListener("inputsourceschange",Fe),G.xrCompatible!==!0&&await t.makeXRCompatible(),j=e.getPixelRatio(),e.getSize(H),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let Lt=null,Yt=null,ht=null;G.depth&&(ht=G.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Lt=G.stencil?kp:Mp,Yt=G.stencil?Tp:Hd),l.isMultiview=s&&i.has("OCULUS_multiview");const yt={colorFormat:t.RGBA8,depthFormat:ht,scaleFactor:d};l.isMultiview&&(yt.textureType="texture-array"),R=new XRWebGLBinding(u,t),P=R.createProjectionLayer(yt),u.updateRenderState({layers:[P]}),e.setPixelRatio(1),e.setSize(P.textureWidth,P.textureHeight,!1);const wt={format:Ia,type:bh,depthTexture:new yV(P.textureWidth,P.textureHeight,Yt,void 0,void 0,void 0,void 0,void 0,void 0,Lt),stencilBuffer:G.stencil,colorSpace:e.outputColorSpace,samples:G.antialias?4:0,resolveDepthBuffer:P.ignoreDepthValues===!1};if(l.isMultiview){const Ee=i.get("OCULUS_multiview");this.maxNumViews=t.getParameter(Ee.MAX_VIEWS_OVR),ne=new Fre(P.textureWidth,P.textureHeight,2,wt)}else ne=new ou(P.textureWidth,P.textureHeight,wt)}else{const Lt={antialias:G.antialias,alpha:!0,depth:G.depth,stencil:G.stencil,framebufferScaleFactor:d};k=new XRWebGLLayer(u,t,Lt),u.updateRenderState({baseLayer:k}),e.setPixelRatio(1),e.setSize(k.framebufferWidth,k.framebufferHeight,!1),ne=new ou(k.framebufferWidth,k.framebufferHeight,{format:Ia,type:bh,colorSpace:e.outputColorSpace,stencilBuffer:G.stencil})}ne.isXRRenderTarget=!0,this.setFoveation(b),E=null,g=await u.requestReferenceSpace(x),Et.setContext(u),Et.start(),l.isPresenting=!0,l.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(u!==null)return u.environmentBlendMode},this.addLayer=function(Ze){!window.XRWebGLBinding||!this.layersEnabled||!u||(M.push(Ze),this.updateLayers())},this.removeLayer=function(Ze){M.splice(M.indexOf(Ze),1),!(!window.XRWebGLBinding||!this.layersEnabled||!u)&&this.updateLayers()},this.updateLayers=function(){var Ze=M.map(function(It){return It});Ze.unshift(u.renderState.layers[0]),u.updateRenderState({layers:Ze})},this.getDepthTexture=function(){return V.getDepthTexture()};function Fe(Ze){for(let It=0;It<Ze.removed.length;It++){const Lt=Ze.removed[It],Yt=Q.indexOf(Lt);Yt>=0&&(Q[Yt]=null,K[Yt].disconnect(Lt))}for(let It=0;It<Ze.added.length;It++){const Lt=Ze.added[It];let Yt=Q.indexOf(Lt);if(Yt===-1){for(let yt=0;yt<K.length;yt++)if(yt>=Q.length){Q.push(Lt),Yt=yt;break}else if(Q[yt]===null){Q[yt]=Lt,Yt=yt;break}if(Yt===-1)break}const ht=K[Yt];ht&&ht.connect(Lt)}}const Ie=new Ce,qe=new Ce;function dt(Ze,It,Lt){Ie.setFromMatrixPosition(It.matrixWorld),qe.setFromMatrixPosition(Lt.matrixWorld);const Yt=Ie.distanceTo(qe),ht=It.projectionMatrix.elements,yt=Lt.projectionMatrix.elements,wt=ht[14]/(ht[10]-1),Ee=ht[14]/(ht[10]+1),Te=(ht[9]+1)/ht[5],Gt=(ht[9]-1)/ht[5],Y=(ht[8]-1)/ht[0],te=(yt[8]+1)/yt[0],ce=wt*Y,xe=wt*te,Re=Yt/(-Y+te),We=Re*-Y;if(It.matrixWorld.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.translateX(We),Ze.translateZ(Re),Ze.matrixWorld.compose(Ze.position,Ze.quaternion,Ze.scale),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert(),ht[10]===-1)Ze.projectionMatrix.copy(It.projectionMatrix),Ze.projectionMatrixInverse.copy(It.projectionMatrixInverse);else{const at=wt+Re,ln=Ee+Re,ve=ce-We,ue=xe+(Yt-We),Oe=Te*Ee/ln*at,ut=Gt*Ee/ln*at;Ze.projectionMatrix.makePerspective(ve,ue,Oe,ut,at,ln),Ze.projectionMatrixInverse.copy(Ze.projectionMatrix).invert()}}function Wt(Ze,It){It===null?Ze.matrixWorld.copy(Ze.matrix):Ze.matrixWorld.multiplyMatrices(It.matrixWorld,Ze.matrix),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert()}this.setPoseTarget=function(Ze){Ze!==void 0&&(p=Ze)},this.updateCamera=function(Ze){if(u===null)return;let It=Ze.near,Lt=Ze.far;V.texture!==null&&(V.depthNear>0&&(It=V.depthNear),V.depthFar>0&&(Lt=V.depthFar)),we.near=de.near=ee.near=It,we.far=de.far=ee.far=Lt,($e!==we.near||Me!==we.far)&&(u.updateRenderState({depthNear:we.near,depthFar:we.far}),$e=we.near,Me=we.far),ee.layers.mask=Ze.layers.mask|2,de.layers.mask=Ze.layers.mask|4,we.layers.mask=ee.layers.mask|de.layers.mask;const Yt=we.cameras;var ht=p||Ze;const yt=ht.parent;Wt(we,yt);for(let wt=0;wt<Yt.length;wt++)Wt(Yt[wt],yt);Yt.length===2?dt(we,ee,de):we.projectionMatrix.copy(ee.projectionMatrix),xt(Ze,we,ht)};function xt(Ze,It,Lt){It.matrixWorld.decompose(It.position,It.quaternion,It.scale),Lt.parent===null?Lt.matrix.copy(It.matrixWorld):(Lt.matrix.copy(Lt.parent.matrixWorld),Lt.matrix.invert(),Lt.matrix.multiply(It.matrixWorld)),Lt.matrix.decompose(Lt.position,Lt.quaternion,Lt.scale),Lt.updateMatrixWorld(!0),Ze.projectionMatrix.copy(It.projectionMatrix),Ze.projectionMatrixInverse.copy(It.projectionMatrixInverse),Ze.isPerspectiveCamera&&(Ze.fov=VA*2*Math.atan(1/Ze.projectionMatrix.elements[5]),Ze.zoom=1)}this.getCamera=function(){return we},this.getFoveation=function(){if(!(P===null&&k===null))return b},this.setFoveation=function(Ze){b=Ze,P!==null&&(P.fixedFoveation=Ze),k!==null&&k.fixedFoveation!==void 0&&(k.fixedFoveation=Ze)},this.hasDepthSensing=function(){return V.texture!==null},this.getDepthSensingMesh=function(){return V.getMesh(we)};let At=null;function Rt(Ze,It){if(S=It.getViewerPose(E||g),F=It,S!==null){const Lt=S.views;k!==null&&(e.setRenderTargetFramebuffer(ne,k.framebuffer),e.setRenderTarget(ne));let Yt=!1;Lt.length!==we.cameras.length&&(we.cameras.length=0,Yt=!0);for(let wt=0;wt<Lt.length;wt++){const Ee=Lt[wt];let Te=null;if(k!==null)Te=k.getViewport(Ee);else{const Y=R.getViewSubImage(P,Ee);Te=Y.viewport,wt===0&&(e.setRenderTargetTextures(ne,Y.colorTexture,P.ignoreDepthValues?void 0:Y.depthStencilTexture),e.setRenderTarget(ne))}let Gt=oe[wt];Gt===void 0&&(Gt=new Ao,Gt.layers.enable(wt),Gt.viewport=new Wi,oe[wt]=Gt),Gt.matrix.fromArray(Ee.transform.matrix),Gt.matrix.decompose(Gt.position,Gt.quaternion,Gt.scale),Gt.projectionMatrix.fromArray(Ee.projectionMatrix),Gt.projectionMatrixInverse.copy(Gt.projectionMatrix).invert(),Gt.viewport.set(Te.x,Te.y,Te.width,Te.height),wt===0&&(we.matrix.copy(Gt.matrix),we.matrix.decompose(we.position,we.quaternion,we.scale)),Yt===!0&&we.cameras.push(Gt)}const ht=u.enabledFeatures;if(ht&&ht.includes("depth-sensing")&&u.depthUsage=="gpu-optimized"&&R){const wt=R.getDepthInformation(Lt[0]);wt&&wt.isValid&&wt.texture&&V.init(e,wt,u.renderState)}}for(let Lt=0;Lt<K.length;Lt++){const Yt=Q[Lt],ht=K[Lt];Yt!==null&&ht!==void 0&&ht.update(Yt,It,E||g)}At&&At(Ze,It),It.detectedPlanes&&l.dispatchEvent({type:"planesdetected",data:It}),F=null}const Et=new Rre;Et.setAnimationLoop(Rt),this.setAnimationLoop=function(Ze){At=Ze},this.dispose=function(){}}}const tg=new Ll,i7e=new Zn;function r7e(n,e){function t(P,k){P.matrixAutoUpdate===!0&&P.updateMatrix(),k.value.copy(P.matrix)}function i(P,k){k.color.getRGB(P.fogColor.value,kie(n)),k.isFog?(P.fogNear.value=k.near,P.fogFar.value=k.far):k.isFogExp2&&(P.fogDensity.value=k.density)}function s(P,k,F,V,G){k.isMeshBasicMaterial||k.isMeshLambertMaterial?l(P,k):k.isMeshToonMaterial?(l(P,k),b(P,k)):k.isMeshPhongMaterial?(l(P,k),x(P,k)):k.isMeshStandardMaterial?(l(P,k),E(P,k),k.isMeshPhysicalMaterial&&S(P,k,G)):k.isMeshMatcapMaterial?(l(P,k),M(P,k)):k.isMeshDepthMaterial?l(P,k):k.isMeshDistanceMaterial?(l(P,k),R(P,k)):k.isMeshNormalMaterial?l(P,k):k.isLineBasicMaterial?(u(P,k),k.isLineDashedMaterial&&d(P,k)):k.isPointsMaterial?p(P,k,F,V):k.isSpriteMaterial?g(P,k):k.isShadowMaterial?(P.color.value.copy(k.color),P.opacity.value=k.opacity):k.isShaderMaterial&&(k.uniformsNeedUpdate=!1)}function l(P,k){P.opacity.value=k.opacity,k.color&&P.diffuse.value.copy(k.color),k.emissive&&P.emissive.value.copy(k.emissive).multiplyScalar(k.emissiveIntensity),k.map&&(P.map.value=k.map,t(k.map,P.mapTransform)),k.alphaMap&&(P.alphaMap.value=k.alphaMap,t(k.alphaMap,P.alphaMapTransform)),k.bumpMap&&(P.bumpMap.value=k.bumpMap,t(k.bumpMap,P.bumpMapTransform),P.bumpScale.value=k.bumpScale,k.side===Ta&&(P.bumpScale.value*=-1)),k.normalMap&&(P.normalMap.value=k.normalMap,t(k.normalMap,P.normalMapTransform),P.normalScale.value.copy(k.normalScale),k.side===Ta&&P.normalScale.value.negate()),k.displacementMap&&(P.displacementMap.value=k.displacementMap,t(k.displacementMap,P.displacementMapTransform),P.displacementScale.value=k.displacementScale,P.displacementBias.value=k.displacementBias),k.emissiveMap&&(P.emissiveMap.value=k.emissiveMap,t(k.emissiveMap,P.emissiveMapTransform)),k.specularMap&&(P.specularMap.value=k.specularMap,t(k.specularMap,P.specularMapTransform)),k.alphaTest>0&&(P.alphaTest.value=k.alphaTest);const F=e.get(k),V=F.envMap,G=F.envMapRotation;V&&(P.envMap.value=V,tg.copy(G),tg.x*=-1,tg.y*=-1,tg.z*=-1,V.isCubeTexture&&V.isRenderTargetTexture===!1&&(tg.y*=-1,tg.z*=-1),P.envMapRotation.value.setFromMatrix4(i7e.makeRotationFromEuler(tg)),P.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=k.reflectivity,P.ior.value=k.ior,P.refractionRatio.value=k.refractionRatio),k.lightMap&&(P.lightMap.value=k.lightMap,P.lightMapIntensity.value=k.lightMapIntensity,t(k.lightMap,P.lightMapTransform)),k.aoMap&&(P.aoMap.value=k.aoMap,P.aoMapIntensity.value=k.aoMapIntensity,t(k.aoMap,P.aoMapTransform))}function u(P,k){P.diffuse.value.copy(k.color),P.opacity.value=k.opacity,k.map&&(P.map.value=k.map,t(k.map,P.mapTransform))}function d(P,k){P.dashSize.value=k.dashSize,P.totalSize.value=k.dashSize+k.gapSize,P.scale.value=k.scale}function p(P,k,F,V){P.diffuse.value.copy(k.color),P.opacity.value=k.opacity,P.size.value=k.size*F,P.scale.value=V*.5,k.map&&(P.map.value=k.map,t(k.map,P.uvTransform)),k.alphaMap&&(P.alphaMap.value=k.alphaMap,t(k.alphaMap,P.alphaMapTransform)),k.alphaTest>0&&(P.alphaTest.value=k.alphaTest)}function g(P,k){P.diffuse.value.copy(k.color),P.opacity.value=k.opacity,P.rotation.value=k.rotation,k.map&&(P.map.value=k.map,t(k.map,P.mapTransform)),k.alphaMap&&(P.alphaMap.value=k.alphaMap,t(k.alphaMap,P.alphaMapTransform)),k.alphaTest>0&&(P.alphaTest.value=k.alphaTest)}function x(P,k){P.specular.value.copy(k.specular),P.shininess.value=Math.max(k.shininess,1e-4)}function b(P,k){k.gradientMap&&(P.gradientMap.value=k.gradientMap)}function E(P,k){P.metalness.value=k.metalness,k.metalnessMap&&(P.metalnessMap.value=k.metalnessMap,t(k.metalnessMap,P.metalnessMapTransform)),P.roughness.value=k.roughness,k.roughnessMap&&(P.roughnessMap.value=k.roughnessMap,t(k.roughnessMap,P.roughnessMapTransform)),k.envMap&&(P.envMapIntensity.value=k.envMapIntensity)}function S(P,k,F){P.ior.value=k.ior,k.sheen>0&&(P.sheenColor.value.copy(k.sheenColor).multiplyScalar(k.sheen),P.sheenRoughness.value=k.sheenRoughness,k.sheenColorMap&&(P.sheenColorMap.value=k.sheenColorMap,t(k.sheenColorMap,P.sheenColorMapTransform)),k.sheenRoughnessMap&&(P.sheenRoughnessMap.value=k.sheenRoughnessMap,t(k.sheenRoughnessMap,P.sheenRoughnessMapTransform))),k.clearcoat>0&&(P.clearcoat.value=k.clearcoat,P.clearcoatRoughness.value=k.clearcoatRoughness,k.clearcoatMap&&(P.clearcoatMap.value=k.clearcoatMap,t(k.clearcoatMap,P.clearcoatMapTransform)),k.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=k.clearcoatRoughnessMap,t(k.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),k.clearcoatNormalMap&&(P.clearcoatNormalMap.value=k.clearcoatNormalMap,t(k.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(k.clearcoatNormalScale),k.side===Ta&&P.clearcoatNormalScale.value.negate())),k.dispersion>0&&(P.dispersion.value=k.dispersion),k.iridescence>0&&(P.iridescence.value=k.iridescence,P.iridescenceIOR.value=k.iridescenceIOR,P.iridescenceThicknessMinimum.value=k.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=k.iridescenceThicknessRange[1],k.iridescenceMap&&(P.iridescenceMap.value=k.iridescenceMap,t(k.iridescenceMap,P.iridescenceMapTransform)),k.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=k.iridescenceThicknessMap,t(k.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),k.transmission>0&&(P.transmission.value=k.transmission,P.transmissionSamplerMap.value=F.texture,P.transmissionSamplerSize.value.set(F.width,F.height),k.transmissionMap&&(P.transmissionMap.value=k.transmissionMap,t(k.transmissionMap,P.transmissionMapTransform)),P.thickness.value=k.thickness,k.thicknessMap&&(P.thicknessMap.value=k.thicknessMap,t(k.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=k.attenuationDistance,P.attenuationColor.value.copy(k.attenuationColor)),k.anisotropy>0&&(P.anisotropyVector.value.set(k.anisotropy*Math.cos(k.anisotropyRotation),k.anisotropy*Math.sin(k.anisotropyRotation)),k.anisotropyMap&&(P.anisotropyMap.value=k.anisotropyMap,t(k.anisotropyMap,P.anisotropyMapTransform))),P.specularIntensity.value=k.specularIntensity,P.specularColor.value.copy(k.specularColor),k.specularColorMap&&(P.specularColorMap.value=k.specularColorMap,t(k.specularColorMap,P.specularColorMapTransform)),k.specularIntensityMap&&(P.specularIntensityMap.value=k.specularIntensityMap,t(k.specularIntensityMap,P.specularIntensityMapTransform))}function M(P,k){k.matcap&&(P.matcap.value=k.matcap)}function R(P,k){const F=e.get(k).light;P.referencePosition.value.setFromMatrixPosition(F.matrixWorld),P.nearDistance.value=F.shadow.camera.near,P.farDistance.value=F.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function s7e(n,e,t,i){let s={},l={},u=[];const d=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function p(F,V){const G=V.program;i.uniformBlockBinding(F,G)}function g(F,V){let G=s[F.id];G===void 0&&(M(F),G=x(F),s[F.id]=G,F.addEventListener("dispose",P));const q=V.program;i.updateUBOMapping(F,q);const ne=e.render.frame;l[F.id]!==ne&&(E(F),l[F.id]=ne)}function x(F){const V=b();F.__bindingPointIndex=V;const G=n.createBuffer(),q=F.__size,ne=F.usage;return n.bindBuffer(n.UNIFORM_BUFFER,G),n.bufferData(n.UNIFORM_BUFFER,q,ne),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,V,G),G}function b(){for(let F=0;F<d;F++)if(u.indexOf(F)===-1)return u.push(F),F;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function E(F){const V=s[F.id],G=F.uniforms,q=F.__cache;n.bindBuffer(n.UNIFORM_BUFFER,V);for(let ne=0,K=G.length;ne<K;ne++){const Q=Array.isArray(G[ne])?G[ne]:[G[ne]];for(let H=0,j=Q.length;H<j;H++){const ee=Q[H];if(S(ee,ne,H,q)===!0){const de=ee.__offset,oe=Array.isArray(ee.value)?ee.value:[ee.value];let we=0;for(let $e=0;$e<oe.length;$e++){const Me=oe[$e],Ne=R(Me);typeof Me=="number"||typeof Me=="boolean"?(ee.__data[0]=Me,n.bufferSubData(n.UNIFORM_BUFFER,de+we,ee.__data)):Me.isMatrix3?(ee.__data[0]=Me.elements[0],ee.__data[1]=Me.elements[1],ee.__data[2]=Me.elements[2],ee.__data[3]=0,ee.__data[4]=Me.elements[3],ee.__data[5]=Me.elements[4],ee.__data[6]=Me.elements[5],ee.__data[7]=0,ee.__data[8]=Me.elements[6],ee.__data[9]=Me.elements[7],ee.__data[10]=Me.elements[8],ee.__data[11]=0):(Me.toArray(ee.__data,we),we+=Ne.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,de,ee.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function S(F,V,G,q){const ne=F.value,K=V+"_"+G;if(q[K]===void 0)return typeof ne=="number"||typeof ne=="boolean"?q[K]=ne:q[K]=ne.clone(),!0;{const Q=q[K];if(typeof ne=="number"||typeof ne=="boolean"){if(Q!==ne)return q[K]=ne,!0}else if(Q.equals(ne)===!1)return Q.copy(ne),!0}return!1}function M(F){const V=F.uniforms;let G=0;const q=16;for(let K=0,Q=V.length;K<Q;K++){const H=Array.isArray(V[K])?V[K]:[V[K]];for(let j=0,ee=H.length;j<ee;j++){const de=H[j],oe=Array.isArray(de.value)?de.value:[de.value];for(let we=0,$e=oe.length;we<$e;we++){const Me=oe[we],Ne=R(Me),Ae=G%q,Fe=Ae%Ne.boundary,Ie=Ae+Fe;G+=Fe,Ie!==0&&q-Ie<Ne.storage&&(G+=q-Ie),de.__data=new Float32Array(Ne.storage/Float32Array.BYTES_PER_ELEMENT),de.__offset=G,G+=Ne.storage}}}const ne=G%q;return ne>0&&(G+=q-ne),F.__size=G,F.__cache={},this}function R(F){const V={boundary:0,storage:0};return typeof F=="number"||typeof F=="boolean"?(V.boundary=4,V.storage=4):F.isVector2?(V.boundary=8,V.storage=8):F.isVector3||F.isColor?(V.boundary=16,V.storage=12):F.isVector4?(V.boundary=16,V.storage=16):F.isMatrix3?(V.boundary=48,V.storage=48):F.isMatrix4?(V.boundary=64,V.storage=64):F.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",F),V}function P(F){const V=F.target;V.removeEventListener("dispose",P);const G=u.indexOf(V.__bindingPointIndex);u.splice(G,1),n.deleteBuffer(s[V.id]),delete s[V.id],delete l[V.id]}function k(){for(const F in s)n.deleteBuffer(s[F]);u=[],s={},l={}}return{bind:p,update:g,dispose:k}}class o7e{constructor(e={}){const{canvas:t=Sie(),context:i=null,depth:s=!0,stencil:l=!1,alpha:u=!1,antialias:d=!1,premultipliedAlpha:p=!0,preserveDrawingBuffer:g=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:b=!1,reverseDepthBuffer:E=!1,multiviewStereo:S=!1}=e;this.isWebGLRenderer=!0;let M;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");M=i.getContextAttributes().alpha}else M=u;const R=new Uint32Array(4),P=new Int32Array(4);let k=null,F=null;const V=[],G=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Za,this.toneMapping=Td,this.toneMappingExposure=1;const q=this;let ne=!1,K=0,Q=0,H=null,j=-1,ee=null;const de=new Wi,oe=new Wi;let we=null;const $e=new An(0);let Me=0,Ne=t.width,Ae=t.height,Fe=1,Ie=null,qe=null;const dt=new Wi(0,0,Ne,Ae),Wt=new Wi(0,0,Ne,Ae);let xt=!1;const At=new cw;let Rt=!1,Et=!1;this.transmissionResolutionScale=1;const Ze=new Zn,It=new Zn,Lt=new Ce,Yt=new Wi,ht={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let yt=!1;function wt(){return H===null?Fe:1}let Ee=i;function Te(pe,ze){return t.getContext(pe,ze)}try{const pe={alpha:!0,depth:s,stencil:l,antialias:d,premultipliedAlpha:p,preserveDrawingBuffer:g,powerPreference:x,failIfMajorPerformanceCaveat:b};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${xT}`),t.addEventListener("webglcontextlost",sn,!1),t.addEventListener("webglcontextrestored",Rn,!1),t.addEventListener("webglcontextcreationerror",tn,!1),Ee===null){const ze="webgl2";if(Ee=Te(ze,pe),Ee===null)throw Te(ze)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(pe){throw console.error("THREE.WebGLRenderer: "+pe.message),pe}let Gt,Y,te,ce,xe,Re,We,at,ln,ve,ue,Oe,ut,vt,pt,cn,Tt,Zt,kn,Ft,vn,jn,Pe,ft,Pt;function Dt(){Gt=new g8e(Ee),Gt.init(),Pe=new Dre(Ee,Gt),Y=new u8e(Ee,Gt,e,Pe),te=new Yje(Ee,Gt),Y.reverseDepthBuffer&&E&&te.buffers.depth.setReversed(!0),ce=new v8e(Ee),xe=new Oje,Re=new qje(Ee,Gt,te,xe,Y,Pe,ce),We=new d8e(q),at=new m8e(q),ln=new IKe(Ee),ft=new l8e(Ee,ln),ve=new y8e(Ee,ln,ce,ft),ue=new w8e(Ee,ve,ln,ce),Ft=new b8e(Ee,Y,Re),cn=new h8e(xe),Oe=new Fje(q,We,at,Gt,Y,ft,cn),ut=new r7e(q,xe),vt=new Uje,pt=new $je(Gt),kn=new a8e(q,We,at,te,ue,M,p),Zt=new x8e(q,Gt,Ee),Tt=new Zje(q,ue,Y),Pt=new s7e(Ee,ce,Y,te),vn=new c8e(Ee,Gt,ce),jn=new A8e(Ee,Gt,ce),ce.programs=Oe.programs,q.capabilities=Y,q.extensions=Gt,q.properties=xe,q.renderLists=vt,q.shadowMap=Tt,q.state=te,q.info=ce}Dt();const qt=new n7e(q,Ee);this.xr=qt,this.getContext=function(){return Ee},this.getContextAttributes=function(){return Ee.getContextAttributes()},this.forceContextLoss=function(){const pe=Gt.get("WEBGL_lose_context");pe&&pe.loseContext()},this.forceContextRestore=function(){const pe=Gt.get("WEBGL_lose_context");pe&&pe.restoreContext()},this.getPixelRatio=function(){return Fe},this.setPixelRatio=function(pe){pe!==void 0&&(Fe=pe,this.setSize(Ne,Ae,!1))},this.getSize=function(pe){return pe.set(Ne,Ae)},this.setSize=function(pe,ze,nt=!0){if(qt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Ne=pe,Ae=ze,t.width=Math.floor(pe*Fe),t.height=Math.floor(ze*Fe),nt===!0&&(t.style.width=pe+"px",t.style.height=ze+"px"),this.setViewport(0,0,pe,ze)},this.getDrawingBufferSize=function(pe){return pe.set(Ne*Fe,Ae*Fe).floor()},this.setDrawingBufferSize=function(pe,ze,nt){Ne=pe,Ae=ze,Fe=nt,t.width=Math.floor(pe*nt),t.height=Math.floor(ze*nt),this.setViewport(0,0,pe,ze)},this.getCurrentViewport=function(pe){return pe.copy(de)},this.getViewport=function(pe){return pe.copy(dt)},this.setViewport=function(pe,ze,nt,rt){pe.isVector4?dt.set(pe.x,pe.y,pe.z,pe.w):dt.set(pe,ze,nt,rt),te.viewport(de.copy(dt).multiplyScalar(Fe).round())},this.getScissor=function(pe){return pe.copy(Wt)},this.setScissor=function(pe,ze,nt,rt){pe.isVector4?Wt.set(pe.x,pe.y,pe.z,pe.w):Wt.set(pe,ze,nt,rt),te.scissor(oe.copy(Wt).multiplyScalar(Fe).round())},this.getScissorTest=function(){return xt},this.setScissorTest=function(pe){te.setScissorTest(xt=pe)},this.setOpaqueSort=function(pe){Ie=pe},this.setTransparentSort=function(pe){qe=pe},this.getClearColor=function(pe){return pe.copy(kn.getClearColor())},this.setClearColor=function(){kn.setClearColor.apply(kn,arguments)},this.getClearAlpha=function(){return kn.getClearAlpha()},this.setClearAlpha=function(){kn.setClearAlpha.apply(kn,arguments)},this.clear=function(pe=!0,ze=!0,nt=!0){let rt=0;if(pe){let Ge=!1;if(H!==null){const Nt=H.texture.format;Ge=Nt===TT||Nt===ST||Nt===ow}if(Ge){const Nt=H.texture.type,Kt=Nt===bh||Nt===Hd||Nt===OA||Nt===Tp||Nt===ET||Nt===_T,on=kn.getClearColor(),dn=kn.getClearAlpha(),Ln=on.r,Sn=on.g,zt=on.b;Kt?(R[0]=Ln,R[1]=Sn,R[2]=zt,R[3]=dn,Ee.clearBufferuiv(Ee.COLOR,0,R)):(P[0]=Ln,P[1]=Sn,P[2]=zt,P[3]=dn,Ee.clearBufferiv(Ee.COLOR,0,P))}else rt|=Ee.COLOR_BUFFER_BIT}ze&&(rt|=Ee.DEPTH_BUFFER_BIT),nt&&(rt|=Ee.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Ee.clear(rt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",sn,!1),t.removeEventListener("webglcontextrestored",Rn,!1),t.removeEventListener("webglcontextcreationerror",tn,!1),kn.dispose(),vt.dispose(),pt.dispose(),xe.dispose(),We.dispose(),at.dispose(),ue.dispose(),ft.dispose(),Pt.dispose(),Oe.dispose(),qt.dispose(),qt.removeEventListener("sessionstart",Dl),qt.removeEventListener("sessionend",qr),hn.stop()};function sn(pe){pe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ne=!0}function Rn(){console.log("THREE.WebGLRenderer: Context Restored."),ne=!1;const pe=ce.autoReset,ze=Tt.enabled,nt=Tt.autoUpdate,rt=Tt.needsUpdate,Ge=Tt.type;Dt(),ce.autoReset=pe,Tt.enabled=ze,Tt.autoUpdate=nt,Tt.needsUpdate=rt,Tt.type=Ge}function tn(pe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",pe.statusMessage)}function Jt(pe){const ze=pe.target;ze.removeEventListener("dispose",Jt),fn(ze)}function fn(pe){ei(pe),xe.remove(pe)}function ei(pe){const ze=xe.get(pe).programs;ze!==void 0&&(ze.forEach(function(nt){Oe.releaseProgram(nt)}),pe.isShaderMaterial&&Oe.releaseShaderCache(pe))}this.renderBufferDirect=function(pe,ze,nt,rt,Ge,Nt){ze===null&&(ze=ht);const Kt=Ge.isMesh&&Ge.matrixWorld.determinant()<0,on=uu(pe,ze,nt,rt,Ge);te.setMaterial(rt,Kt);let dn=nt.index,Ln=1;if(rt.wireframe===!0){if(dn=ve.getWireframeAttribute(nt),dn===void 0)return;Ln=2}const Sn=nt.drawRange,zt=nt.attributes.position;let gn=Sn.start*Ln,Hn=(Sn.start+Sn.count)*Ln;Nt!==null&&(gn=Math.max(gn,Nt.start*Ln),Hn=Math.min(Hn,(Nt.start+Nt.count)*Ln)),dn!==null?(gn=Math.max(gn,0),Hn=Math.min(Hn,dn.count)):zt!=null&&(gn=Math.max(gn,0),Hn=Math.min(Hn,zt.count));const Ci=Hn-gn;if(Ci<0||Ci===1/0)return;ft.setup(Ge,rt,on,nt,dn);let bi,Yn=vn;if(dn!==null&&(bi=ln.get(dn),Yn=jn,Yn.setIndex(bi)),Ge.isMesh)rt.wireframe===!0?(te.setLineWidth(rt.wireframeLinewidth*wt()),Yn.setMode(Ee.LINES)):Yn.setMode(Ee.TRIANGLES);else if(Ge.isLine){let Ht=rt.linewidth;Ht===void 0&&(Ht=1),te.setLineWidth(Ht*wt()),Ge.isLineSegments?Yn.setMode(Ee.LINES):Ge.isLineLoop?Yn.setMode(Ee.LINE_LOOP):Yn.setMode(Ee.LINE_STRIP)}else Ge.isPoints?Yn.setMode(Ee.POINTS):Ge.isSprite&&Yn.setMode(Ee.TRIANGLES);if(Ge.isBatchedMesh)if(Ge._multiDrawInstances!==null)Yn.renderMultiDrawInstances(Ge._multiDrawStarts,Ge._multiDrawCounts,Ge._multiDrawCount,Ge._multiDrawInstances);else if(Gt.get("WEBGL_multi_draw"))Yn.renderMultiDraw(Ge._multiDrawStarts,Ge._multiDrawCounts,Ge._multiDrawCount);else{const Ht=Ge._multiDrawStarts,jt=Ge._multiDrawCounts,us=Ge._multiDrawCount,ti=dn?ln.get(dn).bytesPerElement:1,Oi=xe.get(rt).currentProgram.getUniforms();for(let Jr=0;Jr<us;Jr++)Oi.setValue(Ee,"_gl_DrawID",Jr),Yn.render(Ht[Jr]/ti,jt[Jr])}else if(Ge.isInstancedMesh)Yn.renderInstances(gn,Ci,Ge.count);else if(nt.isInstancedBufferGeometry){const Ht=nt._maxInstanceCount!==void 0?nt._maxInstanceCount:1/0,jt=Math.min(nt.instanceCount,Ht);Yn.renderInstances(gn,Ci,jt)}else Yn.render(gn,Ci)};function ar(pe,ze,nt){pe.transparent===!0&&pe.side===nh&&pe.forceSinglePass===!1?(pe.side=Ta,pe.needsUpdate=!0,na(pe,ze,nt),pe.side=Gd,pe.needsUpdate=!0,na(pe,ze,nt),pe.side=nh):na(pe,ze,nt)}this.compile=function(pe,ze,nt=null){nt===null&&(nt=pe),F=pt.get(nt),F.init(ze),G.push(F),nt.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(ze.layers)&&(F.pushLight(Ge),Ge.castShadow&&F.pushShadow(Ge))}),pe!==nt&&pe.traverseVisible(function(Ge){Ge.isLight&&Ge.layers.test(ze.layers)&&(F.pushLight(Ge),Ge.castShadow&&F.pushShadow(Ge))}),F.setupLights();const rt=new Set;return pe.traverse(function(Ge){if(!(Ge.isMesh||Ge.isPoints||Ge.isLine||Ge.isSprite))return;const Nt=Ge.material;if(Nt)if(Array.isArray(Nt))for(let Kt=0;Kt<Nt.length;Kt++){const on=Nt[Kt];ar(on,nt,Ge),rt.add(on)}else ar(Nt,nt,Ge),rt.add(Nt)}),G.pop(),F=null,rt},this.compileAsync=function(pe,ze,nt=null){const rt=this.compile(pe,ze,nt);return new Promise(Ge=>{function Nt(){if(rt.forEach(function(Kt){xe.get(Kt).currentProgram.isReady()&&rt.delete(Kt)}),rt.size===0){Ge(pe);return}setTimeout(Nt,10)}Gt.get("KHR_parallel_shader_compile")!==null?Nt():setTimeout(Nt,10)})};let ta=null;function yc(pe){ta&&ta(pe)}function Dl(){hn.stop()}function qr(){hn.start()}const hn=new Rre;hn.setAnimationLoop(yc),typeof self<"u"&&hn.setContext(self),this.setAnimationLoop=function(pe){ta=pe,qt.setAnimationLoop(pe),pe===null?hn.stop():hn.start()},qt.addEventListener("sessionstart",Dl),qt.addEventListener("sessionend",qr),this.render=function(pe,ze){if(ze!==void 0&&ze.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ne===!0)return;if(pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),ze.parent===null&&ze.matrixWorldAutoUpdate===!0&&ze.updateMatrixWorld(),qt.enabled===!0&&qt.isPresenting===!0&&(qt.cameraAutoUpdate===!0&&qt.updateCamera(ze),ze=qt.getCamera()),pe.isScene===!0&&pe.onBeforeRender(q,pe,ze,H),F=pt.get(pe,G.length),F.init(ze),G.push(F),It.multiplyMatrices(ze.projectionMatrix,ze.matrixWorldInverse),At.setFromProjectionMatrix(It),Et=this.localClippingEnabled,Rt=cn.init(this.clippingPlanes,Et),k=vt.get(pe,V.length),k.init(),V.push(k),qt.enabled===!0&&qt.isPresenting===!0){const Nt=q.xr.getDepthSensingMesh();Nt!==null&&al(Nt,ze,-1/0,q.sortObjects)}al(pe,ze,0,q.sortObjects),k.finish(),q.sortObjects===!0&&k.sort(Ie,qe),yt=qt.enabled===!1||qt.isPresenting===!1||qt.hasDepthSensing()===!1,yt&&kn.addToRenderList(k,pe),this.info.render.frame++,Rt===!0&&cn.beginShadows();const nt=F.state.shadowsArray;Tt.render(nt,pe,ze),Rt===!0&&cn.endShadows(),this.info.autoReset===!0&&this.info.reset();const rt=k.opaque,Ge=k.transmissive;if(F.setupLights(),ze.isArrayCamera){const Nt=ze.cameras;if(Ge.length>0)for(let Kt=0,on=Nt.length;Kt<on;Kt++){const dn=Nt[Kt];Fl(rt,Ge,pe,dn)}if(yt&&kn.render(pe),qt.enabled&&qt.isMultiview)Re.setDeferTextureUploads(!0),ks(k,pe,ze,ze.cameras[0].viewport);else for(let Kt=0,on=Nt.length;Kt<on;Kt++){const dn=Nt[Kt];ks(k,pe,dn,dn.viewport)}}else Ge.length>0&&Fl(rt,Ge,pe,ze),yt&&kn.render(pe),ks(k,pe,ze);H!==null&&Q===0&&(Re.updateMultisampleRenderTarget(H),Re.updateRenderTargetMipmap(H)),pe.isScene===!0&&pe.onAfterRender(q,pe,ze),ft.resetDefaultState(),j=-1,ee=null,G.pop(),G.length>0?(F=G[G.length-1],Rt===!0&&cn.setGlobalState(q.clippingPlanes,F.state.camera)):F=null,V.pop(),V.length>0?k=V[V.length-1]:k=null};function al(pe,ze,nt,rt){if(pe.visible===!1)return;if(pe.layers.test(ze.layers)){if(pe.isGroup)nt=pe.renderOrder;else if(pe.isLOD)pe.autoUpdate===!0&&pe.update(ze);else if(pe.isLight)F.pushLight(pe),pe.castShadow&&F.pushShadow(pe);else if(pe.isSprite){if(!pe.frustumCulled||At.intersectsSprite(pe)){rt&&Yt.setFromMatrixPosition(pe.matrixWorld).applyMatrix4(It);const Kt=ue.update(pe),on=pe.material;on.visible&&k.push(pe,Kt,on,nt,Yt.z,null)}}else if((pe.isMesh||pe.isLine||pe.isPoints)&&(!pe.frustumCulled||At.intersectsObject(pe))){const Kt=ue.update(pe),on=pe.material;if(rt&&(pe.boundingSphere!==void 0?(pe.boundingSphere===null&&pe.computeBoundingSphere(),Yt.copy(pe.boundingSphere.center)):(Kt.boundingSphere===null&&Kt.computeBoundingSphere(),Yt.copy(Kt.boundingSphere.center)),Yt.applyMatrix4(pe.matrixWorld).applyMatrix4(It)),Array.isArray(on)){const dn=Kt.groups;for(let Ln=0,Sn=dn.length;Ln<Sn;Ln++){const zt=dn[Ln],gn=on[zt.materialIndex];gn&&gn.visible&&k.push(pe,Kt,gn,nt,Yt.z,zt)}}else on.visible&&k.push(pe,Kt,on,nt,Yt.z,null)}}const Nt=pe.children;for(let Kt=0,on=Nt.length;Kt<on;Kt++)al(Nt[Kt],ze,nt,rt)}function ks(pe,ze,nt,rt){const Ge=pe.opaque,Nt=pe.transmissive,Kt=pe.transparent;F.setupLightsView(nt),Rt===!0&&cn.setGlobalState(q.clippingPlanes,nt),rt&&te.viewport(de.copy(rt)),Ge.length>0&&Io(Ge,ze,nt),Nt.length>0&&Io(Nt,ze,nt),Kt.length>0&&Io(Kt,ze,nt),te.buffers.depth.setTest(!0),te.buffers.depth.setMask(!0),te.buffers.color.setMask(!0),te.setPolygonOffset(!1)}function Fl(pe,ze,nt,rt){if((nt.isScene===!0?nt.overrideMaterial:null)!==null)return;F.state.transmissionRenderTarget[rt.id]===void 0&&(F.state.transmissionRenderTarget[rt.id]=new ou(1,1,{generateMipmaps:!0,type:Gt.has("EXT_color_buffer_half_float")||Gt.has("EXT_color_buffer_float")?ev:bh,minFilter:ih,samples:4,stencilBuffer:l,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Fi.workingColorSpace}));const Nt=F.state.transmissionRenderTarget[rt.id],Kt=rt.viewport||de;Nt.setSize(Kt.z*q.transmissionResolutionScale,Kt.w*q.transmissionResolutionScale);const on=q.getRenderTarget();q.setRenderTarget(Nt),q.getClearColor($e),Me=q.getClearAlpha(),Me<1&&q.setClearColor(16777215,.5),q.clear(),yt&&kn.render(nt);const dn=q.toneMapping;q.toneMapping=Td;const Ln=rt.viewport;if(rt.viewport!==void 0&&(rt.viewport=void 0),F.setupLightsView(rt),Rt===!0&&cn.setGlobalState(q.clippingPlanes,rt),Io(pe,nt,rt),Re.updateMultisampleRenderTarget(Nt),Re.updateRenderTargetMipmap(Nt),Gt.has("WEBGL_multisampled_render_to_texture")===!1){let Sn=!1;for(let zt=0,gn=ze.length;zt<gn;zt++){const Hn=ze[zt],Ci=Hn.object,bi=Hn.geometry,Yn=Hn.material,Ht=Hn.group;if(Yn.side===nh&&Ci.layers.test(rt.layers)){const jt=Yn.side;Yn.side=Ta,Yn.needsUpdate=!0,So(Ci,nt,rt,bi,Yn,Ht),Yn.side=jt,Yn.needsUpdate=!0,Sn=!0}}Sn===!0&&(Re.updateMultisampleRenderTarget(Nt),Re.updateRenderTargetMipmap(Nt))}q.setRenderTarget(on),q.setClearColor($e,Me),Ln!==void 0&&(rt.viewport=Ln),q.toneMapping=dn}function Io(pe,ze,nt){const rt=ze.isScene===!0?ze.overrideMaterial:null;for(let Ge=0,Nt=pe.length;Ge<Nt;Ge++){const Kt=pe[Ge],on=Kt.object,dn=Kt.geometry,Ln=rt===null?Kt.material:rt,Sn=Kt.group;on.layers.test(nt.layers)&&So(on,ze,nt,dn,Ln,Sn)}}function So(pe,ze,nt,rt,Ge,Nt){pe.onBeforeRender(q,ze,nt,rt,Ge,Nt),pe.modelViewMatrix.multiplyMatrices(nt.matrixWorldInverse,pe.matrixWorld),pe.normalMatrix.getNormalMatrix(pe.modelViewMatrix),Ge.onBeforeRender(q,ze,nt,rt,pe,Nt),Ge.transparent===!0&&Ge.side===nh&&Ge.forceSinglePass===!1?(Ge.side=Ta,Ge.needsUpdate=!0,q.renderBufferDirect(nt,ze,rt,Ge,pe,Nt),Ge.side=Gd,Ge.needsUpdate=!0,q.renderBufferDirect(nt,ze,rt,Ge,pe,Nt),Ge.side=nh):q.renderBufferDirect(nt,ze,rt,Ge,pe,Nt),pe.onAfterRender(q,ze,nt,rt,Ge,Nt)}function na(pe,ze,nt){ze.isScene!==!0&&(ze=ht);const rt=xe.get(pe),Ge=F.state.lights,Nt=F.state.shadowsArray,Kt=Ge.state.version,on=Oe.getParameters(pe,Ge.state,Nt,ze,nt),dn=Oe.getProgramCacheKey(on);let Ln=rt.programs;rt.environment=pe.isMeshStandardMaterial?ze.environment:null,rt.fog=ze.fog,rt.envMap=(pe.isMeshStandardMaterial?at:We).get(pe.envMap||rt.environment),rt.envMapRotation=rt.environment!==null&&pe.envMap===null?ze.environmentRotation:pe.envMapRotation,Ln===void 0&&(pe.addEventListener("dispose",Jt),Ln=new Map,rt.programs=Ln);let Sn=Ln.get(dn);if(Sn!==void 0){if(rt.currentProgram===Sn&&rt.lightsStateVersion===Kt)return Ac(pe,on),Sn}else on.uniforms=Oe.getUniforms(pe),pe.onBeforeCompile(on,q),Sn=Oe.acquireProgram(on,dn),Ln.set(dn,Sn),rt.uniforms=on.uniforms;const zt=rt.uniforms;return(!pe.isShaderMaterial&&!pe.isRawShaderMaterial||pe.clipping===!0)&&(zt.clippingPlanes=cn.uniform),Ac(pe,on),rt.needsLights=ll(pe),rt.lightsStateVersion=Kt,rt.needsLights&&(zt.ambientLightColor.value=Ge.state.ambient,zt.lightProbe.value=Ge.state.probe,zt.directionalLights.value=Ge.state.directional,zt.directionalLightShadows.value=Ge.state.directionalShadow,zt.spotLights.value=Ge.state.spot,zt.spotLightShadows.value=Ge.state.spotShadow,zt.rectAreaLights.value=Ge.state.rectArea,zt.ltc_1.value=Ge.state.rectAreaLTC1,zt.ltc_2.value=Ge.state.rectAreaLTC2,zt.pointLights.value=Ge.state.point,zt.pointLightShadows.value=Ge.state.pointShadow,zt.hemisphereLights.value=Ge.state.hemi,zt.directionalShadowMap.value=Ge.state.directionalShadowMap,zt.directionalShadowMatrix.value=Ge.state.directionalShadowMatrix,zt.spotShadowMap.value=Ge.state.spotShadowMap,zt.spotLightMatrix.value=Ge.state.spotLightMatrix,zt.spotLightMap.value=Ge.state.spotLightMap,zt.pointShadowMap.value=Ge.state.pointShadowMap,zt.pointShadowMatrix.value=Ge.state.pointShadowMatrix),rt.currentProgram=Sn,rt.uniformsList=null,Sn}function ro(pe){if(pe.uniformsList===null){const ze=pe.currentProgram.getUniforms();pe.uniformsList=dI.seqWithValue(ze.seq,pe.uniforms)}return pe.uniformsList}function Ac(pe,ze){const nt=xe.get(pe);nt.outputColorSpace=ze.outputColorSpace,nt.batching=ze.batching,nt.batchingColor=ze.batchingColor,nt.instancing=ze.instancing,nt.instancingColor=ze.instancingColor,nt.instancingMorph=ze.instancingMorph,nt.skinning=ze.skinning,nt.morphTargets=ze.morphTargets,nt.morphNormals=ze.morphNormals,nt.morphColors=ze.morphColors,nt.morphTargetsCount=ze.morphTargetsCount,nt.numClippingPlanes=ze.numClippingPlanes,nt.numIntersection=ze.numClipIntersection,nt.vertexAlphas=ze.vertexAlphas,nt.vertexTangents=ze.vertexTangents,nt.toneMapping=ze.toneMapping,nt.numMultiviewViews=ze.numMultiviewViews}function uu(pe,ze,nt,rt,Ge){ze.isScene!==!0&&(ze=ht),Re.resetTextureUnits();const Nt=ze.fog,Kt=rt.isMeshStandardMaterial?ze.environment:null,on=H===null?q.outputColorSpace:H.isXRRenderTarget===!0?H.texture.colorSpace:Yg,dn=(rt.isMeshStandardMaterial?at:We).get(rt.envMap||Kt),Ln=rt.vertexColors===!0&&!!nt.attributes.color&&nt.attributes.color.itemSize===4,Sn=!!nt.attributes.tangent&&(!!rt.normalMap||rt.anisotropy>0),zt=!!nt.morphAttributes.position,gn=!!nt.morphAttributes.normal,Hn=!!nt.morphAttributes.color;let Ci=Td;rt.toneMapped&&(H===null||H.isXRRenderTarget===!0)&&(Ci=q.toneMapping);const bi=H&&H.isWebGLMultiviewRenderTarget?H.numViews:0,Yn=nt.morphAttributes.position||nt.morphAttributes.normal||nt.morphAttributes.color,Ht=Yn!==void 0?Yn.length:0,jt=xe.get(rt),us=F.state.lights;if(Rt===!0&&(Et===!0||pe!==ee)){const mi=pe===ee&&rt.id===j;cn.setState(rt,pe,mi)}let ti=!1;rt.version===jt.__version?(jt.needsLights&&jt.lightsStateVersion!==us.state.version||jt.outputColorSpace!==on||Ge.isBatchedMesh&&jt.batching===!1||!Ge.isBatchedMesh&&jt.batching===!0||Ge.isBatchedMesh&&jt.batchingColor===!0&&Ge.colorTexture===null||Ge.isBatchedMesh&&jt.batchingColor===!1&&Ge.colorTexture!==null||Ge.isInstancedMesh&&jt.instancing===!1||!Ge.isInstancedMesh&&jt.instancing===!0||Ge.isSkinnedMesh&&jt.skinning===!1||!Ge.isSkinnedMesh&&jt.skinning===!0||Ge.isInstancedMesh&&jt.instancingColor===!0&&Ge.instanceColor===null||Ge.isInstancedMesh&&jt.instancingColor===!1&&Ge.instanceColor!==null||Ge.isInstancedMesh&&jt.instancingMorph===!0&&Ge.morphTexture===null||Ge.isInstancedMesh&&jt.instancingMorph===!1&&Ge.morphTexture!==null||jt.envMap!==dn||rt.fog===!0&&jt.fog!==Nt||jt.numClippingPlanes!==void 0&&(jt.numClippingPlanes!==cn.numPlanes||jt.numIntersection!==cn.numIntersection)||jt.vertexAlphas!==Ln||jt.vertexTangents!==Sn||jt.morphTargets!==zt||jt.morphNormals!==gn||jt.morphColors!==Hn||jt.toneMapping!==Ci||jt.morphTargetsCount!==Ht||jt.numMultiviewViews!==bi)&&(ti=!0):(ti=!0,jt.__version=rt.version);let Oi=jt.currentProgram;ti===!0&&(Oi=na(rt,ze,Ge));let Jr=!1,hs=!1,ds=!1;const Nn=Oi.getUniforms(),Vi=jt.uniforms;if(te.useProgram(Oi.program)&&(Jr=!0,hs=!0,ds=!0),rt.id!==j&&(j=rt.id,hs=!0),Jr||ee!==pe){Oi.numMultiviewViews>0?(Zt.updateCameraProjectionMatricesUniform(pe,Nn),Zt.updateCameraViewMatricesUniform(pe,Nn)):(te.buffers.depth.getReversed()?(Ze.copy(pe.projectionMatrix),QXe(Ze),KXe(Ze),Nn.setValue(Ee,"projectionMatrix",Ze)):Nn.setValue(Ee,"projectionMatrix",pe.projectionMatrix),Nn.setValue(Ee,"viewMatrix",pe.matrixWorldInverse));const mi=Nn.map.cameraPosition;mi!==void 0&&mi.setValue(Ee,Lt.setFromMatrixPosition(pe.matrixWorld)),Y.logarithmicDepthBuffer&&Nn.setValue(Ee,"logDepthBufFC",2/(Math.log(pe.far+1)/Math.LN2)),(rt.isMeshPhongMaterial||rt.isMeshToonMaterial||rt.isMeshLambertMaterial||rt.isMeshBasicMaterial||rt.isMeshStandardMaterial||rt.isShaderMaterial)&&Nn.setValue(Ee,"isOrthographic",pe.isOrthographicCamera===!0),ee!==pe&&(ee=pe,hs=!0,ds=!0)}if(Ge.isSkinnedMesh){Nn.setOptional(Ee,Ge,"bindMatrix"),Nn.setOptional(Ee,Ge,"bindMatrixInverse");const mi=Ge.skeleton;mi&&(mi.boneTexture===null&&mi.computeBoneTexture(),Nn.setValue(Ee,"boneTexture",mi.boneTexture,Re))}Ge.isBatchedMesh&&(Nn.setOptional(Ee,Ge,"batchingTexture"),Nn.setValue(Ee,"batchingTexture",Ge._matricesTexture,Re),Nn.setOptional(Ee,Ge,"batchingIdTexture"),Nn.setValue(Ee,"batchingIdTexture",Ge._indirectTexture,Re),Nn.setOptional(Ee,Ge,"batchingColorTexture"),Ge._colorsTexture!==null&&Nn.setValue(Ee,"batchingColorTexture",Ge._colorsTexture,Re));const pr=nt.morphAttributes;if((pr.position!==void 0||pr.normal!==void 0||pr.color!==void 0)&&Ft.update(Ge,nt,Oi),(hs||jt.receiveShadow!==Ge.receiveShadow)&&(jt.receiveShadow=Ge.receiveShadow,Nn.setValue(Ee,"receiveShadow",Ge.receiveShadow)),rt.isMeshGouraudMaterial&&rt.envMap!==null&&(Vi.envMap.value=dn,Vi.flipEnvMap.value=dn.isCubeTexture&&dn.isRenderTargetTexture===!1?-1:1),rt.isMeshStandardMaterial&&rt.envMap===null&&ze.environment!==null&&(Vi.envMapIntensity.value=ze.environmentIntensity),hs&&(Nn.setValue(Ee,"toneMappingExposure",q.toneMappingExposure),jt.needsLights&&_h(Vi,ds),Nt&&rt.fog===!0&&ut.refreshFogUniforms(Vi,Nt),ut.refreshMaterialUniforms(Vi,rt,Fe,Ae,F.state.transmissionRenderTarget[pe.id]),dI.upload(Ee,ro(jt),Vi,Re)),rt.isShaderMaterial&&rt.uniformsNeedUpdate===!0&&(dI.upload(Ee,ro(jt),Vi,Re),rt.uniformsNeedUpdate=!1),rt.isSpriteMaterial&&Nn.setValue(Ee,"center",Ge.center),Oi.numMultiviewViews>0?Zt.updateObjectMatricesUniforms(Ge,pe,Nn):(Nn.setValue(Ee,"modelViewMatrix",Ge.modelViewMatrix),Nn.setValue(Ee,"normalMatrix",Ge.normalMatrix)),Nn.setValue(Ee,"modelMatrix",Ge.matrixWorld),rt.isShaderMaterial||rt.isRawShaderMaterial){const mi=rt.uniformsGroups;for(let Qs=0,fs=mi.length;Qs<fs;Qs++){const Ba=mi[Qs];Pt.update(Ba,Oi),Pt.bind(Ba,Oi)}}return Oi}function _h(pe,ze){pe.ambientLightColor.needsUpdate=ze,pe.lightProbe.needsUpdate=ze,pe.directionalLights.needsUpdate=ze,pe.directionalLightShadows.needsUpdate=ze,pe.pointLights.needsUpdate=ze,pe.pointLightShadows.needsUpdate=ze,pe.spotLights.needsUpdate=ze,pe.spotLightShadows.needsUpdate=ze,pe.rectAreaLights.needsUpdate=ze,pe.hemisphereLights.needsUpdate=ze}function ll(pe){return pe.isMeshLambertMaterial||pe.isMeshToonMaterial||pe.isMeshPhongMaterial||pe.isMeshStandardMaterial||pe.isShadowMaterial||pe.isShaderMaterial&&pe.lights===!0}this.setTexture2D=function(){var pe=!1;return function(nt,rt){nt&&nt.isWebGLRenderTarget&&(pe||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),pe=!0),nt=nt.texture),Re.setTexture2D(nt,rt)}}(),this.getActiveCubeFace=function(){return K},this.getActiveMipmapLevel=function(){return Q},this.getRenderTarget=function(){return H},this.setRenderTargetTextures=function(pe,ze,nt){xe.get(pe.texture).__webglTexture=ze,xe.get(pe.depthTexture).__webglTexture=nt;const rt=xe.get(pe);rt.__hasExternalTextures=!0,rt.__autoAllocateDepthBuffer=nt===void 0,!rt.__autoAllocateDepthBuffer&&(!H||!H.isWebGLMultiviewRenderTarget)&&Gt.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),rt.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(pe,ze){const nt=xe.get(pe);nt.__webglFramebuffer=ze,nt.__useDefaultFramebuffer=ze===void 0};const hu=Ee.createFramebuffer();this.setRenderTarget=function(pe,ze=0,nt=0){pe===null&&this.xr.isPresenting&&(pe=this.xr.getRenderTarget()),H=pe,K=ze,Q=nt;let rt=!0,Ge=null,Nt=!1,Kt=!1;if(pe){const dn=xe.get(pe);if(dn.__useDefaultFramebuffer!==void 0)te.bindFramebuffer(Ee.FRAMEBUFFER,null),rt=!1;else if(dn.__webglFramebuffer===void 0)Re.setupRenderTarget(pe);else if(dn.__hasExternalTextures)Re.rebindTextures(pe,xe.get(pe.texture).__webglTexture,xe.get(pe.depthTexture).__webglTexture);else if(pe.depthBuffer){const zt=pe.depthTexture;if(dn.__boundDepthTexture!==zt){if(zt!==null&&xe.has(zt)&&(pe.width!==zt.image.width||pe.height!==zt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Re.setupDepthRenderbuffer(pe)}}const Ln=pe.texture;(Ln.isData3DTexture||Ln.isDataArrayTexture||Ln.isCompressedArrayTexture)&&(Kt=!0);const Sn=xe.get(pe).__webglFramebuffer;pe.isWebGLCubeRenderTarget?(Array.isArray(Sn[ze])?Ge=Sn[ze][nt]:Ge=Sn[ze],Nt=!0):pe.samples>0&&Re.useMultisampledRTT(pe)===!1?Ge=xe.get(pe).__webglMultisampledFramebuffer:Array.isArray(Sn)?Ge=Sn[nt]:Ge=Sn,de.copy(pe.viewport),oe.copy(pe.scissor),we=pe.scissorTest}else de.copy(dt).multiplyScalar(Fe).floor(),oe.copy(Wt).multiplyScalar(Fe).floor(),we=xt;if(nt!==0&&(Ge=hu),te.bindFramebuffer(Ee.FRAMEBUFFER,Ge)&&rt&&te.drawBuffers(pe,Ge),te.viewport(de),te.scissor(oe),te.setScissorTest(we),Nt){const dn=xe.get(pe.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_CUBE_MAP_POSITIVE_X+ze,dn.__webglTexture,nt)}else if(Kt){const dn=xe.get(pe.texture),Ln=ze;Ee.framebufferTextureLayer(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,dn.__webglTexture,nt,Ln)}else if(pe!==null&&nt!==0){const dn=xe.get(pe.texture);Ee.framebufferTexture2D(Ee.FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,dn.__webglTexture,nt)}j=-1},this.readRenderTargetPixels=function(pe,ze,nt,rt,Ge,Nt,Kt){if(!(pe&&pe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let on=xe.get(pe).__webglFramebuffer;if(pe.isWebGLCubeRenderTarget&&Kt!==void 0&&(on=on[Kt]),on){te.bindFramebuffer(Ee.FRAMEBUFFER,on);try{const dn=pe.texture,Ln=dn.format,Sn=dn.type;if(!Y.textureFormatReadable(Ln)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Y.textureTypeReadable(Sn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ze>=0&&ze<=pe.width-rt&&nt>=0&&nt<=pe.height-Ge&&Ee.readPixels(ze,nt,rt,Ge,Pe.convert(Ln),Pe.convert(Sn),Nt)}finally{const dn=H!==null?xe.get(H).__webglFramebuffer:null;te.bindFramebuffer(Ee.FRAMEBUFFER,dn)}}},this.readRenderTargetPixelsAsync=async function(pe,ze,nt,rt,Ge,Nt,Kt){if(!(pe&&pe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let on=xe.get(pe).__webglFramebuffer;if(pe.isWebGLCubeRenderTarget&&Kt!==void 0&&(on=on[Kt]),on){const dn=pe.texture,Ln=dn.format,Sn=dn.type;if(!Y.textureFormatReadable(Ln))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Y.textureTypeReadable(Sn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ze>=0&&ze<=pe.width-rt&&nt>=0&&nt<=pe.height-Ge){te.bindFramebuffer(Ee.FRAMEBUFFER,on);const zt=Ee.createBuffer();Ee.bindBuffer(Ee.PIXEL_PACK_BUFFER,zt),Ee.bufferData(Ee.PIXEL_PACK_BUFFER,Nt.byteLength,Ee.STREAM_READ),Ee.readPixels(ze,nt,rt,Ge,Pe.convert(Ln),Pe.convert(Sn),0);const gn=H!==null?xe.get(H).__webglFramebuffer:null;te.bindFramebuffer(Ee.FRAMEBUFFER,gn);const Hn=Ee.fenceSync(Ee.SYNC_GPU_COMMANDS_COMPLETE,0);return Ee.flush(),await $Xe(Ee,Hn,4),Ee.bindBuffer(Ee.PIXEL_PACK_BUFFER,zt),Ee.getBufferSubData(Ee.PIXEL_PACK_BUFFER,0,Nt),Ee.deleteBuffer(zt),Ee.deleteSync(Hn),Nt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(pe,ze=null,nt=0){pe.isTexture!==!0&&(Dy("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ze=arguments[0]||null,pe=arguments[1]);const rt=Math.pow(2,-nt),Ge=Math.floor(pe.image.width*rt),Nt=Math.floor(pe.image.height*rt),Kt=ze!==null?ze.x:0,on=ze!==null?ze.y:0;Re.setTexture2D(pe,0),Ee.copyTexSubImage2D(Ee.TEXTURE_2D,nt,0,0,Kt,on,Ge,Nt),te.unbindTexture()};const Ol=Ee.createFramebuffer(),Vl=Ee.createFramebuffer();this.copyTextureToTexture=function(pe,ze,nt=null,rt=null,Ge=0,Nt=null){pe.isTexture!==!0&&(Dy("WebGLRenderer: copyTextureToTexture function signature has changed."),rt=arguments[0]||null,pe=arguments[1],ze=arguments[2],Nt=arguments[3]||0,nt=null),Nt===null&&(Ge!==0?(Dy("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Nt=Ge,Ge=0):Nt=0);let Kt,on,dn,Ln,Sn,zt,gn,Hn,Ci;const bi=pe.isCompressedTexture?pe.mipmaps[Nt]:pe.image;if(nt!==null)Kt=nt.max.x-nt.min.x,on=nt.max.y-nt.min.y,dn=nt.isBox3?nt.max.z-nt.min.z:1,Ln=nt.min.x,Sn=nt.min.y,zt=nt.isBox3?nt.min.z:0;else{const Vi=Math.pow(2,-Ge);Kt=Math.floor(bi.width*Vi),on=Math.floor(bi.height*Vi),pe.isDataArrayTexture?dn=bi.depth:pe.isData3DTexture?dn=Math.floor(bi.depth*Vi):dn=1,Ln=0,Sn=0,zt=0}rt!==null?(gn=rt.x,Hn=rt.y,Ci=rt.z):(gn=0,Hn=0,Ci=0);const Yn=Pe.convert(ze.format),Ht=Pe.convert(ze.type);let jt;ze.isData3DTexture?(Re.setTexture3D(ze,0),jt=Ee.TEXTURE_3D):ze.isDataArrayTexture||ze.isCompressedArrayTexture?(Re.setTexture2DArray(ze,0),jt=Ee.TEXTURE_2D_ARRAY):(Re.setTexture2D(ze,0),jt=Ee.TEXTURE_2D),Ee.pixelStorei(Ee.UNPACK_FLIP_Y_WEBGL,ze.flipY),Ee.pixelStorei(Ee.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ze.premultiplyAlpha),Ee.pixelStorei(Ee.UNPACK_ALIGNMENT,ze.unpackAlignment);const us=Ee.getParameter(Ee.UNPACK_ROW_LENGTH),ti=Ee.getParameter(Ee.UNPACK_IMAGE_HEIGHT),Oi=Ee.getParameter(Ee.UNPACK_SKIP_PIXELS),Jr=Ee.getParameter(Ee.UNPACK_SKIP_ROWS),hs=Ee.getParameter(Ee.UNPACK_SKIP_IMAGES);Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,bi.width),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,bi.height),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,Ln),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,Sn),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,zt);const ds=pe.isDataArrayTexture||pe.isData3DTexture,Nn=ze.isDataArrayTexture||ze.isData3DTexture;if(pe.isDepthTexture){const Vi=xe.get(pe),pr=xe.get(ze),mi=xe.get(Vi.__renderTarget),Qs=xe.get(pr.__renderTarget);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,mi.__webglFramebuffer),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,Qs.__webglFramebuffer);for(let fs=0;fs<dn;fs++)ds&&(Ee.framebufferTextureLayer(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,xe.get(pe).__webglTexture,Ge,zt+fs),Ee.framebufferTextureLayer(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,xe.get(ze).__webglTexture,Nt,Ci+fs)),Ee.blitFramebuffer(Ln,Sn,Kt,on,gn,Hn,Kt,on,Ee.DEPTH_BUFFER_BIT,Ee.NEAREST);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,null),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,null)}else if(Ge!==0||pe.isRenderTargetTexture||xe.has(pe)){const Vi=xe.get(pe),pr=xe.get(ze);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,Ol),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,Vl);for(let mi=0;mi<dn;mi++)ds?Ee.framebufferTextureLayer(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Vi.__webglTexture,Ge,zt+mi):Ee.framebufferTexture2D(Ee.READ_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,Vi.__webglTexture,Ge),Nn?Ee.framebufferTextureLayer(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,pr.__webglTexture,Nt,Ci+mi):Ee.framebufferTexture2D(Ee.DRAW_FRAMEBUFFER,Ee.COLOR_ATTACHMENT0,Ee.TEXTURE_2D,pr.__webglTexture,Nt),Ge!==0?Ee.blitFramebuffer(Ln,Sn,Kt,on,gn,Hn,Kt,on,Ee.COLOR_BUFFER_BIT,Ee.NEAREST):Nn?Ee.copyTexSubImage3D(jt,Nt,gn,Hn,Ci+mi,Ln,Sn,Kt,on):Ee.copyTexSubImage2D(jt,Nt,gn,Hn,Ln,Sn,Kt,on);te.bindFramebuffer(Ee.READ_FRAMEBUFFER,null),te.bindFramebuffer(Ee.DRAW_FRAMEBUFFER,null)}else Nn?pe.isDataTexture||pe.isData3DTexture?Ee.texSubImage3D(jt,Nt,gn,Hn,Ci,Kt,on,dn,Yn,Ht,bi.data):ze.isCompressedArrayTexture?Ee.compressedTexSubImage3D(jt,Nt,gn,Hn,Ci,Kt,on,dn,Yn,bi.data):Ee.texSubImage3D(jt,Nt,gn,Hn,Ci,Kt,on,dn,Yn,Ht,bi):pe.isDataTexture?Ee.texSubImage2D(Ee.TEXTURE_2D,Nt,gn,Hn,Kt,on,Yn,Ht,bi.data):pe.isCompressedTexture?Ee.compressedTexSubImage2D(Ee.TEXTURE_2D,Nt,gn,Hn,bi.width,bi.height,Yn,bi.data):Ee.texSubImage2D(Ee.TEXTURE_2D,Nt,gn,Hn,Kt,on,Yn,Ht,bi);Ee.pixelStorei(Ee.UNPACK_ROW_LENGTH,us),Ee.pixelStorei(Ee.UNPACK_IMAGE_HEIGHT,ti),Ee.pixelStorei(Ee.UNPACK_SKIP_PIXELS,Oi),Ee.pixelStorei(Ee.UNPACK_SKIP_ROWS,Jr),Ee.pixelStorei(Ee.UNPACK_SKIP_IMAGES,hs),Nt===0&&ze.generateMipmaps&&Ee.generateMipmap(jt),te.unbindTexture()},this.copyTextureToTexture3D=function(pe,ze,nt=null,rt=null,Ge=0){return pe.isTexture!==!0&&(Dy("WebGLRenderer: copyTextureToTexture3D function signature has changed."),nt=arguments[0]||null,rt=arguments[1]||null,pe=arguments[2],ze=arguments[3],Ge=arguments[4]||0),Dy('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(pe,ze,nt,rt,Ge)},this.initRenderTarget=function(pe){xe.get(pe).__webglFramebuffer===void 0&&Re.setupRenderTarget(pe)},this.initTexture=function(pe){pe.isCubeTexture?Re.setTextureCube(pe,0):pe.isData3DTexture?Re.setTexture3D(pe,0):pe.isDataArrayTexture||pe.isCompressedArrayTexture?Re.setTexture2DArray(pe,0):Re.setTexture2D(pe,0),te.unbindTexture()},this.resetState=function(){K=0,Q=0,H=null,te.reset(),ft.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return nu}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=Fi._getDrawingBufferColorSpace(e),t.unpackColorSpace=Fi._getUnpackColorSpace()}}const a7e=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:lie,AddEquation:sp,AddOperation:rie,AdditiveAnimationBlendMode:cV,AdditiveBlending:XD,AgXToneMapping:uie,AlphaFormat:iV,AlwaysCompare:_ie,AlwaysDepth:E2,AlwaysStencilFunc:ZD,AmbientLight:vre,AnimationAction:Mre,AnimationClip:L1,AnimationLoader:AQe,AnimationMixer:QQe,AnimationObjectGroup:XQe,AnimationUtils:pQe,ArcCurve:Hie,ArrayCamera:_re,ArrowHelper:yKe,AttachedBindMode:KD,Audio:Sre,AudioAnalyser:NQe,AudioContext:LV,AudioListener:LQe,AudioLoader:MQe,AxesHelper:AKe,BackSide:Ta,BasicDepthPacking:gie,BasicShadowMap:QHe,BatchedMesh:Uie,Bone:mV,BooleanKeyframeTrack:f0,Box2:iKe,Box3:Ma,Box3Helper:mKe,BoxGeometry:d0,BoxHelper:pKe,BufferAttribute:sr,BufferGeometry:pi,BufferGeometryLoader:Ere,ByteType:eV,Cache:vd,Camera:BT,CameraHelper:fKe,CanvasTexture:O$e,CapsuleGeometry:UT,CatmullRomCurve3:Xie,CineonToneMapping:aie,CircleGeometry:zT,ClampToEdgeWrapping:hc,Clock:Ire,Color:An,ColorKeyframeTrack:MV,ColorManagement:Fi,CompressedArrayTexture:D$e,CompressedCubeTexture:F$e,CompressedTexture:OT,CompressedTextureLoader:vQe,ConeGeometry:GT,ConstantAlphaFactor:tie,ConstantColorFactor:Jne,Controls:bKe,CubeCamera:Lie,CubeReflectionMapping:Wd,CubeRefractionMapping:Wp,CubeTexture:lw,CubeTextureLoader:bQe,CubeUVReflectionMapping:JA,CubicBezierCurve:vV,CubicBezierCurve3:$ie,CubicInterpolant:hre,CullFaceBack:HD,CullFaceFront:Fne,CullFaceFrontBack:$He,CullFaceNone:Dne,Curve:lu,CurvePath:Kie,CustomBlending:Vne,CustomToneMapping:cie,CylinderGeometry:nv,Cylindrical:nKe,Data3DTexture:RT,DataArrayTexture:aw,DataTexture:mh,DataTextureLoader:xQe,DataUtils:c$e,DecrementStencilOp:aXe,DecrementWrapStencilOp:cXe,DefaultLoadingManager:pre,DepthFormat:Mp,DepthStencilFormat:kp,DepthTexture:yV,DetachedBindMode:die,DirectionalLight:Are,DirectionalLightHelper:dKe,DiscreteInterpolant:dre,DodecahedronGeometry:WT,DoubleSide:nh,DstAlphaFactor:Kne,DstColorFactor:jne,DynamicCopyUsage:EXe,DynamicDrawUsage:AXe,DynamicReadUsage:xXe,EdgesGeometry:Zie,EllipseCurve:VT,EqualCompare:xie,EqualDepth:I2,EqualStencilFunc:fXe,EquirectangularReflectionMapping:g1,EquirectangularRefractionMapping:y1,Euler:Ll,EventDispatcher:Ch,ExtrudeGeometry:XT,FileLoader:Xd,Float16BufferAttribute:g$e,Float32BufferAttribute:En,FloatType:Ca,Fog:NT,FogExp2:PT,FramebufferTexture:N$e,FrontSide:Gd,Frustum:cw,GLBufferAttribute:JQe,GLSL1:IXe,GLSL3:jD,GreaterCompare:wie,GreaterDepth:T2,GreaterEqualCompare:Eie,GreaterEqualDepth:S2,GreaterEqualStencilFunc:yXe,GreaterStencilFunc:mXe,GridHelper:uKe,Group:iA,HalfFloatType:ev,HemisphereLight:mre,HemisphereLightHelper:cKe,IcosahedronGeometry:$T,ImageBitmapLoader:TQe,ImageLoader:B1,ImageUtils:Tie,IncrementStencilOp:oXe,IncrementWrapStencilOp:lXe,InstancedBufferAttribute:zA,InstancedBufferGeometry:Cre,InstancedInterleavedBuffer:qQe,InstancedMesh:Vie,Int16BufferAttribute:p$e,Int32BufferAttribute:m$e,Int8BufferAttribute:h$e,IntType:CT,InterleavedBuffer:DT,InterleavedBufferAttribute:qg,Interpolant:fw,InterpolateDiscrete:b1,InterpolateLinear:nS,InterpolateSmooth:uI,InvertStencilOp:uXe,KeepStencilOp:Ag,KeyframeTrack:cu,LOD:Fie,LatheGeometry:uw,Layers:LT,LessCompare:bie,LessDepth:_2,LessEqualCompare:uV,LessEqualDepth:jg,LessEqualStencilFunc:pXe,LessStencilFunc:dXe,Light:tm,LightProbe:wre,Line:Hp,Line3:rKe,LineBasicMaterial:La,LineCurve:bV,LineCurve3:Qie,LineDashedMaterial:lre,LineLoop:zie,LineSegments:Eh,LinearFilter:Ws,LinearInterpolant:TV,LinearMipMapLinearFilter:YHe,LinearMipMapNearestFilter:jHe,LinearMipmapLinearFilter:ih,LinearMipmapNearestFilter:Ix,LinearSRGBColorSpace:Yg,LinearToneMapping:sie,LinearTransfer:w1,Loader:ol,LoaderUtils:t3,LoadingManager:kV,LoopOnce:fie,LoopPingPong:mie,LoopRepeat:pie,LuminanceAlphaFormat:oV,LuminanceFormat:sV,MOUSE:HHe,Material:ea,MaterialLoader:eM,MathUtils:HXe,Matrix2:DV,Matrix3:oi,Matrix4:Zn,MaxEquation:Wne,Mesh:Ms,MeshBasicMaterial:Jp,MeshDepthMaterial:_V,MeshDistanceMaterial:IV,MeshLambertMaterial:ore,MeshMatcapMaterial:are,MeshNormalMaterial:sre,MeshPhongMaterial:ire,MeshPhysicalMaterial:nre,MeshStandardMaterial:EV,MeshToonMaterial:rre,MinEquation:Gne,MirroredRepeatWrapping:v1,MixOperation:iie,MultiplyBlending:QD,MultiplyOperation:sw,NearestFilter:Co,NearestMipMapLinearFilter:ZHe,NearestMipMapNearestFilter:KHe,NearestMipmapLinearFilter:tA,NearestMipmapNearestFilter:JO,NeutralToneMapping:hie,NeverCompare:vie,NeverDepth:C2,NeverStencilFunc:hXe,NoBlending:Sd,NoColorSpace:dd,NoToneMapping:Td,NormalAnimationBlendMode:MT,NormalBlending:Ng,NotEqualCompare:Cie,NotEqualDepth:M2,NotEqualStencilFunc:gXe,NumberKeyframeTrack:k1,Object3D:Xi,ObjectLoader:IQe,ObjectSpaceNormalMap:Aie,OctahedronGeometry:hw,OneFactor:Xne,OneMinusConstantAlphaFactor:nie,OneMinusConstantColorFactor:eie,OneMinusDstAlphaFactor:Zne,OneMinusDstColorFactor:Yne,OneMinusSrcAlphaFactor:w2,OneMinusSrcColorFactor:Qne,OrthographicCamera:JT,PCFShadowMap:qO,PCFSoftShadowMap:One,PMREMGenerator:r3,Path:I1,PerspectiveCamera:Ao,Plane:Yf,PlaneGeometry:iv,PlaneHelper:gKe,PointLight:yre,PointLightHelper:aKe,Points:Gie,PointsMaterial:gV,PolarGridHelper:hKe,PolyhedronGeometry:em,PositionalAudio:PQe,PropertyBinding:Gi,PropertyMixer:Tre,QuadraticBezierCurve:xV,QuadraticBezierCurve3:wV,Quaternion:il,QuaternionKeyframeTrack:pw,QuaternionLinearInterpolant:fre,RED_GREEN_RGTC2_Format:eS,RED_RGTC1_Format:lV,REVISION:xT,RGBADepthPacking:yie,RGBAFormat:Ia,RGBAIntegerFormat:TT,RGBA_ASTC_10x10_Format:K2,RGBA_ASTC_10x5_Format:X2,RGBA_ASTC_10x6_Format:$2,RGBA_ASTC_10x8_Format:Q2,RGBA_ASTC_12x10_Format:Z2,RGBA_ASTC_12x12_Format:j2,RGBA_ASTC_4x4_Format:F2,RGBA_ASTC_5x4_Format:O2,RGBA_ASTC_5x5_Format:V2,RGBA_ASTC_6x5_Format:U2,RGBA_ASTC_6x6_Format:z2,RGBA_ASTC_8x5_Format:G2,RGBA_ASTC_8x6_Format:W2,RGBA_ASTC_8x8_Format:H2,RGBA_BPTC_Format:Rx,RGBA_ETC2_EAC_Format:D2,RGBA_PVRTC_2BPPV1_Format:B2,RGBA_PVRTC_4BPPV1_Format:L2,RGBA_S3TC_DXT1_Format:Tx,RGBA_S3TC_DXT3_Format:Mx,RGBA_S3TC_DXT5_Format:kx,RGBDepthPacking:nXe,RGBFormat:rV,RGBIntegerFormat:qHe,RGB_BPTC_SIGNED_Format:Y2,RGB_BPTC_UNSIGNED_Format:q2,RGB_ETC1_Format:P2,RGB_ETC2_Format:N2,RGB_PVRTC_2BPPV1_Format:R2,RGB_PVRTC_4BPPV1_Format:k2,RGB_S3TC_DXT1_Format:Sx,RGDepthPacking:iXe,RGFormat:aV,RGIntegerFormat:ST,RawShaderMaterial:tre,Ray:tv,Raycaster:eKe,RectAreaLight:bre,RedFormat:IT,RedIntegerFormat:ow,ReinhardToneMapping:oie,RenderTarget:kT,RenderTarget3D:KQe,RenderTargetArray:ZQe,RepeatWrapping:A1,ReplaceStencilOp:sXe,ReverseSubtractEquation:zne,RingGeometry:QT,SIGNED_RED_GREEN_RGTC2_Format:tS,SIGNED_RED_RGTC1_Format:J2,SRGBColorSpace:Za,SRGBTransfer:tr,Scene:Pie,ShaderChunk:fi,ShaderLib:Yc,ShaderMaterial:au,ShadowMaterial:ere,Shape:Fg,ShapeGeometry:KT,ShapePath:vKe,ShapeUtils:gh,ShortType:tV,Skeleton:FT,SkeletonHelper:oKe,SkinnedMesh:Oie,Source:Mg,Sphere:Yo,SphereGeometry:dw,Spherical:tKe,SphericalHarmonics3:xre,SplineCurve:CV,SpotLight:gre,SpotLightHelper:sKe,Sprite:Die,SpriteMaterial:pV,SrcAlphaFactor:x2,SrcAlphaSaturateFactor:qne,SrcColorFactor:$ne,StaticCopyUsage:CXe,StaticDrawUsage:C1,StaticReadUsage:bXe,StereoCamera:kQe,StreamCopyUsage:_Xe,StreamDrawUsage:vXe,StreamReadUsage:wXe,StringKeyframeTrack:p0,SubtractEquation:Une,SubtractiveBlending:$D,TOUCH:XHe,TangentSpaceNormalMap:qp,TetrahedronGeometry:ZT,Texture:Yr,TextureLoader:wQe,TextureUtils:_Ke,TimestampQuery:SXe,TorusGeometry:jT,TorusKnotGeometry:YT,Triangle:Ya,TriangleFanDrawMode:tXe,TriangleStripDrawMode:eXe,TrianglesDrawMode:JHe,TubeGeometry:qT,UVMapping:wT,Uint16BufferAttribute:dV,Uint32BufferAttribute:fV,Uint8BufferAttribute:d$e,Uint8ClampedBufferAttribute:f$e,Uniform:NV,UniformsGroup:YQe,UniformsLib:un,UniformsUtils:Rie,UnsignedByteType:bh,UnsignedInt248Type:Tp,UnsignedInt5999Type:nV,UnsignedIntType:Hd,UnsignedShort4444Type:ET,UnsignedShort5551Type:_T,UnsignedShortType:OA,VSMShadowMap:Yu,Vector2:St,Vector3:Ce,Vector4:Wi,VectorKeyframeTrack:R1,VideoFrameTexture:P$e,VideoTexture:Wie,WebGL3DRenderTarget:JXe,WebGLArrayRenderTarget:qXe,WebGLCoordinateSystem:nu,WebGLCubeRenderTarget:Bie,WebGLRenderTarget:ou,WebGLRenderer:o7e,WebGLUtils:Dre,WebGPUCoordinateSystem:E1,WebXRController:hI,WireframeGeometry:Jie,WrapAroundEnding:x1,ZeroCurvatureEnding:Sg,ZeroFactor:Hne,ZeroSlopeEnding:Tg,ZeroStencilOp:rXe,createCanvasElement:Sie},Symbol.toStringTag,{value:"Module"}));var l7e={},Ore={8167:n=>{var e=Object.prototype.toString;n.exports=function(t){return t.BYTES_PER_ELEMENT&&e.call(t.buffer)==="[object ArrayBuffer]"||Array.isArray(t)}},5734:n=>{n.exports=function(e,t){return typeof e=="number"?e:typeof t=="number"?t:0}},7961:(n,e)=>{e.byteLength=function(g){var x=d(g),b=x[0],E=x[1];return 3*(b+E)/4-E},e.toByteArray=function(g){var x,b,E=d(g),S=E[0],M=E[1],R=new s(function(F,V,G){return 3*(V+G)/4-G}(0,S,M)),P=0,k=M>0?S-4:S;for(b=0;b<k;b+=4)x=i[g.charCodeAt(b)]<<18|i[g.charCodeAt(b+1)]<<12|i[g.charCodeAt(b+2)]<<6|i[g.charCodeAt(b+3)],R[P++]=x>>16&255,R[P++]=x>>8&255,R[P++]=255&x;return M===2&&(x=i[g.charCodeAt(b)]<<2|i[g.charCodeAt(b+1)]>>4,R[P++]=255&x),M===1&&(x=i[g.charCodeAt(b)]<<10|i[g.charCodeAt(b+1)]<<4|i[g.charCodeAt(b+2)]>>2,R[P++]=x>>8&255,R[P++]=255&x),R},e.fromByteArray=function(g){for(var x,b=g.length,E=b%3,S=[],M=16383,R=0,P=b-E;R<P;R+=M)S.push(p(g,R,R+M>P?P:R+M));return E===1?(x=g[b-1],S.push(t[x>>2]+t[x<<4&63]+"==")):E===2&&(x=(g[b-2]<<8)+g[b-1],S.push(t[x>>10]+t[x>>4&63]+t[x<<2&63]+"=")),S.join("")};for(var t=[],i=[],s=typeof Uint8Array<"u"?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0;u<64;++u)t[u]=l[u],i[l.charCodeAt(u)]=u;function d(g){var x=g.length;if(x%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var b=g.indexOf("=");return b===-1&&(b=x),[b,b===x?0:4-b%4]}function p(g,x,b){for(var E,S,M=[],R=x;R<b;R+=3)E=(g[R]<<16&16711680)+(g[R+1]<<8&65280)+(255&g[R+2]),M.push(t[(S=E)>>18&63]+t[S>>12&63]+t[S>>6&63]+t[63&S]);return M.join("")}i[45]=62,i[95]=63},911:(n,e,t)=>{var i=t(9922).hp;n.exports=function(s,l){if(i.isBuffer(s)&&i.isBuffer(l)){if(typeof s.equals=="function")return s.equals(l);if(s.length!==l.length)return!1;for(var u=0;u<s.length;u++)if(s[u]!==l[u])return!1;return!0}}},9922:(n,e,t)=>{const i=t(7961),s=t(1024),l=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;e.hp=p,e.IS=50;const u=2147483647;function d(Y){if(Y>u)throw new RangeError('The value "'+Y+'" is invalid for option "size"');const te=new Uint8Array(Y);return Object.setPrototypeOf(te,p.prototype),te}function p(Y,te,ce){if(typeof Y=="number"){if(typeof te=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(Y)}return g(Y,te,ce)}function g(Y,te,ce){if(typeof Y=="string")return function(We,at){if(typeof at=="string"&&at!==""||(at="utf8"),!p.isEncoding(at))throw new TypeError("Unknown encoding: "+at);const ln=0|R(We,at);let ve=d(ln);const ue=ve.write(We,at);return ue!==ln&&(ve=ve.slice(0,ue)),ve}(Y,te);if(ArrayBuffer.isView(Y))return function(We){if(yt(We,Uint8Array)){const at=new Uint8Array(We);return S(at.buffer,at.byteOffset,at.byteLength)}return E(We)}(Y);if(Y==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Y);if(yt(Y,ArrayBuffer)||Y&&yt(Y.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(yt(Y,SharedArrayBuffer)||Y&&yt(Y.buffer,SharedArrayBuffer)))return S(Y,te,ce);if(typeof Y=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const xe=Y.valueOf&&Y.valueOf();if(xe!=null&&xe!==Y)return p.from(xe,te,ce);const Re=function(We){if(p.isBuffer(We)){const at=0|M(We.length),ln=d(at);return ln.length===0||We.copy(ln,0,0,at),ln}return We.length!==void 0?typeof We.length!="number"||wt(We.length)?d(0):E(We):We.type==="Buffer"&&Array.isArray(We.data)?E(We.data):void 0}(Y);if(Re)return Re;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Y[Symbol.toPrimitive]=="function")return p.from(Y[Symbol.toPrimitive]("string"),te,ce);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Y)}function x(Y){if(typeof Y!="number")throw new TypeError('"size" argument must be of type number');if(Y<0)throw new RangeError('The value "'+Y+'" is invalid for option "size"')}function b(Y){return x(Y),d(Y<0?0:0|M(Y))}function E(Y){const te=Y.length<0?0:0|M(Y.length),ce=d(te);for(let xe=0;xe<te;xe+=1)ce[xe]=255&Y[xe];return ce}function S(Y,te,ce){if(te<0||Y.byteLength<te)throw new RangeError('"offset" is outside of buffer bounds');if(Y.byteLength<te+(ce||0))throw new RangeError('"length" is outside of buffer bounds');let xe;return xe=te===void 0&&ce===void 0?new Uint8Array(Y):ce===void 0?new Uint8Array(Y,te):new Uint8Array(Y,te,ce),Object.setPrototypeOf(xe,p.prototype),xe}function M(Y){if(Y>=u)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+u.toString(16)+" bytes");return 0|Y}function R(Y,te){if(p.isBuffer(Y))return Y.length;if(ArrayBuffer.isView(Y)||yt(Y,ArrayBuffer))return Y.byteLength;if(typeof Y!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Y);const ce=Y.length,xe=arguments.length>2&&arguments[2]===!0;if(!xe&&ce===0)return 0;let Re=!1;for(;;)switch(te){case"ascii":case"latin1":case"binary":return ce;case"utf8":case"utf-8":return Lt(Y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*ce;case"hex":return ce>>>1;case"base64":return Yt(Y).length;default:if(Re)return xe?-1:Lt(Y).length;te=(""+te).toLowerCase(),Re=!0}}function P(Y,te,ce){let xe=!1;if((te===void 0||te<0)&&(te=0),te>this.length||((ce===void 0||ce>this.length)&&(ce=this.length),ce<=0)||(ce>>>=0)<=(te>>>=0))return"";for(Y||(Y="utf8");;)switch(Y){case"hex":return we(this,te,ce);case"utf8":case"utf-8":return j(this,te,ce);case"ascii":return de(this,te,ce);case"latin1":case"binary":return oe(this,te,ce);case"base64":return H(this,te,ce);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $e(this,te,ce);default:if(xe)throw new TypeError("Unknown encoding: "+Y);Y=(Y+"").toLowerCase(),xe=!0}}function k(Y,te,ce){const xe=Y[te];Y[te]=Y[ce],Y[ce]=xe}function F(Y,te,ce,xe,Re){if(Y.length===0)return-1;if(typeof ce=="string"?(xe=ce,ce=0):ce>2147483647?ce=2147483647:ce<-2147483648&&(ce=-2147483648),wt(ce=+ce)&&(ce=Re?0:Y.length-1),ce<0&&(ce=Y.length+ce),ce>=Y.length){if(Re)return-1;ce=Y.length-1}else if(ce<0){if(!Re)return-1;ce=0}if(typeof te=="string"&&(te=p.from(te,xe)),p.isBuffer(te))return te.length===0?-1:V(Y,te,ce,xe,Re);if(typeof te=="number")return te&=255,typeof Uint8Array.prototype.indexOf=="function"?Re?Uint8Array.prototype.indexOf.call(Y,te,ce):Uint8Array.prototype.lastIndexOf.call(Y,te,ce):V(Y,[te],ce,xe,Re);throw new TypeError("val must be string, number or Buffer")}function V(Y,te,ce,xe,Re){let We,at=1,ln=Y.length,ve=te.length;if(xe!==void 0&&((xe=String(xe).toLowerCase())==="ucs2"||xe==="ucs-2"||xe==="utf16le"||xe==="utf-16le")){if(Y.length<2||te.length<2)return-1;at=2,ln/=2,ve/=2,ce/=2}function ue(Oe,ut){return at===1?Oe[ut]:Oe.readUInt16BE(ut*at)}if(Re){let Oe=-1;for(We=ce;We<ln;We++)if(ue(Y,We)===ue(te,Oe===-1?0:We-Oe)){if(Oe===-1&&(Oe=We),We-Oe+1===ve)return Oe*at}else Oe!==-1&&(We-=We-Oe),Oe=-1}else for(ce+ve>ln&&(ce=ln-ve),We=ce;We>=0;We--){let Oe=!0;for(let ut=0;ut<ve;ut++)if(ue(Y,We+ut)!==ue(te,ut)){Oe=!1;break}if(Oe)return We}return-1}function G(Y,te,ce,xe){ce=Number(ce)||0;const Re=Y.length-ce;xe?(xe=Number(xe))>Re&&(xe=Re):xe=Re;const We=te.length;let at;for(xe>We/2&&(xe=We/2),at=0;at<xe;++at){const ln=parseInt(te.substr(2*at,2),16);if(wt(ln))return at;Y[ce+at]=ln}return at}function q(Y,te,ce,xe){return ht(Lt(te,Y.length-ce),Y,ce,xe)}function ne(Y,te,ce,xe){return ht(function(Re){const We=[];for(let at=0;at<Re.length;++at)We.push(255&Re.charCodeAt(at));return We}(te),Y,ce,xe)}function K(Y,te,ce,xe){return ht(Yt(te),Y,ce,xe)}function Q(Y,te,ce,xe){return ht(function(Re,We){let at,ln,ve;const ue=[];for(let Oe=0;Oe<Re.length&&!((We-=2)<0);++Oe)at=Re.charCodeAt(Oe),ln=at>>8,ve=at%256,ue.push(ve),ue.push(ln);return ue}(te,Y.length-ce),Y,ce,xe)}function H(Y,te,ce){return te===0&&ce===Y.length?i.fromByteArray(Y):i.fromByteArray(Y.slice(te,ce))}function j(Y,te,ce){ce=Math.min(Y.length,ce);const xe=[];let Re=te;for(;Re<ce;){const We=Y[Re];let at=null,ln=We>239?4:We>223?3:We>191?2:1;if(Re+ln<=ce){let ve,ue,Oe,ut;switch(ln){case 1:We<128&&(at=We);break;case 2:ve=Y[Re+1],(192&ve)==128&&(ut=(31&We)<<6|63&ve,ut>127&&(at=ut));break;case 3:ve=Y[Re+1],ue=Y[Re+2],(192&ve)==128&&(192&ue)==128&&(ut=(15&We)<<12|(63&ve)<<6|63&ue,ut>2047&&(ut<55296||ut>57343)&&(at=ut));break;case 4:ve=Y[Re+1],ue=Y[Re+2],Oe=Y[Re+3],(192&ve)==128&&(192&ue)==128&&(192&Oe)==128&&(ut=(15&We)<<18|(63&ve)<<12|(63&ue)<<6|63&Oe,ut>65535&&ut<1114112&&(at=ut))}}at===null?(at=65533,ln=1):at>65535&&(at-=65536,xe.push(at>>>10&1023|55296),at=56320|1023&at),xe.push(at),Re+=ln}return function(We){const at=We.length;if(at<=ee)return String.fromCharCode.apply(String,We);let ln="",ve=0;for(;ve<at;)ln+=String.fromCharCode.apply(String,We.slice(ve,ve+=ee));return ln}(xe)}p.TYPED_ARRAY_SUPPORT=function(){try{const Y=new Uint8Array(1),te={foo:function(){return 42}};return Object.setPrototypeOf(te,Uint8Array.prototype),Object.setPrototypeOf(Y,te),Y.foo()===42}catch{return!1}}(),p.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(p.prototype,"parent",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.buffer}}),Object.defineProperty(p.prototype,"offset",{enumerable:!0,get:function(){if(p.isBuffer(this))return this.byteOffset}}),p.poolSize=8192,p.from=function(Y,te,ce){return g(Y,te,ce)},Object.setPrototypeOf(p.prototype,Uint8Array.prototype),Object.setPrototypeOf(p,Uint8Array),p.alloc=function(Y,te,ce){return function(xe,Re,We){return x(xe),xe<=0?d(xe):Re!==void 0?typeof We=="string"?d(xe).fill(Re,We):d(xe).fill(Re):d(xe)}(Y,te,ce)},p.allocUnsafe=function(Y){return b(Y)},p.allocUnsafeSlow=function(Y){return b(Y)},p.isBuffer=function(Y){return Y!=null&&Y._isBuffer===!0&&Y!==p.prototype},p.compare=function(Y,te){if(yt(Y,Uint8Array)&&(Y=p.from(Y,Y.offset,Y.byteLength)),yt(te,Uint8Array)&&(te=p.from(te,te.offset,te.byteLength)),!p.isBuffer(Y)||!p.isBuffer(te))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(Y===te)return 0;let ce=Y.length,xe=te.length;for(let Re=0,We=Math.min(ce,xe);Re<We;++Re)if(Y[Re]!==te[Re]){ce=Y[Re],xe=te[Re];break}return ce<xe?-1:xe<ce?1:0},p.isEncoding=function(Y){switch(String(Y).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},p.concat=function(Y,te){if(!Array.isArray(Y))throw new TypeError('"list" argument must be an Array of Buffers');if(Y.length===0)return p.alloc(0);let ce;if(te===void 0)for(te=0,ce=0;ce<Y.length;++ce)te+=Y[ce].length;const xe=p.allocUnsafe(te);let Re=0;for(ce=0;ce<Y.length;++ce){let We=Y[ce];if(yt(We,Uint8Array))Re+We.length>xe.length?(p.isBuffer(We)||(We=p.from(We)),We.copy(xe,Re)):Uint8Array.prototype.set.call(xe,We,Re);else{if(!p.isBuffer(We))throw new TypeError('"list" argument must be an Array of Buffers');We.copy(xe,Re)}Re+=We.length}return xe},p.byteLength=R,p.prototype._isBuffer=!0,p.prototype.swap16=function(){const Y=this.length;if(Y%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let te=0;te<Y;te+=2)k(this,te,te+1);return this},p.prototype.swap32=function(){const Y=this.length;if(Y%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let te=0;te<Y;te+=4)k(this,te,te+3),k(this,te+1,te+2);return this},p.prototype.swap64=function(){const Y=this.length;if(Y%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let te=0;te<Y;te+=8)k(this,te,te+7),k(this,te+1,te+6),k(this,te+2,te+5),k(this,te+3,te+4);return this},p.prototype.toString=function(){const Y=this.length;return Y===0?"":arguments.length===0?j(this,0,Y):P.apply(this,arguments)},p.prototype.toLocaleString=p.prototype.toString,p.prototype.equals=function(Y){if(!p.isBuffer(Y))throw new TypeError("Argument must be a Buffer");return this===Y||p.compare(this,Y)===0},p.prototype.inspect=function(){let Y="";const te=e.IS;return Y=this.toString("hex",0,te).replace(/(.{2})/g,"$1 ").trim(),this.length>te&&(Y+=" ... "),"<Buffer "+Y+">"},l&&(p.prototype[l]=p.prototype.inspect),p.prototype.compare=function(Y,te,ce,xe,Re){if(yt(Y,Uint8Array)&&(Y=p.from(Y,Y.offset,Y.byteLength)),!p.isBuffer(Y))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof Y);if(te===void 0&&(te=0),ce===void 0&&(ce=Y?Y.length:0),xe===void 0&&(xe=0),Re===void 0&&(Re=this.length),te<0||ce>Y.length||xe<0||Re>this.length)throw new RangeError("out of range index");if(xe>=Re&&te>=ce)return 0;if(xe>=Re)return-1;if(te>=ce)return 1;if(this===Y)return 0;let We=(Re>>>=0)-(xe>>>=0),at=(ce>>>=0)-(te>>>=0);const ln=Math.min(We,at),ve=this.slice(xe,Re),ue=Y.slice(te,ce);for(let Oe=0;Oe<ln;++Oe)if(ve[Oe]!==ue[Oe]){We=ve[Oe],at=ue[Oe];break}return We<at?-1:at<We?1:0},p.prototype.includes=function(Y,te,ce){return this.indexOf(Y,te,ce)!==-1},p.prototype.indexOf=function(Y,te,ce){return F(this,Y,te,ce,!0)},p.prototype.lastIndexOf=function(Y,te,ce){return F(this,Y,te,ce,!1)},p.prototype.write=function(Y,te,ce,xe){if(te===void 0)xe="utf8",ce=this.length,te=0;else if(ce===void 0&&typeof te=="string")xe=te,ce=this.length,te=0;else{if(!isFinite(te))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");te>>>=0,isFinite(ce)?(ce>>>=0,xe===void 0&&(xe="utf8")):(xe=ce,ce=void 0)}const Re=this.length-te;if((ce===void 0||ce>Re)&&(ce=Re),Y.length>0&&(ce<0||te<0)||te>this.length)throw new RangeError("Attempt to write outside buffer bounds");xe||(xe="utf8");let We=!1;for(;;)switch(xe){case"hex":return G(this,Y,te,ce);case"utf8":case"utf-8":return q(this,Y,te,ce);case"ascii":case"latin1":case"binary":return ne(this,Y,te,ce);case"base64":return K(this,Y,te,ce);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,Y,te,ce);default:if(We)throw new TypeError("Unknown encoding: "+xe);xe=(""+xe).toLowerCase(),We=!0}},p.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const ee=4096;function de(Y,te,ce){let xe="";ce=Math.min(Y.length,ce);for(let Re=te;Re<ce;++Re)xe+=String.fromCharCode(127&Y[Re]);return xe}function oe(Y,te,ce){let xe="";ce=Math.min(Y.length,ce);for(let Re=te;Re<ce;++Re)xe+=String.fromCharCode(Y[Re]);return xe}function we(Y,te,ce){const xe=Y.length;(!te||te<0)&&(te=0),(!ce||ce<0||ce>xe)&&(ce=xe);let Re="";for(let We=te;We<ce;++We)Re+=Ee[Y[We]];return Re}function $e(Y,te,ce){const xe=Y.slice(te,ce);let Re="";for(let We=0;We<xe.length-1;We+=2)Re+=String.fromCharCode(xe[We]+256*xe[We+1]);return Re}function Me(Y,te,ce){if(Y%1!=0||Y<0)throw new RangeError("offset is not uint");if(Y+te>ce)throw new RangeError("Trying to access beyond buffer length")}function Ne(Y,te,ce,xe,Re,We){if(!p.isBuffer(Y))throw new TypeError('"buffer" argument must be a Buffer instance');if(te>Re||te<We)throw new RangeError('"value" argument is out of bounds');if(ce+xe>Y.length)throw new RangeError("Index out of range")}function Ae(Y,te,ce,xe,Re){Rt(te,xe,Re,Y,ce,7);let We=Number(te&BigInt(4294967295));Y[ce++]=We,We>>=8,Y[ce++]=We,We>>=8,Y[ce++]=We,We>>=8,Y[ce++]=We;let at=Number(te>>BigInt(32)&BigInt(4294967295));return Y[ce++]=at,at>>=8,Y[ce++]=at,at>>=8,Y[ce++]=at,at>>=8,Y[ce++]=at,ce}function Fe(Y,te,ce,xe,Re){Rt(te,xe,Re,Y,ce,7);let We=Number(te&BigInt(4294967295));Y[ce+7]=We,We>>=8,Y[ce+6]=We,We>>=8,Y[ce+5]=We,We>>=8,Y[ce+4]=We;let at=Number(te>>BigInt(32)&BigInt(4294967295));return Y[ce+3]=at,at>>=8,Y[ce+2]=at,at>>=8,Y[ce+1]=at,at>>=8,Y[ce]=at,ce+8}function Ie(Y,te,ce,xe,Re,We){if(ce+xe>Y.length)throw new RangeError("Index out of range");if(ce<0)throw new RangeError("Index out of range")}function qe(Y,te,ce,xe,Re){return te=+te,ce>>>=0,Re||Ie(Y,0,ce,4),s.write(Y,te,ce,xe,23,4),ce+4}function dt(Y,te,ce,xe,Re){return te=+te,ce>>>=0,Re||Ie(Y,0,ce,8),s.write(Y,te,ce,xe,52,8),ce+8}p.prototype.slice=function(Y,te){const ce=this.length;(Y=~~Y)<0?(Y+=ce)<0&&(Y=0):Y>ce&&(Y=ce),(te=te===void 0?ce:~~te)<0?(te+=ce)<0&&(te=0):te>ce&&(te=ce),te<Y&&(te=Y);const xe=this.subarray(Y,te);return Object.setPrototypeOf(xe,p.prototype),xe},p.prototype.readUintLE=p.prototype.readUIntLE=function(Y,te,ce){Y>>>=0,te>>>=0,ce||Me(Y,te,this.length);let xe=this[Y],Re=1,We=0;for(;++We<te&&(Re*=256);)xe+=this[Y+We]*Re;return xe},p.prototype.readUintBE=p.prototype.readUIntBE=function(Y,te,ce){Y>>>=0,te>>>=0,ce||Me(Y,te,this.length);let xe=this[Y+--te],Re=1;for(;te>0&&(Re*=256);)xe+=this[Y+--te]*Re;return xe},p.prototype.readUint8=p.prototype.readUInt8=function(Y,te){return Y>>>=0,te||Me(Y,1,this.length),this[Y]},p.prototype.readUint16LE=p.prototype.readUInt16LE=function(Y,te){return Y>>>=0,te||Me(Y,2,this.length),this[Y]|this[Y+1]<<8},p.prototype.readUint16BE=p.prototype.readUInt16BE=function(Y,te){return Y>>>=0,te||Me(Y,2,this.length),this[Y]<<8|this[Y+1]},p.prototype.readUint32LE=p.prototype.readUInt32LE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),(this[Y]|this[Y+1]<<8|this[Y+2]<<16)+16777216*this[Y+3]},p.prototype.readUint32BE=p.prototype.readUInt32BE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),16777216*this[Y]+(this[Y+1]<<16|this[Y+2]<<8|this[Y+3])},p.prototype.readBigUInt64LE=Te(function(Y){Et(Y>>>=0,"offset");const te=this[Y],ce=this[Y+7];te!==void 0&&ce!==void 0||Ze(Y,this.length-8);const xe=te+256*this[++Y]+65536*this[++Y]+this[++Y]*2**24,Re=this[++Y]+256*this[++Y]+65536*this[++Y]+ce*2**24;return BigInt(xe)+(BigInt(Re)<<BigInt(32))}),p.prototype.readBigUInt64BE=Te(function(Y){Et(Y>>>=0,"offset");const te=this[Y],ce=this[Y+7];te!==void 0&&ce!==void 0||Ze(Y,this.length-8);const xe=te*2**24+65536*this[++Y]+256*this[++Y]+this[++Y],Re=this[++Y]*2**24+65536*this[++Y]+256*this[++Y]+ce;return(BigInt(xe)<<BigInt(32))+BigInt(Re)}),p.prototype.readIntLE=function(Y,te,ce){Y>>>=0,te>>>=0,ce||Me(Y,te,this.length);let xe=this[Y],Re=1,We=0;for(;++We<te&&(Re*=256);)xe+=this[Y+We]*Re;return Re*=128,xe>=Re&&(xe-=Math.pow(2,8*te)),xe},p.prototype.readIntBE=function(Y,te,ce){Y>>>=0,te>>>=0,ce||Me(Y,te,this.length);let xe=te,Re=1,We=this[Y+--xe];for(;xe>0&&(Re*=256);)We+=this[Y+--xe]*Re;return Re*=128,We>=Re&&(We-=Math.pow(2,8*te)),We},p.prototype.readInt8=function(Y,te){return Y>>>=0,te||Me(Y,1,this.length),128&this[Y]?-1*(255-this[Y]+1):this[Y]},p.prototype.readInt16LE=function(Y,te){Y>>>=0,te||Me(Y,2,this.length);const ce=this[Y]|this[Y+1]<<8;return 32768&ce?4294901760|ce:ce},p.prototype.readInt16BE=function(Y,te){Y>>>=0,te||Me(Y,2,this.length);const ce=this[Y+1]|this[Y]<<8;return 32768&ce?4294901760|ce:ce},p.prototype.readInt32LE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),this[Y]|this[Y+1]<<8|this[Y+2]<<16|this[Y+3]<<24},p.prototype.readInt32BE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),this[Y]<<24|this[Y+1]<<16|this[Y+2]<<8|this[Y+3]},p.prototype.readBigInt64LE=Te(function(Y){Et(Y>>>=0,"offset");const te=this[Y],ce=this[Y+7];te!==void 0&&ce!==void 0||Ze(Y,this.length-8);const xe=this[Y+4]+256*this[Y+5]+65536*this[Y+6]+(ce<<24);return(BigInt(xe)<<BigInt(32))+BigInt(te+256*this[++Y]+65536*this[++Y]+this[++Y]*2**24)}),p.prototype.readBigInt64BE=Te(function(Y){Et(Y>>>=0,"offset");const te=this[Y],ce=this[Y+7];te!==void 0&&ce!==void 0||Ze(Y,this.length-8);const xe=(te<<24)+65536*this[++Y]+256*this[++Y]+this[++Y];return(BigInt(xe)<<BigInt(32))+BigInt(this[++Y]*2**24+65536*this[++Y]+256*this[++Y]+ce)}),p.prototype.readFloatLE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),s.read(this,Y,!0,23,4)},p.prototype.readFloatBE=function(Y,te){return Y>>>=0,te||Me(Y,4,this.length),s.read(this,Y,!1,23,4)},p.prototype.readDoubleLE=function(Y,te){return Y>>>=0,te||Me(Y,8,this.length),s.read(this,Y,!0,52,8)},p.prototype.readDoubleBE=function(Y,te){return Y>>>=0,te||Me(Y,8,this.length),s.read(this,Y,!1,52,8)},p.prototype.writeUintLE=p.prototype.writeUIntLE=function(Y,te,ce,xe){Y=+Y,te>>>=0,ce>>>=0,xe||Ne(this,Y,te,ce,Math.pow(2,8*ce)-1,0);let Re=1,We=0;for(this[te]=255&Y;++We<ce&&(Re*=256);)this[te+We]=Y/Re&255;return te+ce},p.prototype.writeUintBE=p.prototype.writeUIntBE=function(Y,te,ce,xe){Y=+Y,te>>>=0,ce>>>=0,xe||Ne(this,Y,te,ce,Math.pow(2,8*ce)-1,0);let Re=ce-1,We=1;for(this[te+Re]=255&Y;--Re>=0&&(We*=256);)this[te+Re]=Y/We&255;return te+ce},p.prototype.writeUint8=p.prototype.writeUInt8=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,1,255,0),this[te]=255&Y,te+1},p.prototype.writeUint16LE=p.prototype.writeUInt16LE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,2,65535,0),this[te]=255&Y,this[te+1]=Y>>>8,te+2},p.prototype.writeUint16BE=p.prototype.writeUInt16BE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,2,65535,0),this[te]=Y>>>8,this[te+1]=255&Y,te+2},p.prototype.writeUint32LE=p.prototype.writeUInt32LE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,4,4294967295,0),this[te+3]=Y>>>24,this[te+2]=Y>>>16,this[te+1]=Y>>>8,this[te]=255&Y,te+4},p.prototype.writeUint32BE=p.prototype.writeUInt32BE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,4,4294967295,0),this[te]=Y>>>24,this[te+1]=Y>>>16,this[te+2]=Y>>>8,this[te+3]=255&Y,te+4},p.prototype.writeBigUInt64LE=Te(function(Y,te=0){return Ae(this,Y,te,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeBigUInt64BE=Te(function(Y,te=0){return Fe(this,Y,te,BigInt(0),BigInt("0xffffffffffffffff"))}),p.prototype.writeIntLE=function(Y,te,ce,xe){if(Y=+Y,te>>>=0,!xe){const ln=Math.pow(2,8*ce-1);Ne(this,Y,te,ce,ln-1,-ln)}let Re=0,We=1,at=0;for(this[te]=255&Y;++Re<ce&&(We*=256);)Y<0&&at===0&&this[te+Re-1]!==0&&(at=1),this[te+Re]=(Y/We|0)-at&255;return te+ce},p.prototype.writeIntBE=function(Y,te,ce,xe){if(Y=+Y,te>>>=0,!xe){const ln=Math.pow(2,8*ce-1);Ne(this,Y,te,ce,ln-1,-ln)}let Re=ce-1,We=1,at=0;for(this[te+Re]=255&Y;--Re>=0&&(We*=256);)Y<0&&at===0&&this[te+Re+1]!==0&&(at=1),this[te+Re]=(Y/We|0)-at&255;return te+ce},p.prototype.writeInt8=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,1,127,-128),Y<0&&(Y=255+Y+1),this[te]=255&Y,te+1},p.prototype.writeInt16LE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,2,32767,-32768),this[te]=255&Y,this[te+1]=Y>>>8,te+2},p.prototype.writeInt16BE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,2,32767,-32768),this[te]=Y>>>8,this[te+1]=255&Y,te+2},p.prototype.writeInt32LE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,4,2147483647,-2147483648),this[te]=255&Y,this[te+1]=Y>>>8,this[te+2]=Y>>>16,this[te+3]=Y>>>24,te+4},p.prototype.writeInt32BE=function(Y,te,ce){return Y=+Y,te>>>=0,ce||Ne(this,Y,te,4,2147483647,-2147483648),Y<0&&(Y=4294967295+Y+1),this[te]=Y>>>24,this[te+1]=Y>>>16,this[te+2]=Y>>>8,this[te+3]=255&Y,te+4},p.prototype.writeBigInt64LE=Te(function(Y,te=0){return Ae(this,Y,te,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),p.prototype.writeBigInt64BE=Te(function(Y,te=0){return Fe(this,Y,te,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),p.prototype.writeFloatLE=function(Y,te,ce){return qe(this,Y,te,!0,ce)},p.prototype.writeFloatBE=function(Y,te,ce){return qe(this,Y,te,!1,ce)},p.prototype.writeDoubleLE=function(Y,te,ce){return dt(this,Y,te,!0,ce)},p.prototype.writeDoubleBE=function(Y,te,ce){return dt(this,Y,te,!1,ce)},p.prototype.copy=function(Y,te,ce,xe){if(!p.isBuffer(Y))throw new TypeError("argument should be a Buffer");if(ce||(ce=0),xe||xe===0||(xe=this.length),te>=Y.length&&(te=Y.length),te||(te=0),xe>0&&xe<ce&&(xe=ce),xe===ce||Y.length===0||this.length===0)return 0;if(te<0)throw new RangeError("targetStart out of bounds");if(ce<0||ce>=this.length)throw new RangeError("Index out of range");if(xe<0)throw new RangeError("sourceEnd out of bounds");xe>this.length&&(xe=this.length),Y.length-te<xe-ce&&(xe=Y.length-te+ce);const Re=xe-ce;return this===Y&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(te,ce,xe):Uint8Array.prototype.set.call(Y,this.subarray(ce,xe),te),Re},p.prototype.fill=function(Y,te,ce,xe){if(typeof Y=="string"){if(typeof te=="string"?(xe=te,te=0,ce=this.length):typeof ce=="string"&&(xe=ce,ce=this.length),xe!==void 0&&typeof xe!="string")throw new TypeError("encoding must be a string");if(typeof xe=="string"&&!p.isEncoding(xe))throw new TypeError("Unknown encoding: "+xe);if(Y.length===1){const We=Y.charCodeAt(0);(xe==="utf8"&&We<128||xe==="latin1")&&(Y=We)}}else typeof Y=="number"?Y&=255:typeof Y=="boolean"&&(Y=Number(Y));if(te<0||this.length<te||this.length<ce)throw new RangeError("Out of range index");if(ce<=te)return this;let Re;if(te>>>=0,ce=ce===void 0?this.length:ce>>>0,Y||(Y=0),typeof Y=="number")for(Re=te;Re<ce;++Re)this[Re]=Y;else{const We=p.isBuffer(Y)?Y:p.from(Y,xe),at=We.length;if(at===0)throw new TypeError('The value "'+Y+'" is invalid for argument "value"');for(Re=0;Re<ce-te;++Re)this[Re+te]=We[Re%at]}return this};const Wt={};function xt(Y,te,ce){Wt[Y]=class extends ce{constructor(){super(),Object.defineProperty(this,"message",{value:te.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Y}]`,this.stack,delete this.name}get code(){return Y}set code(xe){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:xe,writable:!0})}toString(){return`${this.name} [${Y}]: ${this.message}`}}}function At(Y){let te="",ce=Y.length;const xe=Y[0]==="-"?1:0;for(;ce>=xe+4;ce-=3)te=`_${Y.slice(ce-3,ce)}${te}`;return`${Y.slice(0,ce)}${te}`}function Rt(Y,te,ce,xe,Re,We){if(Y>ce||Y<te){const at=typeof te=="bigint"?"n":"";let ln;throw ln=te===0||te===BigInt(0)?`>= 0${at} and < 2${at} ** ${8*(We+1)}${at}`:`>= -(2${at} ** ${8*(We+1)-1}${at}) and < 2 ** ${8*(We+1)-1}${at}`,new Wt.ERR_OUT_OF_RANGE("value",ln,Y)}(function(at,ln,ve){Et(ln,"offset"),at[ln]!==void 0&&at[ln+ve]!==void 0||Ze(ln,at.length-(ve+1))})(xe,Re,We)}function Et(Y,te){if(typeof Y!="number")throw new Wt.ERR_INVALID_ARG_TYPE(te,"number",Y)}function Ze(Y,te,ce){throw Math.floor(Y)!==Y?(Et(Y,ce),new Wt.ERR_OUT_OF_RANGE("offset","an integer",Y)):te<0?new Wt.ERR_BUFFER_OUT_OF_BOUNDS:new Wt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${te}`,Y)}xt("ERR_BUFFER_OUT_OF_BOUNDS",function(Y){return Y?`${Y} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),xt("ERR_INVALID_ARG_TYPE",function(Y,te){return`The "${Y}" argument must be of type number. Received type ${typeof te}`},TypeError),xt("ERR_OUT_OF_RANGE",function(Y,te,ce){let xe=`The value of "${Y}" is out of range.`,Re=ce;return Number.isInteger(ce)&&Math.abs(ce)>2**32?Re=At(String(ce)):typeof ce=="bigint"&&(Re=String(ce),(ce>BigInt(2)**BigInt(32)||ce<-(BigInt(2)**BigInt(32)))&&(Re=At(Re)),Re+="n"),xe+=` It must be ${te}. Received ${Re}`,xe},RangeError);const It=/[^+/0-9A-Za-z-_]/g;function Lt(Y,te){let ce;te=te||1/0;const xe=Y.length;let Re=null;const We=[];for(let at=0;at<xe;++at){if(ce=Y.charCodeAt(at),ce>55295&&ce<57344){if(!Re){if(ce>56319){(te-=3)>-1&&We.push(239,191,189);continue}if(at+1===xe){(te-=3)>-1&&We.push(239,191,189);continue}Re=ce;continue}if(ce<56320){(te-=3)>-1&&We.push(239,191,189),Re=ce;continue}ce=65536+(Re-55296<<10|ce-56320)}else Re&&(te-=3)>-1&&We.push(239,191,189);if(Re=null,ce<128){if((te-=1)<0)break;We.push(ce)}else if(ce<2048){if((te-=2)<0)break;We.push(ce>>6|192,63&ce|128)}else if(ce<65536){if((te-=3)<0)break;We.push(ce>>12|224,ce>>6&63|128,63&ce|128)}else{if(!(ce<1114112))throw new Error("Invalid code point");if((te-=4)<0)break;We.push(ce>>18|240,ce>>12&63|128,ce>>6&63|128,63&ce|128)}}return We}function Yt(Y){return i.toByteArray(function(te){if((te=(te=te.split("=")[0]).trim().replace(It,"")).length<2)return"";for(;te.length%4!=0;)te+="=";return te}(Y))}function ht(Y,te,ce,xe){let Re;for(Re=0;Re<xe&&!(Re+ce>=te.length||Re>=Y.length);++Re)te[Re+ce]=Y[Re];return Re}function yt(Y,te){return Y instanceof te||Y!=null&&Y.constructor!=null&&Y.constructor.name!=null&&Y.constructor.name===te.name}function wt(Y){return Y!=Y}const Ee=function(){const Y="0123456789abcdef",te=new Array(256);for(let ce=0;ce<16;++ce){const xe=16*ce;for(let Re=0;Re<16;++Re)te[xe+Re]=Y[ce]+Y[Re]}return te}();function Te(Y){return typeof BigInt>"u"?Gt:Y}function Gt(){throw new Error("BigInt not supported")}},9089:n=>{n.exports=function(e){var t=[];return t.toString=function(){return this.map(function(i){var s="",l=i[5]!==void 0;return i[4]&&(s+="@supports (".concat(i[4],") {")),i[2]&&(s+="@media ".concat(i[2]," {")),l&&(s+="@layer".concat(i[5].length>0?" ".concat(i[5]):""," {")),s+=e(i),l&&(s+="}"),i[2]&&(s+="}"),i[4]&&(s+="}"),s}).join("")},t.i=function(i,s,l,u,d){typeof i=="string"&&(i=[[null,i,void 0]]);var p={};if(l)for(var g=0;g<this.length;g++){var x=this[g][0];x!=null&&(p[x]=!0)}for(var b=0;b<i.length;b++){var E=[].concat(i[b]);l&&p[E[0]]||(d!==void 0&&(E[5]===void 0||(E[1]="@layer".concat(E[5].length>0?" ".concat(E[5]):""," {").concat(E[1],"}")),E[5]=d),s&&(E[2]&&(E[1]="@media ".concat(E[2]," {").concat(E[1],"}")),E[2]=s),u&&(E[4]?(E[1]="@supports (".concat(E[4],") {").concat(E[1],"}"),E[4]=u):E[4]="".concat(u)),t.push(E))}},t}},6492:n=>{n.exports=function(e,t){return t||(t={}),e&&(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},963:n=>{n.exports=function(e){var t=e[1],i=e[3];if(!i)return t;if(typeof btoa=="function"){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),u="/*# ".concat(l," */");return[t].concat([u]).join(`
`)}return[t].join(`
`)}},8878:(n,e,t)=>{e.formatArgs=function(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;s.splice(1,0,l,"color: inherit");let u=0,d=0;s[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(u++,p==="%c"&&(d=u))}),s.splice(d,0,l)},e.save=function(s){try{s?e.storage.setItem("debug",s):e.storage.removeItem("debug")}catch{}},e.load=function(){let s;try{s=e.storage.getItem("debug")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=l7e.DEBUG),s},e.useColors=function(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch{}}(),e.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),n.exports=t(8945)(e);const{formatters:i}=n.exports;i.j=function(s){try{return JSON.stringify(s)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}},8945:(n,e,t)=>{n.exports=function(i){function s(d){let p,g,x,b=null;function E(...S){if(!E.enabled)return;const M=E,R=Number(new Date),P=R-(p||R);M.diff=P,M.prev=p,M.curr=R,p=R,S[0]=s.coerce(S[0]),typeof S[0]!="string"&&S.unshift("%O");let k=0;S[0]=S[0].replace(/%([a-zA-Z%])/g,(F,V)=>{if(F==="%%")return"%";k++;const G=s.formatters[V];if(typeof G=="function"){const q=S[k];F=G.call(M,q),S.splice(k,1),k--}return F}),s.formatArgs.call(M,S),(M.log||s.log).apply(M,S)}return E.namespace=d,E.useColors=s.useColors(),E.color=s.selectColor(d),E.extend=l,E.destroy=s.destroy,Object.defineProperty(E,"enabled",{enumerable:!0,configurable:!1,get:()=>b!==null?b:(g!==s.namespaces&&(g=s.namespaces,x=s.enabled(d)),x),set:S=>{b=S}}),typeof s.init=="function"&&s.init(E),E}function l(d,p){const g=s(this.namespace+(p===void 0?":":p)+d);return g.log=this.log,g}function u(d,p){let g=0,x=0,b=-1,E=0;for(;g<d.length;)if(x<p.length&&(p[x]===d[g]||p[x]==="*"))p[x]==="*"?(b=x,E=g,x++):(g++,x++);else{if(b===-1)return!1;x=b+1,E++,g=E}for(;x<p.length&&p[x]==="*";)x++;return x===p.length}return s.debug=s,s.default=s,s.coerce=function(d){return d instanceof Error?d.stack||d.message:d},s.disable=function(){const d=[...s.names,...s.skips.map(p=>"-"+p)].join(",");return s.enable(""),d},s.enable=function(d){s.save(d),s.namespaces=d,s.names=[],s.skips=[];const p=(typeof d=="string"?d:"").trim().replace(" ",",").split(",").filter(Boolean);for(const g of p)g[0]==="-"?s.skips.push(g.slice(1)):s.names.push(g)},s.enabled=function(d){for(const p of s.skips)if(u(d,p))return!1;for(const p of s.names)if(u(d,p))return!0;return!1},s.humanize=t(9192),s.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(i).forEach(d=>{s[d]=i[d]}),s.names=[],s.skips=[],s.formatters={},s.selectColor=function(d){let p=0;for(let g=0;g<d.length;g++)p=(p<<5)-p+d.charCodeAt(g),p|=0;return s.colors[Math.abs(p)%s.colors.length]},s.enable(s.load()),s}},1124:(n,e,t)=>{var i=t(6240),s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function u(p,g,x){var b=g[x];if(b!=null){if(s.call(p,x)&&(p[x]===void 0||p[x]===null))throw new TypeError("Cannot convert undefined or null to object ("+x+")");s.call(p,x)&&i(b)?p[x]=d(Object(p[x]),g[x]):p[x]=b}}function d(p,g){if(p===g)return p;for(var x in g=Object(g))s.call(g,x)&&u(p,g,x);if(Object.getOwnPropertySymbols)for(var b=Object.getOwnPropertySymbols(g),E=0;E<b.length;E++)l.call(g,b[E])&&u(p,g,b[E]);return p}n.exports=function(p){p=function(x){if(x==null)throw new TypeError("Sources cannot be null or undefined");return Object(x)}(p);for(var g=1;g<arguments.length;g++)d(p,arguments[g]);return p}},8480:n=>{n.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},919:(n,e,t)=>{var i;i=typeof window<"u"?window:t.g!==void 0?t.g:typeof self<"u"?self:{},n.exports=i},1024:(n,e)=>{e.read=function(t,i,s,l,u){var d,p,g=8*u-l-1,x=(1<<g)-1,b=x>>1,E=-7,S=s?u-1:0,M=s?-1:1,R=t[i+S];for(S+=M,d=R&(1<<-E)-1,R>>=-E,E+=g;E>0;d=256*d+t[i+S],S+=M,E-=8);for(p=d&(1<<-E)-1,d>>=-E,E+=l;E>0;p=256*p+t[i+S],S+=M,E-=8);if(d===0)d=1-b;else{if(d===x)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,l),d-=b}return(R?-1:1)*p*Math.pow(2,d-l)},e.write=function(t,i,s,l,u,d){var p,g,x,b=8*d-u-1,E=(1<<b)-1,S=E>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=l?0:d-1,P=l?1:-1,k=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(g=isNaN(i)?1:0,p=E):(p=Math.floor(Math.log(i)/Math.LN2),i*(x=Math.pow(2,-p))<1&&(p--,x*=2),(i+=p+S>=1?M/x:M*Math.pow(2,1-S))*x>=2&&(p++,x/=2),p+S>=E?(g=0,p=E):p+S>=1?(g=(i*x-1)*Math.pow(2,u),p+=S):(g=i*Math.pow(2,S-1)*Math.pow(2,u),p=0));u>=8;t[s+R]=255&g,R+=P,g/=256,u-=8);for(p=p<<u|g,b+=u;b>0;t[s+R]=255&p,R+=P,p/=256,b-=8);t[s+R-P]|=128*k}},2225:n=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}n.exports=function(t){return t!=null&&(e(t)||function(i){return typeof i.readFloatLE=="function"&&typeof i.slice=="function"&&e(i.slice(0,0))}(t)||!!t._isBuffer)}},8847:n=>{n.exports=function(t){if(!t)return!1;var i=e.call(t);return i==="[object Function]"||typeof t=="function"&&i!=="[object RegExp]"||typeof window<"u"&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)};var e=Object.prototype.toString},6240:n=>{n.exports=function(e){var t=typeof e;return e!==null&&(t==="object"||t==="function")}},5651:(n,e,t)=>{var i=t(5406),s=t(4597),l=t(5734),u=["x","e","a","o","n","s","r","c","u","m","v","w","z"],d=["m","w"],p=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],g=9,x=32;function b(P){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(P)}function E(P){return new Function(["return function "+P+"() {","  return this._"+P,"}"].join(`
`))()}function S(P,k){if(!P.chars||P.chars.length===0)return null;var F=R(P.chars,k);return F>=0?P.chars[F]:null}function M(P,k,F){if(!P.kernings||P.kernings.length===0)return 0;for(var V=P.kernings,G=0;G<V.length;G++){var q=V[G];if(q.first===k&&q.second===F)return q.amount}return 0}function R(P,k,F){for(var V=F=F||0;V<P.length;V++)if(P[V].id===k)return V;return-1}n.exports=function(P){return new b(P)},b.prototype.update=function(P){if(P=s({measure:this._measure},P),this._opt=P,this._opt.tabSize=l(this._opt.tabSize,4),!P.font)throw new Error("must provide a valid bitmap font");var k=this.glyphs,F=P.text||"",V=P.font;this._setupSpaceGlyphs(V);var G=i.lines(F,P),q=P.width||0;k.length=0;var ne=G.reduce(function(Me,Ne){return Math.max(Me,Ne.width,q)},0),K=0,Q=0,H=l(P.lineHeight,V.common.lineHeight),j=V.common.base,ee=H-j,de=P.letterSpacing||0,oe=H*G.length-ee,we=function(Me){return Me==="center"?1:Me==="right"?2:0}(this._opt.align);Q-=oe,this._width=ne,this._height=oe,this._descender=H-j,this._baseline=j,this._xHeight=function(Me){for(var Ne=0;Ne<u.length;Ne++){var Ae=u[Ne].charCodeAt(0),Fe=R(Me.chars,Ae);if(Fe>=0)return Me.chars[Fe].height}return 0}(V),this._capHeight=function(Me){for(var Ne=0;Ne<p.length;Ne++){var Ae=p[Ne].charCodeAt(0),Fe=R(Me.chars,Ae);if(Fe>=0)return Me.chars[Fe].height}return 0}(V),this._lineHeight=H,this._ascender=H-ee-this._xHeight;var $e=this;G.forEach(function(Me,Ne){for(var Ae,Fe=Me.start,Ie=Me.end,qe=Me.width,dt=Fe;dt<Ie;dt++){var Wt=F.charCodeAt(dt),xt=$e.getGlyph(V,Wt);if(xt){Ae&&(K+=M(V,Ae.id,xt.id));var At=K;we===1?At+=(ne-qe)/2:we===2&&(At+=ne-qe),k.push({position:[At,Q],data:xt,index:dt,line:Ne}),K+=xt.xadvance+de,Ae=xt}}Q+=H,K=0}),this._linesTotal=G.length},b.prototype._setupSpaceGlyphs=function(P){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,P.chars&&P.chars.length!==0){var k=S(P,x)||function(V){for(var G=0;G<d.length;G++){var q=d[G].charCodeAt(0),ne=R(V.chars,q);if(ne>=0)return V.chars[ne]}return 0}(P)||P.chars[0],F=this._opt.tabSize*k.xadvance;this._fallbackSpaceGlyph=k,this._fallbackTabGlyph=s(k,{x:0,y:0,xadvance:F,id:g,xoffset:0,yoffset:0,width:0,height:0})}},b.prototype.getGlyph=function(P,k){return S(P,k)||(k===g?this._fallbackTabGlyph:k===x?this._fallbackSpaceGlyph:null)},b.prototype.computeMetrics=function(P,k,F,V){var G,q=this._opt.letterSpacing||0,ne=this._opt.font,K=0,Q=0,H=0;if(!ne.chars||ne.chars.length===0)return{start:k,end:k,width:0};F=Math.min(P.length,F);for(var j=k;j<F;j++){var ee,de=P.charCodeAt(j);if(ee=this.getGlyph(ne,de)){ee.xoffset;var oe=(K+=G?M(ne,G.id,ee.id):0)+ee.xadvance+q,we=K+ee.width;if(we>=V||oe>=V)break;K=oe,Q=we,G=ee}H++}return G&&(Q+=G.xoffset),{start:k,end:k+H,width:Q}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(P){Object.defineProperty(b.prototype,P,{get:E(P),configurable:!0})})},5751:(n,e,t)=>{var i=t(9922).hp,s=t(3558),l=function(){},u=t(1476),d=t(7034),p=t(7480),g=t(573),x=t(4597),b=self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;n.exports=function(E,S){S=typeof S=="function"?S:l,typeof E=="string"?E={uri:E}:E||(E={}),E.binary&&(E=function(M){if(b)return x(M,{responseType:"arraybuffer"});if(self.XMLHttpRequest===void 0)throw new Error("your browser does not support XHR loading");var R=new self.XMLHttpRequest;return R.overrideMimeType("text/plain; charset=x-user-defined"),x({xhr:R},M)}(E)),s(E,function(M,R,P){if(M)return S(M);if(!/^2/.test(R.statusCode))return S(new Error("http status code: "+R.statusCode));if(!P)return S(new Error("no body result"));var k,F,V=!1;if(k=P,Object.prototype.toString.call(k)==="[object ArrayBuffer]"){var G=new Uint8Array(P);P=i.from(G,"binary")}g(P)&&(V=!0,typeof P=="string"&&(P=i.from(P,"binary"))),V||(i.isBuffer(P)&&(P=P.toString(E.encoding)),P=P.trim());try{var q=R.headers["content-type"];F=V?p(P):/json/.test(q)||P.charAt(0)==="{"?JSON.parse(P):/xml/.test(q)||P.charAt(0)==="<"?d(P):u(P)}catch(ne){S(new Error("error parsing font "+ne.message)),S=l}S(null,F)})}},573:(n,e,t)=>{var i=t(9922).hp,s=t(911),l=i.from([66,77,70,3]);n.exports=function(u){return typeof u=="string"?u.substring(0,3)==="BMF":u.length>4&&s(u.slice(0,4),l)}},9192:n=>{var e=1e3,t=60*e,i=60*t,s=24*i,l=7*s;function u(d,p,g,x){var b=p>=1.5*g;return Math.round(d/g)+" "+x+(b?"s":"")}n.exports=function(d,p){p=p||{};var g,x,b=typeof d;if(b==="string"&&d.length>0)return function(E){if(!((E=String(E)).length>100)){var S=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(E);if(S){var M=parseFloat(S[1]);switch((S[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*M;case"weeks":case"week":case"w":return M*l;case"days":case"day":case"d":return M*s;case"hours":case"hour":case"hrs":case"hr":case"h":return M*i;case"minutes":case"minute":case"mins":case"min":case"m":return M*t;case"seconds":case"second":case"secs":case"sec":case"s":return M*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return M;default:return}}}}(d);if(b==="number"&&isFinite(d))return p.long?(g=d,(x=Math.abs(g))>=s?u(g,x,s,"day"):x>=i?u(g,x,i,"hour"):x>=t?u(g,x,t,"minute"):x>=e?u(g,x,e,"second"):g+" ms"):function(E){var S=Math.abs(E);return S>=s?Math.round(E/s)+"d":S>=i?Math.round(E/i)+"h":S>=t?Math.round(E/t)+"m":S>=e?Math.round(E/e)+"s":E+"ms"}(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},1476:n=>{function e(i,s){if(!(i=i.replace(/\t+/g," ").trim()))return null;var l=i.indexOf(" ");if(l===-1)throw new Error("no named row at line "+s);var u=i.substring(0,l);i=(i=(i=(i=i.substring(l+1)).replace(/letter=[\'\"]\S+[\'\"]/gi,"")).split("=")).map(function(b){return b.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var d=[],p=0;p<i.length;p++){var g=i[p];p===0?d.push({key:g[0],data:""}):p===i.length-1?d[d.length-1].data=t(g[0]):(d[d.length-1].data=t(g[0]),d.push({key:g[1],data:""}))}var x={key:u,data:{}};return d.forEach(function(b){x.data[b.key]=b.data}),x}function t(i){return i&&i.length!==0?i.indexOf('"')===0||i.indexOf("'")===0?i.substring(1,i.length-1):i.indexOf(",")!==-1?function(s){return s.split(",").map(function(l){return parseInt(l,10)})}(i):parseInt(i,10):""}n.exports=function(i){if(!i)throw new Error("no data provided");var s={pages:[],chars:[],kernings:[]},l=(i=i.toString().trim()).split(/\r\n?|\n/g);if(l.length===0)throw new Error("no data in BMFont file");for(var u=0;u<l.length;u++){var d=e(l[u],u);if(d)if(d.key==="page"){if(typeof d.data.id!="number")throw new Error("malformed file at line "+u+" -- needs page id=N");if(typeof d.data.file!="string")throw new Error("malformed file at line "+u+' -- needs page file="path"');s.pages[d.data.id]=d.data.file}else d.key==="chars"||d.key==="kernings"||(d.key==="char"?s.chars.push(d.data):d.key==="kerning"?s.kernings.push(d.data):s[d.key]=d.data)}return s}},7480:n=>{var e=[66,77,70];function t(s,l,u){if(u>l.length-1)return 0;var d=l.readUInt8(u++),p=l.readInt32LE(u);switch(u+=4,d){case 1:s.info=function(g,x){var b={};b.size=g.readInt16LE(x);var E=g.readUInt8(x+2);return b.smooth=E>>7&1,b.unicode=E>>6&1,b.italic=E>>5&1,b.bold=E>>4&1,E>>3&1&&(b.fixedHeight=1),b.charset=g.readUInt8(x+3)||"",b.stretchH=g.readUInt16LE(x+4),b.aa=g.readUInt8(x+6),b.padding=[g.readInt8(x+7),g.readInt8(x+8),g.readInt8(x+9),g.readInt8(x+10)],b.spacing=[g.readInt8(x+11),g.readInt8(x+12)],b.outline=g.readUInt8(x+13),b.face=function(S,M){return i(S,M).toString("utf8")}(g,x+14),b}(l,u);break;case 2:s.common=function(g,x){var b={};return b.lineHeight=g.readUInt16LE(x),b.base=g.readUInt16LE(x+2),b.scaleW=g.readUInt16LE(x+4),b.scaleH=g.readUInt16LE(x+6),b.pages=g.readUInt16LE(x+8),g.readUInt8(x+10),b.packed=0,b.alphaChnl=g.readUInt8(x+11),b.redChnl=g.readUInt8(x+12),b.greenChnl=g.readUInt8(x+13),b.blueChnl=g.readUInt8(x+14),b}(l,u);break;case 3:s.pages=function(g,x,b){for(var E=[],S=i(g,x),M=S.length+1,R=b/M,P=0;P<R;P++)E[P]=g.slice(x,x+S.length).toString("utf8"),x+=M;return E}(l,u,p);break;case 4:s.chars=function(g,x,b){for(var E=[],S=b/20,M=0;M<S;M++){var R={},P=20*M;R.id=g.readUInt32LE(x+0+P),R.x=g.readUInt16LE(x+4+P),R.y=g.readUInt16LE(x+6+P),R.width=g.readUInt16LE(x+8+P),R.height=g.readUInt16LE(x+10+P),R.xoffset=g.readInt16LE(x+12+P),R.yoffset=g.readInt16LE(x+14+P),R.xadvance=g.readInt16LE(x+16+P),R.page=g.readUInt8(x+18+P),R.chnl=g.readUInt8(x+19+P),E[M]=R}return E}(l,u,p);break;case 5:s.kernings=function(g,x,b){for(var E=[],S=b/10,M=0;M<S;M++){var R={},P=10*M;R.first=g.readUInt32LE(x+0+P),R.second=g.readUInt32LE(x+4+P),R.amount=g.readInt16LE(x+8+P),E[M]=R}return E}(l,u,p)}return 5+p}function i(s,l){for(var u=l;u<s.length&&s[u]!==0;u++);return s.slice(l,u)}n.exports=function(s){if(s.length<6)throw new Error("invalid buffer length for BMFont");var l=e.every(function(g,x){return s.readUInt8(x)===g});if(!l)throw new Error("BMFont missing BMF byte header");var u=3;if(s.readUInt8(u++)>3)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var d={kernings:[],chars:[]},p=0;p<5;p++)u+=t(d,s,u);return d}},7034:(n,e,t)=>{var i=t(7829),s=t(1896),l={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};function u(d){var p=function(g){for(var x=[],b=0;b<g.attributes.length;b++)x.push(g.attributes[b]);return x}(d);return p.reduce(function(g,x){var b;return g[b=x.nodeName,l[b.toLowerCase()]||b]=x.nodeValue,g},{})}n.exports=function(d){d=d.toString();var p=s(d),g={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(P){var k=p.getElementsByTagName(P)[0];k&&(g[P]=i(u(k)))});var x=p.getElementsByTagName("pages")[0];if(!x)throw new Error("malformed file -- no <pages> element");for(var b=x.getElementsByTagName("page"),E=0;E<b.length;E++){var S=b[E],M=parseInt(S.getAttribute("id"),10),R=S.getAttribute("file");if(isNaN(M))throw new Error('malformed file -- page "id" attribute is NaN');if(!R)throw new Error('malformed file -- needs page "file" attribute');g.pages[parseInt(M,10)]=R}return["chars","kernings"].forEach(function(P){var k=p.getElementsByTagName(P)[0];if(k)for(var F=P.substring(0,P.length-1),V=k.getElementsByTagName(F),G=0;G<V.length;G++){var q=V[G];g[P].push(i(u(q)))}}),g}},7829:n=>{var e="chasrset";n.exports=function(t){for(var i in t=Object.assign({},t),e in t&&(t.charset=t[e],delete t[e]),t)i!=="face"&&i!=="charset"&&(t[i]=i==="padding"||i==="spacing"?t[i].split(",").map(function(s){return parseInt(s,10)}):parseInt(t[i],10));return t}},3216:n=>{var e=function(t){return t.replace(/^\s+|\s+$/g,"")};n.exports=function(t){if(!t)return{};for(var i,s={},l=e(t).split(`
`),u=0;u<l.length;u++){var d=l[u],p=d.indexOf(":"),g=e(d.slice(0,p)).toLowerCase(),x=e(d.slice(p+1));s[g]===void 0?s[g]=x:(i=s[g],Object.prototype.toString.call(i)==="[object Array]"?s[g].push(x):s[g]=[s[g],x])}return s}},9035:(n,e,t)=>{var i=t(8480),s=t(8167),l=t(2225),u=[0,2,3],d=[2,1,3];n.exports=function(p,g){p&&(s(p)||l(p))||(g=p||{},p=null);for(var x=typeof(g=typeof g=="number"?{count:g}:g||{}).type=="string"?g.type:"uint16",b=typeof g.count=="number"?g.count:1,E=g.start||0,S=g.clockwise!==!1?u:d,M=S[0],R=S[1],P=S[2],k=6*b,F=p||new(i(x))(k),V=0,G=0;V<k;V+=6,G+=4){var q=V+E;F[q+0]=G+0,F[q+1]=G+1,F[q+2]=G+2,F[q+3]=G+M,F[q+4]=G+R,F[q+5]=G+P}return F}},4433:(n,e,t)=>{var i=t(5651),s=t(9035),l=t(7106),u=t(1684);n.exports=function(p){return new d(p)};class d extends THREE.BufferGeometry{constructor(g){super(),typeof g=="string"&&(g={text:g}),this._opt=Object.assign({},g),g&&this.update(g)}update(g){if(typeof g=="string"&&(g={text:g}),!(g=Object.assign({},this._opt,g)).font)throw new TypeError("must specify a { font } in options");this.layout=i(g);var x=g.flipY!==!1,b=g.font,E=b.common.scaleW,S=b.common.scaleH,M=this.layout.glyphs.filter(function(V){var G=V.data;return G.width*G.height>0});this.visibleGlyphs=M;var R=l.positions(M),P=l.uvs(M,E,S,x),k=s([],{clockwise:!0,type:"uint16",count:M.length});if(this.setIndex(k),this.setAttribute("position",new THREE.BufferAttribute(R,2)),this.setAttribute("uv",new THREE.BufferAttribute(P,2)),!g.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(g.multipage){var F=l.pages(M);this.setAttribute("page",new THREE.BufferAttribute(F,1))}this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere()}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new THREE.Sphere);var g=this.attributes.position.array,x=this.attributes.position.itemSize;if(!g||!x||g.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);u.computeSphere(g,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new THREE.Box3);var g=this.boundingBox,x=this.attributes.position.array,b=this.attributes.position.itemSize;!x||!b||x.length<2?g.makeEmpty():u.computeBox(x,g)}}},1684:n=>{var e={min:[0,0],max:[0,0]};function t(i){var s=i.length/2;e.min[0]=i[0],e.min[1]=i[1],e.max[0]=i[0],e.max[1]=i[1];for(var l=0;l<s;l++){var u=i[2*l+0],d=i[2*l+1];e.min[0]=Math.min(u,e.min[0]),e.min[1]=Math.min(d,e.min[1]),e.max[0]=Math.max(u,e.max[0]),e.max[1]=Math.max(d,e.max[1])}}n.exports.computeBox=function(i,s){t(i),s.min.set(e.min[0],e.min[1],0),s.max.set(e.max[0],e.max[1],0)},n.exports.computeSphere=function(i,s){t(i);var l=e.min[0],u=e.min[1],d=e.max[0]-l,p=e.max[1]-u,g=Math.sqrt(d*d+p*p);s.center.set(l+d/2,u+p/2,0),s.radius=g/2}},7106:n=>{n.exports.pages=function(e){var t=new Float32Array(4*e.length*1),i=0;return e.forEach(function(s){var l=s.data.page||0;t[i++]=l,t[i++]=l,t[i++]=l,t[i++]=l}),t},n.exports.uvs=function(e,t,i,s){var l=new Float32Array(4*e.length*2),u=0;return e.forEach(function(d){var p=d.data,g=p.x+p.width,x=p.y+p.height,b=p.x/t,E=p.y/i,S=g/t,M=x/i;s&&(E=(i-p.y)/i,M=(i-x)/i),l[u++]=b,l[u++]=E,l[u++]=b,l[u++]=M,l[u++]=S,l[u++]=M,l[u++]=S,l[u++]=E}),l},n.exports.positions=function(e){var t=new Float32Array(4*e.length*2),i=0;return e.forEach(function(s){var l=s.data,u=s.position[0]+l.xoffset,d=s.position[1]+l.yoffset,p=l.width,g=l.height;t[i++]=u,t[i++]=d,t[i++]=u,t[i++]=d+g,t[i++]=u+p,t[i++]=d+g,t[i++]=u+p,t[i++]=d}),t}},5406:n=>{var e=/\n/,t=/\s/;function i(u,d,p,g){var x=u.indexOf(d,p);return x===-1||x>g?g:x}function s(u){return t.test(u)}function l(u,d,p,g){return{start:d,end:d+Math.min(g,p-d)}}n.exports=function(u,d){return n.exports.lines(u,d).map(function(p){return u.substring(p.start,p.end)}).join(`
`)},n.exports.lines=function(u,d){if((d=d||{}).width===0&&d.mode!=="nowrap")return[];u=u||"";var p=typeof d.width=="number"?d.width:Number.MAX_VALUE,g=Math.max(0,d.start||0),x=typeof d.end=="number"?d.end:u.length,b=d.mode,E=d.measure||l;return b==="pre"?function(S,M,R,P,k){for(var F=[],V=R,G=R;G<P&&G<M.length;G++){var q=M.charAt(G),ne=e.test(q);if(ne||G===P-1){var K=S(M,V,ne?G:G+1,k);F.push(K),V=G+1}}return F}(E,u,g,x,p):function(S,M,R,P,k,F){var V=[],G=k;for(F==="nowrap"&&(G=Number.MAX_VALUE);R<P&&R<M.length;){for(var q=i(M,`
`,R,P);R<q&&s(M.charAt(R));)R++;var ne=S(M,R,q,G),K=R+(ne.end-ne.start),Q=K+1;if(K<q){for(;K>R&&!s(M.charAt(K));)K--;if(K===R)Q>R+1&&Q--,K=Q;else for(Q=K;K>R&&s(M.charAt(K-1));)K--}if(K>=R){var H=S(M,R,K,G);V.push(H)}R=Q}return V}(E,u,g,x,p,b)}},3558:(n,e,t)=>{var i=t(919),s=t(8847),l=t(3216),u=t(4597);function d(x,b,E){var S=x;return s(b)?(E=b,typeof x=="string"&&(S={uri:x})):S=u(b,{uri:x}),S.callback=E,S}function p(x,b,E){return g(b=d(x,b,E))}function g(x){if(x.callback===void 0)throw new Error("callback argument missing");var b=!1,E=function(ee,de,oe){b||(b=!0,x.callback(ee,de,oe))};function S(){var ee=void 0;if(ee=F.response?F.response:F.responseText||function(de){try{if(de.responseType==="document")return de.responseXML;var oe=de.responseXML&&de.responseXML.documentElement.nodeName==="parsererror";if(de.responseType===""&&!oe)return de.responseXML}catch{}return null}(F),H)try{ee=JSON.parse(ee)}catch{}return ee}function M(ee){return clearTimeout(V),ee instanceof Error||(ee=new Error(""+(ee||"Unknown XMLHttpRequest Error"))),ee.statusCode=0,E(ee,j)}function R(){if(!k){var ee;clearTimeout(V),ee=x.useXDR&&F.status===void 0?200:F.status===1223?204:F.status;var de=j,oe=null;return ee!==0?(de={body:S(),statusCode:ee,method:q,headers:{},url:G,rawRequest:F},F.getAllResponseHeaders&&(de.headers=l(F.getAllResponseHeaders()))):oe=new Error("Internal XMLHttpRequest Error"),E(oe,de,de.body)}}var P,k,F=x.xhr||null;F||(F=x.cors||x.useXDR?new p.XDomainRequest:new p.XMLHttpRequest);var V,G=F.url=x.uri||x.url,q=F.method=x.method||"GET",ne=x.body||x.data,K=F.headers=x.headers||{},Q=!!x.sync,H=!1,j={body:void 0,headers:{},statusCode:0,method:q,url:G,rawRequest:F};if("json"in x&&x.json!==!1&&(H=!0,K.accept||K.Accept||(K.Accept="application/json"),q!=="GET"&&q!=="HEAD"&&(K["content-type"]||K["Content-Type"]||(K["Content-Type"]="application/json"),ne=JSON.stringify(x.json===!0?ne:x.json))),F.onreadystatechange=function(){F.readyState===4&&setTimeout(R,0)},F.onload=R,F.onerror=M,F.onprogress=function(){},F.onabort=function(){k=!0},F.ontimeout=M,F.open(q,G,!Q,x.username,x.password),Q||(F.withCredentials=!!x.withCredentials),!Q&&x.timeout>0&&(V=setTimeout(function(){if(!k){k=!0,F.abort("timeout");var ee=new Error("XMLHttpRequest timeout");ee.code="ETIMEDOUT",M(ee)}},x.timeout)),F.setRequestHeader)for(P in K)K.hasOwnProperty(P)&&F.setRequestHeader(P,K[P]);else if(x.headers&&!function(ee){for(var de in ee)if(ee.hasOwnProperty(de))return!1;return!0}(x.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in x&&(F.responseType=x.responseType),"beforeSend"in x&&typeof x.beforeSend=="function"&&x.beforeSend(F),F.send(ne||null),F}n.exports=p,n.exports.default=p,p.XMLHttpRequest=i.XMLHttpRequest||function(){},p.XDomainRequest="withCredentials"in new p.XMLHttpRequest?p.XMLHttpRequest:i.XDomainRequest,function(x,b){for(var E=0;E<x.length;E++)b(x[E])}(["get","put","post","patch","head","delete"],function(x){p[x==="delete"?"del":x]=function(b,E,S){return(E=d(b,E,S)).method=x.toUpperCase(),g(E)}})},1896:n=>{n.exports=self.DOMParser!==void 0?function(e){return new self.DOMParser().parseFromString(e,"application/xml")}:self.ActiveXObject!==void 0&&new self.ActiveXObject("Microsoft.XMLDOM")?function(e){var t=new self.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}:function(e){var t=document.createElement("div");return t.innerHTML=e,t}},4597:n=>{n.exports=function(){for(var t={},i=0;i<arguments.length;i++){var s=arguments[i];for(var l in s)e.call(s,l)&&(t[l]=s[l])}return t};var e=Object.prototype.hasOwnProperty},8132:()=>{window.aframeStats=function(n){var e=null,t=n;return{update:function(){var i;e("te").set((i=t.querySelectorAll("*"),Array.prototype.slice.call(i).filter(function(s){return s.isEntity}),i.length)),window.performance.getEntriesByName&&e("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))},start:function(){},end:function(){},attach:function(i){e=i},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}}},3729:n=>{window.glStats=function(){var e=null,t=0,i=0,s=0,l=0,u=0,d=0,p=0;function g(x,b){return function(){b.apply(this,arguments),x.apply(this,arguments)}}return WebGLRenderingContext.prototype.drawArrays=g(WebGLRenderingContext.prototype.drawArrays,function(){t++,arguments[0]==this.POINTS?d+=arguments[2]:u+=arguments[2]}),WebGLRenderingContext.prototype.drawElements=g(WebGLRenderingContext.prototype.drawElements,function(){i++,l+=arguments[1]/3,u+=arguments[1]}),WebGLRenderingContext.prototype.useProgram=g(WebGLRenderingContext.prototype.useProgram,function(){s++}),WebGLRenderingContext.prototype.bindTexture=g(WebGLRenderingContext.prototype.bindTexture,function(){p++}),{update:function(){e("allcalls").set(t+i),e("drawElements").set(i),e("drawArrays").set(t),e("bindTexture").set(p),e("useProgram").set(s),e("glfaces").set(l),e("glvertices").set(u),e("glpoints").set(d)},start:function(){t=0,i=0,s=0,l=0,u=0,d=0,p=0},end:function(){},attach:function(x){e=x},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}},window.threeStats=function(e){var t=null;return{update:function(){var i;t("renderer.info.memory.geometries").set(e.info.memory.geometries),t("renderer.info.programs").set(((i=e.info.programs)==null?void 0:i.length)??NaN),t("renderer.info.memory.textures").set(e.info.memory.textures),t("renderer.info.render.calls").set(e.info.render.calls),t("renderer.info.render.triangles").set(e.info.render.triangles),t("renderer.info.render.points").set(e.info.render.points)},start:function(){},end:function(){},attach:function(i){t=i},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.triangles":{caption:"Triangles",over:1e3},"renderer.info.render.points":{caption:"Points"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.triangles","renderer.info.render.points"]}],fractions:[]}},window.BrowserStats=function(){var e=null,t=0,i=0;window.performance&&!performance.memory&&(performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}),performance.memory.totalJSHeapSize===0&&console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .");var s=Math.log(1024);function l(u){var d=Math.floor(Math.log(u)/s);return Math.round(100*u/Math.pow(1024,d))/100}return{update:function(){t=l(performance.memory.usedJSHeapSize),i=l(performance.memory.totalJSHeapSize),e("memory").set(t),e("total").set(i)},start:function(){t=0},end:function(){},attach:function(u){e=u},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}},n.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}},282:n=>{(function(){"performance"in window==0&&(window.performance={});var e=window.performance;if("now"in e==0){var t=Date.now();e.timing&&e.timing.navigationStart&&(t=e.timing.navigationStart),e.now=function(){return Date.now()-t}}e.mark||(e.mark=function(){}),e.measure||(e.measure=function(){})})(),window.rStats=function(e){function t(R,P){for(var k=Object.keys(R),F=0,V=k.length;F<V;F++)P(k[F])}var i=e||{},s=i.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],l=(i.CSSPath?i.CSSPath:"")+"rStats.css";(i.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",l]).forEach(function(R){var P,k;P=R,(k=document.createElement("link")).href=P,k.rel="stylesheet",k.type="text/css",document.getElementsByTagName("head")[0].appendChild(k)}),i.values||(i.values={});var u,d,p=10,g={};function x(R,P,k){var F=k||{},V=document.createElement("canvas"),G=V.getContext("2d"),q=0,ne=0,K=F.color?F.color:"#666666",Q=document.createElement("canvas"),H=Q.getContext("2d");Q.width=1,Q.height=20,H.fillStyle="#444444",H.fillRect(0,0,1,20),H.fillStyle=K,H.fillRect(0,p,1,p),H.fillStyle="#ffffff",H.globalAlpha=.5,H.fillRect(0,p,1,1),H.globalAlpha=1;var j=document.createElement("canvas"),ee=j.getContext("2d");return j.width=1,j.height=20,ee.fillStyle="#444444",ee.fillRect(0,0,1,20),ee.fillStyle="#b70000",ee.fillRect(0,p,1,p),ee.globalAlpha=.5,ee.fillStyle="#ffffff",ee.fillRect(0,p,1,1),ee.globalAlpha=1,V.width=200,V.height=p,V.style.width=V.width+"px",V.style.height=V.height+"px",V.className="rs-canvas",R.appendChild(V),G.fillStyle="#444444",G.fillRect(0,0,V.width,V.height),{draw:function(de,oe){(ne+=.1*(de-ne))>(q*=.99)&&(q=ne),G.drawImage(V,1,0,V.width-1,V.height,0,0,V.width-1,V.height),oe?G.drawImage(j,V.width-1,V.height-ne*V.height/q-p):G.drawImage(Q,V.width-1,V.height-ne*V.height/q-p)}}}function b(R,P){var k=document.createElement("canvas"),F=k.getContext("2d");return k.width=200,k.height=p*P,k.style.width=k.width+"px",k.style.height=k.height+"px",k.className="rs-canvas",R.appendChild(k),F.fillStyle="#444444",F.fillRect(0,0,k.width,k.height),{draw:function(V){F.drawImage(k,1,0,k.width-1,k.height,0,0,k.width-1,k.height);var G=0;t(V,function(q){var ne=V[q]*k.height;F.fillStyle=s[q],F.fillRect(k.width-1,G,1,ne),G+=ne})}}}function E(R,P){var k,F=R,V=0,G=0,q=0,ne=0,K=performance.now(),Q=0,H=document.createElement("div"),j=document.createElement("span"),ee=document.createElement("div"),de=document.createTextNode(""),oe=i?i.values[F.toLowerCase()]:null,we=new x(H,F,oe),$e=!1;function Me(Fe){if(oe&&oe.average){ne+=Fe,Q++;var Ie=performance.now();Ie-K>=(oe.avgMs||1e3)&&(q=ne/Q,ne=0,K=Ie,Q=0)}}function Ne(){k=performance.now(),i.userTimingAPI&&performance.mark(F+"-start"),$e=!0}function Ae(){V=performance.now()-k,i.userTimingAPI&&(performance.mark(F+"-end"),$e&&performance.measure(F,F+"-start",F+"-end")),Me(V)}return j.className="rs-counter-id",j.textContent=oe&&oe.caption?oe.caption:F,ee.className="rs-counter-value",ee.appendChild(de),H.appendChild(j),H.appendChild(ee),P?P.div.appendChild(H):d.appendChild(H),k=performance.now(),{set:function(Fe){Me(V=Fe)},start:Ne,tick:function(){Ae(),Ne()},end:Ae,frame:function(){var Fe=performance.now(),Ie=Fe-k;G++,Ie>1e3&&(V=oe&&oe.interpolate===!1?G:1e3*G/Ie,G=0,k=Fe,Me(V))},value:function(){return V},draw:function(){var Fe=oe&&oe.average?q:V;de.nodeValue=Math.round(100*Fe)/100;var Ie=oe&&(oe.below&&V<oe.below||oe.over&&V>oe.over);we.draw(V,Ie),H.className=Ie?"rs-counter-base alarm":"rs-counter-base"}}}function S(R){var P=R.toLowerCase();if(P===void 0&&(P="default"),g[P])return g[P];var k=null;i&&i.groups&&t(i.groups,function(V){var G=i.groups[parseInt(V,10)];k||G.values.indexOf(P.toLowerCase())===-1||(k=G)});var F=new E(P,k);return g[P]=F,F}function M(){t(i.plugins,function(R){i.plugins[R].update()}),t(g,function(R){g[R].draw()}),i&&i.fractions&&t(i.fractions,function(R){var P=i.fractions[parseInt(R,10)],k=[],F=g[P.base.toLowerCase()];F&&(F=F.value(),t(i.fractions[R].steps,function(V){var G=i.fractions[R].steps[parseInt(V,10)].toLowerCase(),q=g[G];q&&k.push(q.value()/F)})),P.graph.draw(k)})}return function(){if(i.plugins){i.values||(i.values={}),i.groups||(i.groups=[]),i.fractions||(i.fractions=[]);for(var R=0;R<i.plugins.length;R++)i.plugins[R].attach(S),t(i.plugins[R].values,function(P){i.values[P]=i.plugins[R].values[P]}),i.groups=i.groups.concat(i.plugins[R].groups),i.fractions=i.fractions.concat(i.plugins[R].fractions)}else i.plugins={};(u=document.createElement("div")).className="rs-base",(d=document.createElement("div")).className="rs-container",d.style.height="auto",u.appendChild(d),document.body.appendChild(u),i&&(i.groups&&t(i.groups,function(P){var k=i.groups[parseInt(P,10)],F=document.createElement("div");F.className="rs-group",k.div=F;var V=document.createElement("h1");V.textContent=k.caption,V.addEventListener("click",(function(G){this.classList.toggle("hidden"),G.preventDefault()}).bind(F)),d.appendChild(V),d.appendChild(F)}),i.fractions&&t(i.fractions,function(P){var k=i.fractions[parseInt(P,10)],F=document.createElement("div");F.className="rs-fraction";var V=document.createElement("div");V.className="rs-legend";var G=0;t(i.fractions[P].steps,function(ne){var K=document.createElement("p");K.textContent=i.fractions[P].steps[ne],K.style.color=s[G],V.appendChild(K),G++}),F.appendChild(V),F.style.height=G*p+"px",k.div=F;var q=new b(F,G);k.graph=q,d.appendChild(F)}))}(),function(R){return R?S(R):{element:u,update:M}}},n.exports=window.rStats},2535:n=>{var e={base64:function(t,i){return"data:"+t+";base64,"+i},isMobile:function(){var t,i=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0),i},isIOS:function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch{return!0}},appendQueryParameter:function(t,i,s){var l=t.indexOf("?")<0?"?":"&";return t+(l+i+"=")+s},getQueryParameter:function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return i===null?"":decodeURIComponent(i[1].replace(/\+/g," "))},isLandscapeMode:function(){return window.orientation==90||window.orientation==-90}};n.exports=e},5928:(n,e,t)=>{var i,s=t(2535);n.exports=(i=navigator.userAgent||navigator.vendor||window.opera).match(/iPhone/i)||i.match(/iPod/i)?function(){var l=null;this.request=function(){l||(l=setInterval(function(){window.location.href="/",setTimeout(window.stop,0)},15e3))},this.release=function(){l&&(clearInterval(l),l=null)}}:function(){var l=document.createElement("video");l.addEventListener("ended",function(){l.play()}),this.request=function(){l.paused&&(l.src=s.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw=="),l.play())},this.release=function(){l.pause(),l.src=""}}},8217:(n,e,t)=>{t.d(e,{A:()=>G});var i=t(963),s=t.n(i),l=t(9089),u=t.n(l),d=t(6492),p=t.n(d),g=new URL(t(9169),t.b),x=new URL(t(6085),t.b),b=new URL(t(3931),t.b),E=new URL(t(7889),t.b),S=new URL(t(6517),t.b),M=u()(s()),R=p()(g),P=p()(x),k=p()(b),F=p()(E),V=p()(S);M.push([n.id,`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url(${R}) 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url(${P}) 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url(${k});
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(${F}) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(${V}) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`,"",{version:3,sources:["webpack://./src/style/aframe.css"],names:[],mappings:"AAAA,sCAAsC;AACtC;EACE,SAAS;EACT,OAAO;EACP,eAAe;EACf,QAAQ;EACR,MAAM;AACR;;AAEA;EACE,YAAY;EACZ,SAAS;EACT,gBAAgB;EAChB,UAAU;EACV,WAAW;AACb;;AAEA,oDAAoD;AACpD;EACE,sBAAsB;EACtB,uBAAuB;EACvB,iBAAiB;EACjB,kBAAkB;EAClB,mBAAmB;EACnB,oBAAoB;EACpB,0BAA0B;AAC5B;;AAEA;;EAEE,UAAU;EACV,WAAW;AACb;;AAEA;EACE,WAAW;AACb;;AAEA,gEAAgE;AAChE;EACE,6BAA6B;AAC/B;;AAEA;EACE,wBAAwB;AAC1B;;AAEA;EACE,YAAY;EACZ,OAAO;EACP,kBAAkB;EAClB,MAAM;EACN,WAAW;AACb;;AAEA;EACE,YAAY;EACZ,iBAAiB;EACjB,oBAAoB;AACtB;;AAEA;EACE,eAAe;AACjB;;AAEA;EACE,yBAAyB;EACzB,eAAe;EACf,SAAS;EACT,QAAQ;EACR,iBAAiB;EACjB,WAAW;EACX,qBAAqB;EACrB,eAAe;EACf,8BAA8B;EAC9B,kBAAkB;EAClB,cAAc;EACd,YAAY;AACd;;AAEA,+BAA+B;AAC/B,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,oBAAoB,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AAC7D,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;AACrE,4BAA4B,OAAO,UAAU,EAAE,EAAE,MAAM,UAAU,EAAE,EAAE;;AAErE;EACE,sCAAsC;EACtC,8CAA8C;AAChD;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,sBAAsB;EACtB,8BAA8B;AAChC;;AAEA;EACE,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,WAAW;AACb;;AAEA;;;;EAIE,aAAa;AACf;;AAEA;;EAEE,0DAA0D;AAC5D;;AAEA;EACE,6BAA6B;EAC7B,cAAc;EACd,qBAAqB;EACrB,6BAA6B;AAC/B;;AAEA;EACE,sBAAsB;EACtB,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,UAAU;AACZ;;AAEA;;EAEE,kCAAkC;EAClC,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,WAAW;EACX,YAAY;AACd;;AAEA;EACE,WAAW;AACb;;AAEA;;;EAGE,WAAW;EACX,iBAAiB;EACjB,aAAa;AACf;;AAEA;EACE,yFAA4qB;AAC9qB;;AAEA;EACE,yFAAkzB;AACpzB;;AAEA;EACE,yDAA2qK;AAC7qK;;AAEA;;EAEE,wBAAwB;EACxB,SAAS;EACT,SAAS;EACT,eAAe;EACf,eAAe;EACf,gBAAgB;EAChB,kBAAkB;EAClB;;;;GAIC;EACD,gBAAgB;EAChB,cAAc;EACd,kBAAkB;EAClB,QAAQ;EACR,sCAAsC;EACtC,8CAA8C;EAC9C,aAAa;EACb,kBAAkB;EAClB,0BAA0B,EAAE,8CAA8C;AAC5E;;AAEA;EACE,yBAAyB;EACzB,kBAAkB;AACpB;;AAEA;;;;EAIE,yBAAyB;AAC3B;;AAEA;EACE,qCAAqC;AACvC;;AAEA;EACE,sBAAsB;EACtB,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,kBAAkB;EAClB,YAAY;EACZ,YAAY;EACZ,SAAS;EACT,kBAAkB;AACpB;;AAEA;EACE,qCAAqC;EACrC,4BAA4B;EAC5B,kCAAkC;EAClC,qBAAqB;EACrB,WAAW;EACX,kBAAkB;EAClB,WAAW;EACX,QAAQ;EACR,QAAQ;EACR,SAAS;AACX;;AAEA;;EAEE,eAAe;AACjB;;AAEA;EACE,SAAS;AACX;;AAEA;EACE,YAAY;AACd;;AAEA;EACE,2FAAivF;EACjvF,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,WAAW;EACX,8CAA8C;EAC9C,cAAc;EACd,kBAAkB;EAClB,kBAAkB;EAClB,QAAQ;EACR,2BAA2B;EAC3B,WAAW;AACb;;AAEA;EACE,6DAA25B;EAC35B,YAAY;EACZ,YAAY;EACZ,oBAAoB;EACpB,WAAW;AACb;;AAEA;EACE,oCAAoC;EACpC,kCAAkC;EAClC,kBAAkB;EAClB,eAAe;EACf,YAAY;EACZ,gBAAgB;EAChB,iBAAiB;EACjB,kBAAkB;EAClB,UAAU;EACV,SAAS;EACT,QAAQ;EACR,YAAY;AACd;;AAEA;EACE,kBAAkB;EAClB,+BAA+B;EAC/B,wBAAwB;EACxB,SAAS;EACT,eAAe;EACf,gBAAgB;EAChB,OAAO;EACP,iBAAiB;EACjB,QAAQ;EACR,eAAe;EACf,MAAM;EACN,gBAAgB;AAClB;;AAEA;EACE,kBAAkB;EAClB,SAAS;EACT,QAAQ;EACR,gCAAgC;EAChC,eAAe;EACf,YAAY;EACZ,aAAa;EACb,wBAAwB;EACxB,uBAAuB;EACvB,kCAAkC;EAClC,eAAe;EACf,kBAAkB;EAClB,YAAY;AACd;;AAEA;EACE,WAAW;EACX,WAAW;EACX,sBAAsB;EACtB,aAAa;EACb,uBAAuB;EACvB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,qBAAqB;EACrB,mBAAmB;EACnB,eAAe;EACf,WAAW;AACb;;AAEA;EACE,oBAAoB;EACpB,oBAAoB;EACpB,WAAW;EACX,WAAW;AACb;;AAEA;EACE,eAAe;EACf,kBAAkB;EAClB,YAAY;EACZ,WAAW;EACX,UAAU;EACV,eAAe;EACf,WAAW;EACX,kBAAkB;EAClB,iBAAiB;EACjB,YAAY;EACZ,qBAAqB;EACrB,yCAAyC;EACzC,iCAAiC;EACjC,wEAAwE;EACxE,iBAAiB;AACnB;;AAEA;EACE,mEAAmE;AACrE;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;AAC3B;;AAEA;EACE,yBAAyB;EACzB,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,kBAAkB;EAClB,oBAAoB;EACpB,sBAAsB;EACtB,SAAS;EACT,OAAO;EACP,QAAQ;EACR,MAAM;EACN,YAAY;AACd;;AAEA;EACE,oBAAoB;AACtB",sourcesContent:[`/* .a-fullscreen means not embedded. */
html.a-fullscreen {
  bottom: 0;
  left: 0;
  position: fixed;
  right: 0;
  top: 0;
}

html.a-fullscreen body {
  height: 100%;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}

/* Class is removed when doing <a-scene embedded>. */
html.a-fullscreen .a-canvas {
  width: 100% !important;
  height: 100% !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  position: fixed !important;
}

html:not(.a-fullscreen) .a-enter-vr,
html:not(.a-fullscreen) .a-enter-ar {
  right: 5px;
  bottom: 5px;
}

html:not(.a-fullscreen) .a-enter-ar {
  right: 60px;
}

/* In chrome mobile the user agent stylesheet set it to white  */
:-webkit-full-screen {
  background-color: transparent;
}

.a-hidden {
  display: none !important;
}

.a-canvas {
  height: 100%;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
}

.a-canvas.a-grab-cursor:hover {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

canvas.a-canvas.a-mouse-cursor-hover:hover {
  cursor: pointer;
}

.a-inspector-loader {
  background-color: #ed3160;
  position: fixed;
  left: 3px;
  top: 3px;
  padding: 6px 10px;
  color: #fff;
  text-decoration: none;
  font-size: 12px;
  font-family: Roboto,sans-serif;
  text-align: center;
  z-index: 99999;
  width: 204px;
}

/* Inspector loader animation */
@keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }
@-webkit-keyframes dots-1 { from { opacity: 0; } 25% { opacity: 1; } }
@-webkit-keyframes dots-2 { from { opacity: 0; } 50% { opacity: 1; } }
@-webkit-keyframes dots-3 { from { opacity: 0; } 75% { opacity: 1; } }

.a-inspector-loader .dots span {
  animation: dots-1 2s infinite steps(1);
  -webkit-animation: dots-1 2s infinite steps(1);
}

.a-inspector-loader .dots span:first-child + span {
  animation-name: dots-2;
  -webkit-animation-name: dots-2;
}

.a-inspector-loader .dots span:first-child + span + span {
  animation-name: dots-3;
  -webkit-animation-name: dots-3;
}

a-scene {
  display: block;
  position: relative;
  height: 100%;
  width: 100%;
}

a-assets,
a-scene video,
a-scene img,
a-scene audio {
  display: none;
}

.a-enter-vr-modal,
.a-orientation-modal {
  font-family: Consolas, Andale Mono, Courier New, monospace;
}

.a-enter-vr-modal a {
  border-bottom: 1px solid #fff;
  padding: 2px 0;
  text-decoration: none;
  transition: .1s color ease-in;
}

.a-enter-vr-modal a:hover {
  background-color: #fff;
  color: #111;
  padding: 2px 4px;
  position: relative;
  left: -4px;
}

.a-enter-vr,
.a-enter-ar {
  font-family: sans-serif, monospace;
  font-size: 13px;
  width: 100%;
  font-weight: 200;
  line-height: 16px;
  position: absolute;
  right: 20px;
  bottom: 20px;
}

.a-enter-ar.xr {
  right: 90px;
}

.a-enter-vr-button,
.a-enter-vr-modal,
.a-enter-vr-modal a {
  color: #fff;
  user-select: none;
  outline: none;
}

.a-enter-vr-button {
  background: rgba(0, 0, 0, 0.35) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z' fill='%23fff'/%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-ar-button {
  background: rgba(0, 0, 0, 0.20) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='108' height='62' viewBox='0 0 108 62'%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z' fill='%23fff'/%3E%3Cpath d='M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z' fill='%23fff'/%3E%3Cpath d='M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z' fill='%23fff'/%3E%3C/svg%3E") 50% 50% no-repeat;
}

.a-enter-vr.fullscreen .a-enter-vr-button {
  background-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8' standalone='no'%3F%3E%3Csvg width='108' height='62' viewBox='0 0 108 62' version='1.1' id='svg320' sodipodi:docname='fullscreen-aframe.svg' xml:space='preserve' inkscape:version='1.2.1 (9c6d41e  2022-07-14)' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23' xmlns:cc='http://creativecommons.org/ns%23' xmlns:dc='http://purl.org/dc/elements/1.1/'%3E%3Cdefs id='defs324' /%3E%3Csodipodi:namedview id='namedview322' pagecolor='%23ffffff' bordercolor='%23000000' borderopacity='0.25' inkscape:showpageshadow='2' inkscape:pageopacity='0.0' inkscape:pagecheckerboard='0' inkscape:deskcolor='%23d1d1d1' showgrid='false' inkscape:zoom='3.8064516' inkscape:cx='91.423729' inkscape:cy='-1.4449153' inkscape:window-width='1440' inkscape:window-height='847' inkscape:window-x='32' inkscape:window-y='25' inkscape:window-maximized='0' inkscape:current-layer='svg320' /%3E%3Ctitle id='title312'%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d='M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z' fill='%23fff' id='path314' style='fill:%23ffffff' /%3E%3Cg id='g356' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g358' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g360' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g362' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g364' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g366' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g368' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g370' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g372' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g374' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g376' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g378' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g380' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g382' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cg id='g384' transform='translate(-206.61017 -232.61864)'%3E%3C/g%3E%3Cmetadata id='metadata561'%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=''%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d='m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4' id='path596' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4' id='path598' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4' id='path600' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3Cpath d='m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616' id='path602' style='fill:%23ffffff%3Bstroke-width:1.50194' /%3E%3C/svg%3E");
}

.a-enter-vr-button,
.a-enter-ar-button {
  background-size: 90% 90%;
  border: 0;
  bottom: 0;
  cursor: pointer;
  min-width: 58px;
  min-height: 34px;
  /* 1.74418604651 */
  /*
    In order to keep the aspect ratio when resizing
    padding-top percentages are relative to the containing block's width.
    http://stackoverflow.com/questions/12121090/responsively-change-div-size-keeping-aspect-ratio
  */
  padding-right: 0;
  padding-top: 0;
  position: absolute;
  right: 0;
  transition: background-color .05s ease;
  -webkit-transition: background-color .05s ease;
  z-index: 9999;
  border-radius: 8px;
  touch-action: manipulation; /* Prevent iOS double tap zoom on the button */
}

.a-enter-ar-button {
  background-size: 100% 90%;
  border-radius: 7px;
}

.a-enter-ar-button:active,
.a-enter-ar-button:hover,
.a-enter-vr-button:active,
.a-enter-vr-button:hover {
  background-color: #ef2d5e;
}

.a-enter-vr-button.resethover {
  background-color: rgba(0, 0, 0, 0.35);
}

.a-enter-vr-modal {
  background-color: #666;
  border-radius: 0;
  display: none;
  min-height: 32px;
  margin-right: 70px;
  padding: 9px;
  width: 280px;
  right: 2%;
  position: absolute;
}

.a-enter-vr-modal:after {
  border-bottom: 10px solid transparent;
  border-left: 10px solid #666;
  border-top: 10px solid transparent;
  display: inline-block;
  content: '';
  position: absolute;
  right: -5px;
  top: 5px;
  width: 0;
  height: 0;
}

.a-enter-vr-modal p,
.a-enter-vr-modal a {
  display: inline;
}

.a-enter-vr-modal p {
  margin: 0;
}

.a-enter-vr-modal p:after {
  content: ' ';
}

.a-orientation-modal {
  background: rgba(244, 244, 244, 1) url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center no-repeat;
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-orientation-modal:after {
  color: #666;
  content: "Insert phone into Cardboard holder.";
  display: block;
  position: absolute;
  text-align: center;
  top: 70%;
  transform: translateY(-70%);
  width: 100%;
}

.a-orientation-modal button {
  background: url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;
  border: none;
  height: 50px;
  text-indent: -9999px;
  width: 50px;
}

.a-loader-title {
  background-color: rgba(0, 0, 0, 0.6);
  font-family: sans-serif, monospace;
  text-align: center;
  font-size: 20px;
  height: 50px;
  font-weight: 300;
  line-height: 50px;
  position: absolute;
  right: 0px;
  left: 0px;
  top: 0px;
  color: white;
}

.a-modal {
  position: absolute;
  background: rgba(0, 0, 0, 0.60);
  background-size: 50% 50%;
  bottom: 0;
  font-size: 14px;
  font-weight: 600;
  left: 0;
  line-height: 20px;
  right: 0;
  position: fixed;
  top: 0;
  z-index: 9999999;
}

.a-dialog {
  position: relative;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 199995;
  width: 300px;
  height: 200px;
  background-size: contain;
  background-color: white;
  font-family: sans-serif, monospace;
  font-size: 20px;
  border-radius: 3px;
  padding: 6px;
}

.a-dialog-text-container {
  width: 100%;
  height: 70%;
  align-self: flex-start;
  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;
}

.a-dialog-text {
  display: inline-block;
  font-weight: normal;
  font-size: 14pt;
  margin: 8px;
}

.a-dialog-buttons-container {
  display: inline-flex;
  align-self: flex-end;
  width: 100%;
  height: 30%;
}

.a-dialog-button {
  cursor: pointer;
  align-self: center;
  opacity: 0.9;
  height: 80%;
  width: 50%;
  font-size: 12pt;
  margin: 4px;
  border-radius: 2px;
  text-align:center;
  border: none;
  display: inline-block;
  -webkit-transition: all 0.25s ease-in-out;
  transition: all 0.25s ease-in-out;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 1px 2px rgba(0, 0, 0, 0.20);
  user-select: none;
}

.a-dialog-permission-button:hover {
  box-shadow: 0 7px 14px rgba(0,0,0,0.20), 0 2px 2px rgba(0,0,0,0.20);
}

.a-dialog-allow-button {
  background-color: #00ceff;
}

.a-dialog-deny-button {
  background-color: #ff005b;
}

.a-dialog-ok-button {
  background-color: #00ceff;
  width: 100%;
}

.a-dom-overlay:not(.a-no-style) {
  overflow: hidden;
  position: absolute;
  pointer-events: none;
  box-sizing: border-box;
  bottom: 0;
  left: 0;
  right: 0;
  top: 0;
  padding: 1em;
}

.a-dom-overlay:not(.a-no-style)>* {
  pointer-events: auto;
}
`],sourceRoot:""}]);const G=M},2470:(n,e,t)=>{t.d(e,{A:()=>d});var i=t(963),s=t.n(i),l=t(9089),u=t.n(l)()(s());u.push([n.id,`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`,"",{version:3,sources:["webpack://./src/style/rStats.css"],names:[],mappings:"AAAA;EACE,sBAAsB;EACtB,cAAc;EACd,gBAAgB;EAChB,oBAAoB;EACpB,SAAS;EACT,gBAAgB;EAChB,aAAa;EACb,gBAAgB;EAChB,aAAa;EACb,eAAe;EACf,QAAQ;EACR,YAAY;EACZ,cAAc;AAChB;;AAEA;EACE,aAAa;AACf;;AAEA;EACE,WAAW;EACX,eAAe;EACf,gBAAgB;EAChB,gBAAgB;EAChB,eAAe;EACf,UAAU;AACZ;;AAEA;EACE,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,sCAAsC;EACtC,8BAA8B;EAC9B,kBAAkB;AACpB;;AAEA;EACE,gBAAgB;AAClB;;AAEA;EACE,mBAAmB;EACnB,oBAAoB;EACpB,qBAAqB;EACrB,aAAa;EACb,YAAY;EACZ,sCAAsC;EACtC,8BAA8B;EAC9B,aAAa;AACf;;AAEA;EACE,cAAc;EACd;;;;;;;;2BAQyB;AAC3B;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,WAAW;AACb;;AAEA;EACE,gBAAgB;EAChB,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;EACR,iBAAiB;EACjB,WAAW;AACb;;AAEA;EACE,4BAA4B;EAC5B,gBAAgB;EAChB,QAAQ;AACV;;AAEA;EACE;IACE,UAAU;IACV,SAAS;EACX;AACF",sourcesContent:[`.rs-base {
  background-color: #333;
  color: #fafafa;
  border-radius: 0;
  font: 10px monospace;
  left: 5px;
  line-height: 1em;
  opacity: 0.85;
  overflow: hidden;
  padding: 10px;
  position: fixed;
  top: 5px;
  width: 300px;
  z-index: 10000;
}

.rs-base div.hidden {
  display: none;
}

.rs-base h1 {
  color: #fff;
  cursor: pointer;
  font-size: 1.4em;
  font-weight: 300;
  margin: 0 0 5px;
  padding: 0;
}

.rs-group {
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  -webkit-flex-direction: column-reverse;
  flex-direction: column-reverse;
  margin-bottom: 5px;
}

.rs-group:last-child {
  margin-bottom: 0;
}

.rs-counter-base {
  align-items: center;
  display: -webkit-box;
  display: -webkit-flex;
  display: flex;
  height: 10px;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  margin: 2px 0;
}

.rs-counter-base.alarm {
  color: #b70000;
  text-shadow: 0 0 0 #b70000,
               0 0 1px #fff,
               0 0 1px #fff,
               0 0 2px #fff,
               0 0 2px #fff,
               0 0 3px #fff,
               0 0 3px #fff,
               0 0 4px #fff,
               0 0 4px #fff;
}

.rs-counter-id {
  font-weight: 300;
  -webkit-box-ordinal-group: 0;
  -webkit-order: 0;
  order: 0;
  width: 54px;
}

.rs-counter-value {
  font-weight: 300;
  -webkit-box-ordinal-group: 1;
  -webkit-order: 1;
  order: 1;
  text-align: right;
  width: 35px;
}

.rs-canvas {
  -webkit-box-ordinal-group: 2;
  -webkit-order: 2;
  order: 2;
}

@media (min-width: 480px) {
  .rs-base {
    left: 20px;
    top: 20px;
  }
}
`],sourceRoot:""}]);const d=u},7180:(n,e,t)=>{t.r(e),t.d(e,{default:()=>k});var i=t(5072),s=t.n(i),l=t(7825),u=t.n(l),d=t(7659),p=t.n(d),g=t(5056),x=t.n(g),b=t(540),E=t.n(b),S=t(1113),M=t.n(S),R=t(8217),P={};P.styleTagTransform=M(),P.setAttributes=x(),P.insert=p().bind(null,"head"),P.domAPI=u(),P.insertStyleElement=E(),s()(R.A,P);const k=R.A&&R.A.locals?R.A.locals:void 0},9379:(n,e,t)=>{t.r(e),t.d(e,{default:()=>k});var i=t(5072),s=t.n(i),l=t(7825),u=t.n(l),d=t(7659),p=t.n(d),g=t(5056),x=t.n(g),b=t(540),E=t.n(b),S=t(1113),M=t.n(S),R=t(2470),P={};P.styleTagTransform=M(),P.setAttributes=x(),P.insert=p().bind(null,"head"),P.domAPI=u(),P.insertStyleElement=E(),s()(R.A,P);const k=R.A&&R.A.locals?R.A.locals:void 0},5072:n=>{var e=[];function t(l){for(var u=-1,d=0;d<e.length;d++)if(e[d].identifier===l){u=d;break}return u}function i(l,u){for(var d={},p=[],g=0;g<l.length;g++){var x=l[g],b=u.base?x[0]+u.base:x[0],E=d[b]||0,S="".concat(b," ").concat(E);d[b]=E+1;var M=t(S),R={css:x[1],media:x[2],sourceMap:x[3],supports:x[4],layer:x[5]};if(M!==-1)e[M].references++,e[M].updater(R);else{var P=s(R,u);u.byIndex=g,e.splice(g,0,{identifier:S,updater:P,references:1})}p.push(S)}return p}function s(l,u){var d=u.domAPI(u);return d.update(l),function(p){if(p){if(p.css===l.css&&p.media===l.media&&p.sourceMap===l.sourceMap&&p.supports===l.supports&&p.layer===l.layer)return;d.update(l=p)}else d.remove()}}n.exports=function(l,u){var d=i(l=l||[],u=u||{});return function(p){p=p||[];for(var g=0;g<d.length;g++){var x=t(d[g]);e[x].references--}for(var b=i(p,u),E=0;E<d.length;E++){var S=t(d[E]);e[S].references===0&&(e[S].updater(),e.splice(S,1))}d=b}}},7659:n=>{var e={};n.exports=function(t,i){var s=function(l){if(e[l]===void 0){var u=document.querySelector(l);if(window.HTMLIFrameElement&&u instanceof window.HTMLIFrameElement)try{u=u.contentDocument.head}catch{u=null}e[l]=u}return e[l]}(t);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(i)}},540:n=>{n.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(n,e,t)=>{n.exports=function(i){var s=t.nc;s&&i.setAttribute("nonce",s)}},7825:n=>{n.exports=function(e){if(typeof document>"u")return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(i){(function(s,l,u){var d="";u.supports&&(d+="@supports (".concat(u.supports,") {")),u.media&&(d+="@media ".concat(u.media," {"));var p=u.layer!==void 0;p&&(d+="@layer".concat(u.layer.length>0?" ".concat(u.layer):""," {")),d+=u.css,p&&(d+="}"),u.media&&(d+="}"),u.supports&&(d+="}");var g=u.sourceMap;g&&typeof btoa<"u"&&(d+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(g))))," */")),l.styleTagTransform(d,s,l.options)})(t,e,i)},remove:function(){(function(i){if(i.parentNode===null)return!1;i.parentNode.removeChild(i)})(t)}}}},1113:n=>{n.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},3931:n=>{n.exports="data:image/svg+xml,%3C%3Fxml version=%271.0%27 encoding=%27UTF-8%27 standalone=%27no%27%3F%3E%3Csvg width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27 version=%271.1%27 id=%27svg320%27 sodipodi:docname=%27fullscreen-aframe.svg%27 xml:space=%27preserve%27 inkscape:version=%271.2.1 %289c6d41e  2022-07-14%29%27 xmlns:inkscape=%27http://www.inkscape.org/namespaces/inkscape%27 xmlns:sodipodi=%27http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd%27 xmlns=%27http://www.w3.org/2000/svg%27 xmlns:svg=%27http://www.w3.org/2000/svg%27 xmlns:rdf=%27http://www.w3.org/1999/02/22-rdf-syntax-ns%23%27 xmlns:cc=%27http://creativecommons.org/ns%23%27 xmlns:dc=%27http://purl.org/dc/elements/1.1/%27%3E%3Cdefs id=%27defs324%27 /%3E%3Csodipodi:namedview id=%27namedview322%27 pagecolor=%27%23ffffff%27 bordercolor=%27%23000000%27 borderopacity=%270.25%27 inkscape:showpageshadow=%272%27 inkscape:pageopacity=%270.0%27 inkscape:pagecheckerboard=%270%27 inkscape:deskcolor=%27%23d1d1d1%27 showgrid=%27false%27 inkscape:zoom=%273.8064516%27 inkscape:cx=%2791.423729%27 inkscape:cy=%27-1.4449153%27 inkscape:window-width=%271440%27 inkscape:window-height=%27847%27 inkscape:window-x=%2732%27 inkscape:window-y=%2725%27 inkscape:window-maximized=%270%27 inkscape:current-layer=%27svg320%27 /%3E%3Ctitle id=%27title312%27%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96 0H12A12 12 0 0 0 0 12V50A12 12 0 0 0 12 62H96a12 12 0 0 0 12-12V12A12 12 0 0 0 96 0Zm8 50a8 8 0 0 1-8 8H12a8 8 0 0 1-8-8V12a8 8 0 0 1 8-8H96a8 8 0 0 1 8 8Z%27 fill=%27%23fff%27 id=%27path314%27 style=%27fill:%23ffffff%27 /%3E%3Cg id=%27g356%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g358%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g360%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g362%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g364%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g366%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g368%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g370%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g372%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g374%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g376%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g378%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g380%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g382%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cg id=%27g384%27 transform=%27translate%28-206.61017 -232.61864%29%27%3E%3C/g%3E%3Cmetadata id=%27metadata561%27%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=%27%27%3E%3Cdc:title%3Eaframe-armode-noborder-reduced-tracking%3C/dc:title%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cpath d=%27m 98.168511 40.083649 c 0 -1.303681 -0.998788 -2.358041 -2.239389 -2.358041 -1.230088 0.0031 -2.240892 1.05436 -2.240892 2.358041 v 4.881296 l -9.041661 -9.041662 c -0.874129 -0.875631 -2.288954 -0.875631 -3.16308 0 -0.874129 0.874126 -0.874129 2.293459 0 3.167585 l 8.995101 8.992101 h -4.858767 c -1.323206 0.0031 -2.389583 1.004796 -2.389583 2.239386 0 1.237598 1.066377 2.237888 2.389583 2.237888 h 10.154599 c 1.323206 0 2.388082 -0.998789 2.392587 -2.237888 -0.0044 -0.03305 -0.009 -0.05858 -0.0134 -0.09161 0.0046 -0.04207 0.0134 -0.08712 0.0134 -0.13066 V 40.085172 h -1.52e-4%27 id=%27path596%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 23.091002 35.921781 -9.026643 9.041662 v -4.881296 c 0 -1.303681 -1.009302 -2.355037 -2.242393 -2.358041 -1.237598 0 -2.237888 1.05436 -2.237888 2.358041 l -0.0031 10.016421 c 0 0.04356 0.01211 0.08862 0.0015 0.130659 -0.0031 0.03153 -0.009 0.05709 -0.01211 0.09161 0.0031 1.239099 1.069379 2.237888 2.391085 2.237888 h 10.156101 c 1.320202 0 2.388079 -1.000291 2.388079 -2.237888 0 -1.234591 -1.067877 -2.236383 -2.388079 -2.239387 h -4.858767 l 8.995101 -8.9921 c 0.871126 -0.874127 0.871126 -2.293459 0 -3.167586 -0.875628 -0.877132 -2.291957 -0.877132 -3.169087 -1.52e-4%27 id=%27path598%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 84.649572 25.978033 9.041662 -9.041664 v 4.881298 c 0 1.299176 1.010806 2.350532 2.240891 2.355037 1.240601 0 2.23939 -1.055861 2.23939 -2.355037 V 11.798242 c 0 -0.04356 -0.009 -0.08862 -0.0134 -0.127671 0.0044 -0.03153 0.009 -0.06157 0.0134 -0.09313 -0.0044 -1.240598 -1.069379 -2.2393873 -2.391085 -2.2393873 h -10.1546 c -1.323205 0 -2.38958 0.9987893 -2.38958 2.2393873 0 1.233091 1.066375 2.237887 2.38958 2.240891 h 4.858768 l -8.995102 8.9921 c -0.874129 0.872625 -0.874129 2.288954 0 3.161578 0.874127 0.880137 2.288951 0.880137 3.16308 1.5e-4%27 id=%27path600%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3Cpath d=%27m 17.264988 13.822853 h 4.857265 c 1.320202 -0.0031 2.388079 -1.0078 2.388079 -2.240889 0 -1.240601 -1.067877 -2.2393893 -2.388079 -2.2393893 H 11.967654 c -1.321707 0 -2.388082 0.9987883 -2.391085 2.2393893 0.0031 0.03153 0.009 0.06157 0.01211 0.09313 -0.0031 0.03905 -0.0015 0.08262 -0.0015 0.127671 l 0.0031 10.020926 c 0 1.299176 1.00029 2.355038 2.237887 2.355038 1.233092 -0.0044 2.242393 -1.055862 2.242393 -2.355038 v -4.881295 l 9.026644 9.041661 c 0.877132 0.878635 2.293459 0.878635 3.169087 0 0.871125 -0.872624 0.871125 -2.288953 0 -3.161577 l -8.995282 -8.993616%27 id=%27path602%27 style=%27fill:%23ffffff%3Bstroke-width:1.50194%27 /%3E%3C/svg%3E"},6085:n=>{n.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-armode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0Zm8,50a8,8,0,0,1-8,8H12a8,8,0,0,1-8-8V12a8,8,0,0,1,8-8H96a8,8,0,0,1,8,8Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M43.35,39.82H32.51L30.45,46H23.88L35,16h5.73L52,46H45.43Zm-9.17-5h7.5L37.91,23.58Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M68.11,35H63.18V46H57V16H68.15q5.31,0,8.2,2.37a8.18,8.18,0,0,1,2.88,6.7,9.22,9.22,0,0,1-1.33,5.12,9.09,9.09,0,0,1-4,3.26l6.49,12.26V46H73.73Zm-4.93-5h5a5.09,5.09,0,0,0,3.6-1.18,4.21,4.21,0,0,0,1.28-3.27,4.56,4.56,0,0,0-1.2-3.34A5,5,0,0,0,68.15,21h-5Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},9169:n=>{n.exports="data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27108%27 height=%2762%27 viewBox=%270 0 108 62%27%3E%3Ctitle%3Eaframe-vrmode-noborder-reduced-tracking%3C/title%3E%3Cpath d=%27M68.81,21.56H64.23v8.27h4.58a4.13,4.13,0,0,0,3.1-1.09,4.2,4.2,0,0,0,1-3,4.24,4.24,0,0,0-1-3A4.05,4.05,0,0,0,68.81,21.56Z%27 fill=%27%23fff%27/%3E%3Cpath d=%27M96,0H12A12,12,0,0,0,0,12V50A12,12,0,0,0,12,62H96a12,12,0,0,0,12-12V12A12,12,0,0,0,96,0ZM41.9,46H34L24,16h8l6,21.84,6-21.84H52Zm39.29,0H73.44L68.15,35.39H64.23V46H57V16H68.81q5.32,0,8.34,2.37a8,8,0,0,1,3,6.69,9.68,9.68,0,0,1-1.27,5.18,8.9,8.9,0,0,1-4,3.34l6.26,12.11Z%27 fill=%27%23fff%27/%3E%3C/svg%3E"},6517:n=>{n.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E"},7889:n=>{n.exports="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E"}},jZ={};function Pn(n){var e=jZ[n];if(e!==void 0)return e.exports;var t=jZ[n]={id:n,exports:{}};return Ore[n](t,t.exports,Pn),t.exports}Pn.m=Ore,Pn.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return Pn.d(e,{a:e}),e},Pn.d=(n,e)=>{for(var t in e)Pn.o(e,t)&&!Pn.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},Pn.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),Pn.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),Pn.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},Pn.b=document.baseURI||self.location.href,Pn.nc=void 0;var Vre={};Pn.d(Vre,{A:()=>BJe});var o3={};Pn.r(o3),Pn.d(o3,{computeMikkTSpaceTangents:()=>k7e,computeMorphedAttributes:()=>F7e,deepCloneAttribute:()=>L7e,deinterleaveAttribute:()=>cS,deinterleaveGeometry:()=>P7e,estimateBytesUsed:()=>N7e,interleaveAttributes:()=>B7e,mergeAttributes:()=>w3,mergeGeometries:()=>R7e,mergeGroups:()=>O7e,mergeVertices:()=>D7e,toCreasedNormals:()=>V7e,toTrianglesDrawMode:()=>C3});var a3={};Pn.r(a3),Pn.d(a3,{checkARSupport:()=>KV,checkHeadsetConnected:()=>QV,checkVRSupport:()=>S3,isAppleVisionPro:()=>Ese,isBrowserEnvironment:()=>JV,isFirefoxReality:()=>_se,isIOS:()=>mw,isIpad:()=>Cse,isLandscape:()=>Ise,isMobile:()=>Xp,isMobileDeviceRequestingDesktopSite:()=>ZV,isMobileVR:()=>YV,isNodeEnvironment:()=>LYe,isOculusBrowser:()=>jV,isR7:()=>qV,isTablet:()=>wse,isWebXRAvailable:()=>iM});var l3={};Pn.r(l3),Pn.d(l3,{clearObject:()=>tU,createPool:()=>eU,removeUnusedKeys:()=>N1});var c3={};Pn.r(c3),Pn.d(c3,{equals:()=>gI,isCoordinate:()=>FYe,isCoordinates:()=>Tse,parse:()=>fS,regex:()=>Sse,stringify:()=>mI,toVector3:()=>OYe});var u3={};Pn.r(u3),Pn.d(u3,{getComponentProperty:()=>Mse,getComponentPropertyPath:()=>rM,setComponentProperty:()=>nU});var h3={};Pn.r(h3),Pn.d(h3,{parseUrl:()=>T3,validateCubemapSrc:()=>Rse,validateEnvMapSrc:()=>iU,validateSrc:()=>pS});var d3={};Pn.r(d3),Pn.d(d3,{createCompatibleTexture:()=>sU,handleTextureEvents:()=>rU,isCompatibleTexture:()=>Lse,setTextureProperties:()=>mS,updateDistortionMap:()=>Zu,updateEnvMap:()=>M3,updateMap:()=>AI,updateMapMaterialFromData:()=>sM});var GA={};Pn.r(GA),Pn.d(GA,{parse:()=>D1,stringify:()=>GYe,toCamelCase:()=>Bse});var f3={};Pn.r(f3),Pn.d(f3,{checkControllerPresentAndSetup:()=>Nl,emitIfAxesChanged:()=>gc,findMatchingControllerWebXR:()=>oU,isControllerPresentWebXR:()=>Pse,onButtonEvent:()=>ri});var p3={};Pn.r(p3),Pn.d(p3,{bind:()=>$Ye,checkHeadsetConnected:()=>QYe,clone:()=>lU,coordinates:()=>c3,debounce:()=>Dse,debug:()=>Ki,deepEqual:()=>cU,device:()=>a3,diff:()=>Fse,entity:()=>u3,extend:()=>Ja,extendDeep:()=>_l,findAllScenes:()=>Vse,forceCanvasResizeSafariMobile:()=>kse,getElData:()=>JYe,getUrlParameter:()=>F1,isIOS:()=>KYe,isIframed:()=>Ose,isMobile:()=>ZYe,material:()=>d3,objectPool:()=>l3,shouldCaptureKeyEvent:()=>uU,split:()=>Rd,splitString:()=>qYe,srcLoader:()=>h3,styleParser:()=>GA,throttle:()=>jYe,throttleLeadingAndTrailing:()=>Nse,throttleTick:()=>YYe,trackedControls:()=>f3});var m3={};Pn.r(m3),Pn.d(m3,{isSingleProperty:()=>oM,parseProperties:()=>Wse,parseProperty:()=>aM,process:()=>gw,processPropertyDefinition:()=>R3,stringifyProperties:()=>Hse,stringifyProperty:()=>hU});var g3={};Pn.r(g3),Pn.d(g3,{Component:()=>O1,components:()=>ls,registerComponent:()=>In,registrationOrderWarnings:()=>Qse});var y3={};Pn.r(y3),Pn.d(y3,{System:()=>vS,registerSystem:()=>fc,systems:()=>xd});var Ure={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},OV={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},c7e=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective"],oS={CSS:{},springs:{}};function bd(n,e,t){return Math.min(Math.max(n,e),t)}function sx(n,e){return n.indexOf(e)>-1}function d_(n,e){return n.apply(null,e)}var u7e=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i,h7e=/^rgb/,d7e=/^hsl/,Gn={arr:function(n){return Array.isArray(n)},obj:function(n){return sx(Object.prototype.toString.call(n),"Object")},pth:function(n){return Gn.obj(n)&&n.hasOwnProperty("totalLength")},svg:function(n){return n instanceof SVGElement},inp:function(n){return n instanceof HTMLInputElement},dom:function(n){return n.nodeType||Gn.svg(n)},str:function(n){return typeof n=="string"},fnc:function(n){return typeof n=="function"},und:function(n){return n===void 0},hex:function(n){return u7e.test(n)},rgb:function(n){return h7e.test(n)},hsl:function(n){return d7e.test(n)},col:function(n){return Gn.hex(n)||Gn.rgb(n)||Gn.hsl(n)},key:function(n){return!Ure.hasOwnProperty(n)&&!OV.hasOwnProperty(n)&&n!=="targets"&&n!=="keyframes"}},f7e=/\(([^)]+)\)/;function zre(n){var e=f7e.exec(n);return e?e[1].split(",").map(function(t){return parseFloat(t)}):[]}function Gre(n,e){var t=zre(n),i=bd(Gn.und(t[0])?1:t[0],.1,100),s=bd(Gn.und(t[1])?100:t[1],.1,100),l=bd(Gn.und(t[2])?10:t[2],.1,100),u=bd(Gn.und(t[3])?0:t[3],.1,100),d=Math.sqrt(s/i),p=l/(2*Math.sqrt(s*i)),g=p<1?d*Math.sqrt(1-p*p):0,x=p<1?(p*d-u)/g:-u+d;function b(E){var S=e?e*E/1e3:E;return S=p<1?Math.exp(-S*p*d)*(1*Math.cos(g*S)+x*Math.sin(g*S)):(1+x*S)*Math.exp(-S*d),E===0||E===1?E:1-S}return e?b:function(){var E=oS.springs[n];if(E)return E;for(var S=1/6,M=0,R=0;;)if(b(M+=S)===1){if(++R>=16)break}else R=0;var P=M*S*1e3;return oS.springs[n]=P,P}}function f_(n,e){n===void 0&&(n=1),e===void 0&&(e=.5);var t=bd(n,1,10),i=bd(e,.1,2);return function(s){return s===0||s===1?s:-t*Math.pow(2,10*(s-1))*Math.sin((s-1-i/(2*Math.PI)*Math.asin(1/t))*(2*Math.PI)/i)}}function p7e(n){return n===void 0&&(n=10),function(e){return Math.round(e*n)*(1/n)}}var YZ=function(){var n=.1;function e(u,d){return 1-3*d+3*u}function t(u,d){return 3*d-6*u}function i(u){return 3*u}function s(u,d,p){return((e(d,p)*u+t(d,p))*u+i(d))*u}function l(u,d,p){return 3*e(d,p)*u*u+2*t(d,p)*u+i(d)}return function(u,d,p,g){if(0<=u&&u<=1&&0<=p&&p<=1){var x=new Float32Array(11);if(u!==d||p!==g)for(var b=0;b<11;++b)x[b]=s(b*n,u,p);return function(E){return u===d&&p===g||E===0||E===1?E:s(function(S){for(var M=0,R=1;R!==10&&x[R]<=S;++R)M+=n;--R;var P=M+(S-x[R])/(x[R+1]-x[R])*n,k=l(P,u,p);return k>=.001?function(F,V,G,q){for(var ne=0;ne<4;++ne){var K=l(V,G,q);if(K===0)return V;V-=(s(V,G,q)-F)/K}return V}(S,P,u,p):k===0?P:function(F,V,G,q,ne){var K,Q,H=0;do(K=s(Q=V+(G-V)/2,q,ne)-F)>0?G=Q:V=Q;while(Math.abs(K)>1e-7&&++H<10);return Q}(S,M,M+n,u,p)}(E),d,g)}}}}(),Wre=function(){var n=["Quad","Cubic","Quart","Quint","Sine","Expo","Circ","Back","Elastic"],e={In:[[.55,.085,.68,.53],[.55,.055,.675,.19],[.895,.03,.685,.22],[.755,.05,.855,.06],[.47,0,.745,.715],[.95,.05,.795,.035],[.6,.04,.98,.335],[.6,-.28,.735,.045],f_],Out:[[.25,.46,.45,.94],[.215,.61,.355,1],[.165,.84,.44,1],[.23,1,.32,1],[.39,.575,.565,1],[.19,1,.22,1],[.075,.82,.165,1],[.175,.885,.32,1.275],function(u,d){return function(p){return 1-f_(u,d)(1-p)}}],InOut:[[.455,.03,.515,.955],[.645,.045,.355,1],[.77,0,.175,1],[.86,0,.07,1],[.445,.05,.55,.95],[1,0,0,1],[.785,.135,.15,.86],[.68,-.55,.265,1.55],function(u,d){return function(p){return p<.5?f_(u,d)(2*p)/2:1-f_(u,d)(-2*p+2)/2}}]},t={linear:[.25,.25,.75,.75]};for(var i in e)for(var s=0,l=e[i].length;s<l;s++)t["ease"+i+n[s]]=e[i][s];return t}();function A3(n,e){if(Gn.fnc(n))return n;var t=n.split("(")[0],i=Wre[t],s=zre(n);switch(t){case"spring":return Gre(n,e);case"cubicBezier":return d_(YZ,s);case"steps":return d_(p7e,s);default:return Gn.fnc(i)?d_(i,s):d_(YZ,i)}}function Hre(n){try{return document.querySelectorAll(n)}catch{return}}var qZ=[];function aS(n,e){for(var t=qZ,i=n.length,s=arguments.length>=2?arguments[1]:void 0,l=0;l<i;l++)if(l in n){var u=n[l];e.call(s,u,l,n)&&t.push(u)}return(qZ=n).length=0,t}function nM(n,e){e||(e=[]);for(var t=0,i=n.length;t<i;t++){var s=n[t];Array.isArray(s)?nM(s,e):e.push(s)}return e}function JZ(n){return Gn.arr(n)?n:(Gn.str(n)&&(n=Hre(n)||n),n instanceof NodeList||n instanceof HTMLCollection?[].slice.call(n):[n])}function VV(n,e){return n.some(function(t){return t===e})}function UV(n){var e={};for(var t in n)e[t]=n[t];return e}function v3(n,e){var t=UV(n);for(var i in n)t[i]=e.hasOwnProperty(i)?e[i]:n[i];return t}function lS(n,e){var t=UV(n);for(var i in e)t[i]=Gn.und(n[i])?e[i]:n[i];return t}var m7e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g,g7e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,y7e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,A7e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g,v7e=/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g,b7e=/([\+\-]?[0-9#\.]+)(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/;function kd(n){var e=b7e.exec(n);if(e)return e[2]}function b3(n,e){return Gn.fnc(n)?n(e.target,e.id,e.total):n}function Ju(n,e){return n.getAttribute(e)}function zV(n,e,t){if(VV([t,"deg","rad","turn"],kd(e)))return e;var i=oS.CSS[e+t];if(!Gn.und(i))return i;var s=document.createElement(n.tagName),l=n.parentNode&&n.parentNode!==document?n.parentNode:document.body;l.appendChild(s),s.style.position="absolute",s.style.width=100+t;var u=100/s.offsetWidth;l.removeChild(s);var d=u*parseFloat(e);return oS.CSS[e+t]=d,d}function Xre(n,e,t){if(e in n.style){var i=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),s=n.style[e]||getComputedStyle(n).getPropertyValue(i)||"0";return t?zV(n,s,t):s}}function GV(n,e){return Gn.dom(n)&&!Gn.inp(n)&&(Ju(n,e)||Gn.svg(n)&&n[e])?"attribute":Gn.dom(n)&&VV(c7e,e)?"transform":Gn.dom(n)&&e!=="transform"&&Xre(n,e)?"css":n[e]!=null?"object":void 0}var x7e=/(\w+)\(([^)]*)\)/g;function $re(n){if(Gn.dom(n)){for(var e,t=n.style.transform||"",i=new Map;e=x7e.exec(t);)i.set(e[1],e[2]);return i}}function WV(n,e,t,i){switch(GV(n,e)){case"transform":return function(s,l,u,d){var p=sx(l,"scale")?1:0+function(x){return sx(x,"translate")||x==="perspective"?"px":sx(x,"rotate")||sx(x,"skew")?"deg":void 0}(l),g=$re(s).get(l)||p;return u&&(u.transforms.list.set(l,g),u.transforms.last=l),d?zV(s,g,d):g}(n,e,i,t);case"css":return Xre(n,e,t);case"attribute":return Ju(n,e);default:return n[e]||0}}var w7e=/^(\*=|\+=|-=)/;function HV(n,e){var t=w7e.exec(n);if(!t)return n;var i=kd(n)||0,s=parseFloat(e),l=parseFloat(n.replace(t[0],""));switch(t[0][0]){case"+":return s+l+i;case"-":return s-l+i;case"*":return s*l+i}}var C7e=/\s/g;function Qre(n,e){if(Gn.col(n))return function(s){return Gn.rgb(s)?(l=s,(u=m7e.exec(l))?"rgba("+u[1]+",1)":l):Gn.hex(s)?function(d){var p=d.replace(g7e,function(x,b,E,S){return b+b+E+E+S+S}),g=y7e.exec(p);return"rgba("+parseInt(g[1],16)+","+parseInt(g[2],16)+","+parseInt(g[3],16)+",1)"}(s):Gn.hsl(s)?function(d){var p,g,x,b=A7e.exec(d)||v7e.exec(d),E=parseInt(b[1],10)/360,S=parseInt(b[2],10)/100,M=parseInt(b[3],10)/100,R=b[4]||1;function P(V,G,q){return q<0&&(q+=1),q>1&&(q-=1),q<1/6?V+6*(G-V)*q:q<.5?G:q<2/3?V+(G-V)*(2/3-q)*6:V}if(S==0)p=g=x=M;else{var k=M<.5?M*(1+S):M+S-M*S,F=2*M-k;p=P(F,k,E+1/3),g=P(F,k,E),x=P(F,k,E-1/3)}return"rgba("+255*p+","+255*g+","+255*x+","+R+")"}(s):void 0;var l,u}(n);var t=kd(n),i=t?n.substr(0,n.length-t.length):n;return e&&!C7e.test(n)?i+e:i}function x3(n,e){return Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2))}function e8(n){for(var e,t=n.points,i=0,s=0;s<t.numberOfItems;s++){var l=t.getItem(s);s>0&&(i+=x3(e,l)),e=l}return i}function t8(n){if(n.getTotalLength)return n.getTotalLength();switch(n.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*Ju(e,"r")}(n);case"rect":return function(e){return 2*Ju(e,"width")+2*Ju(e,"height")}(n);case"line":return function(e){return x3({x:Ju(e,"x1"),y:Ju(e,"y1")},{x:Ju(e,"x2"),y:Ju(e,"y2")})}(n);case"polyline":return e8(n);case"polygon":return function(e){var t=e.points;return e8(e)+x3(t.getItem(t.numberOfItems-1),t.getItem(0))}(n)}}function Kre(n,e){var t=e||{},i=t.el||function(g){for(var x=g.parentNode;Gn.svg(x)&&(x=x.parentNode,Gn.svg(x.parentNode)););return x}(n),s=i.getBoundingClientRect(),l=Ju(i,"viewBox"),u=s.width,d=s.height,p=t.viewBox||(l?l.split(" "):[0,0,u,d]);return{el:i,viewBox:p,x:p[0]/1,y:p[1]/1,w:u/p[2],h:d/p[3]}}function E7e(n,e){function t(d){d===void 0&&(d=0);var p=e+d>=1?e+d:0;return n.el.getPointAtLength(p)}var i=Kre(n.el,n.svg),s=t(),l=t(-1),u=t(1);switch(n.property){case"x":return(s.x-i.x)*i.w;case"y":return(s.y-i.y)*i.h;case"angle":return 180*Math.atan2(u.y-l.y,u.x-l.x)/Math.PI}}var oP=/-?\d*\.?\d+/g;function n8(n,e){var t=Qre(Gn.pth(n)?n.totalLength:n,e)+"";return{original:t,numbers:t.match(oP)?t.match(oP).map(Number):[0],strings:Gn.str(n)||e?t.split(oP):[]}}function Zre(n){return aS(n?nM(Gn.arr(n)?n.map(JZ):JZ(n)):[],function(e,t,i){return i.indexOf(e)===t})}function jre(n){var e=Zre(n);return e.map(function(t,i){return{target:t,id:i,total:e.length,transforms:{list:$re(t)}}})}var _7e=/^spring/;function I7e(n,e){var t=UV(e);if(_7e.test(t.easing)&&(t.duration=Gre(t.easing)),Gn.arr(n)){var i=n.length;i!==2||Gn.obj(n[0])?Gn.fnc(e.duration)||(t.duration=e.duration/i):n={value:n}}var s=Gn.arr(n)?n:[n];return s.map(function(l,u){var d=Gn.obj(l)&&!Gn.pth(l)?l:{value:l};return Gn.und(d.delay)&&(d.delay=u?0:e.delay),Gn.und(d.endDelay)&&(d.endDelay=u===s.length-1?e.endDelay:0),d}).map(function(l){return lS(l,t)})}var Yre={css:function(n,e,t){return n.style[e]=t},attribute:function(n,e,t){return n.setAttribute(e,t)},object:function(n,e,t){return n[e]=t},transform:function(n,e,t,i,s){if(i.list.set(e,t),e===i.last||s){var l="";i.list.forEach(function(u,d){l+=d+"("+u+") "}),n.style.transform=l}}};function qre(n,e){for(var t=jre(n),i=0,s=t.length;i<s;i++){var l=t[i];for(var u in e){var d=b3(e[u],l),p=l.target,g=kd(d),x=WV(p,u,g,l),b=HV(Qre(d,g||kd(x)),x),E=GV(p,u);Yre[E](p,u,b,l.transforms,!0)}}}function S7e(n,e){return aS(nM(n.map(function(t){return e.map(function(i){return function(s,l){var u=GV(s.target,l.name);if(u){var d=function(g,x){var b;return g.tweens.map(function(E){var S=function(ne,K){var Q={};for(var H in ne){var j=b3(ne[H],K);Gn.arr(j)&&(j=j.map(function(ee){return b3(ee,K)})).length===1&&(j=j[0]),Q[H]=j}return Q.duration=parseFloat(Q.duration),Q.delay=parseFloat(Q.delay),Q}(E,x),M=S.value,R=Gn.arr(M)?M[1]:M,P=kd(R),k=WV(x.target,g.name,P,x),F=b?b.to.original:k,V=Gn.arr(M)?M[0]:F,G=kd(V)||kd(k),q=P||G;return Gn.und(R)&&(R=F),S.from=n8(V,q),S.to=n8(HV(R,V),q),S.start=b?b.end:0,S.end=S.start+S.delay+S.duration+S.endDelay,S.easing=A3(S.easing,S.duration),S.isPath=Gn.pth(M),S.isColor=Gn.col(S.from.original),S.isColor&&(S.round=1),b=S,S})}(l,s),p=d[d.length-1];return{type:u,property:l.name,animatable:s,tweens:d,duration:p.end,delay:d[0].delay,endDelay:p.endDelay}}}(t,i)})})),function(t){return!Gn.und(t)})}function Jre(n,e){var t=n.length,i=function(l){return l.timelineOffset?l.timelineOffset:0},s={};return s.duration=t?Math.max.apply(Math,n.map(function(l){return i(l)+l.duration})):e.duration,s.delay=t?Math.min.apply(Math,n.map(function(l){return i(l)+l.delay})):e.delay,s.endDelay=t?s.duration-Math.max.apply(Math,n.map(function(l){return i(l)+l.duration-l.endDelay})):e.endDelay,s}var fI,i8=0,Ka=[],aP=[],T7e=function(){function n(){fI=requestAnimationFrame(e)}function e(t){var i=Ka.length;if(i){for(var s=0;s<i;){var l=Ka[s];if(l.paused){var u=Ka.indexOf(l);u>-1&&(Ka.splice(u,1),i=Ka.length)}else l.tick(t);s++}n()}else fI=cancelAnimationFrame(fI)}return n}();function Os(n){n===void 0&&(n={});var e,t=0,i=0,s=0,l=0,u=null;function d(){return window.Promise&&new Promise(function(k){return u=k})}var p=d(),g=function(k){var F=v3(Ure,k),V=v3(OV,k),G=function(H,j){var ee=[],de=j.keyframes;for(var oe in de&&(j=lS(function(we){for(var $e=aS(nM(we.map(function(Fe){return Object.keys(Fe)})),function(Fe){return Gn.key(Fe)}).reduce(function(Fe,Ie){return Fe.indexOf(Ie)<0&&Fe.push(Ie),Fe},[]),Me={},Ne=function(Fe){var Ie=$e[Fe];Me[Ie]=we.map(function(qe){var dt={};for(var Wt in qe)Gn.key(Wt)?Wt==Ie&&(dt.value=qe[Wt]):dt[Wt]=qe[Wt];return dt})},Ae=0;Ae<$e.length;Ae++)Ne(Ae);return Me}(de),j)),j)Gn.key(oe)&&ee.push({name:oe,tweens:I7e(j[oe],H)});return ee}(V,k),q=jre(k.targets),ne=S7e(q,G),K=Jre(ne,V),Q=i8;return i8++,lS(F,{id:Q,children:[],animatables:q,animations:ne,duration:K.duration,delay:K.delay,endDelay:K.endDelay})}(n);function x(){g.reversed=!g.reversed;for(var k=0,F=e.length;k<F;k++)e[k].reversed=g.reversed}function b(k){return g.reversed?g.duration-k:k}function E(){t=0,i=b(g.currentTime)*(1/Os.speed)}function S(k,F){F&&F.seek(k-F.timelineOffset)}function M(k){for(var F=0,V=g.animations,G=V.length;F<G;){var q=V[F],ne=q.animatable,K=q.tweens,Q=K.length-1,H=K[Q];Q&&(H=aS(K,function(At){return k<At.end})[0]||H);for(var j=bd(k-H.start-H.delay,0,H.duration)/H.duration,ee=isNaN(j)?1:H.easing(j),de=H.to.strings,oe=H.round,we=[],$e=H.to.numbers.length,Me=void 0,Ne=0;Ne<$e;Ne++){var Ae=void 0,Fe=H.to.numbers[Ne],Ie=H.from.numbers[Ne]||0;Ae=H.isPath?E7e(H.value,ee*Fe):Ie+ee*(Fe-Ie),oe&&(H.isColor&&Ne>2||(Ae=Math.round(Ae*oe)/oe)),we.push(Ae)}var qe=de.length;if(qe){Me=de[0];for(var dt=0;dt<qe;dt++){de[dt];var Wt=de[dt+1],xt=we[dt];isNaN(xt)||(Me+=Wt?xt+Wt:xt+" ")}}else Me=we[0];Yre[q.type](ne.target,q.property,Me,ne.transforms),q.currentValue=Me,F++}}function R(k){g[k]&&!g.passThrough&&g[k](g)}function P(k){var F=g.duration,V=g.delay,G=F-g.endDelay,q=b(k);g.progress=bd(q/F*100,0,100),g.reversePlayback=q<g.currentTime,e&&function(ne){if(g.reversePlayback)for(var K=l;K--;)S(ne,e[K]);else for(var Q=0;Q<l;Q++)S(ne,e[Q])}(q),!g.began&&g.currentTime>0&&(g.began=!0,R("begin"),R("loopBegin")),q<=V&&g.currentTime!==0&&M(0),(q>=G&&g.currentTime!==F||!F)&&M(F),q>V&&q<G?(g.changeBegan||(g.changeBegan=!0,g.changeCompleted=!1,R("changeBegin")),R("change"),M(q)):g.changeBegan&&(g.changeCompleted=!0,g.changeBegan=!1,R("changeComplete")),g.currentTime=bd(q,0,F),g.began&&R("update"),k>=F&&(i=0,g.remaining&&g.remaining!==!0&&g.remaining--,g.remaining?(t=s,R("loopComplete"),R("loopBegin"),g.direction==="alternate"&&x()):(g.paused=!0,g.completed||(g.completed=!0,R("loopComplete"),R("complete"),"Promise"in window&&(u(),p=d()))))}return g.reset=function(){var k=g.direction;g.passThrough=!1,g.currentTime=0,g.progress=0,g.paused=!0,g.began=!1,g.changeBegan=!1,g.completed=!1,g.changeCompleted=!1,g.reversePlayback=!1,g.reversed=k==="reverse",g.remaining=g.loop,e=g.children;for(var F=l=e.length;F--;)g.children[F].reset();(g.reversed&&g.loop!==!0||k==="alternate"&&g.loop===1)&&g.remaining++,M(0)},g.set=function(k,F){return qre(k,F),g},g.tick=function(k){s=k,t||(t=s),P((s+(i-t))*Os.speed)},g.seek=function(k){P(b(k))},g.pause=function(){g.paused=!0,E()},g.play=function(){g.paused&&(g.paused=!1,Ka.push(g),E(),fI||T7e())},g.reverse=function(){x(),E()},g.restart=function(){g.reset(),g.play()},g.finished=p,g.reset(),g.autoplay&&g.play(),g}function r8(n,e){for(var t=e.length;t--;)VV(n,e[t].animatable.target)&&e.splice(t,1)}document.addEventListener("visibilitychange",function(){if(document.hidden){for(var n=0,e=Ka.length;n<e;n++)activeInstance[n].pause();aP=Ka.slice(0),Ka=[]}else for(var t=0,i=aP.length;t<i;t++)aP[t].play()}),Os.version="3.0.0",Os.speed=1,Os.running=Ka,Os.remove=function(n){for(var e=Zre(n),t=Ka.length;t--;){var i=Ka[t],s=i.animations,l=i.children;r8(e,s);for(var u=l.length;u--;){var d=l[u],p=d.animations;r8(e,p),p.length||d.children.length||l.splice(u,1)}s.length||l.length||i.pause()}},Os.get=WV,Os.set=qre,Os.convertPx=zV,Os.path=function(n,e){var t=Gn.str(n)?Hre(n)[0]:n,i=e||100;return function(s){return{property:s,el:t,svg:Kre(t),totalLength:t8(t)*(i/100)}}},Os.setDashoffset=function(n){var e=t8(n);return n.setAttribute("stroke-dasharray",e),e},Os.stagger=function(n,e){e===void 0&&(e={});var t=e.direction||"normal",i=e.easing?A3(e.easing):null,s=e.grid,l=e.axis,u=e.from||0,d=u==="first",p=u==="center",g=u==="last",x=Gn.arr(n),b=parseFloat(x?n[0]:n),E=x?parseFloat(n[1]):0,S=kd(x?n[1]:n)||0,M=e.start||0+(x?b:0),R=[],P=0;return function(k,F,V){if(d&&(u=0),p&&(u=(V-1)/2),g&&(u=V-1),!R.length){for(var G=0;G<V;G++){if(s){var q=p?(s[0]-1)/2:u%s[0],ne=p?(s[1]-1)/2:Math.floor(u/s[0]),K=q-G%s[0],Q=ne-Math.floor(G/s[0]),H=Math.sqrt(K*K+Q*Q);l==="x"&&(H=-K),l==="y"&&(H=-Q),R.push(H)}else R.push(Math.abs(u-G));P=Math.max.apply(Math,R)}i&&(R=R.map(function(j){return i(j/P)*P})),t==="reverse"&&(R=R.map(function(j){return l?j<0?-1*j:-j:Math.abs(P-j)}))}return M+(x?(E-b)/P:b)*(Math.round(100*R[F])/100)+S}},Os.timeline=function(n){n===void 0&&(n={});var e=Os(n);return e.duration=0,e.add=function(t,i){var s=Ka.indexOf(e),l=e.children;function u(E){E.passThrough=!0}s>-1&&Ka.splice(s,1);for(var d=0;d<l.length;d++)u(l[d]);var p=lS(t,v3(OV,n));p.targets=p.targets||n.targets;var g=e.duration;p.autoplay=!1,p.direction=e.direction,p.timelineOffset=Gn.und(i)?g:HV(i,g),u(e),e.seek(p.timelineOffset);var x=Os(p);u(x),l.push(x);var b=Jre(l,n);return e.delay=b.delay,e.endDelay=b.endDelay,e.duration=b.duration,e.seek(0),e.reset(),e.autoplay&&e.play(),e},e},Os.easing=A3,Os.penner=Wre,Os.random=function(n,e){return Math.floor(Math.random()*(e-n+1))+n};const pI=Os,Z=a7e,lP=new WeakMap;class ese extends Z.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const l=new Z.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,u=>{this.parse(u,t,s)},i,s)}parse(e,t,i=()=>{}){this.decodeDracoFile(e,t,null,null,Z.SRGBColorSpace,i).catch(i)}decodeDracoFile(e,t,i,s,l=Z.LinearSRGBColorSpace,u=()=>{}){const d={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:l};return this.decodeGeometry(e,d).then(t).catch(u)}decodeGeometry(e,t){const i=JSON.stringify(t);if(lP.has(e)){const p=lP.get(e);if(p.key===i)return p.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const l=this.workerNextTaskID++,u=e.byteLength,d=this._getWorker(l,u).then(p=>(s=p,new Promise((g,x)=>{s._callbacks[l]={resolve:g,reject:x},s.postMessage({type:"decode",id:l,taskConfig:t,buffer:e},[e])}))).then(p=>this._createGeometry(p.geometry));return d.catch(()=>!0).then(()=>{s&&l&&this._releaseTask(s,l)}),lP.set(e,{key:i,promise:d}),d}_createGeometry(e){const t=new Z.BufferGeometry;e.index&&t.setIndex(new Z.BufferAttribute(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],l=s.name,u=s.array,d=s.itemSize,p=new Z.BufferAttribute(u,d);l==="color"&&(this._assignVertexColorSpace(p,s.vertexColorSpace),p.normalized=u instanceof Float32Array==0),t.setAttribute(l,p)}return t}_assignVertexColorSpace(e,t){if(t!==Z.SRGBColorSpace)return;const i=new Z.Color;for(let s=0,l=e.count;s<l;s++)i.fromBufferAttribute(e,s),Z.ColorManagement.toWorkingColorSpace(i,Z.SRGBColorSpace),e.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(e,t){const i=new Z.FileLoader(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,l)=>{i.load(e,s,void 0,l)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const l=M7e.toString(),u=["/* draco decoder */",s,"","/* worker */",l.substring(l.indexOf("{")+1,l.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([u]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(l){const u=l.data;switch(u.type){case"decode":s._callbacks[u.id].resolve(u);break;case"error":s._callbacks[u.id].reject(u);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+u.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,l){return s._taskLoad>l._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function M7e(){let n,e;function t(i,s,l,u,d,p){const g=p.num_components(),x=l.num_points()*g,b=x*d.BYTES_PER_ELEMENT,E=function(R,P){switch(P){case Float32Array:return R.DT_FLOAT32;case Int8Array:return R.DT_INT8;case Int16Array:return R.DT_INT16;case Int32Array:return R.DT_INT32;case Uint8Array:return R.DT_UINT8;case Uint16Array:return R.DT_UINT16;case Uint32Array:return R.DT_UINT32}}(i,d),S=i._malloc(b);s.GetAttributeDataArrayForAllPoints(l,p,E,b,S);const M=new d(i.HEAPF32.buffer,S,x).slice();return i._free(S),{name:u,array:M,itemSize:g}}onmessage=function(i){const s=i.data;switch(s.type){case"init":n=s.decoderConfig,e=new Promise(function(d){n.onModuleLoaded=function(p){d({draco:p})},DracoDecoderModule(n)});break;case"decode":const l=s.buffer,u=s.taskConfig;e.then(d=>{const p=d.draco,g=new p.Decoder;try{const x=function(E,S,M,R){const P=R.attributeIDs,k=R.attributeTypes;let F,V;const G=S.GetEncodedGeometryType(M);if(G===E.TRIANGULAR_MESH)F=new E.Mesh,V=S.DecodeArrayToMesh(M,M.byteLength,F);else{if(G!==E.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");F=new E.PointCloud,V=S.DecodeArrayToPointCloud(M,M.byteLength,F)}if(!V.ok()||F.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+V.error_msg());const q={index:null,attributes:[]};for(const ne in P){const K=self[k[ne]];let Q,H;if(R.useUniqueIDs)H=P[ne],Q=S.GetAttributeByUniqueId(F,H);else{if(H=S.GetAttributeId(F,E[P[ne]]),H===-1)continue;Q=S.GetAttribute(F,H)}const j=t(E,S,F,ne,K,Q);ne==="color"&&(j.vertexColorSpace=R.vertexColorSpace),q.attributes.push(j)}return G===E.TRIANGULAR_MESH&&(q.index=function(ne,K,Q){const H=3*Q.num_faces(),j=4*H,ee=ne._malloc(j);K.GetTrianglesUInt32Array(Q,j,ee);const de=new Uint32Array(ne.HEAPF32.buffer,ee,H).slice();return ne._free(ee),{array:de,itemSize:1}}(E,S,F)),E.destroy(F),q}(p,g,new Int8Array(l),u),b=x.attributes.map(E=>E.array.buffer);x.index&&b.push(x.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:x},b)}catch(x){console.error(x),self.postMessage({type:"error",id:s.id,error:x.message})}finally{p.destroy(g)}})}}}function k7e(n,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!n.hasAttribute("position")||!n.hasAttribute("normal")||!n.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function i(u){if(u.normalized||u.isInterleavedBufferAttribute){const d=new Float32Array(u.count*u.itemSize);for(let p=0,g=0;p<u.count;p++)d[g++]=u.getX(p),d[g++]=u.getY(p),u.itemSize>2&&(d[g++]=u.getZ(p));return d}return u.array instanceof Float32Array?u.array:new Float32Array(u.array)}const s=n.index?n.toNonIndexed():n,l=e.generateTangents(i(s.attributes.position),i(s.attributes.normal),i(s.attributes.uv));if(t)for(let u=3;u<l.length;u+=4)l[u]*=-1;return s.setAttribute("tangent",new Z.BufferAttribute(l,4)),n!==s&&n.copy(s),n}function R7e(n,e=!1){const t=n[0].index!==null,i=new Set(Object.keys(n[0].attributes)),s=new Set(Object.keys(n[0].morphAttributes)),l={},u={},d=n[0].morphTargetsRelative,p=new Z.BufferGeometry;let g=0;for(let x=0;x<n.length;++x){const b=n[x];let E=0;if(t!==(b.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const S in b.attributes){if(!i.has(S))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+'. All geometries must have compatible attributes; make sure "'+S+'" attribute exists among all geometries, or in none of them.'),null;l[S]===void 0&&(l[S]=[]),l[S].push(b.attributes[S]),E++}if(E!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". Make sure all geometries have the same number of attributes."),null;if(d!==b.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const S in b.morphAttributes){if(!s.has(S))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+".  .morphAttributes must be consistent throughout all geometries."),null;u[S]===void 0&&(u[S]=[]),u[S].push(b.morphAttributes[S])}if(e){let S;if(t)S=b.index.count;else{if(b.attributes.position===void 0)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+x+". The geometry must have either an index or a position attribute"),null;S=b.attributes.position.count}p.addGroup(g,S,x),g+=S}}if(t){let x=0;const b=[];for(let E=0;E<n.length;++E){const S=n[E].index;for(let M=0;M<S.count;++M)b.push(S.getX(M)+x);x+=n[E].attributes.position.count}p.setIndex(b)}for(const x in l){const b=w3(l[x]);if(!b)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+x+" attribute."),null;p.setAttribute(x,b)}for(const x in u){const b=u[x][0].length;if(b===0)break;p.morphAttributes=p.morphAttributes||{},p.morphAttributes[x]=[];for(let E=0;E<b;++E){const S=[];for(let R=0;R<u[x].length;++R)S.push(u[x][R][E]);const M=w3(S);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+x+" morphAttribute."),null;p.morphAttributes[x].push(M)}}return p}function w3(n){let e,t,i,s=-1,l=0;for(let g=0;g<n.length;++g){const x=n[g];if(e===void 0&&(e=x.array.constructor),e!==x.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=x.itemSize),t!==x.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(i===void 0&&(i=x.normalized),i!==x.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(s===-1&&(s=x.gpuType),s!==x.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;l+=x.count*t}const u=new e(l),d=new Z.BufferAttribute(u,t,i);let p=0;for(let g=0;g<n.length;++g){const x=n[g];if(x.isInterleavedBufferAttribute){const b=p/t;for(let E=0,S=x.count;E<S;E++)for(let M=0;M<t;M++){const R=x.getComponent(E,M);d.setComponent(E+b,M,R)}}else u.set(x.array,p);p+=x.count*t}return s!==void 0&&(d.gpuType=s),d}function L7e(n){return n.isInstancedInterleavedBufferAttribute||n.isInterleavedBufferAttribute?cS(n):n.isInstancedBufferAttribute?new Z.InstancedBufferAttribute().copy(n):new Z.BufferAttribute().copy(n)}function B7e(n){let e,t=0,i=0;for(let g=0,x=n.length;g<x;++g){const b=n[g];if(e===void 0&&(e=b.array.constructor),e!==b.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=b.array.length,i+=b.itemSize}const s=new Z.InterleavedBuffer(new e(t),i);let l=0;const u=[],d=["getX","getY","getZ","getW"],p=["setX","setY","setZ","setW"];for(let g=0,x=n.length;g<x;g++){const b=n[g],E=b.itemSize,S=b.count,M=new Z.InterleavedBufferAttribute(s,E,l,b.normalized);u.push(M),l+=E;for(let R=0;R<S;R++)for(let P=0;P<E;P++)M[p[P]](R,b[d[P]](R))}return u}function cS(n){const e=n.data.array.constructor,t=n.count,i=n.itemSize,s=n.normalized,l=new e(t*i);let u;u=n.isInstancedInterleavedBufferAttribute?new Z.InstancedBufferAttribute(l,i,s,n.meshPerAttribute):new Z.BufferAttribute(l,i,s);for(let d=0;d<t;d++)u.setX(d,n.getX(d)),i>=2&&u.setY(d,n.getY(d)),i>=3&&u.setZ(d,n.getZ(d)),i>=4&&u.setW(d,n.getW(d));return u}function P7e(n){const e=n.attributes,t=n.morphTargets,i=new Map;for(const s in e){const l=e[s];l.isInterleavedBufferAttribute&&(i.has(l)||i.set(l,cS(l)),e[s]=i.get(l))}for(const s in t){const l=t[s];l.isInterleavedBufferAttribute&&(i.has(l)||i.set(l,cS(l)),t[s]=i.get(l))}}function N7e(n){let e=0;for(const i in n.attributes){const s=n.getAttribute(i);e+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}const t=n.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function D7e(n,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},i=n.getIndex(),s=n.getAttribute("position"),l=i?i.count:s.count;let u=0;const d=Object.keys(n.attributes),p={},g={},x=[],b=["getX","getY","getZ","getW"],E=["setX","setY","setZ","setW"];for(let F=0,V=d.length;F<V;F++){const G=d[F],q=n.attributes[G];p[G]=new q.constructor(new q.array.constructor(q.count*q.itemSize),q.itemSize,q.normalized);const ne=n.morphAttributes[G];ne&&(g[G]||(g[G]=[]),ne.forEach((K,Q)=>{const H=new K.array.constructor(K.count*K.itemSize);g[G][Q]=new K.constructor(H,K.itemSize,K.normalized)}))}const S=.5*e,M=Math.log10(1/e),R=Math.pow(10,M),P=S*R;for(let F=0;F<l;F++){const V=i?i.getX(F):F;let G="";for(let q=0,ne=d.length;q<ne;q++){const K=d[q],Q=n.getAttribute(K),H=Q.itemSize;for(let j=0;j<H;j++)G+=~~(Q[b[j]](V)*R+P)+","}if(G in t)x.push(t[G]);else{for(let q=0,ne=d.length;q<ne;q++){const K=d[q],Q=n.getAttribute(K),H=n.morphAttributes[K],j=Q.itemSize,ee=p[K],de=g[K];for(let oe=0;oe<j;oe++){const we=b[oe],$e=E[oe];if(ee[$e](u,Q[we](V)),H)for(let Me=0,Ne=H.length;Me<Ne;Me++)de[Me][$e](u,H[Me][we](V))}}t[G]=u,x.push(u),u++}}const k=n.clone();for(const F in n.attributes){const V=p[F];if(k.setAttribute(F,new V.constructor(V.array.slice(0,u*V.itemSize),V.itemSize,V.normalized)),F in g)for(let G=0;G<g[F].length;G++){const q=g[F][G];k.morphAttributes[F][G]=new q.constructor(q.array.slice(0,u*q.itemSize),q.itemSize,q.normalized)}}return k.setIndex(x),k}function C3(n,e){if(e===Z.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Z.TriangleFanDrawMode||e===Z.TriangleStripDrawMode){let t=n.getIndex();if(t===null){const u=[],d=n.getAttribute("position");if(d===void 0)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n;for(let p=0;p<d.count;p++)u.push(p);n.setIndex(u),t=n.getIndex()}const i=t.count-2,s=[];if(e===Z.TriangleFanDrawMode)for(let u=1;u<=i;u++)s.push(t.getX(0)),s.push(t.getX(u)),s.push(t.getX(u+1));else for(let u=0;u<i;u++)u%2==0?(s.push(t.getX(u)),s.push(t.getX(u+1)),s.push(t.getX(u+2))):(s.push(t.getX(u+2)),s.push(t.getX(u+1)),s.push(t.getX(u)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const l=n.clone();return l.setIndex(s),l.clearGroups(),l}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}function F7e(n){const e=new Z.Vector3,t=new Z.Vector3,i=new Z.Vector3,s=new Z.Vector3,l=new Z.Vector3,u=new Z.Vector3,d=new Z.Vector3,p=new Z.Vector3,g=new Z.Vector3;function x(Ne,Ae,Fe,Ie,qe,dt,Wt,xt){e.fromBufferAttribute(Ae,qe),t.fromBufferAttribute(Ae,dt),i.fromBufferAttribute(Ae,Wt);const At=Ne.morphTargetInfluences;if(Fe&&At){d.set(0,0,0),p.set(0,0,0),g.set(0,0,0);for(let Rt=0,Et=Fe.length;Rt<Et;Rt++){const Ze=At[Rt],It=Fe[Rt];Ze!==0&&(s.fromBufferAttribute(It,qe),l.fromBufferAttribute(It,dt),u.fromBufferAttribute(It,Wt),Ie?(d.addScaledVector(s,Ze),p.addScaledVector(l,Ze),g.addScaledVector(u,Ze)):(d.addScaledVector(s.sub(e),Ze),p.addScaledVector(l.sub(t),Ze),g.addScaledVector(u.sub(i),Ze)))}e.add(d),t.add(p),i.add(g)}Ne.isSkinnedMesh&&(Ne.applyBoneTransform(qe,e),Ne.applyBoneTransform(dt,t),Ne.applyBoneTransform(Wt,i)),xt[3*qe+0]=e.x,xt[3*qe+1]=e.y,xt[3*qe+2]=e.z,xt[3*dt+0]=t.x,xt[3*dt+1]=t.y,xt[3*dt+2]=t.z,xt[3*Wt+0]=i.x,xt[3*Wt+1]=i.y,xt[3*Wt+2]=i.z}const b=n.geometry,E=n.material;let S,M,R;const P=b.index,k=b.attributes.position,F=b.morphAttributes.position,V=b.morphTargetsRelative,G=b.attributes.normal,q=b.morphAttributes.position,ne=b.groups,K=b.drawRange;let Q,H,j,ee,de,oe,we;const $e=new Float32Array(k.count*k.itemSize),Me=new Float32Array(G.count*G.itemSize);if(P!==null)if(Array.isArray(E))for(Q=0,j=ne.length;Q<j;Q++)for(de=ne[Q],oe=Math.max(de.start,K.start),we=Math.min(de.start+de.count,K.start+K.count),H=oe,ee=we;H<ee;H+=3)S=P.getX(H),M=P.getX(H+1),R=P.getX(H+2),x(n,k,F,V,S,M,R,$e),x(n,G,q,V,S,M,R,Me);else for(oe=Math.max(0,K.start),we=Math.min(P.count,K.start+K.count),Q=oe,j=we;Q<j;Q+=3)S=P.getX(Q),M=P.getX(Q+1),R=P.getX(Q+2),x(n,k,F,V,S,M,R,$e),x(n,G,q,V,S,M,R,Me);else if(Array.isArray(E))for(Q=0,j=ne.length;Q<j;Q++)for(de=ne[Q],oe=Math.max(de.start,K.start),we=Math.min(de.start+de.count,K.start+K.count),H=oe,ee=we;H<ee;H+=3)S=H,M=H+1,R=H+2,x(n,k,F,V,S,M,R,$e),x(n,G,q,V,S,M,R,Me);else for(oe=Math.max(0,K.start),we=Math.min(k.count,K.start+K.count),Q=oe,j=we;Q<j;Q+=3)S=Q,M=Q+1,R=Q+2,x(n,k,F,V,S,M,R,$e),x(n,G,q,V,S,M,R,Me);return{positionAttribute:k,normalAttribute:G,morphedPositionAttribute:new Z.Float32BufferAttribute($e,3),morphedNormalAttribute:new Z.Float32BufferAttribute(Me,3)}}function O7e(n){if(n.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),n;let e=n.groups;if(e=e.sort((u,d)=>u.materialIndex!==d.materialIndex?u.materialIndex-d.materialIndex:u.start-d.start),n.getIndex()===null){const u=n.getAttribute("position"),d=[];for(let p=0;p<u.count;p+=3)d.push(p,p+1,p+2);n.setIndex(d)}const t=n.getIndex(),i=[];for(let u=0;u<e.length;u++){const d=e[u],p=d.start,g=p+d.count;for(let x=p;x<g;x++)i.push(t.getX(x))}n.dispose(),n.setIndex(i);let s=0;for(let u=0;u<e.length;u++){const d=e[u];d.start=s,s+=d.count}let l=e[0];n.groups=[l];for(let u=1;u<e.length;u++){const d=e[u];l.materialIndex===d.materialIndex?l.count+=d.count:(l=d,n.groups.push(l))}return n}function V7e(n,e=Math.PI/3){const t=Math.cos(e),i=100*(1+1e-10),s=[new Z.Vector3,new Z.Vector3,new Z.Vector3],l=new Z.Vector3,u=new Z.Vector3,d=new Z.Vector3,p=new Z.Vector3;function g(R){return`${~~(R.x*i)},${~~(R.y*i)},${~~(R.z*i)}`}const x=n.index?n.toNonIndexed():n,b=x.attributes.position,E={};for(let R=0,P=b.count/3;R<P;R++){const k=3*R,F=s[0].fromBufferAttribute(b,k+0),V=s[1].fromBufferAttribute(b,k+1),G=s[2].fromBufferAttribute(b,k+2);l.subVectors(G,V),u.subVectors(F,V);const q=new Z.Vector3().crossVectors(l,u).normalize();for(let ne=0;ne<3;ne++){const K=g(s[ne]);K in E||(E[K]=[]),E[K].push(q)}}const S=new Float32Array(3*b.count),M=new Z.BufferAttribute(S,3,!1);for(let R=0,P=b.count/3;R<P;R++){const k=3*R,F=s[0].fromBufferAttribute(b,k+0),V=s[1].fromBufferAttribute(b,k+1),G=s[2].fromBufferAttribute(b,k+2);l.subVectors(G,V),u.subVectors(F,V),d.crossVectors(l,u).normalize();for(let q=0;q<3;q++){const ne=E[g(s[q])];p.set(0,0,0);for(let K=0,Q=ne.length;K<Q;K++){const H=ne[K];d.dot(H)>t&&p.add(H)}p.normalize(),M.setXYZ(k+q,p.x,p.y,p.z)}}return x.setAttribute("normal",M),x}class XV extends Z.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new H7e(t)}),this.register(function(t){return new X7e(t)}),this.register(function(t){return new eYe(t)}),this.register(function(t){return new tYe(t)}),this.register(function(t){return new nYe(t)}),this.register(function(t){return new Q7e(t)}),this.register(function(t){return new K7e(t)}),this.register(function(t){return new Z7e(t)}),this.register(function(t){return new j7e(t)}),this.register(function(t){return new W7e(t)}),this.register(function(t){return new Y7e(t)}),this.register(function(t){return new $7e(t)}),this.register(function(t){return new J7e(t)}),this.register(function(t){return new q7e(t)}),this.register(function(t){return new z7e(t)}),this.register(function(t){return new iYe(t)}),this.register(function(t){return new rYe(t)})}load(e,t,i,s){const l=this;let u;if(this.resourcePath!=="")u=this.resourcePath;else if(this.path!==""){const g=Z.LoaderUtils.extractUrlBase(e);u=Z.LoaderUtils.resolveURL(g,this.path)}else u=Z.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const d=function(g){s?s(g):console.error(g),l.manager.itemError(e),l.manager.itemEnd(e)},p=new Z.FileLoader(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(e,function(g){try{l.parse(g,u,function(x){t(x),l.manager.itemEnd(e)},d)}catch(x){d(x)}},i,d)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let l;const u={},d={},p=new TextDecoder;if(typeof e=="string")l=JSON.parse(e);else if(e instanceof ArrayBuffer)if(p.decode(new Uint8Array(e,0,4))===tse){try{u[Ei.KHR_BINARY_GLTF]=new sYe(e)}catch(x){return void(s&&s(x))}l=JSON.parse(u[Ei.KHR_BINARY_GLTF].content)}else l=JSON.parse(p.decode(e));else l=e;if(l.asset===void 0||l.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const g=new gYe(l,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});g.fileLoader.setRequestHeader(this.requestHeader);for(let x=0;x<this.pluginCallbacks.length;x++){const b=this.pluginCallbacks[x](g);b.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),d[b.name]=b,u[b.name]=!0}if(l.extensionsUsed)for(let x=0;x<l.extensionsUsed.length;++x){const b=l.extensionsUsed[x],E=l.extensionsRequired||[];switch(b){case Ei.KHR_MATERIALS_UNLIT:u[b]=new G7e;break;case Ei.KHR_DRACO_MESH_COMPRESSION:u[b]=new oYe(l,this.dracoLoader);break;case Ei.KHR_TEXTURE_TRANSFORM:u[b]=new aYe;break;case Ei.KHR_MESH_QUANTIZATION:u[b]=new lYe;break;default:E.indexOf(b)>=0&&d[b]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}g.setExtensions(u),g.setPlugins(d),g.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,l){i.parse(e,t,s,l)})}}function U7e(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Ei={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class z7e{constructor(e){this.parser=e,this.name=Ei.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const l=t[i];l.extensions&&l.extensions[this.name]&&l.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,l.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const l=t.json,u=((l.extensions&&l.extensions[this.name]||{}).lights||[])[e];let d;const p=new Z.Color(16777215);u.color!==void 0&&p.setRGB(u.color[0],u.color[1],u.color[2],Z.LinearSRGBColorSpace);const g=u.range!==void 0?u.range:0;switch(u.type){case"directional":d=new Z.DirectionalLight(p),d.target.position.set(0,0,-1),d.add(d.target);break;case"point":d=new Z.PointLight(p),d.distance=g;break;case"spot":d=new Z.SpotLight(p),d.distance=g,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,d.angle=u.spot.outerConeAngle,d.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,d.target.position.set(0,0,-1),d.add(d.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return d.position.set(0,0,0),ud(d,u),u.intensity!==void 0&&(d.intensity=u.intensity),d.name=t.createUniqueName(u.name||"light_"+e),s=Promise.resolve(d),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],l=(s.extensions&&s.extensions[this.name]||{}).light;return l===void 0?null:this._loadLight(l).then(function(u){return i._getNodeRef(t.cache,l,u)})}}class G7e{constructor(){this.name=Ei.KHR_MATERIALS_UNLIT}getMaterialType(){return Z.MeshBasicMaterial}extendParams(e,t,i){const s=[];e.color=new Z.Color(1,1,1),e.opacity=1;const l=t.pbrMetallicRoughness;if(l){if(Array.isArray(l.baseColorFactor)){const u=l.baseColorFactor;e.color.setRGB(u[0],u[1],u[2],Z.LinearSRGBColorSpace),e.opacity=u[3]}l.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",l.baseColorTexture,Z.SRGBColorSpace))}return Promise.all(s)}}class W7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class H7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];if(u.clearcoatFactor!==void 0&&(t.clearcoat=u.clearcoatFactor),u.clearcoatTexture!==void 0&&l.push(i.assignTexture(t,"clearcoatMap",u.clearcoatTexture)),u.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=u.clearcoatRoughnessFactor),u.clearcoatRoughnessTexture!==void 0&&l.push(i.assignTexture(t,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),u.clearcoatNormalTexture!==void 0&&(l.push(i.assignTexture(t,"clearcoatNormalMap",u.clearcoatNormalTexture)),u.clearcoatNormalTexture.scale!==void 0)){const d=u.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Z.Vector2(d,d)}return Promise.all(l)}}class X7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class $7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];return u.iridescenceFactor!==void 0&&(t.iridescence=u.iridescenceFactor),u.iridescenceTexture!==void 0&&l.push(i.assignTexture(t,"iridescenceMap",u.iridescenceTexture)),u.iridescenceIor!==void 0&&(t.iridescenceIOR=u.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),u.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=u.iridescenceThicknessMaximum),u.iridescenceThicknessTexture!==void 0&&l.push(i.assignTexture(t,"iridescenceThicknessMap",u.iridescenceThicknessTexture)),Promise.all(l)}}class Q7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[];t.sheenColor=new Z.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const u=s.extensions[this.name];if(u.sheenColorFactor!==void 0){const d=u.sheenColorFactor;t.sheenColor.setRGB(d[0],d[1],d[2],Z.LinearSRGBColorSpace)}return u.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=u.sheenRoughnessFactor),u.sheenColorTexture!==void 0&&l.push(i.assignTexture(t,"sheenColorMap",u.sheenColorTexture,Z.SRGBColorSpace)),u.sheenRoughnessTexture!==void 0&&l.push(i.assignTexture(t,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(l)}}class K7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];return u.transmissionFactor!==void 0&&(t.transmission=u.transmissionFactor),u.transmissionTexture!==void 0&&l.push(i.assignTexture(t,"transmissionMap",u.transmissionTexture)),Promise.all(l)}}class Z7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];t.thickness=u.thicknessFactor!==void 0?u.thicknessFactor:0,u.thicknessTexture!==void 0&&l.push(i.assignTexture(t,"thicknessMap",u.thicknessTexture)),t.attenuationDistance=u.attenuationDistance||1/0;const d=u.attenuationColor||[1,1,1];return t.attenuationColor=new Z.Color().setRGB(d[0],d[1],d[2],Z.LinearSRGBColorSpace),Promise.all(l)}}class j7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Y7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];t.specularIntensity=u.specularFactor!==void 0?u.specularFactor:1,u.specularTexture!==void 0&&l.push(i.assignTexture(t,"specularIntensityMap",u.specularTexture));const d=u.specularColorFactor||[1,1,1];return t.specularColor=new Z.Color().setRGB(d[0],d[1],d[2],Z.LinearSRGBColorSpace),u.specularColorTexture!==void 0&&l.push(i.assignTexture(t,"specularColorMap",u.specularColorTexture,Z.SRGBColorSpace)),Promise.all(l)}}class q7e{constructor(e){this.parser=e,this.name=Ei.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];return t.bumpScale=u.bumpFactor!==void 0?u.bumpFactor:1,u.bumpTexture!==void 0&&l.push(i.assignTexture(t,"bumpMap",u.bumpTexture)),Promise.all(l)}}class J7e{constructor(e){this.parser=e,this.name=Ei.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Z.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const l=[],u=s.extensions[this.name];return u.anisotropyStrength!==void 0&&(t.anisotropy=u.anisotropyStrength),u.anisotropyRotation!==void 0&&(t.anisotropyRotation=u.anisotropyRotation),u.anisotropyTexture!==void 0&&l.push(i.assignTexture(t,"anisotropyMap",u.anisotropyTexture)),Promise.all(l)}}class eYe{constructor(e){this.parser=e,this.name=Ei.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const l=s.extensions[this.name],u=t.options.ktx2Loader;if(!u){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,l.source,u)}}class tYe{constructor(e){this.parser=e,this.name=Ei.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,l=s.textures[e];if(!l.extensions||!l.extensions[t])return null;const u=l.extensions[t],d=s.images[u.source];let p=i.textureLoader;if(d.uri){const g=i.options.manager.getHandler(d.uri);g!==null&&(p=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,u.source,p);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class nYe{constructor(e){this.parser=e,this.name=Ei.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,l=s.textures[e];if(!l.extensions||!l.extensions[t])return null;const u=l.extensions[t],d=s.images[u.source];let p=i.textureLoader;if(d.uri){const g=i.options.manager.getHandler(d.uri);g!==null&&(p=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,u.source,p);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class iYe{constructor(e){this.name=Ei.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],l=this.parser.getDependency("buffer",s.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return l.then(function(d){const p=s.byteOffset||0,g=s.byteLength||0,x=s.count,b=s.byteStride,E=new Uint8Array(d,p,g);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(x,b,E,s.mode,s.filter).then(function(S){return S.buffer}):u.ready.then(function(){const S=new ArrayBuffer(x*b);return u.decodeGltfBuffer(new Uint8Array(S),x,b,E,s.mode,s.filter),S})})}return null}}class rYe{constructor(e){this.name=Ei.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const p of s.primitives)if(p.mode!==rc.TRIANGLES&&p.mode!==rc.TRIANGLE_STRIP&&p.mode!==rc.TRIANGLE_FAN&&p.mode!==void 0)return null;const l=i.extensions[this.name].attributes,u=[],d={};for(const p in l)u.push(this.parser.getDependency("accessor",l[p]).then(g=>(d[p]=g,d[p])));return u.length<1?null:(u.push(this.parser.createNodeMesh(e)),Promise.all(u).then(p=>{const g=p.pop(),x=g.isGroup?g.children:[g],b=p[0].count,E=[];for(const S of x){const M=new Z.Matrix4,R=new Z.Vector3,P=new Z.Quaternion,k=new Z.Vector3(1,1,1),F=new Z.InstancedMesh(S.geometry,S.material,b);for(let V=0;V<b;V++)d.TRANSLATION&&R.fromBufferAttribute(d.TRANSLATION,V),d.ROTATION&&P.fromBufferAttribute(d.ROTATION,V),d.SCALE&&k.fromBufferAttribute(d.SCALE,V),F.setMatrixAt(V,M.compose(R,P,k));for(const V in d)if(V==="_COLOR_0"){const G=d[V];F.instanceColor=new Z.InstancedBufferAttribute(G.array,G.itemSize,G.normalized)}else V!=="TRANSLATION"&&V!=="ROTATION"&&V!=="SCALE"&&S.geometry.setAttribute(V,d[V]);Z.Object3D.prototype.copy.call(F,S),this.parser.assignFinalMaterial(F),E.push(F)}return g.isGroup?(g.clear(),g.add(...E),g):E[0]}))}}const tse="glTF";class sYe{constructor(e){this.name=Ei.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==tse)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,l=new DataView(e,12);let u=0;for(;u<s;){const d=l.getUint32(u,!0);u+=4;const p=l.getUint32(u,!0);if(u+=4,p===1313821514){const g=new Uint8Array(e,12+u,d);this.content=i.decode(g)}else if(p===5130562){const g=12+u;this.body=e.slice(g,g+d)}u+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class oYe{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ei.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,l=e.extensions[this.name].bufferView,u=e.extensions[this.name].attributes,d={},p={},g={};for(const x in u){const b=E3[x]||x.toLowerCase();d[b]=u[x]}for(const x in e.attributes){const b=E3[x]||x.toLowerCase();if(u[x]!==void 0){const E=i.accessors[e.attributes[x]],S=bA[E.componentType];g[b]=S.name,p[b]=E.normalized===!0}}return t.getDependency("bufferView",l).then(function(x){return new Promise(function(b,E){s.decodeDracoFile(x,function(S){for(const M in S.attributes){const R=S.attributes[M],P=p[M];P!==void 0&&(R.normalized=P)}b(S)},d,g,Z.LinearSRGBColorSpace,E)})})}}class aYe{constructor(){this.name=Ei.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class lYe{constructor(){this.name=Ei.KHR_MESH_QUANTIZATION}}class nse extends Z.Interpolant{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,l=e*s*3+s;for(let u=0;u!==s;u++)t[u]=i[l+u];return t}interpolate_(e,t,i,s){const l=this.resultBuffer,u=this.sampleValues,d=this.valueSize,p=2*d,g=3*d,x=s-t,b=(i-t)/x,E=b*b,S=E*b,M=e*g,R=M-g,P=-2*S+3*E,k=S-E,F=1-P,V=k-E+b;for(let G=0;G!==d;G++){const q=u[R+G+d],ne=u[R+G+p]*x,K=u[M+G+d],Q=u[M+G]*x;l[G]=F*q+V*ne+P*K+k*Q}return l}}const cYe=new Z.Quaternion;class uYe extends nse{interpolate_(e,t,i,s){const l=super.interpolate_(e,t,i,s);return cYe.fromArray(l).normalize().toArray(l),l}}const rc={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},bA={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},s8={9728:Z.NearestFilter,9729:Z.LinearFilter,9984:Z.NearestMipmapNearestFilter,9985:Z.LinearMipmapNearestFilter,9986:Z.NearestMipmapLinearFilter,9987:Z.LinearMipmapLinearFilter},o8={33071:Z.ClampToEdgeWrapping,33648:Z.MirroredRepeatWrapping,10497:Z.RepeatWrapping},cP={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E3={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Gf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},hYe={CUBICSPLINE:void 0,LINEAR:Z.InterpolateLinear,STEP:Z.InterpolateDiscrete};function dYe(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new Z.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Z.FrontSide})),n.DefaultMaterial}function ng(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function ud(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function fYe(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function pYe(n){let e;const t=n.extensions&&n.extensions[Ei.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+uP(t.attributes):n.indices+":"+uP(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+uP(n.targets[i]);return e}function uP(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function _3(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const mYe=new Z.Matrix4;class gYe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new U7e,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,l=!1,u=-1;if(typeof navigator<"u"){const d=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(d)===!0;const p=d.match(/Version\/(\d+)/);s=i&&p?parseInt(p[1],10):-1,l=d.indexOf("Firefox")>-1,u=l?d.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||l&&u<98?this.textureLoader=new Z.TextureLoader(this.options.manager):this.textureLoader=new Z.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Z.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,l=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(u){const d={scene:u[0][s.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:s.asset,parser:i,userData:{}};return ng(l,d,s),ud(d,s),Promise.all(i._invokeAll(function(p){return p.afterRoot&&p.afterRoot(d)})).then(function(){for(const p of d.scenes)p.updateMatrixWorld();e(d)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,l=t.length;s<l;s++){const u=t[s].joints;for(let d=0,p=u.length;d<p;d++)e[u[d]].isBone=!0}for(let s=0,l=e.length;s<l;s++){const u=e[s];u.mesh!==void 0&&(this._addNodeRef(this.meshCache,u.mesh),u.skin!==void 0&&(i[u.mesh].isSkinnedMesh=!0)),u.camera!==void 0&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),l=(u,d)=>{const p=this.associations.get(u);p!=null&&this.associations.set(d,p);for(const[g,x]of u.children.entries())l(x,d.children[g])};return l(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const l=e(t[s]);l&&i.push(l)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(l){return l.loadNode&&l.loadNode(t)});break;case"mesh":s=this._invokeOne(function(l){return l.loadMesh&&l.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(l){return l.loadBufferView&&l.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(l){return l.loadMaterial&&l.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(l){return l.loadTexture&&l.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(l){return l.loadAnimation&&l.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(l){return l!=this&&l.getDependency&&l.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e)}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(l,u){return i.getDependency(e,u)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ei.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(l,u){i.load(Z.LoaderUtils.resolveURL(t.uri,s.path),l,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,l=t.byteOffset||0;return i.slice(l,l+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const u=cP[s.type],d=bA[s.componentType],p=s.normalized===!0,g=new d(s.count*u);return Promise.resolve(new Z.BufferAttribute(g,u,p))}const l=[];return s.bufferView!==void 0?l.push(this.getDependency("bufferView",s.bufferView)):l.push(null),s.sparse!==void 0&&(l.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),l.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(l).then(function(u){const d=u[0],p=cP[s.type],g=bA[s.componentType],x=g.BYTES_PER_ELEMENT,b=x*p,E=s.byteOffset||0,S=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,M=s.normalized===!0;let R,P;if(S&&S!==b){const k=Math.floor(E/S),F="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+k+":"+s.count;let V=t.cache.get(F);V||(R=new g(d,k*S,s.count*S/x),V=new Z.InterleavedBuffer(R,S/x),t.cache.add(F,V)),P=new Z.InterleavedBufferAttribute(V,p,E%S/x,M)}else R=d===null?new g(s.count*p):new g(d,E,s.count*p),P=new Z.BufferAttribute(R,p,M);if(s.sparse!==void 0){const k=cP.SCALAR,F=bA[s.sparse.indices.componentType],V=s.sparse.indices.byteOffset||0,G=s.sparse.values.byteOffset||0,q=new F(u[1],V,s.sparse.count*k),ne=new g(u[2],G,s.sparse.count*p);d!==null&&(P=new Z.BufferAttribute(P.array.slice(),P.itemSize,P.normalized)),P.normalized=!1;for(let K=0,Q=q.length;K<Q;K++){const H=q[K];if(P.setX(H,ne[K*p]),p>=2&&P.setY(H,ne[K*p+1]),p>=3&&P.setZ(H,ne[K*p+2]),p>=4&&P.setW(H,ne[K*p+3]),p>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}P.normalized=M}return P})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,l=t.images[s];let u=this.textureLoader;if(l.uri){const d=i.manager.getHandler(l.uri);d!==null&&(u=d)}return this.loadTextureImage(e,s,u)}loadTextureImage(e,t,i){const s=this,l=this.json,u=l.textures[e],d=l.images[t],p=(d.uri||d.bufferView)+":"+u.sampler;if(this.textureCache[p])return this.textureCache[p];const g=this.loadImageSource(t,i).then(function(x){x.flipY=!1,x.name=u.name||d.name||"",x.name===""&&typeof d.uri=="string"&&d.uri.startsWith("data:image/")===!1&&(x.name=d.uri);const b=(l.samplers||{})[u.sampler]||{};return x.magFilter=s8[b.magFilter]||Z.LinearFilter,x.minFilter=s8[b.minFilter]||Z.LinearMipmapLinearFilter,x.wrapS=o8[b.wrapS]||Z.RepeatWrapping,x.wrapT=o8[b.wrapT]||Z.RepeatWrapping,x.generateMipmaps=!x.isCompressedTexture&&x.minFilter!==Z.NearestFilter&&x.minFilter!==Z.LinearFilter,s.associations.set(x,{textures:e}),x}).catch(function(){return null});return this.textureCache[p]=g,g}loadImageSource(e,t){const i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(x=>x.clone());const l=i.images[e],u=self.URL||self.webkitURL;let d=l.uri||"",p=!1;if(l.bufferView!==void 0)d=this.getDependency("bufferView",l.bufferView).then(function(x){p=!0;const b=new Blob([x],{type:l.mimeType});return d=u.createObjectURL(b),d});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const g=Promise.resolve(d).then(function(x){return new Promise(function(b,E){let S=b;t.isImageBitmapLoader===!0&&(S=function(M){const R=new Z.Texture(M);R.needsUpdate=!0,b(R)}),t.load(Z.LoaderUtils.resolveURL(x,s.path),S,void 0,E)})}).then(function(x){var b;return p===!0&&u.revokeObjectURL(d),ud(x,l),x.userData.mimeType=l.mimeType||((b=l.uri).search(/\.jpe?g($|\?)/i)>0||b.search(/^data\:image\/jpeg/)===0?"image/jpeg":b.search(/\.webp($|\?)/i)>0||b.search(/^data\:image\/webp/)===0?"image/webp":b.search(/\.ktx2($|\?)/i)>0||b.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"),x}).catch(function(x){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),x});return this.sourceCache[e]=g,g}assignTexture(e,t,i,s){const l=this;return this.getDependency("texture",i.index).then(function(u){if(!u)return null;if(i.texCoord!==void 0&&i.texCoord>0&&((u=u.clone()).channel=i.texCoord),l.extensions[Ei.KHR_TEXTURE_TRANSFORM]){const d=i.extensions!==void 0?i.extensions[Ei.KHR_TEXTURE_TRANSFORM]:void 0;if(d){const p=l.associations.get(u);u=l.extensions[Ei.KHR_TEXTURE_TRANSFORM].extendTexture(u,d),l.associations.set(u,p)}}return s!==void 0&&(u.colorSpace=s),e[t]=u,u})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,l=t.attributes.color!==void 0,u=t.attributes.normal===void 0;if(e.isPoints){const d="PointsMaterial:"+i.uuid;let p=this.cache.get(d);p||(p=new Z.PointsMaterial,Z.Material.prototype.copy.call(p,i),p.color.copy(i.color),p.map=i.map,p.sizeAttenuation=!1,this.cache.add(d,p)),i=p}else if(e.isLine){const d="LineBasicMaterial:"+i.uuid;let p=this.cache.get(d);p||(p=new Z.LineBasicMaterial,Z.Material.prototype.copy.call(p,i),p.color.copy(i.color),p.map=i.map,this.cache.add(d,p)),i=p}if(s||l||u){let d="ClonedMaterial:"+i.uuid+":";s&&(d+="derivative-tangents:"),l&&(d+="vertex-colors:"),u&&(d+="flat-shading:");let p=this.cache.get(d);p||(p=i.clone(),l&&(p.vertexColors=!0),u&&(p.flatShading=!0),s&&(p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(d,p),this.associations.set(p,this.associations.get(i))),i=p}e.material=i}getMaterialType(){return Z.MeshStandardMaterial}loadMaterial(e){const t=this,i=this.json,s=this.extensions,l=i.materials[e];let u;const d={},p=[];if((l.extensions||{})[Ei.KHR_MATERIALS_UNLIT]){const x=s[Ei.KHR_MATERIALS_UNLIT];u=x.getMaterialType(),p.push(x.extendParams(d,l,t))}else{const x=l.pbrMetallicRoughness||{};if(d.color=new Z.Color(1,1,1),d.opacity=1,Array.isArray(x.baseColorFactor)){const b=x.baseColorFactor;d.color.setRGB(b[0],b[1],b[2],Z.LinearSRGBColorSpace),d.opacity=b[3]}x.baseColorTexture!==void 0&&p.push(t.assignTexture(d,"map",x.baseColorTexture,Z.SRGBColorSpace)),d.metalness=x.metallicFactor!==void 0?x.metallicFactor:1,d.roughness=x.roughnessFactor!==void 0?x.roughnessFactor:1,x.metallicRoughnessTexture!==void 0&&(p.push(t.assignTexture(d,"metalnessMap",x.metallicRoughnessTexture)),p.push(t.assignTexture(d,"roughnessMap",x.metallicRoughnessTexture))),u=this._invokeOne(function(b){return b.getMaterialType&&b.getMaterialType(e)}),p.push(Promise.all(this._invokeAll(function(b){return b.extendMaterialParams&&b.extendMaterialParams(e,d)})))}l.doubleSided===!0&&(d.side=Z.DoubleSide);const g=l.alphaMode||"OPAQUE";if(g==="BLEND"?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,g==="MASK"&&(d.alphaTest=l.alphaCutoff!==void 0?l.alphaCutoff:.5)),l.normalTexture!==void 0&&u!==Z.MeshBasicMaterial&&(p.push(t.assignTexture(d,"normalMap",l.normalTexture)),d.normalScale=new Z.Vector2(1,1),l.normalTexture.scale!==void 0)){const x=l.normalTexture.scale;d.normalScale.set(x,x)}if(l.occlusionTexture!==void 0&&u!==Z.MeshBasicMaterial&&(p.push(t.assignTexture(d,"aoMap",l.occlusionTexture)),l.occlusionTexture.strength!==void 0&&(d.aoMapIntensity=l.occlusionTexture.strength)),l.emissiveFactor!==void 0&&u!==Z.MeshBasicMaterial){const x=l.emissiveFactor;d.emissive=new Z.Color().setRGB(x[0],x[1],x[2],Z.LinearSRGBColorSpace)}return l.emissiveTexture!==void 0&&u!==Z.MeshBasicMaterial&&p.push(t.assignTexture(d,"emissiveMap",l.emissiveTexture,Z.SRGBColorSpace)),Promise.all(p).then(function(){const x=new u(d);return l.name&&(x.name=l.name),ud(x,l),t.associations.set(x,{materials:e}),l.extensions&&ng(s,x,l),x})}createUniqueName(e){const t=Z.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function l(d){return i[Ei.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(d,t).then(function(p){return a8(p,d,t)})}const u=[];for(let d=0,p=e.length;d<p;d++){const g=e[d],x=pYe(g),b=s[x];if(b)u.push(b.promise);else{let E;E=g.extensions&&g.extensions[Ei.KHR_DRACO_MESH_COMPRESSION]?l(g):a8(new Z.BufferGeometry,g,t),s[x]={primitive:g,promise:E},u.push(E)}}return Promise.all(u)}loadMesh(e){const t=this,i=this.json,s=this.extensions,l=i.meshes[e],u=l.primitives,d=[];for(let p=0,g=u.length;p<g;p++){const x=u[p].material===void 0?dYe(this.cache):this.getDependency("material",u[p].material);d.push(x)}return d.push(t.loadGeometries(u)),Promise.all(d).then(function(p){const g=p.slice(0,p.length-1),x=p[p.length-1],b=[];for(let S=0,M=x.length;S<M;S++){const R=x[S],P=u[S];let k;const F=g[S];if(P.mode===rc.TRIANGLES||P.mode===rc.TRIANGLE_STRIP||P.mode===rc.TRIANGLE_FAN||P.mode===void 0)k=l.isSkinnedMesh===!0?new Z.SkinnedMesh(R,F):new Z.Mesh(R,F),k.isSkinnedMesh===!0&&k.normalizeSkinWeights(),P.mode===rc.TRIANGLE_STRIP?k.geometry=C3(k.geometry,Z.TriangleStripDrawMode):P.mode===rc.TRIANGLE_FAN&&(k.geometry=C3(k.geometry,Z.TriangleFanDrawMode));else if(P.mode===rc.LINES)k=new Z.LineSegments(R,F);else if(P.mode===rc.LINE_STRIP)k=new Z.Line(R,F);else if(P.mode===rc.LINE_LOOP)k=new Z.LineLoop(R,F);else{if(P.mode!==rc.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);k=new Z.Points(R,F)}Object.keys(k.geometry.morphAttributes).length>0&&fYe(k,l),k.name=t.createUniqueName(l.name||"mesh_"+e),ud(k,l),P.extensions&&ng(s,k,P),t.assignFinalMaterial(k),b.push(k)}for(let S=0,M=b.length;S<M;S++)t.associations.set(b[S],{meshes:e,primitives:S});if(b.length===1)return l.extensions&&ng(s,b[0],l),b[0];const E=new Z.Group;l.extensions&&ng(s,E,l),t.associations.set(E,{meshes:e});for(let S=0,M=b.length;S<M;S++)E.add(b[S]);return E})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(s)return i.type==="perspective"?t=new Z.PerspectiveCamera(Z.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new Z.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),ud(t,i),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,l=t.joints.length;s<l;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const l=s.pop(),u=s,d=[],p=[];for(let g=0,x=u.length;g<x;g++){const b=u[g];if(b){d.push(b);const E=new Z.Matrix4;l!==null&&E.fromArray(l.array,16*g),p.push(E)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[g])}return new Z.Skeleton(d,p)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],l=s.name?s.name:"animation_"+e,u=[],d=[],p=[],g=[],x=[];for(let b=0,E=s.channels.length;b<E;b++){const S=s.channels[b],M=s.samplers[S.sampler],R=S.target,P=R.node,k=s.parameters!==void 0?s.parameters[M.input]:M.input,F=s.parameters!==void 0?s.parameters[M.output]:M.output;R.node!==void 0&&(u.push(this.getDependency("node",P)),d.push(this.getDependency("accessor",k)),p.push(this.getDependency("accessor",F)),g.push(M),x.push(R))}return Promise.all([Promise.all(u),Promise.all(d),Promise.all(p),Promise.all(g),Promise.all(x)]).then(function(b){const E=b[0],S=b[1],M=b[2],R=b[3],P=b[4],k=[];for(let F=0,V=E.length;F<V;F++){const G=E[F],q=S[F],ne=M[F],K=R[F],Q=P[F];if(G===void 0)continue;G.updateMatrix&&G.updateMatrix();const H=i._createAnimationTracks(G,q,ne,K,Q);if(H)for(let j=0;j<H.length;j++)k.push(H[j])}return new Z.AnimationClip(l,void 0,k)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(l){const u=i._getNodeRef(i.meshCache,s.mesh,l);return s.weights!==void 0&&u.traverse(function(d){if(d.isMesh)for(let p=0,g=s.weights.length;p<g;p++)d.morphTargetInfluences[p]=s.weights[p]}),u})}loadNode(e){const t=this,i=this.json.nodes[e],s=t._loadNodeShallow(e),l=[],u=i.children||[];for(let p=0,g=u.length;p<g;p++)l.push(t.getDependency("node",u[p]));const d=i.skin===void 0?Promise.resolve(null):t.getDependency("skin",i.skin);return Promise.all([s,Promise.all(l),d]).then(function(p){const g=p[0],x=p[1],b=p[2];b!==null&&g.traverse(function(E){E.isSkinnedMesh&&E.bind(b,mYe)});for(let E=0,S=x.length;E<S;E++)g.add(x[E]);return g})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const l=t.nodes[e],u=l.name?s.createUniqueName(l.name):"",d=[],p=s._invokeOne(function(g){return g.createNodeMesh&&g.createNodeMesh(e)});return p&&d.push(p),l.camera!==void 0&&d.push(s.getDependency("camera",l.camera).then(function(g){return s._getNodeRef(s.cameraCache,l.camera,g)})),s._invokeAll(function(g){return g.createNodeAttachment&&g.createNodeAttachment(e)}).forEach(function(g){d.push(g)}),this.nodeCache[e]=Promise.all(d).then(function(g){let x;if(x=l.isBone===!0?new Z.Bone:g.length>1?new Z.Group:g.length===1?g[0]:new Z.Object3D,x!==g[0])for(let b=0,E=g.length;b<E;b++)x.add(g[b]);if(l.name&&(x.userData.name=l.name,x.name=u),ud(x,l),l.extensions&&ng(i,x,l),l.matrix!==void 0){const b=new Z.Matrix4;b.fromArray(l.matrix),x.applyMatrix4(b)}else l.translation!==void 0&&x.position.fromArray(l.translation),l.rotation!==void 0&&x.quaternion.fromArray(l.rotation),l.scale!==void 0&&x.scale.fromArray(l.scale);return s.associations.has(x)||s.associations.set(x,{}),s.associations.get(x).nodes=e,x}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,l=new Z.Group;i.name&&(l.name=s.createUniqueName(i.name)),ud(l,i),i.extensions&&ng(t,l,i);const u=i.nodes||[],d=[];for(let p=0,g=u.length;p<g;p++)d.push(s.getDependency("node",u[p]));return Promise.all(d).then(function(p){for(let g=0,x=p.length;g<x;g++)l.add(p[g]);return s.associations=(g=>{const x=new Map;for(const[b,E]of s.associations)(b instanceof Z.Material||b instanceof Z.Texture)&&x.set(b,E);return g.traverse(b=>{const E=s.associations.get(b);E!=null&&x.set(b,E)}),x})(l),l})}_createAnimationTracks(e,t,i,s,l){const u=[],d=e.name?e.name:e.uuid,p=[];let g;switch(Gf[l.path]===Gf.weights?e.traverse(function(E){E.morphTargetInfluences&&p.push(E.name?E.name:E.uuid)}):p.push(d),Gf[l.path]){case Gf.weights:g=Z.NumberKeyframeTrack;break;case Gf.rotation:g=Z.QuaternionKeyframeTrack;break;case Gf.position:case Gf.scale:g=Z.VectorKeyframeTrack;break;default:g=i.itemSize===1?Z.NumberKeyframeTrack:Z.VectorKeyframeTrack}const x=s.interpolation!==void 0?hYe[s.interpolation]:Z.InterpolateLinear,b=this._getArrayFromAccessor(i);for(let E=0,S=p.length;E<S;E++){const M=new g(p[E]+"."+Gf[l.path],t.array,b,x);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(M),u.push(M)}return u}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=_3(t.constructor),s=new Float32Array(t.length);for(let l=0,u=t.length;l<u;l++)s[l]=t[l]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){return new(this instanceof Z.QuaternionKeyframeTrack?uYe:nse)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function a8(n,e,t){const i=e.attributes,s=[];function l(u,d){return t.getDependency("accessor",u).then(function(p){n.setAttribute(d,p)})}for(const u in i){const d=E3[u]||u.toLowerCase();d in n.attributes||s.push(l(i[u],d))}if(e.indices!==void 0&&!n.index){const u=t.getDependency("accessor",e.indices).then(function(d){n.setIndex(d)});s.push(u)}return Z.ColorManagement.workingColorSpace!==Z.LinearSRGBColorSpace&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Z.ColorManagement.workingColorSpace}" not supported.`),ud(n,e),function(u,d,p){const g=d.attributes,x=new Z.Box3;if(g.POSITION===void 0)return;{const S=p.json.accessors[g.POSITION],M=S.min,R=S.max;if(M===void 0||R===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(x.set(new Z.Vector3(M[0],M[1],M[2]),new Z.Vector3(R[0],R[1],R[2])),S.normalized){const P=_3(bA[S.componentType]);x.min.multiplyScalar(P),x.max.multiplyScalar(P)}}const b=d.targets;if(b!==void 0){const S=new Z.Vector3,M=new Z.Vector3;for(let R=0,P=b.length;R<P;R++){const k=b[R];if(k.POSITION!==void 0){const F=p.json.accessors[k.POSITION],V=F.min,G=F.max;if(V!==void 0&&G!==void 0){if(M.setX(Math.max(Math.abs(V[0]),Math.abs(G[0]))),M.setY(Math.max(Math.abs(V[1]),Math.abs(G[1]))),M.setZ(Math.max(Math.abs(V[2]),Math.abs(G[2]))),F.normalized){const q=_3(bA[F.componentType]);M.multiplyScalar(q)}S.max(M)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}x.expandByVector(S)}u.boundingBox=x;const E=new Z.Sphere;x.getCenter(E.center),E.radius=x.min.distanceTo(x.max)/2,u.boundingSphere=E}(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?function(u,d,p){let g=!1,x=!1,b=!1;for(let R=0,P=d.length;R<P;R++){const k=d[R];if(k.POSITION!==void 0&&(g=!0),k.NORMAL!==void 0&&(x=!0),k.COLOR_0!==void 0&&(b=!0),g&&x&&b)break}if(!g&&!x&&!b)return Promise.resolve(u);const E=[],S=[],M=[];for(let R=0,P=d.length;R<P;R++){const k=d[R];if(g){const F=k.POSITION!==void 0?p.getDependency("accessor",k.POSITION):u.attributes.position;E.push(F)}if(x){const F=k.NORMAL!==void 0?p.getDependency("accessor",k.NORMAL):u.attributes.normal;S.push(F)}if(b){const F=k.COLOR_0!==void 0?p.getDependency("accessor",k.COLOR_0):u.attributes.color;M.push(F)}}return Promise.all([Promise.all(E),Promise.all(S),Promise.all(M)]).then(function(R){const P=R[0],k=R[1],F=R[2];return g&&(u.morphAttributes.position=P),x&&(u.morphAttributes.normal=k),b&&(u.morphAttributes.color=F),u.morphTargetsRelative=!0,u})}(n,e.targets,t):n})}class yYe{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const i=this.workersResolve[e];if(i&&i(t),this.queue.length){const{resolve:s,msg:l,transfer:u}=this.queue.shift();this.workersResolve[e]=s,this.workers[e].postMessage(l,u)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(e,t)):this.queue.push({resolve:i,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ise=9,rse=15,sse=16,ose=22,ase=37,lse=43,cse=76,use=83,hse=97,dse=100,fse=103,pse=109,mse=165,gse=166,$V=1000066e3;class AYe{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Db{constructor(e,t,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,i),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){t===void 0&&(t=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==t&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}}const Aa=[171,75,84,88,32,50,48,187,13,10,26,10];function l8(n){return new TextDecoder().decode(n)}var vYe=Pn(9922).hp;let hP,ld,I3;const dP={env:{emscripten_notify_memory_growth:function(n){I3=new Uint8Array(ld.exports.memory.buffer)}}};class bYe{init(){return hP||(hP=typeof fetch<"u"?fetch("data:application/wasm;base64,"+c8).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,dP)).then(this._init):WebAssembly.instantiate(vYe.from(c8,"base64"),dP).then(this._init),hP)}_init(e){ld=e.instance,dP.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!ld)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=e.byteLength,s=ld.exports.malloc(i);I3.set(e,s),t=t||Number(ld.exports.ZSTD_findDecompressedSize(s,i));const l=ld.exports.malloc(t),u=ld.exports.ZSTD_decompress(l,t,s,i),d=I3.slice(l,l+u);return ld.exports.free(s),ld.exports.free(l),d}}const c8="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",fP=new WeakMap;let pP,mP=0;class Il extends Z.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new yYe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return e.isWebGPURenderer===!0?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new Z.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),i=new Z.FileLoader(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,s]).then(([l,u])=>{const d=Il.BasisWorker.toString(),p=["/* constants */","let _EngineFormat = "+JSON.stringify(Il.EngineFormat),"let _EngineType = "+JSON.stringify(Il.EngineType),"let _TranscoderFormat = "+JSON.stringify(Il.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Il.BasisFormat),"/* basis_transcoder.js */",l,"/* worker */",d.substring(d.indexOf("{")+1,d.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p])),this.transcoderBinary=u,this.workerPool.setWorkerCreator(()=>{const g=new Worker(this.workerSourceURL),x=this.transcoderBinary.slice(0);return g.postMessage({type:"init",config:this.workerConfig,transcoderBinary:x},[x]),g})}),mP>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),mP++}return this.transcoderPending}load(e,t,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const l=new Z.FileLoader(this.manager);l.setResponseType("arraybuffer"),l.setWithCredentials(this.withCredentials),l.load(e,u=>{this.parse(u,t,s)},i,s)}parse(e,t,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(fP.has(e))return fP.get(e).promise.then(t).catch(i);this._createTexture(e).then(s=>t?t(s):null).catch(i)}_createTextureFrom(e,t){const{type:i,error:s,data:{faces:l,width:u,height:d,format:p,type:g,dfdFlags:x}}=e;if(i==="error")return Promise.reject(s);let b;if(t.faceCount===6)b=new Z.CompressedCubeTexture(l,p,g);else{const E=l[0].mipmaps;b=t.layerCount>1?new Z.CompressedArrayTexture(E,u,d,t.layerCount,p,g):new Z.CompressedTexture(E,u,d,p,g)}return b.minFilter=l[0].mipmaps.length===1?Z.LinearFilter:Z.LinearMipmapLinearFilter,b.magFilter=Z.LinearFilter,b.generateMipmaps=!1,b.needsUpdate=!0,b.colorSpace=u8(t),b.premultiplyAlpha=!!(1&x),b}async _createTexture(e,t={}){const i=function(d){const p=new Uint8Array(d.buffer,d.byteOffset,Aa.length);if(p[0]!==Aa[0]||p[1]!==Aa[1]||p[2]!==Aa[2]||p[3]!==Aa[3]||p[4]!==Aa[4]||p[5]!==Aa[5]||p[6]!==Aa[6]||p[7]!==Aa[7]||p[8]!==Aa[8]||p[9]!==Aa[9]||p[10]!==Aa[10]||p[11]!==Aa[11])throw new Error("Missing KTX 2.0 identifier.");const g=new AYe,x=17*Uint32Array.BYTES_PER_ELEMENT,b=new Db(d,Aa.length,x,!0);g.vkFormat=b._nextUint32(),g.typeSize=b._nextUint32(),g.pixelWidth=b._nextUint32(),g.pixelHeight=b._nextUint32(),g.pixelDepth=b._nextUint32(),g.layerCount=b._nextUint32(),g.faceCount=b._nextUint32();const E=b._nextUint32();g.supercompressionScheme=b._nextUint32();const S=b._nextUint32(),M=b._nextUint32(),R=b._nextUint32(),P=b._nextUint32(),k=b._nextUint64(),F=b._nextUint64(),V=new Db(d,Aa.length+x,3*E*8,!0);for(let xt=0;xt<E;xt++)g.levels.push({levelData:new Uint8Array(d.buffer,d.byteOffset+V._nextUint64(),V._nextUint64()),uncompressedByteLength:V._nextUint64()});const G=new Db(d,S,M,!0),q={vendorId:G._skip(4)._nextUint16(),descriptorType:G._nextUint16(),versionNumber:G._nextUint16(),descriptorBlockSize:G._nextUint16(),colorModel:G._nextUint8(),colorPrimaries:G._nextUint8(),transferFunction:G._nextUint8(),flags:G._nextUint8(),texelBlockDimension:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],bytesPlane:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],samples:[]},ne=(q.descriptorBlockSize/4-6)/4;for(let xt=0;xt<ne;xt++){const At={bitOffset:G._nextUint16(),bitLength:G._nextUint8(),channelType:G._nextUint8(),samplePosition:[G._nextUint8(),G._nextUint8(),G._nextUint8(),G._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&At.channelType?(At.sampleLower=G._nextInt32(),At.sampleUpper=G._nextInt32()):(At.sampleLower=G._nextUint32(),At.sampleUpper=G._nextUint32()),q.samples[xt]=At}g.dataFormatDescriptor.length=0,g.dataFormatDescriptor.push(q);const K=new Db(d,R,P,!0);for(;K._offset<P;){const xt=K._nextUint32(),At=K._scan(xt),Rt=l8(At);if(g.keyValue[Rt]=K._nextUint8Array(xt-At.byteLength-1),Rt.match(/^ktx/i)){const Et=l8(g.keyValue[Rt]);g.keyValue[Rt]=Et.substring(0,Et.lastIndexOf("\0"))}K._skip(xt%4?4-xt%4:0)}if(F<=0)return g;const Q=new Db(d,k,F,!0),H=Q._nextUint16(),j=Q._nextUint16(),ee=Q._nextUint32(),de=Q._nextUint32(),oe=Q._nextUint32(),we=Q._nextUint32(),$e=[];for(let xt=0;xt<E;xt++)$e.push({imageFlags:Q._nextUint32(),rgbSliceByteOffset:Q._nextUint32(),rgbSliceByteLength:Q._nextUint32(),alphaSliceByteOffset:Q._nextUint32(),alphaSliceByteLength:Q._nextUint32()});const Me=k+Q._offset,Ne=Me+ee,Ae=Ne+de,Fe=Ae+oe,Ie=new Uint8Array(d.buffer,d.byteOffset+Me,ee),qe=new Uint8Array(d.buffer,d.byteOffset+Ne,de),dt=new Uint8Array(d.buffer,d.byteOffset+Ae,oe),Wt=new Uint8Array(d.buffer,d.byteOffset+Fe,we);return g.globalData={endpointCount:H,selectorCount:j,imageDescs:$e,endpointsData:Ie,selectorsData:qe,tablesData:dt,extendedData:Wt},g}(new Uint8Array(e)),s=i.vkFormat===$V&&i.dataFormatDescriptor[0].colorModel===167;if(i.vkFormat!==0&&(!s||this.workerConfig.astcHDRSupported))return async function(d){const{vkFormat:p}=d;if(gP[p]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let g;d.supercompressionScheme===2&&(pP||(pP=new Promise(async E=>{const S=new bYe;await S.init(),E(S)})),g=await pP);const x=[];for(let E=0;E<d.levels.length;E++){const S=Math.max(1,d.pixelWidth>>E),M=Math.max(1,d.pixelHeight>>E),R=d.pixelDepth?Math.max(1,d.pixelDepth>>E):0,P=d.levels[E];let k,F;if(d.supercompressionScheme===0)k=P.levelData;else{if(d.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");k=g.decode(P.levelData,P.uncompressedByteLength)}F=yP[p]===Z.FloatType?new Float32Array(k.buffer,k.byteOffset,k.byteLength/Float32Array.BYTES_PER_ELEMENT):yP[p]===Z.HalfFloatType?new Uint16Array(k.buffer,k.byteOffset,k.byteLength/Uint16Array.BYTES_PER_ELEMENT):k,x.push({data:F,width:S,height:M,depth:R})}let b;if(xYe.has(gP[p]))b=d.pixelDepth===0?new Z.DataTexture(x[0].data,d.pixelWidth,d.pixelHeight):new Z.Data3DTexture(x[0].data,d.pixelWidth,d.pixelHeight,d.pixelDepth);else{if(d.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");b=new Z.CompressedTexture(x,d.pixelWidth,d.pixelHeight),b.minFilter=x.length===1?Z.LinearFilter:Z.LinearMipmapLinearFilter,b.magFilter=Z.LinearFilter}return b.mipmaps=x,b.type=yP[p],b.format=gP[p],b.colorSpace=u8(d),b.needsUpdate=!0,Promise.resolve(b)}(i);const l=t,u=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:l},[e])).then(d=>this._createTextureFrom(d.data,i));return fP.set(e,{promise:u}),u}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),mP--,this}}Il.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Il.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Il.EngineFormat={RGBAFormat:Z.RGBAFormat,RGBA_ASTC_4x4_Format:Z.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:Z.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:Z.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:Z.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:Z.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:Z.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:Z.RGB_ETC1_Format,RGB_ETC2_Format:Z.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:Z.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:Z.RGBA_S3TC_DXT1_Format},Il.EngineType={UnsignedByteType:Z.UnsignedByteType,HalfFloatType:Z.HalfFloatType,FloatType:Z.FloatType},Il.BasisWorker=function(){let n,e,t;const i=_EngineFormat,s=_EngineType,l=_TranscoderFormat,u=_BasisFormat;self.addEventListener("message",function(b){const E=b.data;switch(E.type){case"init":n=E.config,S=E.transcoderBinary,e=new Promise(M=>{t={wasmBinary:S,onRuntimeInitialized:M},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{faces:M,buffers:R,width:P,height:k,hasAlpha:F,format:V,type:G,dfdFlags:q}=function(ne){const K=new t.KTX2File(new Uint8Array(ne));function Q(){K.close(),K.delete()}if(!K.isValid())throw Q(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let H;if(K.isUASTC())H=u.UASTC;else if(K.isETC1S())H=u.ETC1S;else{if(!K.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");H=u.UASTC_HDR}const j=K.getWidth(),ee=K.getHeight(),de=K.getLayers()||1,oe=K.getLevels(),we=K.getFaces(),$e=K.getHasAlpha(),Me=K.getDFDFlags(),{transcoderFormat:Ne,engineFormat:Ae,engineType:Fe}=function(dt,Wt,xt,At){const Rt=p[dt];for(let Et=0;Et<Rt.length;Et++){const Ze=Rt[Et];if((!Ze.if||n[Ze.if])&&Ze.basisFormat.includes(dt)&&!(At&&Ze.transcoderFormat.length<2)&&(!Ze.needsPowerOfTwo||g(Wt)&&g(xt)))return{transcoderFormat:Ze.transcoderFormat[At?1:0],engineFormat:Ze.engineFormat[At?1:0],engineType:Ze.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(H,j,ee,$e);if(!j||!ee||!oe)throw Q(),new Error("THREE.KTX2Loader:	Invalid texture");if(!K.startTranscoding())throw Q(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Ie=[],qe=[];for(let dt=0;dt<we;dt++){const Wt=[];for(let xt=0;xt<oe;xt++){const At=[];let Rt,Et;for(let It=0;It<de;It++){const Lt=K.getImageLevelInfo(xt,It,dt);dt!==0||xt!==0||It!==0||Lt.origWidth%4==0&&Lt.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),oe>1?(Rt=Lt.origWidth,Et=Lt.origHeight):(Rt=Lt.width,Et=Lt.height);let Yt=new Uint8Array(K.getImageTranscodedSizeInBytes(xt,It,0,Ne));const ht=K.transcodeImage(Yt,xt,It,dt,Ne,0,-1,-1);if(Fe===s.HalfFloatType&&(Yt=new Uint16Array(Yt.buffer,Yt.byteOffset,Yt.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!ht)throw Q(),new Error("THREE.KTX2Loader: .transcodeImage failed.");At.push(Yt)}const Ze=x(At);Wt.push({data:Ze,width:Rt,height:Et}),qe.push(Ze.buffer)}Ie.push({mipmaps:Wt,width:j,height:ee,format:Ae,type:Fe})}return Q(),{faces:Ie,buffers:qe,width:j,height:ee,hasAlpha:$e,dfdFlags:Me,format:Ae,type:Fe}}(E.buffer);self.postMessage({type:"transcode",id:E.id,data:{faces:M,width:P,height:k,hasAlpha:F,format:V,type:G,dfdFlags:q}},R)}catch(M){console.error(M),self.postMessage({type:"error",id:E.id,error:M.message})}})}var S});const d=[{if:"astcSupported",basisFormat:[u.UASTC],transcoderFormat:[l.ASTC_4x4,l.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[s.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.BC7_M5,l.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[s.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.BC1,l.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[s.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.ETC1,l.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[s.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[s.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.PVRTC1_4_RGB,l.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[s.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[u.UASTC_HDR],transcoderFormat:[l.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[s.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[u.ETC1S,u.UASTC],transcoderFormat:[l.RGBA32,l.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[s.UnsignedByteType,s.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[u.UASTC_HDR],transcoderFormat:[l.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[s.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],p={[u.ETC1S]:d.filter(b=>b.basisFormat.includes(u.ETC1S)).sort((b,E)=>b.priorityUASTC-E.priorityUASTC),[u.UASTC]:d.filter(b=>b.basisFormat.includes(u.UASTC)).sort((b,E)=>b.priorityUASTC-E.priorityUASTC),[u.UASTC_HDR]:d.filter(b=>b.basisFormat.includes(u.UASTC_HDR)).sort((b,E)=>b.priorityHDR-E.priorityHDR)};function g(b){return b<=2||!(b&b-1)&&b!==0}function x(b){if(b.length===1)return b[0];let E=0;for(let R=0;R<b.length;R++)E+=b[R].byteLength;const S=new Uint8Array(E);let M=0;for(let R=0;R<b.length;R++){const P=b[R];S.set(P,M),M+=P.byteLength}return S}};const xYe=new Set([Z.RGBAFormat,Z.RGFormat,Z.RedFormat]),gP={[pse]:Z.RGBAFormat,[hse]:Z.RGBAFormat,[ase]:Z.RGBAFormat,[lse]:Z.RGBAFormat,[fse]:Z.RGFormat,[use]:Z.RGFormat,[sse]:Z.RGFormat,[ose]:Z.RGFormat,[dse]:Z.RedFormat,[cse]:Z.RedFormat,[rse]:Z.RedFormat,[ise]:Z.RedFormat,[$V]:Z.RGBA_ASTC_4x4_Format,[gse]:Z.RGBA_ASTC_6x6_Format,[mse]:Z.RGBA_ASTC_6x6_Format},yP={[pse]:Z.FloatType,[hse]:Z.HalfFloatType,[ase]:Z.UnsignedByteType,[lse]:Z.UnsignedByteType,[fse]:Z.FloatType,[use]:Z.HalfFloatType,[sse]:Z.UnsignedByteType,[ose]:Z.UnsignedByteType,[dse]:Z.FloatType,[cse]:Z.HalfFloatType,[rse]:Z.UnsignedByteType,[ise]:Z.UnsignedByteType,[$V]:Z.HalfFloatType,[gse]:Z.UnsignedByteType,[mse]:Z.UnsignedByteType};function u8(n){const e=n.dataFormatDescriptor[0];return e.colorPrimaries===1?e.transferFunction===2?Z.SRGBColorSpace:Z.LinearSRGBColorSpace:e.colorPrimaries===10?e.transferFunction===2?"display-p3":"display-p3-linear":(e.colorPrimaries===0||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),Z.NoColorSpace)}const Di={c:null,u:[new Z.Vector3,new Z.Vector3,new Z.Vector3],e:[]},Zi={c:null,u:[new Z.Vector3,new Z.Vector3,new Z.Vector3],e:[]},Pr=[[],[],[]],ci=[[],[],[]],Cr=[],ig=new Z.Vector3,rg=new Z.Vector3,sg=new Z.Vector3,Fs=new Z.Vector3,h8=new Z.Vector3,d8=new Z.Vector3,Xc=new Z.Matrix3,f8=new Z.Box3,p_=new Z.Matrix4,p8=new Z.Matrix4,m8=new Z.Ray;class uS{constructor(e=new Z.Vector3,t=new Z.Vector3,i=new Z.Matrix3){this.center=e,this.halfSize=t,this.rotation=i}set(e,t,i){return this.center=e,this.halfSize=t,this.rotation=i,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return new this.constructor().copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){const i=this.halfSize;Fs.subVectors(e,this.center),this.rotation.extractBasis(ig,rg,sg),t.copy(this.center);const s=Z.MathUtils.clamp(Fs.dot(ig),-i.x,i.x);t.add(ig.multiplyScalar(s));const l=Z.MathUtils.clamp(Fs.dot(rg),-i.y,i.y);t.add(rg.multiplyScalar(l));const u=Z.MathUtils.clamp(Fs.dot(sg),-i.z,i.z);return t.add(sg.multiplyScalar(u)),t}containsPoint(e){return Fs.subVectors(e,this.center),this.rotation.extractBasis(ig,rg,sg),Math.abs(Fs.dot(ig))<=this.halfSize.x&&Math.abs(Fs.dot(rg))<=this.halfSize.y&&Math.abs(Fs.dot(sg))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(wYe.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,d8),d8.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){Di.c=this.center,Di.e[0]=this.halfSize.x,Di.e[1]=this.halfSize.y,Di.e[2]=this.halfSize.z,this.rotation.extractBasis(Di.u[0],Di.u[1],Di.u[2]),Zi.c=e.center,Zi.e[0]=e.halfSize.x,Zi.e[1]=e.halfSize.y,Zi.e[2]=e.halfSize.z,e.rotation.extractBasis(Zi.u[0],Zi.u[1],Zi.u[2]);for(let l=0;l<3;l++)for(let u=0;u<3;u++)Pr[l][u]=Di.u[l].dot(Zi.u[u]);Fs.subVectors(Zi.c,Di.c),Cr[0]=Fs.dot(Di.u[0]),Cr[1]=Fs.dot(Di.u[1]),Cr[2]=Fs.dot(Di.u[2]);for(let l=0;l<3;l++)for(let u=0;u<3;u++)ci[l][u]=Math.abs(Pr[l][u])+t;let i,s;for(let l=0;l<3;l++)if(i=Di.e[l],s=Zi.e[0]*ci[l][0]+Zi.e[1]*ci[l][1]+Zi.e[2]*ci[l][2],Math.abs(Cr[l])>i+s)return!1;for(let l=0;l<3;l++)if(i=Di.e[0]*ci[0][l]+Di.e[1]*ci[1][l]+Di.e[2]*ci[2][l],s=Zi.e[l],Math.abs(Cr[0]*Pr[0][l]+Cr[1]*Pr[1][l]+Cr[2]*Pr[2][l])>i+s)return!1;return i=Di.e[1]*ci[2][0]+Di.e[2]*ci[1][0],s=Zi.e[1]*ci[0][2]+Zi.e[2]*ci[0][1],!(Math.abs(Cr[2]*Pr[1][0]-Cr[1]*Pr[2][0])>i+s||(i=Di.e[1]*ci[2][1]+Di.e[2]*ci[1][1],s=Zi.e[0]*ci[0][2]+Zi.e[2]*ci[0][0],Math.abs(Cr[2]*Pr[1][1]-Cr[1]*Pr[2][1])>i+s||(i=Di.e[1]*ci[2][2]+Di.e[2]*ci[1][2],s=Zi.e[0]*ci[0][1]+Zi.e[1]*ci[0][0],Math.abs(Cr[2]*Pr[1][2]-Cr[1]*Pr[2][2])>i+s||(i=Di.e[0]*ci[2][0]+Di.e[2]*ci[0][0],s=Zi.e[1]*ci[1][2]+Zi.e[2]*ci[1][1],Math.abs(Cr[0]*Pr[2][0]-Cr[2]*Pr[0][0])>i+s||(i=Di.e[0]*ci[2][1]+Di.e[2]*ci[0][1],s=Zi.e[0]*ci[1][2]+Zi.e[2]*ci[1][0],Math.abs(Cr[0]*Pr[2][1]-Cr[2]*Pr[0][1])>i+s||(i=Di.e[0]*ci[2][2]+Di.e[2]*ci[0][2],s=Zi.e[0]*ci[1][1]+Zi.e[1]*ci[1][0],Math.abs(Cr[0]*Pr[2][2]-Cr[2]*Pr[0][2])>i+s||(i=Di.e[0]*ci[1][0]+Di.e[1]*ci[0][0],s=Zi.e[1]*ci[2][2]+Zi.e[2]*ci[2][1],Math.abs(Cr[1]*Pr[0][0]-Cr[0]*Pr[1][0])>i+s||(i=Di.e[0]*ci[1][1]+Di.e[1]*ci[0][1],s=Zi.e[0]*ci[2][2]+Zi.e[2]*ci[2][0],Math.abs(Cr[1]*Pr[0][1]-Cr[0]*Pr[1][1])>i+s||(i=Di.e[0]*ci[1][2]+Di.e[1]*ci[0][2],s=Zi.e[0]*ci[2][1]+Zi.e[1]*ci[2][0],Math.abs(Cr[1]*Pr[0][2]-Cr[0]*Pr[1][2])>i+s)))))))))}intersectsPlane(e){this.rotation.extractBasis(ig,rg,sg);const t=this.halfSize.x*Math.abs(e.normal.dot(ig))+this.halfSize.y*Math.abs(e.normal.dot(rg))+this.halfSize.z*Math.abs(e.normal.dot(sg)),i=e.normal.dot(this.center)-e.constant;return Math.abs(i)<=t}intersectRay(e,t){return this.getSize(h8),f8.setFromCenterAndSize(Fs.set(0,0,0),h8),p_.setFromMatrix3(this.rotation),p_.setPosition(this.center),p8.copy(p_).invert(),m8.copy(e).applyMatrix4(p8),m8.intersectBox(f8,t)?t.applyMatrix4(p_):null}intersectsRay(e){return this.intersectRay(e,Fs)!==null}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){const t=e.elements;let i=Fs.set(t[0],t[1],t[2]).length();const s=Fs.set(t[4],t[5],t[6]).length(),l=Fs.set(t[8],t[9],t[10]).length();e.determinant()<0&&(i=-i),Xc.setFromMatrix4(e);const u=1/i,d=1/s,p=1/l;return Xc.elements[0]*=u,Xc.elements[1]*=u,Xc.elements[2]*=u,Xc.elements[3]*=d,Xc.elements[4]*=d,Xc.elements[5]*=d,Xc.elements[6]*=p,Xc.elements[7]*=p,Xc.elements[8]*=p,this.rotation.multiply(Xc),this.halfSize.x*=i,this.halfSize.y*=s,this.halfSize.z*=l,Fs.setFromMatrixPosition(e),this.center.add(Fs),this}}const wYe=new uS,CYe=/^[og]\s*(.+)?/,EYe=/^mtllib /,_Ye=/^usemtl /,IYe=/^usemap /,g8=/\s+/,y8=new Z.Vector3,AP=new Z.Vector3,A8=new Z.Vector3,v8=new Z.Vector3,nc=new Z.Vector3,m_=new Z.Color;function SYe(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const i=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,l){const u=this._finalize(!1);u&&(u.inherited||u.groupCount<=0)&&this.materials.splice(u.index,1);const d={index:this.materials.length,name:s||"",mtllib:Array.isArray(l)&&l.length>0?l[l.length-1]:"",smooth:u!==void 0?u.smooth:this.smooth,groupStart:u!==void 0?u.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(p){const g={index:typeof p=="number"?p:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return g.clone=this.clone.bind(g),g}};return this.materials.push(d),d},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(s){const l=this.currentMaterial();if(l&&l.groupEnd===-1&&(l.groupEnd=this.geometry.vertices.length/3,l.groupCount=l.groupEnd-l.groupStart,l.inherited=!1),s&&this.materials.length>1)for(let u=this.materials.length-1;u>=0;u--)this.materials[u].groupCount<=0&&this.materials.splice(u,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),l}},i&&i.name&&typeof i.clone=="function"){const s=i.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){const i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){const s=this.vertices,l=this.object.geometry.vertices;l.push(s[e+0],s[e+1],s[e+2]),l.push(s[t+0],s[t+1],s[t+2]),l.push(s[i+0],s[i+1],s[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const s=this.normals,l=this.object.geometry.normals;l.push(s[e+0],s[e+1],s[e+2]),l.push(s[t+0],s[t+1],s[t+2]),l.push(s[i+0],s[i+1],s[i+2])},addFaceNormal:function(e,t,i){const s=this.vertices,l=this.object.geometry.normals;y8.fromArray(s,e),AP.fromArray(s,t),A8.fromArray(s,i),nc.subVectors(A8,AP),v8.subVectors(y8,AP),nc.cross(v8),nc.normalize(),l.push(nc.x,nc.y,nc.z),l.push(nc.x,nc.y,nc.z),l.push(nc.x,nc.y,nc.z)},addColor:function(e,t,i){const s=this.colors,l=this.object.geometry.colors;s[e]!==void 0&&l.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&l.push(s[t+0],s[t+1],s[t+2]),s[i]!==void 0&&l.push(s[i+0],s[i+1],s[i+2])},addUV:function(e,t,i){const s=this.uvs,l=this.object.geometry.uvs;l.push(s[e+0],s[e+1]),l.push(s[t+0],s[t+1]),l.push(s[i+0],s[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,s,l,u,d,p,g){const x=this.vertices.length;let b=this.parseVertexIndex(e,x),E=this.parseVertexIndex(t,x),S=this.parseVertexIndex(i,x);if(this.addVertex(b,E,S),this.addColor(b,E,S),d!==void 0&&d!==""){const M=this.normals.length;b=this.parseNormalIndex(d,M),E=this.parseNormalIndex(p,M),S=this.parseNormalIndex(g,M),this.addNormal(b,E,S)}else this.addFaceNormal(b,E,S);if(s!==void 0&&s!==""){const M=this.uvs.length;b=this.parseUVIndex(s,M),E=this.parseUVIndex(l,M),S=this.parseUVIndex(u,M),this.addUV(b,E,S),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,s=e.length;i<s;i++){const l=this.parseVertexIndex(e[i],t);this.addVertexPoint(l),this.addColor(l)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,s=this.uvs.length;for(let l=0,u=e.length;l<u;l++)this.addVertexLine(this.parseVertexIndex(e[l],i));for(let l=0,u=t.length;l<u;l++)this.addUVLine(this.parseUVIndex(t[l],s))}};return n.startObject("",!1),n}class yse extends Z.Loader{constructor(e){super(e),this.materials=null}load(e,t,i,s){const l=this,u=new Z.FileLoader(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(d){try{t(l.parse(d))}catch(p){s?s(p):console.error(p),l.manager.itemError(e)}},i,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new SYe;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const i=e.split(`
`);let s=[];for(let u=0,d=i.length;u<d;u++){const p=i[u].trimStart();if(p.length===0)continue;const g=p.charAt(0);if(g!=="#")if(g==="v"){const x=p.split(g8);switch(x[0]){case"v":t.vertices.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])),x.length>=7?(m_.setRGB(parseFloat(x[4]),parseFloat(x[5]),parseFloat(x[6]),Z.SRGBColorSpace),t.colors.push(m_.r,m_.g,m_.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));break;case"vt":t.uvs.push(parseFloat(x[1]),parseFloat(x[2]))}}else if(g==="f"){const x=p.slice(1).trim().split(g8),b=[];for(let S=0,M=x.length;S<M;S++){const R=x[S];if(R.length>0){const P=R.split("/");b.push(P)}}const E=b[0];for(let S=1,M=b.length-1;S<M;S++){const R=b[S],P=b[S+1];t.addFace(E[0],R[0],P[0],E[1],R[1],P[1],E[2],R[2],P[2])}}else if(g==="l"){const x=p.substring(1).trim().split(" ");let b=[];const E=[];if(p.indexOf("/")===-1)b=x;else for(let S=0,M=x.length;S<M;S++){const R=x[S].split("/");R[0]!==""&&b.push(R[0]),R[1]!==""&&E.push(R[1])}t.addLineGeometry(b,E)}else if(g==="p"){const x=p.slice(1).trim().split(" ");t.addPointGeometry(x)}else if((s=CYe.exec(p))!==null){const x=(" "+s[0].slice(1).trim()).slice(1);t.startObject(x)}else if(_Ye.test(p))t.object.startMaterial(p.substring(7).trim(),t.materialLibraries);else if(EYe.test(p))t.materialLibraries.push(p.substring(7).trim());else if(IYe.test(p))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(g==="s"){if(s=p.split(" "),s.length>1){const b=s[1].trim().toLowerCase();t.object.smooth=b!=="0"&&b!=="off"}else t.object.smooth=!0;const x=t.object.currentMaterial();x&&(x.smooth=t.object.smooth)}else{if(p==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+p+'"')}}t.finalize();const l=new Z.Group;if(l.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let u=0,d=t.objects.length;u<d;u++){const p=t.objects[u],g=p.geometry,x=p.materials,b=g.type==="Line",E=g.type==="Points";let S=!1;if(g.vertices.length===0)continue;const M=new Z.BufferGeometry;M.setAttribute("position",new Z.Float32BufferAttribute(g.vertices,3)),g.normals.length>0&&M.setAttribute("normal",new Z.Float32BufferAttribute(g.normals,3)),g.colors.length>0&&(S=!0,M.setAttribute("color",new Z.Float32BufferAttribute(g.colors,3))),g.hasUVIndices===!0&&M.setAttribute("uv",new Z.Float32BufferAttribute(g.uvs,2));const R=[];for(let k=0,F=x.length;k<F;k++){const V=x[k],G=V.name+"_"+V.smooth+"_"+S;let q=t.materials[G];if(this.materials!==null)if(q=this.materials.create(V.name),!b||!q||q instanceof Z.LineBasicMaterial){if(E&&q&&!(q instanceof Z.PointsMaterial)){const ne=new Z.PointsMaterial({size:10,sizeAttenuation:!1});Z.Material.prototype.copy.call(ne,q),ne.color.copy(q.color),ne.map=q.map,q=ne}}else{const ne=new Z.LineBasicMaterial;Z.Material.prototype.copy.call(ne,q),ne.color.copy(q.color),q=ne}q===void 0&&(q=b?new Z.LineBasicMaterial:E?new Z.PointsMaterial({size:1,sizeAttenuation:!1}):new Z.MeshPhongMaterial,q.name=V.name,q.flatShading=!V.smooth,q.vertexColors=S,t.materials[G]=q),R.push(q)}let P;if(R.length>1){for(let k=0,F=x.length;k<F;k++){const V=x[k];M.addGroup(V.groupStart,V.groupCount,k)}P=b?new Z.LineSegments(M,R):E?new Z.Points(M,R):new Z.Mesh(M,R)}else P=b?new Z.LineSegments(M,R[0]):E?new Z.Points(M,R[0]):new Z.Mesh(M,R[0]);P.name=p.name,l.add(P)}else if(t.vertices.length>0){const u=new Z.PointsMaterial({size:1,sizeAttenuation:!1}),d=new Z.BufferGeometry;d.setAttribute("position",new Z.Float32BufferAttribute(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(d.setAttribute("color",new Z.Float32BufferAttribute(t.colors,3)),u.vertexColors=!0);const p=new Z.Points(d,u);l.add(p)}return l}}class Ase extends Z.Loader{constructor(e){super(e)}load(e,t,i,s){const l=this,u=this.path===""?Z.LoaderUtils.extractUrlBase(e):this.path,d=new Z.FileLoader(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(p){try{t(l.parse(p,u))}catch(g){s?s(g):console.error(g),l.manager.itemError(e)}},i,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const i=e.split(`
`);let s={};const l=/\s+/,u={};for(let p=0;p<i.length;p++){let g=i[p];if(g=g.trim(),g.length===0||g.charAt(0)==="#")continue;const x=g.indexOf(" ");let b=x>=0?g.substring(0,x):g;b=b.toLowerCase();let E=x>=0?g.substring(x+1):"";if(E=E.trim(),b==="newmtl")s={name:E},u[E]=s;else if(b==="ka"||b==="kd"||b==="ks"||b==="ke"){const S=E.split(l,3);s[b]=[parseFloat(S[0]),parseFloat(S[1]),parseFloat(S[2])]}else s[b]=E}const d=new TYe(this.resourcePath||t,this.materialOptions);return d.setCrossOrigin(this.crossOrigin),d.setManager(this.manager),d.setMaterials(u),d}}class TYe{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Z.FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:Z.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const i in e){const s=e[i],l={};t[i]=l;for(const u in s){let d=!0,p=s[u];const g=u.toLowerCase();switch(g){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(p=[p[0]/255,p[1]/255,p[2]/255]),this.options&&this.options.ignoreZeroRGBs&&p[0]===0&&p[1]===0&&p[2]===0&&(d=!1)}d&&(l[g]=p)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,i=this.materialsInfo[e],s={name:e,side:this.side};function l(u,d){if(s[u])return;const p=t.getTextureParams(d,s),g=t.loadTexture((x=t.baseUrl,typeof(b=p.url)!="string"||b===""?"":/^https?:\/\//i.test(b)?b:x+b));var x,b;g.repeat.copy(p.scale),g.offset.copy(p.offset),g.wrapS=t.wrap,g.wrapT=t.wrap,u!=="map"&&u!=="emissiveMap"||(g.colorSpace=Z.SRGBColorSpace),s[u]=g}for(const u in i){const d=i[u];let p;if(d!=="")switch(u.toLowerCase()){case"kd":s.color=Z.ColorManagement.toWorkingColorSpace(new Z.Color().fromArray(d),Z.SRGBColorSpace);break;case"ks":s.specular=Z.ColorManagement.toWorkingColorSpace(new Z.Color().fromArray(d),Z.SRGBColorSpace);break;case"ke":s.emissive=Z.ColorManagement.toWorkingColorSpace(new Z.Color().fromArray(d),Z.SRGBColorSpace);break;case"map_kd":l("map",d);break;case"map_ks":l("specularMap",d);break;case"map_ke":l("emissiveMap",d);break;case"norm":l("normalMap",d);break;case"map_bump":case"bump":l("bumpMap",d);break;case"map_d":l("alphaMap",d),s.transparent=!0;break;case"ns":s.shininess=parseFloat(d);break;case"d":p=parseFloat(d),p<1&&(s.opacity=p,s.transparent=!0);break;case"tr":p=parseFloat(d),this.options&&this.options.invertTrProperty&&(p=1-p),p>0&&(s.opacity=1-p,s.transparent=!0)}}return this.materials[e]=new Z.MeshPhongMaterial(s),this.materials[e]}getTextureParams(e,t){const i={scale:new Z.Vector2(1,1),offset:new Z.Vector2(0,0)},s=e.split(/\s+/);let l;return l=s.indexOf("-bm"),l>=0&&(t.bumpScale=parseFloat(s[l+1]),s.splice(l,2)),l=s.indexOf("-s"),l>=0&&(i.scale.set(parseFloat(s[l+1]),parseFloat(s[l+2])),s.splice(l,4)),l=s.indexOf("-o"),l>=0&&(i.offset.set(parseFloat(s[l+1]),parseFloat(s[l+2])),s.splice(l,4)),i.url=s.join(" ").trim(),i}loadTexture(e,t,i,s,l){const u=this.manager!==void 0?this.manager:Z.DefaultLoadingManager;let d=u.getHandler(e);d===null&&(d=new Z.TextureLoader(u)),d.setCrossOrigin&&d.setCrossOrigin(this.crossOrigin);const p=d.load(e,i,s,l);return t!==void 0&&(p.mapping=t),p}}class vse{static fromCubeTexture(e){let t=0;const i=new Z.Vector3,s=new Z.Vector3,l=new Z.Color,u=[0,0,0,0,0,0,0,0,0],d=new Z.SphericalHarmonics3,p=d.coefficients;for(let x=0;x<6;x++){const b=e.image[x],E=b.width,S=b.height,M=document.createElement("canvas");M.width=E,M.height=S;const R=M.getContext("2d");R.drawImage(b,0,0,E,S);const P=R.getImageData(0,0,E,S),k=P.data,F=P.width,V=2/F;for(let G=0,q=k.length;G<q;G+=4){l.setRGB(k[G]/255,k[G+1]/255,k[G+2]/255),b8(l,e.colorSpace);const ne=G/4,K=(ne%F+.5)*V-1,Q=1-(Math.floor(ne/F)+.5)*V;switch(x){case 0:i.set(-1,Q,-K);break;case 1:i.set(1,Q,K);break;case 2:i.set(-K,1,-Q);break;case 3:i.set(-K,-1,Q);break;case 4:i.set(-K,Q,1);break;case 5:i.set(K,Q,-1)}const H=i.lengthSq(),j=4/(Math.sqrt(H)*H);t+=j,s.copy(i).normalize(),Z.SphericalHarmonics3.getBasisAt(s,u);for(let ee=0;ee<9;ee++)p[ee].x+=u[ee]*l.r*j,p[ee].y+=u[ee]*l.g*j,p[ee].z+=u[ee]*l.b*j}}const g=4*Math.PI/t;for(let x=0;x<9;x++)p[x].x*=g,p[x].y*=g,p[x].z*=g;return new Z.LightProbe(d)}static async fromCubeRenderTarget(e,t){const i=e.coordinateSystem===Z.WebGLCoordinateSystem?-1:1;let s=0;const l=new Z.Vector3,u=new Z.Vector3,d=new Z.Color,p=[0,0,0,0,0,0,0,0,0],g=new Z.SphericalHarmonics3,x=g.coefficients,b=t.texture.type,E=t.width;let S;e.isWebGLRenderer&&(S=b===Z.HalfFloatType?new Uint16Array(E*E*4):new Uint8Array(E*E*4));for(let R=0;R<6;R++){e.isWebGLRenderer?await e.readRenderTargetPixelsAsync(t,0,0,E,E,S,R):S=await e.readRenderTargetPixelsAsync(t,0,0,E,E,0,R);const P=2/E;for(let k=0,F=S.length;k<F;k+=4){let V,G,q;b===Z.HalfFloatType?(V=Z.DataUtils.fromHalfFloat(S[k]),G=Z.DataUtils.fromHalfFloat(S[k+1]),q=Z.DataUtils.fromHalfFloat(S[k+2])):(V=S[k]/255,G=S[k+1]/255,q=S[k+2]/255),d.setRGB(V,G,q),b8(d,t.texture.colorSpace);const ne=k/4,K=(1-(ne%E+.5)*P)*i,Q=1-(Math.floor(ne/E)+.5)*P;switch(R){case 0:l.set(-1*i,Q,K*i);break;case 1:l.set(1*i,Q,-K*i);break;case 2:l.set(K,1,-Q);break;case 3:l.set(K,-1,Q);break;case 4:l.set(K,Q,1);break;case 5:l.set(-K,Q,-1)}const H=l.lengthSq(),j=4/(Math.sqrt(H)*H);s+=j,u.copy(l).normalize(),Z.SphericalHarmonics3.getBasisAt(u,p);for(let ee=0;ee<9;ee++)x[ee].x+=p[ee]*d.r*j,x[ee].y+=p[ee]*d.g*j,x[ee].z+=p[ee]*d.b*j}}const M=4*Math.PI/s;for(let R=0;R<9;R++)x[R].x*=M,x[R].y*=M,x[R].z*=M;return new Z.LightProbe(g)}}function b8(n,e){switch(e){case Z.SRGBColorSpace:n.convertSRGBToLinear();break;case Z.LinearSRGBColorSpace:case Z.NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.")}return n}var bse=function(n){var e=this;this.object=n,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;var t,i,s,l,u=function(g){e.deviceOrientation=g},d=function(){e.screenOrientation=window.orientation||0},p=(t=new THREE.Vector3(0,0,1),i=new THREE.Euler,s=new THREE.Quaternion,l=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),function(g,x,b,E,S){i.set(b,x,-E,"YXZ"),g.setFromEuler(i),g.multiply(l),g.multiply(s.setFromAxisAngle(t,-S))});this.connect=function(){d(),window.addEventListener("orientationchange",d,!1),window.addEventListener("deviceorientation",u,!1),e.enabled=!0},this.disconnect=function(){window.removeEventListener("orientationchange",d,!1),window.removeEventListener("deviceorientation",u,!1),e.enabled=!1},this.update=function(){if(e.enabled!==!1){var g=e.deviceOrientation;if(g){var x=g.alpha?THREE.MathUtils.degToRad(g.alpha)+e.alphaOffset:0,b=g.beta?THREE.MathUtils.degToRad(g.beta):0,E=g.gamma?THREE.MathUtils.degToRad(g.gamma):0,S=e.screenOrientation?THREE.MathUtils.degToRad(e.screenOrientation):0;p(e.object.quaternion,x,b,E,S)}}},this.dispose=function(){e.disconnect()},this.connect()},Qc=globalThis.THREE={...Z};Qc.DRACOLoader=ese,Qc.GLTFLoader=XV,Qc.KTX2Loader=Il,Qc.OBJLoader=yse,Qc.MTLLoader=Ase,Qc.OBB=uS,Qc.BufferGeometryUtils=o3,Qc.LightProbeGenerator=vse,Qc.DeviceOrientationControls=bse,Qc.Cache.enabled=!0;const xse=Qc;var as=window.AFRAME_CDN_ROOT||"https://cdn.aframe.io/",vo="aframe-injected",MYe=Pn(8878),P1=Pn.n(MYe),x8={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}};P1().formatArgs=function(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" "),this.useColors){var e;this.color=(e=function(l){var u=l.split(":");return u[u.length-1]}(this.namespace),x8.colors&&x8.colors[e]||null);var t="color: "+this.color;n.splice(1,0,t,"color: inherit");var i=0,s=0;n[0].replace(/%[a-zA-Z%]/g,function(l){l!=="%%"&&(i++,l==="%c"&&(s=i))}),n.splice(s,0,t)}};var vP=function(){try{return window.localStorage}catch{}}();vP&&(parseInt(vP.logs,10)||vP.logs==="true")?P1().enable("*"):P1().enable("*:error,*:info,*:warn");const Ki=P1();var kYe=Pn(1124),RYe=Pn.n(kYe),w8=Ki("device:error"),hS=!1,dS=!1,iM=navigator.xr!==void 0;if(iM){var Ey=function(){var n=document.querySelector("a-scene");n?n.hasLoaded?n.components["xr-mode-ui"].updateEnterInterfaces():n.addEventListener("loaded",Ey):window.addEventListener("DOMContentLoaded",Ey)},C8=function(n){w8("WebXR session support error: "+n.message)};navigator.xr.isSessionSupported?(navigator.xr.isSessionSupported("immersive-vr").then(function(n){hS=n,Ey()}).catch(C8),navigator.xr.isSessionSupported("immersive-ar").then(function(n){dS=n,Ey()}).catch(function(){})):navigator.xr.supportsSession?(navigator.xr.supportsSession("immersive-vr").then(function(){hS=!0,Ey()}).catch(C8),navigator.xr.supportsSession("immersive-ar").then(function(){dS=!0,Ey()}).catch(function(){})):w8("WebXR has neither isSessionSupported or supportsSession?!")}function QV(){return hS||dS}function KV(){return dS}function S3(){return hS}var Fb,bP,Xp=(Fb=!1,bP=window.navigator.userAgent||window.navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(bP)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(bP.substr(0,4)))&&(Fb=!0),(mw()||wse()||qV())&&(Fb=!0),YV()&&(Fb=!1),function(){return Fb});function wse(n){var e=n||window.navigator.userAgent;return/Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(e)||Cse()}function Cse(n,e,t){var i=n||window.navigator.userAgent,s=e||window.navigator.platform,l=t||window.navigator.maxTouchPoints||0;return(s==="iPad"||s==="MacIntel")&&l>0&&/Macintosh|Intel|iPad|ipad/i.test(i)&&!window.MSStream}function Ese(){var n=navigator.userAgent.includes("Macintosh"),e=navigator.maxTouchPoints===5;return n&&e&&iM}function mw(){return/iPad|iPhone|iPod/.test(window.navigator.platform)}function ZV(){return!Xp()&&!YV()&&window.orientation!==void 0}function jV(){return/(OculusBrowser)/i.test(window.navigator.userAgent)}function _se(){return/(Mobile VR)/i.test(window.navigator.userAgent)}function YV(){return jV()||_se()||Ese()}function qV(){return/R7 Build/.test(window.navigator.userAgent)}function Ise(){var n=window.orientation;return qV()&&(n+=90),n===90||n===-90}var JV=typeof process>"u"||process.browser===!0,LYe=!JV,BYe=Object.freeze(Object.create(null));function PYe(){return{}}function eU(n){var e=[],t=null;function i(s){var l,u;if((s=s===void 0?e.length:s)>0&&t==null&&(t=0),s>0)for(l=e.length,e.length+=Number(s),u=l;u<e.length;u++)e[u]=n();return e.length}return n=n||PYe,{grow:i,pool:e,recycle:function(s){s instanceof Object&&(t!==null&&t!==-1?e[--t]=s:e[e.length]=s)},size:function(){return e.length},use:function(){var s;return t!==null&&t!==e.length||i(e.length||5),s=e[t],e[t++]=BYe,tU(s),s}}}function tU(n){var e;if(n&&n.constructor===Object)for(e in n)n[e]=void 0}function N1(n,e){var t;if(n&&n.constructor===Object)for(t in n)t in e||delete n[t]}var NYe=Ki("utils:coordinates:warn"),E8=["x","y","z","w"],Sse=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/,DYe=/\s+/g;function fS(n,e,t){var i,s,l,u,d,p,g,x,b=t&&typeof t=="object"?t:{};if(n&&n instanceof Object)return d=n.x===void 0?e&&e.x:n.x,p=n.y===void 0?e&&e.y:n.y,g=n.z===void 0?e&&e.z:n.z,x=n.w===void 0?e&&e.w:n.w,d!=null&&(b.x=Ob(d)),p!=null&&(b.y=Ob(p)),g!=null&&(b.z=Ob(g)),x!=null&&(b.w=Ob(x)),b;if(n==null)return typeof e=="object"?Object.assign(b,e):e;for(i=n.trim().split(DYe),u=0;u<E8.length;u++)if(l=E8[u],i[u])b[l]=parseFloat(i[u],10);else{if((s=e&&e[l])===void 0)continue;b[l]=Ob(s)}return b}function mI(n){var e;return typeof n!="object"?n:(e=n.x+" "+n.y,n.z!=null&&(e+=" "+n.z),n.w!=null&&(e+=" "+n.w),e)}function gI(n,e){return typeof n!="object"||typeof e!="object"?n===e:n.x===e.x&&n.y===e.y&&n.z===e.z&&n.w===e.w}function Tse(n){return Sse.test(n)}function FYe(n){return NYe("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`"),Tse(n)}function Ob(n){return n!=null&&n.constructor===String?parseFloat(n,10):n}function OYe(n){return new Z.Vector3(n.x,n.y,n.z)}var Rd=function(){var n={};return function(e,t){return t in n||(n[t]={}),e in n[t]||(n[t][e]=e.split(t)),n[t][e]}}();function rM(n,e){var t=Rd(n,e=e||".");return t.length===1?t[0]:t}function Mse(n,e,t){var i;return t=t||".",e.indexOf(t)!==-1?(i=rM(e,t)).constructor===String?n.getAttribute(i):n.getAttribute(i[0])[i[1]]:n.getAttribute(e)}function nU(n,e,t,i){var s;i=i||".",e.indexOf(i)===-1?n.setAttribute(e,t):(s=rM(e,i)).constructor===String?n.setAttribute(s,t):n.setAttribute(s[0],s[1],t)}function kse(n){var e=n.style.width,t=n.style.height;n.style.width=parseInt(e,10)+1+"px",n.style.height=parseInt(t,10)+1+"px",setTimeout(function(){n.style.width=e,n.style.height=t},200)}var yI=Ki("utils:src-loader:warn");function pS(n,e,t){(function(i,s){var l;i.tagName?s(i.tagName==="IMG"):((l=new XMLHttpRequest).open("HEAD",i),l.addEventListener("load",function(u){var d;l.status>=200&&l.status<300?(d=l.getResponseHeader("Content-Type"))==null?_8(i,s):d.startsWith("image")?s(!0):s(!1):_8(i,s),l.abort()}),l.send())})(n,function(i){i?e(n):t(n)})}function iU(n,e,t){var i,s,l,u="",d=[];if(typeof n=="string"){let p=function(g){d.push(g),d.length===6&&e(d)};for(s=0;s<5;s++)u+="(url\\((?:[^\\)]+)\\),\\s*)";if(u+="(url\\((?:[^\\)]+)\\)\\s*)",l=n.match(new RegExp(u))){for(s=1;s<7;s++)pS(T3(l[s]),p);return}if(!n.startsWith("#"))return void pS(T3(n)||n,t)}if(i=n.tagName?n:function(p){try{var g=document.querySelector(p);return g||yI('No element was found matching the selector: "%s"',p),g}catch{return void yI('"%s" is not a valid selector',p)}}(n))return i.tagName==="A-CUBEMAP"&&i.srcs?e(i.srcs):i.tagName==="IMG"?t(i):void yI('Selector "%s" does not point to <a-cubemap> or <img>',n)}function Rse(n,e){return iU(n,e,function(){yI("Expected cubemap but got image")})}function T3(n){var e=n.match(/url\((.+)\)/);if(e)return e[1]}function _8(n,e){var t=new Image;t.addEventListener("load",function(){e(!0)}),t.addEventListener("error",function(){e(!1)}),t.src=n}var VYe=Ki("utils:material:warn"),UYe=new Set(["emissiveMap","envMap","map","specularMap"]);function mS(n,e){var t=e.offset||{x:0,y:0},i=e.repeat||{x:1,y:1},s=e.npot||!1,l=e.anisotropy||Z.Texture.DEFAULT_ANISOTROPY,u=n.wrapS,d=n.wrapT,p=n.magFilter,g=n.minFilter;s&&(u=Z.ClampToEdgeWrapping,d=Z.ClampToEdgeWrapping,p=Z.LinearFilter,g=Z.LinearFilter),i.x===1&&i.y===1||(u=Z.RepeatWrapping,d=Z.RepeatWrapping),n.offset.set(t.x,t.y),n.repeat.set(i.x,i.y),n.wrapS===u&&n.wrapT===d&&n.magFilter===p&&n.minFilter===g&&n.anisotropy===l||(n.wrapS=u,n.wrapT=d,n.magFilter=p,n.minFilter=g,n.anisotropy=l,n.needsUpdate=!0)}function sM(n,e,t,i){var s=t.el,l=t.material,u=s.sceneEl.systems.renderer,d=i[e];if(t.materialSrcs||(t.materialSrcs={}),!d)return delete t.materialSrcs[n],void p(null);function p(g){l[n]!==g&&(l[n]&&l[n].dispose(),l[n]=g,l.needsUpdate=!0,rU(s,g))}d===t.materialSrcs[n]&&l[n]?mS(l[n],i):(t.materialSrcs[n]=d,d instanceof Z.Texture?p(d):s.sceneEl.systems.material.loadTextureSource(d,function(g){if(t.materialSrcs[n]===d){var x=l[n];!x||g!==null&&Lse(x,g)||(x=null),!x&&g&&(x=sU(g)),x&&(x.source!==g&&(x.source=g,x.needsUpdate=!0),UYe.has(n)&&u.applyColorCorrection(x),mS(x,i)),p(x)}}))}function AI(n,e){return sM("map","src",n,e)}function Zu(n,e,t){var i=n;n==="ambientOcclusion"&&(i="ao");var s={};return s.src=t[n+"Map"],s.offset=t[n+"TextureOffset"],s.repeat=t[n+"TextureRepeat"],s.wrap=t[n+"TextureWrap"],sM(i+"Map","src",e,s)}var xP={};function M3(n,e){var t=n.material,i=n.el,s="envMap",l=e.envMap,u=e.sphericalEnvMap,d=e.refract;if(u&&(l=u,VYe("`sphericalEnvMap` property is deprecated, using spherical map as equirectangular map instead. Use `envMap` property with a CubeMap or Equirectangular image instead.")),n.materialSrcs||(n.materialSrcs={}),!l)return delete n.materialSrcs[s],t.envMap=null,void(t.needsUpdate=!0);function p(g){n.materialSrcs[s]===l&&(t.envMap=g,t.needsUpdate=!0,rU(i,g))}n.materialSrcs[s]=l,xP[l]?xP[l].then(p):xP[l]=new Promise(function(g){iU(l,function(x){i.sceneEl.systems.material.loadCubeMapTexture(x,function(b){b.mapping=d?Z.CubeRefractionMapping:Z.CubeReflectionMapping,p(b),g(b)})},function(x){i.sceneEl.systems.material.loadTexture(x,{src:x},function(b){b.mapping=d?Z.EquirectangularRefractionMapping:Z.EquirectangularReflectionMapping,p(b),g(b)})})})}function rU(n,e){function t(){n.emit("materialvideoloadeddata",{src:e.image,texture:e})}function i(){n.emit("materialvideoended",{src:e.image,texture:e})}e&&(n.emit("materialtextureloaded",{src:e.image,texture:e}),e.image&&e.image.tagName==="VIDEO"&&(e.image.addEventListener("loadeddata",t),e.image.addEventListener("ended",i),e.addEventListener("dispose",function(){e.image.removeEventListener("loadeddata",t),e.image.removeEventListener("ended",i)})))}function Lse(n,e){return n.source===e&&(e.data instanceof HTMLCanvasElement?n.isCanvasTexture:e.data instanceof HTMLVideoElement?n.isVideoTexture:n.isTexture&&!n.isCanvasTexture&&!n.isVideoTexture)}function sU(n){var e;return(e=n.data instanceof HTMLCanvasElement?new Z.CanvasTexture:n.data instanceof HTMLVideoElement?new Z.VideoTexture(n.data):new Z.Texture).source=n,e.needsUpdate=!0,e}var zYe=/-([a-z])/g;function D1(n,e){var t;return typeof n!="string"?n:(t=function(i,s){var l,u,d,p,g,x;for(s=s||{},l=WYe(i),u=0;u<l.length;u++)(d=l[u])&&(p=d.indexOf(":"),g=d.substr(0,p).trim(),x=d.substr(p+1).trim(),s[Bse(g)]=x);return s}(n,e),t[""]?n:t)}function GYe(n){return typeof n=="string"?n:function(e){var t,i=0,s=0,l="";for(t in e)i++;for(t in e)l+=t+": "+e[t],s<i-1&&(l+="; "),s++;return l}(n)}function Bse(n){return n.replace(zYe,HYe)}var g_,I8,WYe=(g_=[],I8=/url\([^)]+$/,function(n){var e,t="",i=0;for(g_.length=0;i<n.length;)(e=n.indexOf(";",i))===-1&&(e=n.length),t+=n.substring(i,e),I8.test(t)?(t+=";",i=e+1):(g_.push(t.trim()),t="",i=e+1);return g_});function HYe(n){return n[1].toUpperCase()}var XYe=["x","y","z","w"];function Nl(n,e,t){var i,s,l=n.el;if((s=!!(i=Pse(n,e,t)))===n.controllerPresent)return s;n.controllerPresent=s,s?(n.addEventListeners(),n.injectTrackedControls(i),l.emit("controllerconnected",{name:n.name,component:n})):(n.removeEventListeners(),l.emit("controllerdisconnected",{name:n.name,component:n}))}function Pse(n,e,t){var i,s=n.el.sceneEl,l=s&&s.systems["tracked-controls"];return!!l&&!(!(i=l.controllers)||!i.length)&&oU(i,e,t.hand,t.index,t.iterateControllerProfiles,t.handTracking)}function oU(n,e,t,i,s,l){var u,d,p,g,x=!1;for(u=0;u<n.length;u++){if(g=(p=n[u]).profiles,l)x=p.hand;else if(s)for(d=0;d<g.length&&!(x=g[d].startsWith(e));d++);else x=g.length>0&&g[0].startsWith(e);if(x){if(p.handedness==="right"||p.handedness==="left"){if(p.handedness===t)return n[u]}else if(u===i)return n[u]}}}function gc(n,e,t){var i,s,l,u,d;for(s in e){for(i=e[s],l=!1,d=0;d<i.length;d++)t.detail.changed[i[d]]&&(l=!0);if(l){for(u={},d=0;d<i.length;d++)u[XYe[d]]=t.detail.axis[i[d]];n.el.emit(s+"moved",u)}}}function ri(n,e,t,i){var s=(i?t.mapping[i]:t.mapping).buttons[n];t.el.emit(s+e),t.updateModel&&t.updateModel(s,e)}var aU=Ki("utils:warn");function $Ye(n){return n.bind.apply(n,Array.prototype.slice.call(arguments,1))}function QYe(){return aU("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`"),QV()}function KYe(){return aU("`utils.isIOS` has moved to `utils.device.isIOS`"),mw()}function ZYe(){return aU("`utils.isMobile has moved to `utils.device.isMobile`"),Xp(arguments)}function jYe(n,e,t){var i;return t&&(n=n.bind(t)),function(){var s=Date.now();(i===void 0||(i===void 0?e:s-i)>=e)&&(i=s,n.apply(null,arguments))}}function Nse(n,e,t){var i,s,l;t&&(n=n.bind(t));var u=function(){i=Date.now(),n.apply(this,l),s=void 0};return function(){var d=Date.now(),p=i===void 0?e:d-i;p>=e?(clearTimeout(s),s=void 0,i=d,n.apply(null,arguments)):(s=s||setTimeout(u,e-p),l=arguments)}}function YYe(n,e,t){var i;return t&&(n=n.bind(t)),function(s,l){var u=i===void 0?l:s-i;(i===void 0||u>=e)&&(i=s,n(s,u))}}function Dse(n,e,t){var i;return function(){var s=this,l=arguments,u=t&&!i;clearTimeout(i),i=setTimeout(function(){i=null,t||n.apply(s,l)},e),u&&n.apply(s,l)}}var Ja=Object.assign,_l=RYe();function lU(n){return JSON.parse(JSON.stringify(n))}var $c,og,cU=($c=eU(function(){return[]}),function(n,e){var t,i,s,l,u,d;if(n===void 0||e===void 0||n===null||e===null||!(n&&e&&n.constructor===Object&&e.constructor===Object||n.constructor===Array&&e.constructor===Array))return n===e;for(t in i=$c.use(),s=$c.use(),i.length=0,s.length=0,n)i.push(t);for(t in e)s.push(t);if(i.length!==s.length)return $c.recycle(i),$c.recycle(s),!1;for(l=0;l<i.length;++l)if(u=n[i[l]],d=e[i[l]],typeof u=="object"||typeof d=="object"||Array.isArray(u)&&Array.isArray(d)){if(u===d)continue;if(!cU(u,d))return $c.recycle(i),$c.recycle(s),!1}else if(u!==d)return $c.recycle(i),$c.recycle(s),!1;return $c.recycle(i),$c.recycle(s),!0}),Fse=(og=[],function(n,e,t){var i,s,l,u,d,p,g;for(d in u=t||{},og.length=0,n)og.push(d);if(!e)return u;for(l in e)og.indexOf(l)===-1&&og.push(l);for(p=0;p<og.length;p++)i=n[d=og[p]],s=e[d],((g=i&&s&&i.constructor===Object&&s.constructor===Object)&&!cU(i,s)||!g&&i!==s)&&(u[d]=s);return u});function uU(n){return!n.metaKey&&document.activeElement===document.body}function qYe(n,e){e===void 0&&(e=" ");var t=new RegExp(e,"g");return(n=(n||"").replace(t,e)).split(e)}function JYe(n,e){e=e||{};var t={};return Object.keys(e).forEach(function(i){n.hasAttribute(i)&&(t[i]=n.getAttribute(i))}),t}function F1(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(location.search);return e===null?"":decodeURIComponent(e[1].replace(/\+/g," "))}function Ose(){return window.top!==window.self}function Vse(n){for(var e=[],t=n.getElementsByTagName("*"),i=0,s=t.length;i<s;i++)t[i].isScene&&e.push(t[i]);return e}var wP,eqe=[Nx({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui,viewport-fit=cover"}),Nx({name:"mobile-web-app-capable",content:"yes"}),Nx({name:"theme-color",content:"black"})],tqe=[Nx({name:"apple-mobile-web-app-capable",content:"yes"}),Nx({name:"apple-mobile-web-app-status-bar-style",content:"black"}),(wP={rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"},{tagName:"link",attributes:wP,exists:function(){return document.querySelector('link[rel="'+wP.rel+'"]')}})];function Nx(n){return{tagName:"meta",attributes:n,exists:function(){return document.querySelector('meta[name="'+n.name+'"]')}}}var qc,Wf,Use,nqe=Pn(5928),iqe=Pn.n(nqe),rqe=GA,S8="loading-screen";function CP(n){var e=qc.hasAttribute("embedded"),t=Use(qc.canvas,e,qc.maxCanvasSize,qc.is("vr-mode"));n.aspect=t.width/t.height,n.updateProjectionMatrix(),qc.renderer.setSize(t.width,t.height,!1)}const Og=[];var zse=P1()("core:propertyTypes:warn"),k3={},sqe=/[,> .[\]:]/,oqe=/url\((.+)\)/;function mo(n,e,t,i,s,l){if(n in k3)throw new Error("Property type "+n+" is already registered.");k3[n]={default:e,parse:t||aqe,stringify:i||gS,equals:s||Gse,isCacheable:l!==!1}}function T8(n,e){if(!Array.isArray(n)||!Array.isArray(e))return n===e;if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Vb(n){var e,t;return typeof n!="string"?n:(t=n.match(oqe))?t[1]:n.charAt(0)==="#"?(e=document.getElementById(n.substring(1)))?e.tagName==="CANVAS"||e.tagName==="VIDEO"||e.tagName==="IMG"?e:e.getAttribute("src"):void zse('"'+n+'" asset not found.'):n}function Ub(n){return n.getAttribute?n.getAttribute("id")?"#"+n.getAttribute("id"):n.getAttribute("src"):gS(n)}function aqe(n){return n}function gS(n){return n===null?"null":n.toString()}function Gse(n,e){return n===e}function M8(n){return parseInt(n,10)}function EP(n,e,t){return fS(n,e,t)}function _P(n,e){if(n===null)return!0;if(typeof n!="object"||Object.keys(n).length!==e)return!1;var t=n.x,i=n.y,s=n.z,l=n.w;return!(typeof t!="number"||typeof i!="number"||e>2&&typeof s!="number"||e>3&&typeof l!="number")}mo("audio","",Vb,Ub),mo("array",[],function(n){return Array.isArray(n)?n:n&&typeof n=="string"?n.split(",").map(function(e){return e.trim()}):[]},function(n){return n.join(", ")},T8),mo("asset","",Vb,Ub),mo("boolean",!1,function(n){return n!=="false"&&n!==!1}),mo("color","#FFF"),mo("int",0,M8),mo("number",0,function(n){return parseFloat(n,10)}),mo("map","",Vb,Ub),mo("model","",Vb,Ub),mo("selector",null,function(n){return n?typeof n!="string"?n:n[0]!=="#"||sqe.test(n)?document.querySelector(n):document.getElementById(n.substring(1)):null},function(n){return n.getAttribute?"#"+n.getAttribute("id"):gS(n)},Gse,!1),mo("selectorAll",null,function(n){return n?typeof n!="string"?n:Array.prototype.slice.call(document.querySelectorAll(n),0):null},function(n){return n instanceof Array?n.map(function(e){return"#"+e.getAttribute("id")}).join(", "):gS(n)},T8,!1),mo("src","",function(n){return zse("`src` property type is deprecated. Use `asset` instead."),Vb(n)},Ub),mo("string",""),mo("time",0,M8),mo("vec2",{x:0,y:0},EP,mI,gI),mo("vec3",{x:0,y:0,z:0},EP,mI,gI),mo("vec4",{x:0,y:0,z:0,w:1},EP,mI,gI);var lqe=function(n,e){return(n!=="audio"||typeof e=="string")&&!(n==="array"&&!Array.isArray(e))&&(n!=="asset"||typeof e=="string")&&(n!=="boolean"||typeof e=="boolean")&&(n!=="color"||typeof e=="string")&&(n!=="int"||typeof e=="number")&&(n!=="number"||typeof e=="number")&&(n!=="map"||typeof e=="string")&&(n!=="model"||typeof e=="string")&&(n!=="selector"||typeof e=="string"||e===null)&&(n!=="selectorAll"||typeof e=="string"||e===null)&&(n!=="src"||typeof e=="string")&&(n!=="string"||typeof e=="string")&&(n!=="time"||typeof e=="number")&&(n==="vec2"?_P(e,2):n==="vec3"?_P(e,3):n!=="vec4"||_P(e,4))},cqe=k3,yS=Ki("core:schema:warn");function oM(n){return"type"in n?typeof n.type=="string":"default"in n}function gw(n,e){var t;if(oM(n))return R3(n,e);for(t in n)n[t]=R3(n[t],e);return n}function R3(n,e){var t,i,s=n.default,l=n.type;return n.type?n.type==="bool"?l="boolean":n.type==="float"&&(l="number"):l=s===void 0||typeof s!="boolean"&&typeof s!="number"?Array.isArray(s)?"array":"string":typeof s,(i=cqe[l])||yS("Unknown property type for component `"+e+"`: "+l),t=!!n.parse,n.parse=n.parse||i.parse,n.stringify=n.stringify||i.stringify,n.equals=n.equals||i.equals,n.isCacheable=n.isCacheable===!0||i.isCacheable,n.type=l,"default"in n?t||lqe(l,s)||yS("Default value `"+s+"` does not match type `"+l+"` in component `"+e+"`"):n.default=i.default,n}var zb,Wse=(zb=[],function(n,e,t,i,s){var l,u,d,p;for(u in zb.length=0,t?n:e)t&&n[u]===void 0||zb.push(u);if(n===null||typeof n!="object")return n;for(u in n)n[u]===void 0||e[u]||s||yS("Unknown property `"+u+"` for component/system `"+i+"`.");for(l=0;l<zb.length;l++){if(d=e[u=zb[l]],p=n[u],!e[u])return;n[u]=aM(p,d)}return n});function aM(n,e,t){return n!=null&&n!==""||(n=e.default,Array.isArray(n)&&(n=n.slice())),e.parse(n,e.default,t)}function Hse(n,e){var t,i,s,l,u={};for(t in n)i=e[t],typeof(l=s=n[t])=="object"&&(l=hU(s,i),i||yS("Unknown component property: "+t)),l!==void 0&&(u[t]=l);return u}function hU(n,e){return typeof n!="object"?n:e&&n!==null?e.stringify(n):JSON.stringify(n)}var ls={},ox=aM,Xse=gw,uqe=oM,hqe=Hse,dqe=hU,IP=GA,Dx=Ki("core:component:warn"),fqe=document.currentScript,pqe=new RegExp("[A-Z]+"),$se={},mqe=Object.freeze({}),_y=[],gqe={get:function(n,e){return n.getComputedPropertyValue(e)},set:function(n,e,t){return e in n.schema?n.recomputeProperty(e,t):t!==void 0&&n.handleUnknownProperty(e,t),!0}},O1=function(n,e,t){var i=this;if(this.sceneOnly&&!n.isScene)throw new Error("Component `"+this.name+"` can only be applied to <a-scene>");if(t&&!this.multiple)throw new Error("Trying to initialize multiple components of type `"+this.name+"`. There can only be one component of this type per entity.");this.el=n,this.id=t,this.attrName=this.name+(t?"__"+t:""),this.evtDetail={id:this.id,name:this.name},this.initialized=!1,this.el.components[this.attrName]=this,this.objectPool=$se[this.name];var s=this.events;this.events={},function(l,u){var d;for(d in u)l.events[d]=u[d].bind(l)}(this,s),this.attrValue=void 0,this.isObjectBased?(this.data=this.objectPool.use(),N1(this.data,this.schema),this.oldData=this.objectPool.use(),N1(this.oldData,this.schema),this.attrValueProxy=new Proxy(this,gqe)):(this.data=void 0,this.oldData=void 0,this.attrValueProxy=void 0),this.deferUnknownPropertyWarnings=!!this.updateSchema,this.throttledEmitComponentChanged=Nse(function(){n.emit("componentchanged",i.evtDetail,!1)},200),this.updateProperties(e,!0)};O1.prototype={schema:{},init:function(){},events:{},update:function(n){},updateSchema:void 0,tick:void 0,tock:void 0,play:function(){},pause:function(){},remove:function(){},stringify:function(n){var e=this.schema;return typeof n=="string"?n:this.isSingleProperty?dqe(n,e):(n=hqe(n,e),IP.stringify(n))},flushToDOM:function(n){var e=n?this.data:this.attrValue;e!=null&&window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(e))},updateProperties:function(n,e){var t=this.el;this.updateData(n,e),(t.hasLoaded||t.isLoading)&&(this.initialized?this.callUpdateHandler():this.initComponent())},initComponent:function(){var n,e=this.el;e.initializingComponents[this.name]||(e.initializingComponents[this.name]=!0,this.init(),this.initialized=!0,delete e.initializingComponents[this.name],n=this.isObjectBased?mqe:void 0,this.dataChanged=!1,this.storeOldData(),this.update(n),e.isPlaying&&this.play(),e.emit("componentinitialized",this.evtDetail,!1))},updateData:function(n,e){this.isSingleProperty?this.recomputeProperty(void 0,n):(e?(tU(this.attrValue),this.recomputeData(n),this.schemaChangeRequired=!!this.updateSchema):typeof n=="string"?IP.parse(n,this.attrValueProxy):Ja(this.attrValueProxy,n),this.updateSchemaIfNeeded(n))},updateSchemaIfNeeded:function(n){if(this.schemaChangeRequired&&this.updateSchema)for(var e in _y.length=0,this.updateSchema(this.data),N1(this.data,this.schema),this.recomputeData(n),this.schemaChangeRequired=!1,this.attrValue)this.attrValue[e]!==void 0&&_y.indexOf(e)===-1&&(e in this.schema||Dx("Unknown property `"+e+"` for component `"+this.name+"`."));for(var t=0;t<_y.length;t++)Dx("Unknown property `"+_y[t]+"` for component `"+this.name+"`.");_y.length=0},callUpdateHandler:function(){if(this.isPositionRotationScale||this.dataChanged){this.dataChanged=!1;var n=this.oldData;this.oldDataInUse=!0,this.update(n),n!==this.oldData&&this.objectPool.recycle(n),this.oldDataInUse=!1,this.storeOldData(),this.throttledEmitComponentChanged()}},handleMixinUpdate:function(){this.recomputeData(),this.updateSchemaIfNeeded(),this.callUpdateHandler()},resetProperty:function(n){(this.isSingleProperty||n in this.schema)&&(n?this.attrValue[n]=void 0:(this.isObjectBased&&this.objectPool.recycle(this.attrValue),this.attrValue=void 0),this.recomputeProperty(n,void 0),this.updateSchemaIfNeeded(),this.callUpdateHandler())},extendSchema:function(n){var e;e=Ja({},ls[this.name].schema),Ja(e,n),this.schema=Xse(e),this.el.emit("schemachanged",this.evtDetail)},getComputedPropertyValue:function(n){var e=this.el.mixinEls,t=this.attrValue&&n?this.attrValue[n]:this.attrValue;if(t!==void 0)return t;for(var i=e.length-1;i>=0;i--){var s=e[i].getAttribute(this.attrName);if(s!==null&&(!n||n in s))return n?s[n]:s}return n?this.schema[n].default:this.schema.default},recomputeProperty:function(n,e){var t=n?this.schema[n]:this.schema;if(e!=null){this.attrValue===void 0&&this.isObjectBased&&(this.attrValue=this.objectPool.use());var i=n?this.attrValue[n]:this.attrValue;typeof(i=t.isCacheable?ox(e,t,i):e)=="string"&&(i=e===""?void 0:e),n?this.attrValue[n]=i:this.attrValue=i}this.oldDataInUse&&(this.oldData=this.objectPool.use(),N1(this.oldData,this.schema),this.storeOldData(),this.oldDataInUse=!1);var s=n?this.oldData[n]:this.oldData,l=n?this.data[n]:this.data,u=ox(this.getComputedPropertyValue(n),t,l);return t.type!=="array"||n||(u=lU(u)),t.equals(u,s)||(this.dataChanged=!0,t.schemaChange&&(this.schemaChangeRequired=!0)),n?this.data[n]=u:this.data=u,u},handleUnknownProperty:function(n,e){this.attrValue===void 0&&(this.attrValue=this.objectPool.use()),this.attrValue[n]=e,this.deferUnknownPropertyWarnings?_y.push(n):this.silenceUnknownPropertyWarnings||Dx("Unknown property `"+n+"` for component `"+this.name+"`.")},storeOldData:function(){var n;if(this.isObjectBased)if(this.isSingleProperty)this.oldData=ox(this.data,this.schema,this.oldData);else for(n in this.schema)this.data[n]!==void 0&&(this.data[n]&&typeof this.data[n]=="object"?this.oldData[n]=ox(this.data[n],this.schema[n],this.oldData[n]):this.oldData[n]=this.data[n]);else this.oldData=this.data},recomputeData:function(n){var e;if(this.isSingleProperty)this.recomputeProperty(void 0,n);else{for(e in this.schema)this.attrValueProxy[e]=void 0;n&&typeof n=="object"?Ja(this.attrValueProxy,n):typeof n=="string"&&IP.parse(n,this.attrValueProxy)}},eventsAttach:function(){var n;for(n in this.eventsDetach(),this.events)this.el.addEventListener(n,this.events[n])},eventsDetach:function(){var n;for(n in this.events)this.el.removeEventListener(n,this.events[n])},destroy:function(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.data),this.objectPool.recycle(this.oldData),this.attrValue=this.data=this.oldData=this.attrValueProxy=void 0}};var Qse={};function In(n,e){var t,i,s,l,u,d={};if(document.currentScript&&document.currentScript!==fqe&&Og.forEach(function(g){g.hasLoaded||document.currentScript.compareDocumentPosition(g)!==Node.DOCUMENT_POSITION_FOLLOWING&&(Dx("The component `"+n+"` was registered in a <script> tag after the scene. Component <script> tags in an HTML file should be declared *before* the scene such that the component is available to entities during scene initialization."),window.debug&&(Qse[n]=!0))}),pqe.test(n)===!0&&Dx("The component name `"+n+"` contains uppercase characters, but HTML will ignore the capitalization of attribute names. Change the name to be lowercase: `"+n.toLowerCase()+"`"),n.indexOf("__")!==-1)throw new Error("The component name `"+n+"` is not allowed. The sequence __ (double underscore) is reserved to specify an id for multiple components of the same type");if(Object.keys(e).forEach(function(g){d[g]={value:e[g],writable:!0}}),ls[n])throw new Error("The component `"+n+"` has been already registered. Check that you are not loading two versions of the same component or two different components of the same name.");((t=function(g,x,b){O1.call(this,g,x,b)}).prototype=Object.create(O1.prototype,d)).name=n,t.prototype.isPositionRotationScale=n==="position"||n==="rotation"||n==="scale",t.prototype.constructor=t,t.prototype.system=y3&&xd[n],t.prototype.play=(l=t.prototype.play,function(){var g=this.el.sceneEl,x=this.el.isPlaying&&!this.isPlaying;this.initialized&&x&&(l.call(this),this.isPlaying=!0,this.eventsAttach(),k8(this)&&g.addBehavior(this))}),t.prototype.pause=(u=t.prototype.pause,function(){var g=this.el.sceneEl;this.isPlaying&&(u.call(this),this.isPlaying=!1,this.eventsDetach(),k8(this)&&g.removeBehavior(this))}),i=Ja(Xse(t.prototype.schema,t.prototype.name)),t.prototype.isSingleProperty=s=uqe(t.prototype.schema),t.prototype.isObjectBased=!s||s&&(R8(i.default)||R8(ox(void 0,i))),$se[n]=eU(),ls[n]={Component:t,dependencies:t.prototype.dependencies,before:t.prototype.before,after:t.prototype.after,isSingleProperty:t.prototype.isSingleProperty,isObjectBased:t.prototype.isObjectBased,multiple:t.prototype.multiple,sceneOnly:t.prototype.sceneOnly,name:n,schema:i,stringify:t.prototype.stringify};for(var p=0;p<Og.length;p++)Og[p].emit("componentregistered",{name:n},!1);return t}function k8(n){return n.tick||n.tock}function R8(n){return n&&n.constructor===Object&&!(n instanceof window.HTMLElement)}var AS=!1;function L3(){AS||(AS=!0,setTimeout(function(){document.dispatchEvent(new CustomEvent("aframeready"))}))}var yqe=GA,xd={},vS=function(n){var e=g3&&ls[this.name];this.el=n,this.sceneEl=n,e&&(e.Component.prototype.system=this),this.buildData(),this.init(),this.update({})};function fc(n,e){var t,i,s={},l=Vse(document);if(Object.keys(e).forEach(function(u){s[u]={value:e[u],writable:!0}}),xd[n])throw new Error("The system `"+n+"` has been already registered. Check that you are not loading two versions of the same system or two different systems of the same name.");if(i=function(u){vS.call(this,u)},(i.prototype=Object.create(vS.prototype,s)).name=n,i.prototype.constructor=i,i.prototype.schema=Ja(gw(i.prototype.schema)),xd[n]=i,AS)for(t=0;t<l.length;t++)l[t].initSystem(n)}vS.prototype={schema:{},init:function(){},update:function(n){},updateProperties:function(n){var e=this.data;Object.keys(this.schema).length!==0&&(this.buildData(n),this.update(e))},buildData:function(n){var e=this.schema;Object.keys(e).length!==0&&(n=n||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name),oM(e)?this.data=aM(n,e):this.data=Wse(yqe.parse(n)||{},e,!1,this.name))},tick:void 0,tock:void 0,play:function(){},pause:function(){}};var SP=Ki("core:a-node:warn"),B3={"a-scene":!0,"a-assets":!0,"a-assets-items":!0,"a-cubemap":!0,"a-mixin":!0,"a-node":!0,"a-entity":!0};function Aqe(n){return n.tagName.toLowerCase()in B3||n.isANode}class xo extends HTMLElement{constructor(){super(),this.computedMixinStr="",this.hasLoaded=!1,this.isANode=!0,this.mixinEls=[]}connectedCallback(){AS?this.doConnectedCallback():document.addEventListener("aframeready",this.connectedCallback.bind(this))}doConnectedCallback(){var e;this.sceneEl=this.closestScene(),this.sceneEl||SP("You are attempting to attach <"+this.tagName+"> outside of an A-Frame scene. Append this element to `<a-scene>` instead."),this.hasLoaded=!1,this.emit("nodeready",void 0,!1),this.isMixin||(e=this.getAttribute("mixin"))&&this.updateMixins(e)}attributeChangedCallback(e,t,i){i!==this.computedMixinStr&&(e!=="mixin"||this.isMixin||this.updateMixins(i,t))}closestScene(){for(var e=this;e&&!e.isScene;)e=e.parentElement;return e}closest(e){for(var t=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,i=this;i&&!t.call(i,e);)i=i.parentElement;return i}disconnectedCallback(){this.hasLoaded=!1}load(e,t){var i,s=this;this.hasLoaded||(t=t||Aqe,i=this.getChildren().filter(t).map(function(l){return new Promise(function(u,d){if(l.hasLoaded)return u();l.addEventListener("loaded",u),l.addEventListener("error",d)})}),Promise.allSettled(i).then(function(l){l.forEach(function(u){u.status==="rejected"&&SP("Rendering scene with errors on node: ",u.reason.target)}),s.isLoading=!0,s.setupMutationObserver(),e&&e(),s.isLoading=!1,s.hasLoaded=!0,s.emit("loaded-private",void 0,!1),s.emit("loaded",void 0,!1)}))}setupMutationObserver(){var e=this;new MutationObserver(function(t){var i;for(i=0;i<t.length;i++)if(t[i].type==="attributes"){var s=t[i].attributeName,l=window.HTMLElement.prototype.getAttribute.call(e,s),u=t[i].oldValue;e.attributeChangedCallback(s,u,l)}}).observe(this,{attributes:!0,attributeOldValue:!0})}getChildren(){return Array.prototype.slice.call(this.children,0)}updateMixins(e,t){var i,s,l,u=xo.newMixinIdArray,d=xo.oldMixinIdArray,p=xo.mixinIds;for(u.length=0,d.length=0,s=e?Rd(e.trim(),/\s+/):u,l=t?Rd(t.trim(),/\s+/):d,p.newMixinIds=s,p.oldMixinIds=l,i=0;i<l.length;i++)s.indexOf(l[i])===-1&&this.unregisterMixin(l[i]);for(this.computedMixinStr="",this.mixinEls.length=0,i=0;i<s.length;i++)this.registerMixin(s[i]);return this.computedMixinStr&&(this.computedMixinStr=this.computedMixinStr.trim(),window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)),s.length===0&&window.HTMLElement.prototype.removeAttribute.call(this,"mixin"),p}registerMixin(e){var t,i,s,l=document.getElementById(e);if(l){if(s=l.getAttribute("mixin"))for(t=Rd(s.trim(),/\s+/),i=0;i<t.length;i++)this.registerMixin(t[i]);this.computedMixinStr=this.computedMixinStr+" "+l.id,this.mixinEls.push(l)}else SP("No mixin was found with id `%s`",e)}setAttribute(e,t){e==="mixin"&&this.updateMixins(t),window.HTMLElement.prototype.setAttribute.call(this,e,t)}unregisterMixin(e){var t,i=this.mixinEls;for(t=0;t<i.length;++t)if(e===i[t].id){i.splice(t,1);break}}emit(e,t,i,s){var l=xo.evtData;i===void 0&&(i=!0),l.bubbles=!!i,l.detail=t,s&&(l=Ja({},s,l)),this.dispatchEvent(new CustomEvent(e,l))}}xo.evtData={},xo.newMixinIdArray=[],xo.oldMixinIdArray=[],xo.mixinIds={},customElements.define("a-node",xo);var vqe=Ki("core:a-entity:debug"),TP=Ki("core:a-entity:warn"),bS="__",MP=["position","rotation","scale","visible"],bqe={once:!0};class Us extends xo{constructor(){super(),this.components={},this.initializingComponents={},this.componentsToUpdate={},this.isEntity=!0,this.isPlaying=!1,this.object3D=new Z.Group,this.object3D.rotation.order="YXZ",this.object3D.el=this,this.object3DMap={},this.parentEl=null,this.rotationObj={},this.states=[]}attributeChangedCallback(e,t,i){var s=this.components[e];super.attributeChangedCallback(),s&&s.justInitialized&&i===""?delete s.justInitialized:(s||i!==null)&&this.setEntityAttribute(e,t,i)}doConnectedCallback(){var e,t,i=this;super.doConnectedCallback(),t=this.sceneEl,this.addToParent(),this.isScene||(t?!(e=t.querySelector("a-assets"))||e.hasLoaded?this.load():e.addEventListener("loaded",function(){i.load()}):this.load())}disconnectedCallback(){var e;if(this.parentEl){for(e in this.components)this.removeComponent(e,!1);this.isScene||(this.removeFromParent(),super.disconnectedCallback(),this.object3D.el=null)}}getObject3D(e){return this.object3DMap[e]}setObject3D(e,t){var i,s=this;if(!(t instanceof Z.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");(i=this.getObject3D(e))&&this.object3D.remove(i),t.el=this,t.children.length&&t.traverse(function(l){l.el=s}),this.object3D.add(t),this.object3DMap[e]=t,this.emit("object3dset",{object:t,type:e})}removeObject3D(e){var t=this.getObject3D(e);t?(this.object3D.remove(t),delete this.object3DMap[e],this.emit("object3dremove",{type:e})):TP("Tried to remove `Object3D` of type:",e,"which was not defined.")}getOrCreateObject3D(e,t){var i=this.getObject3D(e);return!i&&t&&(i=new t,this.setObject3D(e,i)),TP("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` and `object3dset` event instead."),i}add(e){if(!e.object3D)throw new Error("Trying to add an element that doesn't have an `object3D`");this.object3D.add(e.object3D),this.emit("child-attached",{el:e})}addToParent(){var e=this.parentEl=this.parentNode;e&&e.add&&!this.attachedToParent&&(e.add(this),this.attachedToParent=!0)}removeFromParent(){var e=this.parentEl;this.parentEl.remove(this),this.attachedToParent=!1,this.parentEl=null,e.emit("child-detached",{el:this})}load(){var e=this;!this.hasLoaded&&this.parentEl&&super.load.call(this,function(){e.parentEl&&(e.updateComponents(),(e.isScene||e.parentEl.isPlaying)&&e.play())})}remove(e){e?this.object3D.remove(e.object3D):this.parentNode.removeChild(this)}getChildEntities(){for(var e=this.children,t=[],i=0;i<e.length;i++){var s=e[i];s instanceof Us&&t.push(s)}return t}initComponent(e,t,i){var s,l,u,d;d=(u=Rd(e,bS))[0],l=u.length>2?u.slice(1).join("__"):u[1],ls[d]&&(L8(this,e)||t!==void 0||i)&&(e in this.components||(this.initComponentDependencies(d),s=new ls[d].Component(this,t,l),this.isPlaying&&s.play(),this.hasAttribute(e)||(s.justInitialized=!0,window.HTMLElement.prototype.setAttribute.call(this,e,"")),vqe("Component initialized: %s",e)))}initComponentDependencies(e){var t,i;if(ls[e]&&(t=ls[e].dependencies))for(i=0;i<t.length;i++)this.initComponent(t[i],window.HTMLElement.prototype.getAttribute.call(this,t[i])||void 0,!0)}removeComponent(e,t){var i;(i=this.components[e])&&(i.initialized?(i.pause(),i.remove(),t&&(i.destroy(),delete this.components[e],this.hasAttribute(e)&&window.HTMLElement.prototype.removeAttribute.call(this,e)),this.emit("componentremoved",i.evtDetail,!1)):this.addEventListener("componentinitialized",function s(l){l.detail.name===e&&(this.removeComponent(e,t),this.removeEventListener("componentinitialized",s))}))}updateComponents(){var e,t,i,s,l,u,d=this.componentsToUpdate;if(this.hasLoaded||this.isLoading){for(i=0;i<this.mixinEls.length;i++)for(s in this.mixinEls[i].componentCache)kP(s)&&(d[s]=!0);if(this.getExtraComponents)for(s in t=this.getExtraComponents())kP(s)&&(d[s]=!0);for(i=0;i<this.attributes.length;++i)s=this.attributes[i].name,MP.indexOf(s)===-1&&kP(s)&&(d[s]=!0);for(i=0;i<MP.length;i++)s=MP[i],this.hasAttribute(s)&&this.updateComponent(s,this.getDOMAttribute(s));for(s in d)l=this.getDOMAttribute(s),e=(u=t&&t[s])?u.constructor===Object?Ja(u,D1(l||{})):l||u:l,this.updateComponent(s,e),delete d[s]}}updateComponent(e,t,i){var s=this.components[e];if(s)return t!==null||L8(this,e)?void s.updateProperties(t,i):void this.removeComponent(e,!0);this.initComponent(e,t,!1)}removeAttribute(e,t){var i=this.components[e];i&&t===void 0&&this.removeComponent(e,!0),i&&t!==void 0?i.resetProperty(t):(e==="mixin"&&this.mixinUpdate(""),window.HTMLElement.prototype.removeAttribute.call(this,e))}play(){var e,t,i;if(!this.isPlaying&&(this.hasLoaded||this.isLoading)){for(i in this.isPlaying=!0,this.components)this.components[i].play();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].play();this.emit("play")}}pause(){var e,t,i;if(this.isPlaying){for(i in this.isPlaying=!1,this.components)this.components[i].pause();for(e=this.getChildEntities(),t=0;t<e.length;t++)e[t].pause();this.emit("pause")}}setEntityAttribute(e,t,i){if(ls[e]||this.components[e])this.updateComponent(e,i);else if(e==="mixin"){if(i===this.computedMixinStr)return;this.mixinUpdate(i,t)}}mixinUpdate(e,t,i){var s,l,u,d,p=Us.componentsUpdated,g=this;if(i||(t=t||this.getAttribute("mixin")),this.hasLoaded){for(u=this.updateMixins(e,t),p.length=0,d=0;d<this.mixinEls.length;d++)for(s in this.mixinEls[d].componentCache)p.indexOf(s)===-1&&(this.components[s]?this.components[s].handleMixinUpdate():this.initComponent(s,null),p.push(s));for(d=0;d<u.oldMixinIds.length;d++)if(l=document.getElementById(u.oldMixinIds[d]))for(s in l.componentCache)p.indexOf(s)===-1&&this.components[s]&&(this.getDOMAttribute(s)?this.components[s].handleMixinUpdate():this.removeComponent(s,!0))}else this.addEventListener("loaded-private",function(){g.mixinUpdate(e,t,!0)},bqe)}setAttribute(e,t,i){var s,l,u,d,p,g=Us.singlePropUpdate;if(u=(d=e.indexOf(bS))>0?e.substring(0,d):e,!ls[u])return e==="mixin"&&this.mixinUpdate(t),void super.setAttribute.call(this,e,t);if(!this.components[e]&&this.hasAttribute(e)&&this.updateComponent(e,window.HTMLElement.prototype.getAttribute.call(this,e)),i!==void 0&&typeof t=="string"&&t.length>0&&typeof D1(t)=="string"){for(p in g)delete g[p];(s=g)[t]=i,l=!1}else s=t,l=i===!0;this.updateComponent(e,s,l),this.sceneEl&&this.sceneEl.getAttribute("debug")&&this.components[e].flushToDOM()}flushToDOM(e){var t,i,s,l=this.components,u=this.children;for(s in l)l[s].flushToDOM();if(e)for(i=0;i<u.length;++i)(t=u[i]).flushToDOM&&t.flushToDOM(e)}getAttribute(e){var t,i,s,l;return e==="position"?this.object3D.position:e==="rotation"?(i=Z.MathUtils.radToDeg,s=this.object3D.rotation,(l=this.rotationObj).x=i(s.x),l.y=i(s.y),l.z=i(s.z),l):e==="scale"?this.object3D.scale:e==="visible"?this.object3D.visible:(t=this.components[e])?t.data:window.HTMLElement.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var t=this.components[e];return t?t.attrValue:window.HTMLElement.prototype.getAttribute.call(this,e)}addState(e){this.is(e)||(this.states.push(e),this.emit("stateadded",e))}removeState(e){var t=this.states.indexOf(e);t!==-1&&(this.states.splice(t,1),this.emit("stateremoved",e))}is(e){return this.states.indexOf(e)!==-1}inspect(){this.sceneEl.components.inspector.openInspector(this)}destroy(){var e;if(this.parentNode)TP("Entity can only be destroyed if detached from scenegraph.");else for(e in this.components)this.components[e].destroy()}}function L8(n,e){return!(!n.components[e]||!n.components[e].attrValue)||function(t,i){var s,l=!1;for(s=0;s<i.length&&!(l=i[s].hasAttribute(t));++s);return l}(e,n.mixinEls)}function kP(n){return n.indexOf(bS)!==-1&&(n=Rd(n,bS)[0]),!!ls[n]}function xqe(n){if(n.data&&n.data.type==="vr")switch(n.data.data){case"enter":this.enterVR();break;case"exit":this.exitVR()}}Us.componentsUpdated=[],Us.singlePropUpdate={},customElements.define("a-entity",Us),mw()&&window.addEventListener("orientationchange",function(){document.documentElement.style.height="initial",setTimeout(function(){document.documentElement.style.height="100%",setTimeout(function(){window.scrollTo(0,1)},500)},500)});var RP=Ki("core:a-scene:warn"),wqe=mw(),B8=Xp(),Cqe=iM;class Kse extends Us{constructor(){var e;super(),(e=this).clock=new Z.Clock,e.isIOS=wqe,e.isMobile=B8,e.hasWebXR=Cqe,e.isAR=!1,e.isScene=!0,e.object3D=new Z.Scene,e.resize=e.resize.bind(e),e.render=e.render.bind(e),e.systems={},e.systemNames=[],e.time=e.delta=0,e.usedOfferSession=!1,e.componentOrder=[],e.behaviors={},e.hasLoaded=!1,e.isPlaying=!1,e.originalHTML=e.innerHTML}addFullScreenStyles(){document.documentElement.classList.add("a-fullscreen")}removeFullScreenStyles(){document.documentElement.classList.remove("a-fullscreen")}doConnectedCallback(){var e=this,t=this.hasAttribute("embedded");this.setAttribute("inspector",""),this.setAttribute("keyboard-shortcuts",""),this.setAttribute("screenshot",""),this.setAttribute("xr-mode-ui",""),this.setAttribute("device-orientation-permission-ui",""),super.doConnectedCallback(),function(i){var s;function l(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||i.exitVR(),document.activeElement.blur(),document.body.focus()}(s=document.createElement("canvas")).classList.add("a-canvas"),s.dataset.aframeCanvas=!0,i.appendChild(s),document.addEventListener("fullscreenchange",l),document.addEventListener("mozfullscreenchange",l),document.addEventListener("webkitfullscreenchange",l),document.addEventListener("MSFullscreenChange",l),s.addEventListener("touchmove",function(u){u.preventDefault()},{passive:!1}),i.canvas=s,i.emit("render-target-loaded",{target:s}),setTimeout(i.resize.bind(i),0)}(this),this.setupRenderer(),function(i,s){Use=s;var l,u,d,p,g,x,b,E,S,M,R=(qc=i).hasAttribute(S8)?rqe.parse(qc.getAttribute(S8)):void 0,P=R&&R.dotsColor||"white",k=R&&R.backgroundColor||"#24CAFF";(R===void 0||R.enabled==="true"||R.enabled===void 0)&&(l=new Z.Scene,u=new Z.SphereGeometry(.2,36,18,0,2*Math.PI,0,Math.PI),d=new Z.MeshBasicMaterial({color:P}),p=new Z.Mesh(u,d),g=p.clone(),x=p.clone(),b=new Z.PerspectiveCamera(80,window.innerWidth/window.innerHeight,5e-4,1e4),E=new Z.Clock,S=0,M=function(){qc.renderer.render(l,b),S=E.getElapsedTime()%4,p.visible=S>=1,g.visible=S>=2,x.visible=S>=3},l.background=new Z.Color(k),l.add(b),p.position.set(-1,0,-15),g.position.set(0,0,-15),x.position.set(1,0,-15),b.add(p),b.add(g),b.add(x),(Wf=document.createElement("div")).className="a-loader-title",Wf.innerHTML=document.title,Wf.style.display="none",Wf.setAttribute(vo,""),qc.appendChild(Wf),setTimeout(function(){qc.hasLoaded||(CP(b),Wf.style.display="block",window.addEventListener("resize",function(){CP(b)}),qc.renderer.setAnimationLoop(M))},200))}(this,D8),this.resize(),t||this.addFullScreenStyles(),Ose()&&window.addEventListener("message",xqe.bind(this)),function(i){var s,l=document.head,u=l.querySelector("script"),d=[];return eqe.forEach(p),i.isIOS&&tqe.forEach(p),d;function p(g){g&&!g.exists()&&(s=function(x){if(x&&x.tagName){var b=document.createElement(x.tagName);return b.setAttribute(vo,""),Ja(b,x.attributes)}}(g),s&&(u?u.parentNode.insertBefore(s,u):l.appendChild(s),d.push(s)))}}(this),function(i){if(i.isMobile){var s=i.wakelock=new(iqe());i.addEventListener("enter-vr",function(){s.request()}),i.addEventListener("exit-vr",function(){s.release()})}}(this),this.enterVRBound=function(){e.enterVR()},this.exitVRBound=function(){e.exitVR()},window.addEventListener("sessionend",this.resize),this.addEventListener("cameraready",function(){e.attachedCallbackPostCamera()}),this.initSystems(),this.componentOrder=P8(ls,this.componentOrder),this.addEventListener("componentregistered",function(){e.componentOrder=P8(ls,e.componentOrder)}),this.hasWebXR&&navigator.xr&&navigator.xr.addEventListener&&navigator.xr.addEventListener("sessiongranted",function(){e.enterVR()})}attachedCallbackPostCamera(){var e=this;window.addEventListener("load",void 0),window.addEventListener("resize",function(){e.isIOS?setTimeout(e.resize,100):e.resize()}),this.play(),Og.push(this)}initSystems(){var e;for(e in this.initSystem("camera"),xd)e!=="camera"&&this.initSystem(e)}initSystem(e){this.systems[e]||(this.systems[e]=new xd[e](this),this.systemNames.push(e))}disconnectedCallback(){var e=Og.indexOf(this);super.disconnectedCallback(),Og.splice(e,1),window.removeEventListener("sessionend",this.resize),this.removeFullScreenStyles(),this.renderer.dispose()}addBehavior(e){var t,i,s=this.behaviors[e.name];for(i in s||(s=this.behaviors[e.name]={tick:{inUse:!1,array:[],markedForRemoval:[]},tock:{inUse:!1,array:[],markedForRemoval:[]}}),s)if(e[i]){if((t=s[i]).inUse){var l=t.markedForRemoval.indexOf(e);l!==-1&&t.markedForRemoval.splice(l,1)}t.array.indexOf(e)===-1&&t.array.push(e)}}getPointerLockElement(){return document.pointerLockElement}checkHeadsetConnected(){return QV()}enterAR(){var e;if(!this.hasWebXR)throw e="Failed to enter AR mode, WebXR not supported.",new Error(e);if(!KV())throw e="Failed to enter AR, WebXR immersive-ar mode not supported in your browser or device.",new Error(e);return this.enterVR(!0)}enterVR(e,t){var i,s=this,l=s.renderer.xr;if(t&&(!navigator.xr||!navigator.xr.offerSession))return Promise.resolve("OfferSession is not supported.");if(s.usedOfferSession&&t)return Promise.resolve("OfferSession was already called.");if(this.is("vr-mode"))return Promise.resolve("Already in VR.");if(this.checkHeadsetConnected()||this.isMobile){var u=s.getAttribute("renderer");if(l.enabled=!0,this.hasWebXR){this.xrSession&&this.xrSession.removeEventListener("end",this.exitVRBound);var d=this.sceneEl.systems.webxr.sessionReferenceSpaceType;l.setReferenceSpaceType(d);var p=e?"immersive-ar":"immersive-vr";return i=this.sceneEl.systems.webxr.sessionConfiguration,new Promise(function(x,b){var E=t?navigator.xr.offerSession.bind(navigator.xr):navigator.xr.requestSession.bind(navigator.xr);s.usedOfferSession|=t,E(p,i).then(function(S){t&&(s.usedOfferSession=!1),l.layersEnabled=i.requiredFeatures.indexOf("layers")!==-1,l.setSession(S).then(function(){l.setFoveation(u.foveationLevel),s.xrSession=S,s.systems.renderer.setWebXRFrameRate(S),S.addEventListener("end",s.exitVRBound),g(x)})},function(S){b(new Error("Failed to enter "+(p==="immersive-ar"?"AR":"VR")+" mode (`requestSession`)",{cause:S}))})})}throw new Error("Failed to enter "+(e?"AR":"VR")+" no WebXR")}return g(),Promise.resolve();function g(x){var b;e?s.addState("ar-mode"):s.addState("vr-mode"),s.emit("enter-vr",{target:s}),!s.hasWebXR&&s.isMobile&&screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape"),s.addFullScreenStyles(),s.isMobile||s.checkHeadsetConnected()||((b=s.canvas).requestFullscreen||b.webkitRequestFullscreen||b.mozRequestFullScreen||b.msRequestFullscreen).apply(b,[{navigationUI:"hide"}]),s.resize(),x&&x()}}exitVR(){var e=this,t=this.renderer.xr;if(!this.is("vr-mode")&&!this.is("ar-mode"))return Promise.resolve("Not in immersive mode.");if(this.checkHeadsetConnected()||this.isMobile){if(t.enabled=!1,!this.hasWebXR)throw Error("Failed to exit VR - no WebXR");this.xrSession.removeEventListener("end",this.exitVRBound),this.xrSession.end().then(function(){},function(){}),this.xrSession=void 0}else(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen());return e.removeState("vr-mode"),e.removeState("ar-mode"),e.isMobile&&screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),e.hasAttribute("embedded")&&e.removeFullScreenStyles(),e.resize(),e.isIOS&&kse(e.canvas),e.renderer.setPixelRatio(window.devicePixelRatio),e.emit("exit-vr",{target:e}),Promise.resolve()}getAttribute(e){var t=this.systems[e];return t?t.data:Us.prototype.getAttribute.call(this,e)}getDOMAttribute(e){var t=this.systems[e];return t?t.data:Us.prototype.getDOMAttribute.call(this,e)}setAttribute(e,t,i){if(xd[e]){xo.prototype.setAttribute.call(this,e,t);var s=this.systems[e];s&&s.updateProperties(t)}else Us.prototype.setAttribute.call(this,e,t,i)}removeBehavior(e){var t,i,s,l=this.behaviors[e.name];for(i in l)e[i]&&(s=(t=l[i]).array.indexOf(e))!==-1&&(t.inUse?t.markedForRemoval.indexOf(e)===-1&&t.markedForRemoval.push(e):(t.array[s]=t.array[t.array.length-1],t.array.pop()))}resize(){var e,t,i=this.camera,s=this.canvas,l=this.renderer.xr.isPresenting;e=this.renderer.xr.enabled&&l,!i||!s||this.is("vr-mode")&&(this.isMobile||e)||(t=D8(s,this.getAttribute("embedded")&&!this.is("vr-mode"),this.maxCanvasSize,this.is("vr-mode")),i.aspect=t.width/t.height,i.updateProjectionMatrix(),this.renderer.setSize(t.width,t.height,!1),this.emit("rendererresize",null,!1))}setupRenderer(){var e,t,i,s=this;i={alpha:!0,antialias:!B8,canvas:this.canvas,logarithmicDepthBuffer:!1,powerPreference:"high-performance"},this.maxCanvasSize={height:-1,width:-1},this.hasAttribute("renderer")&&((t=D1(this.getAttribute("renderer"))).precision&&(i.precision=t.precision+"p"),t.antialias&&t.antialias!=="auto"&&(i.antialias=t.antialias==="true"),t.logarithmicDepthBuffer&&t.logarithmicDepthBuffer!=="auto"&&(i.logarithmicDepthBuffer=t.logarithmicDepthBuffer==="true"),t.alpha&&(i.alpha=t.alpha==="true"),t.stencil&&(i.stencil=t.stencil==="true"),t.multiviewStereo&&(i.multiviewStereo=t.multiviewStereo==="true"),this.maxCanvasSize={width:t.maxCanvasWidth?parseInt(t.maxCanvasWidth):this.maxCanvasSize.width,height:t.maxCanvasHeight?parseInt(t.maxCanvasHeight):this.maxCanvasSize.height});var l=["WebGLRenderer","WebGPURenderer"].find(function(u){return Z[u]});(e=this.renderer=new Z[l](i)).xr.setPoseTarget||(e.xr.setPoseTarget=function(){}),e.setPixelRatio(window.devicePixelRatio),this.camera&&e.xr.setPoseTarget(this.camera.el.object3D),this.addEventListener("camera-set-active",function(){e.xr.setPoseTarget(s.camera.el.object3D)})}play(){var e=this,t=this;this.renderStarted?Us.prototype.play.call(this):(this.addEventListener("loaded",function(){var i=this.renderer;Us.prototype.play.call(this),t.renderStarted||(t.resize(),t.renderer&&(window.performance&&window.performance.mark("render-started"),window.removeEventListener("resize",CP),Wf&&(Wf.style.display="none"),i.setAnimationLoop(this.render),t.renderStarted=!0,t.emit("renderstart")))}),setTimeout(function(){Us.prototype.load.call(e)}))}updateComponent(e){e in xd||Us.prototype.updateComponent.apply(this,arguments)}tick(e,t){var i,s=this.systems;for(this.callComponentBehaviors("tick",e,t),i=0;i<this.systemNames.length;i++)s[this.systemNames[i]].tick&&s[this.systemNames[i]].tick(e,t)}tock(e,t,i){var s,l=this.systems;for(this.callComponentBehaviors("tock",e,t),s=0;s<this.systemNames.length;s++)l[this.systemNames[s]].tock&&l[this.systemNames[s]].tock(e,t,i)}render(e,t){var i=this.renderer;this.frame=t,this.delta=1e3*this.clock.getDelta(),this.time=1e3*this.clock.elapsedTime,this.isPlaying&&this.tick(this.time,this.delta);var s=null;if(this.is("ar-mode")&&(s=this.object3D.background,this.object3D.background=null),i.render(this.object3D,this.camera),s&&(this.object3D.background=s),this.isPlaying){var l=i.xr.isPresenting?i.xr.getCamera():this.camera;this.tock(this.time,this.delta,l)}}callComponentBehaviors(e,t,i){for(var s,l=0;l<this.componentOrder.length;l++){var u=this.behaviors[this.componentOrder[l]];if(u){var d=u[e];for(d.inUse=!0,s=0;s<d.array.length;s++)d.array[s].isPlaying&&d.array[s][e](t,i);for(d.inUse=!1,s=0;s<d.markedForRemoval.length;s++)this.removeBehavior(d.markedForRemoval[s]);d.markedForRemoval.length=0}}}}function P8(n,e){var t,i,s={},l=e||[];for(i in l.length=0,n){var u=n[i];if(u!==void 0){var d=u.before?u.before.slice(0):[],p=u.after?u.after.slice(0):[];s[i]={before:d,after:p,visited:!1,done:!1}}}for(i in s)for(t=0;t<s[i].before.length;t++){var g=s[i].before[t];g in s?s[g].after.push(i):RP("Invalid ordering constraint, no component named `"+g+"` referenced by `"+i+"`")}function x(b){if(b in s&&!s[b].done)if(s[b].visited)RP("Cycle detected, ignoring one or more before/after constraints. The resulting order might be incorrect");else{s[b].visited=!0;for(var E=0;E<s[b].after.length;E++){var S=s[b].after[E];S in s||RP("Invalid before/after constraint, no component named `"+S+"` referenced in `"+b+"`"),x(S)}s[b].done=!0,l.push(b)}}for(i in s)s[i].done||x(i);return l}function N8(n,e){var t,i=window.devicePixelRatio;return!e||e.width===-1&&e.height===-1||n.width*i<e.width&&n.height*i<e.height||(t=n.width/n.height,n.width*i>e.width&&e.width!==-1&&(n.width=Math.round(e.width/i),n.height=Math.round(e.width/t/i)),n.height*i>e.height&&e.height!==-1&&(n.height=Math.round(e.height/i),n.width=Math.round(e.height*t/i))),n}function D8(n,e,t,i){return n.parentElement?e?N8({height:n.parentElement.offsetHeight,width:n.parentElement.offsetWidth},t):function(s,l){var u;return u={height:document.body.offsetHeight,width:document.body.offsetWidth},l?u:N8(u,s)}(t,i):{height:0,width:0}}customElements.define("a-scene",Kse);var Eqe=gw,$p={},dU=[],P3=function(){};function _a(n,e){var t,i={};if(Object.keys(e).forEach(function(s){i[s]={value:e[s],writable:!0}}),$p[n])throw new Error("The geometry `"+n+"` has been already registered");return((t=function(){P3.call(this)}).prototype=Object.create(P3.prototype,i)).name=n,t.prototype.constructor=t,$p[n]={Geometry:t,schema:Eqe(t.prototype.schema)},dU.push(n),t}P3.prototype={schema:{},init:function(n){return this.geometry=new Z.BufferGeometry,this.geometry},update:function(n){}};var fU=Ki,_qe=nU,Iqe=fU("extras:primitives:debug"),F8=fU("extras:primitives:warn"),Sqe=fU("extras:primitives:error"),Zse={};function wa(n,e){if(n=n.toLowerCase(),!B3[n]){B3[n]=!0,Iqe("Registering <%s>",n),e.defaultAttributes&&F8("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.");var t=e.mappings||{},i=class extends Us{constructor(){super(),this.defaultComponentsFromPrimitive=e.defaultComponents||e.defaultAttributes||{},this.deprecated=e.deprecated||null,this.deprecatedMappings=e.deprecatedMappings||{},this.mappings=t,e.deprecated&&console.warn(e.deprecated),this.resolveMappingCollisions()}resolveMappingCollisions(){var s=this.mappings,l=this;Object.keys(s).forEach(function(u){var d;u!==u.toLowerCase()&&F8("Mapping keys should be specified in lower case. The mapping key "+u+" may not be recognized"),ls[u]&&(d=s[u].replace(".","-"),s[d]=s[u],delete s[u],console.warn("The primitive "+l.tagName.toLowerCase()+" has a mapping collision. The attribute "+u+" has the same name as a registered component and has been renamed to "+d))})}getExtraComponents(){var s,l,u,d,p,g=this;for(l=lU(this.defaultComponentsFromPrimitive),(p=this.getAttribute("mixin"))&&(p=Rd(p.trim(),/\s+/)).forEach(function(S){var M,R,P=document.getElementById(S);if(P){var k=P.rawAttributeCache,F=P.componentCache;for(var V in k){if(d=g.mappings[V])return void O8(d,k[V],l);V in F&&(l[V]=(M=l[V],R=F[V],x(M)?b(R):x(R)?b(M):E(M)&&E(R)?_l(M,R):b(R)))}}}),u=0;u<this.attributes.length;u++)s=this.attributes[u],(d=this.mappings[s.name])&&O8(d,s.value,l);return l;function x(S){return S===void 0}function b(S){return E(S)?_l({},S):S}function E(S){return S!==null&&S.constructor===Object}}attributeChangedCallback(s,l,u){var d=this.mappings[s];s in this.deprecatedMappings&&console.warn(this.deprecatedMappings[s]),s&&d?_qe(this,d,u):super.attributeChangedCallback(s,l,u)}};return customElements.define(n,i),i.mappings=t,Zse[n]=i,i}Sqe("Trying to register primitive "+n+" that has been already previously registered")}function O8(n,e,t){var i=rM(n);i.constructor===Array?(t[i[0]]=t[i[0]]||{},t[i[0]][i[1]]=e.trim()):t[i]=e.trim()}var rh={},jse=[],Tqe={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},N3=function(){};function qf(n,e){var t,i={};if(Object.keys(e).forEach(function(s){i[s]={value:e[s],writable:!0}}),rh[n])throw new Error("The shader "+n+" has already been registered");return((t=function(){N3.call(this)}).prototype=Object.create(N3.prototype,i)).name=n,t.prototype.constructor=t,rh[n]={Shader:t,schema:gw(t.prototype.schema)},jse.push(n),t}N3.prototype={schema:{},vertexShader:"void main() {gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);}",fragmentShader:"void main() {gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);}",init:function(n){return this.uniforms=this.initUniforms(),this.material=new(this.raw?Z.RawShaderMaterial:Z.ShaderMaterial)({uniforms:this.uniforms,glslVersion:this.raw||this.glsl3?Z.GLSL3:null,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader}),this.material},initUniforms:function(){var n,e,t=this.schema,i={};for(n in t)t[n].is==="uniform"&&(e=Tqe[t[n].type],i[n]={type:e,value:void 0});return i},update:function(n){var e,t,i=this.schema,s=this.uniforms;for(e in n)if(i[e]&&i[e].is==="uniform")if(i[e].type!=="map")s[e].value=this.parseValue(i[e].type,n[e]),s[e].needsUpdate=!0;else{if(!s[e]||s[e].value===n[e])continue;t="_texture_"+e,this.setMapOnTextureLoad(s,e,t),sM(t,e,this,n)}},parseValue:function(n,e){var t;switch(n){case"vec2":return new Z.Vector2(e.x,e.y);case"vec3":return new Z.Vector3(e.x,e.y,e.z);case"vec4":return new Z.Vector4(e.x,e.y,e.z,e.w);case"color":return t=new Z.Color(e),new Z.Vector3(t.r,t.g,t.b);default:return e}},setMapOnTextureLoad:function(n,e,t){var i=this;this.el.addEventListener("materialtextureloaded",function(){n[e].value=i.material[t],n[e].needsUpdate=!0})}};var LP=new Z.FileLoader,D3=Ki("core:a-assets:warn");function Mqe(n){if(n.hasAttribute("autoplay")||n.getAttribute("preload")==="auto")return new Promise(function(e,t){if(n.readyState===4)return e();if(n.error)return t();function i(){for(var s=0,l=0;l<n.buffered.length;l++)s+=n.buffered.end(l)-n.buffered.start(l);s>=n.duration&&(n.tagName==="VIDEO"&&Z.Cache.add(n.getAttribute("src"),n),e())}n.addEventListener("loadeddata",i,!1),n.addEventListener("progress",i,!1),n.addEventListener("error",t,!1)})}function V8(n){var e=function(t){var i,s,l;return t.hasAttribute("crossorigin")||(i=t.getAttribute("src"))!==null&&(i.indexOf("://")===-1||(l=(s=i).indexOf("://")>-1?s.split("/")[2]:s.split("/")[0]).substring(0,l.indexOf(":"))===window.location.host)?t:(D3('Cross-origin element (e.g., <img>) was requested without `crossorigin` set. A-Frame will re-request the asset with `crossorigin` attribute set. Please set `crossorigin` on the element (e.g., <img crossorigin="anonymous">)',i),t.crossOrigin="anonymous",t.cloneNode(!0))}(n);return e.tagName&&e.tagName.toLowerCase()==="video"&&(e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline","")),e!==n&&(n.parentNode.appendChild(e),n.parentNode.removeChild(n)),e}customElements.define("a-assets",class extends xo{constructor(){super(),this.isAssets=!0,this.fileLoader=LP,this.timeout=null}doConnectedCallback(){var n,e,t,i,s,l,u=this,d=[];if(super.doConnectedCallback(),!this.parentNode.isScene)throw new Error("<a-assets> must be a child of a <a-scene>.");for(s=this.querySelectorAll("img"),n=0;n<s.length;n++)i=V8(s[n]),d.push(new Promise(function(p,g){Z.Cache.add(s[n].getAttribute("src"),i),i.complete?p():(i.onload=p,i.onerror=g)}));for(t=this.querySelectorAll("audio, video"),n=0;n<t.length;n++)(e=V8(t[n])).src||e.srcObject||D3("Audio/video asset has neither `src` nor `srcObject` attributes."),d.push(Mqe(e));this.getChildren().forEach(function(p){p.isAssetItem&&p.hasAttribute("src")&&d.push(new Promise(function(g,x){if(p.hasLoaded)return g();p.addEventListener("loaded",g),p.addEventListener("error",x)}))}),Promise.allSettled(d).then(function(){u.timeout!==null&&u.load()}),l=parseInt(this.getAttribute("timeout"),10)||3e3,this.timeout=setTimeout(function(){u.hasLoaded||(D3("Asset loading timed out in",l,"ms"),u.timeout=null,u.emit("timeout"),u.load())},l)}disconnectedCallback(){super.disconnectedCallback(),this.timeout&&clearTimeout(this.timeout)}load(){super.load.call(this,null,function(){return!1})}}),customElements.define("a-asset-item",class extends xo{constructor(){super(),this.data=null,this.isAssetItem=!0}connectedCallback(){var n=this,e=this.getAttribute("src");LP.setResponseType(this.getAttribute("response-type")||function(t){var i=function(l){var u=document.createElement("a");u.href=l;var d=u.search.replace(/^\?/,""),p=l.replace(d,"").replace("?","");return p.substring(p.lastIndexOf("/")+1)}(t),s=i.lastIndexOf(".");return s>=0&&i.slice(s,t.search(/\?|#|$/))===".glb"?"arraybuffer":"text"}(e)),LP.load(e,function(t){n.data=t,xo.prototype.load.call(n)},function(t){n.emit("progress",{loadedBytes:t.loaded,totalBytes:t.total,xhr:t})},function(t){n.emit("error",{xhr:t},!1)})}});var kqe=Ki("core:cubemap:warn");class pU extends HTMLElement{constructor(e){return super(e)}onReadyStateChange(){document.readyState==="complete"&&this.doConnectedCallback()}connectedCallback(){document.readyState==="complete"?pU.prototype.doConnectedCallback.call(this):document.addEventListener("readystatechange",this.onReadyStateChange.bind(this))}doConnectedCallback(){this.srcs=this.validate()}validate(){var e,t=this.querySelectorAll("[src]"),i=[];if(t.length===6){for(e=0;e<t.length;e++)t[e].tagName==="IMG"?i.push(t[e]):i.push(t[e].getAttribute("src"));return i}kqe("<a-cubemap> did not contain exactly six elements each with a `src` attribute.")}}customElements.define("a-cubemap",pU),customElements.define("a-mixin",class extends xo{constructor(){super(),this.componentCache={},this.rawAttributeCache={},this.isMixin=!0}doConnectedCallback(){super.doConnectedCallback(),this.sceneEl=this.closestScene(),this.id=this.getAttribute("id"),this.cacheAttributes(),this.updateEntities(),this.load()}attributeChangedCallback(n,e,t){super.attributeChangedCallback(),this.cacheAttribute(n,t),this.updateEntities()}setAttribute(n,e){window.HTMLElement.prototype.setAttribute.call(this,n,e),this.cacheAttribute(n,e)}cacheAttribute(n,e){var t,i;i=Rd(n,"__")[0],t=ls[i],e===void 0&&(e=window.HTMLElement.prototype.getAttribute.call(this,n)),this.rawAttributeCache[n]=e,t&&(this.componentCache[n]=this.parseComponentAttrValue(t,e))}parseComponentAttrValue(n,e){var t;return typeof e!="string"?e:(n.isSingleProperty?typeof(t=n.schema.parse(e))=="string"&&(t=e):t=D1(e),t)}getAttribute(n){return this.componentCache[n]||window.HTMLElement.prototype.getAttribute.call(this,n)}cacheAttributes(){var n,e,t=this.attributes;for(e=0;e<t.length;e++)n=t[e].name,this.cacheAttribute(n)}updateEntities(){var n,e,t;if(this.sceneEl)for(e=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]"),t=0;t<e.length;t++)(n=e[t]).hasLoaded&&!n.isMixin&&n.mixinUpdate(this.id)}});const Yse="1.7.0";var y_=new Z.Color,A_=new Z.Color,U8=Mse,z8=nU,BP={},qse="color",G8="rotation",Jse="components";function W8(n){n.x=Z.MathUtils.degToRad(n.x),n.y=Z.MathUtils.degToRad(n.y),n.z=Z.MathUtils.degToRad(n.z)}function PP(n,e,t){var i;for(i=0;i<e.length;i++)n.addEventListener(e[i],t)}function NP(n,e,t){var i;for(i=0;i<e.length;i++)n.removeEventListener(e[i],t)}function H8(n,e){var t,i,s;for(i=xS(e),s=n,t=0;t<i.length;t++)s=s[i[t]];if(s===void 0)throw console.log(n),new Error("[animation] property ("+e+") could not be found");return s}function X8(n,e,t,i){var s,l,u,d;for(e.startsWith("object3D.rotation")&&(t=Z.MathUtils.degToRad(t)),l=xS(e),d=n,s=0;s<l.length-1;s++)d=d[l[s]];u=l[l.length-1],i!==qse?d[u]=t:"r"in d[u]?(d[u].r=t.r,d[u].g=t.g,d[u].b=t.b):(d[u].x=t.r,d[u].y=t.g,d[u].z=t.b)}function xS(n){return n in BP||(BP[n]=n.split(".")),BP[n]}function DP(n){return n.isRawProperty||n.property.startsWith(Jse)||n.property.startsWith("object3D")}In("animation",{schema:{autoplay:{default:!0},delay:{default:0},dir:{default:""},dur:{default:1e3},easing:{default:"easeInQuad"},elasticity:{default:400},enabled:{default:!0},from:{default:""},loop:{default:0,parse:function(n){return n===!0||n==="true"||n!==!1&&n!=="false"&&parseInt(n,10)}},property:{default:""},startEvents:{type:"array"},pauseEvents:{type:"array"},resumeEvents:{type:"array"},round:{default:!1},to:{default:""},type:{default:""},isRawProperty:{default:!1}},multiple:!0,init:function(){var n=this;this.eventDetail={name:this.attrName},this.time=0,this.animation=null,this.animationIsPlaying=!1,this.onStartEvent=this.onStartEvent.bind(this),this.beginAnimation=this.beginAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.resumeAnimation=this.resumeAnimation.bind(this),this.fromColor={},this.toColor={},this.targets={},this.targetsArray=[],this.updateConfigForDefault=this.updateConfigForDefault.bind(this),this.updateConfigForRawColor=this.updateConfigForRawColor.bind(this),this.config={complete:function(){n.animationIsPlaying=!1,n.el.emit("animationcomplete",n.eventDetail,!1),n.id&&n.el.emit("animationcomplete__"+n.id,n.eventDetail,!1)}}},update:function(n){var e=this.config,t=this.data;this.animationIsPlaying=!1,this.data.enabled&&t.property&&(e.autoplay=!1,e.direction=t.dir,e.duration=t.dur,e.easing=t.easing,e.elasticity=t.elasticity,e.loop=t.loop,e.round=t.round,this.createAndStartAnimation())},tick:function(n,e){this.animationIsPlaying&&(this.time+=e,this.animation.tick(this.time))},remove:function(){this.pauseAnimation(),this.removeEventListeners()},pause:function(){this.paused=!0,this.pausedWasPlaying=this.animationIsPlaying,this.pauseAnimation(),this.removeEventListeners()},play:function(){this.paused&&(this.paused=!1,this.addEventListeners(),this.pausedWasPlaying&&(this.resumeAnimation(),this.pausedWasPlaying=!1))},createAndStartAnimation:function(){var n=this.data;this.updateConfig(),this.animationIsPlaying=!1,this.animation=pI(this.config),this.animation.began=!0,this.removeEventListeners(),this.addEventListeners(),!n.autoplay||n.startEvents&&n.startEvents.length||(n.delay?setTimeout(this.beginAnimation,n.delay):this.beginAnimation())},beginAnimation:function(){this.updateConfig(),this.animation.began=!0,this.time=0,this.animationIsPlaying=!0,this.stopRelatedAnimations(),this.el.emit("animationbegin",this.eventDetail,!1)},pauseAnimation:function(){this.animationIsPlaying=!1},resumeAnimation:function(){this.animationIsPlaying=!0},onStartEvent:function(){this.data.enabled&&(this.updateConfig(),this.animation&&this.animation.pause(),this.animation=pI(this.config),this.data.delay?setTimeout(this.beginAnimation,this.data.delay):this.beginAnimation())},updateConfigForRawColor:function(){var n,e,t,i=this.config,s=this.data,l=this.el;if(!this.waitComponentInitRawProperty(this.updateConfigForRawColor)){for(e in n=s.from===""?H8(l,s.property):s.from,t=s.to,this.setColorConfig(n,t),n=this.fromColor,t=this.toColor,this.targetsArray.length=0,this.targetsArray.push(n),i.targets=this.targetsArray,t)i[e]=t[e];var u;i.update=(u={},function(d){var p;(p=d.animatables[0].target).r===u.r&&p.g===u.g&&p.b===u.b||X8(l,s.property,p,s.type)})}},updateConfigForDefault:function(){var n,e,t,i,s=this.config,l=this.data,u=this.el;this.waitComponentInitRawProperty(this.updateConfigForDefault)||(n=l.from===""?DP(l)?H8(u,l.property):U8(u,l.property):l.from,t=l.to,isNaN(n||t)?(n=n&&n.toString(),t=t&&t.toString()):(n=parseFloat(n),t=parseFloat(t)),(e=l.to==="true"||l.to==="false"||l.to===!0||l.to===!1)&&(n=l.from==="true"||l.from===!0?1:0,t=l.to==="true"||l.to===!0?1:0),this.targets.aframeProperty=n,s.targets=this.targets,s.aframeProperty=t,s.update=function(d){var p;(p=d.animatables[0].target.aframeProperty)!==i&&(i=p,e&&(p=p>=1),DP(l)?X8(u,l.property,p,l.type):z8(u,l.property,p))})},updateConfigForVector:function(){var n,e,t,i,s=this.config,l=this.data,u=this.el,d=xS(l.property),p=d[0]==="object3D"?d[1]:d[0];for(n in e=l.from!==""?fS(l.from):U8(u,p),t=fS(l.to),p===G8&&(W8(e),W8(t)),this.targetsArray.length=0,this.targetsArray.push(e),s.targets=this.targetsArray,t)s[n]=t[n];s.update=p!=="position"&&p!==G8&&p!=="scale"?function(){var g={};return function(x){var b=x.animatables[0].target;b.x===g.x&&b.y===g.y&&b.z===g.z||(g.x=b.x,g.y=b.y,g.z=b.z,z8(u,l.property,b))}}():(i={},function(g){var x=g.animatables[0].target;x.x===i.x&&x.y===i.y&&x.z===i.z||(i.x=x.x,i.y=x.y,i.z=x.z,u.object3D[p].set(x.x,x.y,x.z))})},updateConfig:function(){var n;n=function(e,t){var i,s,l,u;return(l=t.split("."))[0]!=="object3D"||l[2]||l[1]!=="position"&&l[1]!=="rotation"&&l[1]!=="scale"?(s=l[0],u=l[1],(i=e.components[s]||ls[s])?u&&!i.schema[u]?null:u?i.schema[u].type:i.schema.type:null):"vec3"}(this.el,this.data.property),DP(this.data)&&this.data.type===qse?this.updateConfigForRawColor():n==="vec2"||n==="vec3"||n==="vec4"?this.updateConfigForVector():this.updateConfigForDefault()},waitComponentInitRawProperty:function(n){var e,t=this.data,i=this.el,s=this;return t.from===""&&!!t.property.startsWith(Jse)&&(e=xS(t.property)[1],!i.components[e]&&(i.addEventListener("componentinitialized",function l(u){u.detail.name===e&&(n(),s.animation=pI(s.config),i.removeEventListener("componentinitialized",l))}),!0))},stopRelatedAnimations:function(){var n,e;for(e in this.el.components)n=this.el.components[e],e!==this.attrName&&n.name==="animation"&&n.animationIsPlaying&&n.data.property===this.data.property&&(n.animationIsPlaying=!1)},addEventListeners:function(){var n=this.data,e=this.el;PP(e,n.startEvents,this.onStartEvent),PP(e,n.pauseEvents,this.pauseAnimation),PP(e,n.resumeEvents,this.resumeAnimation)},removeEventListeners:function(){var n=this.data,e=this.el;NP(e,n.startEvents,this.onStartEvent),NP(e,n.pauseEvents,this.pauseAnimation),NP(e,n.resumeEvents,this.resumeAnimation)},setColorConfig:function(n,e){y_.set(n),A_.set(e),n=this.fromColor,e=this.toColor,n.r=y_.r,n.g=y_.g,n.b=y_.b,e.r=A_.r,e.g=A_.g,e.b=A_.b}});var FP=Ki("components:anchored:warn");In("anchored",{schema:{persistent:{default:!1}},init:function(){var n=this.el.sceneEl.getAttribute("webxr"),e=n.optionalFeatures;e.indexOf("anchors")===-1&&(e.push("anchors"),this.el.sceneEl.setAttribute("webxr",n)),this.auxQuaternion=new Z.Quaternion,this.onEnterVR=this.onEnterVR.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR)},onEnterVR:function(){this.anchor=void 0,this.requestPersistentAnchorPending=this.data.persistent,this.requestAnchorPending=!this.data.persistent},tick:function(){var n,e,t,i=this.el.sceneEl,s=i.renderer.xr,l=this.el.object3D;(i.is("ar-mode")||i.is("vr-mode"))&&(!this.anchor&&this.requestPersistentAnchorPending&&this.restorePersistentAnchor(),!this.anchor&&this.requestAnchorPending&&this.createAnchor(),this.anchor&&(n=i.frame,e=s.getReferenceSpace(),t=n.getPose(this.anchor.anchorSpace,e),l.position.copy(t.transform.position),l.quaternion.copy(t.transform.orientation)))},createAnchor:async function(n,e){var t,i,s,l,u=this.el.sceneEl,d=u.renderer.xr,p=this.el.object3D;n=n||p.position,e=e||this.auxQuaternion.setFromEuler(p.rotation),function(g){var x=g.renderer.xr.getSession();return x&&x.restorePersistentAnchor}(u)?(this.anchor&&this.deleteAnchor(),t=u.frame,i=d.getReferenceSpace(),s=new XRRigidTransform({x:n.x,y:n.y,z:n.z},{x:e.x,y:e.y,z:e.z,w:e.w}),this.requestAnchorPending=!1,l=await t.createAnchor(s,i),this.data.persistent&&(this.el.id?(this.persistentHandle=await l.requestPersistentHandle(),localStorage.setItem(this.el.id,this.persistentHandle)):FP("The anchor won't be persisted because the entity has no assigned id.")),u.object3D.attach(this.el.object3D),this.anchor=l):FP("This browser doesn't support the WebXR anchors module")},restorePersistentAnchor:async function(){var n,e=this.el.sceneEl.renderer.xr.getSession(),t=e.persistentAnchors;if(this.requestPersistentAnchorPending=!1,!this.el.id)return FP("The entity associated to the persistent anchor cannot be retrieved because it doesn't have an assigned id."),void(this.requestAnchorPending=!0);if(t){n=localStorage.getItem(this.el.id);for(var i=0;i<t.length;++i)if(n===t[i]){this.anchor=await e.restorePersistentAnchor(t[i]),this.anchor&&(this.persistentHandle=t[i]);break}this.anchor||(this.requestAnchorPending=!0)}else this.requestPersistentAnchorPending=!0},deleteAnchor:function(){var n,e=this.anchor;e&&(n=this.el.sceneEl.renderer.xr.getSession(),e.delete(),this.el.sceneEl.object3D.add(this.el.object3D),this.persistentHandle&&n.deletePersistentAnchor(this.persistentHandle),this.anchor=void 0)}}),In("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function(){var n,e=this.el;n=this.camera=new Z.PerspectiveCamera,e.setObject3D("camera",n)},update:function(n){var e=this.data,t=this.camera;t.aspect=e.aspect||window.innerWidth/window.innerHeight,t.far=e.far,t.fov=e.fov,t.near=e.near,t.zoom=e.zoom,t.updateProjectionMatrix(),this.updateActiveCamera(n),this.updateSpectatorCamera(n)},updateActiveCamera:function(n){var e=this.data,t=this.el,i=this.system;n&&n.active===e.active||e.spectator||(e.active&&i.activeCameraEl!==t?i.setActiveCamera(t):e.active||i.activeCameraEl!==t||i.disableActiveCamera())},updateSpectatorCamera:function(n){var e=this.data,t=this.el,i=this.system;n&&n.spectator===e.spectator||(e.spectator&&i.spectatorCameraEl!==t?i.setSpectatorCamera(t):e.spectator||i.spectatorCameraEl!==t||i.disableSpectatorCamera())},remove:function(){this.el.removeObject3D("camera")}});var Hf,ag,Xf,$8,Q8="click",K8="mouseup",v_="cursor-fusing",OP="cursor-hovering",VP="cursor-hovered",b_={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]},x_={DOWN:["selectstart"],UP:["selectend"]},Z8="a-mouse-cursor-hover",Rqe=(In("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:Xp()},fuseTimeout:{default:1500,min:0},mouseCursorStylesEnabled:{default:!0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity","xrselect"]}},after:["tracked-controls"],multiple:!0,init:function(){var n=this;this.fuseTimeout=void 0,this.cursorDownEl=null,this.intersectedEl=null,this.canvasBounds=document.body.getBoundingClientRect(),this.isCursorDown=!1,this.activeXRInput=null,this.updateCanvasBounds=Dse(function(){n.canvasBounds=n.el.sceneEl.canvas.getBoundingClientRect()},500),this.eventDetail={},this.intersectedEventDetail={cursorEl:this.el},this.onCursorDown=this.onCursorDown.bind(this),this.onCursorUp=this.onCursorUp.bind(this),this.onIntersection=this.onIntersection.bind(this),this.onIntersectionCleared=this.onIntersectionCleared.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onEnterVR=this.onEnterVR.bind(this)},update:function(n){var e=this.data.rayOrigin;e!==n.rayOrigin&&(e==="entity"&&this.resetRaycaster(),this.updateMouseEventListeners(),e!=="xrselect"&&e!=="entity"||this.addWebXREventListeners(),n.rayOrigin!=="xrselect"&&n.rayOrigin!=="entity"||this.removeWebXREventListeners())},tick:function(){var n=this.el.sceneEl.frame,e=this.activeXRInput;this.data.rayOrigin==="xrselect"&&n&&e&&this.onMouseMove({frame:n,inputSource:e,type:"fakeselectevent"})},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){var n=this.el;n.removeState(OP),n.removeState(v_),clearTimeout(this.fuseTimeout),this.intersectedEl&&this.intersectedEl.removeState(VP),this.removeEventListeners()},addEventListeners:function(){var n,e=this.data,t=this.el,i=this;function s(){n=t.sceneEl.canvas,e.downEvents.length||e.upEvents.length||(b_.DOWN.forEach(function(l){n.addEventListener(l,i.onCursorDown,{passive:!1})}),b_.UP.forEach(function(l){n.addEventListener(l,i.onCursorUp,{passive:!1})}))}(n=t.sceneEl.canvas)?s():t.sceneEl.addEventListener("render-target-loaded",s),e.downEvents.forEach(function(l){t.addEventListener(l,i.onCursorDown)}),e.upEvents.forEach(function(l){t.addEventListener(l,i.onCursorUp)}),t.addEventListener("raycaster-intersection",this.onIntersection),t.addEventListener("raycaster-closest-entity-changed",this.onIntersection),t.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),t.sceneEl.addEventListener("rendererresize",this.updateCanvasBounds),t.sceneEl.addEventListener("enter-vr",this.onEnterVR),window.addEventListener("resize",this.updateCanvasBounds),window.addEventListener("scroll",this.updateCanvasBounds),this.updateMouseEventListeners()},removeEventListeners:function(){var n,e=this.data,t=this.el,i=this;!(n=t.sceneEl.canvas)||e.downEvents.length||e.upEvents.length||(b_.DOWN.forEach(function(s){n.removeEventListener(s,i.onCursorDown)}),b_.UP.forEach(function(s){n.removeEventListener(s,i.onCursorUp)})),e.downEvents.forEach(function(s){t.removeEventListener(s,i.onCursorDown)}),e.upEvents.forEach(function(s){t.removeEventListener(s,i.onCursorUp)}),t.removeEventListener("raycaster-intersection",this.onIntersection),t.removeEventListener("raycaster-closest-entity-changed",this.onIntersection),t.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared),n.removeEventListener("mousemove",this.onMouseMove),n.removeEventListener("touchstart",this.onMouseMove),n.removeEventListener("touchmove",this.onMouseMove),t.sceneEl.removeEventListener("rendererresize",this.updateCanvasBounds),t.sceneEl.removeEventListener("enter-vr",this.onEnterVR),window.removeEventListener("resize",this.updateCanvasBounds),window.removeEventListener("scroll",this.updateCanvasBounds),this.removeWebXREventListeners()},updateMouseEventListeners:function(){var n,e=this.el;(n=e.sceneEl.canvas).removeEventListener("mousemove",this.onMouseMove),n.removeEventListener("touchmove",this.onMouseMove),e.setAttribute("raycaster","useWorldCoordinates",!1),this.data.rayOrigin==="mouse"&&(n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("touchmove",this.onMouseMove,{passive:!1}),e.setAttribute("raycaster","useWorldCoordinates",!0),this.updateCanvasBounds())},resetRaycaster:function(){this.el.setAttribute("raycaster",{direction:new Z.Vector3().set(0,0,-1),origin:new Z.Vector3})},addWebXREventListeners:function(){var n=this,e=this.el.sceneEl.xrSession;e&&(x_.DOWN.forEach(function(t){e.addEventListener(t,n.onCursorDown)}),x_.UP.forEach(function(t){e.addEventListener(t,n.onCursorUp)}))},removeWebXREventListeners:function(){var n=this,e=this.el.sceneEl.xrSession;e&&(x_.DOWN.forEach(function(t){e.removeEventListener(t,n.onCursorDown)}),x_.UP.forEach(function(t){e.removeEventListener(t,n.onCursorUp)}))},onMouseMove:(Hf=new Z.Vector3,ag=new Z.Vector2,Xf=new Z.Vector3,$8={origin:Xf,direction:Hf},function(n){var e,t,i,s,l,u,d,p,g,x=this.canvasBounds,b=this.el.sceneEl.camera;b.parent.updateMatrixWorld(),t=(i=n.type==="touchmove"||n.type==="touchstart"?n.touches.item(0):n).clientX-x.left,s=i.clientY-x.top,ag.x=t/x.width*2-1,ag.y=-s/x.height*2+1,this.data.rayOrigin!=="xrselect"||n.type!=="selectstart"&&n.type!=="fakeselectevent"?n.type==="fakeselectout"?(Hf.set(0,1,0),Xf.set(0,9999,0)):b&&b.isPerspectiveCamera?(Xf.setFromMatrixPosition(b.matrixWorld),Hf.set(ag.x,ag.y,.5).unproject(b).sub(Xf).normalize()):b&&b.isOrthographicCamera?(Xf.set(ag.x,ag.y,(b.near+b.far)/(b.near-b.far)).unproject(b),Hf.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("AFRAME.Raycaster: Unsupported camera type: "+b.type):(l=n.frame,u=n.inputSource,d=this.el.sceneEl.renderer.xr.getReferenceSpace(),(p=l.getPose(u.targetRaySpace,d))&&(g=p.transform,Hf.set(0,0,-1),Hf.applyQuaternion(g.orientation),Xf.copy(g.position),(e=b.el.object3D.parent).localToWorld(Xf),Hf.transformDirection(e.matrixWorld))),this.el.setAttribute("raycaster",$8),n.type==="touchmove"&&n.preventDefault()}),onCursorDown:function(n){this.isCursorDown=!0,this.data.rayOrigin==="mouse"&&n.type==="touchstart"&&(this.onMouseMove(n),this.el.components.raycaster.checkIntersections(),n.preventDefault()),this.data.rayOrigin==="xrselect"&&n.type==="selectstart"&&(this.activeXRInput=n.inputSource,this.onMouseMove(n),this.el.components.raycaster.checkIntersections(),this.el.components.raycaster.intersectedEls.length&&this.el.sceneEl.components["ar-hit-test"]!==void 0&&this.el.sceneEl.getAttribute("ar-hit-test").enabled&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!1),this.reenableARHitTest=!0)),this.twoWayEmit("mousedown",n),this.cursorDownEl=this.intersectedEl},onCursorUp:function(n){if(this.isCursorDown&&(this.data.rayOrigin!=="xrselect"||this.activeXRInput===n.inputSource)){this.isCursorDown=!1;var e=this.data;this.twoWayEmit(K8,n),this.reenableARHitTest===!0&&(this.el.sceneEl.setAttribute("ar-hit-test","enabled",!0),this.reenableARHitTest=void 0),this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl&&(this.intersectedEventDetail.intersection=null,this.cursorDownEl.emit(K8,this.intersectedEventDetail)),e.fuse&&e.rayOrigin!=="mouse"&&e.rayOrigin!=="xrselect"||!this.intersectedEl||this.cursorDownEl!==this.intersectedEl||this.twoWayEmit(Q8,n),e.rayOrigin==="xrselect"&&this.onMouseMove({type:"fakeselectout"}),this.activeXRInput=null,this.cursorDownEl=null,n.type==="touchend"&&n.preventDefault()}},onIntersection:function(n){var e,t,i,s,l=this.el;t=n.detail.els[0]===l?1:0,s=n.detail.intersections[t],(i=n.detail.els[t])&&this.intersectedEl!==i&&(this.intersectedEl&&(e=this.el.components.raycaster.getIntersection(this.intersectedEl))&&e.distance<=s.distance||(this.clearCurrentIntersection(!0),this.setIntersection(i,s)))},onIntersectionCleared:function(n){n.detail.clearedEls.indexOf(this.intersectedEl)!==-1&&this.clearCurrentIntersection()},onEnterVR:function(){var n=this.data.rayOrigin;this.clearCurrentIntersection(!0),n!=="xrselect"&&n!=="entity"||this.addWebXREventListeners()},setIntersection:function(n,e){var t=this.el,i=this.data,s=this;this.intersectedEl!==n&&(this.intersectedEl=n,t.addState(OP),n.addState(VP),this.twoWayEmit("mouseenter"),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.add(Z8),i.fuseTimeout!==0&&i.fuse&&i.rayOrigin!=="xrselect"&&i.rayOrigin!=="mouse"&&(t.addState(v_),this.twoWayEmit("fusing"),this.fuseTimeout=setTimeout(function(){t.removeState(v_),s.twoWayEmit(Q8)},i.fuseTimeout)))},clearCurrentIntersection:function(n){var e,t,i=this.el;this.intersectedEl&&(this.intersectedEl.removeState(VP),i.removeState(OP),i.removeState(v_),this.twoWayEmit("mouseleave"),this.data.mouseCursorStylesEnabled&&this.data.rayOrigin==="mouse"&&this.el.sceneEl.canvas.classList.remove(Z8),this.intersectedEl=null,clearTimeout(this.fuseTimeout),n!==!0&&(t=this.el.components.raycaster.intersections).length!==0&&(e=t[t[0].object.el===i?1:0])&&this.setIntersection(e.object.el,e))},twoWayEmit:function(n,e){var t,i=this.el,s=this.intersectedEl;function l(u,d){e instanceof MouseEvent?u.mouseEvent=e:typeof TouchEvent<"u"&&e instanceof TouchEvent&&(u.touchEvent=e)}t=this.el.components.raycaster.getIntersection(s),this.eventDetail.intersectedEl=s,this.eventDetail.intersection=t,l(this.eventDetail),i.emit(n,this.eventDetail),s&&(this.intersectedEventDetail.intersection=t,l(this.intersectedEventDetail),s.emit(n,this.intersectedEventDetail))}}),new Z.BufferGeometry),j8=(In("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:dU,schemaChange:!0},skipCache:{default:!1}},init:function(){this.geometry=null},update:function(n){var e,t=this.data,i=this.el,s=this.system;this.geometry&&(s.unuseGeometry(n),this.geometry=null),this.geometry=s.getOrCreateGeometry(t),(e=i.getObject3D("mesh"))?e.geometry=this.geometry:((e=new Z.Mesh).geometry=this.geometry,this.el.getAttribute("material")||(e.material=new Z.MeshStandardMaterial({color:16777215*Math.random(),metalness:0,roughness:.5})),i.setObject3D("mesh",e))},remove:function(){this.system.unuseGeometry(this.data),this.el.getObject3D("mesh").geometry=Rqe,this.geometry=null},updateSchema:function(n){var e=this.oldData&&this.oldData.primitive,t=n.primitive,i=$p[t]&&$p[t].schema;if(!i)throw new Error("Unknown geometry schema `"+t+"`");e&&e===t||this.extendSchema(i)}}),"generic"),Lqe=(In("generic-tracked-controller-controls",{schema:{hand:{default:""},defaultModel:{default:!0},defaultModelColor:{default:"gray"},disabled:{default:!1}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick"]},bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var n=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.controllerPresent=!1,this.wasControllerConnected=!1,this.bindMethods(),this.el.addEventListener("controllerconnected",function(e){e.detail.name!==n.name&&(n.wasControllerConnected=!0,n.removeEventListeners(),n.removeControllersUpdateListener())})},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data,e=n.hand?n.hand:void 0;Nl(this,j8,{hand:e,iterateControllerProfiles:!0})},play:function(){this.wasControllerConnected||(this.checkIfControllerPresent(),this.addControllersUpdateListener())},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var n=this.el,e=this.data;this.el.components["tracked-controls"]?this.removeEventListeners():(n.setAttribute("tracked-controls",{hand:e.hand,idPrefix:j8,iterateControllerProfiles:!0}),this.data.defaultModel&&this.initDefaultModel())},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.wasControllerConnected&&this.checkIfControllerPresent()},onButtonChanged:function(n){var e=this.mapping.buttons[n.detail.id];e&&this.el.emit(e+"changed",n.detail.state)},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},initDefaultModel:function(){var n=this.modelEl=document.createElement("a-entity");n.setAttribute("geometry",{primitive:"sphere",radius:.03}),n.setAttribute("material",{color:this.data.color}),this.el.appendChild(n),this.el.emit("controllermodelready",{name:"generic-tracked-controller-controls",model:this.modelEl,rayOrigin:{origin:{x:0,y:0,z:-.01},direction:{x:0,y:0,z:-1}}})}}),Ki("components:gltf-model:warn"));In("gltf-model",{schema:{type:"model"},init:function(){var n=this,e=this.system.getDRACOLoader(),t=this.system.getMeshoptDecoder(),i=this.system.getKTX2Loader();this.model=null,this.loader=new XV,e&&this.loader.setDRACOLoader(e),this.ready=t?t.then(function(s){n.loader.setMeshoptDecoder(s)}):Promise.resolve(),i&&this.loader.setKTX2Loader(i)},update:function(){var n=this,e=this.el,t=this.data;t&&(this.remove(),this.ready.then(function(){n.loader.load(t,function(i){n.model=i.scene||i.scenes[0],n.model.animations=i.animations,e.setObject3D("mesh",n.model),e.emit("model-loaded",{format:"gltf",model:n.model})},void 0,function(i){var s=i&&i.message?i.message:"Failed to load glTF model";Lqe(s),e.emit("model-error",{format:"gltf",src:t})})}))},remove:function(){this.model&&this.el.removeObject3D("mesh")}}),In("grabbable",{init:function(){this.el.setAttribute("obb-collider","centerModel: true")}});var w_,Bqe=as+"controllers/oculus-hands/v4/left.glb",Pqe=as+"controllers/oculus-hands/v4/right.glb",UP=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"];In("hand-tracking-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},modelStyle:{default:"mesh",oneOf:["dots","mesh"]},modelColor:{default:"white"},modelOpacity:{default:1}},after:["tracked-controls"],bindMethods:function(){this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this)},addEventListeners:function(){this.el.addEventListener("model-loaded",this.onModelLoaded);for(var n=0;n<this.jointEls.length;++n)this.jointEls[n].object3D.visible=!0},removeEventListeners:function(){this.el.removeEventListener("model-loaded",this.onModelLoaded);for(var n=0;n<this.jointEls.length;++n)this.jointEls[n].object3D.visible=!1},init:function(){var n=this.el.sceneEl,e=n.getAttribute("webxr"),t=e.optionalFeatures;t.indexOf("hand-tracking")===-1&&(t.push("hand-tracking"),n.setAttribute("webxr",e)),this.wristObject3D=new Z.Object3D,this.el.sceneEl.object3D.add(this.wristObject3D),this.onModelLoaded=this.onModelLoaded.bind(this),this.onChildAttached=this.onChildAttached.bind(this),this.jointEls=[],this.controllerPresent=!1,this.isPinched=!1,this.pinchEventDetail={position:new Z.Vector3,wristRotation:new Z.Quaternion},this.indexTipPosition=new Z.Vector3,this.hasPoses=!1,this.jointPoses=new Float32Array(16*UP.length),this.jointRadii=new Float32Array(UP.length),this.bindMethods(),this.updateReferenceSpace=this.updateReferenceSpace.bind(this),this.el.sceneEl.addEventListener("enter-vr",this.updateReferenceSpace),this.el.sceneEl.addEventListener("exit-vr",this.updateReferenceSpace),this.el.addEventListener("child-attached",this.onChildAttached),this.wristObject3D.visible=!1},onChildAttached:function(n){this.addChildEntity(n.detail.el)},update:function(){this.updateModelMaterial()},updateModelMaterial:function(){var n=this.jointEls,e=this.skinnedMesh,t=this.data.modelOpacity!==1;e&&(this.skinnedMesh.material.color.set(this.data.modelColor),this.skinnedMesh.material.transparent=t,this.skinnedMesh.material.opacity=this.data.modelOpacity);for(var i=0;i<n.length;i++)n[i].setAttribute("material",{color:this.data.modelColor,transparent:t,opacity:this.data.modelOpacity})},updateReferenceSpace:function(){var n=this,e=this.el.sceneEl.xrSession;if(this.referenceSpace=void 0,e){var t=n.el.sceneEl.systems.webxr.sessionReferenceSpaceType;e.requestReferenceSpace(t).then(function(i){n.referenceSpace=i}).catch(function(i){throw n.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(t,"tracked-controls-webxr uses reference space "+t),i})}},checkIfControllerPresent:function(){var n=this.data;Nl(this,"",{hand:n.hand?n.hand:void 0,iterateControllerProfiles:!0,handTracking:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},tick:function(){var n=this.el.sceneEl,e=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,t=n.frame,i=this.el.components["tracked-controls"],s=this.referenceSpace;e&&t&&s&&i&&(this.hasPoses=!1,e.hand&&(this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),this.hasPoses=t.fillPoses(e.hand.values(),s,this.jointPoses)&&t.fillJointRadii(e.hand.values(),this.jointRadii),this.updateHandModel(),this.detectGesture(),this.updateWristObject()))},updateWristObject:(w_=new Z.Matrix4,function(){var n=this.wristObject3D;n&&this.hasPoses&&(w_.fromArray(this.jointPoses,0),n.position.setFromMatrixPosition(w_),n.quaternion.setFromRotationMatrix(w_))}),updateHandModel:function(){this.wristObject3D.visible=!0,this.el.object3D.visible=!0,this.data.modelStyle==="dots"&&this.updateHandDotsModel(),this.data.modelStyle==="mesh"&&this.updateHandMeshModel()},getBone:function(n){for(var e=this.bones,t=0;t<e.length;t++)if(e[t].name===n)return e[t];return null},updateHandMeshModel:function(){var n=new Z.Matrix4;return function(){var e=0,t=this.jointPoses,i=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller;if(i&&this.mesh&&(this.mesh.visible=!1,this.hasPoses))for(var s of i.hand.values()){var l=this.getBone(s.jointName);l!=null&&(this.mesh.visible=!0,n.fromArray(t,16*e),l.position.setFromMatrixPosition(n),l.quaternion.setFromRotationMatrix(n)),e++}}}(),updateHandDotsModel:function(){for(var n,e,t=this.jointPoses,i=this.jointRadii,s=this.el.components["tracked-controls"]&&this.el.components["tracked-controls"].controller,l=0;l<s.hand.size;l++)e=(n=this.jointEls[l]).object3D,n.object3D.visible=this.hasPoses,this.hasPoses&&(e.matrix.fromArray(t,16*l),e.matrix.decompose(e.position,e.rotation,e.scale),n.setAttribute("scale",{x:i[l],y:i[l],z:i[l]}))},detectGesture:function(){this.detectPinch()},detectPinch:function(){var n=new Z.Vector3,e=new Z.Matrix4;return function(){var t=this.indexTipPosition,i=this.pinchEventDetail;if(this.hasPoses){n.setFromMatrixPosition(e.fromArray(this.jointPoses,64)),t.setFromMatrixPosition(e.fromArray(this.jointPoses,144)),i.wristRotation.setFromRotationMatrix(e.fromArray(this.jointPoses,0));var s=t.distanceTo(n);s<.015&&this.isPinched===!1&&(this.isPinched=!0,i.position.copy(t).add(n).multiplyScalar(.5),this.el.emit("pinchstarted",i)),s>.02&&this.isPinched===!0&&(this.isPinched=!1,i.position.copy(t).add(n).multiplyScalar(.5),this.el.emit("pinchended",i)),this.isPinched&&(i.position.copy(t).add(n).multiplyScalar(.5),this.el.emit("pinchmoved",i))}}}(),pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{id:"",hand:e.hand,iterateControllerProfiles:!0,handTrackingEnabled:!0}),this.mesh?this.mesh!==n.getObject3D("mesh")&&n.setObject3D("mesh",this.mesh):this.initDefaultModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){var n,e=this.el;this.checkIfControllerPresent(),n=e.components["tracked-controls"]&&e.components["tracked-controls"].controller,this.mesh&&n&&n.hand&&n.hand instanceof XRHand&&e.setObject3D("mesh",this.mesh)},initDefaultModel:function(){var n=this.data;n.modelStyle==="dots"&&this.initDotsModel(),n.modelStyle==="mesh"&&this.initMeshHandModel(),this.el.object3D.visible=!0,this.wristObject3D.visible=!0},initDotsModel:function(){if(this.jointEls.length===0){for(var n=0;n<UP.length;++n){var e=this.jointEl=document.createElement("a-entity");e.setAttribute("geometry",{primitive:"sphere",radius:1}),e.object3D.visible=!1,this.el.appendChild(e),this.jointEls.push(e)}this.updateModelMaterial()}},initMeshHandModel:function(){var n=this.data.hand==="left"?Bqe:Pqe;this.el.setAttribute("gltf-model",n)},onModelLoaded:function(){var n=this.mesh=this.el.getObject3D("mesh").children[0],e=this.skinnedMesh=n.getObjectByProperty("type","SkinnedMesh");this.skinnedMesh&&(this.bones=e.skeleton.bones,this.el.removeObject3D("mesh"),n.position.set(0,0,0),n.rotation.set(0,0,0),e.frustumCulled=!1,e.material=new Z.MeshStandardMaterial,this.updateModelMaterial(),this.setupChildrenEntities(),this.el.setObject3D("mesh",n),this.el.emit("controllermodelready",{name:"hand-tracking-controls",model:this.data.model,rayOrigin:new Z.Vector3(0,0,0)}))},setupChildrenEntities:function(){for(var n=this.el.children,e=0;e<n.length;++e)n[e]instanceof Us&&this.addChildEntity(n[e])},addChildEntity:function(n){n instanceof Us&&this.wristObject3D.add(n.object3D)}}),In("hand-tracking-grab-controls",{schema:{hand:{default:"right",oneOf:["left","right"]},color:{type:"color",default:"white"},hoverColor:{type:"color",default:"#538df1"},hoverEnabled:{default:!1}},init:function(){var n,e=this.el,t=this.data;n=t.hand==="right"?"components.hand-tracking-controls.bones.3":"components.hand-tracking-controls.bones.21",e.setAttribute("hand-tracking-controls",{hand:t.hand}),e.setAttribute("obb-collider",{trackedObject3D:n,size:.04}),this.auxMatrix=new Z.Matrix4,this.onCollisionStarted=this.onCollisionStarted.bind(this),this.el.addEventListener("obbcollisionstarted",this.onCollisionStarted),this.onCollisionEnded=this.onCollisionEnded.bind(this),this.el.addEventListener("obbcollisionended",this.onCollisionEnded),this.onPinchStarted=this.onPinchStarted.bind(this),this.el.addEventListener("pinchstarted",this.onPinchStarted),this.onPinchEnded=this.onPinchEnded.bind(this),this.el.addEventListener("pinchended",this.onPinchEnded)},transferEntityOwnership:function(){for(var n,e=this.el.sceneEl.querySelectorAll("[hand-tracking-grab-controls]"),t=0;t<e.length;++t)(n=e[t].components["hand-tracking-grab-controls"])!==this&&this.grabbedEl&&this.grabbedEl===n.grabbedEl&&n.releaseGrabbedEntity();return!1},onCollisionStarted:function(n){var e=n.detail.withEl;this.collidedEl||e.getAttribute("grabbable")&&(this.collidedEl=e,this.grabbingObject3D=n.detail.trackedObject3D,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.hoverColor))},onCollisionEnded:function(){this.collidedEl=void 0,this.grabbedEl||(this.grabbingObject3D=void 0,this.data.hoverEnabled&&this.el.setAttribute("hand-tracking-controls","modelColor",this.data.color))},onPinchStarted:function(n){this.collidedEl&&(this.grabbedEl=this.collidedEl,this.transferEntityOwnership(),this.grab())},onPinchEnded:function(){this.releaseGrabbedEntity()},releaseGrabbedEntity:function(){var n=this.grabbedEl;if(n){var e=n.object3D,t=e.parent,i=this.originalParent;e.applyMatrix4(t.matrixWorld),e.applyMatrix4(this.auxMatrix.copy(i.matrixWorld).invert()),t.remove(e),i.add(e),this.el.emit("grabended",{grabbedEl:n}),this.grabbedEl=void 0,this.originalParent=void 0}},grab:function(){var n=this.grabbedEl,e=n.object3D,t=e.parent;this.originalParent=t;var i=this.el.components["hand-tracking-controls"].wristObject3D;e.applyMatrix4(t.matrixWorld),e.applyMatrix4(this.auxMatrix.copy(i.matrixWorld).invert()),t.remove(e),i.add(e),this.el.emit("grabstarted",{grabbedEl:n})}});var Nqe={toonLeft:as+"controllers/hands/leftHand.glb",toonRight:as+"controllers/hands/rightHand.glb",lowPolyLeft:as+"controllers/hands/leftHandLow.glb",lowPolyRight:as+"controllers/hands/rightHandLow.glb",highPolyLeft:as+"controllers/hands/leftHandHigh.glb",highPolyRight:as+"controllers/hands/rightHandHigh.glb"},zP="Point",GP="Fist",Y8="Thumb Up",vI={};function q8(n,e){var t;if(n)return(t=vI[n])==="grip"?t+(e?"close":"open"):t==="point"?t+(e?"up":"down"):t==="pointing"||t==="pistol"?t+(e?"start":"end"):void 0}vI[GP]="grip",vI[Y8]="pistol",vI[zP]="pointing",In("hand-controls",{schema:{color:{default:"white",type:"color"},hand:{default:"left"},handModelStyle:{default:"lowPoly",oneOf:["lowPoly","highPoly","toon"]}},after:["tracked-controls"],init:function(){var n=this,e=this.el;this.pressedButtons={},this.touchedButtons={},this.loader=new XV,this.loader.setCrossOrigin("anonymous"),this.onGripDown=function(){n.handleButton("grip","down")},this.onGripUp=function(){n.handleButton("grip","up")},this.onTrackpadDown=function(){n.handleButton("trackpad","down")},this.onTrackpadUp=function(){n.handleButton("trackpad","up")},this.onTrackpadTouchStart=function(){n.handleButton("trackpad","touchstart")},this.onTrackpadTouchEnd=function(){n.handleButton("trackpad","touchend")},this.onTriggerDown=function(){n.handleButton("trigger","down")},this.onTriggerUp=function(){n.handleButton("trigger","up")},this.onTriggerTouchStart=function(){n.handleButton("trigger","touchstart")},this.onTriggerTouchEnd=function(){n.handleButton("trigger","touchend")},this.onGripTouchStart=function(){n.handleButton("grip","touchstart")},this.onGripTouchEnd=function(){n.handleButton("grip","touchend")},this.onThumbstickDown=function(){n.handleButton("thumbstick","down")},this.onThumbstickUp=function(){n.handleButton("thumbstick","up")},this.onAorXTouchStart=function(){n.handleButton("AorX","touchstart")},this.onAorXTouchEnd=function(){n.handleButton("AorX","touchend")},this.onBorYTouchStart=function(){n.handleButton("BorY","touchstart")},this.onBorYTouchEnd=function(){n.handleButton("BorY","touchend")},this.onSurfaceTouchStart=function(){n.handleButton("surface","touchstart")},this.onSurfaceTouchEnd=function(){n.handleButton("surface","touchend")},this.onControllerConnected=this.onControllerConnected.bind(this),this.onControllerDisconnected=this.onControllerDisconnected.bind(this),e.addEventListener("controllerconnected",this.onControllerConnected),e.addEventListener("controllerdisconnected",this.onControllerDisconnected),e.object3D.visible=!1},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},tick:function(n,e){var t=this.el.getObject3D("mesh");t&&t.mixer&&t.mixer.update(e/1e3)},onControllerConnected:function(n){var e=this.el,t=this.data.hand,i=this.el.getObject3D("mesh");e.object3D.visible=!0;var s=t==="left"?Math.PI/2:-Math.PI/2,l=e.sceneEl.hasWebXR?-Math.PI/2:0;n.detail.name==="pico-controls"&&(l+=Math.PI/4),i.position.set(0,0,0),i.rotation.set(l,0,s)},onControllerDisconnected:function(){this.el.object3D.visible=!1},addEventListeners:function(){var n=this.el;n.addEventListener("gripdown",this.onGripDown),n.addEventListener("gripup",this.onGripUp),n.addEventListener("trackpaddown",this.onTrackpadDown),n.addEventListener("trackpadup",this.onTrackpadUp),n.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart),n.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd),n.addEventListener("triggerdown",this.onTriggerDown),n.addEventListener("triggerup",this.onTriggerUp),n.addEventListener("triggertouchstart",this.onTriggerTouchStart),n.addEventListener("triggertouchend",this.onTriggerTouchEnd),n.addEventListener("griptouchstart",this.onGripTouchStart),n.addEventListener("griptouchend",this.onGripTouchEnd),n.addEventListener("thumbstickdown",this.onThumbstickDown),n.addEventListener("thumbstickup",this.onThumbstickUp),n.addEventListener("abuttontouchstart",this.onAorXTouchStart),n.addEventListener("abuttontouchend",this.onAorXTouchEnd),n.addEventListener("bbuttontouchstart",this.onBorYTouchStart),n.addEventListener("bbuttontouchend",this.onBorYTouchEnd),n.addEventListener("xbuttontouchstart",this.onAorXTouchStart),n.addEventListener("xbuttontouchend",this.onAorXTouchEnd),n.addEventListener("ybuttontouchstart",this.onBorYTouchStart),n.addEventListener("ybuttontouchend",this.onBorYTouchEnd),n.addEventListener("surfacetouchstart",this.onSurfaceTouchStart),n.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function(){var n=this.el;n.removeEventListener("gripdown",this.onGripDown),n.removeEventListener("gripup",this.onGripUp),n.removeEventListener("trackpaddown",this.onTrackpadDown),n.removeEventListener("trackpadup",this.onTrackpadUp),n.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart),n.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd),n.removeEventListener("triggerdown",this.onTriggerDown),n.removeEventListener("triggerup",this.onTriggerUp),n.removeEventListener("triggertouchstart",this.onTriggerTouchStart),n.removeEventListener("triggertouchend",this.onTriggerTouchEnd),n.removeEventListener("griptouchstart",this.onGripTouchStart),n.removeEventListener("griptouchend",this.onGripTouchEnd),n.removeEventListener("thumbstickdown",this.onThumbstickDown),n.removeEventListener("thumbstickup",this.onThumbstickUp),n.removeEventListener("abuttontouchstart",this.onAorXTouchStart),n.removeEventListener("abuttontouchend",this.onAorXTouchEnd),n.removeEventListener("bbuttontouchstart",this.onBorYTouchStart),n.removeEventListener("bbuttontouchend",this.onBorYTouchEnd),n.removeEventListener("xbuttontouchstart",this.onAorXTouchStart),n.removeEventListener("xbuttontouchend",this.onAorXTouchEnd),n.removeEventListener("ybuttontouchstart",this.onBorYTouchStart),n.removeEventListener("ybuttontouchend",this.onBorYTouchEnd),n.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart),n.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function(n){var e,t=this.el,i=this.data.hand,s=this.data.handModelStyle,l=this.data.color,u=this;if(e={hand:i,model:!1},i!==n){var d=Nqe[s+i.charAt(0).toUpperCase()+i.slice(1)];this.loader.load(d,function(p){var g=p.scene.children[0];g.mixer=new Z.AnimationMixer(g),u.clips=p.animations,t.setObject3D("mesh",g),g.traverse(function(x){x.isMesh&&(x.material.color=new Z.Color(l))}),t.setAttribute("magicleap-controls",e),t.setAttribute("vive-controls",e),t.setAttribute("meta-touch-controls",e),t.setAttribute("pico-controls",e),t.setAttribute("windows-motion-controls",e),t.setAttribute("hp-mixed-reality-controls",e)})}},remove:function(){this.el.removeObject3D("mesh")},handleButton:function(n,e){var t,i=e==="down",s=e==="touchstart";if(e.indexOf("touch")===0){if(s===this.touchedButtons[n])return;this.touchedButtons[n]=s}else{if(i===this.pressedButtons[n])return;this.pressedButtons[n]=i}t=this.gesture,this.gesture=this.determineGesture(),this.gesture!==t&&(this.animateGesture(this.gesture,t),this.emitGestureEvents(this.gesture,t))},determineGesture:function(){var n,e,t,i=this.pressedButtons.grip,s=this.pressedButtons.surface||this.touchedButtons.surface,l=this.pressedButtons.trackpad||this.touchedButtons.trackpad,u=this.pressedButtons.trigger||this.touchedButtons.trigger,d=this.touchedButtons.AorX||this.touchedButtons.BorY;return e=this.el.components["tracked-controls"],(t=e&&e.controller)&&(t.id&&t.id.indexOf("OpenVR ")===0||t.profiles&&t.profiles[0]&&t.profiles[0]==="htc-vive")?i||u?n=GP:l&&(n=zP):i?n=s||d||l?u?GP:zP:u?Y8:"Point + Thumb":u&&(n="Hold"),n},getClip:function(n){var e,t;for(t=0;t<this.clips.length;t++)if((e=this.clips[t]).name===n)return e},animateGesture:function(n,e){n?this.playAnimation(n||"Open",e,!1):this.playAnimation(e,e,!0)},emitGestureEvents:function(n,e){var t,i=this.el;e!==n&&((t=q8(e,!1))&&i.emit(t),(t=q8(n,!0))&&i.emit(t))},playAnimation:function(n,e,t){var i,s,l=this.el.getObject3D("mesh");if(l){if(i=this.getClip(n),s=l.mixer.clipAction(i),t)return s.paused=!1,void(s.timeScale=-1);if(s.clampWhenFinished=!0,s.loop=Z.LoopOnce,s.repetitions=0,s.timeScale=1,s.time=0,s.weight=1,!e)return l.mixer.stopAllAction(),void s.play();i=this.getClip(e),s.reset(),s.play(),l.mixer.clipAction(i).crossFadeTo(s,.15,!0)}}}),In("hide-on-enter-ar",{init:function(){var n=this;this.el.sceneEl.addEventListener("enter-vr",function(){n.el.sceneEl.is("ar-mode")&&(n.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){n.el.object3D.visible=!0})}}),In("hide-on-enter-vr",{init:function(){var n=this;this.el.sceneEl.addEventListener("enter-vr",function(){n.el.sceneEl.is("vr-mode")&&(n.el.object3D.visible=!1)}),this.el.sceneEl.addEventListener("exit-vr",function(){n.el.object3D.visible=!0})}});var J8="hp-mixed-reality",Dqe=as+"controllers/hp/mixed-reality/",Fqe={x:0,y:0,z:.06},Oqe={_x:Math.PI/4,_y:0,_z:0,_order:"XYZ"},Vqe=(In("hp-mixed-reality-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{touchpad:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var n=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n,n.data.hand)},this.onButtonUp=function(e){ri(e.detail.id,"up",n,n.data.hand)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n,n.data.hand)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n,n.data.hand)},this.previousButtonValues={},this.bindMethods()},update:function(){var n=this.data;this.controllerIndex=n.hand==="right"?0:n.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data;Nl(this,J8,{index:this.controllerIndex,hand:n.hand})},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{idPrefix:J8,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",Dqe+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping[this.data.hand].buttons[n.detail.id];t&&(t==="trigger"&&(e=n.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){var e=n.detail.model;this.data.model&&(e.position.copy(Fqe),e.rotation.copy(Oqe),this.el.emit("controllermodelready",{name:"hp-mixed-reality-controls",model:this.data.model,rayOrigin:new Z.Vector3(0,0,0)}))},onAxisMoved:function(n){gc(this,this.mapping.axes,n)}}),Ki("components:layer:warn"));function ej(n,e,t){return(e.dot(n)-e.dot(t))/e.length()}In("layer",{schema:{type:{default:"quad",oneOf:["quad","monocubemap","stereocubemap"]},src:{type:"map"},rotateCubemap:{default:!1},width:{default:0},height:{default:0}},init:function(){var n=this.el.sceneEl.renderer.getContext();this.quaternion=new Z.Quaternion,this.position=new Z.Vector3,this.bindMethods(),this.needsRedraw=!1,this.frameBuffer=n.createFramebuffer();var e=this.el.sceneEl.getAttribute("webxr"),t=e.requiredFeatures;t.indexOf("layers")===-1&&(t.push("layers"),this.el.sceneEl.setAttribute("webxr",e)),this.el.sceneEl.addEventListener("enter-vr",this.onEnterVR),this.el.sceneEl.addEventListener("exit-vr",this.onExitVR)},bindMethods:function(){this.onRequestedReferenceSpace=this.onRequestedReferenceSpace.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this)},update:function(n){this.data.src!==n.src&&this.updateSrc()},updateSrc:function(){var n=this.data.type;this.texture=void 0,n!=="quad"?n!=="monocubemap"&&n!=="stereocubemap"||this.loadCubeMapImages():this.loadQuadImage()},loadCubeMapImages:function(){var n,e=this.xrGLFactory,t=this.el.sceneEl.frame,i=this.data.src,s=this.data.type;this.visibilityChanged=!1,this.layer&&(s!=="monocubemap"&&s!=="stereocubemap"||(i.complete?this.pendingCubeMapUpdate=!1:this.pendingCubeMapUpdate=!0,this.loadingScreen?this.loadingScreen=!1:this.loadingScreen=!0,s==="monocubemap"?(n=e.getSubImage(this.layer,t),this.loadCubeMapImage(n.colorTexture,i,0)):(n=e.getSubImage(this.layer,t,"left"),this.loadCubeMapImage(n.colorTexture,i,0),n=e.getSubImage(this.layer,t,"right"),this.loadCubeMapImage(n.colorTexture,i,6))))},loadQuadImage:function(){var n=this.data.src,e=this;this.el.sceneEl.systems.material.loadTexture(n,{src:n},function(t){e.el.sceneEl.renderer.initTexture(t),e.texture=t,n.tagName==="VIDEO"&&setTimeout(function(){e.textureIsVideo=!0},1e3),e.layer&&(e.layer.height=e.data.height/2||e.texture.image.height/1e3,e.layer.width=e.data.width/2||e.texture.image.width/1e3,e.needsRedraw=!0),e.updateQuadPanel()})},preGenerateCubeMapTextures:function(n,e){this.data.type==="monocubemap"?this.generateCubeMapTextures(n,0,e):(this.generateCubeMapTextures(n,0,e),this.generateCubeMapTextures(n,6,e))},generateCubeMapTextures:function(n,e,t){for(var i,s,l=this.data,u=this.cubeFaceSize,d=Math.min(n.width,n.height),p=[],g=0;g<6;g++){var x=document.createElement("CANVAS");x.width=x.height=u;var b=x.getContext("2d");l.rotateCubemap&&(g!==2&&g!==3||(b.save(),b.translate(u,u),b.rotate(Math.PI))),b.drawImage(n,(g+e)*d,0,d,d,0,0,u,u),b.restore(),t&&t(),p.push(x)}return l.rotateCubemap&&(i=p[0],s=p[1],p[0]=s,p[1]=i,i=p[4],s=p[5],p[4]=s,p[5]=i),t&&t(),p},loadCubeMapImage:function(n,e,t){var i,s=this.el.sceneEl.renderer.getContext();s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.bindTexture(s.TEXTURE_CUBE_MAP,n),i=!e.complete||this.loadingScreen?this.loadingScreenImages:this.generateCubeMapTextures(e,t);var l=0;i.forEach(function(u,d){s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,s.RGBA,s.UNSIGNED_BYTE,u),l=s.getError()}),l!==0&&console.log("renderingError, WebGL Error Code: "+l),s.bindTexture(s.TEXTURE_CUBE_MAP,null)},tick:function(){this.el.sceneEl.xrSession&&this.referenceSpace&&(this.layer||!this.el.sceneEl.is("vr-mode")&&!this.el.sceneEl.is("ar-mode")||this.initLayer(),this.updateTransform(),this.data.src.complete&&(this.pendingCubeMapUpdate||this.loadingScreen||this.visibilityChanged)&&this.loadCubeMapImages(),(this.needsRedraw||this.layer.needsRedraw||this.textureIsVideo)&&(this.data.type==="quad"&&this.draw(),this.needsRedraw=!1))},initLayer:function(){var n=this,e=this.data.type;this.el.sceneEl.xrSession.onvisibilitychange=function(t){n.visibilityChanged=t.session.visibilityState!=="hidden"},e!=="quad"?e!=="monocubemap"&&e!=="stereocubemap"||this.initCubeMapLayer():this.initQuadLayer()},initQuadLayer:function(){var n=this.el.sceneEl,e=n.renderer.getContext(),t=this.xrGLFactory=new XRWebGLBinding(n.xrSession,e);this.texture&&(this.layer=t.createQuadLayer({space:this.referenceSpace,viewPixelHeight:2048,viewPixelWidth:2048,height:this.data.height/2||this.texture.image.height/1e3,width:this.data.width/2||this.texture.image.width/1e3}),this.initLoadingScreenImages(),n.renderer.xr.addLayer(this.layer))},initCubeMapLayer:function(){var n=this.data.src,e=this.el.sceneEl,t=e.renderer.getContext(),i=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),s=this.cubeFaceSize=Math.min(i,Math.min(n.width,n.height)),l=this.xrGLFactory=new XRWebGLBinding(e.xrSession,t);this.layer=l.createCubeLayer({space:this.referenceSpace,viewPixelWidth:s,viewPixelHeight:s,layout:this.data.type==="monocubemap"?"mono":"stereo",isStatic:!1}),this.initLoadingScreenImages(),this.loadCubeMapImages(),e.renderer.xr.addLayer(this.layer)},initLoadingScreenImages:function(){for(var n=this.cubeFaceSize,e=this.loadingScreenImages=[],t=0;t<6;t++){var i=document.createElement("CANVAS");i.width=i.height=n;var s=i.getContext("2d");i.width=i.height=n,s.fillStyle="black",s.fillRect(0,0,n,n),t!==2&&t!==3&&(s.translate(n,0),s.scale(-1,1),s.fillStyle="white",s.font="30px Arial",s.fillText("Loading",n/2,n/2)),e.push(i)}},destroyLayer:function(){this.layer&&(this.el.sceneEl.renderer.xr.removeLayer(this.layer),this.layer.destroy(),this.layer=void 0)},toggleCompositorLayer:function(){this.enableCompositorLayer(!this.layerEnabled)},enableCompositorLayer:function(n){this.layerEnabled=n,this.quadPanelEl.object3D.visible=!this.layerEnabled},updateQuadPanel:function(){var n=this.quadPanelEl;this.quadPanelEl||(n=this.quadPanelEl=document.createElement("a-entity"),this.el.appendChild(n)),n.setAttribute("material",{shader:"flat",src:this.data.src,transparent:!0}),n.setAttribute("geometry",{primitive:"plane",height:this.data.height||this.texture.image.height/1e3,width:this.data.width||this.texture.image.height/1e3})},draw:function(){var n=this.el.sceneEl,e=this.el.sceneEl.renderer.getContext(),t=this.xrGLFactory.getSubImage(this.layer,n.frame),i=n.renderer.properties.get(this.texture).__webglTexture,s=e.getParameter(e.FRAMEBUFFER_BINDING);e.viewport(t.viewport.x,t.viewport.y,t.viewport.width,t.viewport.height),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.colorTexture,0),function(l,u,d,p){var g=l.createFramebuffer(),x=d.viewport.x,b=d.viewport.y,E=d.viewport.x+d.viewport.width,S=d.viewport.y+d.viewport.height;p.tagName==="VIDEO"&&(l.bindTexture(l.TEXTURE_2D,u),l.texSubImage2D(l.TEXTURE_2D,0,0,0,p.width,p.height,l.RGB,l.UNSIGNED_BYTE,p)),l.bindFramebuffer(l.READ_FRAMEBUFFER,g),l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u,0),l.readBuffer(l.COLOR_ATTACHMENT0),l.blitFramebuffer(0,0,p.width,p.height,x,b,E,S,l.COLOR_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.deleteFramebuffer(g)}(e,i,t,this.data.src),e.bindFramebuffer(e.FRAMEBUFFER,s)},updateTransform:function(){var n=this.el,e=this.position,t=this.quaternion;n.object3D.updateMatrixWorld(),e.setFromMatrixPosition(n.object3D.matrixWorld),t.setFromRotationMatrix(n.object3D.matrixWorld),this.layerEnabled||e.set(0,0,1e8),this.layer.transform=new XRRigidTransform(e,t)},onEnterVR:function(){var n=this.el.sceneEl,e=n.xrSession;n.hasWebXR&&XRWebGLBinding&&e?(e.requestReferenceSpace("local-floor").then(this.onRequestedReferenceSpace),this.layerEnabled=!0,this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!1),this.data.src.play&&this.data.src.play()):Vqe("The layer component requires WebXR and the layers API enabled")},onExitVR:function(){this.quadPanelEl&&(this.quadPanelEl.object3D.visible=!0),this.destroyLayer()},onRequestedReferenceSpace:function(n){this.referenceSpace=n}}),In("laser-controls",{schema:{hand:{default:"right"},model:{default:!0},defaultModelColor:{type:"color",default:"grey"}},init:function(){var n=this.config,e=this.data,t=this.el,i=this,s={hand:e.hand,model:e.model};function l(u){var d=n[u.detail.name];if(d){var p=Ja({showLine:!0},d.raycaster||{});u.detail.rayOrigin&&(p.origin=u.detail.rayOrigin.origin,p.direction=u.detail.rayOrigin.direction,p.showLine=!0),u.detail.rayOrigin||!i.modelReady?t.setAttribute("raycaster",p):t.setAttribute("raycaster","showLine",!0),t.setAttribute("cursor",Ja({fuse:!1},d.cursor))}}t.setAttribute("hp-mixed-reality-controls",s),t.setAttribute("magicleap-controls",s),t.setAttribute("oculus-go-controls",s),t.setAttribute("meta-touch-controls",s),t.setAttribute("pico-controls",s),t.setAttribute("valve-index-controls",s),t.setAttribute("vive-controls",s),t.setAttribute("vive-focus-controls",s),t.setAttribute("windows-motion-controls",s),t.setAttribute("generic-tracked-controller-controls",{hand:s.hand}),t.addEventListener("controllerconnected",l),t.addEventListener("controllerdisconnected",function(u){n[u.detail.name]&&t.setAttribute("raycaster","showLine",!1)}),t.addEventListener("controllermodelready",function(u){l(u),i.modelReady=!0})},config:{"generic-tracked-controller-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"hp-mixed-reality-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"magicleap-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"oculus-go-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"meta-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"pico-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"valve-index-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"vive-focus-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}});var WP,C_,E_,__,od,tj,HP,Gb,Wb,I_,nj=Z.MathUtils.degToRad,Uqe=Ki("components:light:warn"),zqe=new Z.CubeTextureLoader,lg={};function ij(n,e){return!(!n||!e)&&n.x===e.x&&n.y===e.y&&n.z===e.z}In("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color",if:{type:["ambient","directional","hemisphere","point","spot"]}},envMap:{default:"",if:{type:["probe"]}},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:3.14,min:0,if:{type:["ambient","directional","hemisphere","point","spot","probe"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot","probe"],schemaChange:!0},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowCameraAutomatic:{default:"",if:{type:["directional"]}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}},shadowRadius:{default:1,if:{castShadow:!0}}},init:function(){var n=this.el;this.light=null,this.defaultTarget=null,this.system.registerLight(n)},update:function(n){var e=this.data,t=Fse(e,n),i=this.light,s=this;if(!i||"type"in t)this.setLight(this.data),this.updateShadow();else{var l=!1;Object.keys(t).forEach(function(u){var d=e[u];switch(u){case"color":i.color.set(d);break;case"groundColor":i.groundColor.set(d);break;case"angle":i.angle=nj(d);break;case"target":d===null?e.type!=="spot"&&e.type!=="directional"||(i.target=s.defaultTarget):d.hasLoaded?s.onSetTarget(d,i):d.addEventListener("loaded",s.onSetTarget.bind(s,d,i));break;case"envMap":s.updateProbeMap(e,i);break;case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":case"shadowRadius":l||(s.updateShadow(),l=!0);break;case"shadowCameraAutomatic":e.shadowCameraAutomatic?s.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(e.shadowCameraAutomatic)):s.shadowCameraAutomaticEls=[];break;default:i[u]=d}})}},tick:(WP=new Z.Box3,C_=new Z.Vector3,E_=new Z.Vector3,__=new Z.Matrix4,od=new Z.Sphere,tj=new Z.Vector3,function(){if(this.data.type==="directional"&&this.light.shadow&&this.light.shadow.camera instanceof Z.OrthographicCamera&&this.shadowCameraAutomaticEls.length){var n=this.light.shadow.camera;n.getWorldDirection(C_),n.getWorldPosition(E_),__.copy(n.matrixWorld),__.invert(),n.near=1,n.left=1e5,n.right=-1e5,n.top=-1e5,n.bottom=1e5,this.shadowCameraAutomaticEls.forEach(function(e){WP.setFromObject(e.object3D),WP.getBoundingSphere(od);var t,i,s,l,u,d=ej(E_,C_,od.center),p=(t=E_,i=C_,s=od.center,l=tj,u=ej(t,i,s),l.copy(i),l.multiplyScalar(u),l.add(s),l).applyMatrix4(__);n.near=Math.min(-d-od.radius-1,n.near),n.left=Math.min(-od.radius+p.x,n.left),n.right=Math.max(od.radius+p.x,n.right),n.top=Math.max(od.radius+p.y,n.top),n.bottom=Math.min(-od.radius+p.y,n.bottom)}),n.updateProjectionMatrix()}}),setLight:function(n){var e=this.el,t=this.getLight(n);t&&(this.light&&e.removeObject3D("light"),this.light=t,this.light.el=e,e.setObject3D("light",this.light),n.type!=="spot"&&n.type!=="directional"&&n.type!=="hemisphere"||e.getObject3D("light").translateY(-1),n.type==="spot"&&(e.setObject3D("light-target",this.defaultTarget),e.getObject3D("light-target").position.set(0,0,-1)),n.shadowCameraAutomatic?this.shadowCameraAutomaticEls=Array.from(document.querySelectorAll(n.shadowCameraAutomatic)):this.shadowCameraAutomaticEls=[])},updateShadow:function(){var n=this.el,e=this.data,t=this.light;t.castShadow=e.castShadow;var i=n.getObject3D("cameraHelper");if(e.shadowCameraVisible&&!i?(i=new Z.CameraHelper(t.shadow.camera),n.setObject3D("cameraHelper",i)):!e.shadowCameraVisible&&i&&n.removeObject3D("cameraHelper"),!e.castShadow)return t;t.shadow.bias=e.shadowBias,t.shadow.radius=e.shadowRadius,t.shadow.mapSize.height=e.shadowMapHeight,t.shadow.mapSize.width=e.shadowMapWidth,t.shadow.camera.near=e.shadowCameraNear,t.shadow.camera.far=e.shadowCameraFar,t.shadow.camera instanceof Z.OrthographicCamera?(t.shadow.camera.top=e.shadowCameraTop,t.shadow.camera.right=e.shadowCameraRight,t.shadow.camera.bottom=e.shadowCameraBottom,t.shadow.camera.left=e.shadowCameraLeft):t.shadow.camera.fov=e.shadowCameraFov,t.shadow.camera.updateProjectionMatrix(),i&&i.update()},getLight:function(n){var e=n.angle,t=new Z.Color(n.color);t=t.getHex();var i=n.decay,s=n.distance,l=new Z.Color(n.groundColor);l=l.getHex();var u=n.intensity,d=n.type,p=n.target,g=null;switch(d.toLowerCase()){case"ambient":return new Z.AmbientLight(t,u);case"directional":return g=new Z.DirectionalLight(t,u),this.defaultTarget=g.target,p&&(p.hasLoaded?this.onSetTarget(p,g):p.addEventListener("loaded",this.onSetTarget.bind(this,p,g))),g;case"hemisphere":return new Z.HemisphereLight(t,l,u);case"point":return new Z.PointLight(t,u,s,i);case"spot":return g=new Z.SpotLight(t,u,s,nj(e),n.penumbra,i),this.defaultTarget=g.target,p&&(p.hasLoaded?this.onSetTarget(p,g):p.addEventListener("loaded",this.onSetTarget.bind(this,p,g))),g;case"probe":return g=new Z.LightProbe,this.updateProbeMap(n,g),g;default:Uqe("%s is not a valid light type. Choose from ambient, directional, hemisphere, point, spot.",d)}},updateProbeMap:function(n,e){n.envMap?(lg[n.envMap]===void 0&&(lg[n.envMap]=new window.Promise(function(t){Rse(n.envMap,function(i){zqe.load(i,function(s){var l=vse.fromCubeTexture(s);lg[n.envMap]=l,t(l)})})})),lg[n.envMap]instanceof window.Promise?lg[n.envMap].then(function(t){e.copy(t)}):lg[n.envMap]instanceof Z.LightProbe&&e.copy(lg[n.envMap])):e.copy(new Z.LightProbe)},onSetTarget:function(n,e){e.target=n.object3D},remove:function(){var n=this.el;n.removeObject3D("light"),n.getObject3D("cameraHelper")&&n.removeObject3D("cameraHelper")}}),In("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function(){var n,e,t=this.data;e=this.material=new Z.LineBasicMaterial({color:t.color,opacity:t.opacity,transparent:t.opacity<1,visible:t.visible}),(n=this.geometry=new Z.BufferGeometry).setAttribute("position",new Z.BufferAttribute(new Float32Array(6),3)),this.line=new Z.Line(n,e),this.el.setObject3D(this.attrName,this.line)},update:function(n){var e=this.data,t=this.geometry,i=!1,s=this.material,l=t.attributes.position.array;ij(e.start,n.start)||(l[0]=e.start.x,l[1]=e.start.y,l[2]=e.start.z,i=!0),ij(e.end,n.end)||(l[3]=e.end.x,l[4]=e.end.y,l[5]=e.end.z,i=!0),i&&(t.attributes.position.needsUpdate=!0,t.computeBoundingSphere()),s.color.setStyle(e.color),s.opacity=e.opacity,s.transparent=e.opacity<1,s.visible=e.visible},remove:function(){this.el.removeObject3D(this.attrName,this.line)}}),In("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!1}},init:function(){this.navigate=this.navigate.bind(this),this.previousQuaternion=void 0,this.quaternionClone=new Z.Quaternion,this.hiddenEls=[]},update:function(n){var e,t,i=this.data,s=this.el;if(i.visualAspectEnabled){var l=this.el.getAttribute("scale");this.previewDistance=15*(l.x+l.y)/2,this.initVisualAspect(),e=i.highlighted?i.highlightedColor:i.backgroundColor,t=i.highlighted?i.highlightedColor:i.borderColor,s.setAttribute("material","backgroundColor",e),s.setAttribute("material","strokeColor",t),i.on!==n.on&&this.updateEventListener(),n.peekMode!==void 0&&i.peekMode!==n.peekMode&&this.updatePeekMode(),i.image&&n.image!==i.image&&s.setAttribute("material","pano",typeof i.image=="string"?i.image:i.image.src)}},updatePeekMode:function(){var n=this.el,e=this.sphereEl;this.data.peekMode?(this.hideAll(),n.getObject3D("mesh").visible=!1,e.setAttribute("visible",!0)):(this.showAll(),n.getObject3D("mesh").visible=!0,e.setAttribute("visible",!1))},play:function(){this.updateEventListener()},pause:function(){this.removeEventListener()},updateEventListener:function(){var n=this.el;n.isPlaying&&(this.removeEventListener(),n.addEventListener(this.data.on,this.navigate))},removeEventListener:function(){var n=this.data.on;n&&this.el.removeEventListener(n,this.navigate)},initVisualAspect:function(){var n,e,t,i=this.el;this.data.visualAspectEnabled&&!this.visualAspectInitialized&&(t=this.textEl=this.textEl||document.createElement("a-entity"),e=this.sphereEl=this.sphereEl||document.createElement("a-entity"),n=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity"),i.setAttribute("geometry",{primitive:"circle",radius:1,segments:64}),i.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double",previewDistance:this.previewDistance}),t.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4}),t.setAttribute("position","0 1.5 0"),i.appendChild(t),n.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360}),n.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),n.setAttribute("rotation","0 180 0"),n.setAttribute("position","0 0 0"),n.setAttribute("visible",!1),i.appendChild(n),e.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64}),e.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back",previewDistance:this.previewDistance}),e.setAttribute("visible",!1),i.appendChild(e),this.visualAspectInitialized=!0)},navigate:function(){window.location=this.data.href},tick:function(){var n=new Z.Vector3,e=new Z.Vector3,t=new Z.Quaternion,i=new Z.Vector3;return function(){var s,l,u=this.el,d=u.object3D,p=u.sceneEl.camera,g=this.textEl;if(this.data.visualAspectEnabled)if(d.updateMatrixWorld(),p.parent.updateMatrixWorld(),p.updateMatrixWorld(),d.matrix.decompose(e,t,i),e.setFromMatrixPosition(d.matrixWorld),n.setFromMatrixPosition(p.matrixWorld),(l=e.distanceTo(n))>1.33333*this.previewDistance)this.previousQuaternion||(this.quaternionClone.copy(t),this.previousQuaternion=this.quaternionClone),d.lookAt(n);else{if(s=this.calculateCameraPortalOrientation(),l<.5){if(this.semiSphereEl.getAttribute("visible")===!0)return;g.setAttribute("text","width",1.5),s<=0?(g.setAttribute("position","0 0 0.75"),g.setAttribute("rotation","0 180 0"),this.semiSphereEl.setAttribute("rotation","0 0 0")):(g.setAttribute("position","0 0 -0.75"),g.setAttribute("rotation","0 0 0"),this.semiSphereEl.setAttribute("rotation","0 180 0")),u.getObject3D("mesh").visible=!1,this.semiSphereEl.setAttribute("visible",!0),this.peekCameraPortalOrientation=s}else s<=0?g.setAttribute("rotation","0 180 0"):g.setAttribute("rotation","0 0 0"),g.setAttribute("text","width",5),g.setAttribute("position","0 1.5 0"),u.getObject3D("mesh").visible=!0,this.semiSphereEl.setAttribute("visible",!1),this.peekCameraPortalOrientation=void 0;this.previousQuaternion&&(d.quaternion.copy(this.previousQuaternion),this.previousQuaternion=void 0)}}}(),hideAll:function(){var n=this.el,e=this.hiddenEls,t=this;e.length>0||n.sceneEl.object3D.traverse(function(i){i&&i.el&&i.el.hasAttribute("link-controls")||i.el&&i!==n.sceneEl.object3D&&i.el!==n&&i.el!==t.sphereEl&&i.el!==n.sceneEl.cameraEl&&i.el.getAttribute("visible")!==!1&&i.el!==t.textEl&&i.el!==t.semiSphereEl&&(i.el.setAttribute("visible",!1),e.push(i.el))})},showAll:function(){this.hiddenEls.forEach(function(n){n.setAttribute("visible",!0)}),this.hiddenEls=[]},calculateCameraPortalOrientation:(HP=new Z.Matrix4,Gb=new Z.Vector3,Wb=new Z.Vector3(0,0,1),I_=new Z.Vector3(0,0,0),function(){var n=this.el,e=n.sceneEl.camera;return Gb.set(0,0,0),Wb.set(0,0,1),I_.set(0,0,0),n.object3D.matrixWorld.extractRotation(HP),Wb.applyMatrix4(HP),n.object3D.updateMatrixWorld(),n.object3D.localToWorld(I_),e.parent.parent.updateMatrixWorld(),e.parent.updateMatrixWorld(),e.updateMatrixWorld(),e.localToWorld(Gb),Gb.sub(I_).normalize(),Wb.normalize(),Math.sign(Wb.dot(Gb))}),remove:function(){this.removeEventListener()}}),qf("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"},previewDistance:{default:15,type:"float",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join(`
`),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","uniform float previewDistance;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = clamp(direction.y * 0.5  + 0.5, 0.0, 1.0);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / previewDistance), 2.0), 0.0, 1.0));","}","}"].join(`
`)});var rj="logitech-mx-ink",Gqe=as+"controllers/logitech/",sj=(In("logitech-mx-ink-controls",{schema:{hand:{default:"left"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{left:{buttons:["front","back","none","none","none","tip"]},right:{buttons:["front","back","none","none","none","tip"]}},init:function(){var n=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n,n.data.hand)},this.onButtonUp=function(e){ri(e.detail.id,"up",n,n.data.hand)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n,n.data.hand)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n,n.data.hand)},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-loaded",this.onModelLoaded),n.sceneEl.removeEventListener("enter-vr",this.onEnterVR),n.sceneEl.removeEventListener("exit-vr",this.onExitVR),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.controllerObject3D;n&&(n.visible=!1),Nl(this,rj,{hand:this.data.hand,iterateControllerProfiles:!0})},injectTrackedControls:function(){var n=this.el,e=this.data,t=rj;n.setAttribute("tracked-controls",{id:t,hand:e.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0,orientationOffset:e.orientationOffset}),this.loadModel()},loadModel:function(){var n=this.controllerObject3D;if(this.data.model)return n?(n.visible=this.el.sceneEl.is("vr-mode"),void this.el.setObject3D("mesh",n)):void this.el.setAttribute("gltf-model",Gqe+"logitech-mx-ink.glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping[this.data.hand].buttons[n.detail.id];t&&(t==="trigger"&&(e=n.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){n.target===this.el&&this.data.model&&(this.el.emit("controllermodelready",{name:"logitech-mx-ink-controls",model:this.data.model,rayOrigin:new Z.Vector3(0,0,0)}),this.controllerObject3D=this.el.getObject3D("mesh"),this.controllerObject3D.visible=this.el.sceneEl.is("vr-mode"))},onAxisMoved:function(n){gc(this,this.mapping.axes,n)}}),Math.PI/2),oj=(In("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},magicWindowTrackingEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},reverseTouchDrag:{default:!1},touchEnabled:{default:!0},mouseEnabled:{default:!0}},init:function(){this.deltaYaw=0,this.previousHMDPosition=new Z.Vector3,this.hmdQuaternion=new Z.Quaternion,this.magicWindowAbsoluteEuler=new Z.Euler,this.magicWindowDeltaEuler=new Z.Euler,this.position=new Z.Vector3,this.magicWindowObject=new Z.Object3D,this.rotation={},this.deltaRotation={},this.savedPose=null,this.pointerLocked=!1,this.setupMouseControls(),this.bindMethods(),this.previousMouseEvent={},this.setupMagicWindowControls(),this.savedPose={position:new Z.Vector3,rotation:new Z.Euler},(this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode"))&&this.onEnterVR()},setupMagicWindowControls:function(){var n,e=this.data;(Xp()||ZV())&&(n=this.magicWindowControls=new bse(this.magicWindowObject),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission&&(n.enabled=!1,this.el.sceneEl.components["device-orientation-permission-ui"].permissionGranted?n.enabled=e.magicWindowTrackingEnabled:this.el.sceneEl.addEventListener("deviceorientationpermissiongranted",function(){n.enabled=e.magicWindowTrackingEnabled})))},update:function(n){var e=this.data;e.enabled!==n.enabled&&this.updateGrabCursor(e.enabled),n&&!e.magicWindowTrackingEnabled&&n.magicWindowTrackingEnabled&&(this.magicWindowAbsoluteEuler.set(0,0,0),this.magicWindowDeltaEuler.set(0,0,0)),this.magicWindowControls&&(this.magicWindowControls.enabled=e.magicWindowTrackingEnabled),n&&!e.pointerLockEnabled!==n.pointerLockEnabled&&(this.removeEventListeners(),this.addEventListeners(),this.pointerLocked&&this.exitPointerLock())},tick:function(n){this.data.enabled&&this.updateOrientation()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},remove:function(){this.removeEventListeners(),this.pointerLocked&&this.exitPointerLock()},bindMethods:function(){this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.onExitVR=this.onExitVR.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onPointerLockError=this.onPointerLockError.bind(this)},setupMouseControls:function(){this.mouseDown=!1,this.pitchObject=new Z.Object3D,this.yawObject=new Z.Object3D,this.yawObject.position.y=10,this.yawObject.add(this.pitchObject)},addEventListeners:function(){var n=this.el.sceneEl,e=n.canvas;e?(e.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1),e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),window.addEventListener("touchmove",this.onTouchMove,{passive:!0}),window.addEventListener("touchend",this.onTouchEnd,{passive:!0}),n.addEventListener("enter-vr",this.onEnterVR),n.addEventListener("exit-vr",this.onExitVR),this.data.pointerLockEnabled&&(document.addEventListener("pointerlockchange",this.onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.addEventListener("pointerlockerror",this.onPointerLockError,!1))):n.addEventListener("render-target-loaded",this.addEventListeners.bind(this))},removeEventListeners:function(){var n=this.el.sceneEl,e=n&&n.canvas;e&&(e.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),n.removeEventListener("enter-vr",this.onEnterVR),n.removeEventListener("exit-vr",this.onExitVR),document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1),document.removeEventListener("pointerlockerror",this.onPointerLockError,!1))},updateOrientation:function(){var n=this.el.object3D,e=this.pitchObject,t=this.yawObject,i=this.el.sceneEl;(i.is("vr-mode")||i.is("ar-mode"))&&i.checkHeadsetConnected()||(this.updateMagicWindowOrientation(),n.rotation.x=this.magicWindowDeltaEuler.x+e.rotation.x,n.rotation.y=this.magicWindowDeltaEuler.y+t.rotation.y,n.rotation.z=this.magicWindowDeltaEuler.z)},updateMagicWindowOrientation:function(){var n=this.magicWindowAbsoluteEuler,e=this.magicWindowDeltaEuler;this.magicWindowControls&&this.magicWindowControls.enabled&&(this.magicWindowControls.update(),n.setFromQuaternion(this.magicWindowObject.quaternion,"YXZ"),this.previousMagicWindowYaw||n.y===0||(this.previousMagicWindowYaw=n.y),this.previousMagicWindowYaw&&(e.x=n.x,e.y+=n.y-this.previousMagicWindowYaw,e.z=n.z,this.previousMagicWindowYaw=n.y))},onMouseMove:function(n){var e,t,i,s=this.pitchObject,l=this.previousMouseEvent,u=this.yawObject;this.data.enabled&&(this.mouseDown||this.pointerLocked)&&(this.pointerLocked?(t=n.movementX||n.mozMovementX||0,i=n.movementY||n.mozMovementY||0):(t=n.screenX-l.screenX,i=n.screenY-l.screenY),this.previousMouseEvent.screenX=n.screenX,this.previousMouseEvent.screenY=n.screenY,e=this.data.reverseMouseDrag?1:-1,u.rotation.y+=.002*t*e,s.rotation.x+=.002*i*e,s.rotation.x=Math.max(-sj,Math.min(sj,s.rotation.x)))},onMouseDown:function(n){var e=this.el.sceneEl;if(this.data.enabled&&this.data.mouseEnabled&&(!e.is("vr-mode")&&!e.is("ar-mode")||!e.checkHeadsetConnected())&&n.button===0){var t=e&&e.canvas;this.mouseDown=!0,this.previousMouseEvent.screenX=n.screenX,this.previousMouseEvent.screenY=n.screenY,this.showGrabbingCursor(),this.data.pointerLockEnabled&&!this.pointerLocked&&(t.requestPointerLock?t.requestPointerLock():t.mozRequestPointerLock&&t.mozRequestPointerLock())}},showGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor="grabbing"},hideGrabbingCursor:function(){this.el.sceneEl.canvas.style.cursor=""},onMouseUp:function(){this.mouseDown=!1,this.hideGrabbingCursor()},onTouchStart:function(n){n.touches.length!==1||!this.data.touchEnabled||this.el.sceneEl.is("vr-mode")||this.el.sceneEl.is("ar-mode")||(this.touchStart={x:n.touches[0].pageX,y:n.touches[0].pageY},this.touchStarted=!0)},onTouchMove:function(n){var e,t,i=this.el.sceneEl.canvas,s=this.yawObject;this.touchStarted&&this.data.touchEnabled&&(t=2*Math.PI*(n.touches[0].pageX-this.touchStart.x)/i.clientWidth,e=this.data.reverseTouchDrag?1:-1,s.rotation.y-=.5*t*e,this.touchStart={x:n.touches[0].pageX,y:n.touches[0].pageY})},onTouchEnd:function(){this.touchStarted=!1},onEnterVR:function(){var n=this.el.sceneEl;n.checkHeadsetConnected()&&(this.saveCameraPose(),this.el.object3D.position.set(0,0,0),this.el.object3D.rotation.set(0,0,0),n.hasWebXR&&(this.el.object3D.matrixAutoUpdate=!1,this.el.object3D.updateMatrix()))},onExitVR:function(){this.el.sceneEl.checkHeadsetConnected()&&(this.restoreCameraPose(),this.previousHMDPosition.set(0,0,0),this.el.object3D.matrixAutoUpdate=!0)},onPointerLockChange:function(){this.pointerLocked=!(!document.pointerLockElement&&!document.mozPointerLockElement)},onPointerLockError:function(){this.pointerLocked=!1},exitPointerLock:function(){document.exitPointerLock(),this.pointerLocked=!1},updateGrabCursor:function(n){var e=this.el.sceneEl;function t(){e.canvas.classList.add("a-grab-cursor")}function i(){e.canvas.classList.remove("a-grab-cursor")}e.canvas?n?t():i():n?e.addEventListener("render-target-loaded",t):e.addEventListener("render-target-loaded",i)},saveCameraPose:function(){var n=this.el;this.savedPose.position.copy(n.object3D.position),this.savedPose.rotation.copy(n.object3D.rotation),this.hasSavedPose=!0},restoreCameraPose:function(){var n=this.el,e=this.savedPose;this.hasSavedPose&&(n.object3D.position.copy(e.position),n.object3D.rotation.copy(e.rotation),this.hasSavedPose=!1)}}),"magicleap-one"),Wqe=as+"controllers/magicleap/magicleap-one-controller.glb",Hqe=(In("magicleap-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","menu"]},init:function(){var n=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.previousButtonValues={},this.bindMethods()},update:function(){var n=this.data;this.controllerIndex=n.hand==="right"?0:n.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data;Nl(this,oj,{index:this.controllerIndex,hand:n.hand})},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{idPrefix:oj,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",Wqe)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping.buttons[n.detail.id];t&&(t==="trigger"&&(e=n.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){n.detail.model.scale.set(.01,.01,.01)},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},updateModel:function(n,e){},setButtonColor:function(n,e){}}),Ki("components:material:error"));function aj(n,e){n.dispose(),e.unregisterMaterial(n),Object.keys(n).filter(function(t){return n[t]&&n[t].isTexture}).forEach(function(t){n[t].dispose()})}In("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:jse,schemaChange:!0},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColorsEnabled:{default:!1},visible:{default:!0},blending:{default:"normal",oneOf:["none","normal","additive","subtractive","multiply"]},dithering:{default:!0},anisotropy:{default:0,min:0}},init:function(){this.material=null},update:function(n){var e=this.data;this.shader&&e.shader===n.shader||this.updateShader(e.shader),this.shader.update(this.data),this.updateMaterial(n)},updateSchema:function(n){var e,t,i,s;t=n&&n.shader,e=this.oldData&&this.oldData.shader,(i=rh[s=t||e]&&rh[s].schema)||Hqe("Unknown shader schema "+s),e&&t===e||(this.extendSchema(i),this.updateBehavior())},updateBehavior:function(){var n,e,t=this.el.sceneEl,i=this.schema,s=this;function l(u,d){var p;for(p in e)e[p]=u;s.shader.update(e)}for(n in this.tick=void 0,e={},i)i[n].type==="time"&&(this.tick=l,e[n]=!0);t&&(this.tick?t.addBehavior(this):t.removeBehavior(this))},updateShader:function(n){var e,t=this.data,i=rh[n]&&rh[n].Shader;if(!i)throw new Error("Unknown shader "+n);(e=this.shader=new i).el=this.el,e.init(t),this.setMaterial(e.material),this.updateSchema(t)},updateMaterial:function(n){var e,t=this.data,i=this.material;for(e in i.alphaTest=t.alphaTest,i.depthTest=t.depthTest!==!1,i.depthWrite=t.depthWrite!==!1,i.opacity=t.opacity,i.flatShading=t.flatShading,i.side=function(s){switch(s){case"back":return Z.BackSide;case"double":return Z.DoubleSide;default:return Z.FrontSide}}(t.side),i.transparent=t.transparent!==!1||t.opacity<1,i.vertexColors=t.vertexColorsEnabled,i.visible=t.visible,i.blending=function(s){switch(s){case"none":return Z.NoBlending;case"additive":return Z.AdditiveBlending;case"subtractive":return Z.SubtractiveBlending;case"multiply":return Z.MultiplyBlending;default:return Z.NormalBlending}}(t.blending),i.dithering=t.dithering,n)break;!e||n.alphaTest===t.alphaTest&&n.side===t.side&&n.vertexColorsEnabled===t.vertexColorsEnabled||(i.needsUpdate=!0)},remove:function(){var n=new Z.MeshBasicMaterial,e=this.material,t=this.el.getObject3D("mesh");t&&(t.material=n),aj(e,this.system)},setMaterial:function(n){var e,t=this.el,i=this.system;this.material&&aj(this.material,i),this.material=n,i.registerMaterial(n),(e=t.getObject3D("mesh"))?e.material=n:t.addEventListener("object3dset",function s(l){l.detail.type==="mesh"&&l.target===t&&(t.getObject3D("mesh").material=n,t.removeEventListener("object3dset",s))})}});var S_,T_,XP,lj,$P,cj="oculus-touch",oA=as+"controllers/oculus/oculus-touch-controller-",M_=as+"controllers/meta/",Xqe={left:{modelUrl:oA+"left.gltf",rayOrigin:{origin:{x:.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new Z.Vector3(-.005,.036,-.037),modelPivotRotation:new Z.Euler(Math.PI/4.5,0,0)},right:{modelUrl:oA+"right.gltf",rayOrigin:{origin:{x:-.002,y:-.005,z:-.03},direction:{x:0,y:-.8,z:-1}},modelPivotOffset:new Z.Vector3(.005,.036,-.037),modelPivotRotation:new Z.Euler(Math.PI/4.5,0,0)}},uj="oculus-touch",cg={"oculus-touch":Xqe,"oculus-touch-v2":{left:{modelUrl:oA+"gen2-left.gltf",rayOrigin:{origin:{x:-.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new Z.Vector3(0,-.007,-.021),modelPivotRotation:new Z.Euler(-Math.PI/4,0,0)},right:{modelUrl:oA+"gen2-right.gltf",rayOrigin:{origin:{x:.006,y:-.03,z:-.04},direction:{x:0,y:-.9,z:-1}},modelPivotOffset:new Z.Vector3(0,-.007,-.021),modelPivotRotation:new Z.Euler(-Math.PI/4,0,0)}},"oculus-touch-v3":{left:{modelUrl:oA+"v3-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)},right:{modelUrl:oA+"v3-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)}},"meta-quest-touch-pro":{left:{modelUrl:M_+"quest-touch-pro-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)},right:{modelUrl:M_+"quest-touch-pro-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)}},"meta-quest-touch-plus":{left:{modelUrl:M_+"quest-touch-plus-left.glb",rayOrigin:{origin:{x:.0065,y:-.0186,z:-.05},direction:{x:.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)},right:{modelUrl:M_+"quest-touch-plus-right.glb",rayOrigin:{origin:{x:-.0065,y:-.0186,z:-.05},direction:{x:-.12394785839500175,y:-.5944043672340157,z:-.7945567170519814}},modelPivotOffset:new Z.Vector3(0,0,0),modelPivotRotation:new Z.Euler(0,0,0)}}},hj={schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},controllerType:{default:"auto",oneOf:["auto","oculus-touch","oculus-touch-v2","oculus-touch-v3"]}},after:["tracked-controls"],mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton","surface"]}},bindMethods:function(){this.onButtonChanged=this.onButtonChanged.bind(this),this.onThumbstickMoved=this.onThumbstickMoved.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var n=this;this.onButtonDown=function(e){ri(e.detail.id,"down",n,n.data.hand)},this.onButtonUp=function(e){ri(e.detail.id,"up",n,n.data.hand)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n,n.data.hand)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n,n.data.hand)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.triggerEuler=new Z.Euler},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-loaded",this.onModelLoaded),n.addEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-loaded",this.onModelLoaded),n.removeEventListener("thumbstickmoved",this.onThumbstickMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.controllerObject3D;n&&(n.visible=!1),Nl(this,cj,{hand:this.data.hand,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},loadModel:function(n){var e,t=this.data;if(t.model){if(this.controllerObject3D)return this.controllerObject3D.visible=!0,void this.el.setObject3D("mesh",this.controllerObject3D);if(this.displayModel=cg[t.controllerType]||cg[uj],t.controllerType==="auto"){e=uj;for(var i=Object.keys(cg),s=0;s<n.profiles.length;s++)if(i.indexOf(n.profiles[s])!==-1){e=n.profiles[s];break}this.displayModel=cg[e]}var l=this.displayModel[t.hand].modelUrl;this.isTouchV3orPROorPlus=this.displayModel===cg["oculus-touch-v3"]||this.displayModel===cg["meta-quest-touch-pro"]||this.displayModel===cg["meta-quest-touch-plus"],this.el.setAttribute("gltf-model",l)}},injectTrackedControls:function(n){var e=this.data,t=cj;this.el.setAttribute("tracked-controls",{id:t,hand:e.hand,handTrackingEnabled:!1,iterateControllerProfiles:!0}),this.loadModel(n)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e=this.mapping[this.data.hand].buttons[n.detail.id];if(e){if(this.isTouchV3orPROorPlus)this.onButtonChangedV3orPROorPlus(n);else{var t,i=this.buttonMeshes;e!=="trigger"&&e!=="grip"||(t=n.detail.state.value),i&&(e==="trigger"&&i.trigger&&(i.trigger.rotation.x=this.originalXRotationTrigger-t*(Math.PI/26)),e==="grip"&&i.grip&&(t*=this.data.hand==="left"?-1:1,i.grip.position.x=this.originalXPositionGrip+.004*t))}this.el.emit(e+"changed",n.detail.state)}},onButtonChangedV3orPROorPlus:function(n){var e,t=this.mapping[this.data.hand].buttons[n.detail.id],i=this.buttonObjects;i&&i[t]&&(e=n.detail.state.value,i[t].quaternion.slerpQuaternions(this.buttonRanges[t].min.quaternion,this.buttonRanges[t].max.quaternion,e),i[t].position.lerpVectors(this.buttonRanges[t].min.position,this.buttonRanges[t].max.position,e))},onModelLoaded:function(n){if(n.target===this.el&&this.data.model){if(this.isTouchV3orPROorPlus)this.onTouchV3orPROorPlusModelLoaded(n);else{var e,t=this.controllerObject3D=n.detail.model;(e=this.buttonMeshes={}).grip=t.getObjectByName("buttonHand"),this.originalXPositionGrip=e.grip&&e.grip.position.x,e.trigger=t.getObjectByName("buttonTrigger"),this.originalXRotationTrigger=e.trigger&&e.trigger.rotation.x,e.thumbstick=t.getObjectByName("stick"),e.xbutton=t.getObjectByName("buttonX"),e.abutton=t.getObjectByName("buttonA"),e.ybutton=t.getObjectByName("buttonY"),e.bbutton=t.getObjectByName("buttonB")}for(var i in this.buttonMeshes)this.buttonMeshes[i]&&$qe(this.buttonMeshes[i]);this.applyOffset(n.detail.model),this.el.emit("controllermodelready",{name:"meta-touch-controls",model:this.data.model,rayOrigin:this.displayModel[this.data.hand].rayOrigin})}},applyOffset:function(n){n.position.copy(this.displayModel[this.data.hand].modelPivotOffset),n.rotation.copy(this.displayModel[this.data.hand].modelPivotRotation)},onTouchV3orPROorPlusModelLoaded:function(n){var e=this.controllerObject3D=n.detail.model,t=this.buttonObjects={},i=this.buttonMeshes={},s=this.buttonRanges={};i.grip=e.getObjectByName("squeeze"),t.grip=e.getObjectByName("xr_standard_squeeze_pressed_value"),s.grip={min:e.getObjectByName("xr_standard_squeeze_pressed_min"),max:e.getObjectByName("xr_standard_squeeze_pressed_max")},t.grip.minX=t.grip.position.x,i.thumbstick=e.getObjectByName("thumbstick"),t.thumbstick=e.getObjectByName("xr_standard_thumbstick_pressed_value"),s.thumbstick={min:e.getObjectByName("xr_standard_thumbstick_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_pressed_max")},t.thumbstickXAxis=e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_value"),s.thumbstickXAxis={min:e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_xaxis_pressed_max")},t.thumbstickYAxis=e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_value"),s.thumbstickYAxis={min:e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_min"),max:e.getObjectByName("xr_standard_thumbstick_yaxis_pressed_max")},i.trigger=e.getObjectByName("trigger"),t.trigger=e.getObjectByName("xr_standard_trigger_pressed_value"),s.trigger={min:e.getObjectByName("xr_standard_trigger_pressed_min"),max:e.getObjectByName("xr_standard_trigger_pressed_max")},s.trigger.diff={x:Math.abs(s.trigger.max.rotation.x)-Math.abs(s.trigger.min.rotation.x),y:Math.abs(s.trigger.max.rotation.y)-Math.abs(s.trigger.min.rotation.y),z:Math.abs(s.trigger.max.rotation.z)-Math.abs(s.trigger.min.rotation.z)};var l=this.data.hand==="left"?"x":"a",u=this.data.hand==="left"?"y":"b",d=l+"button",p=u+"button";i[d]=e.getObjectByName(l+"_button"),t[d]=e.getObjectByName(l+"_button_pressed_value"),s[d]={min:e.getObjectByName(l+"_button_pressed_min"),max:e.getObjectByName(l+"_button_pressed_max")},i[p]=e.getObjectByName(u+"_button"),t[p]=e.getObjectByName(u+"_button_pressed_value"),s[p]={min:e.getObjectByName(u+"_button_pressed_min"),max:e.getObjectByName(u+"_button_pressed_max")}},onAxisMoved:function(n){gc(this,this.mapping[this.data.hand].axes,n)},onThumbstickMoved:function(n){if(this.buttonMeshes&&this.buttonMeshes.thumbstick)if(this.isTouchV3orPROorPlus)this.updateThumbstickTouchV3orPROorPlus(n);else for(var e in n.detail)this.buttonObjects.thumbstick.rotation[this.axisMap[e]]=this.buttonRanges.thumbstick.originalRotation[this.axisMap[e]]-Math.PI/8*n.detail[e]*(e==="y"||this.data.hand==="right"?-1:1)},axisMap:{y:"x",x:"z"},updateThumbstickTouchV3orPROorPlus:function(n){var e=(n.detail.x+1)/2;this.buttonObjects.thumbstickXAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickXAxis.min.quaternion,this.buttonRanges.thumbstickXAxis.max.quaternion,e);var t=(n.detail.y+1)/2;this.buttonObjects.thumbstickYAxis.quaternion.slerpQuaternions(this.buttonRanges.thumbstickYAxis.min.quaternion,this.buttonRanges.thumbstickYAxis.max.quaternion,t)},updateModel:function(n,e){this.data.model&&this.updateButtonModel(n,e)},updateButtonModel:function(n,e){var t,i=this.buttonMeshes;i&&i[n]&&(t=e==="up"||e==="touchend"?i[n].originalColor||this.data.buttonColor:e==="touchstart"?this.data.buttonTouchColor:this.data.buttonHighlightColor,i[n].material.color.set(t))}};function $qe(n){n.traverse(function(e){var t;e.type==="Mesh"&&(t=e.material.clone(),n.originalColor=e.material.color,e.material.dispose(),e.material=t)})}In("oculus-touch-controls",hj),In("meta-touch-controls",hj),In("obb-collider",{schema:{size:{default:0},trackedObject3D:{default:""},minimumColliderDimension:{default:.02},centerModel:{default:!1}},init:function(){this.previousScale=new Z.Vector3().copy(this.el.object3D.scale),this.auxEuler=new Z.Euler,this.boundingBox=new Z.Box3,this.boundingBoxSize=new Z.Vector3,this.updateCollider=this.updateCollider.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.updateBoundingBox=this.updateBoundingBox.bind(this),this.el.addEventListener("model-loaded",this.onModelLoaded),this.updateCollider(),this.system.addCollider(this.el)},remove:function(){this.system.removeCollider(this.el)},update:function(){this.data.trackedObject3D&&(this.trackedObject3DPath=this.data.trackedObject3D.split("."))},onModelLoaded:function(){this.data.centerModel&&this.centerModel(),this.updateCollider()},centerModel:function(){var n,e=this.el,t=e.components["gltf-model"]&&e.components["gltf-model"].model;t&&(this.el.removeObject3D("mesh"),n=new Z.Box3().setFromObject(t).getCenter(new Z.Vector3),t.position.x+=t.position.x-n.x,t.position.y+=t.position.y-n.y,t.position.z+=t.position.z-n.z,this.el.setObject3D("mesh",t))},updateCollider:function(){var n=this.el,e=this.boundingBoxSize,t=this.aabb=this.aabb||new uS;this.obb=this.obb||new uS,n.hasLoaded?(this.updateBoundingBox(),t.halfSize.copy(e).multiplyScalar(.5),this.el.sceneEl.systems["obb-collider"].data.showColliders&&this.showCollider()):n.addEventListener("loaded",this.updateCollider)},showCollider:function(){this.updateColliderMesh(),this.renderColliderMesh.visible=!0},updateColliderMesh:function(){var n=this.renderColliderMesh,e=this.boundingBoxSize;n?(n.geometry.dispose(),n.geometry=new Z.BoxGeometry(e.x,e.y,e.z)):this.initColliderMesh()},hideCollider:function(){this.renderColliderMesh&&(this.renderColliderMesh.visible=!1)},initColliderMesh:function(){var n,e,t;n=this.boundingBoxSize,e=this.renderColliderGeometry=new Z.BoxGeometry(n.x,n.y,n.z),(t=this.renderColliderMesh=new Z.Mesh(e,new Z.MeshLambertMaterial({color:65280,side:Z.DoubleSide}))).matrixAutoUpdate=!1,t.matrixWorldAutoUpdate=!1,t.updateMatrixWorld=function(){},this.el.sceneEl.object3D.add(t)},updateBoundingBox:(S_=new Z.Vector3,T_=new Z.Vector3,XP=new Z.Quaternion,lj=new Z.Quaternion,$P=new Z.Matrix4,function(){var n=this.auxEuler,e=this.boundingBox,t=this.data.size,i=this.trackedObject3D||this.el.object3D,s=this.boundingBoxSize,l=this.data.minimumColliderDimension;if(t)return this.boundingBoxSize.x=t,this.boundingBoxSize.y=t,void(this.boundingBoxSize.z=t);n.copy(i.rotation),i.rotation.set(0,0,0),i.parent.matrixWorld.decompose(S_,XP,T_),$P.compose(S_,lj,T_),i.parent.matrixWorld.copy($P),e.setFromObject(i,!0),e.getSize(s),s.x=s.x<l?l:s.x,s.y=s.y<l?l:s.y,s.z=s.z<l?l:s.z,i.parent.matrixWorld.compose(S_,XP,T_),this.el.object3D.rotation.copy(n)}),checkTrackedObject:function(){var n,e=this.trackedObject3DPath;if(e&&e.length&&!this.trackedObject3D){n=this.el;for(var t=0;t<e.length&&(n=n[e[t]]);t++);n&&(this.trackedObject3D=n,this.updateCollider())}return this.trackedObject3D},tick:function(){var n=new Z.Vector3,e=new Z.Vector3,t=new Z.Quaternion,i=new Z.Matrix4;return function(){var s=this.obb,l=this.renderColliderMesh,u=this.checkTrackedObject()||this.el.object3D;u&&(u.updateMatrix(),u.updateMatrixWorld(!0),u.matrixWorld.decompose(n,t,e),(Math.abs(e.x-this.previousScale.x)>1e-4||Math.abs(e.y-this.previousScale.y)>1e-4||Math.abs(e.z-this.previousScale.z)>1e-4)&&this.updateCollider(),this.previousScale.copy(e),e.set(1,1,1),i.compose(n,t,e),l&&l.matrixWorld.copy(i),s.copy(this.aabb),s.applyMatrix4(i))}}()});var Qqe=Ki("components:obj-model:warn"),Kqe=(In("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function(){var n=this;this.model=null,this.objLoader=new yse,this.mtlLoader=new Ase(this.objLoader.manager),this.mtlLoader.crossOrigin="",this.el.addEventListener("componentinitialized",function(e){n.model&&e.detail.name==="material"&&n.applyMaterial()})},update:function(){var n=this.data;n.obj&&(this.resetMesh(),this.loadObj(n.obj,n.mtl))},remove:function(){this.resetMesh()},resetMesh:function(){this.model&&this.el.removeObject3D("mesh")},loadObj:function(n,e){var t=this,i=this.el,s=this.mtlLoader,l=this.objLoader,u=this.el.sceneEl.systems.renderer,d=e.substr(0,e.lastIndexOf("/")+1);if(e)return i.hasAttribute("material")&&Qqe("Material component properties are ignored when a .MTL is provided"),s.setResourcePath(d),void s.load(e,function(p){p.preload(),l.setMaterials(p),l.load(n,function(g){t.model=g,t.model.traverse(function(x){if(x.isMesh){var b=x.material;b.map&&u.applyColorCorrection(b.map),b.emissiveMap&&u.applyColorCorrection(b.emissiveMap)}}),i.setObject3D("mesh",g),i.emit("model-loaded",{format:"obj",model:g})})});l.load(n,function(p){t.model=p,t.applyMaterial(),i.setObject3D("mesh",p),i.emit("model-loaded",{format:"obj",model:p})})},applyMaterial:function(){var n=this.el.components.material;n&&this.model.traverse(function(e){e instanceof Z.Mesh&&(e.material=n.material)})}}),as+"controllers/oculus/go/oculus-go-controller.gltf"),dj="oculus-go",fj=(In("oculus-go-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#FFFFFF"},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var n=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("model-loaded",this.onModelLoaded),n.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("model-loaded",this.onModelLoaded),n.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){Nl(this,dj,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{hand:e.hand,idPrefix:dj}),this.data.model&&this.el.setAttribute("gltf-model",Kqe)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(n){var e,t=n.detail.model;n.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).trigger=t.getObjectByName("oculus_go_button_trigger"),e.trackpad=t.getObjectByName("oculus_go_touchpad"),e.touchpad=t.getObjectByName("oculus_go_touchpad"))},onButtonChanged:function(n){var e=this.mapping.buttons[n.detail.id];e&&this.el.emit(e+"changed",n.detail.state)},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},updateModel:function(n,e){this.data.model&&this.updateButtonModel(n,e)},updateButtonModel:function(n,e){var t=this.buttonMeshes;if(t&&t[n]){var i;switch(e){case"down":i=this.data.buttonHighlightColor;break;case"touchstart":i=this.data.buttonTouchedColor;break;default:i=this.data.buttonColor}t[n].material.color.set(i)}}}),"pico-4"),Zqe=as+"controllers/pico/pico4/",pj=(In("pico-controls",{schema:{hand:{default:"none"},model:{default:!0}},mapping:{left:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","xbutton","ybutton"]},right:{axes:{thumbstick:[2,3]},buttons:["trigger","grip","none","thumbstick","abutton","bbutton"]}},init:function(){var n=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n,n.data.hand)},this.onButtonUp=function(e){ri(e.detail.id,"up",n,n.data.hand)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n,n.data.hand)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n,n.data.hand)},this.bindMethods()},update:function(){var n=this.data;this.controllerIndex=n.hand==="right"?0:n.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data;Nl(this,fj,{index:this.controllerIndex,hand:n.hand})},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{idPrefix:fj,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("gltf-model",Zqe+this.data.hand+".glb")},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping[this.data.hand].buttons[n.detail.id];t&&(t==="trigger"&&(e=n.detail.state.value,console.log("analog value of trigger press: "+e)),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){n.target===this.el&&this.data.model&&this.el.emit("controllermodelready",{name:"pico-controls",model:this.data.model,rayOrigin:new Z.Vector3(0,0,0)})},onAxisMoved:function(n){gc(this,this.mapping[this.data.hand].axes,n)}}),In("position",{schema:{type:"vec3"},update:function(){var n=this.el.object3D,e=this.data;n.position.set(e.x,e.y,e.z)},remove:function(){this.el.object3D.position.set(0,0,0)}}),Ki("components:raycaster:warn")),jqe=/^[\w\s-.,[\]#]*$/,Yqe={childList:!0,attributes:!0,subtree:!0},mj="raycaster-intersected-cleared",gj="raycaster-intersection-cleared";function yj(n,e){var t;for(n.length=e.length,t=0;t<e.length;t++)n[t]=e[t]}In("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},showLine:{default:!1},lineColor:{default:"white"},lineOpacity:{default:1},useWorldCoordinates:{default:!1}},multiple:!0,init:function(){this.clearedIntersectedEls=[],this.unitLineEndVec3=new Z.Vector3,this.intersectedEls=[],this.intersections=[],this.newIntersectedEls=[],this.newIntersections=[],this.objects=[],this.prevCheckTime=void 0,this.prevIntersectedEls=[],this.rawIntersections=[],this.raycaster=new Z.Raycaster,this.updateOriginDirection(),this.setDirty=this.setDirty.bind(this),this.updateLine=this.updateLine.bind(this),this.observer=new MutationObserver(this.setDirty),this.dirty=!0,this.lineEndVec3=new Z.Vector3,this.otherLineEndVec3=new Z.Vector3,this.lineData={end:this.lineEndVec3},this.getIntersection=this.getIntersection.bind(this),this.intersectedDetail={el:this.el,getIntersection:this.getIntersection},this.intersectedClearedDetail={el:this.el},this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls},this.intersectionDetail={}},update:function(n){var e=this.data,t=this.el,i=this.raycaster;i.far=e.far,i.near=e.near,!e.showLine||e.far===n.far&&e.origin===n.origin&&e.direction===n.direction&&n.showLine||(this.unitLineEndVec3.copy(e.direction).normalize(),this.drawLine()),!e.showLine&&n.showLine&&t.removeAttribute("line"),e.objects===n.objects||jqe.test(e.objects)||pj('[raycaster] Selector "'+e.objects+'" may not update automatically with DOM changes.'),e.objects||pj('[raycaster] For performance, please define raycaster.objects when using raycaster or cursor components to whitelist which entities to intersect with. e.g., raycaster="objects: [data-raycastable]".'),e.autoRefresh!==n.autoRefresh&&t.isPlaying&&(e.autoRefresh?this.addEventListeners():this.removeEventListeners()),n.enabled&&!e.enabled&&this.clearAllIntersections(),e.objects!==n.objects&&this.setDirty()},play:function(){this.addEventListeners()},pause:function(){this.removeEventListeners()},remove:function(){this.data.showLine&&this.el.removeAttribute("line"),this.clearAllIntersections()},addEventListeners:function(){this.data.autoRefresh&&(this.observer.observe(this.el.sceneEl,Yqe),this.el.sceneEl.addEventListener("object3dset",this.setDirty),this.el.sceneEl.addEventListener("object3dremove",this.setDirty))},removeEventListeners:function(){this.observer.disconnect(),this.el.sceneEl.removeEventListener("object3dset",this.setDirty),this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function(){this.dirty=!0},refreshObjects:function(){var n,e=this.data;n=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.querySelectorAll("*"),this.objects=this.flattenObject3DMaps(n),this.dirty=!1},tock:function(n){var e=this.data,t=this.prevCheckTime;e.enabled&&(t&&n-t<e.interval||(this.prevCheckTime=n,this.checkIntersections()))},checkIntersections:function(){var n,e,t=this.clearedIntersectedEls,i=this.el,s=this.data,l=this.intersectedEls,u=this.intersections,d=this.newIntersectedEls,p=this.newIntersections,g=this.prevIntersectedEls,x=this.rawIntersections;for(this.dirty&&this.refreshObjects(),yj(this.prevIntersectedEls,this.intersectedEls),this.updateOriginDirection(),x.length=0,this.raycaster.intersectObjects(this.objects,!0,x),u.length=0,l.length=0,n=0;n<x.length;n++)e=x[n],s.showLine&&e.object===i.getObject3D("line")||e.object.el&&(u.push(e),l.push(e.object.el));for(p.length=0,d.length=0,n=0;n<u.length;n++)g.indexOf(u[n].object.el)===-1&&(p.push(u[n]),d.push(u[n].object.el));for(t.length=0,n=0;n<g.length;n++)l.indexOf(g[n])===-1&&(g[n].emit(mj,this.intersectedClearedDetail),t.push(g[n]));for(t.length&&i.emit(gj,this.intersectionClearedDetail),n=0;n<d.length;n++)d[n].emit("raycaster-intersected",this.intersectedDetail);p.length&&(this.intersectionDetail.els=d,this.intersectionDetail.intersections=p,i.emit("raycaster-intersection",this.intersectionDetail)),(g.length===0&&u.length>0||g.length>0&&u.length===0||g.length&&u.length&&g[0]!==u[0].object.el)&&(this.intersectionDetail.els=this.intersectedEls,this.intersectionDetail.intersections=u,i.emit("raycaster-closest-entity-changed",this.intersectionDetail)),s.showLine&&setTimeout(this.updateLine)},updateLine:function(){var n,e=this.el,t=this.intersections;t.length&&(n=t[0].object.el===e&&t[1]?t[1].distance:t[0].distance),this.drawLine(n)},getIntersection:function(n){var e,t;for(e=0;e<this.intersections.length;e++)if((t=this.intersections[e]).object.el===n)return t;return null},updateOriginDirection:function(){var n=new Z.Vector3,e=new Z.Vector3;return function(){var t=this.el,i=this.data;i.useWorldCoordinates?this.raycaster.set(i.origin,i.direction):(t.object3D.updateMatrixWorld(),e.setFromMatrixPosition(t.object3D.matrixWorld),i.origin.x===0&&i.origin.y===0&&i.origin.z===0||(e=t.object3D.localToWorld(e.copy(i.origin))),n.copy(i.direction).transformDirection(t.object3D.matrixWorld).normalize(),this.raycaster.set(e,n))}}(),drawLine:function(n){var e,t=this.data,i=this.el;e=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3,n===void 0&&(n=t.far===1/0?1e3:t.far),this.lineData.start=t.origin,this.lineData.end=e.copy(this.unitLineEndVec3).multiplyScalar(n).add(t.origin),this.lineData.color=t.lineColor,this.lineData.opacity=t.lineOpacity,i.setAttribute("line",this.lineData)},flattenObject3DMaps:function(n){var e,t,i=this.objects,s=this.el.sceneEl.object3D;function l(d){return d.parent?l(d.parent):d===s}for(i.length=0,t=0;t<n.length;t++){var u=n[t];if(u.isEntity&&u.object3D&&l(u.object3D))for(e in u.object3DMap)i.push(u.getObject3D(e))}return i},clearAllIntersections:function(){var n;for(n=0;n<this.intersectedEls.length;n++)this.intersectedEls[n].emit(mj,this.intersectedClearedDetail);yj(this.clearedIntersectedEls,this.intersectedEls),this.intersectedEls.length=0,this.intersections.length=0,this.el.emit(gj,this.intersectionClearedDetail)}});var Aj,Iy,vj,bj,QP=Z.MathUtils.degToRad,KP=(In("rotation",{schema:{type:"vec3"},update:function(){var n=this.data;this.el.object3D.rotation.set(QP(n.x),QP(n.y),QP(n.z),"YXZ")},remove:function(){this.el.object3D.rotation.set(0,0,0)}}),In("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function(){var n=this.data;this.el.object3D.scale.set(n.x,n.y,n.z)},remove:function(){this.el.object3D.scale.set(1,1,1)}}),In("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function(){this.onMeshChanged=this.update.bind(this),this.el.addEventListener("object3dset",this.onMeshChanged),this.system.setShadowMapEnabled(!0)},update:function(){var n=this.data;this.updateDescendants(n.cast,n.receive)},remove:function(){this.el.removeEventListener("object3dset",this.onMeshChanged),this.updateDescendants(!1,!1)},updateDescendants:function(n,e){var t=this.el.sceneEl;this.el.object3D.traverse(function(i){if(i instanceof Z.Mesh&&(i.castShadow=n,i.receiveShadow=e,t.hasLoaded&&i.material))for(var s=Array.isArray(i.material)?i.material:[i.material],l=0;l<s.length;l++)s[l].needsUpdate=!0})}}),Ki("components:sound:warn")),qqe=(In("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},loopStart:{default:0},loopEnd:{default:0},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function(){var n=this;this.listener=null,this.audioLoader=new Z.AudioLoader,this.pool=new Z.Group,this.loaded=!1,this.mustPlay=!1,this.playSoundBound=function(){n.playSound()}},update:function(n){var e,t,i=this.data,s=i.src!==n.src;if(s){if(!i.src)return;this.setupSound()}for(e=0;e<this.pool.children.length;e++)t=this.pool.children[e],i.positional&&(t.setDistanceModel(i.distanceModel),t.setMaxDistance(i.maxDistance),t.setRefDistance(i.refDistance),t.setRolloffFactor(i.rolloffFactor)),t.setLoop(i.loop),t.setLoopStart(i.loopStart),i.loopStart!==0&&i.loopEnd===0?t.setLoopEnd(t.buffer.duration):t.setLoopEnd(i.loopEnd),t.setVolume(i.volume),t.isPaused=!1;if(i.on!==n.on&&this.updateEventListener(n.on),s){var l=this;this.loaded=!1,this.audioLoader.load(i.src,function(u){for(e=0;e<l.pool.children.length;e++)(t=l.pool.children[e]).setBuffer(u);l.loaded=!0,Z.Cache.remove(i.src),(l.data.autoplay||l.mustPlay)&&l.playSound(l.processSound),l.el.emit("sound-loaded",l.evtDetail,!1)})}},pause:function(){this.stopSound(),this.removeEventListener()},play:function(){this.data.autoplay&&this.playSound(),this.updateEventListener()},remove:function(){var n;this.removeEventListener(),this.el.getObject3D(this.attrName)&&this.el.removeObject3D(this.attrName);try{for(n=0;n<this.pool.children.length;n++)this.pool.children[n].disconnect()}catch{KP("Audio source not properly disconnected")}},updateEventListener:function(n){var e=this.el;n&&e.removeEventListener(n,this.playSoundBound),e.addEventListener(this.data.on,this.playSoundBound)},removeEventListener:function(){this.el.removeEventListener(this.data.on,this.playSoundBound)},setupSound:function(){var n,e,t=this.el,i=t.sceneEl,s=this;this.pool.children.length>0&&(this.stopSound(),t.removeObject3D("sound"));var l=this.listener=i.audioListener||new Z.AudioListener;for(i.audioListener=l,i.camera&&i.camera.add(l),i.addEventListener("camera-set-active",function(u){u.detail.cameraEl.getObject3D("camera").add(l)}),this.pool=new Z.Group,n=0;n<this.data.poolSize;n++)e=this.data.positional?new Z.PositionalAudio(l):new Z.Audio(l),this.pool.add(e);for(t.setObject3D(this.attrName,this.pool),n=0;n<this.pool.children.length;n++)(e=this.pool.children[n]).onEnded=function(){this.isPlaying=!1,s.el.emit("sound-ended",s.evtDetail,!1)}},pauseSound:function(){var n,e;for(this.isPlaying=!1,n=0;n<this.pool.children.length;n++)(e=this.pool.children[n]).source&&e.source.buffer&&e.isPlaying&&!e.isPaused&&(e.isPaused=!0,e.pause())},playSound:function(n){var e,t,i;if(!this.loaded)return KP("Sound not loaded yet. It will be played once it finished loading"),this.mustPlay=!0,void(this.processSound=n);for(e=!1,this.isPlaying=!0,t=0;t<this.pool.children.length;t++)(i=this.pool.children[t]).isPlaying||!i.buffer||e||(n&&n(i),i.play(),i.isPaused=!1,e=!0);e?(this.mustPlay=!1,this.processSound=void 0):KP("All the sounds are playing. If you need to play more sounds simultaneously consider increasing the size of pool with the `poolSize` attribute.",this.el)},stopSound:function(){var n,e;for(this.isPlaying=!1,n=0;n<this.pool.children.length;n++){if(!(e=this.pool.children[n]).source||!e.source.buffer)return;e.stop()}}}),Pn(4433)),Jqe=Pn.n(qqe),eJe=Pn(5751),tJe=Pn.n(eJe),Sy=Ki("components:text:error"),nJe=Ki("components:text:warn"),ad=as+"fonts/",xj={aileronsemibold:ad+"Aileron-Semibold.fnt",dejavu:ad+"DejaVu-sdf.fnt",exo2bold:ad+"Exo2Bold.fnt",exo2semibold:ad+"Exo2SemiBold.fnt",kelsonsans:ad+"KelsonSans.fnt",monoid:ad+"Monoid.fnt",mozillavr:ad+"mozillavr.fnt",roboto:ad+"Roboto-msdf.json",sourcecodepro:ad+"SourceCodePro.fnt"},wj=["roboto"],ZP="roboto",Cj=new function(){var n=this.cache={};this.get=function(e,t){return e in n||(n[e]=t()),n[e]}},Ej={},k_={},iJe=/^\w+:/;function _j(n,e,t){return n||(.5+e)*t}In("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:ZP},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:rh},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function(){this.shaderData={},this.geometry=Jqe()(),this.createOrUpdateMaterial(),this.explicitGeoDimensionsChecked=!1},update:function(n){var e=this.data,t=this.currentFont;k_[e.font]?this.texture=k_[e.font]:(this.texture=k_[e.font]=new Z.Texture,this.texture.anisotropy=16),this.createOrUpdateMaterial(),n.font===e.font?t&&(this.updateGeometry(this.geometry,t),this.updateLayout()):this.updateFont()},remove:function(){this.geometry.dispose(),this.geometry=null,this.el.removeObject3D(this.attrName),this.material.dispose(),this.material=null,this.texture.dispose(),this.texture=null,this.shaderObject&&delete this.shaderObject},createOrUpdateMaterial:function(){var n,e,t,i=this.data,s=this.material,l=this.shaderData;if(t=i.shader,wj.indexOf(i.font)!==-1||i.font.indexOf("-msdf.")>=0?t="msdf":i.font in xj&&wj.indexOf(i.font)===-1&&(t="sdf"),n=(this.shaderObject&&this.shaderObject.name)!==t,l.alphaTest=i.alphaTest,l.color=i.color,l.map=this.texture,l.opacity=i.opacity,l.side=function(u){switch(u){case"back":return Z.FrontSide;case"double":return Z.DoubleSide;default:return Z.BackSide}}(i.side),l.transparent=i.transparent,l.negate=i.negate,!n)return this.shaderObject.update(l),s.transparent=l.transparent,void(s.side=l.side);e=function(u,d,p){var g,x;return(x=new rh[d].Shader).el=u,x.init(p),x.update(p),(g=x.material).transparent=p.transparent,{material:g,shader:x}}(this.el,t,l),this.material=e.material,this.shaderObject=e.shader,this.material.side=l.side,this.mesh&&(this.mesh.material=this.material)},updateFont:function(){var n,e=this.data,t=this.el,i=this.geometry,s=this;e.font||nJe("No font specified. Using the default font."),this.mesh&&(this.mesh.visible=!1),n=this.lookupFont(e.font||ZP)||e.font,Cj.get(n,function(){return function(l,u){return new Promise(function(d,p){tJe()(l,function(g,x){if(g)return Sy("Error loading font",l),void p(g);l.indexOf("/Roboto-msdf.json")>=0&&(u=30),u&&x.chars.forEach(function(b){b.yoffset+=u}),d(x)})})}(n,e.yOffset)}).then(function(l){var u;if(l.pages.length!==1)throw new Error("Currently only single-page bitmap fonts are supported.");Ej[n]||(l.widthFactor=Ej[l]=function(d){var p=0,g=0,x=0;return d.chars.forEach(function(b){p+=b.xadvance,b.id>=48&&b.id<=57&&(x++,g+=b.xadvance)}),x?g/x:p/d.chars.length}(l)),s.currentFont=l,u=s.getFontImageSrc(),Cj.get(u,function(){return function(d){return new Promise(function(p,g){new Z.ImageLoader().load(d,function(x){p(x)},void 0,function(){Sy("Error loading font image",d),g(null)})})}(u)}).then(function(d){var p=s.texture;p&&(p.image=d,p.needsUpdate=!0,k_[e.font]=p,s.texture=p,s.initMesh(),s.currentFont=l,s.updateGeometry(i,l),s.updateLayout(),s.mesh.visible=!0,t.emit("textfontset",{font:e.font,fontObj:l}))}).catch(function(d){Sy(d.message),Sy(d.stack)})}).catch(function(l){Sy(l.message),Sy(l.stack)})},initMesh:function(){this.mesh||(this.mesh=new Z.Mesh(this.geometry,this.material),this.el.setObject3D(this.attrName,this.mesh))},getFontImageSrc:function(){if(this.data.fontImage)return this.data.fontImage;var n=this.lookupFont(this.data.font||ZP)||this.data.font,e=this.currentFont.pages[0];return e.match(iJe)&&e.indexOf("http")!==0?n.replace(/(\.fnt)|(\.json)/,".png"):Z.LoaderUtils.extractUrlBase(n)+e},updateLayout:function(){var n,e,t,i,s,l,u,d,p,g=this.el,x=this.data,b=this.geometry,E=this.mesh;if(E&&b.layout){if(t=g.getAttribute("geometry"),i=(l=(u=x.width||t&&t.width||1)/_j(x.wrapPixels,x.wrapCount,this.currentFont.widthFactor))*((s=b.layout).height+s.descender),t&&t.primitive==="plane"&&(this.explicitGeoDimensionsChecked||(this.explicitGeoDimensionsChecked=!0,this.hasExplicitGeoWidth=!!t.width,this.hasExplicitGeoHeight=!!t.height),this.hasExplicitGeoWidth||g.setAttribute("geometry","width",u),this.hasExplicitGeoHeight||g.setAttribute("geometry","height",i)),(n=x.anchor==="align"?x.align:x.anchor)==="left")d=0;else if(n==="right")d=-1*s.width;else{if(n!=="center")throw new TypeError("Invalid text.anchor property value",n);d=-1*s.width/2}if((e=x.baseline)==="bottom")p=0;else if(e==="top")p=-1*s.height+s.ascender;else{if(e!=="center")throw new TypeError("Invalid text.baseline property value",e);p=-1*s.height/2}E.position.x=d*l+x.xOffset,E.position.y=p*l,E.position.z=x.zOffset,E.scale.set(l,-1*l,l)}},lookupFont:function(n){return xj[n]},updateGeometry:(Aj={},Iy={},vj=/\\n/g,bj=/\\t/g,function(n,e){var t=this.data;Iy.font=e,Iy.lineHeight=t.lineHeight&&isFinite(t.lineHeight)?t.lineHeight:e.common.lineHeight,Iy.text=t.value.toString().replace(vj,`
`).replace(bj,"	"),Iy.width=_j(t.wrapPixels,t.wrapCount,e.widthFactor),n.update(Ja(Aj,t,Iy))})});var Ty,jP,Ij=(In("tracked-controls",{schema:{id:{type:"string",default:""},controller:{default:-1},autoHide:{default:!0},hand:{type:"string",default:""},handTrackingEnabled:{default:!1},iterateControllerProfiles:{default:!1}},init:function(){this.buttonEventDetails={},this.buttonStates=this.el.components["tracked-controls"].buttonStates={},this.axis=this.el.components["tracked-controls"].axis=[0,0,0],this.changedAxes=[],this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes},this.updateController=this.updateController.bind(this)},update:function(){this.updateController()},play:function(){var n=this.el.sceneEl;this.updateController(),n.addEventListener("controllersupdated",this.updateController)},pause:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.updateController)},isControllerPresent:function(n){return!(!this.controller||this.controller.gamepad||n.inputSource.handedness!=="none"&&n.inputSource.handedness!==this.data.hand)},updateController:function(){this.controller=oU(this.system.controllers,this.data.id,this.data.hand,this.data.controller,this.data.iterateControllerProfiles,this.data.handTrackingEnabled),this.el.components["tracked-controls"].controller=this.controller},tick:function(){var n=this.el.sceneEl,e=this.controller,t=n.frame;this.data.autoHide&&(this.el.object3D.visible=!!e),e&&n.frame&&this.system.referenceSpace&&(e.hand||(this.pose=t.getPose(e.gripSpace,this.system.referenceSpace),this.updatePose(),this.updateButtons()))},updatePose:function(){var n=this.el.object3D,e=this.pose;e&&(n.matrix.elements=e.transform.matrix,n.matrix.decompose(n.position,n.rotation,n.scale))},updateButtons:function(){var n,e,t,i=this.controller;if(i&&i.gamepad){for(t=i.gamepad,e=0;e<t.buttons.length;++e)this.buttonStates[e]||(this.buttonStates[e]={pressed:!1,touched:!1,value:0}),this.buttonEventDetails[e]||(this.buttonEventDetails[e]={id:e,state:this.buttonStates[e]}),n=t.buttons[e],this.handleButton(e,n);this.handleAxes()}},handleButton:function(n,e){return!!(this.handlePress(n,e)|this.handleTouch(n,e)|this.handleValue(n,e))&&(this.el.emit("buttonchanged",this.buttonEventDetails[n],!1),!0)},handleAxes:function(){var n,e=!1,t=this.controller.gamepad.axes,i=this.axis,s=this.changedAxes;for(this.changedAxes.splice(0,this.changedAxes.length),n=0;n<t.length;++n)s.push(i[n]!==t[n]),s[n]&&(e=!0);if(!e)return!1;for(this.axis.splice(0,this.axis.length),n=0;n<t.length;n++)this.axis.push(t[n]);return this.el.emit("axismove",this.axisMoveEventDetail,!1),!0},handlePress:function(n,e){var t,i=this.buttonStates[n];return e.pressed!==i.pressed&&(t=e.pressed?"buttondown":"buttonup",this.el.emit(t,this.buttonEventDetails[n],!1),i.pressed=e.pressed,!0)},handleTouch:function(n,e){var t,i=this.buttonStates[n];return e.touched!==i.touched&&(t=e.touched?"touchstart":"touchend",this.el.emit(t,this.buttonEventDetails[n],!1),i.touched=e.touched,!0)},handleValue:function(n,e){var t=this.buttonStates[n];return e.value!==t.value&&(t.value=e.value,!0)}}),In("visible",{schema:{default:!0},update:function(){this.el.object3D.visible=this.data}}),as+"controllers/valve/index/valve-index-"),rJe={left:Ij+"left.glb",right:Ij+"right.glb"},Sj="valve",sJe={left:{x:0,y:-.05,z:.06},right:{x:0,y:-.05,z:.06}},oJe={left:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"},right:{_x:Math.PI/3,_y:0,_z:0,_order:"XYZ"}},aJe=(In("valve-index-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{trackpad:[0,1],thumbstick:[2,3]},buttons:["trigger","grip","trackpad","thumbstick","abutton"]},init:function(){var n=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.previousButtonValues={},this.bindMethods()},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("model-loaded",this.onModelLoaded),n.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("model-loaded",this.onModelLoaded),n.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data,e=n.hand==="right"?0:n.hand==="left"?1:2;Nl(this,Sj,{index:e,iterateControllerProfiles:!0,hand:n.hand})},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{idPrefix:Sj,controller:e.hand==="right"?1:e.hand==="left"?0:2,hand:e.hand}),this.loadModel()},loadModel:function(){var n=this.data;n.model&&this.el.setAttribute("gltf-model",""+rJe[n.hand])},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping.buttons[n.detail.id],i=this.buttonMeshes;t&&(t==="trigger"&&(e=n.detail.state.value,i&&i.trigger&&(i.trigger.rotation.x=this.triggerOriginalRotationX-e*(Math.PI/40))),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){var e,t=n.detail.model,i=this;n.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).grip={left:t.getObjectByName("leftgrip"),right:t.getObjectByName("rightgrip")},e.menu=t.getObjectByName("menubutton"),e.system=t.getObjectByName("systembutton"),e.trackpad=t.getObjectByName("touchpad"),e.trigger=t.getObjectByName("trigger"),this.triggerOriginalRotationX=e.trigger.rotation.x,Object.keys(e).forEach(function(s){i.setButtonColor(s,i.data.buttonColor)}),t.position.copy(oJe[this.data.hand]),t.rotation.copy(sJe[this.data.hand]),this.el.emit("controllermodelready",{name:"valve-index-controls",model:this.data.model,rayOrigin:new Z.Vector3(0,0,0)}))},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},updateModel:function(n,e){var t;this.data.model&&(e.indexOf("touch")!==-1||(t=e==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(n,t)))},setButtonColor:function(n,e){}}),as+"controllers/vive/vr_controller_vive.obj"),lJe=as+"controllers/vive/vr_controller_vive.mtl",Tj="htc-vive",cJe=(In("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","grip","touchpad","none"]},init:function(){var n=this;this.controllerPresent=!1,this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.previousButtonValues={},this.bindMethods()},update:function(){var n=this.data;this.controllerIndex=n.hand==="right"?0:n.hand==="left"?1:2},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("model-loaded",this.onModelLoaded),n.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("model-loaded",this.onModelLoaded),n.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1},checkIfControllerPresent:function(){var n=this.data;Nl(this,Tj,{index:this.controllerIndex,hand:n.hand})},injectTrackedControls:function(){var n=this.el,e=this.data;n.setAttribute("tracked-controls",{idPrefix:Tj,hand:e.hand,controller:this.controllerIndex}),this.data.model&&this.el.setAttribute("obj-model",{obj:aJe,mtl:lJe})},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onButtonChanged:function(n){var e,t=this.mapping.buttons[n.detail.id],i=this.buttonMeshes;t&&(t==="trigger"&&(e=n.detail.state.value,i&&i.trigger&&(i.trigger.rotation.x=-e*(Math.PI/12))),this.el.emit(t+"changed",n.detail.state))},onModelLoaded:function(n){var e,t=n.detail.model,i=this;n.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).grip={left:t.getObjectByName("leftgrip"),right:t.getObjectByName("rightgrip")},e.menu=t.getObjectByName("menubutton"),e.system=t.getObjectByName("systembutton"),e.trackpad=t.getObjectByName("touchpad"),e.touchpad=t.getObjectByName("touchpad"),e.trigger=t.getObjectByName("trigger"),Object.keys(e).forEach(function(s){i.setButtonColor(s,i.data.buttonColor)}),t.position.set(0,-.015,.04))},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},updateModel:function(n,e){var t;this.data.model&&(e.indexOf("touch")!==-1||(t=e==="up"?this.data.buttonColor:this.data.buttonHighlightColor,this.setButtonColor(n,t)))},setButtonColor:function(n,e){var t=this.buttonMeshes;if(t)return n==="grip"?(t.grip.left.material.color.set(e),void t.grip.right.material.color.set(e)):void t[n].material.color.set(e)}}),as+"controllers/vive/focus-controller/focus-controller.gltf"),Mj="htc-vive-focus",kj=(In("vive-focus-controls",{schema:{hand:{default:""},buttonTouchedColor:{type:"color",default:"#BBBBBB"},buttonHighlightColor:{type:"color",default:"#7A7A7A"},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1]},buttons:["trigger","none","touchpad","none","menu"]},bindMethods:function(){this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.removeControllersUpdateListener=this.removeControllersUpdateListener.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var n=this;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(e){ri(e.detail.id,"down",n)},this.onButtonUp=function(e){ri(e.detail.id,"up",n)},this.onButtonTouchStart=function(e){ri(e.detail.id,"touchstart",n)},this.onButtonTouchEnd=function(e){ri(e.detail.id,"touchend",n)},this.controllerPresent=!1,this.bindMethods()},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("model-loaded",this.onModelLoaded),n.addEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!0,this.addControllersUpdateListener()},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("model-loaded",this.onModelLoaded),n.removeEventListener("axismove",this.onAxisMoved),this.controllerEventsActive=!1,this.removeControllersUpdateListener()},checkIfControllerPresent:function(){Nl(this,Mj,this.data.hand?{hand:this.data.hand}:{})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},injectTrackedControls:function(){this.el.setAttribute("tracked-controls",{idPrefix:Mj}),this.data.model&&this.el.setAttribute("gltf-model",cJe)},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelLoaded:function(n){var e,t=n.detail.model;n.target===this.el&&this.data.model&&((e=this.buttonMeshes={}).trigger=t.getObjectByName("BumperKey"),e.triggerPressed=t.getObjectByName("BumperKey_Press"),e.triggerPressed&&(e.triggerPressed.visible=!1),e.touchpad=t.getObjectByName("TouchPad"),e.touchpadPressed=t.getObjectByName("TouchPad_Press"),e.trackpad=t.getObjectByName("TouchPad"),e.trackpadPressed=t.getObjectByName("TouchPad_Press"),e.trackpadPressed&&(e.trackpadPressed.visible=!1))},onButtonChanged:function(n){var e=this.mapping.buttons[n.detail.id];e&&this.el.emit(e+"changed",n.detail.state)},onAxisMoved:function(n){gc(this,this.mapping.axes,n)},updateModel:function(n,e){this.data.model&&this.updateButtonModel(n,e)},updateButtonModel:function(n,e){var t=this.buttonMeshes,i=n+"Pressed";if(t&&t[n]&&t[i]){var s;switch(e){case"down":s=this.data.buttonHighlightColor;break;case"touchstart":s=this.data.buttonTouchedColor}s&&t[i].material.color.set(s),t[i].visible=!!s,t[n].visible=!s}}}),{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}),uJe=uU,Rj=1e-5,hJe=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];In("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},after:["look-controls"],init:function(){this.keys={},this.easing=1.1,this.velocity=new Z.Vector3,this.onBlur=this.onBlur.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onFocus=this.onFocus.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.attachVisibilityEventListeners()},tick:function(n,e){var t=this.data,i=this.el,s=this.velocity;(s[t.adAxis]||s[t.wsAxis]||!function(l){var u;for(u in l)return!1;return!0}(this.keys))&&(e/=1e3,this.updateVelocity(e),(s[t.adAxis]||s[t.wsAxis])&&i.object3D.position.add(this.getMovementVector(e)))},update:function(n){n.adAxis!==this.data.adAxis&&(this.velocity[n.adAxis]=0),n.wsAxis!==this.data.wsAxis&&(this.velocity[n.wsAxis]=0)},remove:function(){this.removeKeyEventListeners(),this.removeVisibilityEventListeners()},play:function(){this.attachKeyEventListeners()},pause:function(){this.keys={},this.removeKeyEventListeners()},updateVelocity:function(n){var e,t,i,s,l,u=this.data,d=this.keys,p=this.velocity;if(t=u.adAxis,s=u.wsAxis,n>.2)return p[t]=0,void(p[s]=0);var g=Math.pow(1/this.easing,60*n);p[t]!==0&&(p[t]=p[t]*g),p[s]!==0&&(p[s]=p[s]*g),Math.abs(p[t])<Rj&&(p[t]=0),Math.abs(p[s])<Rj&&(p[s]=0),u.enabled&&(e=u.acceleration,u.adEnabled&&(i=u.adInverted?-1:1,(d.KeyA||d.ArrowLeft)&&(p[t]-=i*e*n),(d.KeyD||d.ArrowRight)&&(p[t]+=i*e*n)),u.wsEnabled&&(l=u.wsInverted?-1:1,(d.KeyW||d.ArrowUp)&&(p[s]-=l*e*n),(d.KeyS||d.ArrowDown)&&(p[s]+=l*e*n)))},getMovementVector:(Ty=new Z.Vector3(0,0,0),jP=new Z.Euler(0,0,0,"YXZ"),function(n){var e,t=this.el.getAttribute("rotation"),i=this.velocity;return Ty.copy(i),Ty.multiplyScalar(n),t&&(e=this.data.fly?t.x:0,jP.set(Z.MathUtils.degToRad(e),Z.MathUtils.degToRad(t.y),0),Ty.applyEuler(jP)),Ty}),attachVisibilityEventListeners:function(){window.oncontextmenu=this.onContextMenu,window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus),document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function(){window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)},onContextMenu:function(){for(var n=Object.keys(this.keys),e=0;e<n.length;e++)delete this.keys[n[e]]},onBlur:function(){this.pause()},onFocus:function(){this.play()},onVisibilityChange:function(){document.hidden?this.onBlur():this.onFocus()},onKeyDown:function(n){var e;uJe(n)&&(e=n.code||kj[n.keyCode],hJe.indexOf(e)!==-1&&(this.keys[e]=!0))},onKeyUp:function(n){var e;e=n.code||kj[n.keyCode],delete this.keys[e]}});var YP,R_,Hb,Xb=Ki("components:windows-motion-controls:debug"),My=Ki("components:windows-motion-controls:warn"),dJe=as+"controllers/microsoft/",Lj={left:"left.glb",right:"right.glb",default:"universal.glb"},Bj="windows-mixed-reality",ky=(In("windows-motion-controls",{schema:{hand:{default:"right"},pair:{default:0},model:{default:!0}},after:["tracked-controls"],mapping:{axes:{touchpad:[0,1],thumbstick:[2,3]},buttons:["trigger","squeeze","touchpad","thumbstick","menu"],axisMeshNames:["TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_X","THUMBSTICK_X","THUMBSTICK_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",squeeze:"GRASP",thumbstick:"THUMBSTICK_PRESS",touchpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function(){this.onModelError=this.onModelError.bind(this),this.onModelLoaded=this.onModelLoaded.bind(this),this.onControllersUpdate=this.onControllersUpdate.bind(this),this.checkIfControllerPresent=this.checkIfControllerPresent.bind(this),this.onAxisMoved=this.onAxisMoved.bind(this)},init:function(){var n=this,e=this.el;this.onButtonChanged=this.onButtonChanged.bind(this),this.onButtonDown=function(t){ri(t.detail.id,"down",n)},this.onButtonUp=function(t){ri(t.detail.id,"up",n)},this.onButtonTouchStart=function(t){ri(t.detail.id,"touchstart",n)},this.onButtonTouchEnd=function(t){ri(t.detail.id,"touchend",n)},this.onControllerConnected=function(){n.setModelVisibility(!0)},this.onControllerDisconnected=function(){n.setModelVisibility(!1)},this.controllerPresent=!1,this.previousButtonValues={},this.bindMethods(),this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null},this.rayOrigin={origin:new Z.Vector3,direction:new Z.Vector3(0,0,-1),createdFromMesh:!1},e.addEventListener("controllerconnected",this.onControllerConnected),e.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function(){var n=this.el;n.addEventListener("buttonchanged",this.onButtonChanged),n.addEventListener("buttondown",this.onButtonDown),n.addEventListener("buttonup",this.onButtonUp),n.addEventListener("touchstart",this.onButtonTouchStart),n.addEventListener("touchend",this.onButtonTouchEnd),n.addEventListener("axismove",this.onAxisMoved),n.addEventListener("model-error",this.onModelError),n.addEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!0},removeEventListeners:function(){var n=this.el;n.removeEventListener("buttonchanged",this.onButtonChanged),n.removeEventListener("buttondown",this.onButtonDown),n.removeEventListener("buttonup",this.onButtonUp),n.removeEventListener("touchstart",this.onButtonTouchStart),n.removeEventListener("touchend",this.onButtonTouchEnd),n.removeEventListener("axismove",this.onAxisMoved),n.removeEventListener("model-error",this.onModelError),n.removeEventListener("model-loaded",this.onModelLoaded),this.controllerEventsActive=!1},checkIfControllerPresent:function(){Nl(this,Bj,{hand:this.data.hand,index:this.data.pair,iterateControllerProfiles:!0})},play:function(){this.checkIfControllerPresent(),this.addControllersUpdateListener()},pause:function(){this.removeEventListeners(),this.removeControllersUpdateListener()},updateControllerModel:function(){if(this.data.model&&!this.rayOrigin.createdFromMesh){var n=this.createControllerModelUrl();this.loadModel(n)}else this.modelReady()},createControllerModelUrl:function(n){var e=this.data.hand;return dJe+"default/"+(Lj[e]||Lj.default)},injectTrackedControls:function(){var n=this.data;this.el.setAttribute("tracked-controls",{idPrefix:Bj,controller:n.pair,hand:n.hand}),this.updateControllerModel()},addControllersUpdateListener:function(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function(){this.checkIfControllerPresent()},onModelError:function(n){var e=this.createControllerModelUrl(!0);n.detail.src!==e?(My("Failed to load controller model for device, attempting to load default."),this.loadModel(e)):My("Failed to load default controller model.")},loadModel:function(n){this.el.setAttribute("gltf-model","url("+n+")")},onModelLoaded:function(n){var e,t,i,s,l=this.controllerModel=n.detail.model,u=this.loadedMeshInfo;if(n.target===this.el){if(Xb("Processing model"),u.buttonMeshes={},u.axisMeshes={},l){for(e=0;e<this.mapping.buttons.length;e++)(t=this.mapping.buttonMeshNames[this.mapping.buttons[e]])?(i=l.getObjectByName(t))?(s={index:e,value:d(i,"VALUE"),pressed:d(i,"PRESSED"),unpressed:d(i,"UNPRESSED")}).value&&s.pressed&&s.unpressed?u.buttonMeshes[this.mapping.buttons[e]]=s:My("Missing button submesh under mesh with name: "+t+"(VALUE: "+!!s.value+", PRESSED: "+!!s.pressed+", UNPRESSED:"+!!s.unpressed+")"):My("Missing button mesh with name: "+t):Xb("Skipping unknown button at index: "+e+" with mapped name: "+this.mapping.buttons[e]);for(e=0;e<this.mapping.axisMeshNames.length;e++)(t=this.mapping.axisMeshNames[e])?(i=l.getObjectByName(t))?(s={index:e,value:d(i,"VALUE"),min:d(i,"MIN"),max:d(i,"MAX")}).value&&s.min&&s.max?u.axisMeshes[e]=s:My("Missing axis submesh under mesh with name: "+t+"(VALUE: "+!!s.value+", MIN: "+!!s.min+", MAX:"+!!s.max+")"):My("Missing axis mesh with name: "+t):Xb("Skipping unknown axis at index: "+e);this.calculateRayOriginFromMesh(l),this.setModelVisibility()}Xb("Model load complete.")}function d(p,g){for(var x=0,b=p.children.length;x<b;x++){var E=p.children[x];if(E&&E.name===g)return E}}},calculateRayOriginFromMesh:function(){var n=new Z.Quaternion;return function(e){var t;if(this.rayOrigin.origin.set(0,0,0),this.rayOrigin.direction.set(0,0,-1),this.rayOrigin.createdFromMesh=!0,t=e.getObjectByName(this.mapping.pointingPoseMeshName)){var i=e.parent;i&&(e.parent=null,e.updateMatrixWorld(!0),e.parent=i),t.getWorldPosition(this.rayOrigin.origin),t.getWorldQuaternion(n),this.rayOrigin.direction.applyQuaternion(n),i&&e.updateMatrixWorld(!0)}else Xb("Mesh does not contain pointing origin data, defaulting to none.");this.modelReady()}}(),lerpAxisTransform:function(){var n=new Z.Quaternion;return function(e,t){var i=this.loadedMeshInfo.axisMeshes[e];if(i){var s=i.min,l=i.max,u=i.value,d=.5*t+.5;u.setRotationFromQuaternion(n.copy(s.quaternion).slerp(l.quaternion,d)),u.position.lerpVectors(s.position,l.position,d)}}}(),lerpButtonTransform:function(){var n=new Z.Quaternion;return function(e,t){var i=this.loadedMeshInfo.buttonMeshes[e];if(i){var s=i.unpressed,l=i.pressed,u=i.value;u.setRotationFromQuaternion(n.copy(s.quaternion).slerp(l.quaternion,t)),u.position.lerpVectors(s.position,l.position,t)}}}(),modelReady:function(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function(n){var e=this.mapping.buttons[n.detail.id];e&&(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes&&this.lerpButtonTransform(e,n.detail.state.value),this.el.emit(e+"changed",n.detail.state))},onAxisMoved:function(n){var e=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes)for(var t=0;t<e;t++)this.lerpAxisTransform(t,n.detail.axis[t]||0);gc(this,this.mapping.axes,n)},setModelVisibility:function(n){var e=this.el.getObject3D("mesh");this.controllerPresent&&(n=n!==void 0?n:this.modelVisible,this.modelVisible=n,e&&(e.visible=n))}}),YP=new Z.Quaternion,R_=new Z.Vector3,function(n,e,t){e.position.copy(n.transform.position),e.quaternion.copy(n.transform.orientation),R_.copy(t),YP.copy(n.transform.orientation),R_.applyQuaternion(YP),e.position.sub(R_)});function $o(n,e){this.renderer=n,this.xrHitTestSource=null,n.xr.addEventListener("sessionend",(function(){this.xrHitTestSource=null}).bind(this)),n.xr.addEventListener("sessionstart",(function(){this.sessionStart(e)}).bind(this)),this.renderer.xr.isPresenting&&this.sessionStart(e)}function qP(n){console.warn(n.message),console.warn('Cannot requestHitTestSource Are you missing: webxr="optionalFeatures: hit-test;" from <a-scene>?')}ky.tempFakePose={transform:{orientation:new Z.Quaternion,position:new Z.Vector3}},$o.prototype.previousFrameAnchors=new Set,$o.prototype.anchorToObject3D=new Map,$o.prototype.sessionStart=function(n){this.session=this.renderer.xr.getSession(),"requestHitTestSource"in this.session?n.space?this.session.requestHitTestSource(n).then((function(e){this.xrHitTestSource=e}).bind(this)).catch(qP):n.profile&&this.session.requestHitTestSourceForTransientInput(n).then((function(e){this.xrHitTestSource=e,this.transient=!0}).bind(this)).catch(qP):qP({message:"No requestHitTestSource on the session."})},$o.prototype.anchorFromLastHitTestResult=function(n,e){var t=this.lastHitTest;if(t){var i={object3D:n,offset:e};Array.from(this.anchorToObject3D.entries()).forEach((function(s){var l=s[1].object3D,u=s[0];l===n&&(this.anchorToObject3D.delete(u),u.delete())}).bind(this)),t.createAnchor&&t.createAnchor().then((function(s){this.anchorToObject3D.set(s,i)}).bind(this)).catch(function(s){console.warn(s.message),console.warn('Cannot create anchor, are you missing: webxr="optionalFeatures: anchors;" from <a-scene>?')})}},$o.prototype.doHit=function(n){if(this.renderer.xr.isPresenting){var e,t,i=this.renderer.xr.getReferenceSpace(),s=n.getViewerPose(i);return this.xrHitTestSource&&s?this.transient?(e=n.getHitTestResultsForTransientInput(this.xrHitTestSource)).length>0&&(t=e[0].results).length>0&&(this.lastHitTest=t[0],t[0].getPose(i)):(e=n.getHitTestResults(this.xrHitTestSource)).length>0&&(this.lastHitTest=e[0],e[0].getPose(i)):void 0}},$o.updateAnchorPoses=function(n,e){var t=n.trackedAnchors||$o.prototype.previousFrameAnchors;$o.prototype.previousFrameAnchors.forEach(function(i){t.has(i)||$o.prototype.anchorToObject3D.delete(i)}),t.forEach(function(i){var s,l,u,d;try{if(s=n.getPose(i.anchorSpace,e)){if(!(l=$o.prototype.anchorToObject3D.get(i)))return;u=l.offset,d=l.object3D,ky(s,d,u)}}catch(p){console.error("while updating anchor poses:",p)}}),$o.prototype.previousFrameAnchors=t},In("ar-hit-test",{schema:{target:{type:"selector"},enabled:{default:!0},src:{default:"data:image/webp;base64,UklGRkQHAABXRUJQVlA4WAoAAAAQAAAA/wEA/wEAQUxQSL0DAAARDzD/ERGCjrY9sYYFfgo6aa1kJ7K0w9Lo3AadLSVeFxevQwj5kuM8RfR/Atw/C0+ozB/oUBrloFZs6ElSW88j1KA4yExNWQaqRZquIDF0JYmlq0hAuUDTFu66tng3teW7pa3cQf1V1edvur54M/Slm6Wv3Gx9zw0MXlQLntcsBN6wkHjTQuYtC4W3LTw8mGRVG57TbAROtxHfZNhInGkjc5aNwtk2Hg6Mvki14k+NkZzCwQgCxalcAv3kddRTPI1DcUrXId1FLf1uHpzaQz4tquhZVLlKesbVpqKeTj0n0F5PpXDlFN9UqmhalL/ImuZFo6KmToWLoKlddMprqlS8cKovBvHo2kTiFV2LN4msaxKZl3QNiair8xYRdDWivIvXVXmbcMqJ51UebZuFXxZt6xd4laxtciqRtA3Cv0nU1t+kEUFbI8JvCa+tvkm3FDlO/W+OR99+kWEp/YYo+tYfTVnf/K8cE/F///3vv//993eeL+a+uvjawLcX3xjYvJotBFY3kVjTRGFtE+BU2AiMbiQyhpHMWEYeBozAH5qNBYRDB5KBCaTDBKKBAZTDBoKBDjwHAN5ABeCJBsAZcAAC0YHHxAYSMYBiYgGZWEA2MYFCbCCZGAAIANFEB+AnYgMQTDQAYSJ2AN5EBZAm4gDgTDgAeSIu4DGygTIRN1CMLOCZiACykQlg4jsAycgA8AO+BxCNdJyDkcbwRirDGXGnx8w+FDPrkM3MQ9JQZMYhiiwV/RDMtIM3U1/DmXHUo+IR2kSR2ToWkQ1NIn2qf2J8LCqJKiDUiSADHY3whirhdHgZ94HKaR97PhE+twEUJUFoAcgyTct8hfSxSkShASDKdMJ/ritKHwgyQ0sD4D/miCxU5SbhOOUDTnZpccCjYP/i0bZ/8bAgtVGEoGapWIQXyzKVKLwgNJFk2rtMIgoNRJlOZF7SNSSyUEeQmbxBFKEmtYjEe8S8zOZ1AkJVCmS88FJOtF40Ksg4oUaFiygk3C8qlTVNyl8UTevCUdAE2t14PfVqU1FPp57TopKeQZWromddTQp6QOfTOEQt/ZDuipZ11w/wOiqO8dRORcc6BQEkDQMClaHcn5wV9yLbxsNZNgpn2sicYSNxuo34Js1G4FQbnuNsOPa28PCWhcKbFjJvWEi8ZiHwqgXPcxbc5db33Cx95WboSzddX7yp+vyN0+eul7ZyN7Xlu64t3jVt4c5pc4JLV5EYupJE0xUknC4nOjVlmaYpyLit53HCQ0+ScnqceNcS5dzUkd0/CwMAVlA4IGADAAAQXwCdASoAAgACP8ne6Wy/tjCpqJ/IA/A5CWlu4XYBG/Pz8AfwD8APz//f3v8E1fuHZnxKYACtfuHZnxKYACrYTb5mOslhxu843ecbvON3nG7zjd3a0VCn7G1MABVxwH/Xd25gAK1+4dmfEpe2+PHhQaj75++riG6FuYACtfuHZnxKYACRrK3q9xO8Ss3uWKnMhs/rDF1hi6wxdYYusMXWGI5QRcCFDZog5OgqNlse1NDuz/UoFa/cOzPiUwAEsAOK4/nu5eZHK2tlXxJfNYlMABWv3Dsz4bvNJ5YA/LtxJ38SmAArX7h2Z8Sk5vdZUYv7mZPiUwAFa/cOzPh21s5OgZxf1mfEpemRyFr/rM+JS9noA/LtxJ38SmAAlUJIotzAASn6TjdhK+D3Dsz4dyvB7h2Z8O2tnJ0DOL+sz4lL2nKLT4lL/+iSLOocxq639w7M34MNZdm55uJ8v8ra2cpVZnxKTq2F3PN/cNksAfl24k7+JTAASqrD37h2Z7b1W+VtbOUqsz4lJ1bC7nm/uGyWAPy7cSd/EpgAJVVh79w7M9t6rfK2tnKVWZ8Sk6thdzzf3DZLAH5duJO/iUwAEqqw9+4dme29VvlbWzlKrM+JSdWwu55v7hslgD8u3EnfxKYACVVYe/cOzPbeq3ytrZylVme0kYJ8557FLerqFrzIbPrrf3DZLAH5duJO/iUvaVMS9BoaF4p7pSDFTP1XMyfElelrM0DOL+sz4eBJ13nV1OppBGPuKb4YzXQgq9uH19uS/0+JS9t9fr6ZUlQBelDG6GMgq97otb5QMPJwtKyBTbFp8Sl7b6/X0ykkawEOsgdiE6Fi0vb/Eve6xkwsmug0Z4nGNHQO8839bpTsjpz7SWIJxKagvd1QWMa6FYT1KEw3j4XDT6vJ9Xk+nyfT5Pq8n1eEmk5dinMM/9Fcfz4Z3Dsz3KD2dw7LxBRxKrqUUGQPH/7zxr1KIfNpLEJ0MZB2ITM/0Z2EFoh12NlXnEcpYcbvON3nG7zjd5xu84vfcNIAAP7+y8ceyzbVxkakPYY4lcr72fqOnDwipv+yxC71wAADBrjKnAAAAAAAAAAAAAAw7oNGHttqWONcoFN/2WIDc2pa6WVFtFYROlsaMaTXdcOjXHz93+YxAglKa4AAAAA=",type:"map"},type:{default:"footprint",oneOf:["footprint","map"]},footprintDepth:{default:.1},mapSize:{type:"vec2",default:{x:.5,y:.5}}},sceneOnly:!0,init:function(){this.hitTest=null,this.imageDataArray=new Uint8ClampedArray(1048576),this.imageData=new ImageData(this.imageDataArray,512,512),this.textureCache=new Map,this.orthoCam=new Z.OrthographicCamera,this.orthoCam.layers.set(21),this.textureTarget=new Z.WebGLRenderTarget(512,512,{}),this.basicMaterial=new Z.MeshBasicMaterial({color:0,side:Z.DoubleSide}),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.canvas.width=512,this.canvas.height=512,this.canvasTexture=new Z.CanvasTexture(this.canvas,{alpha:!0}),this.canvasTexture.flipY=!1;var n=this.el.getAttribute("webxr"),e=n.optionalFeatures;e.includes("hit-test")&&e.includes("anchors")||(e.push("hit-test"),e.push("anchors"),this.el.setAttribute("webxr",n)),this.el.sceneEl.renderer.xr.addEventListener("sessionend",(function(){this.hitTest=null}).bind(this)),this.el.sceneEl.addEventListener("enter-vr",(function(){if(this.el.is("ar-mode")){var t=this.el.sceneEl.renderer,i=this.session=t.xr.getSession();this.hasPosedOnce=!1,this.bboxMesh.visible=!1,Hb||(Hb=new Map),i.requestReferenceSpace("viewer").then((function(d){this.viewerHitTest=this.hitTest=new $o(t,{space:d}),this.el.emit("ar-hit-test-start")}).bind(this));var s=this;this.el.sceneEl.addEventListener("controllersupdated",function(){var d=this.xrSession&&this.xrSession.inputSources;if(d){for(var p=0;p<d.length;++p)if(d[p].targetRayMode==="tracked-pointer"){s.hitTest=new $o(t,{space:d[p].targetRaySpace}),Hb.set(d[p],s.hitTest),s.viewerHitTest&&typeof s.viewerHitTest.cancel=="function"&&(s.viewerHitTest.cancel(),s.viewerHitTest=null);break}}});var l="generic-touchscreen",u=new $o(t,{profile:l});i.addEventListener("selectstart",(function(d){if(this.data.enabled===!0){var p=d.inputSource;this.bboxMesh.visible=!0,this.hasPosedOnce===!0&&(this.el.emit("ar-hit-test-select-start",{inputSource:p,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),p.profiles[0]===l?this.hitTest=u:(this.hitTest=Hb.get(p)||new $o(t,{space:p.targetRaySpace}),Hb.set(p,this.hitTest)))}}).bind(this)),i.addEventListener("selectend",(function(d){if(this.hitTest&&this.data.enabled===!0){var p,g=d.inputSource;this.hasPosedOnce===!0&&(this.bboxMesh.visible=!1,this.data.target&&(p=this.data.target.object3D)&&(ky.tempFakePose.transform.position.copy(this.bboxMesh.position),ky.tempFakePose.transform.orientation.copy(this.bboxMesh.quaternion),ky(ky.tempFakePose,p,this.bboxOffset),p.visible=!0,this.hitTest.anchorFromLastHitTestResult(p,this.bboxOffset)),this.el.emit("ar-hit-test-select",{inputSource:g,position:this.bboxMesh.position,orientation:this.bboxMesh.quaternion}),this.hitTest=null)}else this.hitTest=null}).bind(this))}}).bind(this)),this.bboxOffset=new Z.Vector3,this.update=this.update.bind(this),this.makeBBox()},update:function(){this.data.enabled===!1&&(this.hitTest=null,this.bboxMesh.visible=!1),this.data.target&&(this.data.target.object3D?(this.data.target.addEventListener("model-loaded",this.update),this.data.target.object3D.layers.enable(21),this.data.target.object3D.traverse(function(n){n.layers.enable(21)})):this.data.target.addEventListener("loaded",this.update,{once:!0})),this.bboxNeedsUpdate=!0},makeBBox:function(){var n=new Z.PlaneGeometry(1,1),e=new Z.MeshBasicMaterial({transparent:!0,color:16777215});n.rotateX(-Math.PI/2),n.rotateY(-Math.PI/2),this.bbox=new Z.Box3,this.bboxMesh=new Z.Mesh(n,e),this.el.setObject3D("ar-hit-test",this.bboxMesh),this.bboxMesh.visible=!1},updateFootprint:function(){var n,e,t,i=this.el.sceneEl.renderer,s=i.xr.enabled;this.bboxMesh.material.map=this.canvasTexture,this.bboxMesh.material.needsUpdate=!0,this.orthoCam.rotation.set(-Math.PI/2,0,-Math.PI/2),this.orthoCam.position.copy(this.bboxMesh.position),this.orthoCam.position.y-=this.bboxMesh.scale.y/2,this.orthoCam.near=.1,this.orthoCam.far=this.orthoCam.near+this.data.footprintDepth*this.bboxMesh.scale.y,this.orthoCam.position.y+=this.orthoCam.far,this.orthoCam.right=this.bboxMesh.scale.z/2,this.orthoCam.left=-this.bboxMesh.scale.z/2,this.orthoCam.top=this.bboxMesh.scale.x/2,this.orthoCam.bottom=-this.bboxMesh.scale.x/2,this.orthoCam.updateProjectionMatrix(),e=i.getRenderTarget(),i.setRenderTarget(this.textureTarget),i.xr.enabled=!1,t=this.el.object3D.background,this.el.object3D.overrideMaterial=this.basicMaterial,this.el.object3D.background=null,i.render(this.el.object3D,this.orthoCam),this.el.object3D.background=t,this.el.object3D.overrideMaterial=null,i.xr.enabled=s,i.setRenderTarget(e),i.readRenderTargetPixels(this.textureTarget,0,0,512,512,this.imageDataArray),this.context.putImageData(this.imageData,0,0),this.context.shadowColor="white",this.context.shadowBlur=10,this.context.drawImage(this.canvas,0,0),n=this.context.getImageData(0,0,512,512);for(var l=0;l<262144;l++)n.data[4*l+3]!==0&&n.data[4*l+3]!==255&&(n.data[4*l+3]=128);this.context.putImageData(n,0,0),this.canvasTexture.needsUpdate=!0},tick:function(){var n,e,t=this.el.sceneEl.frame,i=this.el.sceneEl.renderer;t&&$o.updateAnchorPoses(t,i.xr.getReferenceSpace()),this.bboxNeedsUpdate&&(this.bboxNeedsUpdate=!1,this.data.target&&this.data.type!=="map"||(this.textureCache.has(this.data.src)?e=this.textureCache.get(this.data.src):(e=new Z.TextureLoader().load(this.data.src),this.textureCache.set(this.data.src,e)),this.bboxMesh.material.map=e,this.bboxMesh.material.needsUpdate=!0),this.data.target&&this.data.target.object3D?(this.bbox.setFromObject(this.data.target.object3D),this.bbox.getCenter(this.bboxMesh.position),this.bbox.getSize(this.bboxMesh.scale),this.data.type==="footprint"&&(this.bboxMesh.scale.x*=1.04,this.bboxMesh.scale.z*=1.04,this.updateFootprint()),this.bboxMesh.position.y-=this.bboxMesh.scale.y/2,this.bboxOffset.copy(this.bboxMesh.position),this.bboxOffset.sub(this.data.target.object3D.position)):this.bboxMesh.scale.set(this.data.mapSize.x,1,this.data.mapSize.y)),this.hitTest&&(n=this.hitTest.doHit(t))&&(this.hasPosedOnce!==!0&&(this.hasPosedOnce=!0,this.el.emit("ar-hit-test-achieved")),this.bboxMesh.visible=!0,this.bboxMesh.position.copy(n.transform.position),this.bboxMesh.quaternion.copy(n.transform.orientation))}}),In("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},sceneOnly:!0,update:function(){var n=this.data,e=this.el.object3D;n.transparent?e.background=null:e.background=new Z.Color(n.color)},remove:function(){this.el.object3D.background=null}}),In("debug",{schema:{default:!0},sceneOnly:!0});var Pj="a-dialog-buttons-container",JP="a-dialog-button";function Nj(n,e){var t,i,s,l;return(t=document.createElement("div")).classList.add("a-modal"),t.setAttribute(vo,""),(i=document.createElement("div")).className="a-dialog",i.setAttribute(vo,""),t.appendChild(i),(s=document.createElement("div")).classList.add("a-dialog-text-container"),i.appendChild(s),(l=document.createElement("div")).classList.add("a-dialog-text"),l.innerHTML=n,s.appendChild(l),i.appendChild(e),t}In("device-orientation-permission-ui",{schema:{enabled:{default:!0},deviceMotionMessage:{default:"This immersive website requires access to your device motion sensors."},httpsMessage:{default:"Access this site over HTTPS to enter VR mode and grant access to the device sensors."},denyButtonText:{default:"Deny"},allowButtonText:{default:"Allow"},cancelButtonText:{default:"Cancel"}},sceneOnly:!0,init:function(){var n=this;this.data.enabled&&(window.isSecureContext||this.showHTTPAlert(),typeof DeviceOrientationEvent<"u"&&DeviceOrientationEvent.requestPermission?(this.onDeviceMotionDialogAllowClicked=this.onDeviceMotionDialogAllowClicked.bind(this),this.onDeviceMotionDialogDenyClicked=this.onDeviceMotionDialogDenyClicked.bind(this),DeviceOrientationEvent.requestPermission().then(function(){n.el.emit("deviceorientationpermissiongranted"),n.permissionGranted=!0}).catch(function(){var e,t,i,s,l,u,d,p;n.devicePermissionDialogEl=(e=n.data.denyButtonText,t=n.data.allowButtonText,i=n.data.deviceMotionMessage,s=n.onDeviceMotionDialogAllowClicked,l=n.onDeviceMotionDialogDenyClicked,(u=document.createElement("div")).classList.add(Pj),(d=document.createElement("button")).classList.add(JP,"a-dialog-deny-button"),d.setAttribute(vo,""),d.innerHTML=e,u.appendChild(d),(p=document.createElement("button")).classList.add(JP,"a-dialog-allow-button"),p.setAttribute(vo,""),p.innerHTML=t,u.appendChild(p),p.addEventListener("click",function(g){g.stopPropagation(),s()}),d.addEventListener("click",function(g){g.stopPropagation(),l()}),Nj(i,u)),n.el.appendChild(n.devicePermissionDialogEl)})):this.permissionGranted=!0)},remove:function(){this.devicePermissionDialogEl&&this.el.removeChild(this.devicePermissionDialogEl)},onDeviceMotionDialogDenyClicked:function(){this.remove()},showHTTPAlert:function(){var n,e,t,i,s,l=this,u=(n=l.data.cancelButtonText,e=l.data.httpsMessage,t=function(){l.el.removeChild(u)},(i=document.createElement("div")).classList.add(Pj),(s=document.createElement("button")).classList.add(JP,"a-dialog-ok-button"),s.setAttribute(vo,""),s.innerHTML=n,i.appendChild(s),s.addEventListener("click",function(d){d.stopPropagation(),t()}),Nj(e,i));this.el.appendChild(u)},onDeviceMotionDialogAllowClicked:function(){var n=this;this.el.emit("deviceorientationpermissionrequested"),DeviceOrientationEvent.requestPermission().then(function(e){e==="granted"?(n.el.emit("deviceorientationpermissiongranted"),n.permissionGranted=!0):n.el.emit("deviceorientationpermissionrejected"),n.remove()}).catch(console.error)}}),In("embedded",{dependencies:["xr-mode-ui"],schema:{default:!0},sceneOnly:!0,update:function(){var n=this.el,e=n.querySelector(".a-enter-vr");this.data===!0?(e&&e.classList.add("embedded"),n.removeFullScreenStyles()):(e&&e.classList.remove("embedded"),n.addFullScreenStyles())}});var fJe="https://unpkg.com/aframe-inspector@"+function(){var n=Yse.split(".");return n[2]="x",n.join(".")}()+"/dist/aframe-inspector.min.js";In("inspector",{schema:{url:{default:fJe}},sceneOnly:!0,init:function(){this.firstPlay=!0,this.onKeydown=this.onKeydown.bind(this),this.onMessage=this.onMessage.bind(this),this.initOverlay(),window.addEventListener("keydown",this.onKeydown),window.addEventListener("message",this.onMessage)},play:function(){var n;this.firstPlay&&(n=F1("inspector"))!=="false"&&n&&(this.openInspector(),this.firstPlay=!1)},initOverlay:function(){this.loadingMessageEl=document.createElement("div"),this.loadingMessageEl.classList.add("a-inspector-loader"),this.loadingMessageEl.innerHTML='Loading Inspector<span class="dots"><span>.</span><span>.</span><span>.</span></span>'},remove:function(){this.removeEventListeners()},onKeydown:function(n){n.keyCode===73&&(n.ctrlKey&&n.altKey||n.getModifierState("AltGraph"))&&this.openInspector()},showLoader:function(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function(){document.body.removeChild(this.loadingMessageEl)},onMessage:function(n){n.data==="INJECT_AFRAME_INSPECTOR"&&this.openInspector()},openInspector:function(n){var e,t=this;AFRAME.INSPECTOR||AFRAME.inspectorInjected?AFRAME.INSPECTOR.open(n):(this.showLoader(),(e=document.createElement("script")).src=this.data.url,e.setAttribute("data-name","aframe-inspector"),e.setAttribute(vo,""),e.onload=function(){AFRAME.INSPECTOR.open(n),t.hideLoader(),t.removeEventListeners()},e.onerror=function(){t.loadingMessageEl.innerHTML="Error loading Inspector"},document.head.appendChild(e),AFRAME.inspectorInjected=!0)},removeEventListeners:function(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("message",this.onMessage)}}),In("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},sceneOnly:!0,update:function(){var n=this.data,e=this.el,t=this.el.object3D.fog;t&&n.type===t.name?Object.keys(this.schema).forEach(function(i){var s=n[i];i==="color"&&(s=new Z.Color(s)),t[i]=s}):e.object3D.fog=function(i){var s;return(s=i.type==="exponential"?new Z.FogExp2(i.color,i.density):new Z.Fog(i.color,i.near,i.far)).name=i.type,s}(n)},remove:function(){var n=this.el;this.el.object3D.fog&&(n.object3D.fog=null)}}),In("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},sceneOnly:!0,init:function(){this.onKeyup=this.onKeyup.bind(this)},play:function(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function(n){var e=this.el;uU(n)&&(this.data.enterVR&&n.keyCode===70&&e.enterVR(),this.data.exitVR&&n.keyCode===27&&e.exitVR())}});var $b=Ki("components:pool:warn");In("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},sceneOnly:!0,multiple:!0,initPool:function(){var n;for(this.availableEls=[],this.usedEls=[],this.data.mixin||$b("No mixin provided for pool component."),this.data.container&&(this.container=document.querySelector(this.data.container),this.container||$b("Container "+this.data.container+" not found.")),this.container=this.container||this.el,n=0;n<this.data.size;++n)this.createEntity()},update:function(n){var e=this.data;n.mixin===e.mixin&&n.size===e.size||this.initPool()},createEntity:function(){var n;(n=document.createElement("a-entity")).play=this.wrapPlay(n.play),n.setAttribute("mixin",this.data.mixin),n.object3D.visible=!1,n.pause(),this.container.appendChild(n),this.availableEls.push(n);var e=this.usedEls;n.addEventListener("loaded",function(){e.indexOf(n)===-1&&(n.object3DParent=n.object3D.parent,n.object3D.parent.remove(n.object3D))})},wrapPlay:function(n){var e=this.usedEls;return function(){e.indexOf(this)!==-1&&n.call(this)}},requestEntity:function(){var n;if(this.availableEls.length===0){if(this.data.dynamic===!1)return void $b("Requested entity from empty pool: "+this.attrName);$b("Requested entity from empty pool. This pool is dynamic and will resize automatically. You might want to increase its initial size: "+this.attrName),this.createEntity()}return n=this.availableEls.shift(),this.usedEls.push(n),n.object3DParent&&(n.object3DParent.add(n.object3D),this.updateRaycasters()),n.object3D.visible=!0,n},returnEntity:function(n){var e=this.usedEls.indexOf(n);if(e!==-1)return this.usedEls.splice(e,1),this.availableEls.push(n),n.object3DParent=n.object3D.parent,n.object3D.parent.remove(n.object3D),this.updateRaycasters(),n.object3D.visible=!1,n.pause(),n;$b("The returned entity was not previously pooled from "+this.attrName)},updateRaycasters:function(){document.querySelectorAll("[raycaster]").forEach(function(n){n.components.raycaster.setDirty()})}}),In("real-world-meshing",{schema:{filterLabels:{type:"array"},meshesEnabled:{default:!0},meshMixin:{default:!0},planesEnabled:{default:!0},planeMixin:{default:""}},sceneOnly:!0,init:function(){var n=this.el.getAttribute("webxr"),e=n.requiredFeatures;e.indexOf("mesh-detection")===-1&&(e.push("mesh-detection"),this.el.setAttribute("webxr",n)),e.indexOf("plane-detection")===-1&&(e.push("plane-detection"),this.el.setAttribute("webxr",n)),this.meshEntities=[],this.initWorldMeshEntity=this.initWorldMeshEntity.bind(this)},tick:function(){this.el.is("ar-mode")&&(this.detectMeshes(),this.updateMeshes())},detectMeshes:function(){var n,e,t,i=this.data,s=this.el,l=this.meshEntities,u=!1,d=[],p=this.data.filterLabels;n=(t=s.frame).detectedMeshes,e=t.detectedPlanes;for(var g=0;g<l.length;g++)l[g].present=!1;if(i.meshesEnabled){for(var x of n.values())if(!p.length||p.indexOf(x.semanticLabel)!==-1){for(g=0;g<l.length;g++)if(x===l[g].mesh){u=!0,l[g].present=!0,l[g].lastChangedTime<x.lastChangedTime&&this.updateMeshGeometry(l[g].el,x),l[g].lastChangedTime=x.lastChangedTime;break}u||d.push(x),u=!1}}if(i.planesEnabled){for(x of e.values())if(!p.length||p.indexOf(x.semanticLabel)!==-1){for(g=0;g<l.length;g++)if(x===l[g].mesh){u=!0,l[g].present=!0,l[g].lastChangedTime<x.lastChangedTime&&this.updateMeshGeometry(l[g].el,x),l[g].lastChangedTime=x.lastChangedTime;break}u||d.push(x),u=!1}}this.deleteMeshes(),this.createNewMeshes(d)},updateMeshes:function(){var n=new Z.Matrix4;return function(){for(var e,t,i,s=this.el,l=s.frame,u=this.meshEntities,d=s.renderer.xr.getReferenceSpace(),p=0;p<u.length;p++)i=u[p].mesh.meshSpace||u[p].mesh.planeSpace,e=l.getPose(i,d),(t=u[p].el).hasLoaded&&(n.fromArray(e.transform.matrix),n.decompose(t.object3D.position,t.object3D.quaternion,t.object3D.scale))}}(),deleteMeshes:function(){for(var n=this.meshEntities,e=[],t=0;t<n.length;t++)n[t].present?e.push(n[t]):this.el.removeChild(n[t]);this.meshEntities=e},createNewMeshes:function(n){for(var e,t=0;t<n.length;t++)e=document.createElement("a-entity"),this.meshEntities.push({mesh:n[t],el:e}),e.addEventListener("loaded",this.initWorldMeshEntity),this.el.appendChild(e)},initMeshGeometry:function(n){var e,t,i;if(n instanceof XRPlane){t=new Z.Shape,i=n.polygon;for(var s=0;s<i.length;++s)s===0?t.moveTo(i[s].x,i[s].z):t.lineTo(i[s].x,i[s].z);return(e=new Z.ShapeGeometry(t)).rotateX(Math.PI/2),e}return(e=new Z.BufferGeometry).setAttribute("position",new Z.BufferAttribute(n.vertices,3)),e.setIndex(new Z.BufferAttribute(n.indices,1)),e},initWorldMeshEntity:function(n){for(var e,t,i,s=n.target,l=this.meshEntities,u=0;u<l.length;u++)if(l[u].el===s){i=l[u];break}e=this.initMeshGeometry(i.mesh),t=new Z.Mesh(e,new Z.MeshBasicMaterial({color:16777215*Math.random(),side:Z.DoubleSide})),s.setObject3D("mesh",t),i.mesh instanceof XRPlane&&this.data.planeMixin?s.setAttribute("mixin",this.data.planeMixin):this.data.meshMixin&&s.setAttribute("mixin",this.data.meshMixin),s.setAttribute("data-world-mesh",i.mesh.semanticLabel)},updateMeshGeometry:function(n,e){var t=n.getObject3D("mesh");t.geometry.dispose(),t.geometry=this.initMeshGeometry(e)}}),In("reflection",{schema:{directionalLight:{type:"selector"}},sceneOnly:!0,init:function(){var n=this;this.cubeRenderTarget=new Z.WebGLCubeRenderTarget(16),this.cubeCamera=new Z.CubeCamera(.1,1e3,this.cubeRenderTarget),this.lightingEstimationTexture=new Z.WebGLCubeRenderTarget(16).texture,this.needsVREnvironmentUpdate=!0;var e=this.el.getAttribute("webxr"),t=e.optionalFeatures;t.includes("light-estimation")||(t.push("light-estimation"),this.el.setAttribute("webxr",e)),this.el.addEventListener("enter-vr",function(){n.el.is("ar-mode")&&n.el.renderer.xr.getSession().requestLightProbe&&n.startLightProbe()}),this.el.addEventListener("exit-vr",function(){n.xrLightProbe&&n.stopLightProbe()}),this.el.object3D.environment=this.cubeRenderTarget.texture},stopLightProbe:function(){this.xrLightProbe=null,this.probeLight&&(this.probeLight.components.light.light.intensity=0),this.needsVREnvironmentUpdate=!0,this.el.object3D.environment=this.cubeRenderTarget.texture},startLightProbe:function(){this.needsLightProbeUpdate=!0},setupLightProbe:function(){var n=this.el.renderer,e=n.xr.getSession(),t=this,i=n.getContext();if(!this.probeLight){var s=document.createElement("a-light");s.setAttribute("type","probe"),s.setAttribute("intensity",0),this.el.appendChild(s),this.probeLight=s}switch(e.preferredReflectionFormat){case"srgba8":i.getExtension("EXT_sRGB");break;case"rgba16f":i.getExtension("OES_texture_half_float")}this.glBinding=new XRWebGLBinding(e,i),i.getExtension("EXT_sRGB"),i.getExtension("OES_texture_half_float"),e.requestLightProbe().then(function(l){t.xrLightProbe=l,l.addEventListener("reflectionchange",t.updateXRCubeMap.bind(t))}).catch(function(l){console.warn("Lighting estimation not supported: "+l.message),console.warn('Are you missing: webxr="optionalFeatures: light-estimation;" from <a-scene>?')})},updateXRCubeMap:function(){var n=this.el.renderer,e=this.glBinding.getReflectionCubeMap(this.xrLightProbe);e&&(n.properties.get(this.lightingEstimationTexture).__webglTexture=e,this.lightingEstimationTexture.needsPMREMUpdate=!0,this.el.object3D.environment=this.lightingEstimationTexture)},tick:function(){var n=this.el.object3D,e=this.el.renderer,t=this.el.frame;if(t&&this.xrLightProbe){var i=t.getLightEstimate(this.xrLightProbe);i&&function(s,l,u,d){var p=Math.max(s.primaryLightIntensity.x,Math.max(s.primaryLightIntensity.y,s.primaryLightIntensity.z));l.sh.fromArray(s.sphericalHarmonicsCoefficients),l.intensity=3.14,u&&(u.color.setRGB(s.primaryLightIntensity.x/p,s.primaryLightIntensity.y/p,s.primaryLightIntensity.z/p),u.intensity=p,d.copy(s.primaryLightDirection))}(i,this.probeLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.components.light.light,this.data.directionalLight&&this.data.directionalLight.object3D.position)}this.needsVREnvironmentUpdate&&(n.environment=null,this.needsVREnvironmentUpdate=!1,this.cubeCamera.position.set(0,1.6,0),this.cubeCamera.update(e,n),n.environment=this.cubeRenderTarget.texture),this.needsLightProbeUpdate&&t&&(this.setupLightProbe(),this.needsLightProbeUpdate=!1)},remove:function(){this.el.object3D.environment=null,this.probeLight&&this.el.removeChild(this.probeLight)}});var pJe=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),mJe=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join(`
`),gJe=(In("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},sceneOnly:!0,setup:function(){var n=this.el;if(!this.canvas){var e=n.renderer.getContext();e&&(this.cubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.material=new Z.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:pJe,fragmentShader:mJe,side:Z.DoubleSide}),this.quad=new Z.Mesh(new Z.PlaneGeometry(1,1),this.material),this.quad.visible=!1,this.camera=new Z.OrthographicCamera(-.5,.5,.5,-.5,-1e4,1e4),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),n.object3D.add(this.quad),this.onKeyDown=this.onKeyDown.bind(this))}},getRenderTarget:function(n,e){return new Z.WebGLRenderTarget(n,e,{colorSpace:this.el.sceneEl.renderer.outputColorSpace,minFilter:Z.LinearFilter,magFilter:Z.LinearFilter,wrapS:Z.ClampToEdgeWrapping,wrapT:Z.ClampToEdgeWrapping,format:Z.RGBAFormat,type:Z.UnsignedByteType})},resize:function(n,e){this.quad.scale.set(n,e,1),this.camera.left=-1*n/2,this.camera.right=n/2,this.camera.top=e/2,this.camera.bottom=-1*e/2,this.camera.updateProjectionMatrix(),this.canvas.width=n,this.canvas.height=e},play:function(){window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(n){var e=n.keyCode===83&&n.ctrlKey&&n.altKey;if(this.data&&e){var t=n.shiftKey?"equirectangular":"perspective";this.capture(t)}},setCapture:function(n){var e,t,i,s,l=this.el;return n==="perspective"?(this.quad.visible=!1,t=this.data.camera&&this.data.camera.components.camera.camera||l.camera,e={width:this.data.width,height:this.data.height}):(t=this.camera,s=new Z.WebGLCubeRenderTarget(Math.min(this.cubeMapSize,2048),{format:Z.RGBFormat,generateMipmaps:!0,minFilter:Z.LinearMipmapLinearFilter,colorSpace:Z.SRGBColorSpace}),i=new Z.CubeCamera(l.camera.near,l.camera.far,s),l.camera.getWorldPosition(i.position),l.camera.getWorldQuaternion(i.quaternion),i.update(l.renderer,l.object3D),this.quad.material.uniforms.map.value=i.renderTarget.texture,e={width:this.data.width,height:this.data.height},this.quad.visible=!0),{camera:t,size:e,projection:n}},capture:function(n){var e,t=this.el.renderer.xr.enabled,i=this.el.renderer;this.setup(),i.xr.enabled=!1,e=this.setCapture(n),this.renderCapture(e.camera,e.size,e.projection),this.saveCapture(),i.xr.enabled=t},getCanvas:function(n){var e=this.el.renderer.xr.enabled,t=this.el.renderer;this.setup();var i=this.setCapture(n);return t.xr.enabled=!1,this.renderCapture(i.camera,i.size,i.projection),t.xr.enabled=e,this.canvas},renderCapture:function(n,e,t){var i,s,l,u=this.el.renderer.autoClear,d=this.el,p=d.renderer;s=this.getRenderTarget(e.width,e.height),l=new Uint8Array(4*e.width*e.height),this.resize(e.width,e.height),p.autoClear=!0,p.clear(),p.setRenderTarget(s),p.render(d.object3D,n),p.autoClear=u,p.readRenderTargetPixels(s,0,0,e.width,e.height,l),p.setRenderTarget(null),t==="perspective"&&(l=this.flipPixelsVertically(l,e.width,e.height)),i=new ImageData(new Uint8ClampedArray(l),e.width,e.height),this.quad.visible=!1,this.ctx.putImageData(i,0,0)},flipPixelsVertically:function(n,e,t){for(var i=n.slice(0),s=0;s<e;++s)for(var l=0;l<t;++l)i[4*s+l*e*4]=n[4*s+(t-l)*e*4],i[4*s+1+l*e*4]=n[4*s+1+(t-l)*e*4],i[4*s+2+l*e*4]=n[4*s+2+(t-l)*e*4],i[4*s+3+l*e*4]=n[4*s+3+(t-l)*e*4];return i},saveCapture:function(){this.canvas.toBlob(function(n){var e="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",t=document.createElement("a"),i=URL.createObjectURL(n);t.href=i,t.setAttribute("download",e),t.innerHTML="downloading...",t.style.display="none",document.body.appendChild(t),setTimeout(function(){t.click(),document.body.removeChild(t)},1)},"image/png")}}),Pn(282)),yJe=Pn.n(gJe),AJe=(Pn(3729),Pn(8132),window.aframeStats),Dj="a-hidden",vJe=window.threeStats;In("stats",{schema:{default:!0},sceneOnly:!0,init:function(){var n=this.el;F1("stats")!=="false"&&(this.stats=function(e){var t=new vJe(e.renderer),i=new AJe(e),s=e.isMobile?[]:[t,i];return new(yJe())({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:s})}(n),this.statsEl=document.querySelector(".rs-base"),this.hideBound=this.hide.bind(this),this.showBound=this.show.bind(this),n.addEventListener("enter-vr",this.hideBound),n.addEventListener("exit-vr",this.showBound))},update:function(){if(this.stats)return this.data?this.show():this.hide()},remove:function(){this.el.removeEventListener("enter-vr",this.hideBound),this.el.removeEventListener("exit-vr",this.showBound),this.statsEl&&this.statsEl.parentNode.removeChild(this.statsEl)},tick:function(){var n=this.stats;n&&(n("rAF").tick(),n("FPS").frame(),n().update())},hide:function(){this.statsEl.classList.add(Dj)},show:function(){this.statsEl.classList.remove(Dj)}});var ug="a-hidden";function Fj(n){n.addEventListener("touchstart",function(){n.classList.remove("resethover")},{passive:!0}),n.addEventListener("touchend",function(){n.classList.add("resethover")},{passive:!0})}In("xr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0},enterVRButton:{default:""},enterVREnabled:{default:!0},enterARButton:{default:""},enterAREnabled:{default:!0},XRMode:{default:"vr",oneOf:["vr","ar","xr"]}},sceneOnly:!0,init:function(){var n=this,e=this.el;F1("ui")!=="false"&&(this.insideLoader=!1,this.enterVREl=null,this.enterAREl=null,this.orientationModalEl=null,this.bindMethods(),e.addEventListener("enter-vr",this.updateEnterInterfaces),e.addEventListener("exit-vr",this.updateEnterInterfaces),e.addEventListener("update-vr-devices",this.updateEnterInterfaces),window.addEventListener("message",function(t){t.data.type==="loaderReady"&&(n.insideLoader=!0,n.remove())}),window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded))},bindMethods:function(){this.onEnterVRButtonClick=this.onEnterVRButtonClick.bind(this),this.onEnterARButtonClick=this.onEnterARButtonClick.bind(this),this.onModalClick=this.onModalClick.bind(this),this.toggleOrientationModalIfNeeded=this.toggleOrientationModalIfNeeded.bind(this),this.updateEnterInterfaces=this.updateEnterInterfaces.bind(this)},onModalClick:function(){this.el.exitVR()},onEnterVRButtonClick:function(){this.el.enterVR()},onEnterARButtonClick:function(){this.el.enterAR()},update:function(){var n,e,t,i=this.data,s=this.el;if(!i.enabled||this.insideLoader||F1("ui")==="false")return this.remove();this.enterVREl||this.enterAREl||this.orientationModalEl||(this.enterVREl||!i.enterVREnabled||i.XRMode!=="xr"&&i.XRMode!=="vr"||(i.enterVRButton?(this.enterVREl=document.querySelector(i.enterVRButton),this.enterVREl.addEventListener("click",this.onEnterVRButtonClick)):(this.enterVREl=(n=this.onEnterVRButtonClick,(t=document.createElement("div")).classList.add("a-enter-vr"),t.setAttribute(vo,""),(e=document.createElement("button")).className="a-enter-vr-button",e.setAttribute("title","Enter VR mode with a headset or fullscreen without"),e.setAttribute(vo,""),Xp()&&Fj(e),t.appendChild(e),e.addEventListener("click",function(l){n(),l.stopPropagation()}),t),s.appendChild(this.enterVREl))),this.enterAREl||!i.enterAREnabled||i.XRMode!=="xr"&&i.XRMode!=="ar"||(i.enterARButton?(this.enterAREl=document.querySelector(i.enterARButton),this.enterAREl.addEventListener("click",this.onEnterARButtonClick)):(this.enterAREl=function(l,u){var d,p;return(p=document.createElement("div")).classList.add("a-enter-ar"),u&&p.classList.add("xr"),p.setAttribute(vo,""),(d=document.createElement("button")).className="a-enter-ar-button",d.setAttribute("title","Enter AR mode with a headset or handheld device."),d.setAttribute(vo,""),Xp()&&Fj(d),p.appendChild(d),d.addEventListener("click",function(g){l(),g.stopPropagation()}),p}(this.onEnterARButtonClick,i.XRMode==="xr"),s.appendChild(this.enterAREl))),this.orientationModalEl=function(l){var u=document.createElement("div");u.className="a-orientation-modal",u.classList.add(ug),u.setAttribute(vo,"");var d=document.createElement("button");return d.setAttribute(vo,""),d.innerHTML="Exit VR",d.addEventListener("click",l),u.appendChild(d),u}(this.onModalClick),s.appendChild(this.orientationModalEl),this.updateEnterInterfaces())},remove:function(){[this.enterVREl,this.enterAREl,this.orientationModalEl].forEach(function(n){n&&n.parentNode&&n.parentNode.removeChild(n)}),this.enterVREl=void 0,this.enterAREl=void 0,this.orientationModalEl=void 0},updateEnterInterfaces:function(){this.toggleEnterVRButtonIfNeeded(),this.toggleEnterARButtonIfNeeded(),this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function(){var n=this.el;this.enterVREl&&(n.is("vr-mode")||(n.isMobile||ZV())&&!S3()?this.enterVREl.classList.add(ug):(S3()||this.enterVREl.classList.add("fullscreen"),this.enterVREl.classList.remove(ug),n.enterVR(!1,!0)))},toggleEnterARButtonIfNeeded:function(){var n=this.el;this.enterAREl&&(n.is("vr-mode")||!KV()?this.enterAREl.classList.add(ug):(this.enterAREl.classList.remove(ug),n.enterVR(!0,!0)))},toggleOrientationModalIfNeeded:function(){var n=this.el,e=this.orientationModalEl;e&&n.isMobile&&(!Ise()&&n.is("vr-mode")?e.classList.remove(ug):e.classList.add(ug))}}),_a("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function(n){this.geometry=new Z.BoxGeometry(n.width,n.height,n.depth,n.segmentsWidth,n.segmentsHeight,n.segmentsDepth)}});var Oj=Z.MathUtils.degToRad;_a("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(n){this.geometry=new Z.CircleGeometry(n.radius,n.segments,Oj(n.thetaStart),Oj(n.thetaLength))}});var Vj=Z.MathUtils.degToRad;_a("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(n){this.geometry=new Z.CylinderGeometry(n.radiusTop,n.radiusBottom,n.height,n.segmentsRadial,n.segmentsHeight,n.openEnded,Vj(n.thetaStart),Vj(n.thetaLength))}});var Uj=Z.MathUtils.degToRad;_a("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(n){this.geometry=new Z.CylinderGeometry(n.radius,n.radius,n.height,n.segmentsRadial,n.segmentsHeight,n.openEnded,Uj(n.thetaStart),Uj(n.thetaLength))}}),_a("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(n){this.geometry=new Z.DodecahedronGeometry(n.radius,n.detail)}}),_a("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(n){this.geometry=new Z.IcosahedronGeometry(n.radius,n.detail)}}),_a("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(n){this.geometry=new Z.OctahedronGeometry(n.radius,n.detail)}}),_a("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function(n){this.geometry=new Z.PlaneGeometry(n.width,n.height,n.segmentsWidth,n.segmentsHeight)}});var zj=Z.MathUtils.degToRad;_a("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function(n){this.geometry=new Z.RingGeometry(n.radiusInner,n.radiusOuter,n.segmentsTheta,n.segmentsPhi,zj(n.thetaStart),zj(n.thetaLength))}});var L_=Z.MathUtils.degToRad;_a("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function(n){this.geometry=new Z.SphereGeometry(n.radius,n.segmentsWidth,n.segmentsHeight,L_(n.phiStart),L_(n.phiLength),L_(n.thetaStart),L_(n.thetaLength))}}),_a("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function(n){this.geometry=new Z.TetrahedronGeometry(n.radius,n.detail)}});var bJe=Z.MathUtils.degToRad;_a("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function(n){this.geometry=new Z.TorusGeometry(n.radius,2*n.radiusTubular,n.segmentsRadial,n.segmentsTubular,bJe(n.arc))}}),_a("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function(n){this.geometry=new Z.TorusKnotGeometry(n.radius,2*n.radiusTubular,n.segmentsTubular,n.segmentsRadial,n.p,n.q)}});var B_=new Z.Quaternion,xJe=new Z.Vector3(0,0,1),Qb=new Z.Vector2,Gj=new Z.Vector2,P_=new Z.Vector2;function Wj(n,e){return e.color.set(n.color),e.fog=n.fog,e.wireframe=n.wireframe,e.toneMapped=n.toneMapped,e.wireframeLinewidth=n.wireframeLinewidth,e}function Hj(n,e){return e.color.set(n.color),e.emissive.set(n.emissive),e.emissiveIntensity=n.emissiveIntensity,e.fog=n.fog,e.metalness=n.metalness,e.roughness=n.roughness,e.wireframe=n.wireframe,e.wireframeLinewidth=n.wireframeLinewidth,n.normalMap&&(e.normalScale=n.normalScale),n.ambientOcclusionMap&&(e.aoMapIntensity=n.ambientOcclusionMapIntensity),n.displacementMap&&(e.displacementScale=n.displacementScale,e.displacementBias=n.displacementBias),e}function Xj(n,e){switch(e.color.set(n.color),e.specular.set(n.specular),e.emissive.set(n.emissive),e.emissiveIntensity=n.emissiveIntensity,e.fog=n.fog,e.transparent=n.transparent,e.wireframe=n.wireframe,e.wireframeLinewidth=n.wireframeLinewidth,e.shininess=n.shininess,e.flatShading=n.flatShading,e.wireframe=n.wireframe,e.wireframeLinewidth=n.wireframeLinewidth,e.reflectivity=n.reflectivity,e.refractionRatio=n.refractionRatio,n.combine){case"mix":e.combine=Z.MixOperation;break;case"multiply":e.combine=Z.MultiplyOperation;break;case"add":e.combine=Z.AddOperation}return n.normalMap&&(e.normalScale=n.normalScale),n.ambientOcclusionMap&&(e.aoMapIntensity=n.ambientOcclusionMapIntensity),n.bumpMap&&(e.bumpScale=n.bumpMapScale),n.displacementMap&&(e.displacementScale=n.displacementScale,e.displacementBias=n.displacementBias),e}_a("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function(n){var e,t,i,s,l,u,d,p,g;(i=new Z.Triangle).a.set(n.vertexA.x,n.vertexA.y,n.vertexA.z),i.b.set(n.vertexB.x,n.vertexB.y,n.vertexB.z),i.c.set(n.vertexC.x,n.vertexC.y,n.vertexC.z),t=i.getNormal(new Z.Vector3),B_.setFromUnitVectors(t,xJe),s=i.a.clone().applyQuaternion(B_),l=i.b.clone().applyQuaternion(B_),u=i.c.clone().applyQuaternion(B_),Qb.set(Math.min(s.x,l.x,u.x),Math.min(s.y,l.y,u.y)),Gj.set(Math.max(s.x,l.x,u.x),Math.max(s.y,l.y,u.y)),P_.set(0,0).subVectors(Gj,Qb),s=new Z.Vector2().subVectors(s,Qb).divide(P_),l=new Z.Vector2().subVectors(l,Qb).divide(P_),u=new Z.Vector2().subVectors(u,Qb).divide(P_),e=this.geometry=new Z.BufferGeometry,d=[i.a.x,i.a.y,i.a.z,i.b.x,i.b.y,i.b.z,i.c.x,i.c.y,i.c.z],p=[t.x,t.y,t.z,t.x,t.y,t.z,t.x,t.y,t.z],g=[s.x,s.y,l.x,l.y,u.x,u.y],e.setAttribute("position",new Z.Float32BufferAttribute(d,3)),e.setAttribute("normal",new Z.Float32BufferAttribute(p,3)),e.setAttribute("uv",new Z.Float32BufferAttribute(g,2))}}),qf("flat",{schema:{color:{type:"color"},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2},toneMapped:{default:!0}},init:function(n){this.materialData={color:new Z.Color},Wj(n,this.materialData),this.material=new Z.MeshBasicMaterial(this.materialData)},update:function(n){this.updateMaterial(n),AI(this,n)},updateMaterial:function(n){var e;for(e in Wj(n,this.materialData),this.materialData)this.material[e]=this.materialData[e]}}),qf("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function(n){this.materialData={color:new Z.Color,emissive:new Z.Color},Hj(n,this.materialData),this.material=new Z.MeshStandardMaterial(this.materialData)},update:function(n){this.updateMaterial(n),AI(this,n),Zu("normal",this,n),Zu("displacement",this,n),Zu("ambientOcclusion",this,n),Zu("metalness",this,n),Zu("roughness",this,n),M3(this,n)},updateMaterial:function(n){var e,t=this.material;for(e in Hj(n,this.materialData),this.materialData)t[e]=this.materialData[e]}}),qf("phong",{schema:{color:{type:"color"},emissive:{type:"color",default:"black"},emissiveIntensity:{default:1},specular:{type:"color",default:"#111111"},transparent:{default:!1},fog:{default:!0},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},envMap:{default:""},sphericalEnvMap:{type:"map"},shininess:{default:30},flatShading:{default:!1},wireframe:{default:!1},wireframeLinewidth:{default:2},combine:{oneOF:["multiply","mix","add"],default:"mix"},reflectivity:{default:.9},refractionRatio:{default:.98},refract:{default:!1},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},bumpMap:{type:"map"},bumpMapScale:{default:1},bumpTextureOffset:{type:"vec2"},bumpTextureRepeat:{type:"vec2",default:{x:1,y:1}}},init:function(n){this.materialData={color:new Z.Color,specular:new Z.Color,emissive:new Z.Color},Xj(n,this.materialData),this.material=new Z.MeshPhongMaterial(this.materialData);var e=this.el.sceneEl;Object.defineProperty(this.material,"envMap",{get:function(){return this._envMap||e.object3D.environment},set:function(t){this._envMap=t}})},update:function(n){this.updateMaterial(n),AI(this,n),Zu("normal",this,n),Zu("displacement",this,n),Zu("ambientOcclusion",this,n),Zu("bump",this,n),M3(this,n)},updateMaterial:function(n){var e;for(e in Xj(n,this.materialData),this.materialData)this.material[e]=this.materialData[e]}}),qf("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec2 uv = vUV;","  vec4 texColor = texture(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture(map, box.xy).a, width)","      + contour(texture(map, box.zw).a, width)","      + contour(texture(map, box.xw).a, width)","      + contour(texture(map, box.zy).a, width)","    )) / 3.0;","  }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color, opacity * alpha);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`),init:function(){return this.uniforms=this.initUniforms(),Z.UniformsUtils&&(this.uniforms=Z.UniformsUtils.merge([Z.UniformsLib.fog,this.uniforms])),this.material=new Z.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),qf("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["#include <common>","#include <fog_pars_vertex>","#include <logdepthbuf_pars_vertex>","out vec2 vUV;","void main(void) {","  vUV = uv;","  #include <begin_vertex>","  #include <project_vertex>","  #include <logdepthbuf_vertex>","  #include <fog_vertex>","}"].join(`
`),fragmentShader:["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","uniform bool negate;","uniform float alphaTest;","uniform float opacity;","uniform sampler2D map;","uniform vec3 color;","in vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","void main() {","  vec3 sampleColor = texture(map, vUV).rgb;","  if (negate) { sampleColor = 1.0 - sampleColor; }","  float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;","  float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  // Do modified alpha test.","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  // Do modified alpha test.","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","  #include <logdepthbuf_fragment>","  #include <tonemapping_fragment>","  #include <colorspace_fragment>","  #include <fog_fragment>","}"].join(`
`),init:function(){return this.uniforms=this.initUniforms(),Z.UniformsUtils&&(this.uniforms=Z.UniformsUtils.merge([Z.UniformsLib.fog,this.uniforms])),this.material=new Z.ShaderMaterial({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader,fog:!0}),this.material}}),qf("shadow",{schema:{opacity:{default:.5},transparent:{default:!0},alphaToCoverage:{default:!0}},init:function(n){this.material=new Z.ShadowMaterial},update:function(n){this.material.opacity=n.opacity,this.material.alphaToCoverage=n.alphaToCoverage,this.material.transparent=n.transparent}});var $j="data-aframe-default-camera";function Qj(n){var e=n.primitive,t=$p[e]&&$p[e].Geometry,i=new t;if(!t)throw new Error("Unknown geometry `"+e+"`");return i.init(n),i.geometry}fc("camera",{init:function(){this.activeCameraEl=null,this.render=this.render.bind(this),this.unwrapRender=this.unwrapRender.bind(this),this.wrapRender=this.wrapRender.bind(this),this.initialCameraFound=!1,this.numUserCameras=0,this.numUserCamerasChecked=0,this.setupInitialCamera()},setupInitialCamera:function(){var n,e,t=this.sceneEl,i=this;if(!t.camera||t.camera.el.getAttribute("camera").spectator)if((n=t.querySelectorAll("a-camera, :not(a-mixin)[camera]")).length)for(this.numUserCameras=n.length,e=0;e<n.length;e++)n[e].addEventListener("object3dset",function(s){s.detail.type==="camera"&&i.checkUserCamera(this)}),n[e].isANode?n[e].load():n[e].addEventListener("nodeready",function(){this.load()});else this.createDefaultCamera();else t.emit("cameraready",{cameraEl:t.camera.el})},checkUserCamera:function(n){var e,t=this.el.sceneEl;this.numUserCamerasChecked++,this.initialCameraFound||((e=n.getAttribute("camera")).active&&!e.spectator?(this.initialCameraFound=!0,t.camera=n.getObject3D("camera"),t.emit("cameraready",{cameraEl:n})):this.numUserCamerasChecked===this.numUserCameras&&this.createDefaultCamera())},createDefaultCamera:function(){var n,e=this.sceneEl;(n=document.createElement("a-entity")).setAttribute("camera",{active:!0}),n.setAttribute("position",{x:0,y:1.6,z:0}),n.setAttribute("wasd-controls",""),n.setAttribute("look-controls",""),n.setAttribute(vo,""),n.addEventListener("object3dset",function(t){t.detail.type==="camera"&&(e.camera=t.detail.object,e.emit("cameraready",{cameraEl:n}))}),e.appendChild(n)},disableActiveCamera:function(){var n;(n=this.sceneEl.querySelectorAll(":not(a-mixin)[camera]"))[n.length-1].setAttribute("camera","active",!0)},setActiveCamera:function(n){var e,t,i,s,l=this.activeCameraEl,u=this.sceneEl;if((s=n.getObject3D("camera"))&&n!==this.activeCameraEl){var d=u.querySelector("["+$j+"]");for(n!==(d&&d.querySelector(":not(a-mixin)[camera]"))&&function(p){var g;p.camera&&(g=p.querySelector("["+$j+"]"))&&p.removeChild(g)}(u),this.activeCameraEl=n,this.activeCameraEl.play(),u.camera=s,l&&l.setAttribute("camera","active",!1),t=u.querySelectorAll(":not(a-mixin)[camera]"),i=0;i<t.length;i++)(e=t[i]).isEntity&&n!==e&&(e.setAttribute("camera","active",!1),e.pause());u.emit("camera-set-active",{cameraEl:n})}},setSpectatorCamera:function(n){var e,t=this.spectatorCameraEl,i=this.sceneEl;n.getObject3D("camera")&&n!==this.spectatorCameraEl&&(t&&t.setAttribute("camera","spectator",!1),e=this.spectatorCameraEl=n,i.addEventListener("enter-vr",this.wrapRender),i.addEventListener("exit-vr",this.unwrapRender),e.setAttribute("camera","active",!1),e.play(),i.emit("camera-set-spectator",{cameraEl:n}))},disableSpectatorCamera:function(){this.spectatorCameraEl=void 0},wrapRender:function(){this.spectatorCameraEl&&!this.originalRender&&(this.originalRender=this.sceneEl.renderer.render,this.sceneEl.renderer.render=this.render)},unwrapRender:function(){this.originalRender&&(this.sceneEl.renderer.render=this.originalRender,this.originalRender=void 0)},render:function(n,e){var t,i,s=this.sceneEl;t=s.renderer.xr.enabled,this.originalRender.call(s.renderer,n,e),this.spectatorCameraEl&&!s.isMobile&&t&&(i=this.spectatorCameraEl.components.camera.camera,s.renderer.xr.enabled=!1,this.originalRender.call(s.renderer,n,i),s.renderer.xr.enabled=t)}}),fc("geometry",{init:function(){this.cache={},this.cacheCount={}},clearCache:function(){this.cache={},this.cacheCount={}},getOrCreateGeometry:function(n){var e,t,i=this.cache;return n.skipCache?Qj(n):(e=i[t=this.hash(n)],function(s,l){s[l]=s[l]===void 0?1:s[l]+1}(this.cacheCount,t),e||(e=Qj(n),i[t]=e,e))},unuseGeometry:function(n){var e,t=this.cache,i=this.cacheCount;n.skipCache||t[e=this.hash(n)]&&(function(s,l){s[l]--}(i,e),i[e]>0||(t[e].dispose(),delete t[e],delete i[e]))},hash:function(n){return JSON.stringify(n)}}),fc("gltf-model",{schema:{dracoDecoderPath:{default:"https://www.gstatic.com/draco/versioned/decoders/1.5.7/"},basisTranscoderPath:{default:""},meshoptDecoderPath:{default:""}},init:function(){this.update()},update:function(){var n=this.data.dracoDecoderPath,e=this.data.basisTranscoderPath,t=this.data.meshoptDecoderPath;!this.dracoLoader&&n&&(this.dracoLoader=new ese,this.dracoLoader.setDecoderPath(n)),!this.ktx2Loader&&e&&(this.ktx2Loader=new Il,this.ktx2Loader.setTranscoderPath(e).detectSupport(this.el.renderer)),!this.meshoptDecoder&&t&&(this.meshoptDecoder=function(i){return new Promise(function(s,l){var u=document.createElement("script");document.body.appendChild(u),u.onload=s,u.onerror=l,u.async=!0,u.src=i})}(t).then(function(){return window.MeshoptDecoder.ready}).then(function(){return window.MeshoptDecoder}))},getDRACOLoader:function(){return this.dracoLoader},getKTX2Loader:function(){return this.ktx2Loader},getMeshoptDecoder:function(){return this.meshoptDecoder}});var N_="data-aframe-default-light",eoe=(fc("light",{schema:{defaultLightsEnabled:{default:!0}},init:function(){this.defaultLights=!1,this.userDefinedLights=!1,this.sceneEl.addEventListener("loaded",this.setupDefaultLights.bind(this))},registerLight:function(n){n.hasAttribute(N_)||(this.removeDefaultLights(),this.userDefinedLights=!0)},removeDefaultLights:function(){var n,e=this.sceneEl;if(this.defaultLights){n=document.querySelectorAll("["+N_+"]");for(var t=0;t<n.length;t++)e.removeChild(n[t]);this.defaultLights=!1}},setupDefaultLights:function(){var n,e,t=this.sceneEl;this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled||((n=document.createElement("a-entity")).setAttribute("light",{color:"#BBB",type:"ambient"}),n.setAttribute(N_,""),n.setAttribute(vo,""),t.appendChild(n),(e=document.createElement("a-entity")).setAttribute("light",{color:"#FFF",intensity:1.884,castShadow:!0}),e.setAttribute("position",{x:-.5,y:1,z:1}),e.setAttribute(N_,""),e.setAttribute(vo,""),t.appendChild(e),this.defaultLights=!0)}}),Ki),wJe=eoe("components:texture:error"),Kj=eoe("components:texture:warn"),CJe=new Z.ImageLoader;fc("material",{init:function(){this.materials={},this.sourceCache={}},clearTextureSourceCache:function(){this.sourceCache={}},loadTexture:function(n,e,t){this.loadTextureSource(n,function(i){var s=sU(i);mS(s,e),t(s)})},loadTextureSource:function(n,e){var t=this,i=this.sourceCache,s=this.hash(n);function l(u){i[s]=Promise.resolve(u),i[s].then(e)}i[s]?i[s].then(e):n.tagName!=="CANVAS"?l(new Promise(function(u,d){pS(n,function(p){t.loadImage(p,u)},function(p){t.loadVideo(p,u)})})):l(new Z.Source(n))},loadCubeMapTexture:function(n,e){var t=this,i=0,s=new Z.CubeTexture;function l(d){t.loadTextureSource(n[d],function(p){s.images[d]=p.data,++i==6&&(s.needsUpdate=!0,e(s))})}if(s.colorSpace=Z.SRGBColorSpace,n.length===6)for(var u=0;u<n.length;u++)l(u);else Kj("Cube map texture requires exactly 6 sources, got only %s sources",n.length)},loadImage:function(n,e){e(typeof n=="string"?function(t){return new Promise(function(i,s){CJe.load(t,function(l){i(new Z.Source(l))},function(){},function(l){wJe("`$s` could not be fetched (Error code: %s; Response: %s)",l.status,l.statusText)})})}(n):new Z.Source(n))},loadVideo:function(n,e){var t;typeof n!="string"&&function(i){i.autoplay=i.hasAttribute("autoplay")&&i.getAttribute("autoplay")!=="false",i.controls=i.hasAttribute("controls")&&i.getAttribute("controls")!=="false",i.getAttribute("loop")==="false"&&i.removeAttribute("loop"),i.getAttribute("preload")==="false"&&(i.preload="none"),i.crossOrigin=i.crossOrigin||"anonymous",i.setAttribute("playsinline",""),i.setAttribute("webkit-playsinline","")}(t=n),t=t||function(i){var s=document.createElement("video");return s.setAttribute("playsinline",""),s.setAttribute("webkit-playsinline",""),s.autoplay=!0,s.loop=!0,s.crossOrigin="anonymous",s.addEventListener("error",function(){Kj("`%s` is not a valid video",i)},!0),s.src=i,s}(n),e(new Z.Source(t))},hash:function(n){return n.tagName&&(n.id||n.src)||n},registerMaterial:function(n){this.materials[n.uuid]=n},unregisterMaterial:function(n){delete this.materials[n.uuid]}}),fc("obb-collider",{schema:{showColliders:{default:!1}},init:function(){this.collisions=[],this.colliderEls=[]},addCollider:function(n){this.colliderEls.push(n),this.data.showColliders?n.components["obb-collider"].showCollider():n.components["obb-collider"].hideCollider(),this.tick=this.detectCollisions},removeCollider:function(n){var e=this.colliderEls,t=e.indexOf(n);n.components["obb-collider"].hideCollider(),t>-1&&e.splice(t,1),e.length===0&&(this.tick=void 0)},registerCollision:function(n,e){var t=this.collisions,i=!1,s=n.obb,l=e.obb,u=n.renderColliderMesh,d=e.renderColliderMesh;u&&u.material.color.set(16711680),d&&d.material.color.set(16711680);for(var p=0;p<t.length;p++)if(t[p].componentA.obb===s&&t[p].componentB.obb===l||t[p].componentA.obb===l&&t[p].componentB.obb===s){i=!0,t[p].detected=!0;break}i||(t.push({componentA:n,componentB:e,detected:!0}),n.el.emit("obbcollisionstarted",{trackedObject3D:n.trackedObject3D,withEl:e.el}),e.el.emit("obbcollisionstarted",{trackedObject3D:e.trackedObject3D,withEl:n.el}))},resetCollisions:function(){for(var n=this.collisions,e=0;e<n.length;e++)n[e].detected=!1},clearCollisions:function(){for(var n,e,t,i,s=this.collisions,l=[],u=0;u<s.length;u++)s[u].detected?l.push(s[u]):(n=s[u].componentA,e=s[u].componentB,t=n.renderColliderMesh,i=e.renderColliderMesh,t&&t.material.color.set(65280),n.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:e.el}),i&&i.material.color.set(65280),e.el.emit("obbcollisionended",{trackedObject3D:this.trackedObject3D,withEl:n.el}));this.collisions=l},detectCollisions:function(){var n,e,t,i,s=this.colliderEls;if(!(s.length<2)){this.resetCollisions();for(var l=0;l<s.length;l++)if(t=s[l].components["obb-collider"],(n=s[l].components["obb-collider"].obb).halfSize.x!==0&&n.halfSize.y!==0&&n.halfSize.z!==0)for(var u=l+1;u<s.length;u++)(e=(i=s[u].components["obb-collider"]).obb).halfSize.x!==0&&e.halfSize.y!==0&&e.halfSize.z!==0&&n.intersectsOBB(e)&&this.registerCollision(t,i);this.clearCollisions()}}});var eN=Ki("components:renderer:warn");function EJe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z-e.z}function _Je(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder-e.renderOrder}function IJe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:e.z-n.z}fc("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},highRefreshRate:{default:jV()},logarithmicDepthBuffer:{default:"auto",oneOf:["true","false","auto"]},maxCanvasWidth:{default:-1},maxCanvasHeight:{default:-1},multiviewStereo:{default:!1},exposure:{default:1,if:{toneMapping:["ACESFilmic","linear","reinhard","cineon","AgX","neutral"]}},toneMapping:{default:"no",oneOf:["no","ACESFilmic","linear","reinhard","cineon","AgX","neutral"]},precision:{default:"high",oneOf:["high","medium","low"]},anisotropy:{default:1},sortTransparentObjects:{default:!1},colorManagement:{default:!0},alpha:{default:!0},stencil:{default:!1},foveationLevel:{default:1}},init:function(){var n=this.data,e=this.el,t=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1),i=e.renderer;i.toneMapping=Z[t+"ToneMapping"],Z.Texture.DEFAULT_ANISOTROPY=n.anisotropy,Z.ColorManagement.enabled=n.colorManagement,i.outputColorSpace=n.colorManagement?Z.SRGBColorSpace:Z.LinearSRGBColorSpace,e.hasAttribute("antialias")&&eN('Component `antialias` is deprecated. Use `renderer="antialias: true"` instead.'),e.hasAttribute("logarithmicDepthBuffer")&&eN('Component `logarithmicDepthBuffer` is deprecated. Use `renderer="logarithmicDepthBuffer: true"` instead.'),i.sortObjects=!0,i.setOpaqueSort(EJe)},update:function(){var n=this.data,e=this.el.renderer,t=this.data.toneMapping.charAt(0).toUpperCase()+this.data.toneMapping.slice(1);e.toneMapping=Z[t+"ToneMapping"],e.toneMappingExposure=n.exposure,e.xr.setFoveation(n.foveationLevel),n.sortObjects&&eN('`sortObjects` property is deprecated. Use `renderer="sortTransparentObjects: true"` instead.'),n.sortTransparentObjects?e.setTransparentSort(IJe):e.setTransparentSort(_Je)},applyColorCorrection:function(n){this.data.colorManagement&&n&&n.isTexture&&n.colorSpace!==Z.SRGBColorSpace&&(n.colorSpace=Z.SRGBColorSpace,n.needsUpdate=!0)},setWebXRFrameRate:function(n){var e,t=this.data,i=n.supportedFrameRates;i&&n.updateTargetFrameRate&&(e=i.includes(90)?t.highRefreshRate?90:72:t.highRefreshRate?72:60,n.updateTargetFrameRate(e).catch(function(s){console.warn("failed to set target frame rate of "+e+". Error info: "+s)}))}});var SJe={basic:Z.BasicShadowMap,pcf:Z.PCFShadowMap,pcfsoft:Z.PCFSoftShadowMap};fc("shadow",{schema:{enabled:{default:!0},autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function(){var n=this.sceneEl,e=this.data;this.shadowMapEnabled=!1,n.renderer.shadowMap.type=SJe[e.type],n.renderer.shadowMap.autoUpdate=e.autoUpdate},update:function(n){n.enabled!==this.data.enabled&&this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function(n){var e=this.sceneEl,t=this.sceneEl.renderer;this.shadowMapEnabled=n;var i=this.data.enabled&&this.shadowMapEnabled;t&&i!==t.shadowMap.enabled&&(t.shadowMap.enabled=i,function(s){s.hasLoaded&&s.object3D.traverse(function(l){if(l.material)for(var u=Array.isArray(l.material)?l.material:[l.material],d=0;d<u.length;d++)u[d].needsUpdate=!0})}(e))}}),fc("tracked-controls",{init:function(){this.controllers=[],this.onInputSourcesChange=this.onInputSourcesChange.bind(this),this.onEnterVR=this.onEnterVR.bind(this),this.el.addEventListener("enter-vr",this.onEnterVR),this.onExitVR=this.onExitVR.bind(this),this.el.addEventListener("exit-vr",this.onExitVR)},onEnterVR:function(){this.el.xrSession&&this.el.xrSession.addEventListener("inputsourceschange",this.onInputSourcesChange)},onExitVR:function(){this.referenceSpace=void 0,this.controllers=[],this.el.emit("controllersupdated",void 0,!1)},onInputSourcesChange:function(){var n=this,e=this.el.xrSession,t=this.el.sceneEl.systems.webxr.sessionReferenceSpaceType;e.requestReferenceSpace(t).then(function(i){n.referenceSpace=i}).catch(function(i){throw n.el.sceneEl.systems.webxr.warnIfFeatureNotRequested(t,'tracked-controls uses reference space "'+t+'".'),i}),this.controllers=e.inputSources,this.el.emit("controllersupdated",void 0,!1)}});var TJe=Ki("systems:webxr:warn"),toe=(fc("webxr",{schema:{referenceSpaceType:{type:"string",default:"local-floor"},requiredFeatures:{type:"array",default:["local-floor"]},optionalFeatures:{type:"array",default:["bounded-floor"]},overlayElement:{type:"selector"}},update:function(){var n=this.data;this.sessionConfiguration={requiredFeatures:n.requiredFeatures,optionalFeatures:n.optionalFeatures},this.sessionReferenceSpaceType=n.referenceSpaceType,n.overlayElement&&(n.overlayElement.classList.remove("a-dom-overlay"),n.optionalFeatures.includes("dom-overlay")||(n.optionalFeatures.push("dom-overlay"),this.el.setAttribute("webxr",n)),this.warnIfFeatureNotRequested("dom-overlay"),this.sessionConfiguration.domOverlay={root:n.overlayElement},n.overlayElement.classList.add("a-dom-overlay"))},wasFeatureRequested:function(n){return n==="viewer"||n==="local"||!(!this.sessionConfiguration.requiredFeatures.includes(n)&&!this.sessionConfiguration.optionalFeatures.includes(n))},warnIfFeatureNotRequested:function(n,e){this.wasFeatureRequested(n)||TJe((e?e+" ":"")+'Please add the feature "'+n+`" to a-scene's webxr system options in requiredFeatures/optionalFeatures.`)}}),{});function Zj(n){var e=n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();n==="fog"&&(e="material-fog"),n==="visible"&&(e="material-visible"),toe[e]="material."+n}function wd(){return{defaultComponents:{material:{}},mappings:Ja({},toe)}}Object.keys(ls.material.schema).forEach(Zj),Object.keys(rh.standard.schema).forEach(Zj);var D_=new Z.Vector3,MJe=new Z.Vector3;In("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function(){var n=this.data,e=this.el,t=e.object3D.parent,i=e.object3D,s=new Z.Group;D_.copy(i.position),MJe.copy(i.rotation),t.remove(i),s.add(i),t.add(s),e.object3D=s,i.position.set(-1*n.x,-1*n.y,-1*n.z),s.position.set(n.x+D_.x,n.y+D_.y,n.z+D_.z),s.rotation.copy(i.rotation),i.rotation.set(0,0,0)}}),wa("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{x:0,y:1.6,z:0}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}}),wa("a-cursor",_l({},wd(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}})),wa("a-curvedimage",_l({},wd(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}})),wa("a-gltf-model",{mappings:{src:"gltf-model"}}),wa("a-image",_l({},wd(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),wa("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target",envmap:"light.envMap","shadow-camera-automatic":"light.shadowCameraAutomatic"}}),wa("a-link",{defaultComponents:{link:{visualAspectEnabled:!0}},mappings:{href:"link.href",image:"link.image",title:"link.title"}}),wa("a-obj-model",_l({},wd(),{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}));const noe={},kJe=noe;function jj(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var tN,F_;dU.forEach(function(n){var e=$p[n],t=jj(n),i={};Object.keys(e.schema).forEach(function(u){i[jj(u)]="geometry."+u});var s="a-"+t,l=wa(s,_l({},wd(),{defaultComponents:{geometry:{primitive:n}},mappings:i}));noe[s]=l}),wa("a-sky",_l({},wd(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:_l({},kJe["a-sphere"].mappings)})),wa("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}}),tN={text:{anchor:"align",width:5}},F_=F_||{},Object.keys(tN).forEach(function(n){(function(e,t){var i=ls[e].schema;Object.keys(i).forEach(function(s){var l=s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();t[l]!==void 0&&(l=e+"-"+s),t[l]=e+"."+s})})(n,F_)}),wa("a-text",_l({},null,{defaultComponents:tN,mappings:F_})),wa("a-video",_l({},wd(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}})),wa("a-videosphere",_l({},wd(),{defaultComponents:{geometry:{primitive:"sphere",radius:500,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}));var mU=Ki,RJe=mU("A-Frame:error"),LJe=mU("A-Frame:warn");window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug&&LJe("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to ensure everything for A-Frame is properly registered before they are used from HTML."),window.cordova||window.location.protocol!=="file:"||RJe("This HTML file is currently being served via the file:// protocol. Assets, textures, and models WILL NOT WORK due to cross-origin policy! Please use a local or hosted server: https://aframe.io/docs/1.4.0/introduction/installation.html#use-a-local-server."),JV&&(window.logs=mU,Pn(7180),Pn(9379)),console.log("A-Frame Version: 1.7.0 (Date 2025-03-12, Commit #1b9650f1)"),console.log("THREE Version (https://github.com/supermedium/three.js):",xse.REVISION),window.AFRAME_ASYNC||(document.readyState!=="complete"?document.addEventListener("readystatechange",function n(){document.readyState==="complete"&&(document.removeEventListener("readystatechange",n),L3())}):L3());const BJe=globalThis.AFRAME={AComponent:O1,AEntity:Us,ANode:xo,ANIME:pI,AScene:Kse,components:ls,coreComponents:Object.keys(ls),geometries:$p,registerComponent:In,registerGeometry:_a,registerPrimitive:wa,registerShader:qf,registerSystem:fc,primitives:{getMeshMixin:wd,primitives:Zse},scenes:Og,schema:m3,shaders:rh,systems:xd,emitReady:L3,THREE:xse,utils:p3,version:Yse};Vre.A;var O_={exports:{}},Yj;function PJe(){return Yj||(Yj=1,function(n,e){var t=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof xg<"u")return xg;throw new Error("unable to locate global object")},i=t();n.exports=e=i.fetch,i.fetch&&(e.default=i.fetch.bind(i)),e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response}(O_,O_.exports)),O_.exports}const NJe={},DJe=Object.freeze(Object.defineProperty({__proto__:null,default:NJe},Symbol.toStringTag,{value:"Module"})),FJe=CLe(DJe);var nN={};(function(){function n(a,r){for(var o=0;o<r.length;o++){const c=r[o];if(typeof c!="string"&&!Array.isArray(c)){for(const h in c)if(h!=="default"&&!(h in a)){const f=Object.getOwnPropertyDescriptor(c,h);f&&Object.defineProperty(a,h,f.get?f:{enumerable:!0,get:()=>c[h]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e=1e-7,t=1e-4;class i{constructor(r,o){this.backend=r,this.dataMover=o,this.data=new WeakMap,this.dataIdsCount=0}get(r){return this.data.has(r)||this.dataMover.moveData(this.backend,r),this.data.get(r)}set(r,o){this.dataIdsCount++,this.data.set(r,o)}has(r){return this.data.has(r)}delete(r){return this.dataIdsCount--,this.data.delete(r)}numDataIds(){return this.dataIdsCount}}class s{refCount(r){return l("refCount")}incRef(r){return l("incRef")}timerAvailable(){return!0}time(r){return l("time")}read(r){return l("read")}readSync(r){return l("readSync")}readToGPU(r,o){return l("readToGPU")}numDataIds(){return l("numDataIds")}disposeData(r,o){return l("disposeData")}write(r,o,c){return l("write")}move(r,o,c,h,f){return l("move")}createTensorFromGPUData(r,o,c){return l("createTensorFromGPUData")}memory(){return l("memory")}floatPrecision(){return l("floatPrecision")}epsilon(){return this.floatPrecision()===32?e:t}dispose(){return l("dispose")}}function l(a){throw new Error(`'${a}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function u(a){let r=a.length,o=0;for(;r>0;)o=Math.random()*r|0,r--,g(a,r,o)}function d(a,r,o){return Math.max(a,Math.min(r,o))}function p(a){return a%2===0?a:a+1}function g(a,r,o){const c=a[r];a[r]=a[o],a[o]=c}function x(a){let r=0;for(let o=0;o<a.length;o++)r+=a[o];return r}function b(a,r){if(!a)throw new Error(typeof r=="string"?r:r())}function E(a,r,o=""){b(R(a,r),()=>o+` Shapes ${a} and ${r} must match`)}function S(a){b(a!=null,()=>"The input to the tensor constructor must be a non-null value.")}function M(a){if(a.length===0)return 1;let r=a[0];for(let o=1;o<a.length;o++)r*=a[o];return r}function R(a,r){if(a===r)return!0;if(a==null||r==null||a.length!==r.length)return!1;for(let o=0;o<a.length;o++)if(a[o]!==r[o])return!1;return!0}function P(a){return a%1===0}function k(a){const r=Math.ceil(Math.sqrt(a));return[r,Math.ceil(a/r)]}function F(a,r){return r<=a.length?a:a+" ".repeat(r-a.length)}function V(a,r=h=>0,o,c){return new Promise((h,f)=>{let m=0;const y=()=>{if(a()){h();return}m++;const A=r(m);if(o!=null&&m>=o){f();return}c!=null?c(y,A):setTimeout(y,A)};y()})}function G(a,r){let o=1,c=-1;for(let f=0;f<a.length;++f)if(a[f]>=0)o*=a[f];else if(a[f]===-1){if(c!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${c} and dim ${f}`);c=f}else if(a[f]<0)throw Error(`Shapes can not be < 0. Found ${a[f]} at dim ${f}`);if(c===-1){if(r>0&&r!==o)throw Error(`Size(${r}) must match the product of shape ${a}`);return a}if(o===0)throw Error(`Cannot infer the missing size in [${a}] when there are 0 elements`);if(r%o!==0)throw Error(`The implicit shape can't be a fractional number. Got ${r} / ${o}`);const h=a.slice();return h[c]=r/o,h}function q(a,r){const o=r.length;return a=a==null?r.map((c,h)=>h):[].concat(a),b(a.every(c=>c>=-o&&c<o),()=>`All values in axis param must be in range [-${o}, ${o}) but got axis ${a}`),b(a.every(c=>P(c)),()=>`All values in axis param must be integers but got axis ${a}`),a.map(c=>c<0?o+c:c)}function ne(a,r){const o=[],c=[],h=r!=null&&Array.isArray(r)&&r.length===0,f=r==null||h?null:q(r,a).sort();let m=0;for(let y=0;y<a.length;++y){if(f!=null){if(f[m]===y&&a[y]!==1)throw new Error(`Can't squeeze axis ${y} since its dim '${a[y]}' is not 1`);(f[m]==null||f[m]>y)&&a[y]===1&&(o.push(a[y]),c.push(y)),f[m]<=y&&m++}a[y]!==1&&(o.push(a[y]),c.push(y))}return{newShape:o,keptDims:c}}function K(a,r){return Q(a,r)}function Q(a,r){let o=null;if(a==null||a==="float32")o=new Float32Array(r);else if(a==="int32")o=new Int32Array(r);else if(a==="bool")o=new Uint8Array(r);else if(a==="string")o=new Array(r);else throw new Error(`Unknown data type ${a}`);return o}function H(a,r){for(let o=0;o<a.length;o++){const c=a[o];if(isNaN(c)||!isFinite(c))throw Error(`A tensor of type ${r} being uploaded contains ${c}.`)}}function j(a){return a==="bool"||a==="complex64"||a==="float32"||a==="int32"||a==="string"}function ee(a,r){return!(r==="complex64"||r==="float32"&&a!=="complex64"||r==="int32"&&a!=="float32"&&a!=="complex64"||r==="bool"&&a==="bool")}function de(a){if(a==="float32"||a==="int32")return 4;if(a==="complex64")return 8;if(a==="bool")return 1;throw new Error(`Unknown dtype ${a}`)}function oe(a){if(a==null)return 0;let r=0;return a.forEach(o=>r+=o.length),r}function we(a){return typeof a=="string"||a instanceof String}function $e(a){return typeof a=="boolean"}function Me(a){return typeof a=="number"}function Ne(a){return Array.isArray(a)?Ne(a[0]):a instanceof Float32Array?"float32":a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray?"int32":Me(a)?"float32":we(a)?"string":$e(a)?"bool":"float32"}function Ae(a){return!!(a&&a.constructor&&a.call&&a.apply)}function Fe(a,r){for(let o=r;o<a;++o)if(a%o===0)return o;return a}function Ie(a){const r=a.length;if(r<2)return[];const o=new Array(r-1);o[r-2]=a[r-1];for(let c=r-3;c>=0;--c)o[c]=o[c+1]*a[c+1];return o}function qe(a,r,o,c=!1){const h=new Array;if(r.length===1){const f=r[0]*(c?2:1);for(let m=0;m<f;m++)h[m]=o[a+m]}else{const f=r[0],m=r.slice(1),y=m.reduce((A,w)=>A*w)*(c?2:1);for(let A=0;A<f;A++)h[A]=qe(a+A*y,m,o,c)}return h}function dt(a,r,o=!1){if(a.length===0)return r[0];const c=a.reduce((h,f)=>h*f)*(o?2:1);if(c===0)return[];if(c!==r.length)throw new Error(`[${a}] does not match the input size ${r.length}${o?" for a complex tensor":""}.`);return qe(0,a,r,o)}function Wt(a,r){if(Array.isArray(a))return a;if(r==="float32")return a instanceof Float32Array?a:new Float32Array(a);if(r==="int32")return a instanceof Int32Array?a:new Int32Array(a);if(r==="bool"||r==="string")return Uint8Array.from(new Int32Array(a));throw new Error(`Unknown dtype ${r}`)}function xt(a,r){const o=At(a,r);for(let c=0;c<o.length;c++)o[c]=1;return o}function At(a,r){if(r==null||r==="float32"||r==="complex64")return new Float32Array(a);if(r==="int32")return new Int32Array(a);if(r==="bool")return new Uint8Array(a);throw new Error(`Unknown data type ${r}`)}function Rt(a,r){const o=a.reduce((c,h)=>c*h,1);if(r==null||r==="float32")return dt(a,new Float32Array(o));if(r==="int32")return dt(a,new Int32Array(o));if(r==="bool")return dt(a,new Uint8Array(o));throw new Error(`Unknown data type ${r}`)}function Et(a){a.forEach(r=>{b(Number.isInteger(r)&&r>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${a}].`)})}function Ze(a,r,o){if(r===0)return 0;if(r===1)return a[0];let c=a[a.length-1];for(let h=0;h<a.length-1;++h)c+=o[h]*a[h];return c}function It(a,r,o){if(r===0)return[];if(r===1)return[a];const c=new Array(r);for(let h=0;h<c.length-1;++h)c[h]=Math.floor(a/o[h]),a-=c[h]*o[h];return c[c.length-1]=a,c}function Lt(a){return a&&a.then&&typeof a.then=="function"}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yt="tfjsflags";class ht{constructor(r){this.global=r,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=yt,this.populateURLFlags()}setPlatform(r,o){this.platform!=null&&(Te().getBool("IS_TEST")||Te().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${r}.`)),this.platformName=r,this.platform=o}registerFlag(r,o,c){if(this.flagRegistry[r]={evaluationFn:o,setHook:c},this.urlFlags[r]!=null){const h=this.urlFlags[r];Te().getBool("IS_TEST")||Te().getBool("PROD")||console.warn(`Setting feature override from URL ${r}: ${h}.`),this.set(r,h)}}async getAsync(r){return r in this.flags?this.flags[r]:(this.flags[r]=await this.evaluateFlag(r),this.flags[r])}get(r){if(r in this.flags)return this.flags[r];const o=this.evaluateFlag(r);if(Lt(o))throw new Error(`Flag ${r} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[r]=o,this.flags[r]}getNumber(r){return this.get(r)}getBool(r){return this.get(r)}getString(r){return this.get(r)}getFlags(){return this.flags}get features(){return this.flags}set(r,o){if(this.flagRegistry[r]==null)throw new Error(`Cannot set flag ${r} as it has not been registered.`);this.flags[r]=o,this.flagRegistry[r].setHook!=null&&this.flagRegistry[r].setHook(o)}evaluateFlag(r){if(this.flagRegistry[r]==null)throw new Error(`Cannot evaluate flag '${r}': no evaluation function found.`);return this.flagRegistry[r].evaluationFn()}setFlags(r){this.flags=Object.assign({},r)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const r=this.getQueryParams(this.global.location.search);Yt in r&&r[Yt].split(",").forEach(o=>{const[c,h]=o.split(":");this.urlFlags[c]=Ee(c,h)})}}function yt(a){const r={};return a.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(o,...c)=>(wt(r,c[0],c[1]),c.join("="))),r}function wt(a,r,o){a[decodeURIComponent(r)]=decodeURIComponent(o||"")}function Ee(a,r){const o=r.toLowerCase();return o==="true"||o==="false"?o==="true":`${+o}`===o?+o:r}function Te(){return Gt}let Gt=null;function Y(a){Gt=a}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let te;function ce(){if(te==null){let a;if(typeof window<"u")a=window;else if(typeof xg<"u")a=xg;else if(typeof process<"u")a=process;else if(typeof self<"u")a=self;else throw new Error("Could not find a global object");te=a}return te}function xe(){const a=ce();return a._tfGlobals==null&&(a._tfGlobals=new Map),a._tfGlobals}function Re(a,r){const o=xe();if(o.has(a))return o.get(a);{const c=r();return o.set(a,c),o.get(a)}}const We="Abs",at="Acos",ln="Acosh",ve="Add",ue="AddN",Oe="All",ut="Any",vt="ArgMax",pt="ArgMin",cn="Asin",Tt="Asinh",Zt="Atan",kn="Atanh",Ft="Atan2",vn="AvgPool",jn="AvgPoolGrad",Pe="AvgPool3D",ft="AvgPool3DGrad",Pt="BatchMatMul",Dt="BatchToSpaceND",qt="Bincount",sn="BitwiseAnd",Rn="BroadcastTo",tn="BroadcastArgs",Jt="Cast",fn="Ceil",ei="ClipByValue",ar="Complex",ta="ComplexAbs",yc="Concat",Dl="Conv2D",qr="Conv2DBackpropFilter",hn="Conv2DBackpropInput",al="Conv3D",ks="Conv3DBackpropFilterV2",Fl="Conv3DBackpropInputV2",Io="Cos",So="Cosh",na="Cumprod",ro="Cumsum",Ac="CropAndResize",uu="DenseBincount",_h="DepthToSpace",ll="DepthwiseConv2dNative",hu="DepthwiseConv2dNativeBackpropFilter",Ol="DepthwiseConv2dNativeBackpropInput",Vl="Diag",pe="Dilation2D",ze="Dilation2DBackpropInput",nt="Dilation2DBackpropFilter",rt="Draw",Ge="RealDiv",Nt="Einsum",Kt="Elu",on="EluGrad",dn="Erf",Ln="Equal",Sn="Exp",zt="ExpandDims",gn="Expm1",Hn="FFT",Ci="Fill",bi="FlipLeftRight",Yn="Floor",Ht="FloorDiv",jt="FusedBatchNorm",us="GatherV2",ti="GatherNd",Oi="Greater",Jr="GreaterEqual",hs="Identity",ds="IFFT",Nn="Imag",Vi="IsFinite",pr="IsInf",mi="IsNan",Qs="LeakyRelu",fs="Less",Ba="LessEqual",Ih="LinSpace",cl="Log",To="Log1p",du="LogicalAnd",vc="LogicalNot",Sh="LogicalOr",Pa="LogSoftmax",Zd="LRN",Xn="LRNGrad",ps="Max",ki="Maximum",ul="MaxPool",hl="MaxPoolGrad",bc="MaxPool3D",xc="MaxPool3DGrad",Ui="MaxPoolWithArgmax",fu="Mean",Ul="Min",mr="Minimum",ia="MirrorPad",wc="Mod",pu="Multinomial",Mo="Multiply",mu="Neg",gu="NotEqual",Cc="NonMaxSuppressionV3",Th="NonMaxSuppressionV4",ui="NonMaxSuppressionV5",Ec="OnesLike",Rs="OneHot",ra="Pack",Mh="PadV2",yu="Pow",Na="Prelu",kh="Prod",jd="RaggedGather",Yd="RaggedRange",qd="RaggedTensorToTensor",Au="Range",vu="Real",Ls="Reciprocal",bu="Relu",sa="Reshape",ko="ResizeNearestNeighbor",Rh="ResizeNearestNeighborGrad",xu="ResizeBilinear",wu="ResizeBilinearGrad",zl="Relu6",es="Reverse",_c="Round",Cu="Rsqrt",Ic="ScatterNd",N="TensorScatterUpdate",J="SearchSorted",ae="Select",me="Selu",Ke="Slice",it="Sin",Xt="Sinh",zn="Sign",xi="Sigmoid",Ii="Softplus",lr="Sqrt",so="Sum",Ro="SpaceToBatchND",oo="SplitV",oa="Softmax",Lh="SparseFillEmptyRows",Bh="SparseReshape",yw="SparseSegmentMean",Da="SparseSegmentSum",Ph="SparseToDense",nm="SquaredDifference",dl="Square",sv="StaticRegexReplace",Eu="StridedSlice",Aw="StringNGrams",Jd="StringSplit",ov="StringToHashBucketFast",_u="Sub",im="Tan",Fa="Tanh",Iu="Tile",av="TopK",rm="Transform",ef="Transpose",fl="Unique",m0="Unpack",Sc="UnsortedSegmentSum",g0="ZerosLike",aa="Step",tf="FromPixels",y0="RotateWithOffset",nf="_FusedMatMul",Nh="FusedConv2D",A0="FusedDepthwiseConv2D";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ks(...a){Te().getBool("IS_TEST")||Te().getBool("PROD")||console.warn(...a)}function rf(...a){Te().getBool("IS_TEST")||Te().getBool("PROD")||console.log(...a)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Dh=Re("kernelRegistry",()=>new Map),sm=Re("gradRegistry",()=>new Map);function v0(a,r){const o=xw(a,r);return Dh.get(o)}function vw(a){return sm.get(a)}function om(a){const r=Dh.entries(),o=[];for(;;){const{done:c,value:h}=r.next();if(c)break;const[f,m]=h,[y]=f.split("_");y===a&&o.push(m)}return o}function la(a){const{kernelName:r,backendName:o}=a,c=xw(r,o);Dh.has(c)&&Ks(`The kernel '${r}' for backend '${o}' is already registered`),Dh.set(c,a)}function bw(a){const{kernelName:r}=a;sm.has(r)&&Te().getBool("DEBUG")&&Ks(`Overriding the gradient for '${r}'`),sm.set(r,a)}function xw(a,r){return`${r}_${a}`}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lv(a){return a instanceof Float32Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray}var Fh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof xg<"u"?xg:typeof self<"u"?self:{};function Gl(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function b0(a){if(a.__esModule)return a;var r=a.default;if(typeof r=="function"){var o=function c(){return this instanceof c?Reflect.construct(r,arguments,this.constructor):r.apply(this,arguments)};o.prototype=r.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(a).forEach(function(c){var h=Object.getOwnPropertyDescriptor(a,c);Object.defineProperty(o,c,h.get?h:{enumerable:!0,get:function(){return a[c]}})}),o}var ww=ir,ao=null;try{ao=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ir(a,r,o){this.low=a|0,this.high=r|0,this.unsigned=!!o}ir.prototype.__isLong__,Object.defineProperty(ir.prototype,"__isLong__",{value:!0});function lo(a){return(a&&a.__isLong__)===!0}ir.isLong=lo;var Cw={},sf={};function Oh(a,r){var o,c,h;return r?(a>>>=0,(h=0<=a&&a<256)&&(c=sf[a],c)?c:(o=Ji(a,(a|0)<0?-1:0,!0),h&&(sf[a]=o),o)):(a|=0,(h=-128<=a&&a<128)&&(c=Cw[a],c)?c:(o=Ji(a,a<0?-1:0,!1),h&&(Cw[a]=o),o))}ir.fromInt=Oh;function Bs(a,r){if(isNaN(a))return r?Su:ca;if(r){if(a<0)return Su;if(a>=_w)return fv}else{if(a<=-lm)return co;if(a+1>=lm)return dv}return a<0?Bs(-a,r).neg():Ji(a%Wl|0,a/Wl|0,r)}ir.fromNumber=Bs;function Ji(a,r,o){return new ir(a,r,o)}ir.fromBits=Ji;var am=Math.pow;function cv(a,r,o){if(a.length===0)throw Error("empty string");if(a==="NaN"||a==="Infinity"||a==="+Infinity"||a==="-Infinity")return ca;if(typeof r=="number"?(o=r,r=!1):r=!!r,o=o||10,o<2||36<o)throw RangeError("radix");var c;if((c=a.indexOf("-"))>0)throw Error("interior hyphen");if(c===0)return cv(a.substring(1),r,o).neg();for(var h=Bs(am(o,8)),f=ca,m=0;m<a.length;m+=8){var y=Math.min(8,a.length-m),A=parseInt(a.substring(m,m+y),o);if(y<8){var w=Bs(am(o,y));f=f.mul(w).add(Bs(A))}else f=f.mul(h),f=f.add(Bs(A))}return f.unsigned=r,f}ir.fromString=cv;function ts(a,r){return typeof a=="number"?Bs(a,r):typeof a=="string"?cv(a,r):Ji(a.low,a.high,typeof r=="boolean"?r:a.unsigned)}ir.fromValue=ts;var uv=65536,Ew=1<<24,Wl=uv*uv,_w=Wl*Wl,lm=_w/2,of=Oh(Ew),ca=Oh(0);ir.ZERO=ca;var Su=Oh(0,!0);ir.UZERO=Su;var af=Oh(1);ir.ONE=af;var hv=Oh(1,!0);ir.UONE=hv;var x0=Oh(-1);ir.NEG_ONE=x0;var dv=Ji(-1,2147483647,!1);ir.MAX_VALUE=dv;var fv=Ji(-1,-1,!0);ir.MAX_UNSIGNED_VALUE=fv;var co=Ji(0,-2147483648,!1);ir.MIN_VALUE=co;var en=ir.prototype;en.toInt=function(){return this.unsigned?this.low>>>0:this.low},en.toNumber=function(){return this.unsigned?(this.high>>>0)*Wl+(this.low>>>0):this.high*Wl+(this.low>>>0)},en.toString=function(a){if(a=a||10,a<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(co)){var r=Bs(a),o=this.div(r),c=o.mul(r).sub(this);return o.toString(a)+c.toInt().toString(a)}else return"-"+this.neg().toString(a);for(var h=Bs(am(a,6),this.unsigned),f=this,m="";;){var y=f.div(h),A=f.sub(y.mul(h)).toInt()>>>0,w=A.toString(a);if(f=y,f.isZero())return w+m;for(;w.length<6;)w="0"+w;m=""+w+m}},en.getHighBits=function(){return this.high},en.getHighBitsUnsigned=function(){return this.high>>>0},en.getLowBits=function(){return this.low},en.getLowBitsUnsigned=function(){return this.low>>>0},en.getNumBitsAbs=function(){if(this.isNegative())return this.eq(co)?64:this.neg().getNumBitsAbs();for(var a=this.high!=0?this.high:this.low,r=31;r>0&&!(a&1<<r);r--);return this.high!=0?r+33:r+1},en.isZero=function(){return this.high===0&&this.low===0},en.eqz=en.isZero,en.isNegative=function(){return!this.unsigned&&this.high<0},en.isPositive=function(){return this.unsigned||this.high>=0},en.isOdd=function(){return(this.low&1)===1},en.isEven=function(){return(this.low&1)===0},en.equals=function(a){return lo(a)||(a=ts(a)),this.unsigned!==a.unsigned&&this.high>>>31===1&&a.high>>>31===1?!1:this.high===a.high&&this.low===a.low},en.eq=en.equals,en.notEquals=function(a){return!this.eq(a)},en.neq=en.notEquals,en.ne=en.notEquals,en.lessThan=function(a){return this.comp(a)<0},en.lt=en.lessThan,en.lessThanOrEqual=function(a){return this.comp(a)<=0},en.lte=en.lessThanOrEqual,en.le=en.lessThanOrEqual,en.greaterThan=function(a){return this.comp(a)>0},en.gt=en.greaterThan,en.greaterThanOrEqual=function(a){return this.comp(a)>=0},en.gte=en.greaterThanOrEqual,en.ge=en.greaterThanOrEqual,en.compare=function(a){if(lo(a)||(a=ts(a)),this.eq(a))return 0;var r=this.isNegative(),o=a.isNegative();return r&&!o?-1:!r&&o?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},en.comp=en.compare,en.negate=function(){return!this.unsigned&&this.eq(co)?co:this.not().add(af)},en.neg=en.negate,en.add=function(a){lo(a)||(a=ts(a));var r=this.high>>>16,o=this.high&65535,c=this.low>>>16,h=this.low&65535,f=a.high>>>16,m=a.high&65535,y=a.low>>>16,A=a.low&65535,w=0,C=0,_=0,T=0;return T+=h+A,_+=T>>>16,T&=65535,_+=c+y,C+=_>>>16,_&=65535,C+=o+m,w+=C>>>16,C&=65535,w+=r+f,w&=65535,Ji(_<<16|T,w<<16|C,this.unsigned)},en.subtract=function(a){return lo(a)||(a=ts(a)),this.add(a.neg())},en.sub=en.subtract,en.multiply=function(a){if(this.isZero())return ca;if(lo(a)||(a=ts(a)),ao){var r=ao.mul(this.low,this.high,a.low,a.high);return Ji(r,ao.get_high(),this.unsigned)}if(a.isZero())return ca;if(this.eq(co))return a.isOdd()?co:ca;if(a.eq(co))return this.isOdd()?co:ca;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(of)&&a.lt(of))return Bs(this.toNumber()*a.toNumber(),this.unsigned);var o=this.high>>>16,c=this.high&65535,h=this.low>>>16,f=this.low&65535,m=a.high>>>16,y=a.high&65535,A=a.low>>>16,w=a.low&65535,C=0,_=0,T=0,B=0;return B+=f*w,T+=B>>>16,B&=65535,T+=h*w,_+=T>>>16,T&=65535,T+=f*A,_+=T>>>16,T&=65535,_+=c*w,C+=_>>>16,_&=65535,_+=h*A,C+=_>>>16,_&=65535,_+=f*y,C+=_>>>16,_&=65535,C+=o*w+c*A+h*y+f*m,C&=65535,Ji(T<<16|B,C<<16|_,this.unsigned)},en.mul=en.multiply,en.divide=function(a){if(lo(a)||(a=ts(a)),a.isZero())throw Error("division by zero");if(ao){if(!this.unsigned&&this.high===-2147483648&&a.low===-1&&a.high===-1)return this;var r=(this.unsigned?ao.div_u:ao.div_s)(this.low,this.high,a.low,a.high);return Ji(r,ao.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Su:ca;var o,c,h;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return Su;if(a.gt(this.shru(1)))return hv;h=Su}else{if(this.eq(co)){if(a.eq(af)||a.eq(x0))return co;if(a.eq(co))return af;var f=this.shr(1);return o=f.div(a).shl(1),o.eq(ca)?a.isNegative()?af:x0:(c=this.sub(a.mul(o)),h=o.add(c.div(a)),h)}else if(a.eq(co))return this.unsigned?Su:ca;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();h=ca}for(c=this;c.gte(a);){o=Math.max(1,Math.floor(c.toNumber()/a.toNumber()));for(var m=Math.ceil(Math.log(o)/Math.LN2),y=m<=48?1:am(2,m-48),A=Bs(o),w=A.mul(a);w.isNegative()||w.gt(c);)o-=y,A=Bs(o,this.unsigned),w=A.mul(a);A.isZero()&&(A=af),h=h.add(A),c=c.sub(w)}return h},en.div=en.divide,en.modulo=function(a){if(lo(a)||(a=ts(a)),ao){var r=(this.unsigned?ao.rem_u:ao.rem_s)(this.low,this.high,a.low,a.high);return Ji(r,ao.get_high(),this.unsigned)}return this.sub(this.div(a).mul(a))},en.mod=en.modulo,en.rem=en.modulo,en.not=function(){return Ji(~this.low,~this.high,this.unsigned)},en.and=function(a){return lo(a)||(a=ts(a)),Ji(this.low&a.low,this.high&a.high,this.unsigned)},en.or=function(a){return lo(a)||(a=ts(a)),Ji(this.low|a.low,this.high|a.high,this.unsigned)},en.xor=function(a){return lo(a)||(a=ts(a)),Ji(this.low^a.low,this.high^a.high,this.unsigned)},en.shiftLeft=function(a){return lo(a)&&(a=a.toInt()),(a&=63)===0?this:a<32?Ji(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):Ji(0,this.low<<a-32,this.unsigned)},en.shl=en.shiftLeft,en.shiftRight=function(a){return lo(a)&&(a=a.toInt()),(a&=63)===0?this:a<32?Ji(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):Ji(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},en.shr=en.shiftRight,en.shiftRightUnsigned=function(a){if(lo(a)&&(a=a.toInt()),a&=63,a===0)return this;var r=this.high;if(a<32){var o=this.low;return Ji(o>>>a|r<<32-a,r>>>a,this.unsigned)}else return a===32?Ji(r,0,this.unsigned):Ji(r>>>a-32,0,this.unsigned)},en.shru=en.shiftRightUnsigned,en.shr_u=en.shiftRightUnsigned,en.toSigned=function(){return this.unsigned?Ji(this.low,this.high,!1):this},en.toUnsigned=function(){return this.unsigned?this:Ji(this.low,this.high,!0)},en.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},en.toBytesLE=function(){var a=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,a&255,a>>>8&255,a>>>16&255,a>>>24]},en.toBytesBE=function(){var a=this.high,r=this.low;return[a>>>24,a>>>16&255,a>>>8&255,a&255,r>>>24,r>>>16&255,r>>>8&255,r&255]},ir.fromBytes=function(a,r,o){return o?ir.fromBytesLE(a,r):ir.fromBytesBE(a,r)},ir.fromBytesLE=function(a,r){return new ir(a[0]|a[1]<<8|a[2]<<16|a[3]<<24,a[4]|a[5]<<8|a[6]<<16|a[7]<<24,r)},ir.fromBytesBE=function(a,r){return new ir(a[4]<<24|a[5]<<16|a[6]<<8|a[7],a[0]<<24|a[1]<<16|a[2]<<8|a[3],r)};const pv=Gl(ww),Iw=n({__proto__:null,default:pv},[ww]);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Vh=pv||Iw;function v(a){return Vh.fromString(a,!0,16)}const I=v("c3a5c85c97cb3127"),D=v("b492b66fbe98f273"),$=v("9ae16a3b2f90404f");function ie(a){return a.xor(a.shru(47))}function fe(a,r,o){const c=a.slice(r,r+o);return Vh.fromBytes(Array.from(c),!0,!0)}function _e(a,r){return fe(a,r,8)}function je(a,r){return fe(a,r,4)}function Je(a,r){return r===0?a:a.shru(r).or(a.shl(64-r))}function Ct(a,r,o=v("9ddfea08eb382d69")){let c=a.xor(r).mul(o);c=c.xor(c.shru(47));let h=r.xor(c).mul(o);return h=h.xor(h.shru(47)),h=h.mul(o),h}function yn(a,r,o,c,h,f){h=h.add(a),f=Je(f.add(h).add(c),21);const m=h;return h=h.add(r),h=h.add(o),f=f.add(Je(h,44)),[h.add(c),f.add(m)]}function On(a,r,o,c){return yn(_e(a,r),_e(a,r+8),_e(a,r+16),_e(a,r+24),o,c)}function gi(a,r=a.length){if(r>=8){const o=$.add(r*2),c=_e(a,0).add($),h=_e(a,r-8),f=Je(h,37).mul(o).add(c),m=Je(c,25).add(h).mul(o);return Ct(f,m,o)}if(r>=4){const o=$.add(r*2),c=je(a,0);return Ct(c.shl(3).add(r),je(a,r-4),o)}if(r>0){const o=a[0],c=a[r>>1],h=a[r-1],f=o+(c<<8),m=r+(h<<2);return ie($.mul(f).xor(I.mul(m))).mul($)}return $}function uo(a,r=a.length){const o=$.add(r*2),c=_e(a,0).mul(D),h=_e(a,8),f=_e(a,r-8).mul(o),m=_e(a,r-16).mul($);return Ct(Je(c.add(h),43).add(Je(f,30)).add(m),c.add(Je(h.add($),18)).add(f),o)}function ms(a,r=a.length){const o=$.add(r*2),c=_e(a,0).mul($),h=_e(a,8),f=_e(a,r-8).mul(o),m=_e(a,r-16).mul($),y=Je(c.add(h),43).add(Je(f,30)).add(m),A=Ct(y,c.add(Je(h.add($),18)).add(f),o),w=_e(a,16).mul(o),C=_e(a,24),_=y.add(_e(a,r-32)).mul(o),T=A.add(_e(a,r-24)).mul(o);return Ct(Je(w.add(C),43).add(Je(_,30)).add(T),w.add(Je(C.add(c),18)).add(_),o)}function Oa(a,r=a.length){const o=Vh.fromNumber(81,!0);if(r<=32)return r<=16?gi(a,r):uo(a,r);if(r<=64)return ms(a,r);let c=o,h=o.mul(D).add(113),f=ie(h.mul($).add(113)).mul($),m=[Vh.UZERO,Vh.UZERO],y=[Vh.UZERO,Vh.UZERO];c=c.mul($).add(_e(a,0));let A=0;const w=(r-1>>6)*64,C=w+(r-1&63)-63;do c=Je(c.add(h).add(m[0]).add(_e(a,A+8)),37).mul(D),h=Je(h.add(m[1]).add(_e(a,A+48)),42).mul(D),c=c.xor(y[1]),h=h.add(m[0]).add(_e(a,A+40)),f=Je(f.add(y[0]),33).mul(D),m=On(a,A,m[1].mul(D),c.add(y[0])),y=On(a,A+32,f.add(y[1]),h.add(_e(a,A+16))),[f,c]=[c,f],A+=64;while(A!==w);const _=D.add(f.and(255).shl(1));return A=C,y[0]=y[0].add(r-1&63),m[0]=m[0].add(y[0]),y[0]=y[0].add(m[0]),c=Je(c.add(h).add(m[0]).add(_e(a,A+8)),37).mul(_),h=Je(h.add(m[1]).add(_e(a,A+48)),42).mul(_),c=c.xor(y[1].mul(9)),h=h.add(m[0].mul(9).add(_e(a,A+40))),f=Je(f.add(y[0]),33).mul(_),m=On(a,A,m[1].mul(_),c.add(y[0])),y=On(a,A+32,f.add(y[1]),h.add(_e(a,A+16))),[f,c]=[c,f],Ct(Ct(m[0],y[0],_).add(ie(h).mul(I)).add(f),Ct(m[1],y[1],_).add(c),_)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Br(a,r){return r==="string"?Tu(a):Uh([a],r)}function lf(a,r){return a instanceof Float32Array&&r==="float32"||a instanceof Int32Array&&r==="int32"||a instanceof Uint8Array&&r==="bool"}function Uh(a,r){if(r==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(a)&&(a=Mu(a)),Te().getBool("DEBUG")&&H(a,r),lf(a,r))return a;if(r==null||r==="float32"||r==="complex64")return new Float32Array(a);if(r==="int32")return new Int32Array(a);if(r==="bool"){const o=new Uint8Array(a.length);for(let c=0;c<o.length;++c)Math.round(a[c])!==0&&(o[c]=1);return o}else throw new Error(`Unknown data type ${r}`)}function ho(){return Te().platform.now()}function Tu(a,r="utf-8"){return r=r||"utf-8",Te().platform.encode(a,r)}function Tc(a,r="utf-8"){return r=r||"utf-8",Te().platform.decode(a,r)}function Va(a){return Te().platform.isTypedArray!=null?Te().platform.isTypedArray(a):lv(a)}function Mu(a,r=[],o=!1){if(r==null&&(r=[]),typeof a=="boolean"||typeof a=="number"||typeof a=="string"||Lt(a)||a==null||Va(a)&&o)r.push(a);else if(Array.isArray(a)||Va(a))for(let c=0;c<a.length;++c)Mu(a[c],r,o);else{let c=-1;for(const h of Object.keys(a))/^([1-9]+[0-9]*|0)$/.test(h)&&(c=Math.max(c,Number(h)));for(let h=0;h<=c;h++)Mu(a[h],r,o)}return r}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Gr{constructor(r,o){this.backendTimer=r,this.logger=o,o==null&&(this.logger=new lM)}profileKernel(r,o,c){let h;const f=()=>{h=c()};let m;const y=ho();if(this.backendTimer.timerAvailable())m=this.backendTimer.time(f);else{f();for(const A of h)A.dataSync();m=Promise.resolve({kernelMs:ho()-y})}if(Te().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let A=0;A<h.length;A++){const w=h[A];w.data().then(C=>{w0(C,w.dtype,r)})}return{kernelName:r,outputs:h,inputs:o,timeMs:m.then(A=>A.kernelMs),extraInfo:m.then(A=>A.getExtraProfileInfo!=null?A.getExtraProfileInfo():"")}}logKernelProfile(r){const{kernelName:o,outputs:c,timeMs:h,inputs:f,extraInfo:m}=r;c.forEach(y=>{Promise.all([y.data(),h,m]).then(A=>{this.logger.logKernelProfile(o,y,A[0],A[1],f,A[2])})})}}function w0(a,r,o){if(r!=="float32")return!1;for(let c=0;c<a.length;c++){const h=a[c];if(isNaN(h)||!isFinite(h))return console.warn(`Found ${h} in the result of '${o}'`),!0}return!1}class lM{logKernelProfile(r,o,c,h,f,m){const y=typeof h=="number"?F(`${h}ms`,9):h.error,A=F(r,25),w=o.rank,C=o.size,_=F(o.shape.toString(),14);let T="";for(const B in f){const O=f[B];if(O!=null){const U=O.shape||o.shape,W=U.length;T+=`${B}: ${W}D ${W>0?U:""} `}}console.log(`%c${A}	%c${y}	%c${w}D ${_}	%c${C}	%c${T}	%c${m}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cM(a,r,o){const c={},h={};for(let A=0;A<r.length;A++)c[r[A].id]=!0;for(let A=0;A<a.length;A++){const w=a[A],C=w.inputs;for(const _ in C){const T=C[_];let B=!1;for(let O=0;O<r.length;O++)if(c[T.id]){w.outputs.forEach(U=>c[U.id]=!0),B=!0,h[w.id]=!0;break}if(B)break}}const f={};f[o.id]=!0;const m={};for(let A=a.length-1;A>=0;A--){const w=a[A],C=w.inputs;for(let _=0;_<w.outputs.length;_++)if(f[w.outputs[_].id]){for(const T in C)f[C[T].id]=!0,m[w.id]=!0;break}}const y=[];for(let A=0;A<a.length;A++){const w=a[A];if(h[w.id]&&m[w.id]){const C={};for(const T in w.inputs){const B=w.inputs[T];c[B.id]&&(C[T]=B)}const _=Object.assign({},w);_.inputs=C,_.outputs=w.outputs,y.push(_)}}return y}function uM(a,r,o,c){for(let h=r.length-1;h>=0;h--){const f=r[h],m=[];if(f.outputs.forEach(A=>{const w=a[A.id];w!=null?m.push(w):m.push(null)}),f.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${f.kernelName}.`);const y=f.gradient(m);for(const A in f.inputs){if(!(A in y))throw new Error(`Cannot backprop through input ${A}. Available gradients found: ${Object.keys(y)}.`);const w=o(()=>y[A]());if(w.dtype!=="float32")throw new Error(`Error in gradient for op ${f.kernelName}. The gradient of input ${A} must have 'float32' dtype, but has '${w.dtype}'`);const C=f.inputs[A];if(!R(w.shape,C.shape))throw new Error(`Error in gradient for op ${f.kernelName}. The gradient of input '${A}' has shape '${w.shape}', which does not match the shape of the input '${C.shape}'`);if(a[C.id]==null)a[C.id]=w;else{const _=a[C.id];a[C.id]=c(_,w),_.dispose()}}}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const C0=20,cf=3,mv=7;function ioe(a,r,o,c){const h=Ie(r),f=roe(a,r,o,h),m=r.length,y=Sw(a,r,o,h,f),A=["Tensor"];return c&&(A.push(`  dtype: ${o}`),A.push(`  rank: ${m}`),A.push(`  shape: [${r}]`),A.push("  values:")),A.push(y.map(w=>"    "+w).join(`
`)),A.join(`
`)}function roe(a,r,o,c){const h=M(r),f=c[c.length-1],m=new Array(f).fill(0),y=r.length,A=o==="complex64"?yv(a):a;if(y>1)for(let w=0;w<h/f;w++){const C=w*f;for(let _=0;_<f;_++)m[_]=Math.max(m[_],gv(A[C+_],0,o).length)}return m}function gv(a,r,o){let c;return Array.isArray(a)?c=`${parseFloat(a[0].toFixed(mv))} + ${parseFloat(a[1].toFixed(mv))}j`:we(a)?c=`'${a}'`:o==="bool"?c=gU(a):c=parseFloat(a.toFixed(mv)).toString(),F(c,r)}function gU(a){return a===0?"false":"true"}function Sw(a,r,o,c,h,f=!0){const m=o==="complex64"?2:1,y=r[0],A=r.length;if(A===0){if(o==="complex64"){const U=yv(a);return[gv(U[0],0,o)]}return o==="bool"?[gU(a[0])]:[a[0].toString()]}if(A===1){if(y>C0){const U=cf*m;let W=Array.from(a.slice(0,U)),z=Array.from(a.slice((y-cf)*m,y*m));return o==="complex64"&&(W=yv(W),z=yv(z)),["["+W.map((X,re)=>gv(X,h[re],o)).join(", ")+", ..., "+z.map((X,re)=>gv(X,h[y-cf+re],o)).join(", ")+"]"]}return["["+(o==="complex64"?yv(a):Array.from(a)).map((U,W)=>gv(U,h[W],o)).join(", ")+"]"]}const w=r.slice(1),C=c.slice(1),_=c[0]*m,T=[];if(y>C0){for(let U=0;U<cf;U++){const W=U*_,z=W+_;T.push(...Sw(a.slice(W,z),w,o,C,h,!1))}T.push("...");for(let U=y-cf;U<y;U++){const W=U*_,z=W+_;T.push(...Sw(a.slice(W,z),w,o,C,h,U===y-1))}}else for(let U=0;U<y;U++){const W=U*_,z=W+_;T.push(...Sw(a.slice(W,z),w,o,C,h,U===y-1))}const B=A===2?",":"";T[0]="["+(y>0?T[0]+B:"");for(let U=1;U<T.length-1;U++)T[U]=" "+T[U]+B;let O=`,
`;for(let U=2;U<A;U++)O+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(f?"":O),T}function yv(a){const r=[];for(let o=0;o<a.length;o+=2)r.push([a[o],a[o+1]]);return r}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Zs{constructor(r,o,c){if(this.dtype=o,this.shape=r.slice(),this.size=M(r),c!=null){const h=c.length;b(h===this.size,()=>`Length of values '${h}' does not match the size inferred by the shape '${this.size}'.`)}if(o==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=c||Q(o,this.size),this.strides=Ie(r)}set(r,...o){o.length===0&&(o=[0]),b(o.length===this.rank,()=>`The number of provided coordinates (${o.length}) must match the rank (${this.rank})`);const c=this.locToIndex(o);this.values[c]=r}get(...r){r.length===0&&(r=[0]);let o=0;for(const h of r){if(h<0||h>=this.shape[o]){const f=`Requested out of range element at ${r}.   Buffer shape=${this.shape}`;throw new Error(f)}o++}let c=r[r.length-1];for(let h=0;h<r.length-1;++h)c+=this.strides[h]*r[h];return this.values[c]}locToIndex(r){if(this.rank===0)return 0;if(this.rank===1)return r[0];let o=r[r.length-1];for(let c=0;c<r.length-1;++c)o+=this.strides[c]*r[c];return o}indexToLoc(r){if(this.rank===0)return[];if(this.rank===1)return[r];const o=new Array(this.shape.length);for(let c=0;c<o.length-1;++c)o[c]=Math.floor(r/this.strides[c]),r-=o[c]*this.strides[c];return o[o.length-1]=r,o}get rank(){return this.shape.length}toTensor(){return Mc().makeTensor(this.values,this.shape,this.dtype)}}let Mc=null,E0=null;function soe(a){Mc=a}function ooe(a){E0=a}class gs{constructor(r,o,c,h){this.kept=!1,this.isDisposedInternal=!1,this.shape=r.slice(),this.dtype=o||"float32",this.size=M(r),this.strides=Ie(r),this.dataId=c,this.id=h,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const r=await this.data();return E0.buffer(this.shape,this.dtype,r)}bufferSync(){return E0.buffer(this.shape,this.dtype,this.dataSync())}async array(){const r=await this.data();return dt(this.shape,r,this.dtype==="complex64")}arraySync(){return dt(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const r=Mc().read(this.dataId);if(this.dtype==="string"){const o=await r;try{return o.map(c=>Tc(c))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return r}dataToGPU(r){return this.throwIfDisposed(),Mc().readToGPU(this.dataId,r)}dataSync(){this.throwIfDisposed();const r=Mc().readSync(this.dataId);if(this.dtype==="string")try{return r.map(o=>Tc(o))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return r}async bytes(){this.throwIfDisposed();const r=await Mc().read(this.dataId);return this.dtype==="string"?r:new Uint8Array(r.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Mc().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(r=!1){return E0.print(this,r)}clone(){return this.throwIfDisposed(),E0.clone(this)}toString(r=!1){const o=this.dataSync();return ioe(o,this.shape,this.dtype,r)}cast(r){return this.throwIfDisposed(),E0.cast(this,r)}variable(r=!0,o,c){return this.throwIfDisposed(),Mc().makeVariable(this,r,o,c)}}Object.defineProperty(gs,Symbol.hasInstance,{value:a=>!!a&&a.data!=null&&a.dataSync!=null&&a.throwIfDisposed!=null});function lt(){return Re("Tensor",()=>gs)}lt();class Tw extends gs{constructor(r,o,c,h){super(r.shape,r.dtype,r.dataId,h),this.trainable=o,this.name=c}assign(r){if(r.dtype!==this.dtype)throw new Error(`dtype of the new value (${r.dtype}) and previous value (${this.dtype}) must match`);if(!R(r.shape,this.shape))throw new Error(`shape of the new value (${r.shape}) and previous value (${this.shape}) must match`);Mc().disposeTensor(this),this.dataId=r.dataId,Mc().incRef(this,null)}dispose(){Mc().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Tw,Symbol.hasInstance,{value:a=>a instanceof gs&&a.assign!=null&&a.assign instanceof Function});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var yU;(function(a){a.R0="R0",a.R1="R1",a.R2="R2",a.R3="R3",a.R4="R4",a.R5="R5",a.R6="R6"})(yU||(yU={}));var hM;(function(a){a.float32="float32",a.int32="int32",a.bool="int32",a.complex64="complex64"})(hM||(hM={}));var dM;(function(a){a.float32="float32",a.int32="int32",a.bool="bool",a.complex64="complex64"})(dM||(dM={}));var fM;(function(a){a.float32="float32",a.int32="float32",a.bool="float32",a.complex64="complex64"})(fM||(fM={}));var pM;(function(a){a.float32="complex64",a.int32="complex64",a.bool="complex64",a.complex64="complex64"})(pM||(pM={}));const aoe={float32:fM,int32:hM,bool:dM,complex64:pM};function Ua(a,r){if(a==="string"||r==="string"){if(a==="string"&&r==="string")return"string";throw new Error(`Can not upcast ${a} with ${r}`)}return aoe[a][r]}function mM(a){return Ua(a,"int32")}function AU(a){return a!=null&&typeof a=="object"&&"texture"in a&&a.texture instanceof WebGLTexture}function vU(a){return typeof GPUBuffer<"u"&&a!=null&&typeof a=="object"&&"buffer"in a&&a.buffer instanceof GPUBuffer}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wr(a,r){if(a.dtype===r.dtype)return[a,r];const o=Ua(a.dtype,r.dtype);return[a.cast(o),r.cast(o)]}function bU(a){const r=[];return xU(a,r,new Set),r}function xU(a,r,o){if(a==null)return;if(a instanceof gs){r.push(a);return}if(!loe(a))return;const c=a;for(const h in c){const f=c[h];o.has(f)||(o.add(f),xU(f,r,o))}}function loe(a){return Array.isArray(a)||typeof a=="object"}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gM(a){return a.kernelName!=null}class wU{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(r=>r.name)))}}}dispose(){for(const r in this.registeredVariables)this.registeredVariables[r].dispose()}}class _0{constructor(r){this.ENV=r,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new wU}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const r=this.getSortedBackends();for(let o=0;o<r.length;o++){const c=r[o];if(await this.initializeBackend(c).success){await this.setBackend(c);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:r,asyncInit:o}=this.initializeBackendsAndReturnBest();if(o)throw new Error(`The highest priority backend '${r}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(r)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(r){if(!(r in this.registry))if(r in this.registryFactory){const{asyncInit:o}=this.initializeBackend(r);if(o)return null}else return null;return this.registry[r]}findBackendFactory(r){return r in this.registryFactory?this.registryFactory[r].factory:null}registerBackend(r,o,c=1){return r in this.registryFactory?(Ks(`${r} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[r]={factory:o,priority:c},!0)}async setBackend(r){if(this.registryFactory[r]==null)throw new Error(`Backend name '${r}' not found in registry`);if(this.backendName=r,this.registry[r]==null){this.backendInstance=null;const{success:o,asyncInit:c}=this.initializeBackend(r);if(!(c?await o:o))return!1}return this.backendInstance=this.registry[r],this.setupRegisteredKernels(),this.profiler=new Gr(this.backendInstance),!0}setupRegisteredKernels(){om(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(r){om(r).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[r])})}initializeBackend(r){const o=this.registryFactory[r];if(o==null)throw new Error(`Cannot initialize backend ${r}, no registration found.`);try{const c=o.factory();if(c&&!(c instanceof s)&&typeof c.then=="function"){const h=++this.pendingBackendInitId,f=c.then(m=>h<this.pendingBackendInitId?!1:(this.registry[r]=m,this.pendingBackendInit=null,!0)).catch(m=>(h<this.pendingBackendInitId||(this.pendingBackendInit=null,Ks(`Initialization of backend ${r} failed`),Ks(m.stack||m.message)),!1));return this.pendingBackendInit=f,{success:f,asyncInit:!0}}else return this.registry[r]=c,{success:!0,asyncInit:!1}}catch(c){return Ks(`Initialization of backend ${r} failed`),Ks(c.stack||c.message),{success:!1,asyncInit:!1}}}removeBackend(r){if(!(r in this.registryFactory))throw new Error(`${r} backend not found in registry`);this.backendName===r&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,r in this.registry&&(this.disposeRegisteredKernels(r),this.registry[r].dispose(),delete this.registry[r]),delete this.registryFactory[r],this.backendName===r&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((r,o)=>this.registryFactory[o].priority-this.registryFactory[r].priority)}initializeBackendsAndReturnBest(){const r=this.getSortedBackends();for(let o=0;o<r.length;o++){const c=r[o],{success:h,asyncInit:f}=this.initializeBackend(c);if(f||h)return{name:c,asyncInit:f}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(r,o){const c=this.state.tensorInfo.get(o),h=c.backend,f=this.readSync(o),m=h.refCount(o);h.disposeData(o,!0),c.backend=r,r.move(o,f,c.shape,c.dtype,m),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(r,o){let c=null;if(o==null){if(typeof r!="function")throw new Error("Please provide a function to tidy()");o=r}else{if(typeof r!="string"&&!(r instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof o!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");c=r}let h;return this.scopedRun(()=>this.startScope(c),()=>this.endScope(h),()=>(h=o(),h instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),h))}scopedRun(r,o,c){r();try{const h=c();return o(),h}catch(h){throw o(),h}}nextTensorId(){return _0.nextTensorId++}nextVariableId(){return _0.nextVariableId++}clone(r){const o=Ve.runKernel(hs,{x:r}),c={x:r},h=m=>({x:()=>{const y="float32",A={x:m},w={dtype:y};return Ve.runKernel(Jt,A,w)}}),f=[];return this.addTapeNode(this.state.activeScope.name,c,[o],h,f,{}),o}runKernel(r,o,c){if(this.backendName==null&&this.backend,v0(r,this.backendName)==null)throw new Error(`Kernel '${r}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:r,inputs:o,attrs:c})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(r,o,c){const h=this.backend.numDataIds();let f=0;c.forEach(A=>{f+=A.dtype==="complex64"?3:1});const m=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],y=h-o-f-m;if(y>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${y} data ids) after running '${r}'`)}runKernelFunc(r){let o,c=[];const h=this.isTapeOn(),f=this.state.numBytes,m=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let y;this.backendName==null&&this.backend;let A;const w=gM(r)?r.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(gM(r)){const{kernelName:O,inputs:U,attrs:W}=r;this.backendName==null&&this.backend;const z=v0(O,this.backendName);b(z!=null,()=>`Cannot find registered kernel '${O}' for backend '${this.backendName}'`),y=()=>{const X=this.backend.numDataIds();A=z.kernelFunc({inputs:U,attrs:W,backend:this.backend});const re=Array.isArray(A)?A:[A];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(O,X,re);const se=re.map(le=>le.rank!=null?le:this.makeTensorFromTensorInfo(le));if(h){const le=this.getTensorsForGradient(O,U,se);c=this.saveTensorsForBackwardMode(le)}return se}}else{const{forwardFunc:O}=r,U=W=>{h&&(c=W.map(z=>this.keep(this.clone(z))))};y=()=>{const W=this.backend.numDataIds();A=this.tidy(()=>O(this.backend,U));const z=Array.isArray(A)?A:[A];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(w,W,z),z}}const{inputs:C,attrs:_}=r,T=gM(r)?null:r.backwardsFunc;let B;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?o=y():(B=this.profiler.profileKernel(w,C,()=>y()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(B),o=B.outputs)}),h&&this.addTapeNode(w,C,o,T,c,_),this.state.profiling&&this.state.activeProfile.kernels.push({name:w,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-m,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(C).map(O=>C[O]!=null?C[O].shape:null),outputShapes:o.map(O=>O.shape),kernelTimeMs:B.timeMs,extraInfo:B.extraInfo}),Array.isArray(A)?o:o[0]}saveTensorsForBackwardMode(r){return r.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(r,o,c){const h=vw(r);if(h!=null){const f=h.inputsToSave||[],m=h.outputsToSave||[];let y;h.saveAllInputs?(b(Array.isArray(o),()=>"saveAllInputs is true, expected inputs to be an array."),y=Object.keys(o).map(w=>o[w])):y=f.map(w=>o[w]);const A=c.filter((w,C)=>m[C]);return y.concat(A)}return[]}makeTensor(r,o,c,h){if(r==null)throw new Error("Values passed to engine.makeTensor() are null");c=c||"float32",h=h||this.backend;let f=r;c==="string"&&we(r[0])&&(f=r.map(A=>Tu(A)));const m=h.write(f,o,c),y=new gs(o,c,m,this.nextTensorId());if(this.trackTensor(y,h),c==="string"){const A=this.state.tensorInfo.get(m),w=oe(f);this.state.numBytes+=w-A.bytes,A.bytes=w}return y}makeTensorFromDataId(r,o,c,h){c=c||"float32";const f={dataId:r,shape:o,dtype:c};return this.makeTensorFromTensorInfo(f,h)}makeTensorFromTensorInfo(r,o){const{dataId:c,shape:h,dtype:f}=r,m=new gs(h,f,c,this.nextTensorId());return this.trackTensor(m,o),m}makeVariable(r,o=!0,c,h){c=c||this.nextVariableId().toString(),h!=null&&h!==r.dtype&&(r=r.cast(h));const f=new Tw(r,o,c,this.nextTensorId());if(this.state.registeredVariables[f.name]!=null)throw new Error(`Variable with name ${f.name} was already registered`);return this.state.registeredVariables[f.name]=f,this.incRef(f,this.backend),f}trackTensor(r,o){this.state.numTensors++,r.dtype==="string"&&this.state.numStringTensors++;let c=0;r.dtype!=="complex64"&&r.dtype!=="string"&&(c=r.size*de(r.dtype)),this.state.numBytes+=c,this.state.tensorInfo.has(r.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(r.dataId,{backend:o||this.backend,dtype:r.dtype,shape:r.shape,bytes:c})),r instanceof Tw||this.track(r)}incRef(r,o){this.trackTensor(r,o),this.backend.incRef(r.dataId)}removeDataId(r,o){this.state.tensorInfo.has(r)&&this.state.tensorInfo.get(r).backend===o&&(this.state.tensorInfo.delete(r),this.state.numDataBuffers--)}disposeTensor(r){if(!this.state.tensorInfo.has(r.dataId))return;const o=this.state.tensorInfo.get(r.dataId);if(this.state.numTensors--,r.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=o.bytes),r.dtype!=="complex64"&&r.dtype!=="string"){const c=r.size*de(r.dtype);this.state.numBytes-=c}o.backend.disposeData(r.dataId)&&this.removeDataId(r.dataId,o.backend)}disposeVariables(){for(const r in this.state.registeredVariables){const o=this.state.registeredVariables[r];this.disposeVariable(o)}}disposeVariable(r){this.disposeTensor(r),this.state.registeredVariables[r.name]!=null&&delete this.state.registeredVariables[r.name]}memory(){const r=this.backend.memory();return r.numTensors=this.state.numTensors,r.numDataBuffers=this.state.numDataBuffers,r.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(r.unreliable=!0,r.reasons==null&&(r.reasons=[]),r.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),r}async profile(r){this.state.profiling=!0;const o=this.state.numBytes,c=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await r(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(h=>h.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-o,this.state.activeProfile.newTensors=this.state.numTensors-c;for(const h of this.state.activeProfile.kernels)h.kernelTimeMs=await h.kernelTimeMs,h.extraInfo=await h.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(r,o,c,h,f,m){const y={id:this.state.nextTapeNodeId++,kernelName:r,inputs:o,outputs:c,saved:f},A=vw(r);A!=null&&(h=A.gradFunc),h!=null&&(y.gradient=w=>(w=w.map((C,_)=>{if(C==null){const T=c[_],B=At(T.size,T.dtype);return this.makeTensor(B,T.shape,T.dtype)}return C}),h(w.length>1?w:w[0],f,m))),this.state.activeTape.push(y)}keep(r){return r.kept=!0,r}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(r){const o={track:[],name:"unnamed scope",id:this.state.nextScopeId++};r&&(o.name=r),this.state.scopeStack.push(o),this.state.activeScope=o}endScope(r){const o=bU(r),c=new Set(o.map(f=>f.id));for(let f=0;f<this.state.activeScope.track.length;f++){const m=this.state.activeScope.track[f];!m.kept&&!c.has(m.id)&&m.dispose()}const h=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],o.forEach(f=>{!f.kept&&f.scopeId===h.id&&this.track(f)})}gradients(r,o,c,h=!1){if(b(o.length>0,()=>"gradients() received an empty list of xs."),c!=null&&c.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${c.dtype}'`);const f=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",r));b(f instanceof gs,()=>"The result y returned by f() must be a tensor.");const m=cM(this.state.activeTape,o,f);if(!h&&m.length===0&&o.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const y={};y[f.id]=c??coe(f.shape),uM(y,m,w=>this.tidy(w),uoe);const A=o.map(w=>y[w.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(w=>{for(const C of w.saved)C.dispose()}),this.state.activeTape=null),{value:f,grads:A}})}customGrad(r){return b(Ae(r),()=>"The f passed in customGrad(f) must be a function."),(...o)=>{b(o.every(y=>y instanceof gs),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let c;const h={};o.forEach((y,A)=>{h[A]=y});const f=(y,A)=>(c=r(...o,A),b(c.value instanceof gs,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),b(Ae(c.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),c.value),m=(y,A)=>{const w=c.gradFunc(y,A),C=Array.isArray(w)?w:[w];b(C.length===o.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),b(C.every(T=>T instanceof gs),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const _={};return C.forEach((T,B)=>{_[B]=()=>T}),_};return this.runKernelFunc({forwardFunc:f,backwardsFunc:m,inputs:h})}}readSync(r){return this.state.tensorInfo.get(r).backend.readSync(r)}read(r){return this.state.tensorInfo.get(r).backend.read(r)}readToGPU(r,o){return this.state.tensorInfo.get(r).backend.readToGPU(r,o)}async time(r){const o=ho(),c=await this.backend.time(r);return c.wallMs=ho()-o,c}track(r){return this.state.activeScope!=null&&(r.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(r)),r}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new wU;for(const r in this.registry)this.disposeRegisteredKernels(r),this.registry[r].dispose(),delete this.registry[r];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}_0.nextTensorId=0,_0.nextVariableId=0;function coe(a){const r=xt(M(a),"float32");return Ve.makeTensor(r,a,"float32")}function CU(){const a=ce();if(a._tfengine==null){const r=new ht(a);a._tfengine=new _0(r)}return Y(a._tfengine.ENV),soe(()=>a._tfengine),a._tfengine}const Ve=CU();function uoe(a,r){const o={a,b:r};return Ve.runKernel(ve,o)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hoe(){return typeof navigator<"u"&&navigator!=null}function EU(a){if(a||hoe()){if(a||(a=navigator),a.product==="ReactNative")return!0;const r=a.userAgent||a.vendor||(typeof window<"u"?window.opera:"");if(!r){const o=a;return o.userAgentData&&o.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))}return!1}function _U(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ua=Te();ua.registerFlag("DEBUG",()=>!1,a=>{a&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),ua.registerFlag("IS_BROWSER",()=>_U()),ua.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),ua.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),ua.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),ua.registerFlag("PROD",()=>!1),ua.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ua.getBool("DEBUG")),ua.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),ua.registerFlag("IS_TEST",()=>!1),ua.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ua.getBool("DEBUG")),ua.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),ua.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),ua.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Av(a,r){let o=a;if(Va(a))return r==="string"?[]:[a.length];if(AU(a)){const h=a.channels||"RGBA";return[a.height,a.width*h.length]}else if(vU(a))return[a.buffer.size/(r==null?4:de(r))];if(!Array.isArray(a))return[];const c=[];for(;Array.isArray(o)||Va(o)&&r!=="string";)c.push(o.length),o=o[0];return Array.isArray(a)&&Te().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&IU(a,c,[]),c}function IU(a,r,o){if(o=o||[],!Array.isArray(a)&&!Va(a)){b(r.length===0,()=>`Element arr[${o.join("][")}] is a primitive, but should be an array/TypedArray of ${r[0]} elements`);return}b(r.length>0,()=>`Element arr[${o.join("][")}] should be a primitive, but is an array of ${a.length} elements`),b(a.length===r[0],()=>`Element arr[${o.join("][")}] should have ${r[0]} elements, but has ${a.length} elements`);const c=r.slice(1);for(let h=0;h<a.length;++h)IU(a[h],c,o.concat(h))}function SU(a,r,o,c){if(a!=="string_or_numeric"){if(a==null)throw new Error("Expected dtype cannot be null.");if(a!=="numeric"&&a!==r||a==="numeric"&&r==="string")throw new Error(`Argument '${o}' passed to '${c}' must be ${a} tensor, but got ${r} tensor`)}}function ke(a,r,o,c="numeric"){if(a instanceof lt())return SU(c,a.dtype,r,o),a;let h=Ne(a);if(h!=="string"&&["bool","int32","float32"].indexOf(c)>=0&&(h=c),SU(c,h,r,o),a==null||!Va(a)&&!Array.isArray(a)&&typeof a!="number"&&typeof a!="boolean"&&typeof a!="string"){const y=a==null?"null":a.constructor.name;throw new Error(`Argument '${r}' passed to '${o}' must be a Tensor or TensorLike, but got '${y}'`)}const f=Av(a,h);!Va(a)&&!Array.isArray(a)&&(a=[a]);const m=h!=="string"?Uh(a,h):Mu(a,[],!0);return Ve.makeTensor(m,f,h)}function TU(a,r,o,c="numeric"){if(!Array.isArray(a))throw new Error(`Argument ${r} passed to ${o} must be a \`Tensor[]\` or \`TensorLike[]\``);return a.map((h,f)=>ke(h,`${r}[${f}]`,o,c))}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const doe="__op";function He(a){const r=Object.keys(a);if(r.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${r.length} keys.`);let o=r[0];const c=a[o];o.endsWith("_")&&(o=o.substring(0,o.length-1)),o=o+doe;const h=(...f)=>{Ve.startScope(o);try{const m=c(...f);return Lt(m)&&console.error("Cannot return a Promise inside of tidy."),Ve.endScope(m),m}catch(m){throw Ve.endScope(null),m}};return Object.defineProperty(h,"name",{value:o,configurable:!0}),h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function foe(a,r){const o=ke(a,"real","complex"),c=ke(r,"imag","complex");E(o.shape,c.shape,`real and imag shapes, ${o.shape} and ${c.shape}, must match in call to tf.complex().`);const h={real:o,imag:c};return Ve.runKernel(ar,h)}const I0=He({complex_:foe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vv(a,r,o,c){if(c==null)c=Ne(a);else if(c==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(vU(a)||AU(a)){if(c!=="float32"&&c!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${c}.`);return Ve.backend.createTensorFromGPUData(a,r||o,c)}if(!Va(a)&&!Array.isArray(a)&&typeof a!="number"&&typeof a!="boolean"&&typeof a!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(r!=null){Et(r);const h=M(r),f=M(o);b(h===f,()=>`Based on the provided shape, [${r}], the tensor should have ${h} values but has ${f}`);for(let m=0;m<o.length;++m){const y=o[m],A=m===o.length-1?y!==M(r.slice(m)):!0;b(o[m]===r[m]||!A,()=>`Error creating a new Tensor. Inferred shape (${o}) does not match the provided shape (${r}). `)}}return!Va(a)&&!Array.isArray(a)&&(a=[a]),r=r||o,a=c!=="string"?Uh(a,c):Mu(a,[],!0),Ve.makeTensor(a,r,c)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pl(a,r,o){const c=Av(a,o);return vv(a,r,c,o)}class S0{static join(r){return new S0(r).slice()}constructor(r){if(this.shards=[],this.previousShardIndex=0,r==null||(r instanceof Array||(r=[r]),r=r.map(c=>Va(c)?c.buffer:c),r.length===0))return;this.bufferUniformSize=r[0].byteLength;let o=0;for(let c=0;c<r.length;c++){const h=r[c];c!==r.length-1&&h.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const f=o+h.byteLength;this.shards.push({buffer:h,start:o,end:f}),o=f}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(r=0,o=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(r=isNaN(Number(r))?0:r,o=isNaN(Number(o))?0:o,r=Math.max(0,r),o=Math.min(this.byteLength,o),o<=r)return new ArrayBuffer(0);const c=this.findShardForByte(r);if(c===-1)throw new Error(`Could not find start shard for byte ${r}`);const h=o-r,f=new ArrayBuffer(h),m=new Uint8Array(f);let y=0;for(let A=c;A<this.shards.length;A++){const w=this.shards[A],C=r+y-w.start,_=y,T=Math.min(o,w.end)-w.start,B=new Uint8Array(w.buffer,C,T-C);if(m.set(B,_),y+=B.length,o<w.end)break}return f}findShardForByte(r){if(this.shards.length===0||r<0||r>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(r/this.bufferUniformSize),this.previousShardIndex;function o(h){return r<h.start?-1:r>=h.end?1:0}if(o(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const c=poe(this.shards,o);return c===-1?-1:(this.previousShardIndex=c,this.previousShardIndex)}}function poe(a,r){let o=0,c=a.length;for(;o<=c;){const h=Math.floor((c-o)/2)+o,f=r(a[h]);if(f===0)return h;f<0?c=h:o=h+1}return-1}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cr(){return Ve}function yM(){return Ve.memory()}function Qe(a,r){return Ve.tidy(a,r)}function vi(a){bU(a).forEach(r=>r.dispose())}function ml(a){return Ve.keep(a)}function MU(a,r,o=1){return Ve.registerBackend(a,r,o)}function uf(){return Ve.backend}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kU=4;async function RU(a,r){const o=[],c=[],h=Array.isArray(a)?a.map(m=>m.name):Object.keys(a);for(let m=0;m<h.length;++m){const y=h[m],A=Array.isArray(a)?a[m].tensor:a[y];if(A.dtype!=="float32"&&A.dtype!=="int32"&&A.dtype!=="bool"&&A.dtype!=="string"&&A.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${y}': ${A.dtype}`);const w={name:y,shape:A.shape,dtype:A.dtype};if(A.dtype==="string"){const C=new Promise(async _=>{const T=await A.bytes(),B=T.reduce((W,z)=>W+z.length,0)+kU*T.length,O=new Uint8Array(B);let U=0;for(let W=0;W<T.length;W++){const z=T[W],X=new Uint8Array(new Uint32Array([z.length]).buffer);O.set(X,U),U+=kU,O.set(z,U),U+=z.length}_(O)});c.push(C)}else c.push(A.data());r!=null&&(w.group=r),o.push(w)}const f=await Promise.all(c);return{data:moe(f),specs:o}}function moe(a){if(a===null)throw new Error(`Invalid input value: ${JSON.stringify(a)}`);let r=0;const o=[];a.forEach(f=>{if(r+=f.byteLength,o.push(f.byteLength===f.buffer.byteLength?f:new f.constructor(f)),!(f instanceof Float32Array||f instanceof Int32Array||f instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${f.constructor.name}`)});const c=new Uint8Array(r);let h=0;return o.forEach(f=>{c.set(new Uint8Array(f.buffer),h),h+=f.byteLength}),c.buffer}const AM=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function LU(a){return AM?Buffer.byteLength(a,"utf8"):new Blob([a]).size}function goe(a){if(AM)return Buffer.from(a).toString("base64");const r=new Uint8Array(a);let o="";for(let c=0,h=r.length;c<h;c++)o+=String.fromCharCode(r[c]);return btoa(o)}function yoe(a){if(AM){const c=Buffer.from(a,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}const r=atob(a),o=new Uint8Array(r.length);for(let c=0;c<r.length;++c)o.set([r.charCodeAt(c)],c);return o.buffer}function Aoe(a){return S0.join(a)}function BU(a){if(a.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:a.modelTopology==null?0:LU(JSON.stringify(a.modelTopology)),weightSpecsBytes:a.weightSpecs==null?0:LU(JSON.stringify(a.weightSpecs)),weightDataBytes:a.weightData==null?0:new S0(a.weightData).byteLength}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Lo{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Lo.instance==null&&(Lo.instance=new Lo),Lo.instance}static registerSaveRouter(r){Lo.getInstance().saveRouters.push(r)}static registerLoadRouter(r){Lo.getInstance().loadRouters.push(r)}static getSaveHandlers(r){return Lo.getHandlers(r,"save")}static getLoadHandlers(r,o){return Lo.getHandlers(r,"load",o)}static getHandlers(r,o,c){const h=[];return(o==="load"?Lo.getInstance().loadRouters:Lo.getInstance().saveRouters).forEach(f=>{const m=f(r,c);m!==null&&h.push(m)}),h}}const voe=a=>Lo.getSaveHandlers(a);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vM="tensorflowjs",bM=1,cm="models_store",hf="model_info_store";function PU(){if(!Te().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const a=typeof window>"u"?self:window,r=a.indexedDB||a.mozIndexedDB||a.webkitIndexedDB||a.msIndexedDB||a.shimIndexedDB;if(r==null)throw new Error("The current browser does not appear to support IndexedDB.");return r}function xM(a){const r=a.result;r.createObjectStore(cm,{keyPath:"modelPath"}),r.createObjectStore(hf,{keyPath:"modelPath"})}class um{constructor(r){if(this.indexedDB=PU(),r==null||!r)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=r}async save(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,r)}async load(){return this.databaseAction(this.modelPath)}databaseAction(r,o){return new Promise((c,h)=>{const f=this.indexedDB.open(vM,bM);f.onupgradeneeded=()=>xM(f),f.onsuccess=()=>{const m=f.result;if(o==null){const y=m.transaction(cm,"readonly"),A=y.objectStore(cm).get(this.modelPath);A.onsuccess=()=>{if(A.result==null)return m.close(),h(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));c(A.result.modelArtifacts)},A.onerror=w=>(m.close(),h(A.error)),y.oncomplete=()=>m.close()}else{o.weightData=S0.join(o.weightData);const y=BU(o),A=m.transaction(hf,"readwrite");let w=A.objectStore(hf),C;try{C=w.put({modelPath:this.modelPath,modelArtifactsInfo:y})}catch(T){return h(T)}let _;C.onsuccess=()=>{_=m.transaction(cm,"readwrite");const T=_.objectStore(cm);let B;try{B=T.put({modelPath:this.modelPath,modelArtifacts:o,modelArtifactsInfo:y})}catch(O){return h(O)}B.onsuccess=()=>c({modelArtifactsInfo:y}),B.onerror=O=>{w=A.objectStore(hf);const U=w.delete(this.modelPath);U.onsuccess=()=>(m.close(),h(B.error)),U.onerror=W=>(m.close(),h(B.error))}},C.onerror=T=>(m.close(),h(C.error)),A.oncomplete=()=>{_==null?m.close():_.oncomplete=()=>m.close()}}},f.onerror=m=>h(f.error)})}}um.URL_SCHEME="indexeddb://";const NU=a=>Te().getBool("IS_BROWSER")&&!Array.isArray(a)&&a.startsWith(um.URL_SCHEME)?boe(a.slice(um.URL_SCHEME.length)):null;Lo.registerSaveRouter(NU),Lo.registerLoadRouter(NU);function boe(a){return new um(a)}function xoe(a){return a.startsWith(um.URL_SCHEME)?a.slice(um.URL_SCHEME.length):a}class woe{constructor(){this.indexedDB=PU()}async listModels(){return new Promise((r,o)=>{const c=this.indexedDB.open(vM,bM);c.onupgradeneeded=()=>xM(c),c.onsuccess=()=>{const h=c.result,f=h.transaction(hf,"readonly"),m=f.objectStore(hf).getAll();m.onsuccess=()=>{const y={};for(const A of m.result)y[A.modelPath]=A.modelArtifactsInfo;r(y)},m.onerror=y=>(h.close(),o(m.error)),f.oncomplete=()=>h.close()},c.onerror=h=>o(c.error)})}async removeModel(r){return r=xoe(r),new Promise((o,c)=>{const h=this.indexedDB.open(vM,bM);h.onupgradeneeded=()=>xM(h),h.onsuccess=()=>{const f=h.result,m=f.transaction(hf,"readwrite"),y=m.objectStore(hf),A=y.get(r);let w;A.onsuccess=()=>{if(A.result==null)return f.close(),c(new Error(`Cannot find model with path '${r}' in IndexedDB.`));{const C=y.delete(r),_=()=>{w=f.transaction(cm,"readwrite");const T=w.objectStore(cm).delete(r);T.onsuccess=()=>o(A.result.modelArtifactsInfo),T.onerror=B=>c(A.error)};C.onsuccess=_,C.onerror=T=>(_(),f.close(),c(A.error))}},A.onerror=C=>(f.close(),c(A.error)),m.oncomplete=()=>{w==null?f.close():w.oncomplete=()=>f.close()}},h.onerror=f=>c(h.error)})}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zh="/",T0="tensorflowjs_models",DU="info",Coe="model_topology",Eoe="weight_specs",_oe="weight_data",Ioe="model_metadata";function FU(a){return{info:[T0,a,DU].join(zh),topology:[T0,a,Coe].join(zh),weightSpecs:[T0,a,Eoe].join(zh),weightData:[T0,a,_oe].join(zh),modelMetadata:[T0,a,Ioe].join(zh)}}function OU(a){for(const r of Object.values(a))window.localStorage.removeItem(r)}function Soe(a){const r=a.split(zh);if(r.length<3)throw new Error(`Invalid key format: ${a}`);return r.slice(1,r.length-1).join(zh)}function Toe(a){return a.startsWith(hm.URL_SCHEME)?a.slice(hm.URL_SCHEME.length):a}class hm{constructor(r){if(!Te().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,r==null||!r)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=r,this.keys=FU(this.modelPath)}async save(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const o=JSON.stringify(r.modelTopology),c=JSON.stringify(r.weightSpecs),h=BU(r),f=S0.join(r.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(h)),this.LS.setItem(this.keys.topology,o),this.LS.setItem(this.keys.weightSpecs,c),this.LS.setItem(this.keys.weightData,goe(f));const m={format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,signature:r.signature!=null?r.signature:void 0,userDefinedMetadata:r.userDefinedMetadata!=null?r.userDefinedMetadata:void 0,modelInitializer:r.modelInitializer!=null?r.modelInitializer:void 0,initializerSignature:r.initializerSignature!=null?r.initializerSignature:void 0,trainingConfig:r.trainingConfig!=null?r.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(m)),{modelArtifactsInfo:h}}catch{throw OU(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${h.modelTopologyBytes}, weightSpecsBytes=${h.weightSpecsBytes}, weightDataBytes=${h.weightDataBytes}.`)}}}async load(){const r=JSON.parse(this.LS.getItem(this.keys.info));if(r==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(r.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const o={},c=JSON.parse(this.LS.getItem(this.keys.topology));if(c==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);o.modelTopology=c;const h=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(h==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);o.weightSpecs=h;const f=this.LS.getItem(this.keys.modelMetadata);if(f!=null){const y=JSON.parse(f);o.format=y.format,o.generatedBy=y.generatedBy,o.convertedBy=y.convertedBy,y.signature!=null&&(o.signature=y.signature),y.userDefinedMetadata!=null&&(o.userDefinedMetadata=y.userDefinedMetadata),y.modelInitializer!=null&&(o.modelInitializer=y.modelInitializer),y.initializerSignature!=null&&(o.initializerSignature=y.initializerSignature),y.trainingConfig!=null&&(o.trainingConfig=y.trainingConfig)}const m=this.LS.getItem(this.keys.weightData);if(m==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return o.weightData=yoe(m),o}}hm.URL_SCHEME="localstorage://";const VU=a=>Te().getBool("IS_BROWSER")&&!Array.isArray(a)&&a.startsWith(hm.URL_SCHEME)?Moe(a.slice(hm.URL_SCHEME.length)):null;Lo.registerSaveRouter(VU),Lo.registerLoadRouter(VU);function Moe(a){return new hm(a)}class koe{constructor(){b(Te().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),b(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const r={},o=T0+zh,c=zh+DU;for(let h=0;h<this.LS.length;++h){const f=this.LS.key(h);if(f.startsWith(o)&&f.endsWith(c)){const m=Soe(f);r[m]=JSON.parse(this.LS.getItem(f))}}return r}async removeModel(r){r=Toe(r);const o=FU(r);if(this.LS.getItem(o.info)==null)throw new Error(`Cannot find model at path '${r}'`);const c=JSON.parse(this.LS.getItem(o.info));return OU(o),c}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UU="://";class ku{constructor(){this.managers={}}static getInstance(){return ku.instance==null&&(ku.instance=new ku),ku.instance}static registerManager(r,o){b(r!=null,()=>"scheme must not be undefined or null."),r.endsWith(UU)&&(r=r.slice(0,r.indexOf(UU))),b(r.length>0,()=>"scheme must not be an empty string.");const c=ku.getInstance();b(c.managers[r]==null,()=>`A model store manager is already registered for scheme '${r}'.`),c.managers[r]=o}static getManager(r){const o=ku.getInstance().managers[r];if(o==null)throw new Error(`Cannot find model manager for scheme '${r}'`);return o}static getSchemes(){return Object.keys(ku.getInstance().managers)}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Roe{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(r,o){return fetch(r,o)}now(){return performance.now()}encode(r,o){if(o!=="utf-8"&&o!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${o}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(r)}decode(r,o){return new TextDecoder(o).decode(r)}setTimeoutCustom(r,o){if(typeof window>"u"||!Te().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(r,o);return}this.functionRefs.push(r),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},o),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",c=>{if(c.source===window&&c.data.name===this.messageName){c.stopPropagation();const h=this.functionRefs[c.data.index];h(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(r){return lv(r)}}if(Te().get("IS_BROWSER")){Te().setPlatform("browser",new Roe);try{ku.registerManager(hm.URL_SCHEME,new koe)}catch{}try{ku.registerManager(um.URL_SCHEME,new woe)}catch{}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Loe={importFetch:()=>PJe()};let wM;class Boe{constructor(){this.util=FJe,this.textEncoder=new this.util.TextEncoder}fetch(r,o){return Te().global.fetch!=null?Te().global.fetch(r,o):(wM==null&&(wM=Loe.importFetch()),wM(r,o))}now(){const r=process.hrtime();return r[0]*1e3+r[1]/1e6}encode(r,o){if(o!=="utf-8"&&o!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${o}`);return this.textEncoder.encode(r)}decode(r,o){return r.length===0?"":new this.util.TextDecoder(o).decode(r)}isTypedArray(r){return this.util.types.isFloat32Array(r)||this.util.types.isInt32Array(r)||this.util.types.isUint8Array(r)||this.util.types.isUint8ClampedArray(r)}}Te().get("IS_NODE")&&!Te().get("IS_BROWSER")&&Te().setPlatform("node",new Boe);/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yi(a,r="float32",o){return r=r||"float32",Et(a),new Zs(a,r,o)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Poe(a,r){const o=ke(a,"x","cast");if(!j(r))throw new Error(`Failed to cast to unknown dtype ${r}`);if(r==="string"&&o.dtype!=="string"||r!=="string"&&o.dtype==="string")throw new Error("Only strings can be casted to strings");const c={x:o},h={dtype:r};return Ve.runKernel(Jt,c,h)}const pn=He({cast_:Poe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Noe(a){const r={x:ke(a,"x","clone","string_or_numeric")};return Ve.runKernel(hs,r)}const dm=He({clone_:Noe});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Doe(a,r=!1){console.log(a.toString(r))}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/CU(),ooe({buffer:yi,cast:pn,clone:dm,print:Doe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Foe(a,r){let o=ke(a,"a","add"),c=ke(r,"b","add");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(ve,h)}const Ot=He({add_:Foe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ooe(a,r){let o=ke(a,"a","floorDiv"),c=ke(r,"b","floorDiv");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(Ht,h)}const zU=He({floorDiv_:Ooe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Voe(a,r){let o=ke(a,"a","div"),c=ke(r,"b","div");if([o,c]=Wr(o,c),o.dtype==="int32"&&c.dtype==="int32")return zU(o,c);const h={a:o,b:c},f={};return Ve.runKernel(Ge,h,f)}const Vn=He({div_:Voe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Uoe(a,r){let o=ke(a,"a","mul"),c=ke(r,"b","mul");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(Mo,h)}const Ue=He({mul_:Uoe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zoe(a){const r=ke(a,"x","abs");if(r.dtype==="complex64"){const o={x:r};return Ve.runKernel(ta,o)}else{const o={x:r};return Ve.runKernel(We,o)}}const Bo=He({abs_:zoe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Goe(a){const r={x:ke(a,"x","acos")};return Ve.runKernel(at,r)}const Woe=He({acos_:Goe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hoe(a){const r={x:ke(a,"x","acosh")};return Ve.runKernel(ln,r)}const Xoe=He({acosh_:Hoe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $oe(a,r=null,o=!1){const c={x:ke(a,"x","all","bool")},h={axis:r,keepDims:o};return Ve.runKernel(Oe,c,h)}const GU=He({all_:$oe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qoe(a,r=null,o=!1){const c={x:ke(a,"x","any","bool")},h={axis:r,keepDims:o};return Ve.runKernel(ut,c,h)}const CM=He({any_:Qoe});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Koe(a,r=0){const o={x:ke(a,"x","argMax")},c={axis:r};return Ve.runKernel(vt,o,c)}const bv=He({argMax_:Koe});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zoe(a,r=0){const o={x:ke(a,"x","argMin")},c={axis:r};return Ve.runKernel(pt,o,c)}const joe=He({argMin_:Zoe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yoe(a){const r={x:ke(a,"x","asin")};return Ve.runKernel(cn,r)}const qoe=He({asin_:Yoe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Joe(a){const r={x:ke(a,"x","asinh")};return Ve.runKernel(Tt,r)}const eae=He({asinh_:Joe});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tae(a){const r={x:ke(a,"x","atan")};return Ve.runKernel(Zt,r)}const nae=He({atan_:tae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iae(a,r){let o=ke(a,"a","atan2"),c=ke(r,"b","atan2");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(Ft,h)}const rae=He({atan2_:iae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sae(a){const r={x:ke(a,"x","atanh")};return Ve.runKernel(kn,r)}const oae=He({atanh_:sae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xv(a,r,o,c,h="NHWC",f){const m=a[3],y=[...r,m],A=Wh(h);return js(a,y,o,f,c,null,null,A)}function Hl(a,r,o,c,h,f,m="channelsLast"){const[y,A]=wv(r);let w;if(m==="channelsLast")w=[y,A,a[3],a[3]];else if(m==="channelsFirst")w=[y,A,a[1],a[1]];else throw new Error(`Unknown dataFormat ${m}`);return js(a,w,o,c,h,f,!1,m)}function Gh(a,r,o,c,h,f,m="NDHWC"){const[y,A,w]=_M(r);let C,_;if(m==="NDHWC")_="channelsLast",C=[y,A,w,a[4],a[4]];else if(m==="NCDHW")_="channelsFirst",C=[y,A,w,a[1],a[1]];else throw new Error(`Unknown dataFormat ${m}`);return df(a,C,o,c,h,!1,_,f)}function js(a,r,o,c,h,f,m=!1,y="channelsLast"){let[A,w,C,_]=[-1,-1,-1,-1];if(y==="channelsLast")[A,w,C,_]=a;else if(y==="channelsFirst")[A,_,w,C]=a;else throw new Error(`Unknown dataFormat ${y}`);const[T,B,,O]=r,[U,W]=wv(o),[z,X]=wv(c),re=M0(T,z),se=M0(B,X),{padInfo:le,outHeight:ge,outWidth:ye}=cae(h,w,C,U,W,re,se,f,y),be=m?O*_:O;let Se;return y==="channelsFirst"?Se=[A,be,ge,ye]:y==="channelsLast"&&(Se=[A,ge,ye,be]),{batchSize:A,dataFormat:y,inHeight:w,inWidth:C,inChannels:_,outHeight:ge,outWidth:ye,outChannels:be,padInfo:le,strideHeight:U,strideWidth:W,filterHeight:T,filterWidth:B,effectiveFilterHeight:re,effectiveFilterWidth:se,dilationHeight:z,dilationWidth:X,inShape:a,outShape:Se,filterShape:r}}function df(a,r,o,c,h,f=!1,m="channelsLast",y){let[A,w,C,_,T]=[-1,-1,-1,-1,-1];if(m==="channelsLast")[A,w,C,_,T]=a;else if(m==="channelsFirst")[A,T,w,C,_]=a;else throw new Error(`Unknown dataFormat ${m}`);const[B,O,U,,W]=r,[z,X,re]=_M(o),[se,le,ge]=_M(c),ye=M0(B,se),be=M0(O,le),Se=M0(U,ge),{padInfo:Be,outDepth:Ye,outHeight:et,outWidth:tt}=uae(h,w,C,_,z,X,re,ye,be,Se,y),ot=f?W*T:W;let st;return m==="channelsFirst"?st=[A,ot,Ye,et,tt]:m==="channelsLast"&&(st=[A,Ye,et,tt,ot]),{batchSize:A,dataFormat:m,inDepth:w,inHeight:C,inWidth:_,inChannels:T,outDepth:Ye,outHeight:et,outWidth:tt,outChannels:ot,padInfo:Be,strideDepth:z,strideHeight:X,strideWidth:re,filterDepth:B,filterHeight:O,filterWidth:U,effectiveFilterDepth:ye,effectiveFilterHeight:be,effectiveFilterWidth:Se,dilationDepth:se,dilationHeight:le,dilationWidth:ge,inShape:a,outShape:st,filterShape:r}}function aae(a,r,o,c,h){c==null&&(c=EM(a,r,o));const f=a[0],m=a[1],y=Cv((f-r+2*c)/o+1,h),A=Cv((m-r+2*c)/o+1,h);return[y,A]}function lae(a,r,o,c,h,f){h==null&&(h=EM(a,r[0],c[0]));const m=[0,0,0,o];for(let y=0;y<3;y++)a[y]+2*h>=r[y]&&(m[y]=Cv((a[y]-r[y]+2*h)/c[y]+1,f));return m}function EM(a,r,o,c=1){const h=M0(r,c);return Math.floor((a[0]*(o-1)-o+h)/2)}function wv(a){return typeof a=="number"?[a,a,a]:a.length===2?[a[0],a[1],1]:a}function _M(a){return typeof a=="number"?[a,a,a]:a}function M0(a,r){return r<=1?a:a+(a-1)*(r-1)}function cae(a,r,o,c,h,f,m,y,A){let w,C,_;if(typeof a=="number"){w={top:a,bottom:a,left:a,right:a,type:a===0?"VALID":"NUMBER"};const T=aae([r,o],f,c,a,y);C=T[0],_=T[1]}else if(a==="same"){C=Math.ceil(r/c),_=Math.ceil(o/h);const T=Math.max(0,(C-1)*c+f-r),B=Math.max(0,(_-1)*h+m-o),O=Math.floor(T/2),U=T-O,W=Math.floor(B/2),z=B-W;w={top:O,bottom:U,left:W,right:z,type:"SAME"}}else if(a==="valid")w={top:0,bottom:0,left:0,right:0,type:"VALID"},C=Math.ceil((r-f+1)/c),_=Math.ceil((o-m+1)/h);else if(typeof a=="object"){const T=A==="channelsLast"?a[1][0]:a[2][0],B=A==="channelsLast"?a[1][1]:a[2][1],O=A==="channelsLast"?a[2][0]:a[3][0],U=A==="channelsLast"?a[2][1]:a[3][1];w={top:T,bottom:B,left:O,right:U,type:T===0&&B===0&&O===0&&U===0?"VALID":"EXPLICIT"},C=Cv((r-f+T+B)/c+1,y),_=Cv((o-m+O+U)/h+1,y)}else throw Error(`Unknown padding parameter: ${a}`);return{padInfo:w,outHeight:C,outWidth:_}}function uae(a,r,o,c,h,f,m,y,A,w,C){let _,T,B,O;if(a==="valid"&&(a=0),typeof a=="number"){_={top:a,bottom:a,left:a,right:a,front:a,back:a,type:a===0?"VALID":"NUMBER"};const U=lae([r,o,c,1],[y,A,w],1,[h,f,m],a,C);T=U[0],B=U[1],O=U[2]}else if(a==="same"){T=Math.ceil(r/h),B=Math.ceil(o/f),O=Math.ceil(c/m);const U=(T-1)*h+y-r,W=(B-1)*f+A-o,z=(O-1)*m+w-c,X=Math.floor(U/2),re=U-X,se=Math.floor(W/2),le=W-se,ge=Math.floor(z/2),ye=z-ge;_={top:se,bottom:le,left:ge,right:ye,front:X,back:re,type:"SAME"}}else throw Error(`Unknown padding parameter: ${a}`);return{padInfo:_,outDepth:T,outHeight:B,outWidth:O}}function Cv(a,r){if(!r)return Math.trunc(a);switch(r){case"round":return Math.round(a);case"ceil":return Math.ceil(a);case"floor":return Math.floor(a);default:throw new Error(`Unknown roundingMode ${r}`)}}function fm(a){const[r,o,c]=wv(a);return r===1&&o===1&&c===1}function fo(a,r){return fm(a)||fm(r)}function pm(a){return wv(a).every(r=>r>0)}function Wh(a){if(a==="NHWC")return"channelsLast";if(a==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${a}`)}function ha(a,r,o){if(o!=null){if(typeof r=="string")throw Error(`Error in ${a}: pad must be an integer when using dimRoundingMode ${o} but got pad ${r}.`);if(typeof r=="number")b(P(r),()=>`Error in ${a}: pad must be an integer when using dimRoundingMode ${o} but got pad ${r}.`);else if(typeof r=="object")r.forEach(c=>{c.forEach(h=>{b(P(h),()=>`Error in ${a}: pad must be an integer when using dimRoundingMode ${o} but got pad ${h}.`)})});else throw Error(`Error in ${a}: Unknown padding parameter: ${r}`)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hae(a,r){const o={x:ke(a,"x","reshape","string_or_numeric")},c={shape:r};return Ve.runKernel(sa,o,c)}const Xe=He({reshape_:hae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dae(a,r,o,c,h){const f=ke(a,"x","avgPool","float32"),m=1;b(fo(o,m),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`);let y=f,A=!1;f.rank===3&&(A=!0,y=Xe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),b(y.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${y.rank}.`),ha("avgPool",c,h);const w={x:y},C={filterSize:r,strides:o,pad:c,dimRoundingMode:h};let _=Ve.runKernel(vn,w,C);return _=pn(_,f.dtype),A?Xe(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const IM=He({avgPool_:dae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fae(a,r,o,c,h,f="NDHWC"){const m=ke(a,"x","avgPool3d","float32");let y=m,A=!1;m.rank===4&&(A=!0,y=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]])),b(y.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${y.rank}.`),b(f==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${f}`),b(typeof o=="number"&&o>0||Array.isArray(o)&&o[0]>0&&o[1]>0&&o[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${o}'`),ha("avgPool3d",c,h);const w={x:y},C={filterSize:r,strides:o,pad:c,dimRoundingMode:h,dataFormat:f};let _=Ve.runKernel(Pe,w,C);return _=pn(_,y.dtype),A?Xe(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const pae=He({avgPool3d_:fae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mae(a,r=0){b(a.length>=1,()=>"Pass at least one tensor to concat");const o=TU(a,"tensors","concat","string_or_numeric");if(o[0].dtype==="complex64"&&o.forEach(f=>{if(f.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${f.dtype}. `)}),o.length===1)return dm(o[0]);const c=o,h={axis:r};return Ve.runKernel(yc,c,h)}const da=He({concat_:mae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gae(a,r,o=!1,c=!1){let h=ke(a,"a","matMul"),f=ke(r,"b","matMul");[h,f]=Wr(h,f);const m={a:h,b:f},y={transposeA:o,transposeB:c};return Ve.runKernel(Pt,m,y)}const $i=He({matMul_:gae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yae(a){const r={x:ke(a,"x","sigmoid","float32")};return Ve.runKernel(xi,r)}const k0=He({sigmoid_:yae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Aae(a,r,o){const c=ke(a,"x","slice","string_or_numeric");if(c.rank===0)throw new Error("Slicing scalar is not possible");const h={x:c},f={begin:r,size:o};return Ve.runKernel(Ke,h,f)}const ur=He({slice_:Aae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vae(a){const r={x:ke(a,"x","tanh","float32")};return Ve.runKernel(Fa,r)}const SM=He({tanh_:vae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bae(a,r,o){const c=ke(a,"x","batchToSpaceND"),h=r.reduce((y,A)=>y*A);b(c.rank>=1+r.length,()=>`input rank is ${c.rank} but should be > than blockShape.length ${r.length}`),b(o.length===r.length,()=>`crops.length is ${o.length} but should be equal to blockShape.length  ${r.length}`),b(c.shape[0]%h===0,()=>`input tensor batch is ${c.shape[0]} but is not divisible by the product of the elements of blockShape ${r.join(" * ")} === ${h}`);const f={x:c},m={blockShape:r,crops:o};return Ve.runKernel(Dt,f,m)}const TM=He({batchToSpaceND_:bae});function xae(a){let r;return a.rank===0||a.rank===1?r=Xe(a,[1,1,1,a.size]):a.rank===2?r=Xe(a,[1,1,a.shape[0],a.shape[1]]):a.rank===3?r=Xe(a,[1,a.shape[0],a.shape[1],a.shape[2]]):r=a,r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wae(a,r,o,c,h,f){f==null&&(f=.001);const m=ke(a,"x","batchNorm"),y=ke(r,"mean","batchNorm"),A=ke(o,"variance","batchNorm");let w;h!=null&&(w=ke(h,"scale","batchNorm"));let C;c!=null&&(C=ke(c,"offset","batchNorm")),b(y.rank===A.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b(C==null||y.rank===C.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b(w==null||y.rank===w.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const _={x:xae(m),scale:w,offset:C,mean:y,variance:A},T={varianceEpsilon:f},B=Ve.runKernel(jt,_,T);return Xe(B,m.shape)}const Mw=He({batchNorm_:wae});function Cae(a,r,o,c,h,f){const m=ke(a,"x","batchNorm"),y=ke(r,"mean","batchNorm"),A=ke(o,"variance","batchNorm");let w;h!=null&&(w=ke(h,"scale","batchNorm"));let C;return c!=null&&(C=ke(c,"offset","batchNorm")),b(m.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${m.rank}.`),b(y.rank===2||y.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${y.rank}.`),b(A.rank===2||A.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${A.rank}.`),w!=null&&b(w.rank===2||w.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${w.rank}.`),C!=null&&b(C.rank===2||C.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${C.rank}.`),Mw(m,y,A,C,w,f)}const Eae=He({batchNorm2d_:Cae});function _ae(a,r,o,c,h,f){const m=ke(a,"x","batchNorm"),y=ke(r,"mean","batchNorm"),A=ke(o,"variance","batchNorm");let w;h!=null&&(w=ke(h,"scale","batchNorm"));let C;return c!=null&&(C=ke(c,"offset","batchNorm")),b(m.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${m.rank}.`),b(y.rank===3||y.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${y.rank}.`),b(A.rank===3||A.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${A.rank}.`),w!=null&&b(w.rank===3||w.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${w.rank}.`),C!=null&&b(C.rank===3||C.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${C.rank}.`),Mw(m,y,A,C,w,f)}const Iae=He({batchNorm3d_:_ae});function Sae(a,r,o,c,h,f){const m=ke(a,"x","batchNorm"),y=ke(r,"mean","batchNorm"),A=ke(o,"variance","batchNorm");let w;h!=null&&(w=ke(h,"scale","batchNorm"));let C;return c!=null&&(C=ke(c,"offset","batchNorm")),b(m.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${m.rank}.`),b(y.rank===4||y.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${y.rank}.`),b(A.rank===4||A.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${A.rank}.`),w!=null&&b(w.rank===4||w.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${w.rank}.`),C!=null&&b(C.rank===4||C.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${C.rank}.`),Mw(m,y,A,C,w,f)}const Tae=He({batchNorm4d_:Sae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mae(a,r,o){const c=ke(a,"x","bincount"),h=ke(r,"weights","bincount");b(c.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${c.dtype}`),b(o>=0,()=>`size must be non-negative, but got ${o}.`),b(h.size===c.size||h.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${c.shape}, weights shape: ${h.shape}.`);const f={x:c,weights:h},m={size:o};return Ve.runKernel(qt,f,m)}const kae=He({bincount_:Mae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rae(a,r){let o=ke(a,"broadcastTo","x");const c=o.shape;if(Et(r),r.length<o.rank)throw new Error(`broadcastTo(): shape.length=${r.length} < input.rank=${o.rank}.`);if(r.length>o.rank){const A=o.shape.slice();for(;A.length<r.length;)A.unshift(1);o=Xe(o,A)}const h=o.shape,f=Array.from(r);for(let A=r.length-1;A>=0;A--)if(h[A]===r[A])f[A]=1;else if(o.shape[A]!==1)throw new Error(`broadcastTo(): [${c}] cannot be broadcast to [${r}].`);if(f.map((A,w)=>A>1?w:-1).filter(A=>A>=0).length===0)return dm(o);const m={x:o},y={reps:f};return Ve.runKernel(Iu,m,y)}const Ev=He({broadcastTo_:Rae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lae(a){const r={x:ke(a,"x","ceil","float32")};return Ve.runKernel(fn,r)}const Bae=He({ceil_:Lae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kw(a,r,o){Et(a),o=o||Ne(r);const c={shape:a,value:r,dtype:o};return Ve.runKernel(Ci,{},c)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pae(a,r,o){const c=ke(a,"x","clipByValue");if(b(r<=o,()=>`Error in clip: min (${r}) must be less than or equal to max (${o}).`),r===o)return kw(c.shape,r,c.dtype);const h={x:c},f={clipValueMin:r,clipValueMax:o};return Ve.runKernel(ei,h,f)}const gl=He({clipByValue_:Pae});function Nae(a){return da(a,0)}const Dae=He({concat1d_:Nae});function Fae(a,r){return da(a,r)}const Oae=He({concat2d_:Fae});function Vae(a,r){return da(a,r)}const Uae=He({concat3d_:Vae});function zae(a,r){return da(a,r)}const Gae=He({concat4d_:zae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wae(a,r,o,c,h="NHWC",f=[1,1],m){const y=ke(a,"x","conv2d","float32"),A=ke(r,"filter","conv2d","float32");let w=y,C=!1;y.rank===3&&(C=!0,w=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2]])),b(w.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${w.rank}.`),b(A.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${A.rank}.`),ha("conv2d",c,m);const _=h==="NHWC"?w.shape[3]:w.shape[1];b(_===A.shape[2],()=>`Error in conv2d: depth of input (${_}) must match input depth for filter ${A.shape[2]}.`),b(fo(o,f),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`),b(pm(f),()=>"Error in conv2D: Dilated rates should be larger than 0."),b(pm(o),()=>"Error in conv2D: Strides should be larger than 0.");const T={x:w,filter:A},B={strides:o,pad:c,dataFormat:h,dilations:f,dimRoundingMode:m},O=Ve.runKernel(Dl,T,B);return C?Xe(O,[O.shape[1],O.shape[2],O.shape[3]]):O}const mm=He({conv2d_:Wae});function Hae(a,r,o,c,h="NWC",f=1,m){const y=ke(a,"x","conv1d"),A=ke(r,"filter","conv1d");let w=y,C=!1;y.rank===2&&(C=!0,w=Xe(y,[1,y.shape[0],y.shape[1]])),b(w.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${w.rank}.`),b(A.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${A.rank}.`),ha("conv1d",c,m),b(w.shape[2]===A.shape[1],()=>`Error in conv1d: depth of input (${w.shape[2]}) must match input depth for filter ${A.shape[1]}.`),b(fo(o,f),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${o} and dilation '${f}'`),b(pm(f),()=>"Error in conv1D: Dilated rates should be larger than 0."),b(pm(o),()=>"Error in conv1D: Stride should be larger than 0."),b(h==="NWC",()=>`Error in conv1d: got dataFormat of ${h} but only NWC is currently supported.`);const _=Xe(A,[1,A.shape[0],A.shape[1],A.shape[2]]),T=Xe(w,[w.shape[0],1,w.shape[1],w.shape[2]]),B=mm(T,_,[1,o],c,"NHWC",[1,f],m);return C?Xe(B,[B.shape[2],B.shape[3]]):Xe(B,[B.shape[0],B.shape[2],B.shape[3]])}const WU=He({conv1d_:Hae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xae(a,r,o,c,h,f="NHWC",m){b(a.length===r.rank,()=>`Length of inShape (${a.length}) and rank of dy (${r.rank}) must match`);let y=a,A=r,w=!1;r.rank===3&&(w=!0,A=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2]]),y=[1,a[0],a[1],a[2]]),b(y.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${y.length}.`),b(A.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${A.rank}`),b(o.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${o.rank}`);const C=f==="NHWC"?y[3]:y[1],_=f==="NHWC"?A.shape[3]:A.shape[1];b(C===o.shape[2],()=>`Error in conv2dDerInput: depth of input (${C}) must match input depth for filter ${o.shape[2]}.`),b(_===o.shape[3],()=>`Error in conv2dDerInput: depth of output (${_}) must match output depth for filter ${o.shape[3]}.`),ha("conv2dDerInput",h,m);const T={dy:A,filter:o},B={strides:c,pad:h,dataFormat:f,dimRoundingMode:m,inputShape:y},O=Ve.runKernel(hn,T,B);return w?Xe(O,[O.shape[1],O.shape[2],O.shape[3]]):O}const MM=He({conv2DBackpropInput_:Xae});function $ae(a,r,o,c,h,f){const m=ke(a,"x","conv2dTranspose"),y=ke(r,"filter","conv2dTranspose");return MM(o,m,y,c,h,"NHWC",f)}const HU=He({conv2dTranspose_:$ae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qae(a,r,o,c,h="NDHWC",f=[1,1,1]){const m=ke(a,"x","conv3d"),y=ke(r,"filter","conv3d");let A=m,w=!1;m.rank===4&&(w=!0,A=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]])),b(A.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${A.rank}.`),b(y.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${y.rank}.`),b(A.shape[4]===y.shape[3],()=>`Error in conv3d: depth of input (${A.shape[4]}) must match input depth for filter ${y.shape[3]}.`),b(fo(o,f),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`),b(h==="NDHWC",()=>`Error in conv3d: got dataFormat of ${h} but only NDHWC is currently supported.`),b(pm(f),()=>"Error in conv3D: Dilated rates should be larger than 0."),b(pm(o),()=>"Error in conv3D: Strides should be larger than 0.");const C={x:A,filter:y},_={strides:o,pad:c,dataFormat:h,dilations:f},T=Ve.runKernel(al,C,_);return w?Xe(T,[T.shape[1],T.shape[2],T.shape[3],T.shape[4]]):T}const Kae=He({conv3d_:Qae});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zae(a,r,o,c,h){b(a.length===r.rank,()=>`Length of inShape (${a.length}) and rank of dy (${r.rank}) must match`);let f=a,m=r,y=!1;r.rank===4&&(y=!0,m=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]),f=[1,a[0],a[1],a[2],a[3]]);const A=f[4],w=m.shape[4];b(f.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${f.length}.`),b(m.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${m.rank}`),b(o.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${o.rank}`),b(A===o.shape[3],()=>`Error in conv3dDerInput: depth of input (${A}) must match input depth for filter ${o.shape[3]}.`),b(w===o.shape[4],()=>`Error in conv3dDerInput: depth of output (${w}) must match output depth for filter ${o.shape[4]}.`);const C={dy:m,filter:o},_={pad:h,strides:c,inputShape:f},T=Ve.runKernel(Fl,C,_);return y?Xe(T,[T.shape[1],T.shape[2],T.shape[3],T.shape[4]]):T}const XU=He({conv3DBackpropInput_:Zae});function jae(a,r,o,c,h){const f=ke(a,"x","conv3dTranspose"),m=ke(r,"filter","conv3dTranspose");return XU(o,f,m,c,h)}const Yae=He({conv3dTranspose_:jae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qae(a){const r={x:ke(a,"x","cos","float32")};return Ve.runKernel(Io,r)}const kM=He({cos_:qae});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jae(a){const r={x:ke(a,"x","cosh","float32")};return Ve.runKernel(So,r)}const $U=He({cosh_:Jae});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ele(a,r=0,o=!1,c=!1){const h={x:ke(a,"x","cumprod")},f={axis:r,exclusive:o,reverse:c};return Ve.runKernel(na,h,f)}const RM=He({cumprod_:ele});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tle(a,r=0,o=!1,c=!1){const h={x:ke(a,"x","cumsum")},f={axis:r,exclusive:o,reverse:c};return Ve.runKernel(ro,h,f)}const QU=He({cumsum_:tle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nle(a,r,o,c=!1){const h=ke(a,"x","denseBincount"),f=ke(r,"weights","denseBincount");b(h.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${h.dtype}`),b(h.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${h.rank}.`),b(o>=0,()=>`size must be non-negative, but got ${o}.`),b(f.size===h.size||f.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${h.shape}, weights shape: ${f.shape}.`);const m={x:h,weights:f},y={size:o,binaryOutput:c};return Ve.runKernel(uu,m,y)}const KU=He({denseBincount_:nle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ile(a,r,o="NHWC"){const c=ke(a,"x","depthToSpace","float32"),h=o==="NHWC"?c.shape[1]:c.shape[2],f=o==="NHWC"?c.shape[2]:c.shape[3],m=o==="NHWC"?c.shape[3]:c.shape[1];b(r>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${r}`),b(h*r>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${h} and ${r}  for depthToSpace with input shape
    ${c.shape}`),b(f*r>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${f} and ${r} for depthToSpace with input shape
        ${c.shape}`),b(m%(r*r)===0,()=>`Dimension size must be evenly divisible by ${r*r} but is ${m} for depthToSpace with input shape ${c.shape}`);const y={x:c},A={blockSize:r,dataFormat:o};return Ve.runKernel(_h,y,A)}const rle=He({depthToSpace_:ile});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sle(a,r,o,c,h="NHWC",f=[1,1],m){const y=ke(a,"x","depthwiseConv2d","float32"),A=ke(r,"filter","depthwiseConv2d","float32");let w=y,C=!1;y.rank===3&&(C=!0,w=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2]])),b(w.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${w.rank}.`),b(A.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${A.rank}.`);const _=h==="NHWC"?w.shape[3]:w.shape[1];b(_===A.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${_}) must match the inChannels dimension in filter ${A.shape[2]}.`),ha("depthwiseConv2d",c,m);const T={x:w,filter:A},B={strides:o,pad:c,dataFormat:h,dilations:f,dimRoundingMode:m},O=Ve.runKernel(ll,T,B);return C?Xe(O,[O.shape[1],O.shape[2],O.shape[3]]):O}const LM=He({depthwiseConv2d_:sle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ole(a,r,o,c,h=[1,1],f="NHWC"){const m=ke(a,"x","dilation2d"),y=ke(r,"filter","dilation2d");b(m.rank===3||m.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${m.rank}.`),b(y.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${y.rank}.`),b(f==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${f}`);let A=m,w=!1;m.rank===3&&(A=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2]]),w=!0),b(A.shape[3]===y.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${A.shape[3]} vs ${y.shape[2]}`);const C={x:A,filter:y},_={strides:o,pad:c,dilations:h},T=Ve.runKernel(pe,C,_);return w?Xe(T,[T.shape[1],T.shape[2],T.shape[3]]):T}const ale=He({dilation2d_:ole});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R0(a,r){const o=a.length,c=[];for(let h=0;h<o;h++){const f=o-1-h,m=a[f]||1;(r[r.length-1-h]||1)>1&&m===1&&c.unshift(f)}return c}function ys(a,r){const o=[];for(let c=0;c<r.length;c++){const h=a[a.length-c-1],f=r.length-c-1,m=r[f];(h==null||h===1&&m>1)&&o.unshift(f)}return o}function si(a,r){const o=Math.max(a.length,r.length),c=new Array(o);for(let h=0;h<o;h++){let f=a[a.length-h-1];f==null&&(f=1);let m=r[r.length-h-1];if(m==null&&(m=1),f===1)c[o-h-1]=m;else if(m===1)c[o-h-1]=f;else if(f!==m){const y=`Operands could not be broadcast together with shapes ${a} and ${r}.`;throw Error(y)}else c[o-h-1]=f}return c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lle(a,r){let o=ke(a,"a","equal","string_or_numeric"),c=ke(r,"b","equal","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(Ln,h)}const Ru=He({equal_:lle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cle(a,r,o){const c=ke(r,"a","where"),h=ke(o,"b","where"),f=ke(a,"condition","where","bool"),m=si(si(f.shape,c.shape),h.shape),y=Ev(f,m),A=Ev(c,m),w=Ev(h,m),C={condition:y,t:A,e:w};return Ve.runKernel(ae,C)}const Po=He({where_:cle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ule(a){const r={x:ke(a,"x","zerosLike")};return Ve.runKernel(g0,r)}const Ri=He({zerosLike_:ule});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hle(a,r){let o=ke(a,"a","div"),c=ke(r,"b","div");[o,c]=Wr(o,c);const h=Vn(o,c),f=Ri(h),m=Ru(c,f);return Po(m,f,h)}const dle=He({divNoNan_:hle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fle(a,r){const o=ke(a,"t1","dot"),c=ke(r,"t2","dot");b((o.rank===1||o.rank===2)&&(c.rank===1||c.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${o.rank} and ${c.rank}.`);const h=o.rank===1?o.size:o.shape[1],f=c.rank===1?c.size:c.shape[0];if(b(h===f,()=>`Error in dot: inner dimensions of inputs must match, but got ${h} and ${f}.`),o.rank===1&&c.rank===1){const m=Xe(o,[1,-1]),y=Xe(c,[-1,1]),A=$i(m,y);return Xe(A,[])}else if(o.rank===1&&c.rank===2){const m=Xe(o,[1,-1]),y=Xe(c,[c.shape[0],c.shape[1]]),A=$i(m,y);return Xe(A,[A.size])}else if(o.rank===2&&c.rank===1){const m=Xe(c,[-1,1]),y=$i(o,m);return Xe(y,[y.size])}else{const m=Xe(c,[c.shape[0],c.shape[1]]);return $i(o,m)}}const ple=He({dot_:fle});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mle(a,...r){const o=r.map((h,f)=>ke(h,`tensors${f}`,"einsum")),c={equation:a};return Ve.runKernel(Nt,o,c)}const _v=He({einsum_:mle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gle(a){const r={x:ke(a,"x","elu","float32")};return Ve.runKernel(Kt,r)}const Rw=He({elu_:gle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yle(a){let r=ke(a,"x","erf");b(r.dtype==="int32"||r.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),r.dtype==="int32"&&(r=pn(r,"float32"));const o={x:r};return Ve.runKernel(dn,o)}const Ale=He({erf_:yle});/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function BM(a,r){for(let o=0;o<a.length;++o)if(a[a.length-o-1]!==r-1-o)return!1;return!0}function ZU(a,r,o){const c=a.length+r.length,h=[];let f=0,m=0;for(let y=0;y<c;y++)o.indexOf(y)===-1?h.push(a[f++]):h.push(r[m++]);return h}function Ps(a,r){const o=[],c=a.length;for(let f=0;f<c;f++)r.indexOf(f)===-1&&o.push(a[f]);const h=r.map(f=>a[f]);return[o,h]}function ns(a,r){const o=r.map(c=>1);return ZU(a,o,r)}function Ys(a,r,o){b(BM(r,o),()=>`${a} supports only inner-most axes for now. Got axes ${r} and rank-${o} input.`)}function Tr(a,r){if(BM(a,r))return null;const o=[];for(let c=0;c<r;++c)a.indexOf(c)===-1&&o.push(c);return a.forEach(c=>o.push(c)),o}function ff(a){return a.map((r,o)=>[o,r]).sort((r,o)=>r[1]-o[1]).map(r=>r[0])}function Hr(a,r){const o=[];for(let c=r-a;c<r;++c)o.push(c);return o}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vle(a,r=null,o=!1){const c={x:ke(a,"x","max")},h={reductionIndices:r,keepDims:o};return Ve.runKernel(ps,c,h)}const kc=He({max_:vle});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ble(a,r=null,o=!1){const c={x:ke(a,"x","min")},h={axis:r,keepDims:o};return Ve.runKernel(Ul,c,h)}const Lw=He({min_:ble});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xle(a,r){let o=ke(a,"base","pow"),c=ke(r,"exp","pow");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(yu,h)}const L0=He({pow_:xle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qi(a,r){if((Va(a)&&r!=="string"||Array.isArray(a))&&r!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(r==="string"&&Va(a)&&!(a instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vv(a,[],[],r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wle(a){const r={x:ke(a,"x","sqrt","float32")};return Ve.runKernel(lr,r)}const No=He({sqrt_:wle});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cle(a){const r=ke(a,"x","square"),o={};return Ve.runKernel("Square",{x:r},o)}const gr=He({square_:Cle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ele(a,r=null,o=!1){let c=ke(a,"x","sum");c.dtype==="bool"&&(c=pn(c,"int32"));const h={x:c},f={axis:r,keepDims:o};return Ve.runKernel(so,h,f)}const Bn=He({sum_:Ele});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _le(a,r="euclidean",o=null,c=!1){a=ke(a,"x","norm");const h=jU(a,r,o);let f=h.shape;if(c){const m=q(o,a.shape);f=ns(h.shape,m)}return Xe(h,f)}function jU(a,r,o=null){if(a.rank===0)return Bo(a);if(a.rank!==1&&o===null)return jU(Xe(a,[-1]),r,o);if(a.rank===1||typeof o=="number"||Array.isArray(o)&&o.length===1){if(r===1)return Bn(Bo(a),o);if(r===1/0)return kc(Bo(a),o);if(r===-1/0)return Lw(Bo(a),o);if(r==="euclidean"||r===2)return No(Bn(L0(Bo(a),Qi(2,"int32")),o));throw new Error(`Error in norm: invalid ord value: ${r}`)}if(Array.isArray(o)&&o.length===2){if(r===1)return kc(Bn(Bo(a),o[0]),o[1]-1);if(r===1/0)return kc(Bn(Bo(a),o[1]),o[0]);if(r===-1/0)return Lw(Bn(Bo(a),o[1]),o[0]);if(r==="fro"||r==="euclidean")return No(Bn(gr(a),o));throw new Error(`Error in norm: invalid ord value: ${r}`)}throw new Error(`Error in norm: invalid axis: ${o}`)}const Bw=He({norm_:_le});/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ile(a,r=null,o=!1){return Bw(a,"euclidean",r,o)}const Sle=He({euclideanNorm_:Ile});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Tle(a){const r={x:ke(a,"x","exp")};return Ve.runKernel(Sn,r)}const Lu=He({exp_:Tle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mle(a,r=0){const o=ke(a,"x","expandDims","string_or_numeric");b(r<=o.rank,()=>"Axis must be <= rank of the tensor");const c={input:o},h={dim:r};return Ve.runKernel(zt,c,h)}const fa=He({expandDims_:Mle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kle(a){const r={x:ke(a,"x","expm1")};return Ve.runKernel(gn,r)}const Rle=He({expm1_:kle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lle(a,r){const o=ke(a,"x","tile","string_or_numeric");b(o.rank===r.length,()=>`Error in transpose: rank of input ${o.rank} must match length of reps ${r}.`);const c={x:o},h={reps:r};return Ve.runKernel(Iu,c,h)}const Rc=He({tile_:Lle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ble(a,r,o,c="float32"){r==null&&(r=a);const h=yi([a,r],c),f=a<=r?a:r;for(let y=0;y<f;++y)h.set(1,y,y);const m=Xe(h.toTensor(),[a,r]);if(o==null)return m;if(o.length===1)return Rc(fa(m,0),[o[0],1,1]);if(o.length===2)return Rc(fa(fa(m,0),0),[o[0],o[1],1,1]);if(o.length===3)return Rc(fa(fa(fa(m,0),0),0),[o[0],o[1],o[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${o.length}D.`)}const YU=He({eye_:Ble});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ple(a){const r={x:ke(a,"x","floor","float32")};return Ve.runKernel(Yn,r)}const Pw=He({floor_:Ple});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nle(a,r,o=0,c=0){const h=ke(a,"x","gather"),f=ke(r,"indices","gather","int32"),m={x:h,indices:f},y={axis:o,batchDims:c};return Ve.runKernel(us,m,y)}const PM=He({gather_:Nle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dle(a,r){let o=ke(a,"a","greater","string_or_numeric"),c=ke(r,"b","greater","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(Oi,h)}const yl=He({greater_:Dle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fle(a,r){let o=ke(a,"a","greaterEqual","string_or_numeric"),c=ke(r,"b","greaterEqual","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(Jr,h)}const gm=He({greaterEqual_:Fle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ole(a){const r={input:ke(a,"input","imag")};return Ve.runKernel(Nn,r)}const NM=He({imag_:Ole});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vle(a){const r={x:ke(a,"x","isFinite")};return Ve.runKernel(Vi,r)}const Ule=He({isFinite_:Vle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zle(a){const r={x:ke(a,"x","isInf")};return Ve.runKernel(pr,r)}const Gle=He({isInf_:zle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wle(a){const r={x:ke(a,"x","isNaN")};return Ve.runKernel(mi,r)}const Hle=He({isNaN_:Wle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xle(a,r=.2){const o={x:ke(a,"x","leakyRelu")},c={alpha:r};return Ve.runKernel(Qs,o,c)}const DM=He({leakyRelu_:Xle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $le(a,r){let o=ke(a,"a","less","string_or_numeric"),c=ke(r,"b","less","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(fs,h)}const Nw=He({less_:$le});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qle(a,r){let o=ke(a,"a","lessEqual","string_or_numeric"),c=ke(r,"b","lessEqual","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(Ba,h)}const B0=He({lessEqual_:Qle});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kle(a,r=5,o=1,c=1,h=.5){const f=ke(a,"x","localResponseNormalization");b(f.rank===4||f.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${f.rank}.`),b(P(r),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${r}.`);let m=f,y=!1;f.rank===3&&(y=!0,m=Xe(f,[1,f.shape[0],f.shape[1],f.shape[2]]));const A={x:m},w={depthRadius:r,bias:o,alpha:c,beta:h},C=Ve.runKernel(Zd,A,w);return y?Xe(C,[C.shape[1],C.shape[2],C.shape[3]]):C}const Zle=He({localResponseNormalization_:Kle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jle(a){const r={x:ke(a,"x","log","float32")};return Ve.runKernel(cl,r)}const Bu=He({log_:jle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yle(a){const r={x:ke(a,"x","log1p")};return Ve.runKernel(To,r)}const qU=He({log1p_:Yle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qle(a,r){b(Ae(a),()=>"The f passed in variableGrads(f) must be a function"),b(r==null||Array.isArray(r)&&r.every(w=>w instanceof Tw),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const o=r!=null;if(!o){r=[];for(const w in Ve.registeredVariables)r.push(Ve.registeredVariables[w])}const c=o?r.filter(w=>!w.trainable):null,h=r.length;r=r.filter(w=>w.trainable),b(r.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${h} variables is trainable.`);const f=!0,{value:m,grads:y}=Ve.gradients(a,r,null,f);b(y.some(w=>w!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),b(m.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${m.rank} tensor`);const A={};return r.forEach((w,C)=>{y[C]!=null&&(A[w.name]=y[C])}),c!=null&&c.forEach(w=>A[w.name]=null),{value:m,grads:A}}function P0(a){return Ve.customGrad(a)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jle(a){const r={x:ke(a,"x","neg")};return Ve.runKernel(mu,r)}const Xr=He({neg_:Jle});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ece(a){const r={x:ke(a,"x","softplus")};return Ve.runKernel(Ii,r)}const Iv=He({softplus_:ece});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tce(a){const r=ke(a,"x","logSigmoid");return P0(o=>({value:Xr(Iv(Xr(o))),gradFunc:c=>Ue(c,k0(Xr(o)))}))(r)}const nce=He({logSigmoid_:tce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ice(a,r){let o=ke(a,"a","sub"),c=ke(r,"b","sub");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(_u,h)}const Wn=He({sub_:ice});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rce(a,r=-1){const o=ke(a,"logits","logSoftmax");if(r===-1&&(r=o.rank-1),r!==o.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${o.rank} and axis was ${r}`);return P0((c,h)=>{const f=kc(c,r,!0),m=Wn(c,f),y=Wn(pn(m,"float32"),Bu(Bn(Lu(m),r,!0)));return h([y]),{value:y,gradFunc:(A,w)=>{const[C]=w,_=!0,T=Lu(C);return Wn(A,Ue(Bn(A,r,_),T))}}})(o)}const JU=He({logSoftmax_:rce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sce(a,r=null,o=!1){const c=ke(a,"x","logSumExp"),h=q(r,c.shape),f=kc(c,h,!0),m=Wn(c,f),y=Lu(m),A=Bn(y,h),w=Bu(A),C=Ot(Xe(f,w.shape),w);if(o){const _=ns(C.shape,h);return Xe(C,_)}return C}const ez=He({logSumExp_:sce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oce(a,r){const o=ke(a,"a","logicalAnd","bool"),c=ke(r,"b","logicalAnd","bool");si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(du,h)}const Hh=He({logicalAnd_:oce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ace(a){const r={x:ke(a,"x","logicalNot","bool")};return Ve.runKernel(vc,r)}const FM=He({logicalNot_:ace});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lce(a,r){const o=ke(a,"a","logicalOr","bool"),c=ke(r,"b","logicalOr","bool");si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(Sh,h)}const tz=He({logicalOr_:lce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cce(a,r){const o=ke(a,"a","logicalXor","bool"),c=ke(r,"b","logicalXor","bool");return si(o.shape,c.shape),Hh(tz(a,r),FM(Hh(a,r)))}const uce=He({logicalXor_:cce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hce(a,r,o,c,h){const f=ke(a,"x","maxPool"),m=1;let y=f,A=!1;f.rank===3&&(A=!0,y=Xe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),b(y.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${y.rank}.`),b(fo(o,m),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${m}'`),ha("maxPool",c,h);const w={x:y},C={filterSize:r,strides:o,pad:c,dimRoundingMode:h},_=Ve.runKernel(ul,w,C);return A?Xe(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const OM=He({maxPool_:hce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dce(a,r=[1,1,1],o,c,h,f="NDHWC"){const m=ke(a,"x","maxPool3d");let y=m,A=!1;m.rank===4&&(A=!0,y=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]])),b(y.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${y.rank}.`),b(f==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${f}`),ha("maxPool3d",c,h);const w={x:y},C={filterSize:r,strides:o,pad:c,dimRoundingMode:h,dataFormat:f},_=Ve.runKernel(bc,w,C);return A?Xe(_,[_.shape[1],_.shape[2],_.shape[3],_.shape[4]]):_}const fce=He({maxPool3d_:dce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pce(a,r){let o=ke(a,"a","maximum"),c=ke(r,"b","maximum");[o,c]=Wr(o,c),o.dtype==="bool"&&(o=pn(o,"int32"),c=pn(c,"int32")),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(ki,h)}const pf=He({maximum_:pce});/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mce(a,r=null,o=!1){const c={x:ke(a,"x","mean")},h={axis:r,keepDims:o};return Ve.runKernel(fu,c,h)}const is=He({mean_:mce});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ns(a,r="float32"){if(Et(a),r==="complex64"){const c=Ns(a,"float32"),h=Ns(a,"float32");return I0(c,h)}const o=At(M(a),r);return Ve.makeTensor(o,a,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mf(a,r="float32"){if(Et(a),r==="complex64"){const c=mf(a,"float32"),h=Ns(a,"float32");return I0(c,h)}const o=xt(M(a),r);return Ve.makeTensor(o,a,r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gce(a,r){let o=ke(a,"a","minimum"),c=ke(r,"b","minimum");[o,c]=Wr(o,c),o.dtype==="bool"&&(o=pn(o,"int32"),c=pn(c,"int32")),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(mr,h)}const Sv=He({minimum_:gce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yce(a,r,o){b(o==="reflect"||o==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${o}.`);const c=ke(a,"x","mirrorPad");if(c.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");b(r.length===c.rank,()=>`Padding doesn't match input. Must be ${c.rank}. Got ${r.length}.`);const h=o==="reflect"?1:0;for(let y=0;y<c.rank;y++)b(r[y].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),b(r[y][0]>=0&&r[y][0]<=c.shape[y]-h&&r[y][1]>=0&&r[y][1]<=c.shape[y]-h,()=>`Padding in dimension ${y} cannot be greater than or equal to ${c.shape[y]-h} or less than 0 for input of shape ${c.shape}`);const f={paddings:r,mode:o},m={x:c};return Ve.runKernel(ia,m,f)}const Ace=He({mirrorPad_:yce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vce(a,r){let o=ke(a,"a","mod"),c=ke(r,"b","mod");[o,c]=Wr(o,c);const h={a:o,b:c};return Ve.runKernel(wc,h)}const bce=He({mod_:vce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xce(a,r=null,o=!1){a=ke(a,"x","moments");const c=q(r,a.shape),h=is(a,c,o);let f=h.shape;o||(f=ns(h.shape,c));const m=gr(Wn(pn(a,"float32"),Xe(h,f))),y=is(m,c,o);return{mean:h,variance:y}}const VM=He({moments_:xce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wce(a,r){let o=ke(a,"a","notEqual","string_or_numeric"),c=ke(r,"b","notEqual","string_or_numeric");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c};return Ve.runKernel(gu,h)}const Dw=He({notEqual_:wce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cce(a,r,o=1,c=0,h="int32"){if(r<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${r}`);const f={indices:ke(a,"indices","oneHot","int32")},m={dtype:h,depth:r,onValue:o,offValue:c};return Ve.runKernel(Rs,f,m)}const nz=He({oneHot_:Cce});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ece(a){const r={x:ke(a,"x","onesLike")};return Ve.runKernel(Ec,r)}const Xl=He({onesLike_:Ece});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _ce(a,r,o=0){const c=ke(a,"x","pad");if(c.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const h={paddings:r,constantValue:o},f={x:c};return Ve.runKernel(Mh,f,h)}const UM=He({pad_:_ce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ice(a,r,o){const c=ke(a,"x","spaceToBatchND");b(c.rank>=1+r.length,()=>`input rank ${c.rank} should be > than [blockShape] ${r.length}`),b(o.length===r.length,()=>`paddings.shape[0] ${o.length} must be equal to [blockShape] ${r.length}`),b(c.shape.reduce((m,y,A)=>A>0&&A<=r.length?m&&(y+o[A-1][0]+o[A-1][1])%r[A-1]===0:m,!0),()=>`input spatial dimensions ${c.shape.slice(1)} with paddings ${o.toString()} must be divisible by blockShapes ${r.toString()}`);const h={x:c},f={blockShape:r,paddings:o};return Ve.runKernel(Ro,h,f)}const zM=He({spaceToBatchND_:Ice});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sce(a,r,o,c,h,f,m){h==null&&(h=[1,1]),f==null&&(f=1),c===0&&(c="valid");const y=ke(a,"x","maxPool");let A=y,w=!1;y.rank===3&&(w=!0,A=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2]])),b(fo(f,h),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${f} and dilations '${h}'`);const C=Hl(A.shape,r,f,h,c),_=[C.dilationHeight,C.dilationWidth];let T;c==="same"?T=Mce([C.filterHeight,C.filterWidth],_):T=[[0,0],[0,0]];const B=_[0]===1&&_[1]===1,[O,U]=Tce([C.inHeight,C.inWidth],_,T),W=B?c:"valid",z=B?A:zM(A,_,O),X=(o==="avg"?()=>IM(z,r,f,W,m):()=>OM(z,r,f,W,m))(),re=B?X:TM(X,_,U);return w?Xe(re,[re.shape[1],re.shape[2],re.shape[3]]):re}function Tce(a,r,o){const c=o.map(C=>C[0]),h=o.map(C=>C[1]),f=a.concat(c,h),m=r.map((C,_)=>(C-f[_]%C)%C),y=h.map((C,_)=>C+m[_]),A=r.map((C,_)=>[c[_],y[_]]),w=r.map((C,_)=>[0,m[_]]);return[A,w]}function Mce(a,r){const o=a.map((f,m)=>f+(f-1)*(r[m]-1)).map(f=>f-1),c=o.map(f=>Math.floor(f/2)),h=o.map((f,m)=>f-c[m]);return o.map((f,m)=>[c[m],h[m]])}const kce=He({pool_:Sce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rce(a,r){const o=ke(a,"x","prelu"),c=ke(r,"alpha","prelu"),h={x:o,alpha:c};return Ve.runKernel(Na,h)}const GM=He({prelu_:Rce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lce(a,r=null,o=!1){let c=ke(a,"x","prod");c.dtype==="bool"&&(c=pn(c,"int32"));const h={x:c},f={axis:r,keepDims:o};return Ve.runKernel(kh,h,f)}const Bce=He({prod_:Lce});var iz={exports:{}};(function(a){(function(r,o,c){function h(A){var w=this,C=y();w.next=function(){var _=2091639*w.s0+w.c*23283064365386963e-26;return w.s0=w.s1,w.s1=w.s2,w.s2=_-(w.c=_|0)},w.c=1,w.s0=C(" "),w.s1=C(" "),w.s2=C(" "),w.s0-=C(A),w.s0<0&&(w.s0+=1),w.s1-=C(A),w.s1<0&&(w.s1+=1),w.s2-=C(A),w.s2<0&&(w.s2+=1),C=null}function f(A,w){return w.c=A.c,w.s0=A.s0,w.s1=A.s1,w.s2=A.s2,w}function m(A,w){var C=new h(A),_=w&&w.state,T=C.next;return T.int32=function(){return C.next()*4294967296|0},T.double=function(){return T()+(T()*2097152|0)*11102230246251565e-32},T.quick=T,_&&(typeof _=="object"&&f(_,C),T.state=function(){return f(C,{})}),T}function y(){var A=4022871197,w=function(C){C=String(C);for(var _=0;_<C.length;_++){A+=C.charCodeAt(_);var T=.02519603282416938*A;A=T>>>0,T-=A,T*=A,A=T>>>0,T-=A,A+=T*4294967296}return(A>>>0)*23283064365386963e-26};return w}o&&o.exports?o.exports=m:this.alea=m})(Fh,a)})(iz);var Pce=iz.exports,rz={exports:{}};(function(a){(function(r,o,c){function h(y){var A=this,w="";A.x=0,A.y=0,A.z=0,A.w=0,A.next=function(){var _=A.x^A.x<<11;return A.x=A.y,A.y=A.z,A.z=A.w,A.w^=A.w>>>19^_^_>>>8},y===(y|0)?A.x=y:w+=y;for(var C=0;C<w.length+64;C++)A.x^=w.charCodeAt(C)|0,A.next()}function f(y,A){return A.x=y.x,A.y=y.y,A.z=y.z,A.w=y.w,A}function m(y,A){var w=new h(y),C=A&&A.state,_=function(){return(w.next()>>>0)/4294967296};return _.double=function(){do var T=w.next()>>>11,B=(w.next()>>>0)/4294967296,O=(T+B)/(1<<21);while(O===0);return O},_.int32=w.next,_.quick=_,C&&(typeof C=="object"&&f(C,w),_.state=function(){return f(w,{})}),_}o&&o.exports?o.exports=m:this.xor128=m})(Fh,a)})(rz);var Nce=rz.exports,sz={exports:{}};(function(a){(function(r,o,c){function h(y){var A=this,w="";A.next=function(){var _=A.x^A.x>>>2;return A.x=A.y,A.y=A.z,A.z=A.w,A.w=A.v,(A.d=A.d+362437|0)+(A.v=A.v^A.v<<4^(_^_<<1))|0},A.x=0,A.y=0,A.z=0,A.w=0,A.v=0,y===(y|0)?A.x=y:w+=y;for(var C=0;C<w.length+64;C++)A.x^=w.charCodeAt(C)|0,C==w.length&&(A.d=A.x<<10^A.x>>>4),A.next()}function f(y,A){return A.x=y.x,A.y=y.y,A.z=y.z,A.w=y.w,A.v=y.v,A.d=y.d,A}function m(y,A){var w=new h(y),C=A&&A.state,_=function(){return(w.next()>>>0)/4294967296};return _.double=function(){do var T=w.next()>>>11,B=(w.next()>>>0)/4294967296,O=(T+B)/(1<<21);while(O===0);return O},_.int32=w.next,_.quick=_,C&&(typeof C=="object"&&f(C,w),_.state=function(){return f(w,{})}),_}o&&o.exports?o.exports=m:this.xorwow=m})(Fh,a)})(sz);var Dce=sz.exports,oz={exports:{}};(function(a){(function(r,o,c){function h(y){var A=this;A.next=function(){var C=A.x,_=A.i,T,B;return T=C[_],T^=T>>>7,B=T^T<<24,T=C[_+1&7],B^=T^T>>>10,T=C[_+3&7],B^=T^T>>>3,T=C[_+4&7],B^=T^T<<7,T=C[_+7&7],T=T^T<<13,B^=T^T<<9,C[_]=B,A.i=_+1&7,B};function w(C,_){var T,B=[];if(_===(_|0))B[0]=_;else for(_=""+_,T=0;T<_.length;++T)B[T&7]=B[T&7]<<15^_.charCodeAt(T)+B[T+1&7]<<13;for(;B.length<8;)B.push(0);for(T=0;T<8&&B[T]===0;++T);for(T==8?B[7]=-1:B[T],C.x=B,C.i=0,T=256;T>0;--T)C.next()}w(A,y)}function f(y,A){return A.x=y.x.slice(),A.i=y.i,A}function m(y,A){y==null&&(y=+new Date);var w=new h(y),C=A&&A.state,_=function(){return(w.next()>>>0)/4294967296};return _.double=function(){do var T=w.next()>>>11,B=(w.next()>>>0)/4294967296,O=(T+B)/(1<<21);while(O===0);return O},_.int32=w.next,_.quick=_,C&&(C.x&&f(C,w),_.state=function(){return f(w,{})}),_}o&&o.exports?o.exports=m:this.xorshift7=m})(Fh,a)})(oz);var Fce=oz.exports,az={exports:{}};(function(a){(function(r,o,c){function h(y){var A=this;A.next=function(){var C=A.w,_=A.X,T=A.i,B,O;return A.w=C=C+1640531527|0,O=_[T+34&127],B=_[T=T+1&127],O^=O<<13,B^=B<<17,O^=O>>>15,B^=B>>>12,O=_[T]=O^B,A.i=T,O+(C^C>>>16)|0};function w(C,_){var T,B,O,U,W,z=[],X=128;for(_===(_|0)?(B=_,_=null):(_=_+"\0",B=0,X=Math.max(X,_.length)),O=0,U=-32;U<X;++U)_&&(B^=_.charCodeAt((U+32)%_.length)),U===0&&(W=B),B^=B<<10,B^=B>>>15,B^=B<<4,B^=B>>>13,U>=0&&(W=W+1640531527|0,T=z[U&127]^=B+W,O=T==0?O+1:0);for(O>=128&&(z[(_&&_.length||0)&127]=-1),O=127,U=4*128;U>0;--U)B=z[O+34&127],T=z[O=O+1&127],B^=B<<13,T^=T<<17,B^=B>>>15,T^=T>>>12,z[O]=B^T;C.w=W,C.X=z,C.i=O}w(A,y)}function f(y,A){return A.i=y.i,A.w=y.w,A.X=y.X.slice(),A}function m(y,A){y==null&&(y=+new Date);var w=new h(y),C=A&&A.state,_=function(){return(w.next()>>>0)/4294967296};return _.double=function(){do var T=w.next()>>>11,B=(w.next()>>>0)/4294967296,O=(T+B)/(1<<21);while(O===0);return O},_.int32=w.next,_.quick=_,C&&(C.X&&f(C,w),_.state=function(){return f(w,{})}),_}o&&o.exports?o.exports=m:this.xor4096=m})(Fh,a)})(az);var Oce=az.exports,lz={exports:{}};(function(a){(function(r,o,c){function h(y){var A=this,w="";A.next=function(){var _=A.b,T=A.c,B=A.d,O=A.a;return _=_<<25^_>>>7^T,T=T-B|0,B=B<<24^B>>>8^O,O=O-_|0,A.b=_=_<<20^_>>>12^T,A.c=T=T-B|0,A.d=B<<16^T>>>16^O,A.a=O-_|0},A.a=0,A.b=0,A.c=-1640531527,A.d=1367130551,y===Math.floor(y)?(A.a=y/4294967296|0,A.b=y|0):w+=y;for(var C=0;C<w.length+20;C++)A.b^=w.charCodeAt(C)|0,A.next()}function f(y,A){return A.a=y.a,A.b=y.b,A.c=y.c,A.d=y.d,A}function m(y,A){var w=new h(y),C=A&&A.state,_=function(){return(w.next()>>>0)/4294967296};return _.double=function(){do var T=w.next()>>>11,B=(w.next()>>>0)/4294967296,O=(T+B)/(1<<21);while(O===0);return O},_.int32=w.next,_.quick=_,C&&(typeof C=="object"&&f(C,w),_.state=function(){return f(w,{})}),_}o&&o.exports?o.exports=m:this.tychei=m})(Fh,a)})(lz);var Vce=lz.exports,cz={exports:{}};const Uce=b0(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(a){(function(r,o,c){var h=256,f=6,m=52,y="random",A=c.pow(h,f),w=c.pow(2,m),C=w*2,_=h-1,T;function B(se,le,ge){var ye=[];le=le==!0?{entropy:!0}:le||{};var be=z(W(le.entropy?[se,re(o)]:se??X(),3),ye),Se=new O(ye),Be=function(){for(var Ye=Se.g(f),et=A,tt=0;Ye<w;)Ye=(Ye+tt)*h,et*=h,tt=Se.g(1);for(;Ye>=C;)Ye/=2,et/=2,tt>>>=1;return(Ye+tt)/et};return Be.int32=function(){return Se.g(4)|0},Be.quick=function(){return Se.g(4)/4294967296},Be.double=Be,z(re(Se.S),o),(le.pass||ge||function(Ye,et,tt,ot){return ot&&(ot.S&&U(ot,Se),Ye.state=function(){return U(Se,{})}),tt?(c[y]=Ye,et):Ye})(Be,be,"global"in le?le.global:this==c,le.state)}function O(se){var le,ge=se.length,ye=this,be=0,Se=ye.i=ye.j=0,Be=ye.S=[];for(ge||(se=[ge++]);be<h;)Be[be]=be++;for(be=0;be<h;be++)Be[be]=Be[Se=_&Se+se[be%ge]+(le=Be[be])],Be[Se]=le;(ye.g=function(Ye){for(var et,tt=0,ot=ye.i,st=ye.j,ct=ye.S;Ye--;)et=ct[ot=_&ot+1],tt=tt*h+ct[_&(ct[ot]=ct[st=_&st+et])+(ct[st]=et)];return ye.i=ot,ye.j=st,tt})(h)}function U(se,le){return le.i=se.i,le.j=se.j,le.S=se.S.slice(),le}function W(se,le){var ge=[],ye=typeof se,be;if(le&&ye=="object")for(be in se)try{ge.push(W(se[be],le-1))}catch{}return ge.length?ge:ye=="string"?se:se+"\0"}function z(se,le){for(var ge=se+"",ye,be=0;be<ge.length;)le[_&be]=_&(ye^=le[_&be]*19)+ge.charCodeAt(be++);return re(le)}function X(){try{var se;return T&&(se=T.randomBytes)?se=se(h):(se=new Uint8Array(h),(r.crypto||r.msCrypto).getRandomValues(se)),re(se)}catch{var le=r.navigator,ge=le&&le.plugins;return[+new Date,r,ge,r.screen,re(o)]}}function re(se){return String.fromCharCode.apply(0,se)}if(z(c.random(),o),a.exports){a.exports=B;try{T=Uce}catch{}}else c["seed"+y]=B})(typeof self<"u"?self:Fh,[],Math)})(cz);var zce=cz.exports,Gce=Pce,Wce=Nce,Hce=Dce,Xce=Fce,$ce=Oce,Qce=Vce,ym=zce;ym.alea=Gce,ym.xor128=Wce,ym.xorwow=Hce,ym.xorshift7=Xce,ym.xor4096=$ce,ym.tychei=Qce;var WM=ym;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class uz{constructor(r,o,c,h,f){this.mean=r,this.stdDev=o,this.dtype=c,this.nextVal=NaN,this.truncated=h,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const m=f||Math.random();this.random=WM.alea(m.toString())}nextValue(){if(!isNaN(this.nextVal)){const h=this.nextVal;return this.nextVal=NaN,h}let r,o,c=!1;for(;!c;){let h,f,m;do h=2*this.random()-1,f=2*this.random()-1,m=h*h+f*f;while(m>=1||m===0);const y=Math.sqrt(-2*Math.log(m)/m);r=this.mean+this.stdDev*h*y,o=this.mean+this.stdDev*f*y,(!this.truncated||this.isValidTruncated(r))&&(c=!0)}return(!this.truncated||this.isValidTruncated(o))&&(this.nextVal=this.convertValue(o)),this.convertValue(r)}convertValue(r){return this.dtype==null||this.dtype==="float32"?r:Math.round(r)}isValidTruncated(r){return r<=this.upper&&r>=this.lower}}class Kce{constructor(r=0,o=1,c,h){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=r,this.range=o-r,this.dtype=c,h==null&&(h=Math.random()),typeof h=="number"&&(h=h.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${r} - ${o} <= 1 and dtype is not float`);this.random=WM.alea(h)}convertValue(r){return this.canReturnFloat()?r:Math.round(r)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zce(a,r=0,o=1,c,h){if(Et(a),c!=null&&c==="bool")throw new Error(`Unsupported data type ${c}`);const f=new uz(r,o,c,!1,h),m=yi(a,c);for(let y=0;y<m.values.length;y++)m.values[y]=f.nextValue();return m.toTensor()}const jce=He({randomNormal_:Zce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yce(a,r=0,o=1,c="float32",h){Et(a);const f=yi(a,c),m=new Kce(r,o,null,h);for(let y=0;y<f.values.length;y++)f.values[y]=m.nextValue();return f.toTensor()}const Tv=He({randomUniform_:Yce});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mv(a,r,o=1,c="float32"){if(o===0)throw new Error("Cannot have a step of zero");const h={start:a,stop:r,step:o,dtype:c};return Ve.runKernel(Au,{},h)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qce(a){const r={input:ke(a,"input","real")};return Ve.runKernel(vu,r)}const Fw=He({real_:qce});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jce(a){const r={x:ke(a,"x","reciprocal")};return Ve.runKernel(Ls,r)}const eue=He({reciprocal_:Jce});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tue(a){const r={x:ke(a,"x","relu")};return Ve.runKernel(bu,r)}const Am=He({relu_:tue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nue(a){const r={x:ke(a,"x","relu6")};return Ve.runKernel(zl,r)}const hz=He({relu6_:nue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iue(a,r){const o={x:ke(a,"x","reverse")},c={dims:r};return Ve.runKernel(es,o,c)}const vm=He({reverse_:iue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rue(a){const r={x:ke(a,"x","round")};return Ve.runKernel(_c,r)}const dz=He({round_:rue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sue(a){const r={x:ke(a,"x","rsqrt","float32")};return Ve.runKernel(Cu,r)}const fz=He({rsqrt_:sue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oue(a){const r={x:ke(a,"x","selu")};return Ve.runKernel(me,r)}const pz=He({selu_:oue});function aue(a,r,o,c,h,f=[1,1],m="NHWC"){const y=ke(a,"x","separableConv2d"),A=ke(r,"depthwiseFilter","separableConv2d"),w=ke(o,"pointwiseFilter","separableConv2d");let C=y,_=!1;if(y.rank===3&&(_=!0,C=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2]])),m==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");b(C.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${C.rank}.`),b(A.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${A.rank}.`),b(w.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${A.rank}.`),b(w.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${w.shape[0]}.`),b(w.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${w.shape[1]}.`);const T=A.shape[2],B=A.shape[3];b(w.shape[2]===T*B,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${T*B}, but got ${w.shape[2]}.`);const O=LM(C,A,c,h,m,f),U=mm(O,w,1,"valid",m);return _?Xe(U,[U.shape[1],U.shape[2],U.shape[3]]):U}const mz=He({separableConv2d_:aue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lue(a){const r={x:ke(a,"x","sign")};return Ve.runKernel(zn,r)}const cue=He({sign_:lue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uue(a){const r={x:ke(a,"x","sin","float32")};return Ve.runKernel(it,r)}const gz=He({sin_:uue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hue(a){const r={x:ke(a,"x","sinh")};return Ve.runKernel(Xt,r)}const yz=He({sinh_:hue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function due(a,r,o){const c=ke(a,"x","slice1d");return b(c.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${c.rank} tensor`),ur(c,[r],[o])}const HM=He({slice1d_:due});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fue(a,r,o){const c=ke(a,"x","slice2d");return b(c.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${c.rank} tensor`),ur(c,r,o)}const Az=He({slice2d_:fue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pue(a,r,o){const c=ke(a,"x","slice3d");return b(c.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${c.rank} tensor`),ur(c,r,o)}const XM=He({slice3d_:pue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mue(a,r,o){const c=ke(a,"x","slice4d");return b(c.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${c.rank} tensor`),ur(c,r,o)}const Ow=He({slice4d_:mue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gue(a,r=-1){const o=ke(a,"logits","softmax","float32");if(r===-1&&(r=o.rank-1),r!==o.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o.rank} and dim was ${r}`);const c={logits:o},h={dim:r};return Ve.runKernel(oa,c,h)}const $M=He({softmax_:gue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yue(a){b(a.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${a.dtype}.`);const r={input:a};return Ve.runKernel(Hn,r)}const vz=He({fft_:yue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Aue(a){b(a.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${a.dtype}.`);const r={input:a};return Ve.runKernel(ds,r)}const QM=He({ifft_:Aue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vue(a){const r=a.shape[a.shape.length-1],o=a.size/r;let c;if(r<=2){const h=Xe(a,[o,r]);c=QM(h)}else{const h=[o,2*(r-1)],f=Xe(Fw(a),[o,r]),m=Xe(NM(a),[o,r]),y=vm(ur(f,[0,1],[o,r-2]),1),A=Ue(vm(ur(m,[0,1],[o,r-2]),1),Qi(-1)),w=da([f,y],1),C=da([m,A],1),_=Xe(I0(w,C),[h[0],h[1]]);c=QM(_)}if(c=Fw(c),a.rank===3&&a.shape[0]!==0){const h=c,f=a.shape[0];c=Xe(c,[f,c.shape[0]/f,c.shape[1]]),h.dispose()}return c}const bue=He({irfft_:vue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xue(a,r,o=0){const c={x:ke(a,"x","split")},h={numOrSizeSplits:r,axis:o};return Ve.runKernel(oo,c,h)}const Al=He({split_:xue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wue(a,r){b(a.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${a.dtype}`);let o=a.shape[a.shape.length-1];const c=a.size/o;let h;if(r!=null&&r<o){const O=a.shape.map(W=>0),U=a.shape.map(W=>W);U[a.shape.length-1]=r,h=ur(a,O,U),o=r}else if(r!=null&&r>o){const O=a.shape.map(U=>U);O[a.shape.length-1]=r-o,h=da([a,Ns(O)],a.shape.length-1),o=r}else h=a;const f=Ri(h),m=Xe(I0(h,f),[c,o]),y=vz(m),A=Math.floor(o/2)+1,w=Fw(y),C=NM(y),_=Al(w,[A,o-A],w.shape.length-1),T=Al(C,[A,o-A],C.shape.length-1),B=h.shape.slice();return B[h.shape.length-1]=A,Xe(I0(_[0],T[0]),B)}const Cue=He({rfft_:wue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Eue(a,r){let o=ke(a,"a","squaredDifference"),c=ke(r,"b","squaredDifference");[o,c]=Wr(o,c),si(o.shape,c.shape);const h={a:o,b:c},f={};return Ve.runKernel(nm,h,f)}const _ue=He({squaredDifference_:Eue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Iue(a,r){const o=ke(a,"x","squeeze","string_or_numeric");return Xe(o,ne(o.shape,r).newShape)}const kv=He({squeeze_:Iue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sue(a,r=0){const o=TU(a,"tensors","stack","string_or_numeric");b(o.length>=1,()=>"Pass at least one tensor to tf.stack"),o.length>0&&b(r<=o[0].rank,()=>"Axis must be <= rank of the tensor");const c=o,h={axis:r};return Ve.runKernel(ra,c,h)}const Pu=He({stack_:Sue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Tue(a,r=0){const o={x:ke(a,"x","step")},c={alpha:r};return Ve.runKernel(aa,o,c)}const Rv=He({step_:Tue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mue(a,r,o,c,h=0,f=0,m=0,y=0,A=0){const w={x:ke(a,"x","stridedSlice","string_or_numeric")},C={begin:r,end:o,strides:c,beginMask:h,endMask:f,ellipsisMask:m,newAxisMask:y,shrinkAxisMask:A};return Ve.runKernel(Eu,w,C)}const kue=He({stridedSlice_:Mue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rue(a){const r={x:ke(a,"x","tan","float32")};return Ve.runKernel(im,r)}const Lue=He({tan_:Rue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function za(a,r){S(a);const o=Av(a,r);if(o.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vv(a,null,o,r)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KM(a,r,o){if(S(a),r!=null&&r.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const c=Av(a,o);if(c.length!==2&&c.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(c.length===1&&r==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vv(a,r,c,o)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bue(a,r,o){if(S(a),r!=null&&r.length!==3)throw new Error("tensor3d() requires shape to have three numbers");const c=Av(a,o);if(c.length!==3&&c.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(c.length===1&&r==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vv(a,r,c,o)}function bz(a,r,o){const c=r.rank>1?r.shape[r.rank-1]:1,h=r.rank>1?r.rank-1:1,f=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${o.shape}, indices.shape: ${r.shape}, shape: ${a}, sliceDim: ${c}, and batchDim: ${h}.`;if(o.rank<h)throw new Error(f+` update.rank < ${h}. `);if(a.length<c+(o.rank-h))throw new Error(f+` Output shape length < ${c+(o.rank-h)}`);if(o.rank!==h+a.length-c)throw new Error(f+` update.rank != ${h+a.length-c}`);for(let m=0;m<h;++m)if(o.shape[m]!==r.shape[m])throw new Error(f+` updates.shape[${m}] (${o.shape[m]}) != indices.shape[${m}] (${r.shape[m]}).`);for(let m=0;m<o.rank-h;++m)if(o.shape[m+h]!==a[m+c])throw new Error(f+` updates.shape[${m+h}] (${o.shape[m+h]}) != shape[${m+h}] (${a[m+h]})`)}function Pue(a,r,o){if(r.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${r.rank}.`);if(a.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${a.rank}.`);if(r.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${r.dtype}`);if(o.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${o}`);if(o.length===0){if(r.size===0)throw new Error(`Indices specified for empty output. indices shape: ${r.shape}`);if(a.size===0)throw new Error(`Updates specified for empty output. updates shape: ${a.shape}`)}bz(o,r,a)}function bm(a,r,o){const c=r.shape.length,h=c>1?r.shape[c-1]:1,f=o.length;let m=1;for(let _=h;_<f;++_)m*=o[_];const y=h<1?1:h,A=M(r.shape)/y,w=[...Ie(o.slice(0,h)),1],C=M(o);return{sliceRank:h,numUpdates:A,sliceSize:m,strides:w,outputSize:C}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nue(a,r=1,o=!0){const c=ke(a,"x","topk");if(c.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const h=c.shape[c.shape.length-1];if(r<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${r}`);if(r>h)throw new Error(`'k' passed to topk() must be <= the last dimension (${h}) but got ${r}`);const f={x:c},m={k:r,sorted:o},[y,A]=Ve.runKernel(av,f,m);return{values:y,indices:A}}const Due=He({topk_:Nue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fue(a,r=0,o=1,c,h){if(Et(a),c!=null&&c==="bool")throw new Error("Unsupported data type $ { dtype }");const f=new uz(r,o,c,!0,h),m=yi(a,c);for(let y=0;y<m.values.length;y++)m.values[y]=f.nextValue();return m.toTensor()}const xz=He({truncatedNormal_:Fue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oue(a,r=0){const o=ke(a,"x","unique","string_or_numeric");b(o.rank>0,()=>"The input tensor must be at least 1D");const c={x:o},h={axis:r},[f,m]=Ve.runKernel(fl,c,h);return{values:f,indices:m}}const Vue=He({unique_:Oue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Uue(a,r,o){const c=ke(a,"x","unsortedSegmentSum"),h=ke(r,"segmentIds","unsortedSegmentSum","int32");b(P(o),()=>"numSegments must be of dtype int");const f={x:c,segmentIds:h},m={numSegments:o};return Ve.runKernel(Sc,f,m)}const wz=He({unsortedSegmentSum_:Uue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zue(a,r=0){const o=ke(a,"x","unstack","string_or_numeric");b(r>=-o.shape.length&&r<o.shape.length,()=>`Axis = ${r} is not in [-${o.shape.length}, ${o.shape.length})`);const c={value:o},h={axis:r};return Ve.runKernel(m0,c,h)}const xm=He({unstack_:zue});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gue(a,r=!0,o,c){return Ve.makeVariable(a,r,o,c)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cz(a,r){const o=[];for(let f=0;f<r.length;f++)r[f]&&o.push(f);const c=yi(a,"int32"),h=yi([o.length,a.length],"int32");for(let f=0;f<o.length;f++){const m=c.indexToLoc(o[f]),y=f*a.length;h.values.set(m,y)}return h.toTensor()}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wue(a,r,o){const c=ke(a,"x","transpose");if(r==null&&(r=c.shape.map((m,y)=>y).reverse()),b(c.rank===r.length,()=>`Error in transpose: rank of input ${c.rank} must match length of perm ${r}.`),r.forEach(m=>{b(m>=0&&m<c.rank,()=>`All entries in 'perm' must be between 0 and ${c.rank-1} but got ${r}`)}),c.rank<=1)return c.clone();const h={x:c},f={perm:r};return c.dtype==="complex64"?Qe(()=>{let m=Fw(c),y=NM(c);return m=Ve.runKernel(ef,{x:m},f),y=Ve.runKernel(ef,{x:y},f),o&&(y=Xr(y)),I0(m,y)}):Ve.runKernel(ef,h,f)}const Li=He({transpose_:Wue});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hue(a,r){if(r==null)return a.shape.slice();if(R(a.shape,r))return r;if(a.shape.length===r.length){const o=[];for(let c=0;c<a.shape.length;c++)r[c]==null&&a.shape[c]!=null?o.push(a.shape[c]):o.push(r[c]);return o}return r}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xue(a,r,o,c){const h=ke(a,"x","dropout");if(b(h.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${h.dtype} tensor instead.`),b(r>=0&&r<1,()=>`rate must be a float in the range [0, 1), but got ${r}.`),r===0)return a instanceof gs?h.clone():h;const f=Hue(h,o),m=1-r,y=Vn(Pw(Ot(Tv(f,0,1,"float32",c),m)),m);return Ue(h,y)}const $ue=He({dropout_:Xue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Que(a,r,o,c,h,f="NHWC",m){let y=a;a.rank===3&&(y=Xe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let A=r;A.rank===3&&(A=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2]])),b(y.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${y.shape}.`),b(A.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${A.shape}.`),b(o.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${o}.`);const w=f==="NHWC"?y.shape[3]:y.shape[1],C=f==="NHWC"?A.shape[3]:A.shape[1];b(w===o[2],()=>`Error in conv2dDerFilter: depth of input ${w}) must match input depth in filter (${o[2]}.`),b(C===o[3],()=>`Error in conv2dDerFilter: depth of dy (${C}) must match output depth for filter (${o[3]}).`),ha("conv2dDerFilter",h,m);const _={x:y,dy:A},T={strides:c,pad:h,dataFormat:f,dimRoundingMode:m,filterShape:o};return Ve.runKernel(qr,_,T)}const ZM=He({conv2DBackpropFilter_:Que});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jM(a,r,o){if(o==null||o==="linear")return a;if(o==="relu")return Ue(a,Rv(r));throw new Error(`Cannot compute gradient for fused activation ${o}.`)}function YM(a,r){let o=r;const c=ys(a.shape,r.shape);return c.length>0&&(o=Bn(o,c)),Xe(o,a.shape)}function qM(a,r,o,c){if(r==="linear")return a;if(r==="relu")return Am(a);if(r==="elu")return Rw(a);if(r==="relu6")return hz(a);if(r==="prelu")return GM(a,o);if(r==="leakyrelu")return DM(a,c);if(r==="sigmoid")return k0(a);throw new Error(`Unknown fused activation ${r}.`)}const JM=(a,r)=>!(a>0)||r==="linear";/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kue({x:a,filter:r,strides:o,pad:c,dataFormat:h="NHWC",dilations:f=[1,1],dimRoundingMode:m,bias:y,activation:A="linear",preluActivationWeights:w,leakyreluAlpha:C}){if(A=A||"linear",JM(Ve.state.gradientDepth,A)===!1){b(h==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${h} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let ge=mm(a,r,o,c,h,f,m);return y!=null&&(ge=Ot(ge,y)),qM(ge,A,w,C)}const _=ke(a,"x","conv2d","float32"),T=ke(r,"filter","conv2d","float32");let B=_,O=!1;_.rank===3&&(O=!0,B=Xe(_,[1,_.shape[0],_.shape[1],_.shape[2]])),b(B.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${B.rank}.`),b(T.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${T.rank}.`),ha("fused conv2d",c,m);const U=h==="NHWC"?B.shape[3]:B.shape[1];b(T.shape[2]===U,()=>`Error in conv2d: depth of input (${U}) must match input depth for filter ${T.shape[2]}.`),b(fo(o,f),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${o} and dilations '${f}'`);const W=js(B.shape,T.shape,o,f,c,m);let z;y!=null&&(z=ke(y,"bias","fused conv2d"),[z]=Wr(z,_),h==="NHWC"?si(W.outShape,z.shape):(b(z.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${z.shape.length}.`),b(z.shape.length===0||z.shape[0]===W.outChannels||z.shape[0]===1,()=>`Error in fused conv2d: bias shape (${z.shape}) is not compatible with the number of output channels (${W.outChannels})`)));let X;if(w!=null){const ge=w.shape;if(b(ge.length<=1||ge.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${ge.length}.`),ge.length===1)b(ge[0]===1||ge[0]===W.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${ge}) is not compatible with the number of output channels (${W.outChannels}).`);else if(ge.length===3)try{si(ge,W.outShape)}catch{const ye=`Error in fused conv2d: PReLU activation weights (${ge}) is not compatible with the output shape of the conv2d (${W.outShape}).`;throw Error(ye)}X=ke(w,"prelu weights","fused conv2d")}const re=(ge,ye)=>{b(h==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${h} but only NHWC is currently supported.`);const[be,Se,Be,Ye]=ye,et=jM(ge,Be,A);b(fm(f),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${f}'`);const tt=MM(Se.shape,et,be,o,c),ot=ZM(Se,et,be.shape,o,c),st=[tt,ot];if(Ye!=null){const ct=YM(Ye,et);st.push(ct)}return st},se={x:B,filter:T,bias:z,preluActivationWeights:X},le={strides:o,pad:c,dataFormat:h,dilations:f,dimRoundingMode:m,activation:A,leakyreluAlpha:C};return y==null?P0((ge,ye,be)=>{let Se=Ve.runKernel(Nh,se,le);return be([ye,ge,Se]),O&&(Se=Xe(Se,[Se.shape[1],Se.shape[2],Se.shape[3]])),{value:Se,gradFunc:re}})(B,T):P0((ge,ye,be,Se)=>{let Be=Ve.runKernel(Nh,se,le);return Se([ye,ge,Be,be]),O&&(Be=Xe(Be,[Be.shape[1],Be.shape[2],Be.shape[3]])),{value:Be,gradFunc:re}})(B,T,z)}const Zue=He({fusedConv2d_:Kue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jue(a,r,o,c,h,f=[1,1],m){let y=a;a.rank===3&&(y=Xe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let A=r;A.rank===3&&(A=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const w={x:y,dy:A},C={strides:c,pad:h,dimRoundingMode:m,dilations:f,filterShape:o};return Ve.runKernel(hu,w,C)}const Yue=He({depthwiseConv2dNativeBackpropFilter_:jue});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function que(a,r,o,c,h,f=[1,1],m){let y=r,A=!1;r.rank===3&&(A=!0,y=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const w={dy:y,filter:o},C={strides:c,pad:h,dimRoundingMode:m,dilations:f,inputShape:a},_=Ve.runKernel(Ol,w,C);return A?Xe(_,[_.shape[1],_.shape[2],_.shape[3]]):_}const Jue=He({depthwiseConv2dNativeBackpropInput_:que});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ehe({a,b:r,transposeA:o=!1,transposeB:c=!1,bias:h,activation:f="linear",preluActivationWeights:m,leakyreluAlpha:y=.2}){if(JM(Ve.state.gradientDepth,f)===!1){let Be=$i(a,r,o,c);return h!=null&&(Be=Ot(Be,h)),qM(Be,f,m,y)}let A=ke(a,"a","fused matMul"),w=ke(r,"b","fused matMul");[A,w]=Wr(A,w);const C=o?A.shape[A.rank-2]:A.shape[A.rank-1],_=c?w.shape[w.rank-1]:w.shape[w.rank-2],T=o?A.shape[A.rank-1]:A.shape[A.rank-2],B=c?w.shape[w.rank-2]:w.shape[w.rank-1],O=A.shape.slice(0,-2),U=w.shape.slice(0,-2),W=M(O),z=M(U);b(C===_,()=>`Error in fused matMul: inner shapes (${C}) and (${_}) of Tensors with shapes ${A.shape} and ${w.shape} and transposeA=${o} and transposeB=${c} must match.`);const X=si(A.shape.slice(0,-2),w.shape.slice(0,-2)).concat([T,B]),re=o?Xe(A,[W,C,T]):Xe(A,[W,T,C]),se=c?Xe(w,[z,B,_]):Xe(w,[z,_,B]);let le;h!=null&&(le=ke(h,"bias","fused matMul"),[le]=Wr(le,A),si(X,le.shape));let ge;m!=null&&(ge=ke(m,"prelu weights","fused matMul"));const ye=(Be,Ye)=>{const[et,tt,ot,st]=Ye,ct=jM(Xe(Be,ot.shape),ot,f);let gt,mt;if(!o&&!c?(gt=$i(ct,tt,!1,!0),mt=$i(et,ct,!0,!1)):!o&&c?(gt=$i(ct,tt,!1,!1),mt=$i(ct,et,!0,!1)):o&&!c?(gt=$i(tt,ct,!1,!0),mt=$i(et,ct,!1,!1)):(gt=$i(tt,ct,!0,!0),mt=$i(ct,et,!0,!0)),h!=null){const bt=YM(st,ct);return[gt,mt,bt]}else return[gt,mt]},be={a:re,b:se,bias:le,preluActivationWeights:ge},Se={transposeA:o,transposeB:c,activation:f,leakyreluAlpha:y};return h==null?P0((Be,Ye,et)=>{const tt=Ve.runKernel(nf,be,Se);return et([Be,Ye,tt]),{value:Xe(tt,X),gradFunc:ye}})(re,se):P0((Be,Ye,et,tt)=>{const ot=Ve.runKernel(nf,be,Se);return tt([Be,Ye,ot,et]),{value:Xe(ot,X),gradFunc:ye}})(re,se,le)}const Ez=He({fusedMatMul_:ehe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function the(a,r,o,c,h="bilinear",f=0){const m=ke(a,"image","cropAndResize"),y=ke(r,"boxes","cropAndResize","float32"),A=ke(o,"boxInd","cropAndResize","int32"),w=y.shape[0];b(m.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${m.rank}.`),b(y.rank===2&&y.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${w},4] but had shape ${y.shape}.`),b(A.rank===1&&A.shape[0]===w,()=>`Error in cropAndResize: boxInd must be have size [${w}] but had shape ${y.shape}.`),b(c.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${c.length}.`),b(c[0]>=1&&c[1]>=1,()=>`cropSize must be atleast [1,1], but was ${c}`),b(h==="bilinear"||h==="nearest",()=>`method must be bilinear or nearest, but was ${h}`);const C={image:m,boxes:y,boxInd:A},_={method:h,extrapolationValue:f,cropSize:c};return Ve.runKernel(Ac,C,_)}const nhe=He({cropAndResize_:the});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ihe(a){const r=ke(a,"image","flipLeftRight","float32");b(r.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${r.rank}.`);const o={image:r};return Ve.runKernel(bi,o,{})}const rhe=He({flipLeftRight_:ihe});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function she(a){const r=ke(a,"image","grayscaleToRGB"),o=r.rank-1,c=r.shape[o];b(r.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${r.rank}.`),b(c===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${c}.`);const h=new Array(r.rank);return h.fill(1,0,o),h[o]=3,Rc(r,h)}const ohe=He({grayscaleToRGB_:she});/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ahe(a){const r=ke(a,"image","RGBToGrayscale"),o=r.rank-1,c=r.shape[o];b(r.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${r.rank}.`),b(c===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${c}.`);const h=r.dtype,f=pn(r,"float32"),m=za([.2989,.587,.114]);let y;switch(r.rank){case 2:y=_v("ij,j->i",f,m);break;case 3:y=_v("ijk,k->ij",f,m);break;case 4:y=_v("ijkl,l->ijk",f,m);break;case 5:y=_v("ijklm,m->ijkl",f,m);break;case 6:y=_v("ijklmn,n->ijklm",f,m);break;default:throw new Error("Not a valid tensor rank.")}return y=fa(y,-1),pn(y,h)}const lhe=He({rgbToGrayscale_:ahe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function che(a,r,o=0,c=.5){const h=ke(a,"image","rotateWithOffset","float32");b(h.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${h.rank}.`);const f={image:h},m={radians:r,fillValue:o,center:c};return Ve.runKernel(y0,f,m)}const uhe=He({rotateWithOffset_:che});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N0(a,r,o,c,h,f){c==null&&(c=.5),h==null&&(h=Number.NEGATIVE_INFINITY),f==null&&(f=0);const m=a.shape[0];return o=Math.min(o,m),b(0<=c&&c<=1,()=>`iouThreshold must be in [0, 1], but was '${c}'`),b(a.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${a.rank}'`),b(a.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${a.shape[1]}`),b(r.rank===1,()=>"scores must be a 1D tensor"),b(r.shape[0]===m,()=>`scores has incompatible shape with boxes. Expected ${m}, but was ${r.shape[0]}`),b(0<=f&&f<=1,()=>`softNmsSigma must be in [0, 1], but was '${f}'`),{maxOutputSize:o,iouThreshold:c,scoreThreshold:h,softNmsSigma:f}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hhe(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY){const f=ke(a,"boxes","nonMaxSuppression","float32"),m=ke(r,"scores","nonMaxSuppression","float32"),y=N0(f,m,o,c,h);o=y.maxOutputSize,c=y.iouThreshold,h=y.scoreThreshold;const A={maxOutputSize:o,iouThreshold:c,scoreThreshold:h};return Ve.runKernel(Cc,{boxes:f,scores:m},A)}const dhe=He({nonMaxSuppression_:hhe});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fhe(a,r,o){const c=phe(a,r,o),h=c<0?-(c+1):c;a.splice(h,0,r)}function phe(a,r,o){return ghe(a,r,o||mhe)}function mhe(a,r){return a>r?1:a<r?-1:0}function ghe(a,r,o){let c=0,h=a.length,f=0,m=!1;for(;c<h;){f=c+(h-c>>>1);const y=o(r,a[f]);y>0?c=f+1:(h=f,m=!y)}return m?c:-c-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ek(a,r,o,c,h){return ik(a,r,o,c,h,0)}function tk(a,r,o,c,h,f){return ik(a,r,o,c,h,0,!1,f,!0)}function nk(a,r,o,c,h,f){return ik(a,r,o,c,h,f,!0)}function ik(a,r,o,c,h,f,m=!1,y=!1,A=!1){const w=[];for(let W=0;W<r.length;W++)r[W]>h&&w.push({score:r[W],boxIndex:W,suppressBeginIndex:0});w.sort(_z);const C=f>0?-.5/f:0,_=[],T=[];for(;_.length<o&&w.length>0;){const W=w.pop(),{score:z,boxIndex:X,suppressBeginIndex:re}=W;if(z<h)break;let se=!1;for(let le=_.length-1;le>=re;--le){const ge=yhe(a,X,_[le]);if(ge>=c){se=!0;break}if(W.score=W.score*Ahe(c,C,ge),W.score<=h)break}W.suppressBeginIndex=_.length,se||(W.score===z?(_.push(X),T.push(W.score)):W.score>h&&fhe(w,W,_z))}const B=_.length,O=o-B;y&&O>0&&(_.push(...new Array(O).fill(0)),T.push(...new Array(O).fill(0)));const U={selectedIndices:_};return m&&(U.selectedScores=T),A&&(U.validOutputs=B),U}function yhe(a,r,o){const c=a.subarray(r*4,r*4+4),h=a.subarray(o*4,o*4+4),f=Math.min(c[0],c[2]),m=Math.min(c[1],c[3]),y=Math.max(c[0],c[2]),A=Math.max(c[1],c[3]),w=Math.min(h[0],h[2]),C=Math.min(h[1],h[3]),_=Math.max(h[0],h[2]),T=Math.max(h[1],h[3]),B=(y-f)*(A-m),O=(_-w)*(T-C);if(B<=0||O<=0)return 0;const U=Math.max(f,w),W=Math.max(m,C),z=Math.min(y,_),X=Math.min(A,T),re=Math.max(z-U,0)*Math.max(X-W,0);return re/(B+O-re)}function Ahe(a,r,o){const c=Math.exp(r*o*o);return o<=a?c:0}function _z(a,r){return a.score-r.score||a.score===r.score&&r.boxIndex-a.boxIndex}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function vhe(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY){const f=ke(a,"boxes","nonMaxSuppressionAsync"),m=ke(r,"scores","nonMaxSuppressionAsync"),y=N0(f,m,o,c,h);o=y.maxOutputSize,c=y.iouThreshold,h=y.scoreThreshold;const A=await Promise.all([f.data(),m.data()]),w=A[0],C=A[1],{selectedIndices:_}=ek(w,C,o,c,h);return f!==a&&f.dispose(),m!==r&&m.dispose(),za(_,"int32")}const bhe=vhe;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xhe(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY,f=0){const m=ke(a,"boxes","nonMaxSuppression"),y=ke(r,"scores","nonMaxSuppression"),A=N0(m,y,o,c,h,f);o=A.maxOutputSize,c=A.iouThreshold,h=A.scoreThreshold,f=A.softNmsSigma;const w={boxes:m,scores:y},C={maxOutputSize:o,iouThreshold:c,scoreThreshold:h,softNmsSigma:f},_=Ve.runKernel(ui,w,C);return{selectedIndices:_[0],selectedScores:_[1]}}const whe=He({nonMaxSuppressionWithScore_:xhe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function Che(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY,f=0){const m=ke(a,"boxes","nonMaxSuppressionAsync"),y=ke(r,"scores","nonMaxSuppressionAsync"),A=N0(m,y,o,c,h,f);o=A.maxOutputSize,c=A.iouThreshold,h=A.scoreThreshold,f=A.softNmsSigma;const w=await Promise.all([m.data(),y.data()]),C=w[0],_=w[1],{selectedIndices:T,selectedScores:B}=nk(C,_,o,c,h,f);return m!==a&&m.dispose(),y!==r&&y.dispose(),{selectedIndices:za(T,"int32"),selectedScores:za(B)}}const Ehe=Che;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _he(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY,f=!1){const m=ke(a,"boxes","nonMaxSuppression"),y=ke(r,"scores","nonMaxSuppression"),A=N0(m,y,o,c,h,null),w=A.maxOutputSize,C=A.iouThreshold,_=A.scoreThreshold,T={boxes:m,scores:y},B={maxOutputSize:w,iouThreshold:C,scoreThreshold:_,padToMaxOutputSize:f},O=Ve.runKernel(Th,T,B);return{selectedIndices:O[0],validOutputs:O[1]}}const Ihe=He({nonMaxSuppressionPadded_:_he});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/async function She(a,r,o,c=.5,h=Number.NEGATIVE_INFINITY,f=!1){const m=ke(a,"boxes","nonMaxSuppressionAsync"),y=ke(r,"scores","nonMaxSuppressionAsync"),A=N0(m,y,o,c,h,null),w=A.maxOutputSize,C=A.iouThreshold,_=A.scoreThreshold,[T,B]=await Promise.all([m.data(),y.data()]),{selectedIndices:O,validOutputs:U}=tk(T,B,w,C,_,f);return m!==a&&m.dispose(),y!==r&&y.dispose(),{selectedIndices:za(O,"int32"),validOutputs:Qi(U,"int32")}}const The=She;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mhe(a,r,o=!1,c=!1){const h=ke(a,"images","resizeBilinear");b(h.rank===3||h.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${h.rank}.`),b(r.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${r}.`),b(c===!1||o===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let f=h,m=!1;h.rank===3&&(m=!0,f=Xe(h,[1,h.shape[0],h.shape[1],h.shape[2]]));const y={images:f},A={alignCorners:o,halfPixelCenters:c,size:r},w=Ve.runKernel(xu,y,A);return m?Xe(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const Iz=He({resizeBilinear_:Mhe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function khe(a,r,o=!1,c=!1){const h=ke(a,"images","resizeNearestNeighbor");b(h.rank===3||h.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${h.rank}.`),b(r.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${r}.`),b(h.dtype==="float32"||h.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),b(c===!1||o===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let f=h,m=!1;h.rank===3&&(m=!0,f=Xe(h,[1,h.shape[0],h.shape[1],h.shape[2]]));const y={images:f},A={alignCorners:o,halfPixelCenters:c,size:r},w=Ve.runKernel(ko,y,A);return m?Xe(w,[w.shape[1],w.shape[2],w.shape[3]]):w}const Sz=He({resizeNearestNeighbor_:khe});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* https://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rhe(a,r="binary",o=!1,c=.5){const h=ke(a,"image","threshold"),f=.2989,m=.587,y=.114,A=h.shape[0]*h.shape[1];let w=Ue(za([c]),255),C,_,T,B;if(b(h.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${h.rank}.`),b(h.shape[2]===3||h.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${h.shape[2]}.`),b(h.dtype==="int32"||h.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${h.dtype}.`),b(r==="otsu"||r==="binary",()=>`Method must be binary or otsu, but was ${r}`),h.shape[2]===3){[C,_,T]=Al(h,[1,1,1],-1);const U=Ue(C,f),W=Ue(_,m),z=Ue(T,y);B=Ot(Ot(U,W),z)}else B=a;if(r==="otsu"){const U=kae(pn(dz(B),"int32"),pl([]),256);w=Lhe(U,A)}const O=o?B0(B,w):yl(B,w);return pn(Ue(O,255),"int32")}function Lhe(a,r){let o=za([-1]),c=za([0]),h=za([0]),f,m,y,A,w,C;for(let _=0;_<a.size-1;_++){f=ur(a,0,_+1),m=ur(a,_+1),w=Vn(Bn(f),r),C=Vn(Bn(m),r);const T=Bn(Ue(f,Mv(0,f.size)));y=Vn(T,Bn(f));const B=kw(m.shape,f.size),O=Ot(Mv(0,m.size),B),U=Ue(m,O);A=Vn(Bn(U),Bn(m));const W=Wn(y,A),z=Wn(y,A),X=Ue(w,C);h=Ue(Ue(X,W),z);const re=yl(h,c);c=Po(re,h,c),o=Po(re,za([_]),o)}return o}const Bhe=He({threshold_:Rhe});/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Phe(a,r,o="nearest",c="constant",h=0,f){const m=ke(a,"image","transform","float32"),y=ke(r,"transforms","transform","float32");b(m.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${m.rank}.`),b(y.rank===2&&(y.shape[0]===m.shape[0]||y.shape[0]===1)&&y.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),b(f==null||f.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${f}.`);const A={image:m,transforms:y},w={interpolation:o,fillMode:c,fillValue:h,outputShape:f};return Ve.runKernel(rm,A,w)}const Nhe=He({transform_:Phe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Dhe(a,r,o){const c=ke(a,"a","bandPart");b(c.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${c.rank}.`);const h=c.shape,[f,m]=c.shape.slice(-2);let y,A;typeof r=="number"?(b(r%1===0,()=>`bandPart(): numLower must be an integer, got ${r}.`),b(r<=f,()=>`bandPart(): numLower (${r}) must not be greater than the number of rows (${f}).`),y=ke(r<0?f:r,"numLower","bandPart")):(b(r.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),y=Po(Nw(r,0),f,Sv(r,f))),typeof o=="number"?(b(o%1===0,()=>`bandPart(): numUpper must be an integer, got ${o}.`),b(o<=m,()=>`bandPart(): numUpper (${o}) must not be greater than the number of columns (${m}).`),A=ke(o<0?m:o,"numUpper","bandPart")):(b(o.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),A=Po(Nw(o,0),m,Sv(o,m)));const w=Xe(Mv(0,f,1,"int32"),[-1,1]),C=Mv(0,m,1,"int32"),_=Wn(w,C),T=Hh(B0(_,y),gm(_,Xr(A))),B=Ns([f,m],c.dtype);return Xe(Pu(xm(Xe(c,[-1,f,m])).map(O=>Po(T,O,B))),h)}const Fhe=He({bandPart_:Dhe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ohe(a){let r;if(Array.isArray(a)){r=!1,b(a!=null&&a.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const h=a[0].shape[0];for(let f=1;f<a.length;++f)b(a[f].shape[0]===h,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${a[f].shape[0]} vs. ${h})`)}else r=!0,a=Al(a,a.shape[0],0).map(h=>kv(h,[0]));b(a.length<=a[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${a.length}) exceeds number of dimensions (${a[0].shape[0]}).`);const o=[],c=a;for(let h=0;h<a.length;++h)o.push(Ve.tidy(()=>{let f=c[h];if(h>0)for(let m=0;m<h;++m){const y=Ue(Bn(Ue(o[m],f)),o[m]);f=Wn(f,y)}return Vn(f,Bw(f,"euclidean"))}));return r?Pu(o,0):o}const Vhe=He({gramSchmidt_:Ohe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Uhe(a,r=!1){if(b(a.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${a.rank}`),a.rank===2)return Tz(a,r);{const o=a.shape.slice(0,a.shape.length-2).reduce((A,w)=>A*w),c=xm(Xe(a,[o,a.shape[a.shape.length-2],a.shape[a.shape.length-1]]),0),h=[],f=[];c.forEach(A=>{const[w,C]=Tz(A,r);h.push(w),f.push(C)});const m=Xe(Pu(h,0),a.shape),y=Xe(Pu(f,0),a.shape);return[m,y]}}function Tz(a,r=!1){return Ve.tidy(()=>{b(a.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${a.shape.length}D Tensor.`);const o=a.shape[0],c=a.shape[1];let h=YU(o),f=dm(a);const m=KM([[1]],[1,1]);let y=dm(m);const A=o>=c?c:o;for(let w=0;w<A;++w){const C=f,_=y,T=h;[y,f,h]=Ve.tidy(()=>{const B=ur(f,[w,w],[o-w,1]),O=Bw(B),U=ur(f,[w,w],[1,1]),W=Po(yl(U,0),KM([[-1]]),KM([[1]])),z=Wn(U,Ue(W,O)),X=Vn(B,z);X.shape[0]===1?y=dm(m):y=da([m,ur(X,[1,0],[X.shape[0]-1,X.shape[1]])],0);const re=Xr(Vn($i(W,z),O)),se=ur(f,[w,0],[o-w,c]),le=Ue(re,y),ge=Li(y);if(w===0)f=Wn(se,$i(le,$i(ge,se)));else{const Se=Wn(se,$i(le,$i(ge,se)));f=da([ur(f,[0,0],[w,c]),Se],0)}const ye=Li(le),be=ur(h,[0,w],[o,h.shape[1]-w]);if(w===0)h=Wn(be,$i($i(be,y),ye));else{const Se=Wn(be,$i($i(be,y),ye));h=da([ur(h,[0,0],[o,w]),Se],1)}return[y,f,h]}),vi([C,_,T])}return!r&&o>c&&(h=ur(h,[0,0],[o,c]),f=ur(f,[0,0],[c,c])),[h,f]})}const zhe=He({qr_:Uhe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xh={flipLeftRight:rhe,grayscaleToRGB:ohe,resizeNearestNeighbor:Sz,resizeBilinear:Iz,rgbToGrayscale:lhe,rotateWithOffset:uhe,cropAndResize:nhe,nonMaxSuppression:dhe,nonMaxSuppressionAsync:bhe,nonMaxSuppressionWithScore:whe,nonMaxSuppressionWithScoreAsync:Ehe,nonMaxSuppressionPadded:Ihe,nonMaxSuppressionPaddedAsync:The,threshold:Bhe,transform:Nhe},Ghe={bandPart:Fhe,gramSchmidt:Vhe,qr:zhe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Whe=new Map,Hhe=new Map;class D0{getClassName(){return this.constructor.className}static fromConfig(r,o){return new r(o)}}class $l{constructor(){this.classNameMap={}}static getMap(){return $l.instance==null&&($l.instance=new $l),$l.instance}static register(r){$l.getMap().classNameMap[r.className]=[r,r.fromConfig]}}function Mt(a,r,o){b(a.className!=null,()=>"Class being registered does not have the static className property defined."),b(typeof a.className=="string",()=>"className is required to be a string, but got type "+typeof a.className),b(a.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof r>"u"&&(r="Custom"),typeof o>"u"&&(o=a.className);const c=o,h=r+">"+c;return $l.register(a),Whe.set(h,a),Hhe.set(a,h),a}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class gf extends D0{minimize(r,o=!1,c){const{value:h,grads:f}=this.computeGradients(r,c);if(c!=null){const m=c.map(y=>({name:y.name,tensor:f[y.name]}));this.applyGradients(m)}else this.applyGradients(f);return vi(f),o?h:(h.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(r,o){return qle(r,o)}dispose(){this.iterations_!=null&&vi(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Qi(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(r){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(r){return this.iterations_=(await r[0].tensor.data())[0],r.slice(1)}}Object.defineProperty(gf,Symbol.hasInstance,{value:a=>a.minimize!=null&&a.computeGradients!=null&&a.applyGradients!=null});/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Mz extends gf{static get className(){return"Adadelta"}constructor(r,o,c=null){super(),this.learningRate=r,this.rho=o,this.epsilon=c,this.accumulatedGrads=[],this.accumulatedUpdates=[],c==null&&(this.epsilon=Ve.backend.epsilon())}applyGradients(r){(Array.isArray(r)?r.map(o=>o.name):Object.keys(r)).forEach((o,c)=>{const h=Ve.registeredVariables[o],f=!1;this.accumulatedGrads[c]==null&&(this.accumulatedGrads[c]={originalName:`${o}/accum_grad`,variable:Qe(()=>Ri(h).variable(f))}),this.accumulatedUpdates[c]==null&&(this.accumulatedUpdates[c]={originalName:`${o}/accum_var`,variable:Qe(()=>Ri(h).variable(f))});const m=Array.isArray(r)?r[c].tensor:r[o];if(m==null)return;const y=this.accumulatedGrads[c].variable,A=this.accumulatedUpdates[c].variable;Qe(()=>{const w=Ot(Ue(y,this.rho),Ue(gr(m),1-this.rho)),C=Ue(Vn(No(Ot(A,this.epsilon)),No(Ot(y,this.epsilon))),m),_=Ot(Ue(A,this.rho),Ue(gr(C),1-this.rho));y.assign(w),A.assign(_);const T=Ot(Ue(C,-this.learningRate),h);h.assign(T)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(vi(this.accumulatedGrads.map(r=>r.variable)),vi(this.accumulatedUpdates.map(r=>r.variable)))}async getWeights(){const r=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(r.map(o=>({name:o.originalName,tensor:o.variable})))}async setWeights(r){r=await this.extractIterations(r);const o=r.length/2,c=!1;this.accumulatedGrads=r.slice(0,o).map(h=>({originalName:h.name,variable:h.tensor.variable(c)})),this.accumulatedUpdates=r.slice(o,o*2).map(h=>({originalName:h.name,variable:h.tensor.variable(c)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(r,o){return new r(o.learningRate,o.rho,o.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class kz extends gf{static get className(){return"Adagrad"}constructor(r,o=.1){super(),this.learningRate=r,this.initialAccumulatorValue=o,this.accumulatedGrads=[]}applyGradients(r){(Array.isArray(r)?r.map(o=>o.name):Object.keys(r)).forEach((o,c)=>{const h=Ve.registeredVariables[o];this.accumulatedGrads[c]==null&&(this.accumulatedGrads[c]={originalName:`${o}/accumulator`,variable:Qe(()=>kw(h.shape,this.initialAccumulatorValue).variable(!1))});const f=Array.isArray(r)?r[c].tensor:r[o];if(f==null)return;const m=this.accumulatedGrads[c].variable;Qe(()=>{const y=Ot(m,gr(f));m.assign(y);const A=Ot(Ue(Vn(f,No(Ot(y,Ve.backend.epsilon()))),-this.learningRate),h);h.assign(A)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&vi(this.accumulatedGrads.map(r=>r.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(r){r=await this.extractIterations(r);const o=!1;this.accumulatedGrads=r.map(c=>({originalName:c.name,variable:c.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(r,o){return new r(o.learningRate,o.initialAccumulatorValue)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Rz extends gf{static get className(){return"Adam"}constructor(r,o,c,h=null){super(),this.learningRate=r,this.beta1=o,this.beta2=c,this.epsilon=h,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],Qe(()=>{this.accBeta1=Qi(o).variable(),this.accBeta2=Qi(c).variable()}),h==null&&(this.epsilon=Ve.backend.epsilon())}applyGradients(r){const o=Array.isArray(r)?r.map(c=>c.name):Object.keys(r);Qe(()=>{const c=Wn(1,this.accBeta1),h=Wn(1,this.accBeta2);o.forEach((f,m)=>{const y=Ve.registeredVariables[f],A=!1;this.accumulatedFirstMoment[m]==null&&(this.accumulatedFirstMoment[m]={originalName:`${f}/m`,variable:Qe(()=>Ri(y).variable(A))}),this.accumulatedSecondMoment[m]==null&&(this.accumulatedSecondMoment[m]={originalName:`${f}/v`,variable:Qe(()=>Ri(y).variable(A))});const w=Array.isArray(r)?r[m].tensor:r[f];if(w==null)return;const C=this.accumulatedFirstMoment[m].variable,_=this.accumulatedSecondMoment[m].variable,T=Ot(Ue(C,this.beta1),Ue(w,1-this.beta1)),B=Ot(Ue(_,this.beta2),Ue(gr(w),1-this.beta2)),O=Vn(T,c),U=Vn(B,h);C.assign(T),_.assign(B);const W=Ot(Ue(Vn(O,Ot(No(U),this.epsilon)),-this.learningRate),y);y.assign(W)}),this.accBeta1.assign(Ue(this.accBeta1,this.beta1)),this.accBeta2.assign(Ue(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&vi(this.accumulatedFirstMoment.map(r=>r.variable)),this.accumulatedSecondMoment!=null&&vi(this.accumulatedSecondMoment.map(r=>r.variable))}async getWeights(){const r=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(r.map(o=>({name:o.originalName,tensor:o.variable})))}async setWeights(r){r=await this.extractIterations(r),Qe(()=>{this.accBeta1.assign(L0(this.beta1,this.iterations_+1)),this.accBeta2.assign(L0(this.beta2,this.iterations_+1))});const o=r.length/2,c=!1;this.accumulatedFirstMoment=r.slice(0,o).map(h=>({originalName:h.name,variable:h.tensor.variable(c)})),this.accumulatedSecondMoment=r.slice(o,o*2).map(h=>({originalName:h.name,variable:h.tensor.variable(c)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(r,o){return new r(o.learningRate,o.beta1,o.beta2,o.epsilon)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Lz extends gf{static get className(){return"Adamax"}constructor(r,o,c,h=null,f=0){super(),this.learningRate=r,this.beta1=o,this.beta2=c,this.epsilon=h,this.decay=f,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],Qe(()=>{this.iteration=Qi(0).variable(),this.accBeta1=Qi(o).variable()}),h==null&&(this.epsilon=Ve.backend.epsilon())}applyGradients(r){const o=Array.isArray(r)?r.map(c=>c.name):Object.keys(r);Qe(()=>{const c=Wn(1,this.accBeta1),h=Vn(-this.learningRate,Ot(Ue(this.iteration,this.decay),1));o.forEach((f,m)=>{const y=Ve.registeredVariables[f],A=!1;this.accumulatedFirstMoment[m]==null&&(this.accumulatedFirstMoment[m]={originalName:`${f}/m`,variable:Ri(y).variable(A)}),this.accumulatedWeightedInfNorm[m]==null&&(this.accumulatedWeightedInfNorm[m]={originalName:`${f}/v`,variable:Ri(y).variable(A)});const w=Array.isArray(r)?r[m].tensor:r[f];if(w==null)return;const C=this.accumulatedFirstMoment[m].variable,_=this.accumulatedWeightedInfNorm[m].variable,T=Ot(Ue(C,this.beta1),Ue(w,1-this.beta1)),B=Ue(_,this.beta2),O=Bo(w),U=pf(B,O);C.assign(T),_.assign(U);const W=Ot(Ue(Vn(h,c),Vn(T,Ot(U,this.epsilon))),y);y.assign(W)}),this.iteration.assign(Ot(this.iteration,1)),this.accBeta1.assign(Ue(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&vi(this.accumulatedFirstMoment.map(r=>r.variable)),this.accumulatedWeightedInfNorm!=null&&vi(this.accumulatedWeightedInfNorm.map(r=>r.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(r){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(r,o){return new r(o.learningRate,o.beta1,o.beta2,o.epsilon,o.decay)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class rk extends gf{static get className(){return"SGD"}constructor(r){super(),this.learningRate=r,this.setLearningRate(r)}applyGradients(r){(Array.isArray(r)?r.map(o=>o.name):Object.keys(r)).forEach((o,c)=>{const h=Array.isArray(r)?r[c].tensor:r[o];if(h==null)return;const f=Ve.registeredVariables[o];Qe(()=>{const m=Ot(Ue(this.c,h),f);f.assign(m)})}),this.incrementIterations()}setLearningRate(r){this.learningRate=r,this.c!=null&&this.c.dispose(),this.c=ml(Qi(-r))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(r){if(r=await this.extractIterations(r),r.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(r,o){return new r(o.learningRate)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Bz extends rk{static get className(){return"Momentum"}constructor(r,o,c=!1){super(r),this.learningRate=r,this.momentum=o,this.useNesterov=c,this.accumulations=[],this.m=Qi(this.momentum)}applyGradients(r){(Array.isArray(r)?r.map(o=>o.name):Object.keys(r)).forEach((o,c)=>{const h=Ve.registeredVariables[o];this.accumulations[c]==null&&(this.accumulations[c]={originalName:`${o}/momentum`,variable:Qe(()=>Ri(h).variable(!1))});const f=this.accumulations[c].variable,m=Array.isArray(r)?r[c].tensor:r[o];m!=null&&Qe(()=>{let y;const A=Ot(Ue(this.m,f),m);this.useNesterov?y=Ot(Ue(this.c,Ot(m,Ue(A,this.m))),h):y=Ot(Ue(this.c,A),h),f.assign(A),h.assign(y)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&vi(this.accumulations.map(r=>r.variable))}setMomentum(r){this.momentum=r}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(r){r=await this.extractIterations(r);const o=!1;this.accumulations=r.map(c=>({originalName:c.name,variable:c.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(r,o){return new r(o.learningRate,o.momentum,o.useNesterov)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Pz extends gf{static get className(){return"RMSProp"}constructor(r,o=.9,c=0,h=null,f=!1){if(super(),this.learningRate=r,this.decay=o,this.momentum=c,this.epsilon=h,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=f,h==null&&(this.epsilon=Ve.backend.epsilon()),r==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(r){(Array.isArray(r)?r.map(o=>o.name):Object.keys(r)).forEach((o,c)=>{const h=Ve.registeredVariables[o],f=!1;this.accumulatedMeanSquares[c]==null&&(this.accumulatedMeanSquares[c]={originalName:`${o}/rms`,variable:Qe(()=>Ri(h).variable(f))}),this.accumulatedMoments[c]==null&&(this.accumulatedMoments[c]={originalName:`${o}/momentum`,variable:Qe(()=>Ri(h).variable(f))}),this.accumulatedMeanGrads[c]==null&&this.centered&&(this.accumulatedMeanGrads[c]={originalName:`${o}/mg`,variable:Qe(()=>Ri(h).variable(f))});const m=Array.isArray(r)?r[c].tensor:r[o];if(m==null)return;const y=this.accumulatedMeanSquares[c].variable,A=this.accumulatedMoments[c].variable;Qe(()=>{const w=Ot(Ue(y,this.decay),Ue(gr(m),1-this.decay));if(this.centered){const C=this.accumulatedMeanGrads[c].variable,_=Ot(Ue(C,this.decay),Ue(m,1-this.decay)),T=Vn(Ue(m,this.learningRate),No(Wn(w,Ot(gr(_),this.epsilon)))),B=Ot(Ue(A,this.momentum),T);y.assign(w),C.assign(_),A.assign(B);const O=Wn(h,B);h.assign(O)}else{const C=Ot(Ue(y,this.decay),Ue(gr(m),1-this.decay)),_=Ot(Ue(A,this.momentum),Vn(Ue(m,this.learningRate),No(Ot(C,this.epsilon))));y.assign(C),A.assign(_);const T=Wn(h,_);h.assign(T)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&vi(this.accumulatedMeanSquares.map(r=>r.variable)),this.accumulatedMeanGrads!=null&&this.centered&&vi(this.accumulatedMeanGrads.map(r=>r.variable)),this.accumulatedMoments!=null&&vi(this.accumulatedMoments.map(r=>r.variable))}async getWeights(){const r=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&r.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(r.map(o=>({name:o.originalName,tensor:o.variable})))}async setWeights(r){r=await this.extractIterations(r);const o=this.centered?r.length/3:r.length/2,c=!1;this.accumulatedMeanSquares=r.slice(0,o).map(h=>({originalName:h.name,variable:h.tensor.variable(c)})),this.accumulatedMoments=r.slice(o,o*2).map(h=>({originalName:h.name,variable:h.tensor.variable(c)})),this.centered&&(this.accumulatedMeanGrads=r.slice(o*2,o*3).map(h=>({originalName:h.name,variable:h.tensor.variable(c)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(r,o){return new r(o.learningRate,o.decay,o.momentum,o.epsilon,o.centered)}}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xhe=[Mz,kz,Rz,Lz,Bz,Pz,rk];function $he(){for(const a of Xhe)Mt(a)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/let wm;function Qhe(a,r=3){if(r>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(a==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let o=!1,c=!1,h=!1,f=!1,m=!1,y=!1;if(a.data instanceof Uint8Array)o=!0;else if(typeof ImageData<"u"&&a instanceof ImageData)c=!0;else if(typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement)h=!0;else if(typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement)f=!0;else if(a.getContext!=null)m=!0;else if(typeof ImageBitmap<"u"&&a instanceof ImageBitmap)y=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${a.constructor.name}`);if(v0(tf,Ve.backendName)!=null){const T={pixels:a},B={numChannels:r};return Ve.runKernel(tf,T,B)}const[A,w]=h?[a.videoWidth,a.videoHeight]:[a.width,a.height];let C;if(m)C=a.getContext("2d").getImageData(0,0,A,w).data;else if(c||o)C=a.data;else if(f||h||y){if(wm==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")wm=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else wm=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});wm.canvas.width=A,wm.canvas.height=w,wm.drawImage(a,0,0,A,w),C=wm.getImageData(0,0,A,w).data}let _;if(r===4)_=new Int32Array(C);else{const T=A*w;_=new Int32Array(T*r);for(let B=0;B<T;B++)for(let O=0;O<r;++O)_[B*r+O]=C[B*4+O]}return Bue(_,[w,A,r],"int32")}const Khe=He({fromPixels_:Qhe});function sk(a,r){const o=a.shape.length,c=r.shape.length;if(o<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${o}.`);if(c<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${c}.`);if(r.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${r.dtype}.`);if(r.shape[c-1]>o)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${r.shape[c-1]} vs. ${o}`);if(M(a.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${a.shape}.`);const h=r.shape,f=h[h.length-1];let m=1;for(let _=0;_<h.length-1;++_)m*=h[_];const y=a.shape,A=h.slice();A.pop();let w=1;for(let _=f;_<o;++_)w*=y[_],A.push(y[_]);const C=[...Ie(a.shape).map(_=>_/w),1].slice(0,f);return[A,m,w,C]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ok=-2,Zhe=-1;function ak(a,r,o){const c=a.shape.length;b(c===r.length,()=>`Error in slice${c}D: Length of begin ${r} must match the rank of the array (${c}).`),b(c===o.length,()=>`Error in slice${c}D: Length of size ${o} must match the rank of the array (${c}).`);for(let h=0;h<c;++h)b(r[h]+o[h]<=a.shape[h],()=>`Error in slice${c}D: begin[${h}] + size[${h}] (${r[h]+o[h]}) would overflow input.shape[${h}] (${a.shape[h]})`)}function jhe(a){const r=[];let o=0;for(;a>0;)a&1&&r.push(o),a/=2,o++;return r}function lk(a,r,o){const c=[];for(let h=0;h<a.length;h++)c[h]=Math.ceil((r[h]-a[h])/o[h]);return c}function Nz(a,r,o,c){const h=[...a];for(let f=h.length;f<c.length;f++)h.push(1);for(let f=0;f<o;f++)f===0?h[r]=1:(h.splice(r,0,1),h.pop());return h}function Dz(a,r,o){return o<=a?o:o-(r-1)}function Fz(a,r){const o=[];for(let c=0;c<a;c++)o.push(r+c);return o}function Yhe(a,r,o,c,h,f,m,y,A){const w=a.length;let C=new Array(w),_=new Array(w),T=new Array(w);if(r.length&&o>0){const B=r[0],O=o+1;C=Oz(m,B,O,c,a),_=Vz(y,B,O,h,a),T=Nz(f,B,O,a)}else for(let B=0;B<w;B++)C[B]=zz(m,c,f,a,B,A),_[B]=Gz(y,h,f,a,B,A),T[B]=Uz(f,B,A);return{begin:C,end:_,strides:T}}function Oz(a,r,o,c,h){const f=[...h],m=Fz(o,r);for(let y=0;y<f.length;y++)if(m.indexOf(y)>-1)f[y]=0;else{const A=Dz(r,o,y);let w=c[A];a&1<<A&&(w=0),f[y]=w}return f}function Vz(a,r,o,c,h){const f=[...h],m=Fz(o,r);for(let y=0;y<f.length;y++)if(m.indexOf(y)>-1)f[y]=Number.MAX_SAFE_INTEGER;else{const A=Dz(r,o,y);let w=c[A];a&1<<A&&(w=Number.MAX_SAFE_INTEGER),f[y]=w}for(let y=0;y<f.length;y++){const A=h[y];f[y]<0&&(f[y]+=A),f[y]=d(0,f[y],h[y])}return f}function Uz(a,r,o){let c=a[r];return(o&1<<r||c==null)&&(c=1),c}function zz(a,r,o,c,h,f){let m=r[h];const y=o[h]||1;(a&1<<h||f&1<<h||m==null)&&(y>0?m=Number.MIN_SAFE_INTEGER:m=Number.MAX_SAFE_INTEGER);const A=c[h];return m<0&&(m+=A),m=d(0,m,A-1),m}function Gz(a,r,o,c,h,f){let m=r[h];const y=o[h]||1;(a&1<<h||f&1<<h||m==null)&&(y>0?m=Number.MAX_SAFE_INTEGER:m=Number.MIN_SAFE_INTEGER);const A=c[h];return m<0&&(m+=A),y>0?m=d(0,m,A):m=d(-1,m,A-1),m}function ck(a,r,o){let c=o.length;for(let h=0;h<o.length;h++)if(o[h]>1){c=h;break}for(let h=c+1;h<o.length;h++)if(r[h]>0||o[h]!==a[h])return!1;return!0}function uk(a,r){let o=a.length>0?a[a.length-1]:1;for(let c=0;c<a.length-1;c++)o+=a[c]*r[c];return o}function Vw(a,r,o){let c;const h=a.shape.length;typeof r=="number"?c=[r,...new Array(h-1).fill(0)]:r.length<h?c=r.concat(new Array(h-r.length).fill(0)):c=r.slice(),c.forEach(m=>{b(m!==-1,()=>"slice() does not support negative begin indexing.")});let f;return o==null?f=new Array(h).fill(-1):typeof o=="number"?f=[o,...new Array(h-1).fill(-1)]:o.length<h?f=o.concat(new Array(h-o.length).fill(-1)):f=o,f=f.map((m,y)=>m>=0?m:(b(m===-1,()=>`Negative size values should be exactly -1 but got ${m} for the slice() size at index ${y}.`),a.shape[y]-c[y])),[c,f]}function hk(a,r,o,c,h,f,m,y,A){let w;if(c==null?(w=new Array(r.length),w.fill(1)):w=c,m!=null&&m&m-1)throw new Error("Multiple ellipses in slice is not allowed.");let C=!1;const _={dims:w.length,numAddAxisAfterEllipsis:0,begin:r.slice(),end:o.slice(),strides:w.slice(),beginMask:h,endMask:f,ellipsisMask:m,newAxisMask:y,shrinkAxisMask:A};for(let X=0;X<_.dims;X++)C&&1<<X&y&&_.numAddAxisAfterEllipsis++,1<<X&m&&(C=!0);C||(_.ellipsisMask|=1<<_.dims,_.dims++);const T={dims:a.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};qhe(_,T);let B=!0,O=!0,U=!0;const W=[],z=[];for(let X=0;X<a.length;++X){if(T.strides[X]===0)throw Error(`strides[${X}] must be non-zero`);const re=!!(T.shrinkAxisMask&1<<X),se=a[X];if(se===-1){W.push(re?1:-1);continue}const le=[T.beginMask&1<<X,T.endMask&1<<X],ge=[T.strides[X]>0?0:-1,T.strides[X]>0?se:se-1];if(re&&T.strides[X]<=0)throw Error("only stride 1 allowed on non-range indexing.");U=U&&T.strides[X]===1;const ye=!!(T.beginMask&1<<X&&T.endMask&1<<X);if(T.beginValid&&T.endValid){if(re){const Ye=T.begin[X]<0?se+T.begin[X]:T.begin[X];if(T.begin[X]=Ye,T.end[X]=T.begin[X]+1,Ye<0||Ye>=se)throw Error(`slice index ${T.begin[X]} of dimension ${X} out of bounds.`)}else T.begin[X]=Wz(T.begin[X],0,T.strides[X],se,le,ge),T.end[X]=Wz(T.end[X],1,T.strides[X],se,le,ge);const Be=T.strides[X]===1&&T.begin[X]===0&&T.end[X]===se;B=B&&Be,O=O&&(X===0&&T.strides[X]===1||Be)}else B=B&&T.strides[X]===1&&ye,O=O&&(X===0&&T.strides[X]===1||ye);let be,Se=!1;if(T.beginValid&&T.endValid?(be=T.end[X]-T.begin[X],Se=!0):re?(be=1,Se=!0):ye&&se>=0&&(T.strides[X]<0?be=-se:be=se,Se=!0),Se){let Be;be===0||be<0!=T.strides[X]<0?Be=0:Be=Math.trunc(be/T.strides[X])+(be%T.strides[X]!==0?1:0),W.push(Be)}else W.push(-1)}for(let X=0;X<T.finalShapeGatherIndices.length;++X){const re=T.finalShapeGatherIndices[X];re>=0?z.push(W[re]):re===ok&&z.push(1)}return{finalShapeSparse:z.filter((X,re)=>T.finalShapeGatherIndices[re]!==ok),finalShape:z,isIdentity:B,sliceDim0:O,isSimpleSlice:U,begin:T.begin,end:T.end,strides:T.strides}}function qhe(a,r){r.beginMask=0,r.endMask=0,r.shrinkAxisMask=0;let o=0;r.beginValid=a.begin!=null,r.endValid=a.end!=null,r.begin=new Array(r.dims),r.end=new Array(r.dims),r.strides=new Array(r.dims),r.finalShapeGatherIndices=[],r.finalShapeGatherIndicesSparse=[],r.inputShapeGatherIndicesSparse=new Array(r.dims);for(let c=0;c<a.dims;c++)if(1<<c&a.ellipsisMask){const h=Math.min(r.dims-(a.dims-c)+1+a.numAddAxisAfterEllipsis,r.dims);for(;o<h;o++)r.begin[o]=0,r.end[o]=0,r.strides[o]=1,r.beginMask|=1<<o,r.endMask|=1<<o,r.finalShapeGatherIndices.push(o),r.finalShapeGatherIndicesSparse.push(-1),r.inputShapeGatherIndicesSparse[o]=c}else if(1<<c&a.newAxisMask)r.finalShapeGatherIndices.push(ok),r.finalShapeGatherIndicesSparse.push(-1);else{if(o===r.begin.length)throw Error(`Index out of range using input dim ${o}; input has only ${r.dims} dims, ${r.begin.length}.`);a.begin!=null&&(r.begin[o]=a.begin[c]),a.end!=null&&(r.end[o]=a.end[c]),r.strides[o]=a.strides[c],a.beginMask&1<<c&&(r.beginMask|=1<<o),a.endMask&1<<c&&(r.endMask|=1<<o),a.shrinkAxisMask&1<<c?(r.finalShapeGatherIndices.push(Zhe),r.finalShapeGatherIndicesSparse.push(-1),r.shrinkAxisMask|=1<<o):(r.finalShapeGatherIndices.push(o),r.finalShapeGatherIndicesSparse.push(c)),r.inputShapeGatherIndicesSparse[o]=c,o++}}function Wz(a,r,o,c,h,f){if(h[r])return o>0?f[r]:f[r+1&1];{const m=a<0?c+a:a;return m<f[0]?f[0]:m>f[1]?f[1]:m}}const Jhe=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:ak,computeFlatOffset:uk,computeOutShape:lk,getNormalizedAxes:Yhe,isSliceContinous:ck,maskToAxes:jhe,parseSliceParams:Vw,sliceInfo:hk,startForAxis:zz,startIndicesWithElidedDims:Oz,stopForAxis:Gz,stopIndicesWithElidedDims:Vz,stridesForAxis:Uz,stridesWithElidedDims:Nz},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ede{static sgd(r){return new rk(r)}static momentum(r,o,c=!1){return new Bz(r,o,c)}static rmsprop(r,o=.9,c=0,h=null,f=!1){return new Pz(r,o,c,h,f)}static adam(r=.001,o=.9,c=.999,h=null){return new Rz(r,o,c,h)}static adadelta(r=.001,o=.95,c=null){return new Mz(r,o,c)}static adamax(r=.002,o=.9,c=.999,h=null,f=0){return new Lz(r,o,c,h,f)}static adagrad(r,o=.1){return new kz(r,o)}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const F0=ede;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tde=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:a=>a();function Uw(){return new Promise(a=>tde(()=>a()))}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dk(a,r){const o=a[0].length;a.forEach((h,f)=>{b(h.length===o,()=>`Error in concat${o}D: rank of tensors[${f}] must be the same as the rank of the rest (${o})`)}),b(r>=0&&r<o,()=>`Error in concat${o}D: axis must be between 0 and ${o-1}.`);const c=a[0];a.forEach((h,f)=>{for(let m=0;m<o;m++)b(m===r||h[m]===c[m],()=>`Error in concat${o}D: Shape of tensors[${f}] (${h}) does not match the shape of the rest (${c}) along the non-concatenated axis ${f}.`)})}function Nu(a,r){const o=a[0].slice();for(let c=1;c<a.length;c++)o[r]+=a[c][r];return o}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Lc;(function(a){a[a.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",a[a.VALUE_ROWIDS=1]="VALUE_ROWIDS",a[a.ROW_LENGTHS=2]="ROW_LENGTHS",a[a.ROW_SPLITS=3]="ROW_SPLITS",a[a.ROW_LIMITS=4]="ROW_LIMITS",a[a.ROW_STARTS=5]="ROW_STARTS"})(Lc||(Lc={}));function Hz(a,r,o){let c=new Array;if(o==null&&r==null)return c;if(r==null)for(;c.length<a+o.length;)c.push(-1);else c=r.slice();if(o==null)return c;if(a+o.length!==c.length)throw new Error(`rt input.shape and shape=${r} are incompatible: rt input.rank = ${a+o.length}, but shape.rank = ${c.length}`);for(let h=1;h<o.length;++h){const f=o[h],m=c[c.length-o.length+h],y=c[m];if(f>=0)if(y>=0){if(y!==f)throw new Error(`rt input.shape and shape=${r} are incompatible: rt input.shape[${h+a}] = ${f} but shape[${h+a}] = ${y}`)}else c[m]=f}return c}function Xz(a){const r={FIRST_DIM_SIZE:Lc.FIRST_DIM_SIZE,VALUE_ROWIDS:Lc.VALUE_ROWIDS,ROW_LENGTHS:Lc.ROW_LENGTHS,ROW_SPLITS:Lc.ROW_SPLITS,ROW_LIMITS:Lc.ROW_LIMITS,ROW_STARTS:Lc.ROW_STARTS},o=[];for(const c of a)if(c in r)o.push(r[c]);else break;return o}function $z(a){return a.length===0?0:a[0]===Lc.FIRST_DIM_SIZE?a.length-1:a.length}function Qz(a,r){if(a==null||r==null)return;const o=a.length,c=r.length;if(o>=c)throw new Error(`defaultValue.shape=${a} and ragged tensor flatValues.shape=${r}, are incompatible: defaultValue.rank = ${o} must be less than ragged tensor input flatValues.rank = ${c})`);for(let h=0;h<Math.min(o,c-1);++h){const f=a[h],m=r[h+1];if(f>=0&&m>=0&&f!==1&&f!==m)throw new Error(`defaultValue.shape=${a}, and ragged tensor input flatValues.shape=${r} are incompatible: defaultValue.shape[${h-a.length}] = ${f} but ragged tensor input.flatValues.shape[${h-a.length}] = ${m}`)}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fk=30;function zw(a){return a<=fk?a:Fe(a,Math.floor(Math.sqrt(a)))}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pk(a,r,o){const c=o*(typeof a=="number"?a:a[0]),h=r*(typeof a=="number"?a:a[1]);return[c,h]}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Lv(a,r,o,c=!0){let h=[];if(c)h=h.concat(r.slice(0)),h.push(a[0]/o),h=h.concat(a.slice(1));else{h=h.concat(a[0]);const f=r.length;for(let m=0;m<f;++m)h=h.concat([a[m+1]/r[m],r[m]]);h=h.concat(a.slice(f+1))}return h}function Bv(a,r,o=!0){const c=[];if(o){c.push(r);for(let h=r+1;h<a;++h)h<=2*r?(c.push(h),c.push(h-(r+1))):c.push(h)}else{const h=[],f=[];for(let m=1;m<a;++m)m>=r*2+1||m%2===1?f.push(m):h.push(m);c.push(...h),c.push(0),c.push(...f)}return c}function Pv(a,r,o,c=!0){const h=[];c?h.push(a[0]/o):h.push(a[0]*o);for(let f=1;f<a.length;++f)f<=r.length?c?h.push(r[f-1]*a[f]):h.push(a[f]/r[f-1]):h.push(a[f]);return h}function mk(a,r){const o=[0];for(let c=0;c<r;++c)o.push(a[c][0]);return o}function gk(a,r,o){const c=a.slice(0,1);for(let h=0;h<o;++h)c.push(a[h+1]-r[h][0]-r[h][1]);return c}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gw=1.7580993408473768,Ww=1.0507009873554805;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yk=.3275911,Ak=.254829592,vk=-.284496736,bk=1.421413741,xk=-1.453152027,wk=1.061405429;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $h(a,r){if(a.length!==r.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${a.length}, imag: ${r.length}.`);const o=new Float32Array(a.length*2);for(let c=0;c<o.length;c+=2)o[c]=a[c/2],o[c+1]=r[c/2];return o}function Kz(a){const r=new Float32Array(a.length/2),o=new Float32Array(a.length/2);for(let c=0;c<a.length;c+=2)r[c/2]=a[c],o[c/2]=a[c+1];return{real:r,imag:o}}function Zz(a){const r=Math.ceil(a.length/4),o=new Float32Array(r),c=new Float32Array(r);for(let h=0;h<a.length;h+=4)o[Math.floor(h/4)]=a[h],c[Math.floor(h/4)]=a[h+1];return{real:o,imag:c}}function jz(a){const r=Math.floor(a.length/4),o=new Float32Array(r),c=new Float32Array(r);for(let h=2;h<a.length;h+=4)o[Math.floor(h/4)]=a[h],c[Math.floor(h/4)]=a[h+1];return{real:o,imag:c}}function Ck(a,r){const o=a[r*2],c=a[r*2+1];return{real:o,imag:c}}function Yz(a,r,o,c){a[c*2]=r,a[c*2+1]=o}function qz(a,r){const o=new Float32Array(a/2),c=new Float32Array(a/2);for(let h=0;h<Math.ceil(a/2);h++){const f=(r?2:-2)*Math.PI*(h/a);o[h]=Math.cos(f),c[h]=Math.sin(f)}return{real:o,imag:c}}function Jz(a,r,o){const c=(o?2:-2)*Math.PI*(a/r),h=Math.cos(c),f=Math.sin(c);return{real:h,imag:f}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ek="->",nde=/->/g,eG=",",tG="...";function _k(a,r){a=a.replace(/\s/g,"");const o=(a.length-a.replace(nde,"").length)/Ek.length;if(o<1)throw new Error("Equations without an arrow are not supported.");if(o>1)throw new Error(`Equation must contain exactly one arrow ("${Ek}").`);const[c,h]=a.split(Ek);b(c.indexOf(tG)===-1,()=>`The ellipsis notation ("${tG}") is not supported yet.`);const f=c.split(eG),m=f.length;if(r!==m)throw new Error(`Expected ${m} input tensors, received ${r}`);if(m>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const y=[];for(let T=0;T<h.length;++T){const B=h[T];if(!f.some(O=>O.indexOf(B)!==-1))throw new Error(`Output subscripts contain the label ${B} not present in the input subscripts.`);y.indexOf(B)===-1&&y.push(B)}for(let T=0;T<c.length;++T){const B=c[T];y.indexOf(B)===-1&&B!==eG&&y.push(B)}const A=new Array(f.length);for(let T=0;T<m;++T){if(new Set(f[T].split("")).size!==f[T].length)throw new Error(`Found duplicate axes in input component ${f[T]}. Support for duplicate axes in input is not implemented yet.`);A[T]=[];for(let B=0;B<f[T].length;++B)A[T].push(y.indexOf(f[T][B]))}const w=y.length,C=h.length,_=[];for(let T=C;T<w;++T)_.push(T);return{allDims:y,summedDims:_,idDims:A}}function Ik(a,r){let o=new Array(a);o.fill(-1);for(let h=0;h<r.length;++h)o[r[h]]=h;const c=[];for(let h=0;h<a;++h)o[h]===-1&&c.push(h);return o=o.filter(h=>h!==-1),{permutationIndices:o,expandDims:c}}function Sk(a,r,o){const c=new Array(a);for(let h=0;h<o.length;++h){const f=o[h].shape;for(let m=0;m<r[h].length;++m)c[r[h][m]]===void 0?c[r[h][m]]=f[m]:b(c[r[h][m]]===f[m],()=>`Expected dimension ${c[r[h][m]]} at axis ${m} of input shaped ${JSON.stringify(f)}, but got dimension ${f[m]}`)}}function Tk(a,r){const o=a,c=[];let h=0;a.length===0&&o.push(-1),h=a.length+1;for(let m=0;m<h;++m)c.push([]);const f=[];for(let m=0;m<o.length;++m){const y=o[m],A=ide(r,y);for(const w of A)f.indexOf(w)===-1&&(c[m].push(w),f.push(w))}return{path:o,steps:c}}function Mk(a){return a.every((r,o)=>r===o)}function ide(a,r){const o=[];for(let c=0;c<a.length;++c)(a[c].length===0||a[c].indexOf(r)!==-1||r===-1)&&o.push(c);return o}function kk(a,r,o=0){let c=[];if(typeof r=="number")b(a.shape[o]%r===0,()=>"Number of splits must evenly divide the axis."),c=new Array(r).fill(a.shape[o]/r);else{const h=r.reduce((m,y)=>(y===-1&&(m+=1),m),0);b(h<=1,()=>"There should be only one negative value in split array.");const f=r.indexOf(-1);if(f!==-1){const m=r.reduce((y,A)=>A>0?y+A:y);r[f]=a.shape[o]-m}b(a.shape[o]===r.reduce((m,y)=>m+y),()=>"The sum of sizes must match the size of the axis dimension."),c=r}return c}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nG(a){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${a}`}function iG(a,r){return`indices(${a}, 0) is invalid: ${r} < 0`}function rG(a,r,o){return`indices(${a}, 0) is invalid: ${r} >= ${o}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sG(a,r){return`only one output dimension may be -1, not both ${a} and ${r}`}function oG(a,r){return`size ${a} must be non-negative, not ${r}`}function aG(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lG(a,r){const o=M(a),c=M(r);return`Input to reshape is a SparseTensor with ${o}
  dense values, but the requested shape requires a multiple of ${c}. inputShape=${a} outputShape= ${r}`}function cG(a,r){const o=M(a),c=M(r);return`Input to reshape is a tensor with ${o} dense values, but the requested shape has ${c}. inputShape=${a} outputShape=${r}`}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rk(){return"segment ids must be >= 0"}function uG(){return"segment ids are not increasing"}function hG(a,r){return`Segment id ${a} out of range [0, ${r}), possibly because segmentIds input is not sorted.`}function dG(a,r,o){return`Bad: indices[${a}] == ${r} out of range [0, ${o})`}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fG(a,r){let o=!1,c;for(a<=fk?(c=a,o=!0):c=Fe(a,Math.floor(Math.sqrt(a)));!o;)c>r||c===a?o=!0:c=Fe(a,c+1);return c}function pG(a,r,o){const c=[],h=a.length;for(let f=0;f<h;f++)f!==r?c.push(a[f]):c.push(o);return c}function Lk(a,r,o,c){const h=r.shape.length,f=a.shape.length;if(c!==0&&(c<-h||c>h))throw new Error(`Expect batchDims in the range of [-${h}, ${h}], but got ${c}`);if(c<0&&(c+=h),c>f)throw new Error(`batchDims (${c}) must be less than rank(x) (
    ${f}).`);if(o<c)throw new Error(`batchDims (${c}) must be less than or equal to axis (${o}).`);for(let _=0;_<c;++_)if(a.shape[_]!==r.shape[_])throw new Error(`x.shape[${_}]: ${a.shape[_]} should be equal to indices.shape[${_}]: ${r.shape[_]}.`);const m=a.shape[o],y=[];let A=1,w=1,C=1;for(let _=0;_<c;++_)y.push(a.shape[_]),A*=a.shape[_];for(let _=c;_<o;_++)y.push(a.shape[_]),w*=a.shape[_];for(let _=c;_<h;_++)y.push(r.shape[_]);for(let _=o+1;_<f;_++)y.push(a.shape[_]),C*=a.shape[_];return{batchSize:A,sliceSize:C,outerSize:w,dimSize:m,outputShape:y}}const rde=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Lk,computeOutShape:pG,segOpComputeOptimalWindowSize:fG},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qh(a){try{return a.map(r=>Tc(r))}catch(r){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${r}`)}}function mG(a){return a.map(r=>Tu(r))}const sde=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Ak,ERF_A2:vk,ERF_A3:bk,ERF_A4:xk,ERF_A5:wk,ERF_P:yk,PARALLELIZE_THRESHOLD:fk,get RowPartitionType(){return Lc},SELU_SCALE:Ww,SELU_SCALEALPHA:Gw,applyActivation:qM,assertAndGetBroadcastShape:si,assertAxesAreInnerMostDims:Ys,assertParamsConsistent:dk,assignToTypedArray:Yz,axesAreInnerMostDims:BM,calculateShapes:bm,checkEinsumDimSizes:Sk,checkPadOnDimRoundingMode:ha,combineLocations:ZU,combineRaggedTensorToTensorShapes:Hz,complexWithEvenIndex:Zz,complexWithOddIndex:jz,computeConv2DInfo:js,computeConv3DInfo:df,computeDefaultPad:EM,computeDilation2DInfo:xv,computeOptimalWindowSize:zw,computeOutAndReduceShapes:Ps,computeOutShape:Nu,computePool2DInfo:Hl,computePool3DInfo:Gh,convertConv2DDataFormat:Wh,decodeEinsumEquation:_k,eitherStridesOrDilationsAreOne:fo,expandShapeToKeepDim:ns,exponent:Jz,exponents:qz,fromStringArrayToUint8:mG,fromUint8ToStringArray:Qh,getAxesPermutation:Tr,getBroadcastDims:R0,getComplexWithIndex:Ck,getEinsumComputePath:Tk,getEinsumPermutation:Ik,getFusedBiasGradient:YM,getFusedDyActivation:jM,getImageCenter:pk,getInnerMostAxes:Hr,getPermuted:Bv,getRaggedRank:$z,getReductionAxes:ys,getReshaped:Lv,getReshapedPermuted:Pv,getRowPartitionTypesHelper:Xz,getSliceBeginCoords:mk,getSliceSize:gk,getSparseFillEmptyRowsIndicesDenseShapeMismatch:nG,getSparseFillEmptyRowsNegativeIndexErrorMessage:iG,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:rG,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:aG,getSparseReshapeInputOutputMismatchErrorMessage:cG,getSparseReshapeInputOutputMultipleErrorMessage:lG,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:sG,getSparseReshapeNegativeOutputDimErrorMessage:oG,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:dG,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Rk,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:uG,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:hG,getUndoAxesPermutation:ff,isIdentityPermutation:Mk,log:rf,mergeRealAndImagArrays:$h,prepareAndValidate:sk,prepareSplitSize:kk,segment_util:rde,shouldFuse:JM,slice_util:Jhe,splitRealAndImagArrays:Kz,stridesOrDilationsArePositive:pm,tupleValuesAreOne:fm,upcastType:Ua,validateDefaultValueShape:Qz,validateInput:Pue,validateUpdateShape:bz,warn:Ks},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/$he();/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gG={kernelName:We,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,Rv(pn(o,"float32"),-1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ode={kernelName:at,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>{const c=gr(pn(o,"float32")),h=No(Wn(Qi(1),c));return Xr(Vn(a,h))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ade={kernelName:ln,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>{const c=No(Wn(gr(pn(o,"float32")),1));return Vn(a,c)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lde={kernelName:ve,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{let f=a;const m=ys(o.shape,h);return m.length>0&&(f=Bn(f,m)),Xe(f,o.shape)},b:()=>{let f=a;const m=ys(c.shape,h);return m.length>0&&(f=Bn(f,m)),Xe(f,c.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cde={kernelName:ue,saveAllInputs:!0,gradFunc:(a,r)=>{const o={};return r.forEach((c,h)=>{o[h]=()=>a.clone()}),o}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ude={kernelName:vt,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ri(o)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hde={kernelName:pt,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ri(o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dde={kernelName:cn,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,No(Wn(Qi(1),gr(pn(o,"float32")))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fde={kernelName:Tt,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>{const c=No(Ot(Qi(1),gr(pn(o,"float32"))));return Vn(a,c)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pde={kernelName:Ft,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{const f=Ot(gr(o),gr(c));let m=Ue(a,Vn(c,f));const y=ys(o.shape,h);return y.length>0&&(m=Bn(m,y)),Xe(m,o.shape)},b:()=>{const f=Ot(gr(o),gr(c));let m=Xr(Ue(a,Vn(o,f)));const y=ys(c.shape,h);return y.length>0&&(m=Bn(m,y)),Xe(m,c.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mde={kernelName:Zt,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,Ot(gr(pn(o,"float32")),1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gde={kernelName:kn,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,Wn(Qi(1),gr(pn(o,"float32"))))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yde(a,r,o,c,h,f){const m=ke(a,"dy","avgPool3dGrad"),y=ke(r,"input","avgPool3dGrad");let A=m,w=y,C=!1;y.rank===4&&(C=!0,A=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]]),w=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]])),b(A.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${A.rank}.`),b(w.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${w.rank}.`),ha("avgPool3dGrad",h,f);const _={dy:A,input:w},T={filterSize:o,strides:c,pad:h,dimRoundingMode:f},B=Ve.runKernel(ft,_,T);return C?Xe(B,[B.shape[1],B.shape[2],B.shape[3],B.shape[4]]):B}const Ade=He({avgPool3dGrad_:yde});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vde={kernelName:Pe,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{filterSize:h,strides:f,pad:m,dimRoundingMode:y}=o;return{x:()=>Ade(a,c,h,f,m,y)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bde(a,r,o,c,h){const f=ke(a,"dy","avgPoolGrad"),m=ke(r,"input","avgPoolGrad");b(m.rank===f.rank,()=>`Rank of input (${m.rank}) does not match rank of dy (${f.rank})`);let y=m,A=f,w=!1;m.rank===3&&(w=!0,y=Xe(m,[1,m.shape[0],m.shape[1],m.shape[2]]),A=Xe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),b(A.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${A.rank}.`),b(y.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${y.rank}.`);const C={dy:A,input:y},_={filterSize:o,strides:c,pad:h},T=Ve.runKernel(jn,C,_);return w?Xe(T,[T.shape[1],T.shape[2],T.shape[3]]):T}const xde=He({avgPoolGrad_:bde});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wde={kernelName:vn,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{filterSize:h,strides:f,pad:m}=o;return{x:()=>xde(a,c,h,f,m)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cde={kernelName:Pt,inputsToSave:["a","b"],gradFunc:(a,r,o)=>{const[c,h]=r,{transposeA:f,transposeB:m}=o;return!f&&!m?{a:()=>$i(a,h,!1,!0),b:()=>$i(c,a,!0,!1)}:!f&&m?{a:()=>$i(a,h,!1,!1),b:()=>$i(a,c,!0,!1)}:f&&!m?{a:()=>$i(h,a,!1,!0),b:()=>$i(c,a,!1,!1)}:{a:()=>$i(h,a,!0,!0),b:()=>$i(a,c,!0,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ede={kernelName:Dt,gradFunc:(a,r,o)=>{const{blockShape:c,crops:h}=o;return{x:()=>zM(a,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _de={kernelName:Rn,gradFunc:(a,r,o)=>{const c=o,h=c.inputShape,f=c.shape,m=Array.from(f);for(let A=h.length-1;A>=0;A--)if(h[A]===f[A])m[A]=1;else if(h[A]!==1)throw new Error(`broadcastTo(): [${h}] cannot be broadcast to [${f}].`);const y=[];for(let A=0;A<m.length;A++)m[A]>1&&y.push(A);return{x:()=>Bn(a,y,!0)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ide={kernelName:Jt,gradFunc:a=>({x:()=>a.clone()})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Sde={kernelName:fn,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Tde={kernelName:ei,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{clipValueMin:h,clipValueMax:f}=o;return{x:()=>Po(Hh(gm(c,h),B0(c,f)),a,Ri(a))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mde={kernelName:ta,inputsToSave:["x"],gradFunc:gG.gradFunc};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kde={kernelName:yc,saveAllInputs:!0,gradFunc:(a,r,o)=>{const c=r.map(y=>y.shape),{axis:h}=o,f=q(h,r[0].shape)[0],m=c.map(y=>y[f]);return Al(a,m,f).map(y=>()=>y)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Rde={kernelName:Dl,inputsToSave:["x","filter"],gradFunc:(a,r,o)=>{const[c,h]=r,{dilations:f,strides:m,pad:y,dataFormat:A}=o;return b(fm(f),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${f}'`),{x:()=>MM(c.shape,a,h,m,y,A),filter:()=>ZM(c,a,h.shape,m,y,A)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Lde={kernelName:hn,inputsToSave:["dy","filter"],gradFunc:(a,r,o)=>{const[c,h]=r,{strides:f,pad:m,dataFormat:y,dimRoundingMode:A}=o;return{dy:()=>mm(a,h,f,m,y,1,A),filter:()=>ZM(a,c,h.shape,f,m,y,A)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bde(a,r,o,c,h){let f=a;a.rank===4&&(f=Xe(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));let m=r;m.rank===4&&(m=Xe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]])),b(f.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${f.shape}.`),b(m.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${m.shape}.`),b(o.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${o}.`),b(f.shape[4]===o[3],()=>`Error in conv3dDerFilter: depth of input ${f.shape[4]}) must match input depth in filter (${o[3]}.`),b(m.shape[4]===o[4],()=>`Error in conv3dDerFilter: depth of dy (${m.shape[4]}) must match output depth for filter (${o[4]}).`);const y={x:f,dy:m},A={strides:c,pad:h,filterShape:o};return Ve.runKernel(ks,y,A)}const Pde=He({conv3DBackpropFilter_:Bde});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Nde={kernelName:al,inputsToSave:["x","filter"],gradFunc:(a,r,o)=>{const{dilations:c,strides:h,pad:f}=o;b(fm(c),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${c}'`);const[m,y]=r;return{x:()=>XU(m.shape,a,y,h,f),filter:()=>Pde(m,a,y.shape,h,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Dde={kernelName:Io,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(Xr(gz(pn(o,"float32"))),a)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Fde={kernelName:So,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(yz(pn(o,"float32")),a)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ode={kernelName:ro,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{axis:h,exclusive:f,reverse:m}=o;return{x:()=>{const y=Tr([h],c.rank);let A=QU(a,h,f,!m);return y!=null&&(A=Li(A,y)),A}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Vde={kernelName:ll,inputsToSave:["x","filter"],gradFunc:(a,r,o)=>{const{dilations:c,strides:h,pad:f,dimRoundingMode:m}=o,y=c??[1,1];b(fm(y),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${y}'`);const[A,w]=r;return b(A.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${A.rank}.`),b(w.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${w.rank}.`),b(A.shape[3]===w.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${A.shape[3]}) must match the inChannels dimension in filter ${w.shape[2]}.`),b(fo(h,y),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${h} and dilations '${y}'.`),ha("depthwiseConv2d",f,m),{x:()=>Jue(A.shape,a,w,h,f,y,m),filter:()=>Yue(A,a,w.shape,h,f,y,m)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ude={kernelName:pe,inputsToSave:["x","filter"],gradFunc:(a,r,o)=>{const[c,h]=r,f={x:c,filter:h,dy:a},m={x:c,filter:h,dy:a};return{x:()=>Ve.runKernel(ze,f,o),filter:()=>Ve.runKernel(nt,m,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zde={kernelName:Kt,outputsToSave:[!0],gradFunc:(a,r)=>{const[o]=r,c={dy:a,y:o};return{x:()=>Ve.runKernel(on,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gde={kernelName:dn,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r,c=Ue(Lu(Xr(gr(o))),2/Math.sqrt(Math.PI));return{x:()=>Ue(a,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Wde={kernelName:Sn,outputsToSave:[!0],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Hde={kernelName:zt,inputsToSave:["input"],gradFunc:(a,r)=>{const[o]=r;return{input:()=>Xe(a,o.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xde={kernelName:gn,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,Lu(o))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $de={kernelName:Yn,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qde={kernelName:Ht,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{const f=Vn(a,pn(c,"float32")),m=ys(o.shape,h);return m.length>0?Xe(Bn(f,m),o.shape):f},b:()=>{let f=Ue(a,pn(o,"float32"));const m=ys(c.shape,h);m.length>0&&(f=Xe(Bn(f,m),c.shape));const y=gr(c);return Xr(Vn(f,pn(y,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kde={kernelName:jt,inputsToSave:["x","mean","variance","scale"],gradFunc:(a,r,o)=>{const{varianceEpsilon:c}=o,[h,f,m,y]=r,A=y??Qi(1),w=ys(f.shape,h.shape),C=[];if(f.rank===1){for(let U=0;U<h.shape.length-1;++U)C.push(h.shape[U]);C.push(1)}const _=Wn(h,f),T=Ue(a,A),B=fz(Ot(m,Qi(c))),O=Ue(Ue(Ue(B,B),B),Qi(-.5));return{x:()=>f.rank===1?Xe(Ue(Ue(a,Rc(Xe(B,[1,1,1,f.shape[0]]),C)),A),h.shape):Xe(Ue(Ue(a,B),A),h.shape),mean:()=>{let U=Ue(Ue(B,Qi(-1)),T);return f.rank===1&&(U=Bn(U,w)),Xe(U,f.shape)},variance:()=>{let U=Ue(Ue(O,_),T);return f.rank===1&&(U=Bn(U,w)),Xe(U,f.shape)},scale:()=>{const U=Ue(_,B);let W=Ue(a,U);return f.rank===1&&(W=Bn(W,w)),Xe(W,f.shape)},offset:()=>{let U=a;return f.rank===1&&(U=Bn(U,w)),Xe(U,f.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zde={kernelName:us,inputsToSave:["x","indices"],gradFunc:(a,r,o)=>{const[c,h]=r,{axis:f,batchDims:m}=o,y=q(f,c.shape)[0],A=(w,C,_)=>()=>{const T=w.shape,B=C.size,O=T.slice(0,y),U=O.length,W=T.slice(f,T.length).slice(1),z=W.length,X=yG(0,U),re=yG(U+1,U+1+z),se=AG([O,[B],W]),le=Xe(_,se),ge=Xe(C,[B]),ye=AG([[U],X,re]),be=Li(le,ye);let Se=wz(be,ge,w.shape[y]);const Be=ff(ye);return Se=Li(Se,Be),Se};if(m===1){const w=c.shape[0],C=c.split(w,0);return{x:()=>Pu(C.map((_,T)=>A(_,h.slice(T,1),a.slice(T,1))())).reshape(c.shape),indices:()=>h}}else return{x:A(c,h,a),indices:()=>h}}};function yG(a,r){const o=[];for(let c=a;c<r;++c)o.push(c);return o}function AG(a){const r=[];for(let o=0;o<a.length;++o)for(let c=0;c<a[o].length;++c)r.push(a[o][c]);return r}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jde={kernelName:Jr,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r;return{a:()=>Ri(o),b:()=>Ri(c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yde={kernelName:hs,gradFunc:a=>({x:()=>pn(a,"float32")})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qde={kernelName:Vi,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Jde={kernelName:pr,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const efe={kernelName:mi,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tfe={kernelName:Qs,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{alpha:h}=o,f=yl(c,0);return{x:()=>Po(f,a,Ue(a,h))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nfe={kernelName:To,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,Ot(o,1))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ife={kernelName:cl,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,pn(o,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rfe={kernelName:Pa,inputsToSave:[],outputsToSave:[!0],gradFunc:(a,r,o)=>{const[c]=r,{axis:h}=o;return{logits:()=>{const f=Lu(c);return Wn(a,Ue(Bn(a,h,!0),f))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sfe(a,r,o,c=5,h=1,f=1,m=.5){const y={x:a,y:r,dy:o},A={depthRadius:c,bias:h,alpha:f,beta:m};return Ve.runKernel(Xn,y,A)}const ofe=He({localResponseNormalizationBackprop_:sfe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const afe={kernelName:Zd,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(a,r,o)=>{const[c,h]=r,{depthRadius:f,bias:m,alpha:y,beta:A}=o;return{x:()=>ofe(c,h,a,f,m,y,A)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vG(a,r,o,c){return r.rank<o.rank&&(r=Xe(r,ns(r.shape,c))),a.rank<o.rank&&(a=Xe(a,ns(a.shape,c))),{x:()=>Ue(a,pn(Ru(o,r),a.dtype))}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bG={kernelName:ps,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(a,r,o)=>{const c=o,{reductionIndices:h}=c,f=r[0],m=r[1],y=q(h,f.shape),A=vG(a,m,f,y);return{x:()=>A.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lfe={kernelName:ki,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r;return{a:()=>Ue(a,pn(gm(o,c),"float32")),b:()=>Ue(a,pn(Nw(o,c),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cfe(a,r,o,c,h,f,m){const y=ke(a,"dy","maxPool3dGrad"),A=ke(r,"input","maxPool3dGrad"),w=ke(o,"output","maxPool3dGrad");let C=y,_=A,T=w,B=!1;A.rank===4&&(B=!0,C=Xe(y,[1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]]),_=Xe(A,[1,A.shape[0],A.shape[1],A.shape[2],A.shape[3]]),T=Xe(w,[1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]])),b(C.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${C.rank}.`),b(_.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${_.rank}.`),b(T.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${T.rank}.`),ha("maxPool3dGrad",f,m);const O={dy:C,input:_,output:T},U={filterSize:c,strides:h,pad:f,dimRoundingMode:m},W=Ve.runKernel(xc,O,U);return B?Xe(W,[W.shape[1],W.shape[2],W.shape[3],W.shape[4]]):W}const ufe=He({maxPool3dGrad_:cfe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hfe={kernelName:bc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(a,r,o)=>{const[c,h]=r,{filterSize:f,strides:m,pad:y,dimRoundingMode:A}=o;return{x:()=>ufe(a,c,h,f,m,y,A)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dfe(a,r,o,c,h,f,m){const y=ke(a,"dy","maxPoolGrad"),A=ke(r,"input","maxPoolGrad"),w=ke(o,"output","maxPoolGrad");b(A.rank===y.rank,()=>`Rank of input (${A.rank}) does not match rank of dy (${y.rank})`),b(y.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${y.rank}.`),b(A.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${A.rank}.`),ha("maxPoolGrad",f,m);const C={dy:y,input:A,output:w},_={filterSize:c,strides:h,pad:f,dimRoundingMode:m};return Ve.runKernel(hl,C,_)}const ffe=He({maxPoolGrad_:dfe});/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const pfe={kernelName:ul,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(a,r,o)=>{const[c,h]=r,{filterSize:f,strides:m,pad:y}=o;return{x:()=>ffe(a,c,h,f,m,y)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mfe={kernelName:fu,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{axis:h}=o,f=q(h,c.shape),m=Ps(c.shape,f)[1],y=M(m);return{x:()=>{const A=c.shape.slice();f.forEach(C=>{A[C]=1});const w=Xe(a,A);return Vn(Ue(w,mf(c.shape,"float32")),y)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const gfe={kernelName:Ul,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(a,r,o)=>{const c=o,{axis:h}=c,[f,m]=r,y=q(h,f.shape),A=vG(a,m,f,y);return{x:()=>A.x()}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yfe={kernelName:mr,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r;return{a:()=>Ue(a,pn(B0(o,c),"float32")),b:()=>Ue(a,pn(yl(o,c),"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Afe={kernelName:ia,inputsToSave:["x"],gradFunc:(a,r,o)=>{const c=r[0],{paddings:h}=o,f=h.map(m=>m[0]);return{x:()=>ur(a,f,c.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vfe={kernelName:wc,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{const f=ys(o.shape,h);return f.length>0?Xe(Bn(a,f),o.shape):a},b:()=>{const f=Ue(a,Xr(Pw(Vn(o,c)))),m=ys(c.shape,h);return m.length>0?Xe(Bn(f,m),c.shape):f}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bfe={kernelName:Mo,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{const f=Ue(a,pn(c,"float32")),m=ys(o.shape,h);return m.length>0?Xe(Bn(f,m),o.shape):f},b:()=>{const f=Ue(a,pn(o,"float32")),m=ys(c.shape,h);return m.length>0?Xe(Bn(f,m),c.shape):f}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xfe={kernelName:mu,gradFunc:a=>({x:()=>Xr(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wfe={kernelName:Rs,inputsToSave:["indices"],gradFunc:(a,r)=>{const o=r[0];return{indices:()=>Ns(o.shape,"float32")}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cfe={kernelName:Ec,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Efe={kernelName:ra,saveAllInputs:!0,gradFunc:(a,r,o)=>{const{axis:c}=o;return xm(a,c).map(h=>()=>h)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xG={kernelName:Mh,inputsToSave:["x"],gradFunc:(a,r,o)=>{const c=r[0],{paddings:h}=o,f=h.map(m=>m[0]);return{x:()=>ur(a,f,c.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _fe={kernelName:yu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(a,r)=>{const[o,c,h]=r,f=o,m=c,y=si(f.shape,m.shape);return{a:()=>{const A=pn(m,"float32");let w=Ue(a,Ue(A,L0(f,Wn(A,Qi(1)))));const C=ys(f.shape,y);return C.length>0&&(w=Bn(w,C)),Xe(w,f.shape)},b:()=>{const A=yl(f,0),w=Po(A,Bu(f),Ri(f));let C=Ue(a,Ue(h,w));const _=ys(m.shape,y);return _.length>0&&(C=Bn(C,_)),Xe(C,m.shape)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ife={kernelName:Na,inputsToSave:["x","alpha"],gradFunc:(a,r)=>{const[o,c]=r,h=yl(o,0);return{x:()=>Po(h,a,Ue(a,c)),alpha:()=>{let f=Po(h,Ri(a),Ue(a,o));const m=ys(c.shape,a.shape);return m.length>0&&(f=Bn(f,m)),Xe(f,c.shape)}}}};/**
* @license
* Copyright 2022 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sfe(a,r,o){const c=a.shape.slice();c[o]=1;const h=Xe(r,c),f=RM(a,o,!0,!1),m=RM(a,o,!0,!0),y=Ue(f,m);return Ue(h,y)}function Tfe(a,r,o){const c=a.shape.length,h=c-o.length,f=Tr(o,c);let m=a;f!=null&&(m=Li(a,f));const y=m.shape.slice(),A=y.splice(c-o.length,o.length).reduce((_,T)=>_*T,1);y.push(A);const w=m.reshape(y);let C=Sfe(w,r,h);if(C=C.reshape(m.shape),f!=null){const _=ff(f);C=Li(C,_)}return C}const Mfe={kernelName:kh,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{axis:h}=o;let f=[];return h==null?f=c.shape.map((m,y)=>y):typeof h=="number"?f=[h]:f=h,{x:()=>Tfe(c,a,f)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kfe={kernelName:Ge,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{const f=Vn(a,pn(c,"float32")),m=ys(o.shape,h);return m.length>0?Xe(Bn(f,m),o.shape):f},b:()=>{let f=Ue(a,pn(o,"float32"));const m=ys(c.shape,h);m.length>0&&(f=Xe(Bn(f,m),c.shape));const y=gr(c);return Xr(Vn(f,pn(y,"float32")))}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Rfe={kernelName:Ls,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,Xr(gr(o)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Lfe={kernelName:zl,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r,c=Ue(B0(o,6),Rv(o));return{x:()=>Ue(a,pn(c,"float32"))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bfe={kernelName:bu,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,pn(Rv(o),"float32"))}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Pfe={kernelName:sa,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Xe(a,o.shape)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Nfe={kernelName:xu,inputsToSave:["images"],gradFunc:(a,r,o)=>{const[c]=r,h={dy:a,images:c};return{images:()=>Ve.runKernel(wu,h,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Dfe={kernelName:ko,inputsToSave:["images"],gradFunc:(a,r,o)=>{const[c]=r,h={dy:a,images:c};return{images:()=>Ve.runKernel(Rh,h,o)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ffe={kernelName:es,gradFunc:(a,r,o)=>{const{dims:c}=o,h=q(c,a.shape);return{x:()=>vm(a,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ofe={kernelName:_c,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Vfe={kernelName:Cu,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Xr(Vn(a,Ue(L0(o,1.5),2)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Ufe={kernelName:ae,inputsToSave:["condition"],gradFunc:(a,r)=>{const[o]=r;return{condition:()=>pn(Ri(o),"float32"),t:()=>Ue(a,pn(o,a.dtype)),e:()=>Ue(a,pn(FM(o),a.dtype))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zfe={kernelName:me,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>{const c=yl(o,Qi(0)),h=Qi(Gw),f=Qi(Ww),m=Ue(a,f),y=Ue(Ue(a,h),Lu(pn(o,"float32")));return Po(c,m,y)}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Gfe={kernelName:xi,outputsToSave:[!0],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,Ue(o,Wn(Qi(1),o)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Wfe={kernelName:zn,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Hfe={kernelName:it,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(kM(pn(o,"float32")),a)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Xfe={kernelName:Xt,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue($U(pn(o,"float32")),a)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $fe={kernelName:Ke,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{begin:h,size:f}=o,m=c.shape,[y,A]=Vw(c,h,f),w=[];for(let C=0;C<a.rank;C++)w.push([y[C],m[C]-y[C]-A[C]]);return{x:()=>UM(a,w)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qfe={kernelName:oa,outputsToSave:[!0],gradFunc:(a,r,o)=>{const[c]=r,{dim:h}=o,f=!0,m=Ue(a,c);return{logits:()=>Wn(m,Ue(Bn(m,[h],f),c))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kfe={kernelName:Ii,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,k0(o))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wG={kernelName:Ro,gradFunc:(a,r,o)=>{const{blockShape:c,paddings:h}=o;return{x:()=>TM(a,c,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CG={kernelName:oo,gradFunc:(a,r,o)=>{const{axis:c}=o;return{x:()=>da(a,c)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Zfe={kernelName:lr,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,Ue(No(pn(o,"float32")),2))}}};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jfe={kernelName:dl,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(a,Ue(pn(o,"float32"),2))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yfe={kernelName:nm,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=Qi(2);return{a:()=>Ue(a,Ue(h,Wn(o,c))),b:()=>Ue(a,Ue(h,Wn(c,o)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qfe={kernelName:aa,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Jfe={kernelName:_u,inputsToSave:["a","b"],gradFunc:(a,r)=>{const[o,c]=r,h=si(o.shape,c.shape);return{a:()=>{let f=a;const m=ys(o.shape,h);return m.length>0&&(f=Bn(f,m)),Xe(f,o.shape)},b:()=>{let f=a;const m=ys(c.shape,h);return m.length>0&&(f=Bn(f,m)),Xe(Xr(f),c.shape)}}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const epe={kernelName:so,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,h=c.shape.slice(),{axis:f}=o;q(f,c.shape).forEach(A=>{h[A]=1});const m=Xe(a,h),y=Ue(m,mf(c.shape,"float32"));return{x:()=>y}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tpe={kernelName:im,inputsToSave:["x"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Vn(a,gr(kM(o)))}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const npe={kernelName:Fa,outputsToSave:[!0],gradFunc:(a,r)=>{const[o]=r;return{x:()=>Ue(Wn(Qi(1),gr(o)),a)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ipe={kernelName:Iu,inputsToSave:["x"],gradFunc:(a,r,o)=>{const[c]=r,{reps:h}=o;return{x:()=>{let f=Ri(c);if(c.rank===1)for(let m=0;m<h[0];++m)f=Ot(f,ur(a,[m*c.shape[0]],[c.shape[0]]));else if(c.rank===2)for(let m=0;m<h[0];++m)for(let y=0;y<h[1];++y)f=Ot(f,ur(a,[m*c.shape[0],y*c.shape[1]],[c.shape[0],c.shape[1]]));else if(c.rank===3)for(let m=0;m<h[0];++m)for(let y=0;y<h[1];++y)for(let A=0;A<h[2];++A)f=Ot(f,ur(a,[m*c.shape[0],y*c.shape[1],A*c.shape[2]],[c.shape[0],c.shape[1],c.shape[2]]));else if(c.rank===4)for(let m=0;m<h[0];++m)for(let y=0;y<h[1];++y)for(let A=0;A<h[2];++A)for(let w=0;w<h[3];++w)f=Ot(f,ur(a,[m*c.shape[0],y*c.shape[1],A*c.shape[2],w*c.shape[3]],[c.shape[0],c.shape[1],c.shape[2],c.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${c.rank} tensors yet.`);return f}}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rpe={kernelName:ef,gradFunc:(a,r,o)=>{const c=o,{perm:h}=c,f=ff(h);return{x:()=>Li(a,f)}}};/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const spe={kernelName:m0,gradFunc:(a,r,o)=>{const c=o,{axis:h}=c;return{value:()=>Pu(a,h)}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ope={kernelName:Sc,inputsToSave:["segmentIds"],gradFunc:(a,r)=>{const[o]=r;return{x:()=>ape(a,o)}}};function ape(a,r){const o=pf(r,Ri(r)),c=PM(a,o);let h=gm(r,Qi(0,"int32"));const f=c.rank-h.rank;for(let y=0;y<f;++y)h=fa(h,y+1);h=Hh(h,mf(c.shape,"bool"));const m=Ri(c);return Po(h,c,m)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lpe={kernelName:g0,gradFunc:a=>({x:()=>Ri(a)})};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cpe=[gG,ode,ade,lde,cde,ude,hde,dde,fde,pde,mde,gde,vde,wde,Cde,Ede,_de,Ide,Sde,Tde,Mde,kde,Lde,Rde,Nde,Dde,Fde,Ode,Vde,Ude,kfe,zde,Gde,Wde,Hde,Xde,Qde,$de,Kde,Zde,jde,Yde,qde,Jde,efe,tfe,nfe,ife,rfe,afe,bG,bG,lfe,hfe,pfe,mfe,gfe,yfe,Afe,vfe,bfe,xfe,wfe,Cfe,Efe,xG,xG,_fe,Ife,Mfe,Rfe,Lfe,Bfe,Pfe,Nfe,Dfe,Ffe,Ofe,Vfe,Ufe,zfe,Gfe,Wfe,Hfe,Xfe,$fe,Qfe,Kfe,wG,wG,CG,CG,Zfe,Yfe,jfe,qfe,Jfe,epe,tpe,npe,ipe,rpe,spe,ope,lpe];for(const a of cpe)bw(a);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.abs=function(){return this.throwIfDisposed(),Bo(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.acos=function(){return this.throwIfDisposed(),Woe(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.acosh=function(){return this.throwIfDisposed(),Xoe(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.add=function(a){return this.throwIfDisposed(),Ot(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.all=function(a,r){return this.throwIfDisposed(),GU(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.any=function(a,r){return this.throwIfDisposed(),CM(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.argMax=function(a){return this.throwIfDisposed(),bv(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.argMin=function(a){return this.throwIfDisposed(),joe(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.asScalar=function(){return this.throwIfDisposed(),b(this.size===1,()=>"The array must have only 1 element."),Xe(this,[])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.asType=function(a){return this.throwIfDisposed(),pn(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.as1D=function(){return this.throwIfDisposed(),Xe(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.as2D=function(a,r){return this.throwIfDisposed(),Xe(this,[a,r])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.as3D=function(a,r,o){return this.throwIfDisposed(),Xe(this,[a,r,o])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.as4D=function(a,r,o,c){return this.throwIfDisposed(),Xe(this,[a,r,o,c])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.as5D=function(a,r,o,c,h){return this.throwIfDisposed(),Xe(this,[a,r,o,c,h])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.asin=function(){return this.throwIfDisposed(),qoe(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.asinh=function(){return this.throwIfDisposed(),eae(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.atan=function(){return this.throwIfDisposed(),nae(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.atan2=function(a){return this.throwIfDisposed(),rae(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.atanh=function(){return this.throwIfDisposed(),oae(this)},lt().prototype.avgPool=function(a,r,o,c){return this.throwIfDisposed(),IM(this,a,r,o,c)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.batchToSpaceND=function(a,r){return this.throwIfDisposed(),TM(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.batchNorm=function(a,r,o,c,h){return this.throwIfDisposed(),Mw(this,a,r,o,c,h)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.broadcastTo=function(a){return this.throwIfDisposed(),Ev(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.cast=function(a){return this.throwIfDisposed(),pn(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.ceil=function(){return this.throwIfDisposed(),Bae(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.clipByValue=function(a,r){return this.throwIfDisposed(),gl(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.concat=function(a,r){return this.throwIfDisposed(),a instanceof gs&&(a=[a]),da([this,...a],r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.conv1d=function(a,r,o,c,h,f){return this.throwIfDisposed(),WU(this,a,r,o,c,h,f)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.conv2dTranspose=function(a,r,o,c,h){return this.throwIfDisposed(),HU(this,a,r,o,c,h)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.conv2d=function(a,r,o,c,h,f){return this.throwIfDisposed(),mm(this,a,r,o,c,h,f)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.cos=function(){return this.throwIfDisposed(),kM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.cosh=function(){return this.throwIfDisposed(),$U(this)};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the 'License');
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an 'AS IS' BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.cumprod=function(a,r,o){return this.throwIfDisposed(),RM(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.cumsum=function(a,r,o){return this.throwIfDisposed(),QU(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.depthToSpace=function(a,r){return this.throwIfDisposed(),rle(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.depthwiseConv2d=function(a,r,o,c,h,f){return this.throwIfDisposed(),LM(this,a,r,o,c,h,f)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.dilation2d=function(a,r,o,c,h){return this.throwIfDisposed(),ale(this,a,r,o,c,h)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.divNoNan=function(a){return this.throwIfDisposed(),dle(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.div=function(a){return this.throwIfDisposed(),Vn(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.dot=function(a){return this.throwIfDisposed(),ple(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.elu=function(){return this.throwIfDisposed(),Rw(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.equal=function(a){return this.throwIfDisposed(),Ru(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.erf=function(){return this.throwIfDisposed(),Ale(this)};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.euclideanNorm=function(a,r){return this.throwIfDisposed(),Sle(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.exp=function(){return this.throwIfDisposed(),Lu(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.expandDims=function(a){return this.throwIfDisposed(),fa(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.expm1=function(){return this.throwIfDisposed(),Rle(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.fft=function(){return this.throwIfDisposed(),vz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.flatten=function(){return this.throwIfDisposed(),Xe(this,[this.size])};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.floor=function(){return this.throwIfDisposed(),Pw(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.floorDiv=function(a){return this.throwIfDisposed(),zU(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.gather=function(a,r,o){return this.throwIfDisposed(),PM(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.greaterEqual=function(a){return this.throwIfDisposed(),gm(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.greater=function(a){return this.throwIfDisposed(),yl(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.ifft=function(){return this.throwIfDisposed(),QM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.irfft=function(){return this.throwIfDisposed(),bue(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.isFinite=function(){return this.throwIfDisposed(),Ule(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.isInf=function(){return this.throwIfDisposed(),Gle(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.isNaN=function(){return this.throwIfDisposed(),Hle(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.leakyRelu=function(a){return this.throwIfDisposed(),DM(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.lessEqual=function(a){return this.throwIfDisposed(),B0(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.less=function(a){return this.throwIfDisposed(),Nw(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.localResponseNormalization=function(a,r,o,c){return this.throwIfDisposed(),Zle(this,a,r,o,c)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logSigmoid=function(){return this.throwIfDisposed(),nce(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logSoftmax=function(a){return this.throwIfDisposed(),JU(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logSumExp=function(a,r){return this.throwIfDisposed(),ez(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.log=function(){return this.throwIfDisposed(),Bu(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.log1p=function(){return this.throwIfDisposed(),qU(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logicalAnd=function(a){return this.throwIfDisposed(),Hh(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logicalNot=function(){return this.throwIfDisposed(),FM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logicalOr=function(a){return this.throwIfDisposed(),tz(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.logicalXor=function(a){return this.throwIfDisposed(),uce(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.matMul=function(a,r,o){return this.throwIfDisposed(),$i(this,a,r,o)},lt().prototype.maxPool=function(a,r,o,c){return this.throwIfDisposed(),OM(this,a,r,o,c)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.max=function(a,r){return this.throwIfDisposed(),kc(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.maximum=function(a){return this.throwIfDisposed(),pf(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.mean=function(a,r){return this.throwIfDisposed(),is(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.min=function(a,r){return this.throwIfDisposed(),Lw(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.minimum=function(a){return this.throwIfDisposed(),Sv(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.mirrorPad=function(a,r){return this.throwIfDisposed(),Ace(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.mod=function(a){return this.throwIfDisposed(),bce(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.mul=function(a){return this.throwIfDisposed(),Ue(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.neg=function(){return this.throwIfDisposed(),Xr(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.norm=function(a,r,o){return this.throwIfDisposed(),Bw(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.notEqual=function(a){return this.throwIfDisposed(),Dw(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.oneHot=function(a,r=1,o=0){return this.throwIfDisposed(),nz(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.onesLike=function(){return this.throwIfDisposed(),Xl(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.pad=function(a,r){return this.throwIfDisposed(),UM(this,a,r)},lt().prototype.pool=function(a,r,o,c,h,f){return this.throwIfDisposed(),kce(this,a,r,o,c,h,f)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.pow=function(a){return this.throwIfDisposed(),L0(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.prelu=function(a){return this.throwIfDisposed(),GM(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.prod=function(a,r){return this.throwIfDisposed(),Bce(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.reciprocal=function(){return this.throwIfDisposed(),eue(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.relu=function(){return this.throwIfDisposed(),Am(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.relu6=function(){return this.throwIfDisposed(),hz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.reshapeAs=function(a){return this.throwIfDisposed(),Xe(this,a.shape)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.reshape=function(a){return this.throwIfDisposed(),Xe(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.resizeBilinear=function(a,r,o){return this.throwIfDisposed(),Iz(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.resizeNearestNeighbor=function(a,r,o){return this.throwIfDisposed(),Sz(this,a,r,o)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.reverse=function(a){return this.throwIfDisposed(),vm(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.rfft=function(){return this.throwIfDisposed(),Cue(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.round=function(){return this.throwIfDisposed(),dz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.rsqrt=function(){return this.throwIfDisposed(),fz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.selu=function(){return this.throwIfDisposed(),pz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.separableConv2d=function(a,r,o,c,h,f){return this.throwIfDisposed(),mz(this,a,r,o,c,h,f)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sigmoid=function(){return this.throwIfDisposed(),k0(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sign=function(){return this.throwIfDisposed(),cue(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sin=function(){return this.throwIfDisposed(),gz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sinh=function(){return this.throwIfDisposed(),yz(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.slice=function(a,r){return this.throwIfDisposed(),ur(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.softmax=function(a){return this.throwIfDisposed(),$M(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.softplus=function(){return this.throwIfDisposed(),Iv(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.spaceToBatchND=function(a,r){return this.throwIfDisposed(),zM(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.split=function(a,r){return this.throwIfDisposed(),Al(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sqrt=function(){return this.throwIfDisposed(),No(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.square=function(){return this.throwIfDisposed(),gr(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.squaredDifference=function(a){return this.throwIfDisposed(),_ue(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.squeeze=function(a){return this.throwIfDisposed(),kv(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.stack=function(a,r){this.throwIfDisposed();const o=a instanceof gs?[this,a]:[this,...a];return Pu(o,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.step=function(a){return this.throwIfDisposed(),Rv(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.stridedSlice=function(a,r,o,c,h,f,m,y){return this.throwIfDisposed(),kue(this,a,r,o,c,h,f,m,y)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sub=function(a){return this.throwIfDisposed(),Wn(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.sum=function(a,r){return this.throwIfDisposed(),Bn(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.tan=function(){return this.throwIfDisposed(),Lue(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.tanh=function(){return this.throwIfDisposed(),SM(this)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.tile=function(a){return this.throwIfDisposed(),Rc(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.toBool=function(){return this.throwIfDisposed(),pn(this,"bool")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.toFloat=function(){return this.throwIfDisposed(),pn(this,"float32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.toInt=function(){return this.throwIfDisposed(),pn(this,"int32")};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.topk=function(a,r){return this.throwIfDisposed(),Due(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.transpose=function(a){return this.throwIfDisposed(),Li(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.unique=function(a){return this.throwIfDisposed(),Vue(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.unsortedSegmentSum=function(a,r){return this.throwIfDisposed(),wz(this,a,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.unstack=function(a){return this.throwIfDisposed(),xm(this,a)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.where=function(a,r){return this.throwIfDisposed(),Po(a,this,r)};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/lt().prototype.zerosLike=function(){return this.throwIfDisposed(),Ri(this)};/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Du extends Error{constructor(r){super(r),Object.setPrototypeOf(this,Du.prototype)}}class Ql extends Error{constructor(r){super(r),Object.setPrototypeOf(this,Ql.prototype)}}class De extends Error{constructor(r){super(r),Object.setPrototypeOf(this,De.prototype)}}class hi extends Error{constructor(r){super(r),Object.setPrototypeOf(this,hi.prototype)}}class Bk extends Error{constructor(r){super(r),Object.setPrototypeOf(this,Bk.prototype)}}/**
* @license
* Copyright 2022 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class EG{constructor(r){this.maxEntries=r||100,this.cache=new Map}get(r){let o;return this.cache.has(r)&&(o=this.cache.get(r),this.cache.delete(r),this.cache.set(r,o)),o}put(r,o){if(this.cache.has(r))this.cache.delete(r);else if(this.cache.size>=this.maxEntries){const c=this.cache.keys().next().value;this.cache.delete(c)}this.cache.set(r,o)}getMaxEntries(){return this.maxEntries}setMaxEntries(r){if(r<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${r}.`);if(this.maxEntries>r)for(let o=0;o<this.maxEntries-r;o++){const c=this.cache.keys().next().value;this.cache.delete(c)}this.maxEntries=r}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Cm(a,r){if(Array.isArray(a)){let o=[];for(let c=0;c<r;c++)o=o.concat(a);return o}else{const o=new Array(r);return o.fill(a),o}}function Fu(a,r){if(!a)throw new Bk(r)}function _G(a,r){let o=0;for(const c of a)c===r&&o++;return o}function pa(a){return a.length===1?a[0]:a}function ji(a){return Array.isArray(a)?a:[a]}function Kh(a){const r=a.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return r[0]!=="_"?r:"private"+r}function Em(a){return a.length<=1||a.indexOf("_")===-1?a:a.replace(/[_]+(\w|$)/g,(r,o)=>o.toUpperCase())}let Kl={};function Pk(a){if(a==null)return null;const r={};return r.className=a.getClassName(),r.config=a.getConfig(),r}function Nk(a){if(!(a==null||typeof a!="object"))if(Array.isArray(a))a.forEach(r=>Nk(r));else{const r=Object.keys(a);for(const o of r){const c=a[o];c!=null&&typeof c=="object"&&(!Array.isArray(c)&&c.type==="ndarray"&&typeof c.value=="number"?a[o]=c.value:Nk(c))}}}function Nv(a,r={},o={},c="object",h=!1){if(typeof a=="string"){const f=a;let m;if(f in o)m=o[f];else if(f in Kl)m=Kl[f];else if(m=r[f],m==null)throw new De(`Unknown ${c}: ${a}. This may be due to one of the following reasons:
1. The ${c} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${c} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return m}else{const f=a;if(f.className==null||f.config==null)throw new De(`${c}: Improper config format: ${JSON.stringify(f)}.
'className' and 'config' must set.`);const m=f.className;let y,A;if(m in o?[y,A]=o[m]:m in Kl?[y,A]=Kl.className:m in r&&([y,A]=r[m]),y==null)throw new De(`Unknown ${c}: ${m}. This may be due to one of the following reasons:
1. The ${c} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${c} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(A!=null){const w={};for(const B of Object.keys(Kl))w[B]=Kl[B];for(const B of Object.keys(o))w[B]=o[B];const C=f.config;C.customObjects=w;const _=Object.assign({},Kl);for(const B of Object.keys(o))Kl[B]=o[B];Nk(f.config);const T=A(y,f.config,o,h);return Kl=Object.assign({},_),T}else{const w=Object.assign({},Kl);for(const _ of Object.keys(o))Kl[_]=o[_];const C=new y(f.config);return Kl=Object.assign({},w),C}}}function upe(a,r){return a<r?-1:a>r?1:0}function Hw(a,r){return-1*upe(a,r)}function yf(a){if(a==null)return a;const r=[];for(const o of a)r.indexOf(o)===-1&&r.push(o);return r}function hpe(a){if(a==null)throw new De(`Invalid value in obj: ${JSON.stringify(a)}`);for(const r in a)if(a.hasOwnProperty(r))return!1;return!0}function _m(a,r,o){if(o!=null&&a.indexOf(o)<0)throw new De(`${o} is not a valid ${r}.  Valid values are ${a} or null/undefined.`)}function Dk(a,r,o=0,c=1/0){return Fu(o>=0),Fu(c>=o),Array.isArray(a)&&a.length>=o&&a.length<=c&&a.every(h=>typeof h===r)}function Ds(a,r){Array.isArray(a)?(b(a.length>0,()=>`${r} is unexpectedly an empty array.`),a.forEach((o,c)=>Ds(o,`element ${c+1} of ${r}`))):b(Number.isInteger(a)&&a>0,()=>`Expected ${r} to be a positive integer, but got ${IG(a)}.`)}function IG(a){return a===null?"null":Array.isArray(a)?"["+a.map(r=>IG(r)).join(",")+"]":typeof a=="string"?`"${a}"`:`${a}`}function dpe(a,r,o){let c=o!=null?o():ho(),h;return(...f)=>{const m=o!=null?o():ho();return m-c<r||(c=m,h=a(...f)),h}}function SG(a){return a==="relu"?"relu":a==="linear"?"linear":a==="elu"?"elu":null}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let fpe=0;function TG(){return fpe++}const Xw={};function $w(a=""){return a in Xw||(Xw[a]=0),Xw[a]+=1,a+Xw[a].toString()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const ppe=["channelsFirst","channelsLast"],mpe=["nearest","bilinear"],gpe=["valid","same","causal"],ype=["max","avg"],Ape=["sum","mul","concat","ave"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const O0=new Map;function $r(a){_m(ppe,"DataFormat",a)}function vpe(a){_m(mpe,"InterpolationFormat",a)}function vl(a){_m(gpe,"PaddingMode",a)}function MG(a){_m(ype,"PoolMode",a)}const Dv=[],kG="/";function Im(a,r){Dv.push(a);try{const o=r();return Dv.pop(),o}catch(o){throw Dv.pop(),o}}function bpe(){return Dv.length===0?"":Dv.join(kG)+kG}function RG(a){if(!BG(a))throw new Error("Not a valid tensor name: '"+a+"'");return bpe()+a}function LG(a){if(!BG(a))throw new Error("Not a valid tensor name: '"+a+"'");O0.has(a)||O0.set(a,0);const r=O0.get(a);if(O0.set(a,O0.get(a)+1),r>0){const o=`${a}_${r}`;return O0.set(o,1),o}else return a}const xpe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function BG(a){return!!a.match(xpe)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function wpe(a){return a===parseInt(a.toString(),10)}function Af(a,r,o){r==null&&(r=0),o==null&&(o=a.length);let c=1;for(let h=r;h<o;++h)c*=a[h];return c}function V0(a){if(a.length===0)return Number.NaN;let r=Number.POSITIVE_INFINITY;for(let o=0;o<a.length;o++){const c=a[o];c<r&&(r=c)}return r}function vf(a){if(a.length===0)return Number.NaN;let r=Number.NEGATIVE_INFINITY;for(let o=0;o<a.length;o++){const c=a[o];c>r&&(r=c)}return r}function Bc(a,r){if(r<a)throw new De(`end (${r}) < begin (${a}) is forbidden.`);const o=[];for(let c=a;c<r;++c)o.push(c);return o}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let Fk;function As(){return Fk==null&&(Fk=uf().epsilon()),Fk}function Pc(){return"channelsLast"}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Zh(a,r){return pn(a,r)}function Fv(a,r=-1){const o=a.shape.slice();return r<0&&(r=o.length+r+1),o.splice(r,0,1),Xe(a,o)}function Cpe(a,r){return Qe(()=>{if(a.shape.length!==2)throw new De(`repeat() expects a rank-2 tensor, but received a rank-${a.shape.length} tensor.`);const o=Fv(a,1);return Uk(o,[1,r,1])})}function Epe(a){const r=[Af(a.shape)];return Xe(a,r)}function _pe(a){if(a.rank<=1)throw new De(`batchFlatten requires a minimum rank of 2. Got rank: ${a.rank}.`);const r=[a.shape[0],Af(a.shape,1)];return Xe(a,r)}function Sm(a,r,o){return Qe(()=>{switch(a.rank){case 1:return HM(a,r,o);case 2:return Az(a,[r,0],[o,a.shape[1]]);case 3:return XM(a,[r,0,0],[o,a.shape[1],a.shape[2]]);case 4:return Ow(a,[r,0,0,0],[o,a.shape[1],a.shape[2],a.shape[3]]);case 5:return ur(a,[r,0,0,0,0],[o,a.shape[1],a.shape[2],a.shape[3],a.shape[4]]);case 6:return ur(a,[r,0,0,0,0,0],[o,a.shape[1],a.shape[2],a.shape[3],a.shape[4],a.shape[5]]);default:throw new De(`sliceAlongFirstAxis() received an unsupported tensor rank: ${a.rank}`)}})}function Ok(a,r,o){return Qe(()=>{switch(a.rank){case 1:return HM(a,r,o);case 2:return Az(a,[0,r],[a.shape[0],o]);case 3:return XM(a,[0,0,r],[a.shape[0],a.shape[1],o]);case 4:return Ow(a,[0,0,0,r],[a.shape[0],a.shape[1],a.shape[2],o]);default:throw new De(`sliceAlongLastAxis() received an unsupported tensor rank: ${a.rank}`)}})}function Qw(a,r,o,c){return Qe(()=>{switch(a.rank){case 1:return HM(a,r,o);case 2:switch(c){case 1:return Sm(a,r,o);case 2:return Ok(a,r,o);default:throw new De(`The axis is not within the rank of the tensor ${c}`)}case 3:switch(c){case 1:return Sm(a,r,o);case 2:return XM(a,[0,r,0],[a.shape[0],o,a.shape[2]]);case 3:return Ok(a,r,o);default:throw new De(`The axis is not within the rank of the tensor ${c}`)}case 4:switch(c){case 1:return Sm(a,r,o);case 2:return Ow(a,[0,r,0,0],[a.shape[0],o,a.shape[2],a.shape[3]]);case 3:return Ow(a,[0,0,r,0],[a.shape[0],a.shape[1],o,a.shape[3]]);case 4:return Ok(a,r,o);default:throw new De(`The axis is not within the rank of the tensor ${c}`)}default:throw new De(`sliceAlongLastAxis() received an unsupported tensor rank: ${a.rank}`)}})}function Vk(a,r=-1){let o;return r<0&&(o=a[0].rank,o!==0?r=o:r=0),r===a[0].rank&&(r=-1),da(a,r)}function PG(a,r){switch(a.rank){case 1:return Dae([a,r]);case 2:return Oae([a,r],0);case 3:return Uae([a,r],0);case 4:return Gae([a,r],0);default:throw new De(`concatAlongFirstAxis() received an unsupported tensor rank: ${a.rank}`)}}function Uk(a,r){if(Array.isArray(r)||(r=[r]),a.rank!==r.length)throw new De(`The length of input n (${r.length}) does not match the number of dimensions in input x (${a.rank})`);return Rc(a,r)}function Kw(a,r=0,o=1,c,h){return jce(a,r,o,c,h)}function Ou(a,r,o,c){if(a.rank<2||r.rank<2)throw new hi(`dot requires both inputs to be rank >= 2 but got x shape = ${a.shape} and y shape = ${r.shape}`);if(r.rank>=3){const h=a.shape.slice(-1)[0],f=r.shape.slice(-2)[0];if(h!==f)throw new hi(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${a.shape} and  y shape = ${r.shape}`)}if(a.rank===2&&r.rank===2)return Ez({a,b:r,transposeA:!1,transposeB:!1,bias:c?zk(a.rank,c,Pc()):null,activation:o});{const h=a.shape.slice(),f=h.pop();a=Xe(a,[-1,f]);const m=r.shape.slice(),y=m.pop(),A=m.pop(),w=[...m,y],C=Array.from({length:r.rank},(T,B)=>B===0?r.rank-2:B<=r.rank-2?B-1:B);r=Xe(Li(r,C),[A,-1]);const _=[...h,...w];return Xe(Ez({a,b:r,transposeA:!1,transposeB:!1,bias:c?zk(a.rank,c,Pc()):null,activation:o}),_)}}function NG(a,r,o){return Qe(()=>(Array.isArray(r)?r=za(r,"int32"):r=pn(r,"int32"),PM(a,r,o)))}function Ov(a){return Ue(a,a)}function zk(a,r,o){const c=r.shape;if(r.rank!==1&&r.rank!==a)throw new De(`Unexpected bias dimensions: ${r.rank}; expected it to be 1 or ${a}`);if(a===5){if(o==="channelsFirst")return c.length===1?Xe(r,[1,c[0],1,1,1]):Xe(r,[1,c[3],c[0],c[1],c[2]]);if(o==="channelsLast")return c.length===1?Xe(r,[1,1,1,1,c[0]]):Xe(r,[1].concat(c))}else if(a===4){if(o==="channelsFirst")return c.length===1?Xe(r,[1,c[0],1,1]):Xe(r,[1,c[2],c[0],c[1]]);if(o==="channelsLast")return c.length===1?Xe(r,[1,1,1,c[0]]):Xe(r,[1].concat(c))}else if(a===3){if(o==="channelsFirst")return c.length===1?Xe(r,[1,c[0],1]):Xe(r,[1,c[1],c[0]]);if(o==="channelsLast")return c.length===1?Xe(r,[1,1,c[0]]):Xe(r,[1].concat(c))}else if(a<3)return r;throw new De(`Unsupported input rank by biasAdd: ${r.rank}`)}function Nc(a,r,o){return Qe(()=>(o==null&&(o=Pc()),$r(o),Ot(a,zk(a.rank,r,o))))}function Ipe(a,r=1){if(r!==1)throw new hi(`Support for alpha values other than 1 (${r}) is not implemented yet.`);return Rw(a)}function Spe(a){return Qe(()=>Vn(a,Ot(Bo(a),1)))}function DG(a,r,o,c){return Qe(()=>$ue(a,r,o,c))}function Tpe(a){return Qe(()=>{const r=Ot(.5,Ue(.2,a));return gl(r,0,1)})}function Vv(a,r,o=!1){return o?a():r()}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Mpe=["fanIn","fanOut","fanAvg"],kpe=["normal","uniform","truncatedNormal"];/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Rpe(a){_m(Mpe,"FanMode",a)}function Lpe(a){_m(kpe,"Distribution",a)}class Zl extends D0{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class FG extends Zl{apply(r,o){return Ns(r,o)}}FG.className="Zeros",Mt(FG);class Gk extends Zl{apply(r,o){return mf(r,o)}}Gk.className="Ones",Mt(Gk);class OG extends Zl{constructor(r){if(super(),typeof r!="object")throw new De(`Expected argument of type ConstantConfig but got ${r}`);if(r.value===void 0)throw new De(`config must have value set but got ${r}`);this.value=r.value}apply(r,o){return Qe(()=>Ue(Qi(this.value),mf(r,o)))}getConfig(){return{value:this.value}}}OG.className="Constant",Mt(OG);class VG extends Zl{constructor(r){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=r.minval||this.DEFAULT_MINVAL,this.maxval=r.maxval||this.DEFAULT_MAXVAL,this.seed=r.seed}apply(r,o){return Tv(r,this.minval,this.maxval,o,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}VG.className="RandomUniform",Mt(VG);class UG extends Zl{constructor(r){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=r.mean||this.DEFAULT_MEAN,this.stddev=r.stddev||this.DEFAULT_STDDEV,this.seed=r.seed}apply(r,o){if(o=o||"float32",o!=="float32"&&o!=="int32")throw new hi(`randomNormal does not support dType ${o}.`);return Kw(r,this.mean,this.stddev,o,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}UG.className="RandomNormal",Mt(UG);class zG extends Zl{constructor(r){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=r.mean||this.DEFAULT_MEAN,this.stddev=r.stddev||this.DEFAULT_STDDEV,this.seed=r.seed}apply(r,o){if(o=o||"float32",o!=="float32"&&o!=="int32")throw new hi(`truncatedNormal does not support dType ${o}.`);return xz(r,this.mean,this.stddev,o,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}zG.className="TruncatedNormal",Mt(zG);class GG extends Zl{constructor(r){super(),this.gain=r.gain!=null?r.gain:1}apply(r,o){return Qe(()=>{if(r.length!==2||r[0]!==r[1])throw new De("Identity matrix initializer can only be used for 2D square matrices.");return Ue(this.gain,YU(r[0]))})}getConfig(){return{gain:this.gain}}}GG.className="Identity",Mt(GG);function Bpe(a,r="channelsLast"){let o,c;if($r(r),a.length===2)o=a[0],c=a[1];else if([3,4,5].indexOf(a.length)!==-1){if(r==="channelsFirst"){const h=Af(a,2);o=a[1]*h,c=a[0]*h}else if(r==="channelsLast"){const h=Af(a,0,a.length-2);o=a[a.length-2]*h,c=a[a.length-1]*h}}else{const h=Af(a);o=Math.sqrt(h),c=Math.sqrt(h)}return[o,c]}class Ga extends Zl{constructor(r){if(super(),r.scale<0)throw new De(`scale must be a positive float. Got: ${r.scale}`);this.scale=r.scale==null?1:r.scale,this.mode=r.mode==null?"fanIn":r.mode,Rpe(this.mode),this.distribution=r.distribution==null?"normal":r.distribution,Lpe(this.distribution),this.seed=r.seed}apply(r,o){const c=Bpe(r),h=c[0],f=c[1];let m=this.scale;if(this.mode==="fanIn"?m/=Math.max(1,h):this.mode==="fanOut"?m/=Math.max(1,f):m/=Math.max(1,(h+f)/2),this.distribution==="normal"){const y=Math.sqrt(m);if(o=o||"float32",o!=="float32"&&o!=="int32")throw new hi(`${this.getClassName()} does not support dType ${o}.`);return xz(r,0,y,o,this.seed)}else{const y=Math.sqrt(3*m);return Tv(r,-y,y,o,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Ga.className="VarianceScaling",Mt(Ga);class Wk extends Ga{constructor(r){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}Wk.className="GlorotUniform",Mt(Wk);class Hk extends Ga{constructor(r){super({scale:1,mode:"fanAvg",distribution:"normal",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}Hk.className="GlorotNormal",Mt(Hk);class Xk extends Ga{constructor(r){super({scale:2,mode:"fanIn",distribution:"normal",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}Xk.className="HeNormal",Mt(Xk);class $k extends Ga{constructor(r){super({scale:2,mode:"fanIn",distribution:"uniform",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}$k.className="HeUniform",Mt($k);class Qk extends Ga{constructor(r){super({scale:1,mode:"fanIn",distribution:"normal",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}Qk.className="LeCunNormal",Mt(Qk);class Kk extends Ga{constructor(r){super({scale:1,mode:"fanIn",distribution:"uniform",seed:r==null?null:r.seed})}getClassName(){return Ga.className}}Kk.className="LeCunUniform",Mt(Kk);class WG extends Zl{constructor(r){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=r.gain==null?this.DEFAULT_GAIN:r.gain,this.seed=r.seed}apply(r,o){return Qe(()=>{if(r.length<2)throw new hi("Shape must be at least 2D.");if(o!=="int32"&&o!=="float32"&&o!==void 0)throw new TypeError(`Unsupported data type ${o}.`);o=o;const c=M(r.slice(0,-1)),h=r[r.length-1],f=c*h;f>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${f}) elements: Slowness may result.`);const m=[Math.max(h,c),Math.min(h,c)],y=Kw(m,0,1,o,this.seed),A=Ghe.qr(y,!1);let w=A[0];const C=A[1].flatten().stridedSlice([0],[Math.min(h,c)*Math.min(h,c)],[Math.min(h,c)+1]);return w=Ue(w,C.sign()),c<h&&(w=w.transpose()),Ue(Qi(this.gain),w.reshape(r))})}getConfig(){return{gain:this.gain,seed:this.seed}}}WG.className="Orthogonal",Mt(WG);const HG={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XG(a,r={}){return Nv(a,$l.getMap().classNameMap,r,"initializer")}function Mr(a){return Pk(a)}function xr(a){if(typeof a=="string"){const r=a in HG?HG[a]:a;if(r==="GlorotNormal")return new Hk;if(r==="GlorotUniform")return new Wk;if(r==="HeNormal")return new Xk;if(r==="HeUniform")return new $k;if(r==="LeCunNormal")return new Qk;if(r==="LeCunUniform")return new Kk;{const o={};return o.className=r,o.config={},XG(o)}}else return a instanceof Zl?a:XG(a)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Zk(a){return Array.isArray(a)&&Array.isArray(a[0])}function Zw(a){return a.length===0?[]:Array.isArray(a[0])?a:[a]}function $n(a){let r;if(Array.isArray(a)){if(a.length!==1)throw new De(`Expected Tensor length to be 1; got ${a.length}`);r=a[0]}else r=a;return r}function Pi(a){if(Array.isArray(a)&&Array.isArray(a[0])){if(a.length===1)return a=a,a[0];throw new De(`Expected exactly 1 Shape; got ${a.length}`)}else return a}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jw(a){let r=0;for(const o of a)o.shape.length===0?r+=1:r+=o.shape.reduce((c,h)=>c*h);return r}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const $G="Variable";class Ppe{constructor(r,o="float32",c=$G,h=!0,f=null){this.dtype=o??"float32",this.shape=r.shape,this.id=TG(),c=c??$G,this.originalName=RG(c),this.name=LG(this.originalName),this.trainable_=h,this.constraint=f,this.val=Gue(r,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(r){return this.assertNotDisposed(),Npe(this.val,r),this.val.id!==r.id&&(this.val.assign(r),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(r){this.trainable_=r,this.val.trainable=r}}function Npe(a,r){if(a.shape.toString()!==r.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(a.shape)+" vs. "+JSON.stringify(r.shape))}function jk(a){return a.map(r=>r.read())}function Yk(a){a.forEach(r=>{r[0].write(r[1])})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class vs{constructor(r){this.dtype=r.dtype,this.shape=r.shape,r.shape!=null?this.ndim=r.shape.length:this.ndim=r.ndim,this.maxNDim=r.maxNDim,this.minNDim=r.minNDim,this.axes=r.axes||{}}}class Vu{constructor(r,o,c,h,f,m,y){this.dtype=r,this.shape=o,this.sourceLayer=c,this.inputs=h,this.callArgs=f,this.outputTensorIndex=y,this.id=TG(),m!=null&&(this.originalName=RG(m),this.name=LG(this.originalName)),this.rank=o.length}}let Dpe=0;class Yw{constructor(r,o){this.callArgs=o,this.id=Dpe++,this.outboundLayer=r.outboundLayer,this.inboundLayers=r.inboundLayers,this.nodeIndices=r.nodeIndices,this.tensorIndices=r.tensorIndices,this.inputTensors=r.inputTensors,this.outputTensors=r.outputTensors,this.inputMasks=r.inputMasks,this.outputMasks=r.outputMasks,this.inputShapes=r.inputShapes,this.outputShapes=r.outputShapes;for(const c of r.inboundLayers)c!=null&&c.outboundNodes.push(this);r.outboundLayer.inboundNodes.push(this)}getConfig(){const r=[];for(const o of this.inboundLayers)o!=null?r.push(o.name):r.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:r,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let Fpe=0;class Ai extends D0{constructor(r={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Fpe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let o=r.name;if(!o){const c=this.getClassName();o=Kh(c)+"_"+$w(c)}if(this.name=o,this.trainable_=r.trainable==null?!0:r.trainable,r.inputShape!=null||r.batchInputShape!=null){let c;if(r.batchInputShape!=null)c=r.batchInputShape;else if(r.inputShape!=null){let f=null;r.batchSize!=null&&(f=r.batchSize),c=[f].concat(r.inputShape)}this.batchInputShape=c;let h=r.dtype;h==null&&(h=r.inputDType),h==null&&(h="float32"),this.dtype=h}r.weights!=null?this.initialWeights=r.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(r,o){return r.name+"_ib-"+o.toString()}getNodeAtIndex(r,o){if(this.inboundNodes.length===0)throw new Ql(`The layer has never been called and thus has no defined ${o}.`);if(this.inboundNodes.length<=r)throw new De(`Asked to get ${o} at node ${r}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[r]}getInputAt(r){return pa(this.getNodeAtIndex(r,"input").inputTensors)}getOutputAt(r){return pa(this.getNodeAtIndex(r,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Du(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Du(`Layer ${this.name} is not connected, no input to return.`);return pa(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Du(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Du(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return pa(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(r=>r())}get updates(){return this._updates}get built(){return this._built}set built(r){this._built=r}get trainable(){return this.trainable_}set trainable(r){this._trainableWeights.forEach(o=>o.trainable=r),this.trainable_=r}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(r=>r.trainable):[]}set trainableWeights(r){this._trainableWeights=r}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(r=>!r.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(r){this._nonTrainableWeights=r}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(r){const o=ji(r);if(this.inputSpec==null||this.inputSpec.length===0)return;const c=ji(this.inputSpec);if(o.length!==c.length)throw new De(`Layer ${this.name} expects ${c.length} inputs, but it received ${o.length} input tensors. Input received: ${r}`);for(let h=0;h<o.length;h++){const f=o[h],m=c[h];if(m==null)continue;const y=f.rank;if(m.ndim!=null&&y!==m.ndim)throw new De(`Input ${h} is incompatible with layer ${this.name}: expected ndim=${m.ndim}, found ndim=${y}`);if(m.maxNDim!=null&&y>m.maxNDim)throw new De(`Input ${h} is incompatible with layer ${this.name}: expected max_ndim=${m.maxNDim}, found ndim=${y}`);if(m.minNDim!=null&&y<m.minNDim)throw new De(`Input ${h} is incompatible with layer ${this.name}: expected min_ndim=${m.minNDim}, found ndim=${y}.`);if(m.dtype!=null&&f.dtype!==m.dtype)throw new De(`Input ${h} is incompatible with layer ${this.name} : expected dtype=${m.dtype}, found dtype=${f.dtype}.`);if(m.axes){const A=f.shape;for(const w in m.axes){const C=Number(w),_=m.axes[w],T=C>=0?A[C]:A[A.length+C];if(_!=null&&[_,null].indexOf(T)===-1)throw new De(`Input ${h} is incompatible with layer ${this.name}: expected axis ${C} of input shape to have value ${_} but got shape ${A}.`)}}if(m.shape!=null)for(let A=0;A<m.shape.length;++A){const w=m.shape[A],C=f.shape[A];if(w!=null&&C!=null&&w!==C)throw new De(`Input ${h} is incompatible with layer ${this.name}: expected shape=${m.shape}, found shape=${f.shape}.`)}}}call(r,o){return r}invokeCallHook(r,o){this._callHook!=null&&this._callHook(r,o)}setCallHook(r){this._callHook=r}clearCallHook(){this._callHook=null}apply(r,o){o=o||{},this.assertNotDisposed();const c=ji(r),h=Upe(r),f=zpe(r);if(h===f)throw new De("Arguments to apply() must be all SymbolicTensors or all Tensors");return Im(this.name,()=>{if(!this.built){this.assertInputCompatibility(r);const m=[];for(const y of ji(r))m.push(y.shape);this.build(pa(m)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&f&&(this._refCount=1)}if(this.assertInputCompatibility(r),f){let m=this.call(r,o);this.supportsMasking&&this.setMaskMetadata(r,m);const y=ji(m),A=[];for(let w of y)c.indexOf(w)!==-1&&(w=w.clone()),A.push(w);if(m=pa(A),this.activityRegularizer!=null)throw new hi("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m}else{const m=Ope(r),y=this.computeOutputShape(m);let A;const w=Vpe(r);if(this.warnOnIncompatibleInputShape(Array.isArray(r)?m[0]:m),y!=null&&y.length>0&&Array.isArray(y[0])?A=y.map((C,_)=>new Vu(w,C,this,ji(r),o,this.name,_)):A=new Vu(w,y,this,ji(r),o,this.name),this.addInboundNode(r,A,null,null,m,y,o),this._refCount++,this.activityRegularizer!=null)throw new hi("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return A}})}warnOnIncompatibleInputShape(r){if(this.batchInputShape!=null)if(r.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(r)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let o=!1;this.batchInputShape.forEach((c,h)=>{c!=null&&r[h]!=null&&r[h]!==c&&(o=!0)}),o&&console.warn(`The shape of the input tensor (${JSON.stringify(r)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Du(`The layer ${this.name} has never been called and thus has no defined output shape.`);const r=[];for(const o of this.inboundNodes){const c=JSON.stringify(o.outputShapes);r.indexOf(c)===-1&&r.push(c)}if(r.length===1){const o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&o.length===1?o[0]:o}else throw new Du(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ql(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return jw(this.weights)}build(r){this.built=!0}getWeights(r=!1){return jk(r?this.trainableWeights:this.weights)}setWeights(r){Qe(()=>{const o=this.weights;if(o.length!==r.length)throw new De(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${r.length}, but the layer was expecting ${o.length} weights. Provided weights: ${r}...`);if(o.length===0)return;const c=[],h=jk(o);for(let f=0;f<h.length;++f){const m=h[f],y=o[f],A=r[f];if(!R(m.shape,A.shape))throw new De(`Layer weight shape ${m.shape} not compatible with provided weight shape ${A.shape}`);c.push([y,A])}Yk(c)})}addWeight(r,o,c,h,f,m,y,A){if(this._addedWeightNames.indexOf(r)!==-1)throw new De(`Duplicate weight name ${r} for layer ${this.name}`);this._addedWeightNames.push(r),c==null&&(c="float32"),this.fastWeightInitDuringBuild&&(h=A!=null?A():xr("zeros"));const w=h.apply(o,c),C=new Ppe(w,c,r,m,y);return w.dispose(),f!=null&&this.addLoss(()=>f.apply(C.read())),m==null&&(m=!0),m?this._trainableWeights.push(C):this._nonTrainableWeights.push(C),C}setFastWeightInitDuringBuild(r){this.fastWeightInitDuringBuild=r}addLoss(r){r==null||Array.isArray(r)&&r.length===0||(r=ji(r),this._losses!==void 0&&this._losses!==null&&this.losses.push(...r))}computeOutputShape(r){return r}computeMask(r,o){if(!this.supportsMasking){if(o!=null)if(Array.isArray(o))o.forEach(c=>{if(c!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return o}setMaskMetadata(r,o,c){if(!this.supportsMasking)return;const h=this.computeMask(r,c),f=ji(o),m=ji(h);if(f.length!==m.length)throw new Error(`${this.name} outputs ${f.length} tensors but ${f.length} masks for those tensors`);for(let y=0;y<f.length;y++)f[y].kerasMask=m[y]}addInboundNode(r,o,c,h,f,m,y=null){const A=ji(r);o=ji(o),c=ji(c),h=ji(h),f=Zw(f),m=Zw(m);const w=[],C=[],_=[];for(const T of A)w.push(T.sourceLayer),C.push(T.nodeIndex),_.push(T.tensorIndex);new Yw({outboundLayer:this,inboundLayers:w,nodeIndices:C,tensorIndices:_,inputTensors:A,outputTensors:o,inputMasks:c,outputMasks:h,inputShapes:f,outputShapes:m},y);for(let T=0;T<o.length;T++)o[T].sourceLayer=this,o[T].nodeIndex=this.inboundNodes.length-1,o[T].tensorIndex=T}getConfig(){const r={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(r.batchInputShape=this.batchInputShape),this.dtype!=null&&(r.dtype=this.dtype),r}disposeWeights(){return this.weights.forEach(r=>r.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let r=0;return--this._refCount===0&&(r=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:r}}}function Ope(a){a=ji(a);const r=[];for(const o of a)r.push(o.shape);return pa(r)}function Vpe(a){return"float32"}function QG(a,r,o){if((r==null||o!=null&&o>0)&&(r=a.sourceLayer,o=a.nodeIndex),r.inboundNodes.length===0)return[a];{const c=r.inboundNodes[o];if(c.inboundLayers.length===0)return c.inputTensors;{const h=[];for(let f=0;f<c.inboundLayers.length;f++){const m=c.inputTensors[f],y=c.inboundLayers[f],A=c.nodeIndices[f],w=QG(m,y,A);for(const C of w)h.indexOf(C)===-1&&h.push(C)}return h}}}function Upe(a){let r=!0;for(const o of ji(a))if(!(o instanceof Vu)){r=!1;break}return r}function zpe(a){let r=!0;for(const o of ji(a))if(o instanceof Vu){r=!1;break}return r}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Uv extends Ai{constructor(r){if(super({dtype:r.dtype,name:r.name!=null?r.name:$w("input").toString()}),r.batchSize==null&&(r.batchSize=null),r.sparse==null&&(r.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=r.sparse,r.inputShape!=null&&r.batchInputShape!=null)throw new De("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let o=r.batchInputShape;if(o==null){if(r.inputShape==null)throw new De("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");o=[r.batchSize].concat(r.inputShape)}else if(r.batchSize!=null)throw new De("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const c=r.dtype||"float32";this.batchInputShape=o,this.dtype=c,this.inputSpec=[{shape:o}];const h=new Vu(this.dtype,this.batchInputShape,this,[],{},this.name);h.nodeIndex=0,h.tensorIndex=0,new Yw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[h],outputTensors:[h],inputMasks:[null],outputMasks:[null],inputShapes:[o],outputShapes:[o]})}apply(r,o){throw new De(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}Uv.className="InputLayer",Mt(Uv);function Gpe(a){if(a.batchShape==null&&a.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(a.batchShape!=null&&a.shape!=null)throw new De("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let r=a.batchShape;a.shape!=null&&r==null&&(r=[null].concat(a.shape));let o=a.dtype;return o==null&&(o="float32"),new Uv({batchInputShape:r,name:a.name,dtype:o,sparse:a.sparse}).inboundNodes[0].outputTensors[0]}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Wpe(a,r){if(a.dtype==null||a.dtype===r.dtype)return r;try{return pn(r,a.dtype)}catch{throw new De(`The dtype of the feed (${r.dtype}) can not be cast to the dtype of the key '${a.name}' (${a.dtype}).`)}}class bf{constructor(r){if(this.id2Value={},this.id2Mask={},this.name2Id={},r instanceof bf)for(const o in r.id2Value)this.id2Value[o]=r.id2Value[o],o in r.id2Mask&&(this.id2Mask[o]=r.id2Mask[o]);else{if(r==null)return;for(const o of r)this.add(o.key,o.value)}}add(r,o,c){if(this.id2Value[r.id]==null)this.id2Value[r.id]=Wpe(r,o),this.name2Id[r.name]=r.id,c!=null&&(this.id2Mask[r.id]=c);else throw new De(`Duplicate key: name=${r.name}, id=${r.id}`);return this}addFeed(r){this.add(r.key,r.value)}hasKey(r){return this.id2Value[r.id]!=null}names(){return Object.keys(this.name2Id)}getValue(r){if(r instanceof Vu){if(this.id2Value[r.id]==null)throw new De(`Nonexistent key: ${r.name}`);return this.id2Value[r.id]}else{const o=this.name2Id[r];if(o==null)throw new De(`Feed dict has no SymbolicTensor name: ${r}`);return this.id2Value[o]}}getMask(r){if(r instanceof Vu){if(this.id2Value[r.id]==null)throw new De(`Nonexistent key: ${r.name}`);return this.id2Mask[r.id]}else{const o=this.name2Id[r];if(o==null)throw new De(`Feed dict has no SymbolicTensor name: ${r}`);return this.id2Mask[o]}}disposeMasks(){this.id2Mask!=null&&vi(this.id2Mask)}}const qw=new EG,Jw=new EG;function Hpe(a){qw!=null&&qw.setMaxEntries(a),Jw!=null&&Jw.setMaxEntries(a)}function zv(a,r,o,c){const h=o==null?!1:o.training,f=Array.isArray(a),m=f?a:[a],y=m.map(O=>O.name),A=[],w=r.names();for(const O of y)w.indexOf(O)!==-1?A.push(r.getValue(O)):A.push(null);const C=y.join(",")+"|"+r.names().sort().join(",");let _=qw.get(C),T;if(_==null){const O=Xpe(m,r);_=O.sorted,T=O.recipientCounts,qw.put(C,_),Jw.put(C,T)}T={},h||Object.assign(T,Jw.get(C));const B=new bf(r);for(let O=0;O<_.length;++O){const U=_[O],W=U.sourceLayer;if(W instanceof Uv)continue;const z=[],X=[],re=[];let se=!1;for(const Se of U.inputs){const Be=B.getValue(Se),Ye=B.getMask(Se);z.push(Be),X.push(Ye),Ye!=null&&(se=!0),h||(T[Se.name]--,T[Se.name]===0&&!r.hasKey(Se)&&y.indexOf(Se.name)===-1&&!Be.isDisposed&&Se.sourceLayer.stateful!==!0&&re.push(Be))}se&&(o=o||{},o.mask=X[0]);const le=ji(W.apply(z,o));let ge=null;W.supportsMasking&&(ge=W.computeMask(z,X));const ye=Qpe(U),be=Array.isArray(ye)?ye:[ye];for(let Se=0;Se<be.length;++Se){B.hasKey(be[Se])||B.add(be[Se],le[Se],Array.isArray(ge)?ge[0]:ge);const Be=y.indexOf(be[Se].name);Be!==-1&&(A[Be]=le[Se])}h||vi(re)}return B.disposeMasks(),f?A:A[0]}function Xpe(a,r){b(a!=null&&a.length>0,()=>"Expected at least one fetch, got none");let o=[],c={};if(a.length===1){const h=KG(a[0],r);o=h.sorted,c=h.recipientMap}else{const h=new Set;for(const f of a){const{sorted:m,recipientMap:y}=KG(f,r);for(const A of m)h.has(A.name)||(o.push(A),h.add(A.name));for(const A in y)c[A]==null&&(c[A]=new Set),y[A].forEach(w=>c[A].add(w))}}return{sorted:o,recipientCounts:$pe(c)}}function $pe(a){const r={};for(const o in a)r[o]=a[o].size;return r}function KG(a,r){const o=new Set,c=[],h={};for(const y of r.names())o.add(y);const f=[],m=[];for(f.push(a);f.length>0;){const y=f[f.length-1];if(o.has(y.name)){f.pop();continue}const A=m[m.length-1]===f.length-1;if(y.inputs.length===0||A)f.pop(),c.push(y),o.add(y.name),A&&m.pop();else{m.push(f.length-1);for(const w of y.inputs)h[w.name]==null&&(h[w.name]=new Set),h[w.name].add(y.name),!o.has(w.name)&&f.push(w)}}return{sorted:c,recipientMap:h}}function Qpe(a){let r;if(a.sourceLayer.inboundNodes.length===1)r=a.sourceLayer.output;else{let o=null;for(let c=0;c<a.sourceLayer.inboundNodes.length;++c)for(const h of a.sourceLayer.inboundNodes[c].outputTensors)if(h.id===a.id){o=c;break}r=a.sourceLayer.getOutputAt(o)}return r}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Te().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Hpe);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function qk(a,r){return Qe(()=>No(Bn(Ue(a,a),r,!0)))}class Gv extends D0{getConfig(){return{}}}class ZG extends Gv{constructor(r){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=r.maxValue!=null?r.maxValue:this.defaultMaxValue,this.axis=r.axis!=null?r.axis:this.defaultAxis}apply(r){return Qe(()=>{const o=qk(r,this.axis),c=gl(o,0,this.maxValue);return Ue(r,Vn(c,Ot(As(),o)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}ZG.className="MaxNorm",Mt(ZG);class jG extends Gv{constructor(r){super(),this.defaultAxis=0,this.axis=r.axis!=null?r.axis:this.defaultAxis}apply(r){return Qe(()=>Vn(r,Ot(As(),qk(r,this.axis))))}getConfig(){return{axis:this.axis}}}jG.className="UnitNorm",Mt(jG);class YG extends Gv{apply(r){return Am(r)}}YG.className="NonNeg",Mt(YG);class qG extends Gv{constructor(r){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=r.minValue!=null?r.minValue:this.defaultMinValue,this.maxValue=r.maxValue!=null?r.maxValue:this.defaultMaxValue,this.rate=r.rate!=null?r.rate:this.defaultRate,this.axis=r.axis!=null?r.axis:this.defaultAxis}apply(r){return Qe(()=>{const o=qk(r,this.axis),c=Ot(Ue(this.rate,gl(o,this.minValue,this.maxValue)),Ue(1-this.rate,o));return Ue(r,Vn(c,Ot(As(),o)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}qG.className="MinMaxNorm",Mt(qG);const JG={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function bs(a){return Pk(a)}function e5(a,r={}){return Nv(a,$l.getMap().classNameMap,r,"constraint")}function xs(a){if(a==null)return null;if(typeof a=="string"){const r={className:a in JG?JG[a]:a,config:{}};return e5(r)}else return a instanceof Gv?a:e5(a)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/async function Tm(a){if(a==null)return;const r=[],o=[],c=[];for(const h in a){const f=a[h];if(typeof f!="number"){const m=f;r.push(m.data()),o.push(h),c.push(m)}}if(r.length>0){const h=await Promise.all(r);for(let f=0;f<h.length;++f)a[o[f]]=h[f][0];vi(c)}}function t5(a){if(a!=null)for(const r in a){const o=a[r];typeof o!="number"&&o.dispose()}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var n5;(function(a){a[a.SILENT=0]="SILENT",a[a.VERBOSE=1]="VERBOSE"})(n5||(n5={}));const Kpe=125;class Wv{constructor(){this.validationData=null}setParams(r){this.params=r}async onEpochBegin(r,o){}async onEpochEnd(r,o){}async onBatchBegin(r,o){}async onBatchEnd(r,o){}async onTrainBegin(r){}async onTrainEnd(r){}setModel(r){}}class Zpe{constructor(r,o=10){r==null&&(r=[]),this.callbacks=r,this.queueLength=o}append(r){this.callbacks.push(r)}setParams(r){for(const o of this.callbacks)o.setParams(r)}setModel(r){for(const o of this.callbacks)o.setModel(r)}async onEpochBegin(r,o){o==null&&(o={});for(const c of this.callbacks)await c.onEpochBegin(r,o)}async onEpochEnd(r,o){o==null&&(o={});for(const c of this.callbacks)await c.onEpochEnd(r,o)}async onBatchBegin(r,o){o==null&&(o={});for(const c of this.callbacks)await c.onBatchBegin(r,o)}async onBatchEnd(r,o){o==null&&(o={});for(const c of this.callbacks)await c.onBatchEnd(r,o)}async onTrainBegin(r){r==null&&(r={});for(const o of this.callbacks)await o.onTrainBegin(r)}async onTrainEnd(r){r==null&&(r={});for(const o of this.callbacks)await o.onTrainEnd(r)}}class jpe extends Wv{constructor(){super()}async onEpochBegin(r){this.seen=0,this.totals={}}async onBatchEnd(r,o){o==null&&(o={});const c=o.size==null?0:o.size;this.seen+=c;for(const h in o){const f=o[h];if(typeof f=="number")this.totals.hasOwnProperty(h)||(this.totals[h]=0),this.totals[h]=this.totals[h]+f*c;else{let m;h in this.totals?m=this.totals[h]:this.totals[h]=0;const y=Qe(()=>Ot(this.totals[h],Ue(f,c)));this.totals[h]=y,m!=null&&m.dispose()}}}async onEpochEnd(r,o){if(o!=null)for(const c of this.params.metrics)this.totals[c]!=null&&(typeof this.totals[c]=="number"?o[c]=this.totals[c]/this.seen:Qe(()=>{const h=Ue(Vn(1,this.seen),this.totals[c]);o[c]=h,this.totals[c].dispose(),ml(o[c])}))}}class Ype extends Wv{async onTrainBegin(r){this.epoch=[],this.history={}}async onEpochEnd(r,o){o==null&&(o={}),this.epoch.push(r);for(const c in o)this.history[c]==null&&(this.history[c]=[]),this.history[c].push(o[c])}async syncData(){const r=[],o=[],c=[];for(const f in this.history){const m=this.history[f];for(let y=0;y<m.length;++y)if(typeof m[y]!="number"){const A=m[y];r.push(A.data()),o.push(f),c.push(y)}}const h=await Promise.all(r);for(let f=0;f<h.length;++f)this.history[o[f]][c[f]].dispose(),this.history[o[f]][c[f]]=h[f][0]}}class qpe extends Wv{constructor(r,o){if(super(),this.currentEpoch=0,this.nowFunc=r.nowFunc,this.nextFrameFunc=r.nextFrameFunc||Uw,this.yieldEvery=o||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Kpe),this.yieldEvery==="never"&&r.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Me(this.yieldEvery)&&(this.maybeWait=dpe(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=r.onTrainBegin,this.trainEnd=r.onTrainEnd,this.epochBegin=r.onEpochBegin,this.epochEnd=r.onEpochEnd,this.batchBegin=r.onBatchBegin,this.batchEnd=r.onBatchEnd,this.yield=r.onYield}async maybeWait(r,o,c){const h=[];this.yield!=null&&(await Tm(c),h.push(this.yield(r,o,c))),h.push(this.nextFrameFunc()),await Promise.all(h)}async onEpochBegin(r,o){this.currentEpoch=r,this.epochBegin!=null&&(await Tm(o),await this.epochBegin(r,o))}async onEpochEnd(r,o){const c=[];this.epochEnd!=null&&(await Tm(o),c.push(this.epochEnd(r,o))),this.yieldEvery==="epoch"&&c.push(this.nextFrameFunc()),await Promise.all(c)}async onBatchBegin(r,o){this.batchBegin!=null&&(await Tm(o),await this.batchBegin(r,o))}async onBatchEnd(r,o){const c=[];this.batchEnd!=null&&(await Tm(o),c.push(this.batchEnd(r,o))),this.yieldEvery==="batch"?c.push(this.nextFrameFunc()):Me(this.yieldEvery)&&c.push(this.maybeWait(this.currentEpoch,r,o)),await Promise.all(c)}async onTrainBegin(r){this.trainBegin!=null&&(await Tm(r),await this.trainBegin(r))}async onTrainEnd(r){this.trainEnd!=null&&(await Tm(r),await this.trainEnd(r))}}function i5(a,r){return a==null&&(a={}),a instanceof Wv?[a]:Array.isArray(a)&&a[0]instanceof Wv?a:ji(a).map(o=>new qpe(o,r))}class jl{constructor(){}static registerCallbackConstructor(r,o){b(r>=0&&Number.isInteger(r),()=>`Verbosity level is expected to be an integer >= 0, but got ${r}`),jl.checkForDuplicate(o),jl.constructors[r]==null&&(jl.constructors[r]=[]),jl.constructors[r].push(o)}static checkForDuplicate(r){for(const o in jl.constructors)jl.constructors[+o].forEach(c=>{if(c===r)throw new De("Duplicate callback constructor.")})}static clear(){jl.constructors={}}static createCallbacks(r){const o=[];for(const c in jl.constructors){const h=+c;r>=h&&o.push(...jl.constructors[h])}return o.map(c=>new c)}}jl.constructors={};function r5(a,r,o,c,h,f,m,y,A){const w=new Ype,C=[new jpe,...jl.createCallbacks(r)];a!=null&&C.push(...a),C.push(w);const _=new Zpe(C);return _.setParams({epochs:o,initialEpoch:c,samples:h,steps:f,batchSize:m,verbose:r,doValidation:y,metrics:A}),{callbackList:_,history:w}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jh(a,r={},o=!1){return Nv(a,$l.getMap().classNameMap,r,"layer",o)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function eC(a,r){return Qe(()=>{a.dtype!=="float32"&&(a=pn(a,"float32"));const o=Bn(Ov(a),r,!0),c=kw(o.shape,As()),h=No(pf(o,c));return Vn(a,h)})}function tC(a,r){return Qe(()=>is(Ov(Wn(r,a)),-1))}function Jk(a,r){return Qe(()=>is(Bo(Wn(r,a)),-1))}function eR(a,r){return Qe(()=>{const o=Wn(a,r),c=gl(Bo(a),As(),Number.MAX_VALUE),h=Bo(Vn(o,c));return Ue(100,is(h,-1))})}function Jpe(a,r){return Qe(()=>{const o=gl(r,As(),Number.MAX_VALUE),c=Bu(Ot(1,o)),h=gl(a,As(),Number.MAX_VALUE),f=Bu(Ot(1,h));return is(Ov(Wn(c,f)),-1)})}function eme(a,r){return Qe(()=>{const o=pf(0,Wn(1,Ue(a,r)));return is(Ov(o),-1)})}function tme(a,r){return Qe(()=>{const o=pf(0,Wn(1,Ue(a,r)));return is(o,-1)})}function nme(a,r){return Qe(()=>{const o=Bn(Ue(a,r),-1),c=kc(Ue(Wn(1,a),r),-1);return pf(0,Ot(1,Wn(c,o)))})}function ime(a,r){return Qe(()=>{const o=Math.log(2),c=Wn(r,a),h=Wn(Ot(c,Iv(Ue(-2,c))),o);return is(h,-1)})}function Hv(a,r,o=!1){return Qe(()=>{if(o)r=$M(r);else{const c=Bn(r,r.shape.length-1,!0);r=Vn(r,c)}return r=gl(r,As(),1-As()),Xr(Bn(Ue(pn(a,"float32"),Bu(r)),r.shape.length-1))})}function nC(a,r,o=!1){return Qe(()=>{const c=pn(Pw(Epe(a)),"int32");r=gl(r,As(),1-As());const h=r.shape,f=Xe(nz(c,h[h.length-1]),h);return Hv(f,r,o)})}function rme(a,r){if(!R(a.shape,r.shape))throw new De(`logits and labels must have the same shape, but got shapes ${JSON.stringify(a.shape)} and ${JSON.stringify(r.shape)}`);return Qe(()=>{const o=Am(r),c=Xr(Bo(r));return Ot(Wn(o,Ue(r,a)),qU(Lu(c)))})}function iC(a,r){return Qe(()=>{let o;return o=gl(r,As(),1-As()),o=Bu(Vn(o,Wn(1,o))),is(rme(a,o),-1)})}function sme(a,r){return Qe(()=>{const o=gl(a,As(),1),c=gl(r,As(),1);return Bn(Ue(a,Bu(Vn(o,c))),-1)})}function ome(a,r){return Qe(()=>{const o=Bu(Ot(As(),r));return is(Wn(r,Ue(a,o)),-1)})}function s5(a,r){return Qe(()=>{const o=eC(a,-1),c=eC(r,-1),h=Ue(o,c);return Xr(Bn(h,-1))})}const rC={meanSquaredError:tC,meanAbsoluteError:Jk,meanAbsolutePercentageError:eR,meanSquaredLogarithmicError:Jpe,squaredHinge:eme,hinge:tme,categoricalHinge:nme,logcosh:ime,categoricalCrossentropy:Hv,sparseCategoricalCrossentropy:nC,binaryCrossentropy:iC,kullbackLeiblerDivergence:sme,poisson:ome,cosineProximity:s5};function tR(a){if(typeof a=="string"){if(a in rC)return rC[a];let r=`Unknown loss ${a}`;throw a.toLowerCase().includes("softmaxcrossentropy")&&(r=`Unknown loss ${a}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new De(r)}else return a}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function o5(a,r){return Qe(()=>{const o=Ue(.5,Xl(r)),c=Zh(yl(r,o),a.dtype);return is(Ru(a,c),-1)})}function a5(a,r){return Qe(()=>Zh(Ru(bv(a,-1),bv(r,-1)),"float32"))}function ame(a,r){return Qe(()=>pn(Bn(Hh(Ru(a,1),Ru(r,1))),"float32"))}function lme(a,r){return Qe(()=>pn(Bn(Hh(Ru(a,0),Ru(r,1))),"float32"))}function cme(a,r){return Qe(()=>{const o=ame(a,r),c=lme(a,r),h=Ot(o,c);return pn(Po(yl(h,0),Vn(o,h),0),"float32")})}function ume(a,r){return iC(a,r)}function hme(a,r){return a.rank===r.rank&&(a=kv(a,[a.rank-1])),r=bv(r,-1),r.dtype!==a.dtype&&(r=pn(r,a.dtype)),pn(Ru(a,r),"float32")}const dme=tC,fme=tC,pme=Jk,mme=Jk,gme=eR,yme=eR,l5=Hv,Ame=s5,c5=nC,sC={binaryAccuracy:o5,categoricalAccuracy:a5,precision:cme,categoricalCrossentropy:l5,sparseCategoricalCrossentropy:c5,mse:dme,MSE:fme,mae:pme,MAE:mme,mape:gme,MAPE:yme,cosine:Ame};function vme(a){if(typeof a=="string"&&a in sC)return sC[a];if(typeof a!="string"&&a!=null)return a;throw new De(`Unknown metric ${a}`)}function oC(a){if(Fu(a!==null,`Unknown LossOrMetricFn ${a}`),typeof a=="string")return a;{let r;for(const o of Object.keys(rC))if(rC[o]===a){r=o;break}if(r!==void 0)return r;for(const o of Object.keys(sC))if(sC[o]===a){r=o;break}return r!==void 0?r:a.name}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function bme(a){const r={Adagrad:()=>F0.adagrad(.01),Adadelta:()=>F0.adadelta(1,.95,As()),Adam:()=>F0.adam(.001,.9,.999,As()),Adamax:()=>F0.adamax(.002,.9,.999,As(),0),RMSProp:()=>F0.rmsprop(.001,.9,0,As()),SGD:()=>F0.sgd(.01)};if(r.adagrad=r.Adagrad,r.adadelta=r.Adadelta,r.adam=r.Adam,r.adamax=r.Adamax,r.rmsprop=r.RMSProp,r.sgd=r.SGD,a in r)return r[a]();throw new De(`Unknown Optimizer ${a}`)}/**
* @license
* Copyright 2019 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const u5=1*1024*1024;function h5(a,r,o=!1){if(a==null||typeof a!="object"||Object.getPrototypeOf(a)!==Object.prototype||!nR(a))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(o){const c=JSON.stringify(a);c.length>u5&&console.warn(`User-defined metadata of model "${r}" is too large in size (length=${c.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${u5}.`)}}function nR(a){if(a===null)return!0;if(typeof a=="object")if(Object.getPrototypeOf(a)===Object.prototype){const r=Object.keys(a);for(const o of r)if(typeof o!="string"||!nR(a[o]))return!1;return!0}else if(Array.isArray(a)){for(const r of a)if(!nR(r))return!1;return!0}else return!1;else{const r=typeof a;return r==="string"||r==="number"||r==="boolean"}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function xme(a,r,o,c=console.log){const h=Cme(a),f=["Layer (type)","Input Shape","Output shape","Param #"];h?(r=r||90,o=o||[.32,.61,.89,1]):(r=r||115,o=o||[.24,.48,.7,.8,1]),o[o.length-1]<=1&&(o=o.map(C=>Math.floor(r*C)));let m;if(!h){f.push("Receives inputs"),m=[];for(const C in a.nodesByDepth)m.push(...a.nodesByDepth[C])}c("_".repeat(r)),aC(f,o,c),c("=".repeat(r));const y=a.layers;for(let C=0;C<y.length;++C)h?Eme(y[C],o,c):_me(y[C],o,m,c),c((C===y.length-1?"=":"_").repeat(r));a.checkTrainableWeightsConsistency();const A=wme(a),w=jw(a.nonTrainableWeights);c(`Total params: ${A+w}`),c(`Trainable params: ${A}`),c(`Non-trainable params: ${w}`),c("_".repeat(r))}function wme(a){let r;return a.collectedTrainableWeights!=null?r=jw(a.collectedTrainableWeights):r=jw(a.trainableWeights),r}function Cme(a){let r=!0;const o=[],c=[];for(const h in a.nodesByDepth)o.push(a.nodesByDepth[h]);for(const h of o){if(h.length>1||h.length===1&&h[0].inboundLayers.length>1){r=!1;break}c.push(...h)}if(r)for(const h of a.layers){let f=!1;for(const m of h.inboundNodes)if(c.indexOf(m)!==-1)if(f){r=!1;break}else f=!0;if(!r)break}return r}function aC(a,r,o=console.log){let c="";for(let h=0;h<a.length;++h)h>0&&(c=c.slice(0,c.length-1)+" "),c+=a[h],c=c.slice(0,r[h]),c+=" ".repeat(r[h]-c.length);o(c)}function Eme(a,r,o){let c,h;try{h=a.inboundNodes.map(A=>JSON.stringify(A.inputShapes)).join(",")}catch{h="multiple"}try{c=JSON.stringify(a.outputShape)}catch{c="multiple"}const f=a.name,m=a.getClassName(),y=[`${f} (${m})`,h,c,a.countParams().toString()];aC(y,r,o)}function _me(a,r,o,c){let h,f;try{f=a.inboundNodes.map(_=>JSON.stringify(_.inputShapes)).join(",")}catch{f="multiple"}try{h=JSON.stringify(a.outputShape)}catch{h="multiple"}const m=[];for(const _ of a.inboundNodes)if(!(o!=null&&o.length>0&&o.indexOf(_)===-1))for(let T=0;T<_.inboundLayers.length;++T){const B=_.inboundLayers[T].name,O=_.nodeIndices[T],U=_.tensorIndices[T];m.push(`${B}[${O}][${U}]`)}const y=a.name,A=a.getClassName(),w=m.length===0?"":m[0],C=[`${y} (${A})`,f,h,a.countParams().toString(),w];aC(C,r,c);for(let _=1;_<m.length;++_)aC(["","","","",m[_]],r,c)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function d5(a,r,o){return(a==="inboundNodes"||a==="outputLayers"||a==="inputLayers")&&r===0&&typeof o=="string"}function iR(a,r){if(a===null)return null;if(typeof a=="string")return Em(a);if(typeof a=="number"||typeof a=="boolean")return a;if(a instanceof Array){const o=[],c=a.length;for(let h=0;h<c;++h){const f=a[h];d5(r,h,f)?o.push(f):o.push(iR(f,r))}return o}else{const o={};for(const c of Object.keys(a)){const h=a[c];if(c==="name"&&typeof h=="string")o[c]=h;else{const f=Em(c);o[f]=iR(h,f)}}return o}}function rR(a,r){if(a==null)return null;if(typeof a=="string")return Kh(a);if(typeof a=="number"||typeof a=="boolean")return a;if(a instanceof Array){const o=[],c=a.length;for(let h=0;h<c;++h){const f=a[h];d5(r,h,f)?o.push(f):o.push(rR(f,r))}return o}else{const o={};for(const c of Object.keys(a)){const h=a[c],f=Kh(c);(c==="name"||c==="className")&&typeof h=="string"?o[f]=h:o[f]=rR(h,c)}return o}}/** @license See the LICENSE file. */const f5="4.16.0";/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Ime=a=>{const r=Object.keys(a);if(r.length===0)return!1;const o=r[0].split("/");return!isNaN(parseInt(o[o.length-1],10))};class Dc extends Ai{constructor(r){if(super({}),this.containerNodes=new Set,this.name=r.name,this.name==null){const X=this.getClassName().toLowerCase();this.name=$w(X)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(r.inputs)?this.inputs=r.inputs.slice():this.inputs=[r.inputs],Array.isArray(r.outputs)?this.outputs=r.outputs.slice():this.outputs=[r.outputs],yf(this.inputs).length!==this.inputs.length)throw new De(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(X=>X.name)}`);yf(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(X=>X.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const X of this.outputs){const re=X.sourceLayer,se=X.nodeIndex,le=X.tensorIndex;this.outputLayers.push(re),this.outputLayersNodeIndices.push(se),this.outputLayersTensorIndices.push(le)}for(const X of this.inputs){const re=X.sourceLayer,se=X.nodeIndex,le=X.tensorIndex;Fu(se===0,"input layer has >1 nodes"),Fu(le===0,"input layer has >1 tensors"),this.inputLayers.push(re),this.inputLayersNodeIndices.push(se),this.inputLayersTensorIndices.push(le)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let X=0;X<this.inputLayers.length;X++){const re=this.inputLayers[X];if(!(re instanceof Uv))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${r.inputs}. Input ${X} (0-based) originates from layer type ${re.getClassName()}.`);this.inputNames.push(re.name),this.feedInputShapes.push(re.batchInputShape),this.feedInputNames.push(re.name)}for(const X of this.outputLayers)this.outputNames.push(X.name);this.internalInputShapes=this.inputs.map(X=>X.shape),this.internalOutputShapes=this.outputs.map(X=>X.shape);const o={},c={},h={},f={},m={},y=[],A=(X,re,se,le,ge,ye)=>{(le==null||ge==null||ye==null)&&(le=X.sourceLayer,ge=X.nodeIndex,ye=X.tensorIndex);const be=le.inboundNodes[ge];if(se.indexOf(be)!==-1)throw new Ql(`The tensor ${X.name} at layer "${le.name}" is part of a cycle.`);if(re.indexOf(be)!==-1)return;this.containerNodes.add(Dc.nodeKey(le,ge)),le.id in m||(m[le.id]=Object.keys(m).length),se.indexOf(be)===-1&&se.push(be);const Se=be.inboundLayers.length;for(let Be=0;Be<Se;Be++){const Ye=be.inputTensors[Be],et=be.inboundLayers[Be],tt=be.nodeIndices[Be],ot=be.tensorIndices[Be];A(Ye,re,se,et,tt,ot)}for(re.push(be);se.indexOf(be)>=0;)se.splice(se.indexOf(be),1);y.push(be)},w=[],C=[];for(const X of this.outputs)A(X,w,C);const _=y.slice().reverse();for(const X of _){c[X.id]=X,X.id in o||(o[X.id]=0);let re=o[X.id];const se=h[X.outboundLayer.id]==null?0:h[X.outboundLayer.id];re=Math.max(re,se),h[X.outboundLayer.id]=re,f[X.outboundLayer.id]=X.outboundLayer,o[X.id]=re;for(let le=0;le<X.inboundLayers.length;le++){const ge=X.inboundLayers[le],ye=X.nodeIndices[le],be=ge.inboundNodes[ye],Se=o[be.id]==null?0:o[be.id];o[be.id]=Math.max(re+1,Se),c[be.id]=be}}const T={};for(const X in o){const re=o[X];re in T||(T[re]=[]),T[re].push(c[X])}const B={};for(const X in h){const re=h[X];re in B||(B[re]=[]),B[re].push(f[X])}let O=Object.keys(B).map(X=>parseInt(X,10)).sort(Hw);this.layers=[];for(const X of O){const re=B[X];re.sort((se,le)=>{const ge=m[se.id],ye=m[le.id];return ge<ye?-1:ge>ye?1:0});for(const se of re)se instanceof Dc&&this.internalContainerRefs.push(se),this.layers.push(se)}this.layersByDepth=B,O=Object.keys(T).map(X=>parseInt(X,10)).sort(Hw);const U=this.inputs.slice(),W=[];for(const X of O)for(const re of T[X]){const se=re.outboundLayer;if(se!=null){for(const le of re.inputTensors)if(U.indexOf(le)===-1)throw new Ql(`Graph disconnected: cannot obtain value for tensor ${le} at layer "${se.name}". The following previous layers were accessed without issue: ${W}`);for(const le of re.outputTensors)U.push(le);W.push(se.name)}}this.nodesByDepth=T;const z=this.layers.map(X=>X.name);for(const X of z){const re=z.filter(se=>se===X).length;if(re!==1)throw new Ql(`The name "${X}" is used ${re} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(z))}this.outboundNodes=[],this.inboundNodes=[],new Yw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(X=>null),outputMasks:this.outputs.map(X=>null),inputShapes:this.inputs.map(X=>X.shape),outputShapes:this.outputs.map(X=>X.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const r={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const o of this.layers)r.numDisposedVariables+=o.dispose().numDisposedVariables;for(const o of this.internalContainerRefs)r.numDisposedVariables+=o.dispose().numDisposedVariables}return r.refCountAfterDispose=this._refCount,r}get trainable(){return this.trainable_}set trainable(r){this.layers.forEach(o=>{o._trainableWeights.forEach(c=>c.trainable=r)}),this.trainable_=r}get trainableWeights(){if(this._trainableWeights.length>0)throw new De("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let r=[];for(const o of this.layers)r=r.concat(o.trainableWeights);return r}get nonTrainableWeights(){const r=[];for(const o of this.layers)r.push(...o.nonTrainableWeights);if(!this.trainable){const o=[];for(const c of this.layers)o.push(...c.trainableWeights);return o.concat(r)}return r}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(r,o=!0){const c={};let h=0;const f=Ime(r);f&&this.parseWeights(r);for(const y of this.layers)for(const[A,w]of y.weights.entries()){const C=f?`${w.name.split("/").slice(0,-1).join("/")+"/"}${A}`:w.originalName;if(c[C]!=null)throw new De(`Duplicate weight name: ${C}`);c[C]=w,h++}const m=[];for(const y in r){let A=y;if(c[y]==null){const w=y.split("/");A=w.slice(0,-2).concat([w[w.length-1]]).join("/")}if(c[A]!=null)m.push([c[A],r[y]]);else if(o)throw new De(`Provided weight data has no target variable: ${y}`);delete c[A]}if(o){const y=[];for(const A in c)y.push(A);if(y.length>0)throw new De(`${y.length} of ${h} weights are not set: ${y}`)}Yk(m)}parseWeights(r){for(const o in Object.keys(r)){const c=o.split("/"),h=["vars","layer_checkpoint_dependencies"],f=c.map(m=>m.startsWith("_")?m.slice(1):m).filter(m=>!h.includes(m)).join("/");f!==o&&(r[f]=r[o],delete r[o])}}updatedConfig(){const r=this.getConfig(),o={};return o.className=this.getClassName(),o.config=r,o.kerasVersion=`tfjs-layers ${f5}`,o.backend="TensorFlow.js",o}toJSON(r,o=!0){const c=rR(this.updatedConfig());return o?JSON.stringify(c):c}call(r,o){return Qe(()=>{r=ji(r);const c=new bf;for(let h=0;h<this.inputs.length;++h)c.add(this.inputs[h],r[h]);return zv(this.outputs,c,o)})}computeMask(r,o){return Qe(()=>{r=ji(r);let c;return o==null?c=Cm(null,r.length):c=ji(o),this.runInternalGraph(r,c)[1]})}computeOutputShape(r){const o=Zw(r);if(o.length!==this.inputLayers.length)throw new De(`Invalid inputShape argument ${r}: model has ${this.inputLayers.length} tensor inputs.`);const c={};for(let y=0;y<o.length;y++){const A=this.inputLayers[y],w=o[y],C=A.name+"_0_0";c[C]=w}const h=Object.keys(this.nodesByDepth).map(y=>parseInt(y,10)).sort(Hw);if(h.length>1)for(const y of h){const A=this.nodesByDepth[y];for(const w of A){const C=w.outboundLayer;if(this.inputLayers.map(U=>U.id).indexOf(C.id)!==-1)continue;const _=[];for(let U=0;U<w.inboundLayers.length;U++){const W=w.inboundLayers[U],z=w.nodeIndices[U],X=w.tensorIndices[U],re=`${W.name}_${z}_${X}`,se=c[re];_.push(se)}const T=C.computeOutputShape(pa(_)),B=Zw(T),O=C.inboundNodes.indexOf(w);for(let U=0;U<B.length;U++){const W=`${C.name}_${O}_${U}`;c[W]=B[U]}}}const f=[],m=[];for(let y=0;y<this.outputLayers.length;y++){const A=this.outputLayers[y],w=this.outputLayersNodeIndices[y],C=this.outputLayersTensorIndices[y],_=`${A.name}_${w}_${C}`;m.push(_)}for(let y=0;y<m.length;y++){const A=m[y];Fu(A in c),f.push(c[A])}return pa(f)}runInternalGraph(r,o){o==null&&(o=Cm(null,r.length));const c={};for(let A=0;A<this.inputs.length;++A){const w=this.inputs[A],C=r[A],_=o[A];c[w.id]=[C,_]}const h=Object.keys(this.nodesByDepth).map(A=>parseInt(A,10)).sort(Hw);for(const A of h){const w=this.nodesByDepth[A];for(const C of w){const _=C.outboundLayer,T=C.inputTensors,B=C.outputTensors,O=new Array;for(const U of T)U.id in c&&O.push(c[U.id]);if(O.length===T.length){let U={},W,z,X,re;if(C.callArgs!=null&&(U=C.callArgs),O.length===1){const[se,le]=O[0];U.mask==null&&(U.mask=le),X=ji(_.call(se,U)),re=ji(_.computeMask(se,le)),W=[se],z=[le]}else W=O.map(se=>se[0]),z=O.map(se=>se[1]),U.mask==null&&(U.mask=z),X=ji(_.call(W,U)),re=ji(_.computeMask(W,z));if(_.activityRegularizer)throw new hi("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let se=0;se<B.length;++se){const le=B[se],ge=X[se],ye=re[se];c[le.id]=[ge,ye]}}}}const f=[],m=[],y=[];for(const A of this.outputs){Fu(A.id in c,`Could not compute output ${A.name} : ${A.id}`);const[w,C]=c[A.id];y.push(w.shape),f.push(w),m.push(C)}return[f,m,y]}buildNodeConversionMap(r){const o={};let c;for(const h of this.layers){c=h instanceof Dc?1:0;for(let f=0;f<h.inboundNodes.length;f++){const m=Dc.nodeKey(h,f);this.containerNodes.has(m)&&(o[m]=c,c+=1)}}return o}getLayer(r,o){if(o!=null)return this.findLayer(o);if(r==null)throw new De("Provide either a layer name or layer index");if(typeof r=="number")return this.findLayer(r);for(const c of this.layers)if(c.name===r)return c;throw new De(`No such layer: ${r}`)}findLayer(r){if(this.layers.length<=r)throw new De(`Was asked to retrieve layer at index ${r}, but model only has ${this.layers.length} layer(s).`);return this.layers[r]}calculateLosses(){return Qe(()=>{const r=[];for(const o of this.layers)for(let c=0;c<o.inboundNodes.length;++c){const h=Dc.nodeKey(o,c);this.containerNodes.has(h)&&r.push(...o.calculateLosses())}return r})}getConfig(){const r={name:this.name},o=this.buildNodeConversionMap(this.layers),c=[];for(const m of this.layers){const y=m.getClassName(),A=m.getConfig(),w=[];for(let _=0;_<m.inboundNodes.length;_++){const T=m.inboundNodes[_],B=Dc.nodeKey(m,_);let O={};if(this.containerNodes.has(B)){if(T.callArgs)try{JSON.stringify(T.callArgs),O=T.callArgs}catch{console.warn(`Layer ${m.name} was passed non-serializable keyword arguments: ${T.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),O={}}if(T.inboundLayers.length>0){const U=[];for(let W=0;W<T.inboundLayers.length;W++){const z=T.inboundLayers[W],X=T.nodeIndices[W],re=T.tensorIndices[W],se=Dc.nodeKey(z,X);let le=o[se];le==null&&(le=0),U.push([z.name,le,re,O])}w.push(U)}}}const C={};C.name=m.name,C.className=y,C.config=A,C.inboundNodes=w,c.push(C)}r.layers=c;const h=[];for(let m=0;m<this.inputLayers.length;m++){const y=this.inputLayers[m],A=this.inputLayersNodeIndices[m],w=Dc.nodeKey(y,A);if(!this.containerNodes.has(w))continue;let C=o[w];C==null&&(C=0);const _=this.inputLayersTensorIndices[m];h.push([y.name,C,_])}r.inputLayers=h;const f=[];for(let m=0;m<this.outputLayers.length;m++){const y=this.outputLayers[m],A=this.outputLayersNodeIndices[m],w=Dc.nodeKey(y,A);if(!this.containerNodes.has(w))continue;let C=o[w];C==null&&(C=0);const _=this.outputLayersTensorIndices[m];f.push([y.name,C,_])}return r.outputLayers=f,r}static fromConfig(r,o,c={},h=!1){const f={},m={};function y(W,z){W.name in m?m[W.name].push(z):m[W.name]=[z]}function A(W,z){const X=[];let re;for(const se of z){const le=se[0],ge=se[1],ye=se[2];if(re=se[3]==null?{}:se[3],!(le in f)){y(W,z);return}const be=f[le];if(be.inboundNodes.length<=ge){y(W,z);return}const Se=be.inboundNodes[ge];X.push(Se.outputTensors[ye])}X.length>0&&W.apply(pa(X),re)}function w(W){const z=W.name,X=jh(W,o.customObjects!=null?o.customObjects:{});X.setFastWeightInitDuringBuild(h),f[z]=X,W.inboundNodes.forEach(re=>{if(!(re instanceof Array))throw new De(`Corrupted configuration, expected array for nodeData: ${re}`);y(X,re)})}const C=o.name,_=o.layers;for(const W of _)w(W);for(;!hpe(m);)for(const W of _){const z=f[W.name];if(z.name in m){const X=m[z.name];delete m[z.name];for(const re of X)A(z,re)}}const T=[],B=[],O=o.inputLayers;for(const W of O){const z=W[0],X=W[1],re=W[2];Fu(z in f);const se=f[z].inboundNodes[X].outputTensors;T.push(se[re])}const U=o.outputLayers;for(const W of U){const z=W[0],X=W[1],re=W[2];Fu(z in f);const se=f[z].inboundNodes[X].outputTensors;B.push(se[re])}return new r({inputs:T,outputs:B,name:C})}get stateful(){if(this._stateful)throw new De("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const r of this.layers)if(r.stateful)return!0;return!1}resetStates(){Qe(()=>{this.layers.forEach(r=>{r.stateful&&r.resetStates()})})}}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Sme(a,r,o){const c=r.length;if(a==null||Array.isArray(a)&&a.length===0)return r.map(h=>null);if(c===1)return Array.isArray(a)&&a.length===1?a:typeof a=="object"&&r[0]in a?[a[r[0]]]:[a];if(Array.isArray(a)){if(a.length!==c)throw new Error(`Provided ${o} is an array of ${a.length} element(s), but the model has ${c} outputs. Make sure a set of weights is provided for each model output.`);return a}else if(typeof a=="object"&&Object.keys(a).length>0&&typeof a[Object.keys(a)[0]]=="object"){const h=[];return r.forEach(f=>{f in a?h.push(a[f]):h.push(null)}),h}else throw new Error(`The model has multiple (${c}) outputs, so ${o} must be either an array with ${c} elements or an object with ${r} keys. Provided ${o} not understood: ${JSON.stringify(a)}`)}function p5(a,r){return Sme(a,r,"classWeight")}async function m5(a,r,o,c){if(o!=null){const h=Qe(()=>{if(a.shape.length===1)return dm(a);if(a.shape.length===2){if(a.shape[1]>1)return bv(a,1);if(a.shape[1]===1)return Xe(a,[a.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${a.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${a.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),f=Array.from(await h.data());vi(h);const m=[];return f.forEach(y=>{if(o[y]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${y} exists in the data but not in classWeight`);m.push(o[y])}),za(m,"float32")}else return null}function Tme(a,r){return Ue(a,r)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const Mme=32;function g5(a,r){let o,c;const h=r;o=h.xs,c=h.ys,b(o!=null&&c!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${r}`);const f=y5("input",a.inputNames,o),m=y5("output",a.outputNames,c),y=f[0].shape[0];b(f.length===a.inputs.length,()=>`LayersModel has ${a.inputs.length} inputs, but the dataset provides ${f.length} inputs.  (Expected input keys: ${JSON.stringify(a.inputNames)})`),b(m.length===a.outputs.length,()=>`LayersModel has ${a.outputs.length} outputs, but the dataset provides ${m.length} outputs.  (Expected output keys: ${JSON.stringify(a.outputNames)})`);for(let A=0;A<f.length;A++)b(f[A].shape[0]===y,()=>`Batch size mismatch: input ${a.inputNames[A]} has ${f[A].shape[0]}; expected  ${y} based on input ${a.inputNames[0]}.`);for(let A=0;A<m.length;A++)b(m[A].shape[0]===y,()=>`Batch size mismatch: output ${a.outputNames[A]} has ${m[A].shape[0]}; expected  ${y} based on input ${a.inputNames[0]}.`);return{xs:f,ys:m}}function y5(a,r,o){if(o instanceof gs)return[o];if(Array.isArray(o))return b(o.length===r.length,()=>`Received an array of ${o.length} Tensors, but expected ${r.length} to match the ${a} keys ${r}.`),o;{const c=[];for(const h of r){if(o[h]==null)throw new De(`The feature data generated by the dataset lacks the required ${a} key '${h}'.`);c.push(o[h])}return c}}function kme(a){if(a.length===3)throw new hi("Validation with sample weights is not implemented yet.");return{xs:a[0],ys:a[1]}}async function Rme(a,r,o){const c=o.batchesPerEpoch!=null;if(b(a.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),b(o!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),b(o.epochs!=null&&o.epochs>0&&Number.isInteger(o.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${o.epochs}`),b(!c||o.batchesPerEpoch>0&&Number.isInteger(o.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${o.batchesPerEpoch}`),b(o.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),a.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");a.isTraining=!0;try{const h=o.validationData!=null;let f,m;if(h)if(A5(o.validationData))b(o.validationBatches==null||o.validationBatches>0&&Number.isInteger(o.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${o.validationBatches}`);else{const W=kme(o.validationData);f=W.xs,m=W.ys}const y=a.makeTrainFunction(),A=a.getDedupedMetricsNames();let w;h?w=A.slice().concat(A.map(W=>"val_"+W)):w=A.slice();const C=i5(o.callbacks,o.yieldEvery),_=o.verbose==null?1:o.verbose,{callbackList:T,history:B}=r5(C,_,o.epochs,null,null,Lme(r,o),null,h,w);T.setModel(a),a.history=B,await T.onTrainBegin(),a.stopTraining_=!1;let O=o.initialEpoch==null?0:o.initialEpoch,U=await r.iterator();for(;O<o.epochs;){const W={};await T.onEpochBegin(O);let z=0,X=0;for(c||(U=await r.iterator());!c||z<o.batchesPerEpoch;){const re=await U.next();if(c&&re.done){console.warn(`You provided \`batchesPerEpoch\` as ${o.batchesPerEpoch}, but your dataset iterator ran out of data after ${z} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${o.batchesPerEpoch*o.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(re.value!=null){const{xs:se,ys:le}=g5(a,re.value),ge={};ge.batch=X,ge.size=se[0].shape[0],await T.onBatchBegin(X,ge);const ye=[];if(o.classWeight!=null){const Be=p5(o.classWeight,a.outputNames);for(let Ye=0;Ye<Be.length;++Ye)ye.push(await m5(le[Ye],null,Be[Ye]))}const be=se.concat(le).concat(ye),Se=y(be);vi(be);for(let Be=0;Be<A.length;++Be){const Ye=A[Be],et=Se[Be];ge[Ye]=et,ml(et)}await T.onBatchEnd(X,ge),t5(ge),X++,z++}if(c?z>=o.batchesPerEpoch:re.done){if(h){let se;A5(o.validationData)?se=ji(await a.evaluateDataset(o.validationData,{batches:o.validationBatches})):se=ji(a.evaluate(f,m,{batchSize:o.validationBatchSize==null?Mme:o.validationBatchSize,verbose:0}));for(let le=0;le<a.metricsNames.length;++le)W[`val_${a.metricsNames[le]}`]=se[le]}break}if(a.stopTraining_)break}if(await T.onEpochEnd(O,W),O++,a.stopTraining_)break}return await T.onTrainEnd(),await a.history.syncData(),a.history}finally{a.isTraining=!1}}function Lme(a,r){let o=null;return r.batchesPerEpoch!=null?o=r.batchesPerEpoch:Number.isFinite(a.size)&&(o=a.size),o}function A5(a){return typeof a.iterator=="function"}function Bme(a){return typeof a.next=="function"}async function Pme(a,r,o){o=o||{};const c=o.batches!=null,h=a.testFunction;let f=[];if(o.verbose>0)throw new hi("Verbose mode is not implemented yet.");b(!c||o.batches>0&&Number.isInteger(o.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(o.batches)}`);const m=Bme(r)?r:await r.iterator();let y=0,A=0;for(;!c||A<o.batches;){const w=await m.next();if(f=Qe(()=>{if(w.value){const{xs:C,ys:_}=g5(a,w.value),T=C.concat(_),B=Qe(()=>h(T));if(vi(T),A===0)for(let U=0;U<B.length;++U)f.push(Qi(0));const O=T[0].shape[0];for(let U=0;U<B.length;++U){const W=B[U],z=f[U];f[U]=Qe(()=>Ot(f[U],Ue(O,W))),A>0&&vi(z)}vi(B),y+=O,++A}return f}),w.done){c&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${o.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let w=0;w<f.length;++w){const C=f[w];f[w]=Vn(f[w],y),vi(C)}return pa(f)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function sR(a){b(a>0&&Number.isInteger(a),()=>`batchSize is required to be a positive integer, but got ${a}`)}function Xv(a,r,o){return a==null?[null]:Array.isArray(a)?a.map(c=>Sm(c,r,o-r)):Sm(a,r,o-r)}function oR(a,r){return Qe(()=>a==null?null:Array.isArray(a)?a.map(o=>oR(o,r)):NG(a,r.dtype==="int32"?r:pn(r,"int32")))}function aR(a,r){const o=[];let c=0,h=null;for(;c<a;)h=c+r,h>=a&&(h=a),o.push([c,h]),c=h;return o}function v5(a){const r=[];a instanceof gs&&(a=[a]);for(let o=0;o<a.length;++o){const c=a[o];if(c.rank===1)r.push(Fv(c,1));else{if(c.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");r.push(c)}}return r}function Fc(a,r){if(a==null)return;const o=[];if(r instanceof gs)o.push(r.id);else if(Array.isArray(r))r.forEach(h=>o.push(h.id));else if(r!=null)for(const h in r){const f=r[h];o.push(f.id)}const c=[];if(a instanceof gs)o.indexOf(a.id)===-1&&c.push(a);else if(Array.isArray(a))a.forEach(h=>{o.indexOf(h.id)===-1&&c.push(h)});else if(a!=null)for(const h in a){const f=a[h];o.indexOf(f.id)===-1&&c.push(f)}c.forEach(h=>{h.isDisposed||h.dispose()})}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Nme(a){return a instanceof gs}function lR(a){return Array.isArray(a)}function b5(a){return!Nme(a)&&!lR(a)}function x5(a,r,o,c=!0,h=""){if(r==null||r.length===0){if(a!=null){let m=!1;if(lR(a)&&a.length>0)m=!0;else if(b5(a)){for(const y in a)if(a.hasOwnProperty(y)){m=!0;break}}else m=!0;if(m)throw new De(`Error when checking model ${h} expected no data, but got ${a}`)}return[]}if(a==null)return r.map(m=>null);let f;if(b5(a)){a=a,f=[];for(const m of r){if(a[m]==null)throw new De(`No data provided for "${m}". Need data for each key in: ${r}`);f.push(a[m])}}else if(lR(a)){if(a=a,a.length!==r.length)throw new De(`Error when checking model ${h}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${r.length} Tensor(s), but instead got the following list of Tensor(s): ${a}`);f=a}else{if(a=a,r.length>1)throw new De(`The model ${h} expects ${r.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${a.shape}`);f=[a]}if(f=v5(f),o!=null)for(let m=0;m<r.length;++m){if(o[m]==null)continue;const y=f[m];if(y.shape.length!==o[m].length)throw new De(`Error when checking ${h}: expected ${r[m]} to have ${o[m].length} dimension(s). but got array with shape ${y.shape}`);for(let A=0;A<o[m].length;++A){if(A===0&&!c)continue;const w=y.shape[A],C=o[m][A];if(C!=null&&C>=0&&w!==C)throw new De(`${h} expected a batch of elements where each example has shape [${o[m].slice(1,o[m].length)}] (i.e.,tensor shape [*,${o[m].slice(1,o[m].length)}]) but the ${h} received an input with ${y.shape[0]} examples, each with shape [${y.shape.slice(1,y.shape.length)}] (tensor shape [${y.shape}])`)}}return f}function Dme(a,r,o){const c=yf(a.map(f=>f.shape[0]));c.sort();const h=yf(r.map(f=>f.shape[0]));if(h.sort(),c.length>1)throw new De(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(a.map(f=>f.shape))}`);if(h.length>1)throw new De(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(r.map(f=>f.shape))}`);if(c.length>0&&h.length>0&&!R(c,h))throw new De(`Input Tensors should have the same number of samples as target Tensors. Found ${c[0]} input sample(s) and ${h[0]} target sample(s).`)}function Fme(a,r,o){const c=[tC,iC,Hv];for(let h=0;h<a.length;++h){const f=a[h],m=r[h],y=o[h];if(m!=null){if(m===Hv&&f.shape[f.shape.length-1]===1)throw new De(`You are passing a target array of shape ${f.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(c.indexOf(m)!==-1){const A=f.shape.slice(1),w=y.slice(1);for(let C=0;C<A.length;++C){const _=A[C],T=w[C];if(T!=null&&_!==T)throw new De(`A target Tensor with shape ${f.shape} was passed for an output of shape ${y}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function w5(a,r,o,c=!0,h=""){let f;if(Array.isArray(a)){if(a.length!==r.length)throw new De(`Error when checking model ${h}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${r.length} Tensor(s), but instead got ${a.length} Tensors(s).`);f=a}else{if(r.length>1)throw new De(`The model expects ${r.length} ${h} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(a.shape)}.`);f=[a]}if(o!=null)for(let m=0;m<r.length;++m){if(o[m]==null)continue;const y=f[m];if(y.shape.length!==o[m].length)throw new De(`Error when checking ${h}: expected ${r[m]} to have ${o[m].length} dimension(s), but got array with shape ${JSON.stringify(y.shape)}`);for(let A=0;A<o[m].length;++A){if(A===0&&!c)continue;const w=y.shape[A],C=o[m][A];if(C!=null&&C!==w)throw new De(`Error when checking ${h}: expected ${r[m]} to have shape ${JSON.stringify(o[m])} but got array with shape ${JSON.stringify(y.shape)}.`)}}}function Ome(a,r){if(a==null||Array.isArray(a)&&a.length===0)return r.map(c=>[]);let o;if(typeof a=="string"||typeof a=="function")o=[a];else if(Array.isArray(a)||typeof a=="object")o=a;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${a}`);if(Array.isArray(o))return r.map(c=>o);{const c=[];for(const h of r){let f=o.hasOwnProperty(h)?o[h]:[];Array.isArray(f)||(f=[f]),c.push(f)}return c}}const Vme="layers-model";class U0 extends Dc{constructor(r){super(r),this.isTraining=!1}summary(r,o,c=console.log){if(!this.built)throw new De("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");xme(this,r,o,c)}compile(r){if(r.loss==null&&(r.loss=[]),this.loss=r.loss,typeof r.optimizer=="string")this.optimizer_=bme(r.optimizer),this.isOptimizerOwned=!0;else{if(!(r.optimizer instanceof gf))throw new De("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=r.optimizer,this.isOptimizerOwned=!1}let o=[];if(!Array.isArray(r.loss)&&typeof r.loss!="string"&&typeof r.loss!="function"){r.loss=r.loss;for(const m in r.loss)if(this.outputNames.indexOf(m)===-1)throw new De(`Unknown entry in loss dictionary: "${m}". Only expected the following keys: ${this.outputNames}`);for(const m of this.outputNames)r.loss[m]==null&&console.warn(`Output "${m}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${m} during training`),o.push(tR(r.loss[m]))}else if(Array.isArray(r.loss)){if(r.loss.length!==this.outputs.length)throw new De(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${r.loss}.`);o=r.loss.map(m=>tR(m))}else{const m=tR(r.loss);this.outputs.forEach(y=>{o.push(m)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let m=0;m<this.outputs.length;++m){const y=this.internalOutputShapes[m],A=this.outputNames[m];this.feedOutputNames.push(A),this.feedOutputShapes.push(y),this.feedLossFns.push(this.lossFunctions[m])}const c=[];this.metrics=r.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Im("loss",()=>{for(let m=0;m<this.outputs.length;++m){if(c.indexOf(m)!==-1)continue;const y=this.lossFunctions[m];this.outputs.length>1&&(this.metricsTensors.push([y,m]),this.metricsNames.push(this.outputNames[m]+"_loss"))}});const h=Ome(r.metrics,this.outputNames),f=(m,y,A)=>{this.outputNames.length>1&&(y=this.outputNames[m]+"_"+y),this.metricsNames.push(y),this.metricsTensors.push([A,m])};Im("metric",()=>{for(let m=0;m<this.outputs.length;++m){if(c.indexOf(m)!==-1)continue;const y=h[m];(A=>{const w="";let C,_,T;for(const B of A){if(typeof B=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(B)!==-1){const U=this.internalOutputShapes[m];U[U.length-1]===1||this.lossFunctions[m]===iC?["accuracy","acc"].indexOf(B)!==-1?_=o5:["crossentropy","ce"].indexOf(B)!==-1&&(_=ume):this.lossFunctions[m]===nC?["accuracy","acc"].indexOf(B)!==-1?_=hme:["crossentropy","ce"].indexOf(B)!==-1&&(_=c5):["accuracy","acc"].indexOf(B)!==-1?_=a5:["crossentropy","ce"].indexOf(B)!==-1&&(_=l5);let W;["accuracy","acc"].indexOf(B)!==-1?W="acc":["crossentropy","ce"].indexOf(B)!==-1&&(W="ce"),T=_,C=w+W}else T=vme(B),C=w+oC(B);let O;Im(C,()=>{O=T}),f(m,C,O)}})(y)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(r,o,c={}){const h=c.batchSize==null?32:c.batchSize;sR(h);const f=this.standardizeUserDataXY(r,o,!0,h);try{const m=f[0].concat(f[1]);this.makeTestFunction();const y=this.testFunction,A=this.testLoop(y,m,h,c.verbose,c.steps);return pa(A)}finally{Fc(f[0],r),Fc(f[1],o)}}async evaluateDataset(r,o){return this.makeTestFunction(),Pme(this,r,o)}checkNumSamples(r,o,c,h="steps"){let f;if(c!=null){if(f=null,o!=null)throw new De(`If ${h} is set, batchSize must be null or undefined.Got batchSize = ${o}`)}else if(r!=null)Array.isArray(r)?f=r[0].shape[0]:f=r.shape[0];else throw new De(`Either the input data should have a defined shape, or ${h} shoud be specified.`);return f}execute(r,o){if(Array.isArray(o)&&o.length===0)throw new De("`outputs` is an empty Array, which is not allowed.");const c=Array.isArray(o),h=c?o:[o],f=this.retrieveSymbolicTensors(h),m=new bf;if(r instanceof gs&&(r=[r]),Array.isArray(r)){if(r.length!==this.inputs.length)throw new De(`The number of inputs provided (${r.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let A=0;A<this.inputs.length;++A)m.add(this.inputs[A],r[A])}else for(const A of this.inputs){const w=r[A.name];if(w==null)throw new De(`No value is provided for the model's input ${A.name}`);m.add(A,w)}const y=zv(f,m);return c?y:y[0]}retrieveSymbolicTensors(r){const o=Cm(null,r.length);let c=r.length;for(const h of this.layers){const f=Array.isArray(h.output)?h.output:[h.output],m=f.map(y=>y.name);for(let y=0;y<r.length;++y){const A=m.indexOf(r[y]);if(A!==-1&&(o[y]=f[A],c--),c===0)break}if(c===0)break}if(c>0){const h=[];throw o.forEach((f,m)=>{f==null&&h.push(r[m])}),new De(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(h)}`)}return o}predictLoop(r,o=32,c=!1){return Qe(()=>{const h=this.checkNumSamples(r);if(c)throw new hi("Verbose predictLoop() is not implemented yet.");const f=aR(h,o),m=this.outputs.map(y=>[]);for(let y=0;y<f.length;++y)Qe(()=>{const A=f[y][0],w=f[y][1],C=Xv(r,A,w),_=[];if(Array.isArray(C))for(let B=0;B<C.length;++B)_.push({key:this.inputs[B],value:C[B]});else _.push({key:this.inputs[0],value:C});const T=new bf(_);return zv(this.outputs,T)}).forEach((A,w)=>m[w].push(A));return pa(m.map(y=>da(y,0)))})}predict(r,o={}){const c=v5(r);w5(c,this.inputNames,this.feedInputShapes,!1);try{const h=o.batchSize==null?32:o.batchSize;return sR(h),this.predictLoop(c,h)}finally{Fc(c,r)}}predictOnBatch(r){w5(r,this.inputNames,this.feedInputShapes,!0);const o=(Array.isArray(r)?r[0]:r).shape[0];return this.predictLoop(r,o)}standardizeUserDataXY(r,o,c=!0,h){if(this.optimizer_==null)throw new Ql("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const f=[];for(let m=0;m<this.feedOutputShapes.length;++m){const y=this.feedOutputShapes[m];this.feedLossFns[m]===nC?f.push(y.slice(0,y.length-1).concat([1])):f.push(y)}if(r=x5(r,this.feedInputNames,this.feedInputShapes,!1,"input"),o=x5(o,this.feedOutputNames,f,!1,"target"),Dme(r,o),Fme(o,this.feedLossFns,this.feedOutputShapes),this.stateful&&h!=null&&h>0&&r[0].shape[0]%h!==0)throw new De(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${h}. Found: ${r[0].shape[0]} sample(s).`);return[r,o]}async standardizeUserData(r,o,c,h,f=!0,m){const[y,A]=this.standardizeUserDataXY(r,o,f,m);if(c!=null)throw new Error("sample weight is not supported yet.");let w=null;if(h!=null){const C=p5(h,this.outputNames);w=[];for(let _=0;_<C.length;++_)w.push(await m5(A[_],null,C[_]))}return[y,A,w]}testLoop(r,o,c,h=0,f){return Qe(()=>{const m=this.checkNumSamples(o,c,f,"steps"),y=[];if(h>0)throw new hi("Verbose mode is not implemented yet.");if(f!=null)throw new hi("steps mode in testLoop() is not implemented yet");{const A=aR(m,c),w=za(Bc(0,m));for(let C=0;C<A.length;++C){const _=A[C][0],T=A[C][1],B=Sm(w,_,T-_),O=oR(o,B),U=r(O);if(C===0)for(let W=0;W<U.length;++W)y.push(Qi(0));for(let W=0;W<U.length;++W){const z=U[W];y[W]=Ot(y[W],Ue(T-_,z))}}for(let C=0;C<y.length;++C)y[C]=Vn(y[C],m)}return y})}getDedupedMetricsNames(){const r=this.metricsNames,o=[];for(let c=0;c<r.length;++c){const h=r[c];let f=h;if(_G(r,h)>1){const m=_G(r.slice(0,c),h);f+=`_${m}`}o.push(f)}return o}makeTrainFunction(){return r=>{const o=[],c=r.slice(0,this.inputs.length),h=r.slice(this.inputs.length,this.inputs.length+this.outputs.length),f=r.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),m=[],y=()=>{const w=[];for(let B=0;B<this.inputs.length;++B)w.push({key:this.inputs[B],value:c[B]});const C=new bf(w),_=zv(this.outputs,C,{training:!0});let T;for(let B=0;B<this.lossFunctions.length;++B){const O=this.lossFunctions[B];let U=O(h[B],_[B]);f[B]!=null&&(U=Tme(U,f[B]));const W=is(U);o.push(W),B===0?T=U:T=Ot(T,U)}for(let B=0;B<this.metricsTensors.length;++B){let O;if(this.outputs.length>1&&B<this.outputs.length)O=o[B];else{const U=this.metricsTensors[B][0],W=this.metricsTensors[B][1];O=is(U(h[W],_[W]))}ml(O),m.push(O)}return T=is(T),this.calculateLosses().forEach(B=>{T=Ot(T,B)}),T},A=this.collectedTrainableWeights.map(w=>w.read());return[this.optimizer_.minimize(y,!0,A)].concat(m)}}makeTestFunction(){this.testFunction=r=>Qe(()=>{const o=[];let c;const h=r.slice(0,this.inputs.length),f=r.slice(this.inputs.length,this.inputs.length+this.outputs.length),m=[];for(let w=0;w<this.inputs.length;++w)m.push({key:this.inputs[w],value:h[w]});const y=new bf(m),A=zv(this.outputs,y);for(let w=0;w<this.lossFunctions.length;++w){const C=this.lossFunctions[w],_=is(C(f[w],A[w]));w===0?c=_:c=Ot(c,_),o.push(c)}for(let w=0;w<this.metricsTensors.length;++w){const C=this.metricsTensors[w][0],_=this.metricsTensors[w][1],T=is(C(f[_],A[_]));o.push(T)}return o})}async fit(r,o,c={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let h,f,m,y,A,w,C,_,T;try{const B=c.batchSize==null?32:c.batchSize;sR(B);const O=await this.standardizeUserData(r,o,c.sampleWeight,c.classWeight,!1,B);h=O[0],f=O[1],T=O[2];let U=!1,W;if(c.validationData!=null&&c.validationData.length>0){if(U=!0,c.validationData.length===2)A=c.validationData[0],w=c.validationData[1];else throw c.validationData.length===3?new hi("validationData including sample weights is not supported yet."):new De(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${c.validationData} is invalid.`);const ye=await this.standardizeUserData(A,w,null,null,!0,B);C=ye[0],_=ye[1],W=C.concat(_)}else if(c.validationSplit!=null&&c.validationSplit>0&&c.validationSplit<1){U=!0;const ye=Math.floor(h[0].shape[0]*(1-c.validationSplit)),be=h[0].shape[0];C=Xv(h,ye,be),m=h,h=Xv(h,0,ye),_=Xv(f,ye,be),y=f,f=Xv(f,0,ye),W=C.concat(_)}else c.validationSteps!=null&&(U=!0);const z=h.concat(f).concat(T);this.checkTrainableWeightsConsistency();const X=this.makeTrainFunction(),re=this.getDedupedMetricsNames();let se,le;U?(this.makeTestFunction(),se=this.testFunction,le=re.slice().concat(re.map(ye=>"val_"+ye))):(se=null,W=[],le=re.slice());const ge=i5(c.callbacks,c.yieldEvery);return await this.fitLoop(X,z,re,B,c.epochs,c.verbose,ge,se,W,c.shuffle,le,c.initialEpoch,null,null)}finally{this.isTraining=!1,Fc(h,r),Fc(f,o),Fc(m,r),Fc(y,o),Fc(C,A),Fc(_,w),T!=null&&vi(T)}}async fitLoop(r,o,c,h,f,m,y,A,w,C,_,T,B,O){h==null&&(h=32),f==null&&(f=1),C==null&&(C=!0),T==null&&(T=0);let U=!1;if(A!=null&&w!=null&&(U=!0),O!=null&&(U=!0,B==null))throw new De("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const W=this.checkNumSamples(o,h,B,"steps_per_epoch");let z;W!=null&&(z=Bc(0,W)),m==null&&(m=1);const{callbackList:X,history:re}=r5(y,m,f,T,W,B,h,U,_);X.setModel(this),this.history=re,await X.onTrainBegin(),this.stopTraining_=!1;for(let se=T;se<f;++se){await X.onEpochBegin(se);const le={};if(B!=null)throw new hi("stepsPerEpoch mode is not implemented yet.");{if(C==="batch")throw new hi("batch shuffling is not implemneted yet");C&&u(z);const ge=za(z),ye=aR(W,h);for(let be=0;be<ye.length;++be){const Se={};if(await X.onBatchBegin(be,Se),Qe(()=>{const Be=ye[be][0],Ye=ye[be][1],et=Sm(ge,Be,Ye-Be);Se.batch=be,Se.size=Ye-Be;const tt=oR(o,et),ot=r(tt);for(let st=0;st<c.length;++st){const ct=c[st],gt=ot[st];Se[ct]=gt,ml(gt)}if(be===ye.length-1&&U){const st=this.testLoop(A,w,h);for(let ct=0;ct<c.length;++ct){const gt=c[ct],mt=st[ct];ml(mt),le["val_"+gt]=mt}}}),await X.onBatchEnd(be,Se),t5(Se),this.stopTraining_)break}ge.dispose()}if(await X.onEpochEnd(se,le),this.stopTraining_)break}return await X.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(r,o){return Rme(this,r,o)}async trainOnBatch(r,o){const c=await this.standardizeUserData(r,o),h=c[0],f=c[1],m=this.makeTrainFunction()(h.concat(f)),y=[];for(const A of m){const w=await A.data();y.push(w[0])}return vi(m),Fc(c[0],r),Fc(c[1],o),pa(y)}getNamedWeights(r){const o=[],c=r!=null&&r.trainableOnly,h=c?this.trainableWeights:this.weights,f=this.getWeights(c);for(let m=0;m<h.length;++m)c&&!h[m].trainable||o.push({name:h[m].originalName,tensor:f[m]});return o}set stopTraining(r){this.stopTraining_=r}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(r){this.optimizer_!==r&&(this.optimizer_=r,this.isOptimizerOwned=!1)}dispose(){const r=super.dispose();if(r.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const o=yM().numTensors;this.optimizer_.dispose(),r.numDisposedVariables+=o-yM().numTensors}return r}getLossIdentifiers(){let r;if(typeof this.loss=="string")r=Kh(this.loss);else if(Array.isArray(this.loss)){for(const o of this.loss)if(typeof o!="string")throw new Error("Serialization of non-string loss is not supported.");r=this.loss.map(o=>Kh(o))}else{const o=Object.keys(this.loss);r={};const c=this.loss;for(const h of o)if(typeof c[h]=="string")r[h]=Kh(c[h]);else throw new Error("Serialization of non-string loss is not supported.")}return r}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Kh(oC(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(r=>Kh(oC(r)));{const r={};for(const o in this.metrics)r[o]=Kh(oC(this.metrics[o]));return r}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(r){if(r.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(r.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(r.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const o=iR(r.optimizer_config),c=jh(o);let h;if(typeof r.loss=="string")h=Em(r.loss);else if(Array.isArray(r.loss))h=r.loss.map(m=>Em(m));else if(r.loss!=null){h={};for(const m in r.loss)h[m]=Em(r.loss[m])}let f;if(Array.isArray(r.metrics))f=r.metrics.map(m=>Em(m));else if(r.metrics!=null){f={};for(const m in r.metrics)f[m]=Em(r.metrics[m])}this.compile({loss:h,metrics:f,optimizer:c})}async save(r,o){if(typeof r=="string"){const f=voe(r);if(f.length===0)throw new De(`Cannot find any save handlers for URL '${r}'`);if(f.length>1)throw new De(`Found more than one (${f.length}) save handlers for URL '${r}'`);r=f[0]}if(r.save==null)throw new De("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const c=await RU(this.getNamedWeights(o)),h={modelTopology:this.toJSON(null,!1),format:Vme,generatedBy:`TensorFlow.js tfjs-layers v${f5}`,convertedBy:null};if(o!=null&&o.includeOptimizer&&this.optimizer!=null){h.trainingConfig=this.getTrainingConfig();const f="optimizer",{data:m,specs:y}=await RU(await this.optimizer.getWeights(),f);c.specs.push(...y),c.data=Aoe([c.data,m])}return this.userDefinedMetadata!=null&&(h5(this.userDefinedMetadata,this.name,!0),h.userDefinedMetadata=this.userDefinedMetadata),h.weightData=c.data,h.weightSpecs=c.specs,r.save(h)}setUserDefinedMetadata(r){h5(r,this.name),this.userDefinedMetadata=r}getUserDefinedMetadata(){return this.userDefinedMetadata}}U0.className="Model",Mt(U0);class C5 extends U0{}C5.className="Functional",Mt(C5);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class $v extends U0{constructor(r){if(super({inputs:[],outputs:[]}),r=r||{},this.trainable=!0,this.built=!1,this.name=r.name!=null?r.name:$w("sequential_"),r.layers!=null)for(const o of r.layers)this.add(o)}checkShape(r){if(r.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new De(`Negative dimension size caused by adding layer ${r.name} with input shape [${r.inboundNodes[0].inputTensors[0].shape}]`)}add(r){const o=r instanceof $v||r instanceof U0;let c;if(o){if(c=r,c.outputs.length!==1)throw new De("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(c.inputs.length!==1)throw new De("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(r.inboundNodes.length===0){if(r.batchInputShape==null)throw new De("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const h=Gpe({batchShape:r.batchInputShape,dtype:r.dtype,name:r.name+"_input"});r.apply(h)}if(o)this.outputs=c.outputs,this.inputs=c.inputs;else{if(r.inboundNodes.length!==1)throw new De(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${r.name} which has ${r.inboundNodes.length} pre-existing inbound connections.`);if(r.inboundNodes[0].outputTensors.length!==1)throw new De("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(r),this.outputs=[r.inboundNodes[0].outputTensors[0]],this.inputs=QG(this.outputs[0])}this.inboundNodes=[],new Yw({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Cm(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(h=>h.shape),outputShapes:this.outputs[0].shape})}else{const h=r.apply(this.outputs[0]);if(Array.isArray(h))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(r),this.outputs=[h],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(r),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const r=this.layers.length-1;this.layers[r].outboundNodes=[],this.outputs=[this.layers[r].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(r,o){return this.model==null&&this.build(),this.model.call(r,o)}build(r){if(Pi(r),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new U0({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(r,o,c=console.log){this.built||this.build(),super.summary(r,o,c)}setWeights(r){this.model==null&&this.build(),this.model.setWeights(r)}evaluate(r,o,c={}){if(!this.built)throw new Ql("The model needs to be compiled before being used.");return this.model.evaluate(r,o,c)}async evaluateDataset(r,o){if(!this.built)throw new Ql("The model needs to be compiled before being used.");return this.model.evaluateDataset(r,o)}predict(r,o={}){return this.model==null&&this.build(),this.model.predict(r,o)}predictOnBatch(r){return this.model==null&&this.build(),this.model.predictOnBatch(r)}compile(r){this.build(),this.model.compile(r),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(r){this.model.optimizer=r}async fit(r,o,c={}){if(!this.built)throw new Ql("The model needs to be compiled before being used.");return this.model.fit(r,o,c)}async fitDataset(r,o){if(!this.built)throw new Ql("The model needs to be compiled before being used.");return this.model.fitDataset(r,o)}async trainOnBatch(r,o){return this.model.trainOnBatch(r,o)}static fromConfig(r,o,c={},h=!1){let f,m={};if(o instanceof Array){if(o[0].className==null||o[0].className==="Merge")throw new De("Legacy serialization format not supported yet.");f=o}else b(o.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),f=o.layers,delete o.layers,m=o;const y=new r(m);if(!(y instanceof $v))throw new hi(`Sequential.fromConfig called on non-Sequential input: ${y}`);for(const A of f){const w=jh(A,void 0,h);h&&w.setFastWeightInitDuringBuild(!0),y.add(w)}return y}set stopTraining(r){if(this.model==null)throw new De("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=r}get stopTraining(){if(this.model==null)throw new De("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const r=[];for(const o of this.layers){const c={};c.className=o.getClassName(),c.config=o.getConfig(),r.push(c)}return{name:this.name,layers:r}}}$v.className="Sequential",Mt($v);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/let ma=class extends D0{getConfig(){return{}}};class E5 extends ma{apply(r,o=1){return Ipe(r,o)}}E5.className="elu",Mt(E5);class _5 extends ma{apply(r){return pz(r)}}_5.className="selu",Mt(_5);class I5 extends ma{apply(r){return Am(r)}}I5.className="relu",Mt(I5);class S5 extends ma{apply(r){return Qe(()=>Sv(6,Am(r)))}}S5.className="relu6",Mt(S5);class T5 extends ma{apply(r){return r}}T5.className="linear",Mt(T5);class M5 extends ma{apply(r){return k0(r)}}M5.className="sigmoid",Mt(M5);class k5 extends ma{apply(r){return Tpe(r)}}k5.className="hardSigmoid",Mt(k5);class R5 extends ma{apply(r){return Iv(r)}}R5.className="softplus",Mt(R5);class L5 extends ma{apply(r){return Spe(r)}}L5.className="softsign",Mt(L5);class B5 extends ma{apply(r){return SM(r)}}B5.className="tanh",Mt(B5);let cR=class extends ma{apply(a,r=-1){return $M(a,r)}};cR.className="softmax",Mt(cR);class P5 extends ma{apply(r,o=-1){return JU(r,o)}}P5.className="logSoftmax",Mt(P5);class N5 extends ma{apply(r,o=1){return Qe(()=>Ue(k0(Ue(r,o)),r))}}N5.className="swish",Mt(N5);class D5 extends ma{apply(r){return Qe(()=>Ue(r,SM(Iv(r))))}}D5.className="mish",Mt(D5);function xf(a){return a.getClassName()}function uR(a,r={}){return Nv(a,$l.getMap().classNameMap,r,"activation")}function wf(a){if(a==null){const r={};return r.className="linear",r.config={},uR(r)}if(typeof a=="string"){const r={};return r.className=a,r.config={},uR(r)}else return a instanceof ma?a:uR(a)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Ume(a){if(a!=null&&typeof a!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${a}`)}class F5 extends D0{}class O5 extends F5{constructor(r){super(),Ume(r),this.l1=r==null||r.l1==null?.01:r.l1,this.l2=r==null||r.l2==null?.01:r.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(r){return Qe(()=>{let o=Ns([1]);return this.hasL1&&(o=Ot(o,Bn(Ue(this.l1,Bo(r))))),this.hasL2&&(o=Ot(o,Bn(Ue(this.l2,Ov(r))))),Xe(o,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(r,o){return new r({l1:o.l1,l2:o.l2})}}O5.className="L1L2",Mt(O5);const V5={l1l2:"L1L2"};function rr(a){return Pk(a)}function U5(a,r={}){return Nv(a,$l.getMap().classNameMap,r,"regularizer")}function wr(a){if(a==null)return null;if(typeof a=="string"){const r={className:a in V5?V5[a]:a,config:{}};return U5(r)}else return a instanceof F5?a:U5(a)}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class z5 extends Ai{constructor(r){super(r??{}),this.supportsMasking=!0,r!=null&&(this.maxValue=r.maxValue)}call(r,o){r=$n(r);let c=Am(r);return this.maxValue!=null&&(c=gl(c,0,this.maxValue)),c}computeOutputShape(r){return r}getConfig(){const r={maxValue:this.maxValue},o=super.getConfig();return Object.assign(r,o),r}}z5.className="ReLU",Mt(z5);class G5 extends Ai{constructor(r){super(r??{}),this.DEFAULT_ALPHA=.3,r==null&&(r={}),this.alpha=r.alpha==null?this.DEFAULT_ALPHA:r.alpha}call(r,o){const c=$n(r);return DM(c,this.alpha)}computeOutputShape(r){return r}getConfig(){const r={alpha:this.alpha},o=super.getConfig();return Object.assign(r,o),r}}G5.className="LeakyReLU",Mt(G5);class W5 extends Ai{constructor(r){if(super(r??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",r==null&&(r={}),this.supportsMasking=!0,this.alphaInitializer=xr(r.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=wr(r.alphaRegularizer),this.alphaConstraint=xs(r.alphaConstraint),r.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(r.sharedAxes))this.sharedAxes=r.sharedAxes;else if(typeof r.sharedAxes=="number")this.sharedAxes=[r.sharedAxes];else throw new De(`Expected sharedAxes to be a number or an array of numbers, but got ${r.sharedAxes}`)}build(r){r=Pi(r);const o=r.slice(1);if(this.sharedAxes!=null)for(const h of this.sharedAxes)o[h-1]=1;this.alpha=this.addWeight("alpha",o,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const c={};if(this.sharedAxes!=null)for(let h=1;h<r.length;++h)c[h]=r[h];this.inputSpec=[new vs({ndim:r.length,axes:c})],this.built=!0}call(r,o){return r=$n(r),GM(r,this.alpha.read())}getConfig(){const r={alphaInitializer:Mr(this.alphaInitializer),alphaRegularizer:rr(this.alphaRegularizer),alphaConstraint:bs(this.alphaConstraint),sharedAxes:this.sharedAxes},o=super.getConfig();return Object.assign(r,o),r}}W5.className="PReLU",Mt(W5);let H5=class extends Ai{constructor(a){if(super(a??{}),this.DEFAULT_ALPHA=1,a==null&&(a={}),a.alpha!=null&&a.alpha!==this.DEFAULT_ALPHA)throw new hi(`Non-default alpha value (${a.alpha}) is not supported by the ELU layer yet.`);this.alpha=a.alpha==null?this.DEFAULT_ALPHA:a.alpha}call(a,r){const o=$n(a);return Rw(o)}computeOutputShape(a){return a}getConfig(){const a={alpha:this.alpha},r=super.getConfig();return Object.assign(a,r),a}};H5.className="ELU",Mt(H5);class X5 extends Ai{constructor(r){super(r??{}),this.DEFAULT_THETA=1,r==null&&(r={}),this.theta=r.theta==null?this.DEFAULT_THETA:r.theta}call(r,o){const c=$n(r);return Ue(c,pn(yl(c,this.theta),"float32"))}computeOutputShape(r){return r}getConfig(){const r={theta:this.theta},o=super.getConfig();return Object.assign(r,o),r}}X5.className="ThresholdedReLU",Mt(X5);class $5 extends Ai{constructor(r){super(r??{}),this.DEFAULT_AXIS=1,r==null&&(r={}),this.softmax=new cR().apply,this.axis=r.axis==null?this.DEFAULT_AXIS:r.axis}call(r,o){return Qe(()=>{let c=$n(r);const h=o.mask;if(h!=null){const f=Ue(Wn(mf(c.shape),pn(h,c.dtype)),Qi(-1e9));c=Ot(c,f)}return this.axis instanceof Array?this.axis.length>1?Lu(Wn(c,ez(c,this.axis,!0))):this.softmax(c,this.axis[0]):this.softmax(c,this.axis)})}computeOutputShape(r){return r}getConfig(){const r={axis:this.axis},o=super.getConfig();return Object.assign(r,o),r}}$5.className="Softmax",Mt($5);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function z0(a,r,o){if(typeof a=="number")return Cm(a,r);if(a.length!==r)throw new De(`The ${o} argument must be an integer or tuple of ${r} integers. Received: ${a.length} elements.`);for(let c=0;c<r;++c){const h=a[c];if(!wpe(h))throw new De(`The ${o} argument must be an integer or tuple of ${r} integers. Received: ${JSON.stringify(a)} including a non-integer number ${h}`)}return a}function Oc(a,r,o,c,h=1){if(a==null)return a;const f=r+(r-1)*(h-1);let m;return o==="same"?m=a:m=a-f+1,Math.floor((m+c-1)/c)}function Uu(a,r,o,c){if(a==null)return null;if(c==="valid")a=a*r+vf([o-r,0]);else if(c==="same")a=a*r;else throw new De(`Unsupport padding mode: ${c}.`);return a}/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function hR(a,r){return Qe(()=>($r(r),r==="channelsFirst"?Li(a,[0,2,3,1]):a))}function Q5(a,r){return Qe(()=>($r(r),r==="channelsFirst"?Li(a,[0,2,3,4,1]):a))}function zme(a,r,o,c=1,h="valid",f,m=1){return Qe(()=>{if(f==null&&(f=Pc()),$r(f),a.shape.length!==3)throw new De(`The input of a conv1dWithBias operation should be 3, but is ${a.shape.length} instead.`);if(r.shape.length!==3)throw new De(`The kernel for a conv1dWithBias operation should be 3, but is ${r.shape.length} instead`);if(o!=null&&o.shape.length!==1)throw new De(`The bias for a conv1dWithBias operation should be 1, but is ${r.shape.length} instead`);if(f==="channelsFirst"&&(a=Li(a,[0,2,1])),h==="causal")throw new hi("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let y=WU(a,r,c,h==="same"?"same":"valid","NWC",m);return o!=null&&(y=Nc(y,o)),y})}function K5(a,r,o,c=[1,1],h="valid",f,m,y=null){return Qe(()=>{if(f==null&&(f=Pc()),$r(f),a.rank!==3&&a.rank!==4)throw new De(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${a.rank}.`);if(r.rank!==3&&r.rank!==4)throw new De(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${a.rank}.`);let A=hR(a,f);if(h==="causal")throw new hi("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return A=Zue({x:A,filter:r,strides:c,pad:h==="same"?"same":"valid",dilations:m,dataFormat:"NHWC",bias:o,activation:y}),f==="channelsFirst"&&(A=Li(A,[0,3,1,2])),A})}function Gme(a,r,o,c=[1,1,1],h="valid",f,m){return Qe(()=>{if(f==null&&(f=Pc()),$r(f),a.rank!==4&&a.rank!==5)throw new De(`conv3dWithBias expects input to be of rank 4 or 5, but received ${a.rank}.`);if(r.rank!==4&&r.rank!==5)throw new De(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${a.rank}.`);let y=Q5(a,f);if(h==="causal")throw new hi("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return y=Kae(y,r,c,h==="same"?"same":"valid","NDHWC",m),o!=null&&(y=Nc(y,o)),f==="channelsFirst"&&(y=Li(y,[0,4,1,2,3])),y})}class lC extends Ai{constructor(r,o){if(super(o),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",lC.verifyArgs(o),this.rank=r,Ds(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new hi(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=z0(o.kernelSize,r,"kernelSize"),this.strides=z0(o.strides==null?1:o.strides,r,"strides"),this.padding=o.padding==null?"valid":o.padding,vl(this.padding),this.dataFormat=o.dataFormat==null?"channelsLast":o.dataFormat,$r(this.dataFormat),this.activation=wf(o.activation),this.useBias=o.useBias==null?!0:o.useBias,this.biasInitializer=xr(o.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=xs(o.biasConstraint),this.biasRegularizer=wr(o.biasRegularizer),this.activityRegularizer=wr(o.activityRegularizer),this.dilationRate=z0(o.dilationRate==null?1:o.dilationRate,r,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new De(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new De(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new De(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(r){if(Fu("kernelSize"in r,"required key 'kernelSize' not in config"),typeof r.kernelSize!="number"&&!Dk(r.kernelSize,"number",1,3))throw new De(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(r.kernelSize)}.`)}getConfig(){const r={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xf(this.activation),useBias:this.useBias,biasInitializer:Mr(this.biasInitializer),biasRegularizer:rr(this.biasRegularizer),activityRegularizer:rr(this.activityRegularizer),biasConstraint:bs(this.biasConstraint)},o=super.getConfig();return Object.assign(r,o),r}}class G0 extends lC{constructor(r,o){super(r,o),this.kernel=null,G0.verifyArgs(o),this.filters=o.filters,Ds(this.filters,"filters"),this.kernelInitializer=xr(o.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=xs(o.kernelConstraint),this.kernelRegularizer=wr(o.kernelRegularizer)}build(r){r=Pi(r);const o=this.dataFormat==="channelsFirst"?1:r.length-1;if(r[o]==null)throw new De(`The channel dimension of the input should be defined. Found ${r[o]}`);const c=r[o],h=this.kernelSize.concat([c,this.filters]);this.kernel=this.addWeight("kernel",h,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[o]:c}}],this.built=!0}call(r,o){return Qe(()=>{r=$n(r);let c;const h=this.bias==null?null:this.bias.read(),f=SG(this.activation.getClassName());if(f!=null&&this.rank===2)c=K5(r,this.kernel.read(),h,this.strides,this.padding,this.dataFormat,this.dilationRate,f);else{if(this.rank===1)c=zme(r,this.kernel.read(),h,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)c=K5(r,this.kernel.read(),h,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)c=Gme(r,this.kernel.read(),h,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new hi("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(c=this.activation.apply(c))}return c})}computeOutputShape(r){r=Pi(r);const o=[],c=this.dataFormat==="channelsLast"?r.slice(1,r.length-1):r.slice(2);for(let f=0;f<c.length;++f){const m=Oc(c[f],this.kernelSize[f],this.padding,this.strides[f],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[f]);o.push(m)}let h=[r[0]];return this.dataFormat==="channelsLast"?(h=h.concat(o),h.push(this.filters)):(h.push(this.filters),h=h.concat(o)),h}getConfig(){const r={filters:this.filters,kernelInitializer:Mr(this.kernelInitializer),kernelRegularizer:rr(this.kernelRegularizer),kernelConstraint:bs(this.kernelConstraint)},o=super.getConfig();return Object.assign(r,o),r}static verifyArgs(r){if(!("filters"in r)||typeof r.filters!="number"||r.filters<1)throw new De(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(r.filters)}`)}}class Qv extends G0{constructor(r){super(2,r),Qv.verifyArgs(r)}getConfig(){const r=super.getConfig();return delete r.rank,r}static verifyArgs(r){if(typeof r.kernelSize!="number"&&!Dk(r.kernelSize,"number",1,2))throw new De(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(r.kernelSize)}.`)}}Qv.className="Conv2D",Mt(Qv);class Kv extends G0{constructor(r){super(3,r),Kv.verifyArgs(r)}getConfig(){const r=super.getConfig();return delete r.rank,r}static verifyArgs(r){if(typeof r.kernelSize!="number"&&!(Array.isArray(r.kernelSize)&&(r.kernelSize.length===1||r.kernelSize.length===3)))throw new De(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(r.kernelSize)}.`)}}Kv.className="Conv3D",Mt(Kv);class Z5 extends Qv{constructor(r){if(super(r),this.inputSpec=[new vs({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new De(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(r){if(r=Pi(r),r.length!==4)throw new De("Input should have rank 4; Received input shape: "+JSON.stringify(r));const o=this.dataFormat==="channelsFirst"?1:r.length-1;if(r[o]==null)throw new De("The channel dimension of the inputs should be defined. Found `None`.");const c=r[o],h=this.kernelSize.concat([this.filters,c]);this.kernel=this.addWeight("kernel",h,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vs({ndim:4,axes:{[o]:c}})],this.built=!0}call(r,o){return Qe(()=>{let c=$n(r);if(c.shape.length!==4)throw new De(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${c.shape.length}`);const h=c.shape,f=h[0];let m,y;this.dataFormat==="channelsFirst"?(m=2,y=3):(m=1,y=2);const A=h[m],w=h[y],C=this.kernelSize[0],_=this.kernelSize[1],T=this.strides[0],B=this.strides[1],O=Uu(A,T,C,this.padding),U=Uu(w,B,_,this.padding),W=[f,O,U,this.filters];this.dataFormat!=="channelsLast"&&(c=Li(c,[0,2,3,1]));let z=HU(c,this.kernel.read(),W,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(z=Li(z,[0,3,1,2])),this.bias!=null&&(z=Nc(z,this.bias.read(),this.dataFormat)),this.activation!=null&&(z=this.activation.apply(z)),z})}computeOutputShape(r){r=Pi(r);const o=r.slice();let c,h,f;this.dataFormat==="channelsFirst"?(c=1,h=2,f=3):(c=3,h=1,f=2);const m=this.kernelSize[0],y=this.kernelSize[1],A=this.strides[0],w=this.strides[1];return o[c]=this.filters,o[h]=Uu(o[h],A,m,this.padding),o[f]=Uu(o[f],w,y,this.padding),o}getConfig(){const r=super.getConfig();return delete r.dilationRate,r}}Z5.className="Conv2DTranspose",Mt(Z5);class j5 extends Kv{constructor(r){if(super(r),this.inputSpec=[new vs({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new De(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(r){if(r=Pi(r),r.length!==5)throw new De("Input should have rank 5; Received input shape: "+JSON.stringify(r));const o=this.dataFormat==="channelsFirst"?1:r.length-1;if(r[o]==null)throw new De("The channel dimension of the inputs should be defined. Found `None`.");const c=r[o],h=this.kernelSize.concat([this.filters,c]);this.kernel=this.addWeight("kernel",h,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new vs({ndim:5,axes:{[o]:c}})],this.built=!0}call(r,o){return Qe(()=>{let c=$n(r);if(c.shape.length!==5)throw new De(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${c.shape.length}`);const h=c.shape,f=h[0];let m,y,A;this.dataFormat==="channelsFirst"?(A=2,m=3,y=4):(A=1,m=2,y=3);const w=h[A],C=h[m],_=h[y],T=this.kernelSize[0],B=this.kernelSize[1],O=this.kernelSize[2],U=this.strides[0],W=this.strides[1],z=this.strides[2],X=Uu(w,U,T,this.padding),re=Uu(C,W,B,this.padding),se=Uu(_,z,O,this.padding),le=[f,X,re,se,this.filters];this.dataFormat!=="channelsLast"&&(c=Li(c,[0,2,3,4,1]));let ge=Yae(c,this.kernel.read(),le,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(ge=Li(ge,[0,4,1,2,3])),this.bias!==null&&(ge=Nc(ge,this.bias.read(),this.dataFormat)),this.activation!==null&&(ge=this.activation.apply(ge)),ge})}computeOutputShape(r){r=Pi(r);const o=r.slice();let c,h,f,m;this.dataFormat==="channelsFirst"?(c=1,h=2,f=3,m=4):(c=4,h=1,f=2,m=3);const y=this.kernelSize[0],A=this.kernelSize[1],w=this.kernelSize[2],C=this.strides[0],_=this.strides[1],T=this.strides[2];return o[c]=this.filters,o[h]=Uu(o[h],C,y,this.padding),o[f]=Uu(o[f],_,A,this.padding),o[m]=Uu(o[m],T,w,this.padding),o}getConfig(){const r=super.getConfig();return delete r.dilationRate,r}}j5.className="Conv3DTranspose",Mt(j5);class Y5 extends G0{constructor(r,o){if(super(r,o),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,o.filters==null)throw new De("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(o.kernelInitializer!=null||o.kernelRegularizer!=null||o.kernelConstraint!=null)throw new De("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(o.padding!=null&&o.padding!=="same"&&o.padding!=="valid")throw new De(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(o.padding)}`);this.depthMultiplier=o.depthMultiplier==null?1:o.depthMultiplier,this.depthwiseInitializer=xr(o.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=wr(o.depthwiseRegularizer),this.depthwiseConstraint=xs(o.depthwiseConstraint),this.pointwiseInitializer=xr(o.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=wr(o.pointwiseRegularizer),this.pointwiseConstraint=xs(o.pointwiseConstraint)}build(r){if(r=Pi(r),r.length<this.rank+2)throw new De(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(r)}`);const o=this.dataFormat==="channelsFirst"?1:r.length-1;if(r[o]==null||r[o]<0)throw new De(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(r[o])}`);const c=r[o],h=this.kernelSize.concat([c,this.depthMultiplier]),f=[];for(let y=0;y<this.rank;++y)f.push(1);f.push(c*this.depthMultiplier,this.filters);const m=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",h,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,m,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",f,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,m,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,m,this.biasConstraint):this.bias=null,this.inputSpec=[new vs({ndim:this.rank+2,axes:{[o]:c}})],this.built=!0}call(r,o){return Qe(()=>{r=$n(r);let c;if(this.rank===1)throw new hi("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(r=Li(r,[0,2,3,1])),c=mz(r,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(c=Nc(c,this.bias.read(),this.dataFormat)),this.activation!=null&&(c=this.activation.apply(c)),this.dataFormat==="channelsFirst"&&(c=Li(c,[0,3,1,2])),c})}getConfig(){const r=super.getConfig();return delete r.rank,delete r.kernelInitializer,delete r.kernelRegularizer,delete r.kernelConstraint,r.depthwiseInitializer=Mr(this.depthwiseInitializer),r.pointwiseInitializer=Mr(this.pointwiseInitializer),r.depthwiseRegularizer=rr(this.depthwiseRegularizer),r.pointwiseRegularizer=rr(this.pointwiseRegularizer),r.depthwiseConstraint=bs(this.depthwiseConstraint),r.pointwiseConstraint=bs(this.pointwiseConstraint),r}}Y5.className="SeparableConv";class q5 extends Y5{constructor(r){super(2,r)}}q5.className="SeparableConv2D",Mt(q5);class cC extends G0{constructor(r){super(1,r),cC.verifyArgs(r),this.inputSpec=[{ndim:3}]}getConfig(){const r=super.getConfig();return delete r.rank,delete r.dataFormat,r}static verifyArgs(r){if(typeof r.kernelSize!="number"&&!Dk(r.kernelSize,"number",1,1))throw new De(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(r.kernelSize)}.`)}}cC.className="Conv1D",Mt(cC);class J5 extends Ai{constructor(r){super(r),typeof r.cropping=="number"?this.cropping=[[r.cropping,r.cropping],[r.cropping,r.cropping]]:typeof r.cropping[0]=="number"?this.cropping=[[r.cropping[0],r.cropping[0]],[r.cropping[1],r.cropping[1]]]:this.cropping=r.cropping,this.dataFormat=r.dataFormat===void 0?"channelsLast":r.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(r){return this.dataFormat==="channelsFirst"?[r[0],r[1],r[2]-this.cropping[0][0]-this.cropping[0][1],r[3]-this.cropping[1][0]-this.cropping[1][1]]:[r[0],r[1]-this.cropping[0][0]-this.cropping[0][1],r[2]-this.cropping[1][0]-this.cropping[1][1],r[3]]}call(r,o){return Qe(()=>{if(r=$n(r),this.dataFormat==="channelsLast"){const c=Qw(r,this.cropping[0][0],r.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Qw(c,this.cropping[1][0],r.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const c=Qw(r,this.cropping[0][0],r.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Qw(c,this.cropping[1][0],r.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const r={cropping:this.cropping,dataFormat:this.dataFormat},o=super.getConfig();return Object.assign(r,o),r}}J5.className="Cropping2D",Mt(J5);class eW extends Ai{constructor(r){super(r),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=r.size==null?this.DEFAULT_SIZE:r.size,this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,$r(this.dataFormat),this.interpolation=r.interpolation==null?"nearest":r.interpolation,vpe(this.interpolation)}computeOutputShape(r){if(this.dataFormat==="channelsFirst"){const o=r[2]==null?null:this.size[0]*r[2],c=r[3]==null?null:this.size[1]*r[3];return[r[0],r[1],o,c]}else{const o=r[1]==null?null:this.size[0]*r[1],c=r[2]==null?null:this.size[1]*r[2];return[r[0],o,c,r[3]]}}call(r,o){return Qe(()=>{let c=$n(r);const h=c.shape;if(this.dataFormat==="channelsFirst"){c=Li(c,[0,2,3,1]);const f=this.size[0]*h[2],m=this.size[1]*h[3],y=this.interpolation==="nearest"?Xh.resizeNearestNeighbor(c,[f,m]):Xh.resizeBilinear(c,[f,m]);return Li(y,[0,3,1,2])}else{const f=this.size[0]*h[1],m=this.size[1]*h[2];return this.interpolation==="nearest"?Xh.resizeNearestNeighbor(c,[f,m]):Xh.resizeBilinear(c,[f,m])}})}getConfig(){const r={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},o=super.getConfig();return Object.assign(r,o),r}}eW.className="UpSampling2D",Mt(eW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Wme(a,r,o=[1,1],c="valid",h,f){return Qe(()=>{h==null&&(h=Pc()),$r(h);let m=hR(a,h);if(a.rank!==4)throw new De(`Input for depthwiseConv2d is required to be 4-D, but is instead ${a.rank}-D`);if(r.rank!==4)throw new De(`depthwiseKernel is required to be 4-D, but is instead ${r.rank}-D`);return m=LM(m,r,o,c==="same"?"same":"valid","NHWC",f),h==="channelsFirst"&&(m=Li(m,[0,3,1,2])),m})}class tW extends lC{constructor(r){super(2,r),this.depthwiseKernel=null,this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=xr(r.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=xs(r.depthwiseConstraint),this.depthwiseRegularizer=wr(r.depthwiseRegularizer)}build(r){if(r=Pi(r),r.length<4)throw new De(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(r)}.`);const o=this.dataFormat==="channelsFirst"?1:3;if(r[o]==null||r[o]<0)throw new De(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${r[o]}).`);const c=r[o],h=[this.kernelSize[0],this.kernelSize[1],c,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",h,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[c*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(r,o){return Qe(()=>{r=$n(r);let c=Wme(r,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(c=Nc(c,this.bias.read(),this.dataFormat)),this.activation!=null&&(c=this.activation.apply(c)),c})}computeOutputShape(r){r=Pi(r);const o=this.dataFormat==="channelsFirst"?r[2]:r[1],c=this.dataFormat==="channelsFirst"?r[3]:r[2],h=this.dataFormat==="channelsFirst"?r[1]*this.depthMultiplier:r[3]*this.depthMultiplier,f=Oc(o,this.kernelSize[0],this.padding,this.strides[0]),m=Oc(c,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[r[0],h,f,m]:[r[0],f,m,h]}getConfig(){const r=super.getConfig();return r.depthMultiplier=this.depthMultiplier,r.depthwiseInitializer=Mr(this.depthwiseInitializer),r.depthwiseRegularizer=rr(this.depthwiseRegularizer),r.depthwiseConstraint=bs(this.depthwiseRegularizer),r}}tW.className="DepthwiseConv2D",Mt(tW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function nW(a,r,o,c){if(Array.isArray(a)){if(r!=null||o!=null)throw new De("When inputs is an array, neither initialState or constants should be provided");c!=null&&(o=a.slice(a.length-c,a.length),a=a.slice(0,a.length-c)),a.length>1&&(r=a.slice(1,a.length)),a=a[0]}function h(f){return f==null||Array.isArray(f)?f:[f]}return r=h(r),o=h(o),{inputs:a,initialState:r,constants:o}}function iW(a,r,o,c=!1,h,f,m=!1,y=!1){return Qe(()=>{const A=r.shape.length;if(A<3)throw new De(`Input should be at least 3D, but is ${A}D.`);const w=[1,0].concat(Bc(2,A));r=Li(r,w),f!=null,m&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),h!=null&&(h=pn(pn(h,"bool"),"float32"),h.rank===A-1&&(h=fa(h,-1)),h=Li(h,w)),c&&(r=vm(r,0),h!=null&&(h=vm(h,0)));const C=[];let _,T=o;const B=r.shape[0],O=xm(r);let U;h!=null&&(U=xm(h));for(let z=0;z<B;++z){const X=O[z],re=Qe(()=>a(X,T));if(h==null)_=re[0],T=re[1];else{const se=Qe(()=>{const le=U[z],ge=Wn(Xl(le),le),ye=Ot(Ue(re[0],le),Ue(T[0],ge)),be=T.map((Se,Be)=>Ot(Ue(re[1][Be],le),Ue(Se,ge)));return{output:ye,newStates:be}});_=se.output,T=se.newStates}y&&C.push(_)}let W;return y&&(W=Pu(C,1)),[_,W,T]})}class Cf extends Ai{constructor(r){super(r);let o;if(r.cell==null)throw new De("cell property is missing for the constructor of RNN.");if(Array.isArray(r.cell)?o=new pR({cells:r.cell}):o=r.cell,o.stateSize==null)throw new De("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=o,this.returnSequences=r.returnSequences==null?!1:r.returnSequences,this.returnState=r.returnState==null?!1:r.returnState,this.goBackwards=r.goBackwards==null?!1:r.goBackwards,this._stateful=r.stateful==null?!1:r.stateful,this.unroll=r.unroll==null?!1:r.unroll,this.supportsMasking=!0,this.inputSpec=[new vs({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const r=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Bc(0,r).map(o=>null)}else return this.states_}setStates(r){this.states_=r}computeOutputShape(r){Zk(r)&&(r=r[0]),r=r;let o=this.cell.stateSize;Array.isArray(o)||(o=[o]);const c=o[0];let h;if(this.returnSequences?h=[r[0],r[1],c]:h=[r[0],c],this.returnState){const f=[];for(const m of o)f.push([r[0],m]);return[h].concat(f)}else return h}computeMask(r,o){return Qe(()=>{Array.isArray(o)&&(o=o[0]);const c=this.returnSequences?o:null;if(this.returnState){const h=this.states.map(f=>null);return[c].concat(h)}else return c})}get states(){if(this.states_==null){const r=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,o=[];for(let c=0;c<r;++c)o.push(null);return o}else return this.states_}set states(r){this.states_=r}build(r){if(this.numConstants!=null)throw new hi("Constants support is not implemented in RNN yet.");Zk(r)&&(r=r[0]),r=r;const o=this.stateful?r[0]:null,c=r.slice(2);this.inputSpec[0]=new vs({shape:[o,null,...c]});const h=[r[0]].concat(r.slice(2));this.cell.build(h);let f;if(Array.isArray(this.cell.stateSize)?f=this.cell.stateSize:f=[this.cell.stateSize],this.stateSpec!=null){if(!R(this.stateSpec.map(m=>m.shape[m.shape.length-1]),f))throw new De(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=f.map(m=>new vs({shape:[null,m]}));this.stateful&&this.resetStates()}resetStates(r,o=!1){Qe(()=>{if(!this.stateful)throw new Du("Cannot call resetStates() on an RNN Layer that is not stateful.");const c=this.inputSpec[0].shape[0];if(c==null)throw new De("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(h=>Ns([c,h])):this.states_=[Ns([c,this.cell.stateSize])];else if(r==null)vi(this.states_),this.keptStates!=null&&(vi(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(h=>Ns([c,h])):this.states_[0]=Ns([c,this.cell.stateSize]);else{if(Array.isArray(r)||(r=[r]),r.length!==this.states_.length)throw new De(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${r.length} state value(s). Input received: ${r}`);o===!0?this.keptStates.push(this.states_.slice()):vi(this.states_);for(let h=0;h<this.states_.length;++h){const f=r[h],m=Array.isArray(this.cell.stateSize)?this.cell.stateSize[h]:this.cell.stateSize,y=[c,m];if(!R(f.shape,y))throw new De(`State ${h} is incompatible with layer ${this.name}: expected shape=${y}, received shape=${f.shape}`);this.states_[h]=f}}this.states_=this.states_.map(h=>ml(h.clone()))})}apply(r,o){let c=o==null?null:o.initialState,h=o==null?null:o.constants;o==null&&(o={});const f=nW(r,c,h,this.numConstants);r=f.inputs,c=f.initialState,h=f.constants;let m=[],y=[];if(c!=null){o.initialState=c,m=m.concat(c),this.stateSpec=[];for(const A of c)this.stateSpec.push(new vs({shape:A.shape}));y=y.concat(this.stateSpec)}if(h!=null&&(o.constants=h,m=m.concat(h),this.numConstants=h.length),m[0]instanceof Vu){const A=[r].concat(m),w=this.inputSpec.concat(y),C=this.inputSpec;this.inputSpec=w;const _=super.apply(A,o);return this.inputSpec=C,_}else return super.apply(r,o)}call(r,o){return Qe(()=>{const c=o==null?null:o.mask,h=o==null?null:o.training;let f=o==null?null:o.initialState;r=$n(r),f==null&&(this.stateful?f=this.states_:f=this.getInitialState(r));const m=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(f.length!==m)throw new De(`RNN Layer has ${m} state(s) but was passed ${f.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const y={training:h},A=iW((B,O)=>{const U=this.cell.call([B].concat(O),y);return[U[0],U.slice(1)]},r,f,this.goBackwards,c,null,this.unroll,this.returnSequences),w=A[0],C=A[1],_=A[2];this.stateful&&this.resetStates(_,h);const T=this.returnSequences?C:w;return this.returnState?[T].concat(_):T})}getInitialState(r){return Qe(()=>{let o=Ns(r.shape);return o=Bn(o,[1,2]),o=Fv(o),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(c=>c>1?Uk(o,[1,c]):o):this.cell.stateSize>1?[Uk(o,[1,this.cell.stateSize])]:[o]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(r){super.setFastWeightInitDuringBuild(r),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(r)}getConfig(){const r=super.getConfig(),o={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(o.numConstants=this.numConstants);const c=this.cell.getConfig();return this.getClassName()===Cf.className&&(o.cell={className:this.cell.getClassName(),config:c}),Object.assign(Object.assign(Object.assign({},c),r),o)}static fromConfig(r,o,c={}){const h=o.cell,f=jh(h,c);return new r(Object.assign(o,{cell:f}))}}Cf.className="RNN",Mt(Cf);class uC extends Ai{}class dR extends uC{constructor(r){super(r),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=r.units,Ds(this.units,"units"),this.activation=wf(r.activation==null?this.DEFAULT_ACTIVATION:r.activation),this.useBias=r.useBias==null?!0:r.useBias,this.kernelInitializer=xr(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xr(r.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xr(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=wr(r.kernelRegularizer),this.recurrentRegularizer=wr(r.recurrentRegularizer),this.biasRegularizer=wr(r.biasRegularizer),this.kernelConstraint=xs(r.kernelConstraint),this.recurrentConstraint=xs(r.recurrentConstraint),this.biasConstraint=xs(r.biasConstraint),this.dropout=V0([1,vf([0,r.dropout==null?0:r.dropout])]),this.recurrentDropout=V0([1,vf([0,r.recurrentDropout==null?0:r.recurrentDropout])]),this.dropoutFunc=r.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(r){r=Pi(r),this.kernel=this.addWeight("kernel",[r[r.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(r,o){return Qe(()=>{if(r=r,r.length!==2)throw new De(`SimpleRNNCell expects 2 input Tensors, got ${r.length}.`);let c=r[1];r=r[0];const h=o.training==null?!1:o.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ef({ones:()=>Xl(r),rate:this.dropout,training:h,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ef({ones:()=>Xl(c),rate:this.recurrentDropout,training:h,dropoutFunc:this.dropoutFunc}));let f;const m=this.dropoutMask,y=this.recurrentDropoutMask;m!=null?f=Ou(Ue(r,m),this.kernel.read()):f=Ou(r,this.kernel.read()),this.bias!=null&&(f=Nc(f,this.bias.read())),y!=null&&(c=Ue(c,y));let A=Ot(f,Ou(c,this.recurrentKernel.read()));return this.activation!=null&&(A=this.activation.apply(A)),[A,A]})}getConfig(){const r=super.getConfig(),o={units:this.units,activation:xf(this.activation),useBias:this.useBias,kernelInitializer:Mr(this.kernelInitializer),recurrentInitializer:Mr(this.recurrentInitializer),biasInitializer:Mr(this.biasInitializer),kernelRegularizer:rr(this.kernelRegularizer),recurrentRegularizer:rr(this.recurrentRegularizer),biasRegularizer:rr(this.biasRegularizer),activityRegularizer:rr(this.activityRegularizer),kernelConstraint:bs(this.kernelConstraint),recurrentConstraint:bs(this.recurrentConstraint),biasConstraint:bs(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},r),o)}}dR.className="SimpleRNNCell",Mt(dR);class rW extends Cf{constructor(r){r.cell=new dR(r),super(r)}call(r,o){return Qe(()=>{this.cell.dropoutMask!=null&&(vi(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(vi(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const c=o==null?null:o.mask,h=o==null?null:o.training,f=o==null?null:o.initialState;return super.call(r,{mask:c,training:h,initialState:f})})}static fromConfig(r,o){return new r(o)}}rW.className="SimpleRNN",Mt(rW);class fR extends uC{constructor(r){if(super(r),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",r.resetAfter)throw new De("GRUCell does not support reset_after parameter set to true.");this.units=r.units,Ds(this.units,"units"),this.activation=wf(r.activation===void 0?this.DEFAULT_ACTIVATION:r.activation),this.recurrentActivation=wf(r.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:r.recurrentActivation),this.useBias=r.useBias==null?!0:r.useBias,this.kernelInitializer=xr(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xr(r.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xr(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=wr(r.kernelRegularizer),this.recurrentRegularizer=wr(r.recurrentRegularizer),this.biasRegularizer=wr(r.biasRegularizer),this.kernelConstraint=xs(r.kernelConstraint),this.recurrentConstraint=xs(r.recurrentConstraint),this.biasConstraint=xs(r.biasConstraint),this.dropout=V0([1,vf([0,r.dropout==null?0:r.dropout])]),this.recurrentDropout=V0([1,vf([0,r.recurrentDropout==null?0:r.recurrentDropout])]),this.dropoutFunc=r.dropoutFunc,this.implementation=r.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(r){r=Pi(r);const o=r[r.length-1];this.kernel=this.addWeight("kernel",[o,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(r,o){return Qe(()=>{if(r=r,r.length!==2)throw new De(`GRUCell expects 2 input Tensors (inputs, h, c), got ${r.length}.`);const c=o.training==null?!1:o.training;let h=r[1];r=r[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ef({ones:()=>Xl(r),rate:this.dropout,training:c,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ef({ones:()=>Xl(h),rate:this.recurrentDropout,training:c,count:3,dropoutFunc:this.dropoutFunc}));const f=this.dropoutMask,m=this.recurrentDropoutMask;let y,A,w;0<this.dropout&&this.dropout<1&&(r=Ue(r,f[0]));let C=Ou(r,this.kernel.read());this.useBias&&(C=Nc(C,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(h=Ue(h,m[0]));const _=this.recurrentKernel.read(),[T,B]=Al(_,[2*this.units,this.units],_.rank-1),O=Ou(h,T),[U,W,z]=Al(C,3,C.rank-1),[X,re]=Al(O,2,O.rank-1);y=this.recurrentActivation.apply(Ot(U,X)),A=this.recurrentActivation.apply(Ot(W,re));const se=Ou(Ue(A,h),B);w=this.activation.apply(Ot(z,se));const le=Ot(Ue(y,h),Ue(Ot(1,Xr(y)),w));return[le,le]})}getConfig(){const r=super.getConfig(),o={units:this.units,activation:xf(this.activation),recurrentActivation:xf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mr(this.kernelInitializer),recurrentInitializer:Mr(this.recurrentInitializer),biasInitializer:Mr(this.biasInitializer),kernelRegularizer:rr(this.kernelRegularizer),recurrentRegularizer:rr(this.recurrentRegularizer),biasRegularizer:rr(this.biasRegularizer),activityRegularizer:rr(this.activityRegularizer),kernelConstraint:bs(this.kernelConstraint),recurrentConstraint:bs(this.recurrentConstraint),biasConstraint:bs(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},r),o)}}fR.className="GRUCell",Mt(fR);class sW extends Cf{constructor(r){r.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),r.cell=new fR(r),super(r)}call(r,o){return Qe(()=>{this.cell.dropoutMask!=null&&(vi(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(vi(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const c=o==null?null:o.mask,h=o==null?null:o.training,f=o==null?null:o.initialState;return super.call(r,{mask:c,training:h,initialState:f})})}static fromConfig(r,o){return o.implmentation===0&&(o.implementation=1),new r(o)}}sW.className="GRU",Mt(sW);class hC extends uC{constructor(r){super(r),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=r.units,Ds(this.units,"units"),this.activation=wf(r.activation===void 0?this.DEFAULT_ACTIVATION:r.activation),this.recurrentActivation=wf(r.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:r.recurrentActivation),this.useBias=r.useBias==null?!0:r.useBias,this.kernelInitializer=xr(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xr(r.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xr(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=r.unitForgetBias,this.kernelRegularizer=wr(r.kernelRegularizer),this.recurrentRegularizer=wr(r.recurrentRegularizer),this.biasRegularizer=wr(r.biasRegularizer),this.kernelConstraint=xs(r.kernelConstraint),this.recurrentConstraint=xs(r.recurrentConstraint),this.biasConstraint=xs(r.biasConstraint),this.dropout=V0([1,vf([0,r.dropout==null?0:r.dropout])]),this.recurrentDropout=V0([1,vf([0,r.recurrentDropout==null?0:r.recurrentDropout])]),this.dropoutFunc=r.dropoutFunc,this.implementation=r.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(r){var o;r=Pi(r);const c=r[r.length-1];this.kernel=this.addWeight("kernel",[c,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let h;if(this.useBias){if(this.unitForgetBias){const f=this.biasInitializer,m=this.units;h=new(o=class extends Zl{apply(y,A){const w=f.apply([m]),C=new Gk().apply([m]),_=f.apply([m*2]);return PG(PG(w,C),_)}},o.className="CustomInit",o)}else h=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,h,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(r,o){return Qe(()=>{const c=o.training==null?!1:o.training;if(r=r,r.length!==3)throw new De(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${r.length}.`);let h=r[1];const f=r[2];r=r[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ef({ones:()=>Xl(r),rate:this.dropout,training:c,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ef({ones:()=>Xl(h),rate:this.recurrentDropout,training:c,count:4,dropoutFunc:this.dropoutFunc}));const m=this.dropoutMask,y=this.recurrentDropoutMask;let A,w,C,_;0<this.dropout&&this.dropout<1&&(r=Ue(r,m[0]));let T=Ou(r,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(h=Ue(h,y[0])),T=Ot(T,Ou(h,this.recurrentKernel.read())),this.useBias&&(T=Nc(T,this.bias.read()));const[B,O,U,W]=Al(T,4,T.rank-1);A=this.recurrentActivation.apply(B),w=this.recurrentActivation.apply(O),C=Ot(Ue(w,f),Ue(A,this.activation.apply(U))),_=this.recurrentActivation.apply(W);const z=Ue(_,this.activation.apply(C));return[z,z,C]})}getConfig(){const r=super.getConfig(),o={units:this.units,activation:xf(this.activation),recurrentActivation:xf(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mr(this.kernelInitializer),recurrentInitializer:Mr(this.recurrentInitializer),biasInitializer:Mr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:rr(this.kernelRegularizer),recurrentRegularizer:rr(this.recurrentRegularizer),biasRegularizer:rr(this.biasRegularizer),activityRegularizer:rr(this.activityRegularizer),kernelConstraint:bs(this.kernelConstraint),recurrentConstraint:bs(this.recurrentConstraint),biasConstraint:bs(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},r),o)}}hC.className="LSTMCell",Mt(hC);class oW extends Cf{constructor(r){r.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),r.cell=new hC(r),super(r)}call(r,o){return Qe(()=>{this.cell.dropoutMask!=null&&(vi(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(vi(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const c=o==null?null:o.mask,h=o==null?null:o.training,f=o==null?null:o.initialState;return super.call(r,{mask:c,training:h,initialState:f})})}static fromConfig(r,o){return o.implmentation===0&&(o.implementation=1),new r(o)}}oW.className="LSTM",Mt(oW);class pR extends uC{constructor(r){super(r),this.cells=r.cells}get stateSize(){const r=[];for(const o of this.cells.slice().reverse())Array.isArray(o.stateSize)?r.push(...o.stateSize):r.push(o.stateSize);return r}call(r,o){return Qe(()=>{r=r;let c=r.slice(1);const h=[];for(const y of this.cells.slice().reverse())Array.isArray(y.stateSize)?h.push(c.splice(0,y.stateSize.length)):h.push(c.splice(0,1));h.reverse();const f=[];let m;for(let y=0;y<this.cells.length;++y){const A=this.cells[y];c=h[y],y===0?m=[r[0]].concat(c):m=[m[0]].concat(c),m=A.call(m,o),f.push(m.slice(1))}c=[];for(const y of f.slice().reverse())c.push(...y);return[m[0]].concat(c)})}build(r){Zk(r)&&(r=r[0]),r=r;let o;this.cells.forEach((c,h)=>{Im(`RNNCell_${h}`,()=>{c.build(r),Array.isArray(c.stateSize)?o=c.stateSize[0]:o=c.stateSize,r=[r[0],o]})}),this.built=!0}getConfig(){const r=super.getConfig(),o=h=>({className:h.getClassName(),config:h.getConfig()}),c={cells:this.cells.map(o)};return Object.assign(Object.assign({},r),c)}static fromConfig(r,o,c={}){const h=[];for(const f of o.cells)h.push(jh(f,c));return new r({cells:h})}get trainableWeights(){if(!this.trainable)return[];const r=[];for(const o of this.cells)r.push(...o.trainableWeights);return r}get nonTrainableWeights(){const r=[];for(const o of this.cells)r.push(...o.nonTrainableWeights);if(!this.trainable){const o=[];for(const c of this.cells)o.push(...c.trainableWeights);return o.concat(r)}return r}getWeights(){const r=[];for(const o of this.cells)r.push(...o.weights);return jk(r)}setWeights(r){const o=[];for(const c of this.cells){const h=c.weights.length,f=r.splice(h);for(let m=0;m<c.weights.length;++m)o.push([c.weights[m],f[m]])}Yk(o)}}pR.className="StackedRNNCells",Mt(pR);function Ef(a){const{ones:r,rate:o,training:c=!1,count:h=1,dropoutFunc:f}=a,m=()=>f!=null?f(r(),o):DG(r(),o),y=()=>Vv(m,r,c);return!h||h<=1?ml(y().clone()):Array(h).fill(void 0).map(y).map(A=>ml(A.clone()))}/**
* @license
* Copyright 2020 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/var Hme=function(a,r){var o={};for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&r.indexOf(c)<0&&(o[c]=a[c]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(a);h<c.length;h++)r.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(a,c[h])&&(o[c[h]]=a[c[h]]);return o};class aW extends Cf{constructor(r){if(r.unroll)throw new hi("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(r.cell))throw new hi("It is not possible at the moment to stack convolutional cells.");super(r),this.inputSpec=[new vs({ndim:5})]}call(r,o){return Qe(()=>{if(this.cell.dropoutMask!=null&&(vi(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(vi(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),o&&o.constants)throw new De("ConvRNN2D cell does not support constants");const c=o==null?null:o.mask,h=o==null?null:o.training,f=o==null?null:o.initialState;return super.call(r,{mask:c,training:h,initialState:f})})}computeOutputShape(r){let o=this.computeSingleOutputShape(r);return this.returnSequences||(o=[o[0],...o.slice(2)]),this.returnState&&(o=[o,...Array(2).fill([r[0],...o.slice(-3)])]),o}getInitialState(r){return Qe(()=>{const{stateSize:o}=this.cell,c=r.shape,h=this.computeSingleOutputShape(c),f=[h[0],...h.slice(2)],m=Ns(f);return Array.isArray(o)?Array(o.length).fill(m):[m]})}resetStates(r,o=!1){Qe(()=>{if(!this.stateful)throw new Du("Cannot call resetStates() on an RNN Layer that is not stateful.");const c=this.inputSpec[0].shape,h=this.computeSingleOutputShape(c),f=[h[0],...h.slice(2)];if(c[0]==null)throw new De("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ns(f)):this.states_=[Ns(f)];else if(r==null)vi(this.states_),this.keptStates!=null&&(vi(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ns(f)):this.states_[0]=Ns(f);else{if(Array.isArray(r)||(r=[r]),r.length!==this.states_.length)throw new De(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${r.length} state value(s). Input received: ${r}`);o?this.keptStates.push(this.states_.slice()):vi(this.states_);for(let m=0;m<this.states_.length;++m){const y=r[m],A=f;if(!R(y.shape,A))throw new De(`State ${m} is incompatible with layer ${this.name}: expected shape=${A}, received shape=${y.shape}`);this.states_[m]=y}}this.states_=this.states_.map(m=>ml(m.clone()))})}computeSingleOutputShape(r){const{dataFormat:o,filters:c,kernelSize:h,padding:f,strides:m,dilationRate:y}=this.cell,A=o==="channelsFirst",w=r[A?3:2],C=r[A?4:3],_=Oc(w,h[0],f,m[0],y[0]),T=Oc(C,h[1],f,m[1],y[1]);return[...r.slice(0,2),...A?[c,_,T]:[_,T,c]]}}aW.className="ConvRNN2D";class mR extends hC{constructor(r){const{filters:o,kernelSize:c,strides:h,padding:f,dataFormat:m,dilationRate:y}=r;super(Object.assign(Object.assign({},r),{units:o})),this.filters=o,Ds(this.filters,"filters"),this.kernelSize=z0(c,2,"kernelSize"),this.kernelSize.forEach(A=>Ds(A,"kernelSize")),this.strides=z0(h||1,2,"strides"),this.strides.forEach(A=>Ds(A,"strides")),this.padding=f||"valid",vl(this.padding),this.dataFormat=m||"channelsLast",$r(this.dataFormat),this.dilationRate=z0(y||1,2,"dilationRate"),this.dilationRate.forEach(A=>Ds(A,"dilationRate"))}build(r){var o;r=Pi(r);const c=this.dataFormat==="channelsFirst"?1:r.length-1;if(r[c]==null)throw new De(`The channel dimension of the input should be defined. Found ${r[c]}`);const h=r[c],f=4,m=this.kernelSize.concat([h,this.filters*f]);this.kernel=this.addWeight("kernel",m,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const y=this.kernelSize.concat([this.filters,this.filters*f]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",y,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let A;if(this.unitForgetBias){const w=this.biasInitializer,C=this.filters;A=new(o=class extends Zl{apply(_,T){const B=w.apply([C]),O=mf([C]),U=w.apply([C*2]);return Vk([B,O,U])}},o.className="CustomInit",o)}else A=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*f],null,A,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(r,o){return Qe(()=>{if(r.length!==3)throw new De(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${r.length}.`);const c=o.training||!1,h=r[0],f=r[1],m=r[2],y=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Ef({ones:()=>Xl(h),rate:this.dropout,training:c,count:y,dropoutFunc:this.dropoutFunc}));const A=this.dropoutMask,w=(Vt,Bt,$t)=>!Bt||!Bt[$t]?Vt:Ue(Bt[$t],Vt);let C=w(h,A,0),_=w(h,A,1),T=w(h,A,2),B=w(h,A,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Ef({ones:()=>Xl(f),rate:this.recurrentDropout,training:c,count:y,dropoutFunc:this.dropoutFunc}));const O=this.recurrentDropoutMask;let U=w(f,O,0),W=w(f,O,1),z=w(f,O,2),X=w(f,O,3);const re=3,[se,le,ge,ye]=Al(this.kernel.read(),y,re),[be,Se,Be,Ye]=this.useBias?Al(this.bias.read(),y):[null,null,null,null];C=this.inputConv(C,se,be,this.padding),_=this.inputConv(_,le,Se,this.padding),T=this.inputConv(T,ge,Be,this.padding),B=this.inputConv(B,ye,Ye,this.padding);const[et,tt,ot,st]=Al(this.recurrentKernel.read(),y,re);U=this.recurrentConv(U,et),W=this.recurrentConv(W,tt),z=this.recurrentConv(z,ot),X=this.recurrentConv(X,st);const ct=this.recurrentActivation.apply(Ot(C,U)),gt=this.recurrentActivation.apply(Ot(_,W)),mt=Ot(Ue(gt,m),Ue(ct,this.activation.apply(Ot(T,z)))),bt=Ue(this.recurrentActivation.apply(Ot(B,X)),this.activation.apply(mt));return[bt,bt,mt]})}getConfig(){const r=super.getConfig(),o=Hme(r,["units"]),c={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},o),c)}inputConv(r,o,c,h){const f=mm(r,o,this.strides,h||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return c?Nc(f,c,this.dataFormat):f}recurrentConv(r,o){return mm(r,o,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}mR.className="ConvLSTM2DCell",Mt(mR);class lW extends aW{constructor(r){const o=new mR(r);super(Object.assign(Object.assign({},r),{cell:o}))}static fromConfig(r,o){return new r(o)}}lW.className="ConvLSTM2D",Mt(lW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class gR extends Ai{constructor(r){super(r),this.rate=Math.max(Math.min(r.rate,1),0),this.noiseShape=r.noiseShape,this.seed=r.seed,this.supportsMasking=!0}getNoiseShape(r){if(this.noiseShape==null)return this.noiseShape;const o=r.shape,c=[];for(let h=0;h<this.noiseShape.length;++h)c.push(this.noiseShape[h]==null?o[h]:this.noiseShape[h]);return c}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r);if(0<this.rate&&this.rate<1){const h=o.training==null?!1:o.training,f=this.getNoiseShape(c);return Vv(()=>DG(c,this.rate,f,this.seed),()=>c,h)}return r})}getConfig(){const r={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},o=super.getConfig();return Object.assign(r,o),r}dispose(){return super.dispose()}}gR.className="Dropout",Mt(gR);class cW extends gR{constructor(r){super(r),this.inputSpec=[{ndim:3}]}getNoiseShape(r){const o=r.shape;return[o[0],1,o[2]]}}cW.className="SpatialDropout1D",Mt(cW);class uW extends Ai{constructor(r){if(super(r),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",r.batchInputShape==null&&r.inputShape==null&&r.inputDim!=null){let o=null;r.batchSize!=null&&(o=r.batchSize),this.batchInputShape=[o,r.inputDim]}this.units=r.units,Ds(this.units,"units"),this.activation=wf(r.activation),r.useBias!=null&&(this.useBias=r.useBias),this.kernelInitializer=xr(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=xr(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=xs(r.kernelConstraint),this.biasConstraint=xs(r.biasConstraint),this.kernelRegularizer=wr(r.kernelRegularizer),this.biasRegularizer=wr(r.biasRegularizer),this.activityRegularizer=wr(r.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(r){r=Pi(r);const o=r[r.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[o,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:o}}],this.built=!0}computeOutputShape(r){r=Pi(r);const o=r.slice();return o[o.length-1]=this.units,o}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r),h=SG(this.activation.getClassName());let f;return h!=null?f=Ou(c,this.kernel.read(),h,this.bias?this.bias.read():null):(f=Ou(c,this.kernel.read()),this.bias!=null&&(f=Nc(f,this.bias.read())),this.activation!=null&&(f=this.activation.apply(f))),f})}getConfig(){const r={units:this.units,activation:xf(this.activation),useBias:this.useBias,kernelInitializer:Mr(this.kernelInitializer),biasInitializer:Mr(this.biasInitializer),kernelRegularizer:rr(this.kernelRegularizer),biasRegularizer:rr(this.biasRegularizer),activityRegularizer:rr(this.activityRegularizer),kernelConstraint:bs(this.kernelConstraint),biasConstraint:bs(this.biasConstraint)},o=super.getConfig();return Object.assign(r,o),r}}uW.className="Dense",Mt(uW);class hW extends Ai{constructor(r){r=r||{},super(r),this.inputSpec=[{minNDim:3}],this.dataFormat=r.dataFormat}computeOutputShape(r){r=Pi(r);for(const o of r.slice(1))if(o==null)throw new De(`The shape of the input to "Flatten" is not fully defined (got ${r.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[r[0],Af(r,1)]}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);let c=$n(r);if(this.dataFormat==="channelsFirst"&&c.rank>1){const h=[0];for(let f=2;f<c.rank;++f)h.push(f);h.push(1),c=Li(c,h)}return _pe(c)})}getConfig(){const r={};this.dataFormat!=null&&(r.dataFormat=this.dataFormat);const o=super.getConfig();return Object.assign(r,o),r}}hW.className="Flatten",Mt(hW);class dW extends Ai{constructor(r){super(r),this.supportsMasking=!0,this.activation=wf(r.activation)}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r);return this.activation.apply(c)})}getConfig(){const r={activation:xf(this.activation)},o=super.getConfig();return Object.assign(r,o),r}}dW.className="Activation",Mt(dW);class fW extends Ai{constructor(r){super(r),this.n=r.n,this.inputSpec=[{ndim:2}]}computeOutputShape(r){return[r[0],this.n,r[1]]}call(r,o){return Qe(()=>(r=$n(r),Cpe(r,this.n)))}getConfig(){const r={n:this.n},o=super.getConfig();return Object.assign(r,o),r}}fW.className="RepeatVector",Mt(fW);class pW extends Ai{constructor(r){super(r),this.targetShape=r.targetShape;for(let o=0;o<this.targetShape.length;++o)this.isUnknown(this.targetShape[o])&&(this.targetShape[o]=null)}isUnknown(r){return r<0||r==null}fixUnknownDimension(r,o){const c="Total size of new array must be unchanged.",h=o.slice();let f=1,m=null;for(let A=0;A<h.length;++A){const w=h[A];if(this.isUnknown(w))if(m===null)m=A;else throw new De("Can only specifiy one unknown dimension.");else f*=w}const y=Af(r);if(m!==null){if(f===0||y%f!==0)throw new De(c);h[m]=y/f}else if(y!==f)throw new De(c);return h}computeOutputShape(r){let o=!1;for(let c=0;c<r.length;++c)if(this.isUnknown(r[c])){o=!0;break}return o?r.slice(0,1).concat(this.targetShape):r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape))}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r),h=c.shape,f=h.slice(0,1).concat(this.fixUnknownDimension(h.slice(1),this.targetShape));return Xe(c,f)})}getConfig(){const r={targetShape:this.targetShape},o=super.getConfig();return Object.assign(r,o),r}}pW.className="Reshape",Mt(pW);class mW extends Ai{constructor(r){if(super(r),r.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(r.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${r.dims} instead.`);const o=Bc(1,r.dims.length+1);if(!R(r.dims.slice().sort(),o))throw new Error("Invalid permutation `dims`: "+JSON.stringify(r.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=r.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new vs({ndim:this.dims.length+1})]}computeOutputShape(r){r=Pi(r);const o=r.slice();return this.dims.forEach((c,h)=>{o[h+1]=r[c]}),o}call(r,o){return Li($n(r),this.dimsIncludingBatch)}getConfig(){const r={dims:this.dims},o=super.getConfig();return Object.assign(r,o),r}}mW.className="Permute",Mt(mW);class gW extends Ai{constructor(r){super(r??{}),this.supportsMasking=!0,r!=null?this.maskValue=r.maskValue==null?0:r.maskValue:this.maskValue=0}computeOutputShape(r){return r}getConfig(){const r=super.getConfig(),o={maskValue:this.maskValue};return Object.assign(o,r),o}computeMask(r,o){const c=$n(r);return CM(Dw(c,this.maskValue),-1)}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r),h=CM(Dw(c,this.maskValue),-1,!0);return Ue(c,pn(h,c.dtype))})}}gW.className="Masking",Mt(gW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class yW extends Ai{constructor(r){if(super(r),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",r.batchInputShape==null&&r.inputShape==null){let o=null;r.batchSize!=null&&(o=r.batchSize),r.inputLength==null?this.batchInputShape=[o,null]:this.batchInputShape=[o].concat(ji(r.inputLength))}this.inputDim=r.inputDim,Ds(this.inputDim,"inputDim"),this.outputDim=r.outputDim,Ds(this.outputDim,"outputDim"),this.embeddingsInitializer=xr(r.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=wr(r.embeddingsRegularizer),this.activityRegularizer=wr(r.activityRegularizer),this.embeddingsConstraint=xs(r.embeddingsConstraint),this.maskZero=r.maskZero,this.supportsMasking=r.maskZero,this.inputLength=r.inputLength}build(r){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(r){}computeMask(r,o){return Qe(()=>this.maskZero?(r=$n(r),Dw(r,Ri(r))):null)}computeOutputShape(r){if(r=Pi(r),this.inputLength==null)return[...r,this.outputDim];const o=ji(this.inputLength);if(o.length!==r.length-1)throw new De(`"inputLength" is ${this.inputLength}, but received input shape has shape ${r}`);{let c=0;for(let h=0;h<o.length;++h){const f=o[h],m=r[h+1];if(f!=null&&m!=null&&f!==m)throw new De(`"inputLength" is ${this.inputLength}, but received input shape has shape ${r}`);f==null&&(o[c]=m),c++}}return[r[0],...o,this.outputDim]}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);let c=$n(r);c.dtype!=="int32"&&(c=Zh(c,"int32"));const h=NG(this.embeddings.read(),Xe(c,[c.size]));return Xe(h,Pi(this.computeOutputShape(c.shape)))})}getConfig(){const r={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Mr(this.embeddingsInitializer),embeddingsRegularizer:rr(this.embeddingsRegularizer),activityRegularizer:rr(this.activityRegularizer),embeddingsConstraint:bs(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},o=super.getConfig();return Object.assign(r,o),r}}yW.className="Embedding",Mt(yW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class Mm extends Ai{constructor(r){super(r||{}),this.supportsMasking=!0}mergeFunction(r){throw new hi}computeElementwiseOpOutputShape(r,o){if(r==null||o==null)return null;if(r.length<o.length)return this.computeElementwiseOpOutputShape(o,r);if(o.length===0)return r;const c=r.slice(0,r.length-o.length);for(let h=0;h<o.length;++h){const f=r[r.length-o.length+h],m=o[h];if(f==null||m==null||f<0||m<0)c.push(null);else if(f===1)c.push(m);else if(m===1)c.push(f);else{if(f!==m)throw new De("Operands could not be broadcast together with shapes "+JSON.stringify(r)+" "+JSON.stringify(o));c.push(f)}}return c}build(r){if(Array.isArray(r)&&!Array.isArray(r[0])&&(r=[Pi(r)]),r=r,r.length<2)throw new De(`A merge layer should be called on an Array of at least 2 inputs. Got ${r.length} input(s).`);let o=[];for(const f of r)f!=null&&f[0]!==null&&o.push(f[0]);if(o=yf(o),o.length>1)throw new De(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(r)}.`);let c=r[0]==null?null:r[0].slice(1);for(let f=1;f<r.length;++f){const m=r[f]==null?null:r[f].slice(1);c=this.computeElementwiseOpOutputShape(c,m)}const h=r.map(f=>f.length);r.indexOf(null)===-1&&yf(h).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(r,o){return Qe(()=>{if(r=r,this.reshapeRequired){const c=[],h=r.map(f=>f.rank);if(h.indexOf(null)===-1){const f=vf(h);for(let m of r){const y=m.rank;for(let A=0;A<f-y;++A)m=Fv(m,1);c.push(m)}return this.mergeFunction(c)}else{let f=!1;for(const A of r){const w=A.rank;if(w==null){const C=A.shape,_=C[0],T=C.slice(1).concat([_]);let B=Xe(A,[_].concat(Af(C.slice(1))));B=Li(B,[1,0]),B=Xe(B,T),c.push(B),f=!0}else if(w>1){const C=Bc(1,w).concat([0]);c.push(Li(A,C)),f=!0}else c.push(A)}let m=this.mergeFunction(c);const y=m.rank;if(f){if(y==null){const A=m.shape,w=A.length,C=A[w-1],_=[C].concat(A.slice(0,A.length-1));m=Xe(Li(Xe(m,[-1,C]),[1,0]),_)}else if(y>1){const A=[y-1].concat(Bc(0,y-1));m=Li(m,A)}}return m}}else return this.mergeFunction(r)})}computeOutputShape(r){r=r;let o;r[0]==null?o=null:o=r[0].slice(1);for(let h=1;h<r.length;++h){const f=r[h]==null?null:r[h].slice(1);o=this.computeElementwiseOpOutputShape(o,f)}let c=[];for(const h of r)h!=null&&h[0]!==null&&c.push(h[0]);return c=yf(c),c.length===1?o=c.concat(o):o=[null].concat(o),o}computeMask(r,o){return Qe(()=>{if(o==null)return null;if(!Array.isArray(o))throw new De("`mask` should be an Array");if(!Array.isArray(r))throw new De("`inputs` should be an Array");if(o.length!==r.length)throw new De(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${r.length} vs ${o.length})`);if(o.every(h=>h==null))return null;o=o.map(h=>h==null?h:fa(h,0));let c=o[0];for(let h=1;h<o.length-1;++h)c=Hh(c,o[h]);return c})}}class AW extends Mm{constructor(r){super(r)}mergeFunction(r){return Qe(()=>{let o=r[0].clone();for(let c=1;c<r.length;++c)o=Ot(o,r[c]);return o})}}AW.className="Add",Mt(AW);class vW extends Mm{constructor(r){super(r)}mergeFunction(r){return Qe(()=>{let o=r[0].clone();for(let c=1;c<r.length;++c)o=Ue(o,r[c]);return o})}}vW.className="Multiply",Mt(vW);class bW extends Mm{constructor(r){super(r)}mergeFunction(r){return Qe(()=>{let o=r[0].clone();for(let c=1;c<r.length;++c)o=Ot(o,r[c]);return Ue(1/r.length,o)})}}bW.className="Average",Mt(bW);class xW extends Mm{constructor(r){super(r)}mergeFunction(r){return Qe(()=>{let o=r[0];for(let c=1;c<r.length;++c)o=pf(o,r[c]);return o})}}xW.className="Maximum",Mt(xW);class wW extends Mm{constructor(r){super(r)}mergeFunction(r){return Qe(()=>{let o=r[0];for(let c=1;c<r.length;++c)o=Sv(o,r[c]);return o})}}wW.className="Minimum",Mt(wW);class CW extends Mm{constructor(r){super(r),this.DEFAULT_AXIS=-1,r==null&&(r={}),this.axis=r.axis==null?this.DEFAULT_AXIS:r.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(r){if(!(Array.isArray(r)&&Array.isArray(r[0]))||r.length===1)throw new De("A `Concatenate` layer should be called on a list of at least 2 inputs");r=r;let o=!0;for(const h of r)if(h!=null){o=!1;break}if(o)return;const c=[];for(let h=0;h<r.length;++h){const f=r[h].slice();f.splice(this.axis,1);let m=!1;for(const y of c)if(R(y,f)){m=!0;break}m||c.push(f)}if(c.length>1)throw new De("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(r))}mergeFunction(r){return Qe(()=>Vk(r,this.axis))}computeOutputShape(r){if(!(Array.isArray(r)&&Array.isArray(r[0])))throw new De("A `Concatenate` layer should be called on a list of inputs.");const o=r,c=o[0].slice(),h=this.axis<0?c.length+this.axis:this.axis;for(const f of o.slice(1)){if(c[h]==null||f[h]==null){c[h]=null;break}c[h]+=f[h]}return c}computeMask(r,o){if(o==null)return null;if(!Array.isArray(o))throw new De("`mask` should be an array for Concatenate");if(!Array.isArray(r))throw new De("`inputs` should be an array for Concatenate");if(o.length!==r.length)throw new De(`Mismatch in the length of mask (${o.length}) and the legnth of inputs (${r.length})`);return Qe(()=>{let c=!0;if(o.forEach(m=>{if(m!=null){c=!1;return}}),c)return null;const h=[];for(let m=0;m<r.length;++m)o[m]==null?h.push(pn(Xl(r[m]),"bool")):o[m].rank<r[m].rank?h.push(fa(o[m],-1)):h.push(o[m]);const f=da(h,this.axis);return GU(f,-1,!1)})}getConfig(){const r={axis:this.axis},o=super.getConfig();return Object.assign(r,o),r}}CW.className="Concatenate",Mt(CW);function Zv(a,r){for(;a<0;)a+=r;return a}function Xme(a,r,o){if(a.shape.length>3||r.shape.length>3)throw new hi("batchDot is not implemented for tensors of 4D or higher rank yet");if(b(a.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${a.shape.length}`),b(a.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${r.shape.length}`),typeof o=="number"&&(o=[o,o]),a.dtype==="complex64"||r.dtype==="complex64")throw new hi("batchDot is not implemented for complex64-type Tensors yet.");const c=a.shape.length,h=r.shape.length;o==null&&(o=[c-1,h-2]);const f=o;return Qe(()=>{let m;if(c>h){m=c-h;const A=[];for(let w=0;w<m;++w)A.push(1);r=Xe(r,r.shape.concat(A))}else if(h>c){m=h-c;const A=[];for(let w=0;w<m;++w)A.push(1);a=Xe(a,a.shape.concat(A))}else m=0;let y;if(a.shape.length===2&&r.shape.length===2)f[0]===f[1]?y=Bn(Ue(a,r),f[0]):y=Bn(Ue(Li(a,[1,0]),r),f[1]);else{const A=f[0]!==a.shape.length-1,w=f[1]===r.shape.length-1;y=$i(a,r,A,w)}if(m>0){let A;c>h?A=c+h-3:A=c-1;const w=[];for(let C=A;C<A+m;++C)w.push(C);y=kv(y,w)}return y.shape.length===1&&(y=fa(y,1)),y})}class EW extends Mm{constructor(r){super(r),this.axes=r.axes,this.normalize=r.normalize==null?!1:r.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(r){b(Array.isArray(r)&&r.length===2&&Array.isArray(r[0])&&Array.isArray(r[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const o=r[0],c=r[1];if(o.length>3||c.length>3)throw new hi("Dot layer does not support tensors of 4D or higher rank yet.");const h=this.interpretAxes(o,c);if(o[h[0]]!==c[h[1]])throw new De(`Dimension incompatibility: ${o[h[0]]} !== ${c[h[1]]}`)}mergeFunction(r){if(r.length!==2)throw new De(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${r.length} input(s).`);let o=r[0],c=r[1],h;return Array.isArray(this.axes)?h=this.axes.map((f,m)=>Zv(f,r[m].shape.length)):h=[Zv(this.axes,o.shape.length),Zv(this.axes,c.shape.length)],this.normalize&&(o=eC(o,h[0]),c=eC(c,h[1])),Xme(o,c,h)}interpretAxes(r,o){let c;return Array.isArray(this.axes)?c=this.axes:c=[Zv(this.axes,r.length),Zv(this.axes,o.length)],c}computeOutputShape(r){b(Array.isArray(r)&&r.length===2&&Array.isArray(r[0])&&Array.isArray(r[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const o=r[0].slice(),c=r[1].slice();if(o.length>3||c.length>3)throw new hi("Dot layer does not support tensors of 4D or higher rank yet.");const h=this.interpretAxes(o,c);o.splice(h[0],1),c.splice(h[1],1),c.splice(0,1);const f=o.concat(c);return f.length===1&&f.push(1),f}computeMask(r,o){return null}getConfig(){const r={axes:this.axes,normalize:this.normalize},o=super.getConfig();return Object.assign(r,o),r}}EW.className="Dot",Mt(EW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class _W extends Ai{constructor(r){super(r),this.supportsMasking=!0,this.stddev=r.stddev}computeOutputShape(r){return r}getConfig(){const r=super.getConfig(),o={stddev:this.stddev};return Object.assign(o,r),o}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r);return Vv(()=>Ot(Kw(c.shape,0,this.stddev),c),()=>c,o.training||!1)})}}_W.className="GaussianNoise",Mt(_W);class IW extends Ai{constructor(r){super(r),this.supportsMasking=!0,this.rate=r.rate}computeOutputShape(r){return r}getConfig(){const r=super.getConfig(),o={rate:this.rate};return Object.assign(o,r),o}call(r,o){return Qe(()=>{this.invokeCallHook(r,o);const c=$n(r);return this.rate>0&&this.rate<1?Vv(()=>{const h=Math.sqrt(this.rate/(1-this.rate));return Ue(c,Kw(c.shape,1,h))},()=>c,o.training||!1):c})}}IW.className="GaussianDropout",Mt(IW);class SW extends Ai{constructor(r){super(r),this.supportsMasking=!0,this.rate=r.rate,this.noiseShape=r.noiseShape}_getNoiseShape(r){return this.noiseShape||$n(r).shape}computeOutputShape(r){return r}getConfig(){const r=super.getConfig(),o={rate:this.rate};return Object.assign(o,r),o}call(r,o){return Qe(()=>{if(this.rate<1&&this.rate>0){const c=this._getNoiseShape(r);return Vv(()=>{const h=$n(r),f=-1.6732632423543772*1.0507009873554805;let m=gm(Tv(c),this.rate);m=Zh(m,"float32");const y=((1-this.rate)*(1+this.rate*f**2))**-.5,A=-y*f*this.rate,w=Ot(Ue(h,m),Ue(Ot(m,-1),f));return Ot(Ue(w,y),A)},()=>$n(r),o.training||!1)}return r})}}SW.className="AlphaDropout",Mt(SW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function jv(a,r,o,c,h,f=.001){let m;if(a.rank===2)m=Eae(a,r,o,c,h,f);else if(a.rank===3)m=Iae(a,r,o,c,h,f);else if(a.rank===4)m=Tae(a,r,o,c,h,f);else throw new hi(`batchNormalization is not implemented for array of rank ${a.rank} yet`);return m}function $me(a,r,o,c,h=.001){return Qe(()=>{const f=VM(a,c),m=f.mean,y=f.variance;return[jv(a,m,y,o,r,h),m,y]})}function Qme(a,r,o,c,h=.001){return Qe(()=>{const f=VM(a,c),m=f.mean,y=f.variance,A=[];for(const B of Bc(0,a.rank))c.indexOf(B)!==-1?A.push(1):A.push(a.shape[B]);const w=Xe(m,A),C=Xe(y,A),_=r==null?null:Xe(r,A),T=o==null?null:Xe(o,A);return[jv(a,w,C,T,_,h),m,y]})}function Kme(a,r,o,c,h=.001){return R(c.slice().sort(),Bc(0,a.rank-1))?$me(a,r,o,c,h):Qme(a,r,o,c,h)}class TW extends Ai{constructor(r){r==null&&(r={}),super(r),this.supportsMasking=!0,this.axis=r.axis==null?-1:r.axis,this.momentum=r.momentum==null?.99:r.momentum,this.epsilon=r.epsilon==null?.001:r.epsilon,this.center=r.center==null?!0:r.center,this.scale=r.scale==null?!0:r.scale,this.betaInitializer=xr(r.betaInitializer||"zeros"),this.gammaInitializer=xr(r.gammaInitializer||"ones"),this.movingMeanInitializer=xr(r.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=xr(r.movingVarianceInitializer||"ones"),this.betaConstraint=xs(r.betaConstraint),this.gammaConstraint=xs(r.gammaConstraint),this.betaRegularizer=wr(r.betaRegularizer),this.gammaRegularizer=wr(r.gammaRegularizer)}build(r){r=Pi(r);const o=this.axis>=0?this.axis:this.axis+r.length,c=r[o];if(c==null)throw new De(`Axis ${o} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(r)}.`);this.inputSpec=[new vs({ndim:r.length,axes:{[o]:c}})];const h=[c];this.scale&&(this.gamma=this.addWeight("gamma",h,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",h,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",h,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",h,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(r,o){return Qe(()=>{const c=o.training==null?!1:o.training,h=$n(r),f=h.shape,m=f.length,y=Bc(0,m),A=this.axis>=0?this.axis:this.axis+m;y.splice(A,1);const w=Cm(1,m);w[A]=f[A];const C=y.slice();C.sort();const _=!R(C,Bc(0,m).slice(0,m-1)),T=()=>{if(_){const z=Xe(this.movingMean.read(),w),X=Xe(this.movingVariance.read(),w),re=this.center?Xe(this.beta.read(),w):null,se=this.scale?Xe(this.gamma.read(),w):null;return jv(h,z,X,re,se,this.epsilon)}else return jv(h,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!c)return T();const[B,O,U]=Kme(h,this.gamma.read(),this.beta.read(),y,this.epsilon),W=(z,X,re)=>{Qe(()=>{const se=1-re,le=z.read(),ge=Ue(Wn(le,X),se);z.write(Wn(le,ge))})};return W(this.movingMean,O,this.momentum),W(this.movingVariance,U,this.momentum),B})}getConfig(){const r={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mr(this.betaInitializer),gammaInitializer:Mr(this.gammaInitializer),movingMeanInitializer:Mr(this.movingMeanInitializer),movingVarianceInitializer:Mr(this.movingVarianceInitializer),betaRegularizer:rr(this.betaRegularizer),gammaRegularizer:rr(this.gammaRegularizer),betaConstraint:bs(this.betaConstraint),gammaConstraint:bs(this.gammaConstraint)},o=super.getConfig();return Object.assign(r,o),r}}TW.className="BatchNormalization",Mt(TW);class MW extends Ai{constructor(r){if(r==null&&(r={}),super(r),this.axis=r.axis==null?-1:r.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const o of this.axis)if(!Number.isInteger(o))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=r.epsilon==null?.001:r.epsilon,this.center=r.center==null?!0:r.center,this.scale=r.scale==null?!0:r.scale,this.betaInitializer=xr(r.betaInitializer||"zeros"),this.gammaInitializer=xr(r.gammaInitializer||"ones"),this.betaRegularizer=wr(r.betaRegularizer),this.gammaRegularizer=wr(r.gammaRegularizer),this.supportsMasking=!0}build(r){r=Pi(r);const o=r.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let f=0;f<this.axis.length;++f)this.axis[f]<0&&(this.axis[f]+=o);for(const f of this.axis)if(f<0||f>=o)throw new Error(`Invalid axis: ${f}`);if(this.axis.length!==yf(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const c=this.axis.map(f=>r[f]),h=!0;this.scale?this.gamma=this.addWeight("gamma",c,"float32",this.gammaInitializer,this.gammaRegularizer,h):this.gamma=null,this.center?this.beta=this.addWeight("beta",c,"float32",this.betaInitializer,this.betaRegularizer,h):this.beta=null,this.built=!0}call(r,o){const c=$n(r),h=c.shape,f=h.length;return Qe(()=>{let{mean:m,variance:y}=VM(c,this.axis,!0);const A=Cm(1,f);for(const O of this.axis)A[O]=h[O];const w=O=>O!=null&&O.shape.length!==f?Xe(O,A):O;let C=this.scale?w(this.gamma.read()):null,_=this.center?w(this.beta.read()):null;const T=[],B=[];for(let O=0;O<f;++O)this.axis.indexOf(O)!==-1?(T.push(h[O]),B.push(1)):(T.push(1),B.push(h[O]));return m=Rc(m,T),y=Rc(y,T),C!=null&&(C=Rc(C,B)),_!=null&&(_=Rc(_,B)),jv(c,m,y,_,C,this.epsilon)})}getConfig(){const r={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mr(this.betaInitializer),gammaInitializer:Mr(this.gammaInitializer),betaRegularizer:rr(this.betaRegularizer),gammaRegularizer:rr(this.gammaRegularizer)},o=super.getConfig();return Object.assign(r,o),r}}MW.className="LayerNormalization",Mt(MW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function Zme(a,r,o){return Qe(()=>{if(a.rank!==4)throw new De(`temporalPadding expects input tensor to be 4-D, but received a ${a.rank}-D tensor.`);if(r==null&&(r=[[1,1],[1,1]]),r.length!==2||r[0].length!==2||r[1].length!==2)throw new De("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(o==null&&(o=Pc()),o!=="channelsLast"&&o!=="channelsFirst")throw new De(`Unknown data format: ${o}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let c;return o==="channelsFirst"?c=[[0,0],[0,0],r[0],r[1]]:c=[[0,0],r[0],r[1],[0,0]],UM(a,c)})}class kW extends Ai{constructor(r){if(r==null&&(r={}),super(r),this.dataFormat=r.dataFormat==null?Pc():r.dataFormat,r.padding==null)this.padding=[[1,1],[1,1]];else if(typeof r.padding=="number")this.padding=[[r.padding,r.padding],[r.padding,r.padding]];else{if(r.padding=r.padding,r.padding.length!==2)throw new De(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${r.padding.length} array.`);let o,c;if(typeof r.padding[0]=="number")o=[r.padding[0],r.padding[0]],c=[r.padding[1],r.padding[1]];else{if(r.padding=r.padding,r.padding[0].length!==2)throw new De(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${r.padding[0].length} array.`);if(o=r.padding[0],r.padding[1].length!==2)throw new De(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${r.padding[1].length} array.`);c=r.padding[1]}this.padding=[o,c]}this.inputSpec=[new vs({ndim:4})]}computeOutputShape(r){r=Pi(r);let o,c;return this.dataFormat==="channelsFirst"?(r[2]!=null&&r[2]>=0?o=r[2]+this.padding[0][0]+this.padding[0][1]:o=null,r[3]!=null&&r[3]>=0?c=r[3]+this.padding[1][0]+this.padding[1][1]:c=null,[r[0],r[1],o,c]):(r[1]!=null&&r[1]>=0?o=r[1]+this.padding[0][0]+this.padding[0][1]:o=null,r[2]!=null&&r[2]>=0?c=r[2]+this.padding[1][0]+this.padding[1][1]:c=null,[r[0],o,c,r[3]])}call(r,o){return Qe(()=>Zme($n(r),this.padding,this.dataFormat))}getConfig(){const r={padding:this.padding,dataFormat:this.dataFormat},o=super.getConfig();return Object.assign(r,o),r}}kW.className="ZeroPadding2D",Mt(kW);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function dC(a,r,o,c,h,f){return Qe(()=>{$r(h),MG(f),vl(c),o==null&&(o=[1,1]),c==null&&(c="valid"),h==null&&(h=Pc()),f==null&&(f="max"),a=hR(a,h);let m;const y=c==="same"?"same":"valid";return f==="max"?m=OM(a,r,o,y):m=IM(a,r,o,y),h==="channelsFirst"&&(m=Li(m,[0,3,1,2])),m})}function RW(a,r,o,c,h,f){return Qe(()=>{$r(h),MG(f),vl(c),o==null&&(o=[1,1,1]),c==null&&(c="valid"),h==null&&(h=Pc()),f==null&&(f="max"),a=Q5(a,h);let m;const y=c==="same"?"same":"valid";return f==="max"?m=fce(a,r,o,y):m=pae(a,r,o,y),h==="channelsFirst"&&(m=Li(m,[0,4,1,2,3])),m})}class LW extends Ai{constructor(r){if(r.poolSize==null&&(r.poolSize=2),super(r),typeof r.poolSize=="number")this.poolSize=[r.poolSize];else if(Array.isArray(r.poolSize)&&r.poolSize.length===1&&typeof r.poolSize[0]=="number")this.poolSize=r.poolSize;else throw new De(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(r.poolSize)}`);if(Ds(this.poolSize,"poolSize"),r.strides==null)this.strides=this.poolSize;else if(typeof r.strides=="number")this.strides=[r.strides];else if(Array.isArray(r.strides)&&r.strides.length===1&&typeof r.strides[0]=="number")this.strides=r.strides;else throw new De(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(r.strides)}`);Ds(this.strides,"strides"),this.padding=r.padding==null?"valid":r.padding,vl(this.padding),this.inputSpec=[new vs({ndim:3})]}computeOutputShape(r){r=Pi(r);const o=Oc(r[1],this.poolSize[0],this.padding,this.strides[0]);return[r[0],o,r[2]]}call(r,o){return Qe(()=>{this.invokeCallHook(r,o),r=Fv($n(r),2);const c=this.poolingFunction($n(r),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return kv(c,[2])})}getConfig(){const r={poolSize:this.poolSize,padding:this.padding,strides:this.strides},o=super.getConfig();return Object.assign(r,o),r}}class BW extends LW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),dC(r,o,c,h,f,"max")}}BW.className="MaxPooling1D",Mt(BW);class PW extends LW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),dC(r,o,c,h,f,"avg")}}PW.className="AveragePooling1D",Mt(PW);class NW extends Ai{constructor(r){if(r.poolSize==null&&(r.poolSize=[2,2]),super(r),this.poolSize=Array.isArray(r.poolSize)?r.poolSize:[r.poolSize,r.poolSize],r.strides==null)this.strides=this.poolSize;else if(Array.isArray(r.strides)){if(r.strides.length!==2)throw new De(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${r.strides.length}.`);this.strides=r.strides}else this.strides=[r.strides,r.strides];Ds(this.poolSize,"poolSize"),Ds(this.strides,"strides"),this.padding=r.padding==null?"valid":r.padding,this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,$r(this.dataFormat),vl(this.padding),this.inputSpec=[new vs({ndim:4})]}computeOutputShape(r){r=Pi(r);let o=this.dataFormat==="channelsFirst"?r[2]:r[1],c=this.dataFormat==="channelsFirst"?r[3]:r[2];return o=Oc(o,this.poolSize[0],this.padding,this.strides[0]),c=Oc(c,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[r[0],r[1],o,c]:[r[0],o,c,r[3]]}call(r,o){return Qe(()=>(this.invokeCallHook(r,o),this.poolingFunction($n(r),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const r={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},o=super.getConfig();return Object.assign(r,o),r}}class DW extends NW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),dC(r,o,c,h,f,"max")}}DW.className="MaxPooling2D",Mt(DW);class FW extends NW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),dC(r,o,c,h,f,"avg")}}FW.className="AveragePooling2D",Mt(FW);class OW extends Ai{constructor(r){if(r.poolSize==null&&(r.poolSize=[2,2,2]),super(r),this.poolSize=Array.isArray(r.poolSize)?r.poolSize:[r.poolSize,r.poolSize,r.poolSize],r.strides==null)this.strides=this.poolSize;else if(Array.isArray(r.strides)){if(r.strides.length!==3)throw new De(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${r.strides.length}.`);this.strides=r.strides}else this.strides=[r.strides,r.strides,r.strides];Ds(this.poolSize,"poolSize"),Ds(this.strides,"strides"),this.padding=r.padding==null?"valid":r.padding,this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,$r(this.dataFormat),vl(this.padding),this.inputSpec=[new vs({ndim:5})]}computeOutputShape(r){r=Pi(r);let o=this.dataFormat==="channelsFirst"?r[2]:r[1],c=this.dataFormat==="channelsFirst"?r[3]:r[2],h=this.dataFormat==="channelsFirst"?r[4]:r[3];return o=Oc(o,this.poolSize[0],this.padding,this.strides[0]),c=Oc(c,this.poolSize[1],this.padding,this.strides[1]),h=Oc(h,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[r[0],r[1],o,c,h]:[r[0],o,c,h,r[4]]}call(r,o){return Qe(()=>(this.invokeCallHook(r,o),this.poolingFunction($n(r),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const r={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},o=super.getConfig();return Object.assign(r,o),r}}class VW extends OW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),RW(r,o,c,h,f,"max")}}VW.className="MaxPooling3D",Mt(VW);class UW extends OW{constructor(r){super(r)}poolingFunction(r,o,c,h,f){return $r(f),vl(h),RW(r,o,c,h,f,"avg")}}UW.className="AveragePooling3D",Mt(UW);class zW extends Ai{constructor(r){super(r),this.inputSpec=[new vs({ndim:3})]}computeOutputShape(r){return[r[0],r[2]]}call(r,o){throw new hi}}class GW extends zW{constructor(r){super(r||{})}call(r,o){return Qe(()=>{const c=$n(r);return is(c,1)})}}GW.className="GlobalAveragePooling1D",Mt(GW);class WW extends zW{constructor(r){super(r||{})}call(r,o){return Qe(()=>{const c=$n(r);return kc(c,1)})}}WW.className="GlobalMaxPooling1D",Mt(WW);class HW extends Ai{constructor(r){super(r),this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,$r(this.dataFormat),this.inputSpec=[new vs({ndim:4})]}computeOutputShape(r){return r=r,this.dataFormat==="channelsLast"?[r[0],r[3]]:[r[0],r[1]]}call(r,o){throw new hi}getConfig(){const r={dataFormat:this.dataFormat},o=super.getConfig();return Object.assign(r,o),r}}class XW extends HW{call(r,o){return Qe(()=>{const c=$n(r);return this.dataFormat==="channelsLast"?is(c,[1,2]):is(c,[2,3])})}}XW.className="GlobalAveragePooling2D",Mt(XW);class $W extends HW{call(r,o){return Qe(()=>{const c=$n(r);return this.dataFormat==="channelsLast"?kc(c,[1,2]):kc(c,[2,3])})}}$W.className="GlobalMaxPooling2D",Mt($W);/**
* @license
* Copyright 2018 Google LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class QW extends Ai{constructor(r){super(r),this.layer=r.layer}build(r){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(r){this.layer!=null&&(this.layer.trainable=r)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(r){this.layer.setWeights(r)}getConfig(){const r={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},o=super.getConfig();return Object.assign(r,o),r}setFastWeightInitDuringBuild(r){super.setFastWeightInitDuringBuild(r),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(r)}static fromConfig(r,o,c={}){const h=o.layer,f=jh(h,c);delete o.layer;const m={layer:f};return Object.assign(m,o),new r(m)}}class KW extends QW{constructor(r){super(r),this.supportsMasking=!0}build(r){if(r=Pi(r),r.length<3)throw new De(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(r)}`);this.inputSpec=[{shape:r}];const o=[r[0]].concat(r.slice(2));this.layer.built||(this.layer.build(o),this.layer.built=!0),super.build(r)}computeOutputShape(r){r=Pi(r);const o=[r[0]].concat(r.slice(2)),c=this.layer.computeOutputShape(o),h=r[1];return[c[0],h].concat(c.slice(1))}call(r,o){return Qe(()=>(r=$n(r),iW((c,h)=>[$n(this.layer.call(c,o)),[]],r,[],!1,null,null,!1,!0)[1]))}}KW.className="TimeDistributed",Mt(KW);function jme(a){_m(Ape,"BidirectionalMergeMode",a)}const Yme="concat";class ZW extends QW{constructor(r){super(r);const o=r.layer.getConfig(),c={};c.className=r.layer.getClassName(),c.config=o,this.forwardLayer=jh(c),o.goBackwards=o.goBackwards!==!0;const h={};if(h.className=r.layer.getClassName(),h.config=o,this.backwardLayer=jh(h),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=r.mergeMode===void 0?Yme:r.mergeMode,jme(this.mergeMode),r.weights)throw new hi("weights support is not implemented for Bidirectional layer yet.");this._stateful=r.layer.stateful,this.returnSequences=r.layer.returnSequences,this.returnState=r.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=r.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(r){this._trainable=r,this.forwardLayer!=null&&(this.forwardLayer.trainable=r),this.backwardLayer!=null&&(this.backwardLayer.trainable=r)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(r){const o=r.length,c=Math.floor(o/2);this.forwardLayer.setWeights(r.slice(0,c)),this.backwardLayer.setWeights(r.slice(c))}computeOutputShape(r){let o=this.forwardLayer.computeOutputShape(r);Array.isArray(o)&&Array.isArray(o[0])||(o=[o]),o=o;let c,h,f;return this.returnState&&(f=o.slice(1)),c=o[0],c=c,this.mergeMode==="concat"?(c[c.length-1]*=2,h=[c]):this.mergeMode==null?h=[c,c.slice()]:h=[c],this.returnState?this.mergeMode==null?h.concat(f).concat(f.slice()):[c].concat(f).concat(f.slice()):pa(h)}apply(r,o){let c=o==null?null:o.initialState,h=o==null?null:o.constants;o==null&&(o={});const f=nW(r,c,h,this.numConstants);if(r=f.inputs,c=f.initialState,h=f.constants,Array.isArray(r)&&(c=r.slice(1),r=r[0]),(c==null||c.length===0)&&h==null)return super.apply(r,o);const m=[],y=[];if(c!=null){const w=c.length;if(w%2>0)throw new De("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");o.initialState=c,m.push(...c);const C=c.map(_=>new vs({shape:_.shape}));this.forwardLayer.stateSpec=C.slice(0,w/2),this.backwardLayer.stateSpec=C.slice(w/2),y.push(...C)}if(h!=null)throw new hi("Support for constants in Bidirectional layers is not implemented yet.");const A=m[0]instanceof Vu;for(const w of m)if(w instanceof Vu!==A)throw new De("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(A){const w=[r].concat(m),C=this.inputSpec.concat(y),_=this.inputSpec;this.inputSpec=C;const T=super.apply(w,o);return this.inputSpec=_,T}else return super.apply(r,o)}call(r,o){return Qe(()=>{const c=o.initialState;let h,f;if(c==null)h=this.forwardLayer.call(r,o),f=this.backwardLayer.call(r,o);else{const A=c.slice(0,c.length/2),w=c.slice(c.length/2);h=this.forwardLayer.call(r,Object.assign(o,{initialState:A})),f=this.backwardLayer.call(r,Object.assign(o,{initialState:w}))}let m;this.returnState&&(Array.isArray(h)&&(m=h.slice(1).concat(f.slice(1))),h=h[0],f=f[0]),this.returnSequences&&(f=vm(f,1));let y;return this.mergeMode==="concat"?y=Vk([h,f]):this.mergeMode==="sum"?y=Ot(h,f):this.mergeMode==="ave"?y=Ue(.5,Ot(h,f)):this.mergeMode==="mul"?y=Ue(h,f):this.mergeMode==null&&(y=[h,f]),this.returnState?this.mergeMode==null?y.concat(m):[y].concat(m):y})}resetStates(r){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(r){Im(this.forwardLayer.name,()=>{this.forwardLayer.build(r)}),Im(this.backwardLayer.name,()=>{this.backwardLayer.build(r)}),this.built=!0}computeMask(r,o){Array.isArray(o)&&(o=o[0]);let c;if(this.returnSequences?this.mergeMode==null?c=[o,o]:c=o:this.mergeMode==null?c=[null,null]:c=null,this.returnState){const h=this.forwardLayer.states.map(f=>null);return Array.isArray(c)?c.concat(h).concat(h):[c].concat(h).concat(h)}else return c}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(r){super.setFastWeightInitDuringBuild(r),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(r),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(r)}getConfig(){const r={mergeMode:this.mergeMode},o=super.getConfig();return Object.assign(r,o),r}static fromConfig(r,o){const c=jh(o.layer);if(delete o.layer,o.numConstants!=null)throw new hi("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const h=o;return h.layer=c,new r(h)}}ZW.className="Bidirectional",Mt(ZW);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class jW extends Ai{constructor(r){super(r),this.scale=r.scale,r.offset?this.offset=r.offset:this.offset=0}getConfig(){const r={scale:this.scale,offset:this.offset},o=super.getConfig();return Object.assign(r,o),r}call(r,o){return Qe(()=>(r=$n(r),r.dtype!=="float32"&&(r=Zh(r,"float32")),Ot(Ue(r,this.scale),this.offset)))}}jW.className="Rescaling",Mt(jW);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const{resizeBilinear:qme,cropAndResize:Jme}=Xh;class YW extends Ai{constructor(r){super(r),this.height=r.height,this.width=r.width}centerCrop(r,o,c,h,f,m,y,A){return Qe(()=>{let w,C=!1;const _=o/m,T=c/y,B=(h+o)/m,O=(f+c)/y,U=[_,T,B,O],W=[];r.rank===3?(C=!0,w=Pu([r])):w=r;for(let se=0;se<w.shape[0];se++)W.push(U);const z=pl(W,[W.length,4]),X=Mv(0,W.length,1,"int32"),re=Jme(w,z,X,[h,f],"nearest");return Zh(C?$n(xm(re)):re,A)})}upsize(r,o,c,h){return Qe(()=>{const f=qme(r,[o,c]);return Zh(f,h)})}call(r,o){return Qe(()=>{const c=$n(r),h=c.dtype,f=c.shape,m=f[f.length-3],y=f[f.length-2];let A=0;m!==this.height&&(A=Math.floor((m-this.height)/2));let w=0;return y!==this.width&&(w=Math.floor((y-this.width)/2),w===0&&(w=1)),A>=0&&w>=0?this.centerCrop(c,A,w,this.height,this.width,m,y,h):this.upsize(r,this.height,this.width,h)})}getConfig(){const r={height:this.height,width:this.width},o=super.getConfig();return Object.assign(r,o),r}computeOutputShape(r){r=Pi(r);const o=r.length-3,c=r.length-2;return r[o]=this.height,r[c]=this.width,r}}YW.className="CenterCrop",Mt(YW);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/function ege(a,r,o,c){let h=$n(a);if(h.dtype!=="int32"&&(h=Zh(h,"int32")),r==="int")return h;const f=h.shape;if(h.rank===0&&(h=fa(h,-1)),r==="oneHot"&&h.shape[h.shape.length-1]!==1&&(h=fa(h,-1)),h.rank>2)throw new De(`When outputMode is not int, maximum output rank is 2 Received outputMode ${r} and input shape ${f} which would result in output rank ${h.rank}.`);const m=["multiHot","oneHot"].includes(r),y=h;let A;if(typeof c<"u"&&r==="count"?A=KU(y,c,o,m):A=KU(y,[],o,m),r!=="tfIdf")return A;if(c)return Ue(A,c);throw new De("When outputMode is 'tfIdf', weights must be provided.")}/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class qW extends Ai{constructor(r){super(r),this.numTokens=r.numTokens,r.outputMode?this.outputMode=r.outputMode:this.outputMode="multiHot"}getConfig(){const r={numTokens:this.numTokens,outputMode:this.outputMode},o=super.getConfig();return Object.assign(r,o),r}computeOutputShape(r){return r=Pi(r),r==null?[this.numTokens]:this.outputMode==="oneHot"&&r[r.length-1]!==1?(r.push(this.numTokens),r):(r[r.length-1]=this.numTokens,r)}call(r,o){return Qe(()=>{r=$n(r),r.dtype!=="int32"&&(r=Zh(r,"int32"));let c;if(typeof o.countWeights<"u"){if(this.outputMode!=="count")throw new De(`countWeights is not used when outputMode !== count.
              Received countWeights=${o.countWeights}`);c=$n(o.countWeights)}const h=kc(r),f=Lw(r),m=yl(this.numTokens,h).bufferSync().get(0),y=gm(f,0).bufferSync().get(0);if(!(m&&y))throw new De(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return ege(r,this.outputMode,this.numTokens,c)})}}qW.className="CategoryEncoding",Mt(qW);/**
* @license
* Copyright 2022 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const tge=["bilinear","nearest"],JW=new Set(tge);class e4 extends Ai{constructor(r){if(super(r),this.height=r.height,this.width=r.width,r.interpolation)if(JW.has(r.interpolation))this.interpolation=r.interpolation;else throw new De(`Invalid interpolation parameter: ${r.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!r.cropToAspectRatio}computeOutputShape(r){r=Pi(r);const o=r[2];return[this.height,this.width,o]}getConfig(){const r={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},o=super.getConfig();return Object.assign(r,o),r}call(r,o){return Qe(()=>{const c=[this.height,this.width];if(this.interpolation==="bilinear")return Xh.resizeBilinear(r,c,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Xh.resizeNearestNeighbor(r,c,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...JW]} are supported`)})}}e4.className="Resizing",Mt(e4);/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class t4{constructor(r){this.seed=r}next(){if(this.seed!==void 0)return this.seed++}}t4.className="RandomSeed";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/class n4 extends Ai{constructor(r){super(r),this.randomGenerator=new t4(r.seed)}getConfig(){const r={seed:this.randomGenerator.seed},o=super.getConfig();return Object.assign(r,o),r}}n4.className="BaseRandomLayer";/**
* @license
* Copyright 2023 CodeSmith LLC
*
* Use of this source code is governed by an MIT-style
* license that can be found in the LICENSE file or at
* https://opensource.org/licenses/MIT.
* =============================================================================
*/const nge=["bilinear","nearest"],i4=new Set(nge);class r4 extends n4{constructor(r){super(r);const{factor:o,interpolation:c="bilinear"}=r;if(this.factor=o,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new De(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new De(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new De(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(c)if(i4.has(c))this.interpolation=c;else throw new De(`Invalid interpolation parameter: ${c} is not implemented`)}getConfig(){const r={factor:this.factor,interpolation:this.interpolation},o=super.getConfig();return Object.assign(r,o),r}computeOutputShape(r){r=Pi(r);const o=r[2];return[this.imgHeight,-1,o]}call(r,o){return Qe(()=>{const c=$n(r);this.imgHeight=c.shape[c.shape.length-3];const h=c.shape[c.shape.length-2];this.widthFactor=Tv([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let f=this.widthFactor.dataSync()[0]*h;f=Math.round(f);const m=[this.imgHeight,f];switch(this.interpolation){case"bilinear":return Xh.resizeBilinear(r,m);case"nearest":return Xh.resizeNearestNeighbor(r,m);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...i4]} are supported`)}})}}r4.className="RandomWidth",Mt(r4);/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/Te().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,a=>{a&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var s4;(function(a){a[a.DT_INVALID=0]="DT_INVALID",a[a.DT_FLOAT=1]="DT_FLOAT",a[a.DT_DOUBLE=2]="DT_DOUBLE",a[a.DT_INT32=3]="DT_INT32",a[a.DT_UINT8=4]="DT_UINT8",a[a.DT_INT16=5]="DT_INT16",a[a.DT_INT8=6]="DT_INT8",a[a.DT_STRING=7]="DT_STRING",a[a.DT_COMPLEX64=8]="DT_COMPLEX64",a[a.DT_INT64=9]="DT_INT64",a[a.DT_BOOL=10]="DT_BOOL",a[a.DT_QINT8=11]="DT_QINT8",a[a.DT_QUINT8=12]="DT_QUINT8",a[a.DT_QINT32=13]="DT_QINT32",a[a.DT_BFLOAT16=14]="DT_BFLOAT16",a[a.DT_QINT16=15]="DT_QINT16",a[a.DT_QUINT16=16]="DT_QUINT16",a[a.DT_UINT16=17]="DT_UINT16",a[a.DT_COMPLEX128=18]="DT_COMPLEX128",a[a.DT_HALF=19]="DT_HALF",a[a.DT_RESOURCE=20]="DT_RESOURCE",a[a.DT_VARIANT=21]="DT_VARIANT",a[a.DT_UINT32=22]="DT_UINT32",a[a.DT_UINT64=23]="DT_UINT64",a[a.DT_FLOAT_REF=101]="DT_FLOAT_REF",a[a.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",a[a.DT_INT32_REF=103]="DT_INT32_REF",a[a.DT_UINT8_REF=104]="DT_UINT8_REF",a[a.DT_INT16_REF=105]="DT_INT16_REF",a[a.DT_INT8_REF=106]="DT_INT8_REF",a[a.DT_STRING_REF=107]="DT_STRING_REF",a[a.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",a[a.DT_INT64_REF=109]="DT_INT64_REF",a[a.DT_BOOL_REF=110]="DT_BOOL_REF",a[a.DT_QINT8_REF=111]="DT_QINT8_REF",a[a.DT_QUINT8_REF=112]="DT_QUINT8_REF",a[a.DT_QINT32_REF=113]="DT_QINT32_REF",a[a.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",a[a.DT_QINT16_REF=115]="DT_QINT16_REF",a[a.DT_QUINT16_REF=116]="DT_QUINT16_REF",a[a.DT_UINT16_REF=117]="DT_UINT16_REF",a[a.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",a[a.DT_HALF_REF=119]="DT_HALF_REF",a[a.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",a[a.DT_VARIANT_REF=121]="DT_VARIANT_REF",a[a.DT_UINT32_REF=122]="DT_UINT32_REF",a[a.DT_UINT64_REF=123]="DT_UINT64_REF"})(s4||(s4={}));var o4;(function(a){(function(r){r[r.LEGACY=0]="LEGACY",r[r.V1=1]="V1",r[r.V2=2]="V2"})(a.CheckpointFormatVersion||(a.CheckpointFormatVersion={}))})(o4||(o4={}));/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*
* =============================================================================
*/var a4;(function(a){a[a.FAIL=0]="FAIL",a[a.SHORTEST=1]="SHORTEST",a[a.LONGEST=2]="LONGEST"})(a4||(a4={}));/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wn(a,r){Array.isArray(a)||(a=[a]),a.forEach(o=>{o!=null&&b(o.dtype!=="complex64",()=>`${r} does not support complex64 tensors in the CPU backend.`)})}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ige=Cz;class fC extends s{nextDataId(){return fC.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new i(this,cr())}write(r,o,c){this.firstUse&&(this.firstUse=!1,Te().get("IS_NODE")&&Ks(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const h={id:this.nextDataId()};return this.data.set(h,{values:r,dtype:c,refCount:1}),h}makeTensorInfo(r,o,c){let h;if(o==="string"&&c!=null&&c.length>0&&we(c[0])){const f=c.map(m=>Tu(m));h=this.write(f,r,o)}else h=this.write(c,r,o);return{dataId:h,shape:r,dtype:o}}refCount(r){return this.data.has(r)?this.data.get(r).refCount:0}incRef(r){const o=this.data.get(r);o.refCount++}decRef(r){if(this.data.has(r)){const o=this.data.get(r);o.refCount--}}move(r,o,c,h,f){this.data.set(r,{values:o,dtype:h,refCount:f})}numDataIds(){return this.data.numDataIds()}async read(r){return this.readSync(r)}readSync(r){const{dtype:o,complexTensorInfos:c}=this.data.get(r);if(o==="complex64"){const h=this.readSync(c.real.dataId),f=this.readSync(c.imag.dataId);return $h(h,f)}return Wt(this.data.get(r).values,o)}bufferSync(r){const o=this.readSync(r.dataId);if(r.dtype==="string")try{const c=o.map(h=>Tc(h));return yi(r.shape,r.dtype,c)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yi(r.shape,r.dtype,o)}makeOutput(r,o,c){return cr().makeTensorFromTensorInfo(this.makeTensorInfo(o,c,r),this)}disposeData(r,o=!1){if(this.data.has(r)){if(this.data.get(r).refCount--,!o&&this.data.get(r).refCount>0)return!1;const{complexTensorInfos:c}=this.data.get(r);c!=null&&(this.disposeData(c.real.dataId,!0),this.disposeData(c.imag.dataId,!0)),this.data.delete(r)}return!0}disposeIntermediateTensorInfo(r){this.disposeData(r.dataId)}async time(r){const o=ho();return r(),{kernelMs:ho()-o}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(r){wn([r],"where");const o=this.readSync(r.dataId);return ige(r.shape,o)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}fC.nextDataId=0;/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function l4(a){const r=new Float32Array(a.length);for(let o=0;o<a.length;++o)r[o]=Math.abs(a[o]);return r}const rge={kernelName:We,backendName:"cpu",kernelFunc:a=>{const{x:r}=a.inputs,o=a.backend;wn(r,"abs");let c=new Float32Array(M(r.shape));const h=o.data.get(r.dataId).values;return c=l4(h),o.makeOutput(c,r.shape,r.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qr(a){return(r,o,c,h,f)=>{const m=si(r,o),y=m.length,A=Ie(m),w=M(m),C=K(f,w),_=r.length,T=o.length,B=Ie(r),O=Ie(o),U=R0(r,m),W=R0(o,m);if(U.length+W.length===0)for(let z=0;z<C.length;++z)C[z]=a(c[z%c.length],h[z%h.length]);else for(let z=0;z<C.length;++z){const X=It(z,y,A),re=X.slice(-_);U.forEach(ye=>re[ye]=0);const se=Ze(re,_,B),le=X.slice(-T);W.forEach(ye=>le[ye]=0);const ge=Ze(le,T,O);C[z]=a(c[se],h[ge])}return[C,m]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wa(a){const{inputs:r,backend:o}=a,{real:c,imag:h}=r,f=o.data.get(c.dataId).values,m=o.data.get(h.dataId).values,y=o.makeTensorInfo(c.shape,"complex64"),A=o.data.get(y.dataId);return A.complexTensorInfos={real:o.makeTensorInfo(c.shape,"float32",f),imag:o.makeTensorInfo(h.shape,"float32",m)},y}const sge={kernelName:ar,backendName:"cpu",kernelFunc:Wa};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pC(a,r,o="float32"){if(o==="complex64"){const h=pC(a,r,"float32"),f=pC(a,r,"float32");return Wa({inputs:{real:h,imag:f},backend:a})}const c=At(M(r),o);return a.makeTensorInfo(r,o,c)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zu(a){const{inputs:r,backend:o}=a,{x:c}=r;return o.incRef(c.dataId),{dataId:c.dataId,shape:c.shape,dtype:c.dtype}}const oge={kernelName:hs,backendName:"cpu",kernelFunc:zu};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function km(a){const{inputs:r,backend:o}=a,{input:c}=r,h=o.data.get(c.dataId).complexTensorInfos.real,f=o.data.get(h.dataId).values;return o.makeTensorInfo(h.shape,h.dtype,f)}const age={kernelName:vu,backendName:"cpu",kernelFunc:km};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c4(a,r,o,c){if(c==="int32"){const h=Int32Array.from(a);return[r,"int32",h]}if(c==="bool"){const h=Uh([0],o),[f,m]=Qr((y,A)=>y!==A?1:0)(r,[],a,h,"bool");return[m,"bool",f]}throw new Error(`Error in Cast: failed to cast ${o} to ${c}`)}function _f(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{dtype:f}=c;if(f==="complex64"){if(h.dtype==="complex64")return zu({inputs:{x:h},backend:o});const C=pC(o,h.shape,h.dtype),_=_f({inputs:{x:h},backend:o,attrs:{dtype:"float32"}}),T=Wa({inputs:{real:_,imag:C},backend:o});return o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(_),T}if(h.dtype==="complex64"){const C=km({inputs:{input:h},backend:o}),_=_f({inputs:{x:C},backend:o,attrs:{dtype:f}});return o.disposeIntermediateTensorInfo(C),_}if(!ee(h.dtype,f)){const C=zu({inputs:{x:h},backend:o});return{dataId:C.dataId,shape:C.shape,dtype:f}}const m=o.data.get(h.dataId).values,[y,A,w]=c4(m,h.shape,h.dtype,f);return o.makeTensorInfo(y,A,w)}const lge={kernelName:Jt,backendName:"cpu",kernelFunc:_f};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ws(a,r,o,c){return o==null?({inputs:h,backend:f})=>{const{a:m,b:y}=h,A=f;wn([m,y],a);const w=A.data.get(m.dataId).values,C=A.data.get(y.dataId).values,_=m.dtype==="string"?Qh(w):w,T=m.dtype==="string"?Qh(C):C,B=c||m.dtype,[O,U]=r(m.shape,y.shape,_,T,B);return A.makeTensorInfo(U,B,O)}:({inputs:h,backend:f})=>{const{a:m,b:y}=h,A=f;if(m.dtype==="complex64"||y.dtype==="complex64"){const w=_f({inputs:{x:m},backend:A,attrs:{dtype:"complex64"}}),C=A.data.get(w.dataId),_=C.complexTensorInfos.real,T=C.complexTensorInfos.imag,B=A.data.get(_.dataId).values,O=A.data.get(T.dataId).values,U=_f({inputs:{x:y},backend:A,attrs:{dtype:"complex64"}}),W=A.data.get(U.dataId),z=W.complexTensorInfos.real,X=W.complexTensorInfos.imag,re=A.data.get(z.dataId).values,se=A.data.get(X.dataId).values,[le,ge,ye]=o(m.shape,y.shape,B,O,re,se),be=A.makeTensorInfo(ye,"float32",le),Se=A.makeTensorInfo(ye,"float32",ge),Be=Wa({inputs:{real:be,imag:Se},backend:A});return A.disposeIntermediateTensorInfo(w),A.disposeIntermediateTensorInfo(U),A.disposeIntermediateTensorInfo(be),A.disposeIntermediateTensorInfo(Se),Be}else{const w=A.data.get(m.dataId).values,C=A.data.get(y.dataId).values,_=c||m.dtype,[T,B]=r(m.shape,y.shape,w,C,_);return A.makeTensorInfo(B,_,T)}}}function yR(a){return(r,o,c,h,f,m)=>{const y=si(r,o),A=M(y),w=y.length,C=Ie(y),_=K("float32",A),T=K("float32",A),B=R0(r,y),O=R0(o,y),U=$h(c,h),W=$h(f,m),z=r.length,X=Ie(r),re=o.length,se=Ie(o);if(B.length+O.length===0)for(let le=0;le<_.length;le++){const ge=le%U.length,ye=le%W.length,be=a(U[ge*2],U[ge*2+1],W[ye*2],W[ye*2+1]);_[le]=be.real,T[le]=be.imag}else for(let le=0;le<_.length;le++){const ge=It(le,w,C),ye=ge.slice(-z);B.forEach(et=>ye[et]=0);const be=Ze(ye,z,X),Se=ge.slice(-re);O.forEach(et=>Se[et]=0);const Be=Ze(Se,re,se),Ye=a(U[be*2],U[be*2+1],W[Be*2],W[Be*2+1]);_[le]=Ye.real,T[le]=Ye.imag}return[_,T,y]}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const u4=Qr((a,r)=>a+r),cge=yR((a,r,o,c)=>({real:a+o,imag:r+c})),W0=ws(ve,u4,cge),uge={kernelName:ve,backendName:"cpu",kernelFunc:W0};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AR(a,r,o,c,h){const f=M(c),m=At(h,o);for(let y=0;y<a.length;y++){const A=a[y];if(A<0)throw new Error("Input x must be non-negative!");A>=h||(f>0?m[A]+=r[y]:m[A]+=1)}return m}function h4(a,r,o,c=!1){const h=a.shape[0],f=a.shape[1],m=yi([h,o],r.dtype);for(let y=0;y<h;y++)for(let A=0;A<f;A++){const w=a.get(y,A);if(w<0)throw new Error("Input x must be non-negative!");w>=o||(c?m.set(1,y,w):r.size>0?m.set(m.get(y,w)+r.get(y,A),y,w):m.set(m.get(y,w)+1,y,w))}return m}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const d4=Qr((a,r)=>a&r),hge=ws(sn,d4),dge={kernelName:sn,backendName:"cpu",kernelFunc:hge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Gu(a){return(r,o,c)=>{const h=Q(o,r.length);for(let f=0;f<r.length;++f)h[f]=a(r[f],c);return h}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Yi(a,r,o){const c=Gu(r);return If(a,c,o)}function If(a,r,o){return({inputs:c,attrs:h,backend:f})=>{const{x:m}=c;wn(m,a);const y=f,A=y.data.get(m.dataId).values;let w;if(m.dtype==="string"){if(!Array.isArray(A))throw new Error("String tensor's value was not an instance of Array");w=Qh(A)}else w=A;const C=o||m.dtype,_=r(w,C,h);return y.makeTensorInfo(m.shape,C,_)}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const f4=Gu(a=>Math.ceil(a)),fge=If(fn,f4),pge={kernelName:fn,backendName:"cpu",kernelFunc:fge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function p4(a,r,o,c){const h=Q(o,M(r));if(c&&o!=="string"){let f=0;a.forEach(m=>{const y=M(m.shape);h.set(m.vals,f),f+=y})}else{let f=0;a.forEach(m=>{const y=o==="string"?Qh(m.vals):m.vals;let A=0;for(let w=0;w<m.shape[0];++w){const C=w*r[1]+f;for(let _=0;_<m.shape[1];++_)h[C+_]=y[A++]}f+=m.shape[1]})}return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const m4=Qr((a,r)=>a===r?1:0),g4=ws(Ln,m4,null,"bool"),mge={kernelName:Ln,backendName:"cpu",kernelFunc:g4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y4=Gu(a=>Math.exp(a)),A4=If(Sn,y4,"float32"),gge={kernelName:Sn,backendName:"cpu",kernelFunc:A4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v4=Gu(a=>Math.expm1(a)),yge=If(gn,v4),Age={kernelName:gn,backendName:"cpu",kernelFunc:yge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const b4=Gu(a=>Math.floor(a)),vge=If(Yn,b4),bge={kernelName:Yn,backendName:"cpu",kernelFunc:vge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const x4=Qr((a,r)=>Math.floor(a/r)),xge=ws(Ht,x4,null,"int32"),wge={kernelName:Ht,backendName:"cpu",kernelFunc:xge};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function w4(a,r,o,c,h,f,m,y,A){const w=yi([c,f],o);for(let C=0;C<c;C++){const _=[];let T=0;for(let B=0;B<h;B++){const O=a[C*h+B];T+=O*m[B],_.push(O)}if(T<0||T>=A/f)throw new Error(`Invalid indices: ${_} does not index into ${y}`);for(let B=0;B<f;B++)w.values[C*f+B]=r.get(...r.indexToLoc(T*f+B))}return w}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C4(a,r,o){const c=yi(o,a.dtype);for(let h=0;h<c.size;++h){const f=c.indexToLoc(h).slice(),m=f[0],y=f[2],A=r.locToIndex([m,y]);f[2]=r.values[A];const w=a.locToIndex(f);0<=w&&w<a.values.length&&(c.values[h]=a.values[w])}return c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const E4=Qr((a,r)=>a>r?1:0),Cge=ws(Oi,E4,null,"bool"),Ege={kernelName:Oi,backendName:"cpu",kernelFunc:Cge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _4=Qr((a,r)=>a>=r?1:0),_ge=ws(Jr,_4,null,"bool"),Ige={kernelName:Jr,backendName:"cpu",kernelFunc:_ge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const I4=Qr((a,r)=>a<r?1:0),Sge=ws(fs,I4,null,"bool"),Tge={kernelName:fs,backendName:"cpu",kernelFunc:Sge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S4=Qr((a,r)=>a<=r?1:0),Mge=ws(Ba,S4,null,"bool"),kge={kernelName:Ba,backendName:"cpu",kernelFunc:Mge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function T4(a,r,o){const c=(r-a)/(o-1),h=At(o,"float32");h[0]=a;for(let f=1;f<h.length;f++)h[f]=h[f-1]+c;return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const M4=Gu(a=>Math.log(a)),Rge=If(cl,M4),Lge={kernelName:cl,backendName:"cpu",kernelFunc:Rge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function k4(a,r,o,c){const h=K(c,M(o));for(let f=0;f<h.length;++f){const m=f*r;let y=a[m];for(let A=0;A<r;++A){const w=a[m+A];(Number.isNaN(w)||w>y)&&(y=w)}h[f]=y}return h}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const R4=Qr((a,r)=>Math.max(a,r)),Bge=ws(ki,R4),Pge={kernelName:ki,backendName:"cpu",kernelFunc:Bge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const L4=Qr((a,r)=>Math.min(a,r)),Nge=ws(mr,L4),Dge={kernelName:mr,backendName:"cpu",kernelFunc:Nge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vR=Qr((a,r)=>a*r),Fge=yR((a,r,o,c)=>({real:a*o-r*c,imag:a*c+r*o})),mC=ws(Mo,vR,Fge),Oge={kernelName:Mo,backendName:"cpu",kernelFunc:mC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B4(a,r,o){const c=Br(-1,o);return vR([],r,c,a,o)}function Vge(a){const{inputs:r,backend:o}=a,{x:c}=r;wn(c,"neg");const h=o.data.get(c.dataId).values,[f,m]=B4(h,c.shape,c.dtype);return o.makeTensorInfo(m,c.dtype,f)}const Uge={kernelName:mu,backendName:"cpu",kernelFunc:Vge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const P4=Qr((a,r)=>a!==r?1:0),zge=ws(gu,P4,null,"bool"),Gge={kernelName:gu,backendName:"cpu",kernelFunc:zge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bR(a,r,o,c,h){const f=r.length,m=M(r),y=Ie(r),A=Ie(h),w=K(o,M(h));for(let C=0;C<m;++C){const _=It(C,f,y),T=new Array(_.length);for(let O=0;O<T.length;O++)T[O]=_[c[O]];const B=Ze(T,f,A);w[B]=a[C]}return w}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ga(a){const{inputs:r,attrs:o,backend:c}=a,{x:h}=r,{perm:f}=o;wn(h,"transpose");const m=h.shape.length,y=new Array(m);for(let C=0;C<y.length;C++)y[C]=h.shape[f[C]];const A=c.data.get(h.dataId).values,w=bR(A,h.shape,h.dtype,f,y);return{dataId:c.write(w,y,h.dtype),shape:y,dtype:h.dtype}}const Wge={kernelName:ef,backendName:"cpu",kernelFunc:ga};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N4(a,r,o,c){const[h,f]=Ps(a,c),m=Ua(r,"int32"),y=At(M(h),m),A=M(f);for(let w=0;w<y.length;++w){const C=w*A;let _=1;for(let T=0;T<A;++T)_*=o[C+T];y[w]=_}return{outVals:y,outShape:h,outDtype:m}}function Hge(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;wn(h,"prod");const y=h.shape.length,A=q(f,h.shape),w=Tr(A,y);let C=A,_=h;const T=[];w!=null&&(_=ga({inputs:{x:h},backend:o,attrs:{perm:w}}),T.push(_),C=Hr(C.length,y));const B=o.data.get(_.dataId).values,{outVals:O,outShape:U,outDtype:W}=N4(_.shape,_.dtype,B,C);let z=U;return m&&(z=ns(U,A)),T.forEach(X=>o.disposeIntermediateTensorInfo(X)),o.makeTensorInfo(z,W,O)}const Xge={kernelName:kh,backendName:"cpu",kernelFunc:Hge};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $ge(a,r,o){a.forEach((c,h)=>{if(c<0||c>=o){const f=It(h,r.length,Ie(r)).join(",");throw new Error(`indices[${f}] = ${c} is not in [0, ${o})`)}})}function Qge(a,r){for(let o=0;o<a.length;++o){const c=a[o],h=o===a.length-1?r:a[o+1].length;if(c.length===0)throw new Error("Ragged splits may not be empty");if(c[0]<0)throw new Error("Ragged splits must be non-negative");if(c[c.length-1]>h)throw new Error("Ragged splits must not point past values");for(let f=1;f<c.length;++f)if(c[f-1]>c[f])throw new Error("Ragged splits must be sorted in ascending order")}}function Kge(a,r,o,c){const h=[];let f=0;const m=r.length-1+o.length,y=new Array(m).fill(null).map(()=>[0]);Qge(o,c);let A=1;for(let w=0;w<r.length-1;++w){A*=r[w];const C=r[w+1];for(let _=1;_<A+1;++_)y[w].push(_*C)}for(let w=0;w<a.length;++w){let C=a[w],_=a[w]+1;for(let T=0;T<o.length;++T){const B=o[T],O=T+r.length-1;if(O>=0){const U=y[O],W=U[U.length-1]-B[C];for(let z=C;z<_;++z)y[O].push(B[z+1]+W)}C=B[C],_=B[_]}_!==C&&(h.push([C,_]),f+=_-C)}return{outSplits:y,valueSlices:h,numValues:f}}function Zge(a){const r=[];for(let o=0;o<a.length;++o){const c=a[o].length,h=Q("int32",c);r.push(h),a[o].forEach((f,m)=>h[m]=f)}return r}function D4(a,r){const o=a.slice(0,r);for(;o.length<r;)o.push(1);for(let c=r;c<a.length;c++)o[r-1]*=a[c];return o}function jge(a,r,o,c,h,f){const m=D4(r,2)[1],y=D4(f,2)[1];let A=0;for(const w of o)for(let C=w[0];C<w[1];++C){for(let _=0;_<c;++_)h[A*y+_]=a[C*m+_];++A}}function Yge(a,r,o,c,h){const f=r.slice();f[0]=h;const m=Q(o,M(f)),y=a.length,A=y===0?0:y/r[0];return jge(a,r,c,A,m,f),[m,f]}function F4(a,r,o,c,h,f,m,y){if(a.length===0)throw new Error("paramsNestedSplits must be non empty");if(r[0].length===0)throw new Error("Split tensors must not be scalars");const A=r[0][0]-1;if($ge(f,m,A),c.length===0)throw new Error("params.rank must be nonzero");const w=c[0],{outSplits:C,valueSlices:_,numValues:T}=Kge(f,m,a,w),B=Zge(C),O=Yge(o,c,h,_,T);return[B,O[0],O[1]]}/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const O4=2147483647;function V4(a,r,o,c,h,f,m){if(r.length>1)throw new Error("starts must be a scalar or vector");if(h.length>1)throw new Error("limits must be a scalar or vector");if(m.length>1)throw new Error("deltas must be a scalar or vector");const y=r.length===0,A=h.length===0,w=m.length===0,C=[];y||C.push(r[0]),A||C.push(h[0]),w||C.push(m[0]);for(let W=1;W<C.length;++W)if(C[W]!==C[W-1])throw new Error("starts, limits, and deltas must have the same shape");const _=C.length===0?1:C[0],T=Q("int32",_+1);T[0]=0;for(let W=0;W<_;++W){const z=y?a[0]:a[W],X=A?c[0]:c[W],re=w?f[0]:f[W];if(re===0)throw new Error("Requires delta != 0");let se;if(re>0&&X<z||re<0&&X>z)se=0;else if(se=Math.ceil(Math.abs((X-z)/re)),se>O4)throw new Error(`Requires ((limit - start) / delta) <= ${O4}`);T[W+1]=T[W]+se}const B=T[_],O=Q(o,B);let U=0;for(let W=0;W<_;++W){const z=T[W+1]-T[W];let X=y?a[0]:a[W];const re=w?f[0]:f[W];for(let se=0;se<z;++se)O[U++]=X,X+=re}return[T,O]}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var Yl=Lc;class gC{constructor(r,o,c,h,f,m,y,A,w,C){this.shape=r,this.shapeShape=o,this.values=c,this.valuesShape=h,this.valuesDType=f,this.defaultValue=m,this.defaultValueShape=y,this.rowPartitionValues=A,this.rowPartitionValuesShapes=w,this.rowPartitionTypes=Xz(C),this.raggedRank=$z(this.rowPartitionTypes)}getRowPartitionTypeByDimension(r){return this.rowPartitionTypes[0]===Yl.FIRST_DIM_SIZE?this.rowPartitionTypes[r+1]:this.rowPartitionTypes[r]}getRowPartitionTensor(r){return this.rowPartitionTypes[0]===Yl.FIRST_DIM_SIZE?this.rowPartitionValues[r+1]:this.rowPartitionValues[r]}getMaxWidth(r){const o=this.getRowPartitionTensor(r-1);switch(this.getRowPartitionTypeByDimension(r-1)){case Yl.VALUE_ROWIDS:return gC.getMaxWidthValueRowID(o);case Yl.ROW_SPLITS:return gC.getMaxWidthRowSplit(o);default:throw new Error(`Cannot handle partition type ${Yl[this.getRowPartitionTypeByDimension(r-1)]}`)}}static getMaxWidthRowSplit(r){const o=r.length;if(o===0||o===1)return 0;let c=0;for(let h=0;h<o-1;++h){const f=r[h+1]-r[h];f>c&&(c=f)}return c}static getMaxWidthValueRowID(r){const o=r.length;if(o===0)return 0;let c=0,h=r[0],f=0;for(let m=1;m<o;++m){const y=r[m];y!==h&&(h=y,f=Math.max(m-c,f),c=m)}return Math.max(o-c,f)}tensorShapeFromTensor(r,o,c=!0){if(o.length===0){if(r[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return z4(r,c)}calculateOutputSize(r){const o=this.valuesShape,c=this.defaultValueShape;Qz(c,o);const h=this.tensorShapeFromTensor(this.shape,this.shapeShape),f=Hz(this.raggedRank,h,o);f[0]<0&&(f[0]=r);for(let m=1;m<=this.raggedRank;++m)f[m]<0&&(f[m]=this.getMaxWidth(m));return f}calculateFirstParentOutputIndex(r,o,c){const h=Math.min(r,c),f=[];let m=0;for(let y=0;y<h;++y,m+=o)f.push(m);for(let y=h;y<r;++y)f.push(-1);return b(f.length===r,()=>"Final length of result must be equal to firstDimension."),f}calculateOutputIndexRowSplit(r,o,c,h){const f=r.length,m=[];for(let y=0;y<f-1;++y){const A=r[y+1]-r[y];let w=Math.min(h,A),C=o[y];C===-1&&(w=0);for(let _=0;_<w;++_)m.push(C),C+=c;for(let _=0;_<A-w;++_)m.push(-1)}if(f>0&&m.length!==r[f-1])throw new Error("Invalid row split size.");return m}calculateOutputIndexValueRowID(r,o,c,h){const f=r.length,m=[];if(f===0)return[];let y=0,A=r[0];if(A>=o.length)throw new Error(`Got currentValueRowId=${A}, which is not less than ${o.length}`);let w=o[A];m.push(w);for(let C=1;C<f;++C){const _=r[C];if(_===A)w>=0&&(++y,y<h?w+=c:w=-1);else{if(y=0,A=_,_>=o.length)throw new Error(`Got nextValueRowId=${_} which is not less than ${o.length}`);w=o[_]}m.push(w)}if(m.length!==r.length)throw new Error("Invalid row ids.");return m}calculateOutputIndex(r,o,c,h){const f=this.getRowPartitionTensor(r),m=this.getRowPartitionTypeByDimension(r);switch(m){case Yl.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(f,o,c,h);case Yl.ROW_SPLITS:if(f.length-1>o.length)throw new Error(`Row partition size is greater than output size: ${f.length-1} > ${o.length}`);return this.calculateOutputIndexRowSplit(f,o,c,h);default:throw new Error(`Unsupported partition type: ${Yl[m]}`)}}getFirstDimensionSize(){const r=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const o=this.rowPartitionTypes[0];switch(o){case Yl.FIRST_DIM_SIZE:return r[0];case Yl.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Yl.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Yl[o]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const r=this.getFirstDimensionSize(),o=this.calculateOutputSize(r),c=new Array(this.raggedRank+1);c[c.length-1]=1;for(let m=c.length-2;m>=0;--m)c[m]=c[m+1]*o[m+1];const h=z4(o,!1),f=Q(this.valuesDType,M(h));if(c[0]*o[0]>0){let m=this.calculateFirstParentOutputIndex(r,c[0],o[0]);for(let y=1;y<=this.raggedRank;++y)m=this.calculateOutputIndex(y-1,m,c[y],o[y]);this.setOutput(this.raggedRank,m,f,h)}return[h,f]}setOutput(r,o,c,h){if(c.length===0)return;const f=this.values,m=c;let y=h.slice();y=y.slice(r+1);const A=M(y),w=o.length;let C=this.defaultValue;if(C.length!==A&&C.length!==1){const O=this.defaultValueShape;Qe(()=>{const U=Xe(C,O);C=Ev(U,y).dataSync()})}let _=0,T=0,B=0;for(let O=0;O<=w;++O){let U=O<w?o[O]:-1;if(U===B){++B;continue}if(T<B){const W=f.subarray(_*A),z=m.subarray(T*A),X=(B-T)*A;U4(z,W,X)}if(O>=w){const W=c.length;U=Math.floor(W/A)}if(U>B)if(this.defaultValue.length===1)m.subarray(B*A,U*A).fill(this.defaultValue[0]),B=U;else for(;U>B;){const W=m.slice(B*A);U4(W,C,A),++B}U<0?(_=O+1,T=B):(_=O,T=B,B=T+1)}}}function U4(a,r,o){for(let c=0;c<o;c++)a[c]=r[c]}function z4(a,r){const o=[];for(let c of a){if(c<0){if(!r)throw new Error(`Dimension ${c} must be >= 0`);if(c<-1)throw new Error(`Dimension ${c} must be >= -1`);c=-1}o.push(c)}return o}function G4(a,r,o,c,h,f,m,y,A,w){return new gC(a,r,o,c,h,f,m,y,A,w).compute()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function W4(a,r,o,c){const h=a===r,f=a<r&&o<0,m=r<a&&o>1;if(h||f||m)return At(0,c);const y=Math.abs(Math.ceil((r-a)/o)),A=At(y,c);r<a&&o===1&&(o=-1),A[0]=a;for(let w=1;w<A.length;w++)A[w]=A[w-1]+o;return A}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const H4=Gu(a=>1/Math.sqrt(a)),qge=If(Cu,H4),Jge={kernelName:Cu,backendName:"cpu",kernelFunc:qge};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Rm(a,r,o,c,h,f,m,y,A,w){const C=[c/h,h],_=a.values,T=r.values;if(c===0)return yi(o,r.dtype);const B=A instanceof Zs?A:yi(C,r.dtype);typeof A=="string"||typeof A=="number"?B.values.fill(A):typeof A=="boolean"&&B.values.fill(+A);for(let O=0;O<f;O++){const U=[];let W=0;for(let z=0;z<m;z++){const X=_[O*m+z];U.push(X),W+=X*y[z]}if(W<0||W>=c/h)throw new Error(`Invalid indices: ${U} does not index into ${o}`);for(let z=0;z<h;z++)w?B.values[W*h+z]+=T[O*h+z]:B.values[W*h+z]=r.rank===0?T[0]:T[O*h+z]}return B}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e0e=Gu(a=>1/(1+Math.exp(-a))),X4=Yi(xi,a=>1/(1+Math.exp(-a))),t0e={kernelName:xi,backendName:"cpu",kernelFunc:X4};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $4(a,r,o,c,h){const f=ck(c,r,o),m=M(o),y=Ie(c);if(f){const _=uk(r,y);return h==="string"?a.slice(_,_+m):a.subarray(_,_+m)}const A=h==="string"?Qh(a):a,w=yi(c,h,A),C=yi(o,h);for(let _=0;_<C.size;++_){const T=C.indexToLoc(_),B=T.map((O,U)=>O+r[U]);C.set(w.get(...B),...T)}return h==="string"?mG(C.values):C.values}function Lm(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{begin:f,size:m}=c;wn(h,"slice");const[y,A]=Vw(h,f,m);ak(h,y,A);const w=o.data.get(h.dataId).values,C=$4(w,y,A,h.shape,h.dtype);return o.makeTensorInfo(A,h.dtype,C)}const n0e={kernelName:Ke,backendName:"cpu",kernelFunc:Lm};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q4(a,r,o,c,h,f,m){const y=r[0],A=f[0],w=new Array(A),C=new Array(y),_=r[1];if(A===0){if(y!==0)throw new Error(nG(y));const W=Q(o,0),z=Q(h,0);return[W,[0,_],z,w,C]}let T=!0,B=0;const O=new Array(A).fill(0);for(let W=0;W<y;++W){const z=a[W*_];if(z<0)throw new Error(iG(W,z));if(z>=A)throw new Error(rG(W,z,A));++O[z],T=T&&z>=B,B=z}let U=!0;for(let W=0;W<A;++W){const z=O[W]===0;w[W]=z,U=U&&!z,O[W]=Math.max(O[W],1),W>0&&(O[W]+=O[W-1])}if(U&&T){const W=a,z=c;for(let X=0;X<y;++X)C[X]=X;return[W,[y,_],z,w,C]}else{const W=O[A-1],z=Q(o,W*_),X=Q(h,W),re=new Array(A).fill(0);for(let se=0;se<y;++se){const le=a[se*_],ge=re[le],ye=(le===0?0:O[le-1])+ge;re[le]++;for(let be=0;be<_;++be)z[ye*_+be]=a[se*_+be];X[ye]=c[se],C[se]=ye}for(let se=0;se<A;++se)if(re[se]===0){const le=se===0?0:O[se-1];z[le*_+0]=se;for(let ge=1;ge<_;++ge)z[le*_+ge]=0;X[le]=m}return[z,[W,_],X,w,C]}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function K4(a,r,o,c,h){const f=M(c),m=r[0],y=h.length,A=[];let w=1,C=-1;for(let U=0;U<y;++U){const W=h[U];if(W===-1){if(C!==-1)throw new Error(sG(C,U));C=U,A.push(1)}else{if(W<0)throw new Error(oG(U,W));w*=W,A.push(W)}}if(C!==-1){if(w<=0)throw new Error(aG());const U=Math.trunc(f/w);if(w*U!==f)throw new Error(lG(c,A));A[C]=U}if(M(A)!==f)throw new Error(cG(c,A));const _=c.length,T=[];if(_>0){T[_-1]=1;for(let U=_-2;U>=0;--U)T[U]=T[U+1]*c[U+1]}const B=[];if(y>0){B[y-1]=1;for(let U=y-2;U>=0;--U)B[U]=B[U+1]*A[U+1]}const O=Q(o,m*y);for(let U=0;U<m;++U){let W=0;for(let z=0;z<_;++z)W+=a[U*_+z]*T[z];for(let z=0;z<y;++z)O[U*y+z]=Math.trunc(W/B[z]),W%=B[z]}return[O,[m,y],A]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xR(a,r,o,c,h,f=!1,m=0){const y=c.length,A=[r[0],a.length/r[0]],w=A[1],C=y>0?h[y-1]+1:0;if(C<0)throw new Error(Rk());const _=r.slice();_[0]=C;const T=_.reduce((X,re)=>X*re,1),B=Q(o,T);if(y===0)return C>0&&B.fill(m),[B,_];if(C<=0)throw new Error(Rk());let O=0,U=1,W=0,z=h[O];for(;;){let X=0;if(U<y){if(X=h[U],z===X){++U;continue}if(z>=X)throw new Error(uG())}if(z<0||z>=C)throw new Error(hG(z,C));z>W&&B.fill(m,W*w,z*w);for(let re=O;re<U;++re){const se=c[re];if(se<0||se>=A[0])throw new Error(dG(re,c[re],A[0]));for(let le=0;le<w;le++)B[z*w+le]+=a[se*w+le]}if(f)for(let re=0;re<w;re++)B[z*w+re]/=U-O;if(O=U,++U,W=z+1,z=X,U>y)break}return W<C&&B.fill(m,W*w,C*w),[B,_]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const i0e=Gu(a=>Math.sqrt(a)),r0e=Yi(lr,a=>Math.sqrt(a)),s0e={kernelName:lr,backendName:"cpu",kernelFunc:r0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Z4=Qr((a,r)=>{const o=a-r;return o*o}),o0e=ws(nm,Z4),a0e={kernelName:nm,backendName:"cpu",kernelFunc:o0e};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const j4=Gu((a,r)=>{const{pattern:o,replaceGlobal:c,rewrite:h}=r;return a.replace(new RegExp(o,c?"g":""),h)}),l0e=If(sv,j4),c0e={kernelName:sv,backendName:"cpu",kernelFunc:l0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y4(a,r,o,c){const h=yi(a,r.dtype);for(let f=0;f<h.size;f++){const m=h.indexToLoc(f),y=new Array(m.length);for(let A=0;A<y.length;A++)y[A]=m[A]*o[A]+c[A];h.set(r.get(...y),...m)}return h}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class u0e{constructor(r,o,c,h,f,m){this.separator=Tu(r),this.nGramWidths=o,this.leftPad=Tu(c),this.rightPad=Tu(h),this.padWidth=f,this.preserveShort=m}getPadWidth(r){return Math.min(this.padWidth<0?r-1:this.padWidth,r-1)}getNumNGrams(r,o){const c=this.getPadWidth(o);return Math.max(0,r+2*c-o+1)}createNGrams(r,o,c,h,f,m){for(let y=0;y<f;++y){const A=this.getPadWidth(m),w=Math.max(0,A-y),C=Math.max(0,A-(f-(y+1))),_=m-(w+C),T=o+(w>0?0:y-A);let B=0;B+=w*this.leftPad.length;for(let X=0;X<_;++X)B+=r[T+X].length;B+=C*this.rightPad.length;const O=w+C+_-1;B+=O*this.separator.length,c[h+y]=new Uint8Array(B);const U=c[h+y];let W=0;const z=X=>X.forEach(re=>U[W++]=re);for(let X=0;X<w;++X)z(this.leftPad),z(this.separator);for(let X=0;X<_-1;++X)z(r[T+X]),z(this.separator);if(_>0){z(r[T+_-1]);for(let X=0;X<C;++X)z(this.separator),z(this.rightPad)}else{for(let X=0;X<C-1;++X)z(this.rightPad),z(this.separator);z(this.rightPad)}}}compute(r,o){const c=r.length,h=o.length;if(h>0){let A=o[0];if(A!==0)throw new Error(`First split value must be 0, got ${A}`);for(let w=1;w<h;++w){let C=o[w]>=A;if(C=C&&o[w]<=c,!C)throw new Error(`Invalid split value ${o[w]}, must be in [${A}, ${c}]`);A=o[w]}if(A!==c)throw new Error(`Last split value must be data size. Expected ${c}, got ${A}`)}const f=h-1,m=Q("int32",h);if(c===0||h===0){const A=new Array(c);for(let w=0;w<=f;++w)m[w]=0;return[A,m]}m[0]=0;for(let A=1;A<=f;++A){const w=o[A]-o[A-1];let C=0;this.nGramWidths.forEach(_=>{C+=this.getNumNGrams(w,_)}),this.preserveShort&&w>0&&C===0&&(C=1),m[A]=m[A-1]+C}const y=new Array(m[f]);for(let A=0;A<f;++A){const w=o[A];let C=m[A];if(this.nGramWidths.forEach(_=>{const T=o[A+1]-o[A],B=this.getNumNGrams(T,_);this.createNGrams(r,w,y,C,B,_),C+=B}),this.preserveShort&&C===m[A]){const _=o[A+1]-o[A];if(_===0)continue;const T=_+2*this.padWidth;this.createNGrams(r,w,y,C,1,T)}}return[y,m]}}function q4(a,r,o,c,h,f,m,y){return new u0e(o,c,h,f,m,y).compute(a,r)}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h0e(a,r,o,c){if(!a.length)return;if(r.length===0){for(let f=0;f<a.length;++f)c.push(a.subarray(f,f+1));return}if(r.length===1){const f=r[0];let m=a.indexOf(f);for(;m!==-1;){const y=a.subarray(0,m);(!o||y.length!==0)&&c.push(y),a=a.subarray(m+1),m=a.indexOf(f)}(!o||a.length!==0)&&c.push(a);return}let h=0;for(let f=0;f<a.length+1;f++)if(f===a.length||r.indexOf(a[f])!==-1){const m=a.subarray(h,f);(!o||m.length!==0)&&c.push(m),h=f+1}}function J4(a,r,o){const c=a.length,h=[];let f=0,m=0;const y=new Array(c);for(let T=0;T<c;++T){const B=h.length;h0e(a[T],r,o,h);const O=h.length-B;y[T]=O,f+=O,m=Math.max(m,O)}const A=Q("int32",f*2),w=new Array(f),C=[c,m];let _=0;for(let T=0;T<c;++T)for(let B=0;B<y[T];++B)A[_*2]=T,A[_*2+1]=B,w[_]=h[_],++_;return[A,w,C]}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function e9(a,r){const o=Q("int32",a.length);for(let c=0;c<a.length;++c)o[c]=Oa(a[c]).modulo(r).getLowBitsUnsigned();return o}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const t9=Qr((a,r)=>a-r),d0e=yR((a,r,o,c)=>({real:a-o,imag:r-c})),wR=ws(_u,t9,d0e),f0e={kernelName:_u,backendName:"cpu",kernelFunc:wR};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function n9(a,r){const o=new Array(a.rank);for(let h=0;h<o.length;h++)o[h]=a.shape[h]*r[h];const c=yi(o,a.dtype);for(let h=0;h<c.values.length;++h){const f=c.indexToLoc(h),m=new Array(a.rank);for(let A=0;A<m.length;A++)m[A]=f[A]%a.shape[A];const y=a.locToIndex(m);c.values[h]=a.values[y]}return c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yv=(a,r)=>{const o=r.value-a.value;return o===0?a.index-r.index:o};function i9(a,r,o=0,c=a.length-1){for(;c>o;){if(c-o>600){const y=c-o+1,A=r-o+1,w=Math.log(y),C=.5*Math.exp(2*w/3),_=.5*Math.sqrt(w*C*(y-C)/y)*Math.sign(A-y/2),T=Math.max(o,Math.floor(r-A*C/y+_)),B=Math.min(c,Math.floor(r+(y-A)*C/y+_));i9(a,r,T,B)}const h=a[r];let f=o,m=c;for(g(a,o,r),Yv(a[c],h)>0&&g(a,o,c);f<m;){for(g(a,f,m),f++,m--;Yv(a[f],h)<0;)f=f+1;for(;Yv(a[m],h)>0;)m=m-1}Yv(a[o],h)===0?g(a,o,m):(m=m+1,g(a,m,c)),m<=r&&(o=m+1),r<=m&&(c=m-1)}}function r9(a,r,o,c,h){const f=r[r.length-1],[m,y]=[a.length/f,f],A=K(o,m*c),w=K("int32",m*c);for(let _=0;_<m;_++){const T=_*y,B=a.subarray(T,T+y);let O=new Array(B.length);B.forEach((X,re)=>O[re]={value:X,index:re}),c<O.length&&(i9(O,c),O=O.slice(0,c)),h&&O.sort(Yv);const U=_*c,W=A.subarray(U,U+c),z=w.subarray(U,U+c);for(let X=0;X<c;X++)W[X]=O[X].value,z[X]=O[X].index}const C=r.slice();return C[C.length-1]=c,[yi(C,o,A),yi(C,"int32",w)]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function s9(a,r,o,c){const h=q(r,o)[0],f=[1,o[0],1];for(let O=0;O<h;O++)f[0]*=o[O];f[1]=o[h];for(let O=h+1;O<o.length;O++)f[2]*=o[O];const m=new Map,y=new Int32Array(o[h]),A=new Zs(f,c,a),w=[],C=f[0]===1&&f[2]===1;for(let O=0;O<o[h];O++){let U;if(C)U=a[O].toString();else{const z=[];for(let X=0;X<f[0];X++)for(let re=0;re<f[2];re++)z.push(A.get(X,O,re));U=z.join(",")}const W=m.get(U);if(W!=null)y[O]=W;else{const z=m.size;m.set(U,z),y[O]=z,w.push(O)}}const _=f.slice();_[1]=m.size;const T=new Zs(_,c);w.forEach((O,U)=>{for(let W=0;W<f[0];W++)for(let z=0;z<f[2];z++)T.set(A.get(W,O,z),W,U,z)});const B=o.slice();return B[h]=_[1],{outputValues:T.values,outputShape:B,indices:y}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const p0e=Object.freeze(Object.defineProperty({__proto__:null,addImpl:u4,bincountImpl:AR,bincountReduceImpl:h4,bitwiseAndImpl:d4,castImpl:c4,ceilImpl:f4,concatImpl:p4,equalImpl:m4,expImpl:y4,expm1Impl:v4,floorDivImpl:x4,floorImpl:b4,gatherNdImpl:w4,gatherV2Impl:C4,greaterEqualImpl:_4,greaterImpl:E4,lessEqualImpl:S4,lessImpl:I4,linSpaceImpl:T4,logImpl:M4,maxImpl:k4,maximumImpl:R4,minimumImpl:L4,multiplyImpl:vR,negImpl:B4,notEqualImpl:P4,prodImpl:N4,raggedGatherImpl:F4,raggedRangeImpl:V4,raggedTensorToTensorImpl:G4,rangeImpl:W4,rsqrtImpl:H4,scatterImpl:Rm,sigmoidImpl:e0e,simpleAbsImpl:l4,sliceImpl:$4,sparseFillEmptyRowsImpl:Q4,sparseReshapeImpl:K4,sparseSegmentReductionImpl:xR,sqrtImpl:i0e,squaredDifferenceImpl:Z4,staticRegexReplaceImpl:j4,stridedSliceImpl:Y4,stringNGramsImpl:q4,stringSplitImpl:J4,stringToHashBucketFastImpl:e9,subImpl:t9,tileImpl:n9,topKImpl:r9,transposeImpl:bR,uniqueImpl:s9},Symbol.toStringTag,{value:"Module"}));/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/MU("cpu",()=>new fC,1);/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const o9=Yi(Kt,a=>a>=0?a:Math.exp(a)-1),m0e={kernelName:Kt,backendName:"cpu",kernelFunc:o9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a9(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{alpha:f}=c;wn([h],"leakyRelu");const m=M(h.shape),y=o.data.get(h.dataId).values,A=K("float32",m);for(let w=0;w<y.length;w++)A[w]=y[w]<0?f*y[w]:y[w];return o.makeTensorInfo(h.shape,"float32",A)}const g0e={kernelName:Qs,backendName:"cpu",kernelFunc:a9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y0e=Qr((a,r)=>a<0?r*a:a);function l9(a){const{inputs:r,backend:o}=a,{x:c,alpha:h}=r;wn([c,h],"prelu");const f=o.data.get(c.dataId).values,m=o.data.get(h.dataId).values,[y,A]=y0e(c.shape,h.shape,f,m,"float32");return o.makeTensorInfo(A,"float32",y)}const A0e={kernelName:Na,backendName:"cpu",kernelFunc:l9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const c9=Yi(bu,a=>Math.max(0,a)),v0e={kernelName:bu,backendName:"cpu",kernelFunc:c9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const u9=Yi(zl,a=>Math.min(Math.max(0,a),6)),b0e={kernelName:zl,backendName:"cpu",kernelFunc:u9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yC(a,r,o,c,h){if(o==="linear")return zu({inputs:{x:r},backend:a});if(o==="relu")return c9({inputs:{x:r},backend:a});if(o==="elu")return o9({inputs:{x:r},backend:a});if(o==="relu6")return u9({inputs:{x:r},backend:a});if(o==="prelu")return l9({inputs:{x:r,alpha:c},backend:a});if(o==="leakyrelu")return a9({inputs:{x:r},backend:a,attrs:{alpha:h}});if(o==="sigmoid")return X4({inputs:{x:r},backend:a});throw new Error(`Activation ${o} has not been implemented for the CPU backend.`)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hr(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{shape:f}=c,m=M(h.shape),y=G(f,m),A=M(y);b(m===A,()=>`The new shape (${y}) has ${A} elements and the old shape (${h.shape}) has ${m} elements. The new shape and old shape must have the same number of elements.`),o.incRef(h.dataId);const w=o.data.get(h.dataId);if(w.complexTensorInfos!=null){const C=w.complexTensorInfos.real,_=w.complexTensorInfos.imag;C.shape=y,_.shape=y}return{dataId:h.dataId,shape:y,dtype:h.dtype}}const x0e={kernelName:sa,backendName:"cpu",kernelFunc:hr};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function h9(a){const{inputs:r,backend:o,attrs:c}=a,{a:h,b:f}=r,{transposeA:m,transposeB:y}=c;wn([h,f],"matMul");const A=h.shape.length,w=f.shape.length,C=m?h.shape[A-2]:h.shape[A-1],_=y?f.shape[w-1]:f.shape[w-2],T=m?h.shape[A-1]:h.shape[A-2],B=y?f.shape[w-2]:f.shape[w-1],O=h.shape.slice(0,-2),U=f.shape.slice(0,-2),W=M(O),z=M(U),X=si(h.shape.slice(0,-2),f.shape.slice(0,-2)).concat([T,B]);b(C===_,()=>`Error in matMul: inner shapes (${C}) and (${_}) of Tensors with shapes ${h.shape} and ${f.shape} and transposeA=${m} and transposeB=${y} must match.`);const re=m?[W,C,T]:[W,T,C],se=y?[z,B,_]:[z,_,B],le=hr({inputs:{x:h},backend:o,attrs:{shape:re}}),ge=hr({inputs:{x:f},backend:o,attrs:{shape:se}}),ye=m?le.shape[1]:le.shape[2],be=m?le.shape[2]:le.shape[1],Se=y?ge.shape[1]:ge.shape[2],Be=Math.max(W,z),Ye=o.data.get(le.dataId).values,et=o.data.get(ge.dataId).values,tt=Ie(le.shape),ot=Ie(ge.shape),[st,ct,gt]=m?[tt[0],1,tt[1]]:[tt[0],tt[1],1],[mt,bt,Vt]=y?[1,ot[1],ot[0]]:[ot[1],1,ot[0]],Bt=be*Se,$t=yi([Be,be,Se],le.dtype),Qt=$t.values,rn=o.blockSize;for(let an=0;an<Be;an++){const Dn=an%W,Tn=an%z;for(let Fn=0;Fn<be;Fn+=rn){const qn=Math.min(Fn+rn,be);for(let ni=0;ni<Se;ni+=rn){const wi=Math.min(ni+rn,Se);for(let zi=0;zi<ye;zi+=rn){const kr=Math.min(zi+rn,ye);for(let yr=Fn;yr<qn;yr++)for(let dr=ni;dr<wi;dr++){let fr=0;for(let Ar=zi;Ar<kr;Ar++){const Kr=Ye[Dn*st+yr*ct+Ar*gt],qh=et[Ar*mt+dr*bt+Tn*Vt];fr+=Kr*qh}Qt[an*Bt+(yr*Se+dr)]+=fr}}}}}return o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(ge),o.makeTensorInfo(X,$t.dtype,$t.values)}const w0e={kernelName:Pt,backendName:"cpu",kernelFunc:h9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function C0e(a){const{inputs:r,backend:o,attrs:c}=a,{a:h,b:f,bias:m,preluActivationWeights:y}=r,{transposeA:A,transposeB:w,activation:C,leakyreluAlpha:_}=c;let T,B,O;const U=[];T=h9({inputs:{a:h,b:f},attrs:{transposeA:A,transposeB:w},backend:o}),m&&(B=W0({inputs:{a:T,b:m},backend:o}),U.push(T),T=B),C&&(O=yC(o,T,C,y,_),U.push(T),T=O);for(const W of U)o.disposeIntermediateTensorInfo(W);return T}const E0e={kernelName:nf,backendName:"cpu",kernelFunc:C0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _0e=Yi(at,a=>Math.acos(a)),I0e={kernelName:at,backendName:"cpu",kernelFunc:_0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S0e=Yi(ln,a=>Math.acosh(a)),T0e={kernelName:ln,backendName:"cpu",kernelFunc:S0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function M0e(a){const{inputs:r,backend:o}=a,c=r;wn(r,"addN");const h=c.map(y=>o.data.get(y.dataId).values),f=yi(c[0].shape,c[0].dtype),m=f.values;for(let y=0;y<c.length;y++){const A=h[y];for(let w=0;w<m.length;w++)m[w]+=A[w]}return o.makeTensorInfo(f.shape,f.dtype,f.values)}const k0e={kernelName:ue,backendName:"cpu",kernelFunc:M0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function R0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;wn(h,"all");const y=q(f,h.shape);let A=y;const w=Tr(A,h.shape.length);let C=h;w!=null&&(C=ga({inputs:{x:h},backend:o,attrs:{perm:w}}),A=Hr(A.length,h.shape.length)),Ys("all",A,C.shape.length);const[_,T]=Ps(C.shape,A),B=M(T),O=At(M(_),C.dtype),U=o.data.get(C.dataId).values;for(let z=0;z<O.length;++z){const X=z*B;let re=U[X];for(let se=0;se<B;++se){const le=U[X+se];re=re&&le}O[z]=re}w!=null&&o.disposeIntermediateTensorInfo(C);const W=o.makeTensorInfo(_,C.dtype,O);if(m){const z=ns(_,y),X=hr({inputs:{x:W},backend:o,attrs:{shape:z}});return o.disposeIntermediateTensorInfo(W),X}return W}const L0e={kernelName:Oe,backendName:"cpu",kernelFunc:R0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;wn(h,"any");const y=q(f,h.shape);let A=y;const w=Tr(A,h.shape.length);let C=h;w!=null&&(C=ga({inputs:{x:h},backend:o,attrs:{perm:w}}),A=Hr(A.length,h.shape.length)),Ys("any",A,C.shape.length);const[_,T]=Ps(C.shape,A),B=M(T),O=At(M(_),C.dtype),U=o.data.get(C.dataId).values;for(let z=0;z<O.length;++z){const X=z*B;let re=U[X];for(let se=0;se<B;++se){const le=U[X+se];re=re||le}O[z]=re}w!=null&&o.disposeIntermediateTensorInfo(C);const W=o.makeTensorInfo(_,C.dtype,O);if(m){const z=ns(_,y),X=hr({inputs:{x:W},backend:o,attrs:{shape:z}});return o.disposeIntermediateTensorInfo(W),X}return W}const P0e={kernelName:ut,backendName:"cpu",kernelFunc:B0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function N0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f}=c;wn(h,"argMax");let m=q(f,h.shape);const y=Tr(m,h.shape.length);let A=h;const w=[];y!=null&&(A=ga({inputs:{x:h},backend:o,attrs:{perm:y}}),w.push(A),m=Hr(m.length,A.shape.length)),m=[m[0]],Ys("argMax",m,A.shape.length);const[C,_]=Ps(A.shape,m),T=M(C),B=At(T,"int32"),O=M(_),U=o.data.get(A.dataId).values;for(let W=0;W<B.length;++W){const z=W*O;let X=U[z],re=0;for(let se=0;se<O;++se){const le=U[z+se];le>X&&(X=le,re=se)}B[W]=re}return w.forEach(W=>o.disposeIntermediateTensorInfo(W)),o.makeTensorInfo(C,"int32",B)}const D0e={kernelName:vt,backendName:"cpu",kernelFunc:N0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function F0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f}=c;wn(h,"argMin");let m=q(f,h.shape);const y=Tr(m,h.shape.length);let A=h;const w=[];y!=null&&(A=ga({inputs:{x:h},backend:o,attrs:{perm:y}}),w.push(A),m=Hr(m.length,A.shape.length)),m=[m[0]],Ys("argMin",m,A.shape.length);const[C,_]=Ps(A.shape,m),T=M(C),B=At(T,"int32"),O=M(_),U=o.data.get(A.dataId).values;for(let W=0;W<B.length;++W){const z=W*O;let X=U[z],re=0;for(let se=0;se<O;++se){const le=U[z+se];le<X&&(X=le,re=se)}B[W]=re}return w.forEach(W=>o.disposeIntermediateTensorInfo(W)),o.makeTensorInfo(C,"int32",B)}const O0e={kernelName:pt,backendName:"cpu",kernelFunc:F0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const V0e=Yi(cn,a=>Math.asin(a)),U0e={kernelName:cn,backendName:"cpu",kernelFunc:V0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const z0e=Yi(Tt,a=>Math.asinh(a)),G0e={kernelName:Tt,backendName:"cpu",kernelFunc:z0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W0e=Yi(Zt,a=>Math.atan(a)),H0e={kernelName:Zt,backendName:"cpu",kernelFunc:W0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X0e=Qr((a,r)=>Math.atan2(a,r)),$0e=ws(Ft,X0e),Q0e={kernelName:Ft,backendName:"cpu",kernelFunc:$0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const K0e=Yi(kn,a=>Math.atanh(a)),Z0e={kernelName:kn,backendName:"cpu",kernelFunc:K0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function CR(a,r,o,c,h,f){const m=h.strideHeight,y=h.strideWidth,A=h.dilationHeight,w=h.dilationWidth,C=h.effectiveFilterHeight,_=h.effectiveFilterWidth,T=h.padInfo.top,B=h.padInfo.left,O=f==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,U=yi(h.outShape,o),W=U.values,z=h.outShape[1]*h.outShape[2]*h.outShape[3],X=h.outShape[2]*h.outShape[3],re=h.outShape[3];for(let se=0;se<h.batchSize;++se){const le=se*z,ge=se*c[0];for(let ye=0;ye<h.inChannels;++ye)for(let be=0;be<h.outHeight;++be){const Se=be*m-T,Be=Math.max(0,Se),Ye=Math.min(h.inHeight,C+Se),et=le+be*X;for(let tt=0;tt<h.outWidth;++tt){const ot=tt*y-B,st=Math.max(0,ot),ct=Math.min(h.inWidth,_+ot);let gt=O,mt=0,bt=0;for(let Bt=Be;Bt<Ye;Bt+=A){const $t=ge+Bt*c[1];for(let Qt=st;Qt<ct;Qt+=w){const rn=$t+Qt*c[2],an=a[rn+ye];f==="max"&&an>gt?gt=an:f==="avg"&&(mt+=an,bt++)}if(isNaN(gt))break}const Vt=et+tt*re+ye;W[Vt]=f==="avg"?mt/bt:gt}}}return U}function d9(a,r,o,c,h=!1,f=!1){const m=yi(c.outShape,"int32"),y=c.strideHeight,A=c.strideWidth,w=c.dilationHeight,C=c.dilationWidth,_=c.effectiveFilterHeight,T=c.effectiveFilterWidth,B=c.padInfo.top,O=c.padInfo.left,U=yi(r,o,a);for(let W=0;W<c.batchSize;++W)for(let z=0;z<c.inChannels;++z)for(let X=0;X<c.outHeight;++X){const re=X*y-B;let se=re;for(;se<0;)se+=w;const le=Math.min(c.inHeight,_+re);for(let ge=0;ge<c.outWidth;++ge){const ye=ge*A-O;let be=ye;for(;be<0;)be+=C;const Se=Math.min(c.inWidth,T+ye);let Be=Number.NEGATIVE_INFINITY,Ye=-1;for(let et=se;et<le;et+=w){const tt=et-re;for(let ot=be;ot<Se;ot+=C){const st=ot-ye,ct=U.get(W,et,ot,z);ct>Be&&(Be=ct,h?Ye=f?((W*c.inHeight+et)*c.inWidth+ot)*c.inChannels+z:(et*c.inWidth+ot)*c.inChannels+z:Ye=tt*T+st)}}m.set(Ye,W,X,ge,z)}}return m}function f9(a,r,o,c,h,f){const m=h.strideDepth,y=h.strideHeight,A=h.strideWidth,w=h.dilationDepth,C=h.dilationHeight,_=h.dilationWidth,T=h.effectiveFilterDepth,B=h.effectiveFilterHeight,O=h.effectiveFilterWidth,U=h.padInfo.front,W=h.padInfo.top,z=h.padInfo.left,X=f==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,re=yi(h.outShape,o),se=re.values,le=h.outShape[1]*h.outShape[2]*h.outShape[3]*h.outShape[4],ge=h.outShape[2]*h.outShape[3]*h.outShape[4],ye=h.outShape[3]*h.outShape[4],be=h.outShape[4];for(let Se=0;Se<h.batchSize;++Se){const Be=Se*le,Ye=Se*c[0];for(let et=0;et<h.inChannels;++et)for(let tt=0;tt<h.outDepth;++tt){const ot=tt*m-U;let st=ot;for(;st<0;)st+=w;const ct=Math.min(h.inDepth,T+ot),gt=Be+tt*ge;for(let mt=0;mt<h.outHeight;++mt){const bt=mt*y-W;let Vt=bt;for(;Vt<0;)Vt+=C;const Bt=Math.min(h.inHeight,B+bt),$t=gt+mt*ye;for(let Qt=0;Qt<h.outWidth;++Qt){const rn=Qt*A-z;let an=rn;for(;an<0;)an+=_;const Dn=Math.min(h.inWidth,O+rn),Tn=$t+Qt*be;let Fn=X,qn=0,ni=0;for(let zi=st;zi<ct;zi+=w){const kr=Ye+zi*c[1];for(let yr=Vt;yr<Bt;yr+=C){const dr=kr+yr*c[2];for(let fr=an;fr<Dn;fr+=_){const Ar=dr+fr*c[3],Kr=a[Ar+et];if(f==="max"&&Kr>Fn?Fn=Kr:f==="avg"&&(qn+=Kr,ni++),isNaN(Fn))break}if(isNaN(Fn))break}if(isNaN(Fn))break}const wi=Tn+et;se[wi]=f==="avg"?qn/Math.max(ni,1):Fn}}}}return re}function j0e(a,r){const o=yi(r.outShape,"int32"),c=r.strideDepth,h=r.strideHeight,f=r.strideWidth,m=r.dilationDepth,y=r.dilationHeight,A=r.dilationWidth,w=r.effectiveFilterDepth,C=r.effectiveFilterHeight,_=r.effectiveFilterWidth,T=r.padInfo.front,B=r.padInfo.top,O=r.padInfo.left;for(let U=0;U<r.batchSize;++U)for(let W=0;W<r.inChannels;++W)for(let z=0;z<r.outDepth;++z){const X=z*c-T;let re=X;for(;re<0;)re+=m;const se=Math.min(r.inDepth,w+X);for(let le=0;le<r.outHeight;++le){const ge=le*h-B;let ye=ge;for(;ye<0;)ye+=y;const be=Math.min(r.inHeight,C+ge);for(let Se=0;Se<r.outWidth;++Se){const Be=Se*f-O;let Ye=Be;for(;Ye<0;)Ye+=A;const et=Math.min(r.inWidth,_+Be);let tt=Number.NEGATIVE_INFINITY,ot=-1;for(let st=re;st<se;st+=m){const ct=st-X;for(let gt=ye;gt<be;gt+=y){const mt=gt-ge;for(let bt=Ye;bt<et;bt+=A){const Vt=bt-Be,Bt=a.get(U,st,gt,bt,W);Bt>=tt&&(tt=Bt,ot=ct*C*_+mt*C+Vt)}}}o.set(ot,U,z,le,Se,W)}}}return o}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r;wn(h,"avgPool");const{filterSize:f,strides:m,pad:y,dimRoundingMode:A}=c,w=1;b(fo(m,w),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${m} and dilations '${w}'`);const C=Hl(h.shape,f,m,w,y,A);let _;if(C.filterWidth===1&&C.filterHeight===1&&R(C.inShape,C.outShape))_=zu({inputs:{x:h},backend:o});else{const T=o.data.get(h.dataId).values,B=Ie(h.shape),O=CR(T,h.shape,h.dtype,B,C,"avg");_=o.makeTensorInfo(C.outShape,h.dtype,O.values)}return _}const q0e={kernelName:vn,backendName:"cpu",kernelFunc:Y0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function J0e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{filterSize:f,strides:m,pad:y,dimRoundingMode:A,dataFormat:w}=c;wn(h,"avgPool3d");const C=Gh(h.shape,f,m,1,y,A,w),_=o.data.get(h.dataId).values,T=f9(_,h.shape,h.dtype,Ie(h.shape),C,"avg");return o.makeTensorInfo(T.shape,"float32",T.values)}const eye={kernelName:Pe,backendName:"cpu",kernelFunc:J0e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tye(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,{filterSize:m,strides:y,pad:A,dimRoundingMode:w}=c;wn([h,f],"avgPool3DGrad");const C=Gh(f.shape,m,y,1,A,w),_=C.strideDepth,T=C.strideHeight,B=C.strideWidth,O=C.filterDepth,U=C.filterHeight,W=C.filterWidth,z=C.dilationDepth,X=C.dilationHeight,re=C.dilationWidth,se=C.effectiveFilterDepth,le=C.effectiveFilterHeight,ge=C.effectiveFilterWidth,ye=se-1-C.padInfo.front,be=ge-1-C.padInfo.left,Se=le-1-C.padInfo.top,Be=yi(f.shape,"float32"),Ye=1/(O*U*W),et=o.bufferSync(h);for(let tt=0;tt<C.batchSize;++tt)for(let ot=0;ot<C.inChannels;++ot)for(let st=0;st<C.inDepth;++st)for(let ct=0;ct<C.inHeight;++ct)for(let gt=0;gt<C.inWidth;++gt){const mt=st-ye,bt=ct-Se,Vt=gt-be;let Bt=0;for(let $t=0;$t<se;$t+=z){const Qt=(mt+$t)/_;if(!(Qt<0||Qt>=C.outDepth||Math.floor(Qt)!==Qt))for(let rn=0;rn<le;rn+=X){const an=(bt+rn)/T;if(!(an<0||an>=C.outHeight||Math.floor(an)!==an))for(let Dn=0;Dn<ge;Dn+=re){const Tn=(Vt+Dn)/B;if(Tn<0||Tn>=C.outWidth||Math.floor(Tn)!==Tn)continue;const Fn=et.get(tt,Qt,an,Tn,ot);Bt+=Fn}}}Be.set(Bt*Ye,tt,st,ct,gt,ot)}return o.makeTensorInfo(Be.shape,Be.dtype,Be.values)}const nye={kernelName:ft,backendName:"cpu",kernelFunc:tye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iye(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,m=f;wn([h,f],"avgPoolGrad");const{filterSize:y,strides:A,pad:w}=c,C=Hl(m.shape,y,A,1,w),_=C.strideHeight,T=C.strideWidth,B=C.filterHeight,O=C.filterWidth,U=C.dilationHeight,W=C.dilationWidth,z=C.effectiveFilterHeight,X=C.effectiveFilterWidth,re=X-1-C.padInfo.left,se=z-1-C.padInfo.top,le=yi(m.shape,"float32"),ge=1/(B*O),ye=o.data.get(h.dataId).values,be=yi(h.shape,"float32",ye);for(let Se=0;Se<C.batchSize;++Se)for(let Be=0;Be<C.inChannels;++Be)for(let Ye=0;Ye<C.inHeight;++Ye)for(let et=0;et<C.inWidth;++et){const tt=Ye-se,ot=et-re;let st=0;for(let ct=0;ct<z;ct+=U){const gt=(tt+ct)/_;if(!(gt<0||gt>=C.outHeight||Math.floor(gt)!==gt))for(let mt=0;mt<X;mt+=W){const bt=(ot+mt)/T;if(bt<0||bt>=C.outWidth||Math.floor(bt)!==bt)continue;const Vt=be.get(Se,gt,bt,Be);st+=Vt}}le.set(st*ge,Se,Ye,et,Be)}return o.makeTensorInfo(le.shape,le.dtype,le.values)}const rye={kernelName:jn,backendName:"cpu",kernelFunc:iye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,scale:f,offset:m,mean:y,variance:A}=r;b(y.shape.length===A.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b(m==null||y.shape.length===m.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b(f==null||y.shape.length===f.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),wn([h,y,A,f,m],"batchNorm");let{varianceEpsilon:w}=c;w==null&&(w=.001);const C=o.data.get(h.dataId).values,_=o.data.get(y.dataId).values,T=o.data.get(A.dataId).values,B=f?o.data.get(f.dataId).values:new Float32Array([1]),O=m?o.data.get(m.dataId).values:new Float32Array([0]),U=new Float32Array(C.length),W=O.length,z=B.length,X=T.length,re=_.length;let se=0,le=0,ge=0,ye=0;for(let be=0;be<C.length;++be)U[be]=O[se++]+(C[be]-_[le++])*B[ge++]/Math.sqrt(T[ye++]+w),se>=W&&(se=0),le>=re&&(le=0),ge>=z&&(ge=0),ye>=X&&(ye=0);return o.makeTensorInfo(h.shape,h.dtype,U)}const oye={kernelName:jt,backendName:"cpu",kernelFunc:sye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockShape:f,crops:m}=c;wn([h],"batchToSpaceND");const y=f.reduce((z,X)=>z*X),A=Lv(h.shape,f,y),w=Bv(A.length,f.length),C=Pv(h.shape,f,y),_=mk(m,f.length),T=gk(C,m,f.length),B=hr({inputs:{x:h},backend:o,attrs:{shape:A}}),O=ga({inputs:{x:B},backend:o,attrs:{perm:w}}),U=hr({inputs:{x:O},backend:o,attrs:{shape:C}}),W=Lm({inputs:{x:U},backend:o,attrs:{begin:_,size:T}});return o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(U),W}const lye={kernelName:Dt,backendName:"cpu",kernelFunc:aye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,weights:f}=r,{size:m}=c,y=o.data.get(h.dataId).values,A=o.data.get(f.dataId).values,w=AR(y,A,f.dtype,f.shape,m);return o.makeTensorInfo([m],f.dtype,w)}const uye={kernelName:qt,backendName:"cpu",kernelFunc:cye};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hye(a){const{inputs:r,backend:o}=a,{s0:c,s1:h}=r,f=o.data.get(c.dataId).values,m=o.data.get(h.dataId).values,y=si(Array.from(f),Array.from(m));return o.makeTensorInfo([y.length],"int32",Int32Array.from(y))}const dye={kernelName:tn,backendName:"cpu",kernelFunc:hye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fye=Yi(ei,(a,r)=>{const o=r;return a>o.clipValueMax?o.clipValueMax:a<o.clipValueMin?o.clipValueMin:a}),pye={kernelName:ei,backendName:"cpu",kernelFunc:fye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mye={kernelName:ta,backendName:"cpu",kernelFunc:a=>{const{x:r}=a.inputs,o=a.backend,c=new Float32Array(M(r.shape)),h=o.data.get(r.dataId),f=h.complexTensorInfos.real,m=h.complexTensorInfos.imag,y=o.data.get(f.dataId).values,A=o.data.get(m.dataId).values;for(let w=0;w<y.length;w++){const C=y[w],_=A[w];c[w]=Math.hypot(C,_)}return o.makeOutput(c,r.shape,"float32")}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function H0(a){const{inputs:r,backend:o}=a,{input:c}=r,h=o.data.get(c.dataId).complexTensorInfos.imag,f=o.data.get(h.dataId).values;return o.makeTensorInfo(h.shape,h.dtype,f)}const gye={kernelName:Nn,backendName:"cpu",kernelFunc:H0};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function X0(a){const{inputs:r,backend:o,attrs:c}=a,{axis:h}=c,f=q(h,r[0].shape)[0],m=r.map(U=>U.shape);dk(m,f);let y=Nu(r.map(U=>U.shape),f);if(M(y)===0)return o.makeTensorInfo(y,r[0].dtype,[]);const A=r.filter(U=>M(U.shape)>0);if(A.length===1)return zu({inputs:{x:A[0]},backend:o});if(A[0].dtype==="complex64"){const U=A.map(se=>km({inputs:{input:se},backend:o})),W=A.map(se=>H0({inputs:{input:se},backend:o})),z=X0({inputs:U,backend:o,attrs:{axis:f}}),X=X0({inputs:W,backend:o,attrs:{axis:f}}),re=Wa({inputs:{real:z,imag:X},backend:o});return U.forEach(se=>o.disposeIntermediateTensorInfo(se)),W.forEach(se=>o.disposeIntermediateTensorInfo(se)),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(X),re}const w=A.map(U=>{const W=[-1,M(U.shape.slice(f))];return hr({inputs:{x:U},backend:o,attrs:{shape:W}})}),C=w.map(U=>({vals:o.data.get(U.dataId).values,shape:U.shape}));y=Nu(w.map(U=>U.shape),1);const _=w[0].shape[0]===1,T=p4(C,y,r[0].dtype,_),B=Nu(A.map(U=>U.shape),f),O=o.makeTensorInfo(B,r[0].dtype,T);return w.forEach(U=>o.disposeIntermediateTensorInfo(U)),O}const yye={kernelName:yc,backendName:"cpu",kernelFunc:X0};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function p9(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dataFormat:A,dilations:w,dimRoundingMode:C}=c;wn([h,f],"conv2d");const _=Wh(A),T=js(h.shape,f.shape,m,w,y,C,!1,_),B=T.filterHeight,O=T.filterWidth,U=T.dilationHeight,W=T.dilationWidth,z=T.padInfo.left,X=T.padInfo.top,re=T.dataFormat==="channelsLast",se=new Zs(T.outShape,h.dtype),le=Ie(h.shape),ge=Ie(f.shape),ye=le[0],be=re?le[1]:le[2],Se=re?le[2]:1,Be=re?1:le[1],Ye=se.strides[0],et=re?se.strides[1]:se.strides[2],tt=re?se.strides[2]:1,ot=re?1:se.strides[1],st=o.data.get(h.dataId).values,ct=o.data.get(f.dataId).values,gt=se.values;for(let mt=0;mt<T.batchSize;++mt){const bt=mt*ye,Vt=mt*Ye;for(let Bt=0;Bt<T.outHeight;++Bt){const $t=Vt+Bt*et,Qt=Bt*T.strideHeight-X;for(let rn=0;rn<B;++rn){const an=Qt+rn*U;if(an<0||an>=T.inHeight)continue;const Dn=rn*ge[0],Tn=bt+an*be;for(let Fn=0;Fn<T.outWidth;++Fn){const qn=$t+Fn*tt,ni=Fn*T.strideWidth-z;for(let wi=0;wi<O;++wi){const zi=ni+wi*W;if(zi<0||zi>=T.inWidth)continue;const kr=Dn+wi*ge[1],yr=Tn+zi*Se;let dr=kr;for(let fr=0;fr<T.inChannels;++fr){const Ar=st[yr+fr*Be];for(let Kr=0;Kr<T.outChannels;++Kr)gt[qn+Kr*ot]+=Ar*ct[dr+Kr];dr+=T.outChannels}}}}}}return o.makeTensorInfo(se.shape,se.dtype,gt)}const Aye={kernelName:Dl,backendName:"cpu",kernelFunc:p9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,pad:y,dataFormat:A,dimRoundingMode:w,filterShape:C}=c;wn([h,f],"conv2dBackpropFilter");const _=Wh(A),T=js(h.shape,C,m,1,y,w,!1,_),{strideHeight:B,strideWidth:O,filterHeight:U,filterWidth:W}=T,z=T.dataFormat==="channelsLast",X=new Zs(T.filterShape,"float32"),re=T.padInfo.left,se=T.padInfo.top,le=o.data.get(h.dataId).values,ge=o.data.get(f.dataId).values,ye=new Zs(h.shape,h.dtype,le),be=new Zs(f.shape,f.dtype,ge);for(let Se=0;Se<U;++Se){const Be=Math.max(0,Math.ceil((se-Se)/B)),Ye=Math.min(T.outHeight,(T.inHeight+se-Se)/B);for(let et=0;et<W;++et){const tt=Math.max(0,Math.ceil((re-et)/O)),ot=Math.min(T.outWidth,(T.inWidth+re-et)/O);for(let st=0;st<T.inChannels;++st)for(let ct=0;ct<T.outChannels;++ct){let gt=0;for(let mt=0;mt<T.batchSize;++mt)for(let bt=Be;bt<Ye;++bt){const Vt=Se+bt*B-se;for(let Bt=tt;Bt<ot;++Bt){const $t=et+Bt*O-re;z?gt+=ye.get(mt,Vt,$t,st)*be.get(mt,bt,Bt,ct):gt+=ye.get(mt,st,Vt,$t)*be.get(mt,ct,bt,Bt)}}X.set(gt,Se,et,st,ct)}}}return o.makeTensorInfo(X.shape,X.dtype,X.values)}const bye={kernelName:qr,backendName:"cpu",kernelFunc:vye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xye(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{inputShape:m,strides:y,pad:A,dataFormat:w,dimRoundingMode:C}=c;wn([h,f],"conv2dBackpropInput");const _=Ie(f.shape),T=Ie(h.shape);let B=Wh(w);const O=js(m,f.shape,y,1,A,C,!1,B),U=new Zs(O.inShape,"float32"),W=U.values,z=o.data.get(h.dataId).values,X=o.data.get(f.dataId).values,[re,se,le]=_,{batchSize:ge,filterHeight:ye,filterWidth:be,inChannels:Se,inHeight:Be,inWidth:Ye,outChannels:et,outHeight:tt,outWidth:ot,strideHeight:st,strideWidth:ct}=O;B=O.dataFormat;const gt=ye-1-O.padInfo.top,mt=be-1-O.padInfo.left,bt=B==="channelsLast",Vt=U.strides[0],Bt=bt?U.strides[1]:U.strides[2],$t=bt?U.strides[2]:1,Qt=bt?1:U.strides[1],rn=T[0],an=bt?T[1]:T[2],Dn=bt?T[2]:1,Tn=bt?1:T[1];for(let Fn=0;Fn<ge;++Fn)for(let qn=0;qn<Se;++qn)for(let ni=0;ni<Be;++ni){const wi=ni-gt,zi=Math.max(0,Math.ceil(wi/st)),kr=Math.min(tt,(ye+wi)/st);for(let yr=0;yr<Ye;++yr){const dr=yr-mt,fr=Math.max(0,Math.ceil(dr/ct)),Ar=Math.min(ot,(be+dr)/ct);let Kr=0;for(let Vo=zi;Vo<kr;++Vo){const Jh=Vo*st-wi;for(let xl=fr;xl<Ar;++xl){const $u=xl*ct-dr,kf=rn*Fn+an*Vo+Dn*xl,Qu=re*(ye-1-Jh)+se*(be-1-$u)+le*qn;for(let Uc=0;Uc<et;++Uc){const Rf=z[kf+Tn*Uc],fb=X[Qu+Uc];Kr+=Rf*fb}}}const qh=Vt*Fn+Bt*ni+$t*yr+Qt*qn;W[qh]=Kr}}return o.makeTensorInfo(U.shape,U.dtype,U.values)}const wye={kernelName:hn,backendName:"cpu",kernelFunc:xye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dilations:A}=c;wn([h,f],"conv3d");const w=df(h.shape,f.shape,m,A,y),{filterDepth:C,filterHeight:_,filterWidth:T,dilationDepth:B,dilationHeight:O,dilationWidth:U,padInfo:W}=w,z=W.front,X=W.left,re=W.top,se=new Zs(w.outShape,h.dtype),le=o.data.get(h.dataId).values,ge=o.data.get(f.dataId).values,ye=se.values,be=Ie(h.shape),Se=Ie(f.shape);for(let Be=0;Be<w.batchSize;++Be){const Ye=Be*be[0],et=Be*se.strides[0];for(let tt=0;tt<w.outDepth;++tt){const ot=et+tt*se.strides[1],st=tt*w.strideDepth-z;for(let ct=0;ct<C;++ct){const gt=st+ct*B;if(gt<0||gt>=w.inDepth)continue;const mt=ct*Se[0],bt=Ye+gt*be[1];for(let Vt=0;Vt<w.outHeight;++Vt){const Bt=ot+Vt*se.strides[2],$t=Vt*w.strideHeight-re;for(let Qt=0;Qt<_;++Qt){const rn=$t+Qt*O;if(rn<0||rn>=w.inHeight)continue;const an=mt+Qt*Se[1],Dn=bt+rn*be[2];for(let Tn=0;Tn<w.outWidth;++Tn){const Fn=Bt+Tn*w.outChannels,qn=Tn*w.strideWidth-X;for(let ni=0;ni<T;++ni){const wi=qn+ni*U;if(wi<0||wi>=w.inWidth)continue;const zi=an+ni*Se[2],kr=Dn+wi*w.inChannels;let yr=zi;for(let dr=0;dr<w.inChannels;++dr){const fr=le[kr+dr];for(let Ar=0;Ar<w.outChannels;++Ar)ye[Fn+Ar]+=fr*ge[yr+Ar];yr+=w.outChannels}}}}}}}}return o.makeTensorInfo(se.shape,se.dtype,se.values)}const Eye={kernelName:al,backendName:"cpu",kernelFunc:Cye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _ye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,pad:y,filterShape:A}=c;wn([h,f],"conv3dBackpropFilterV2");const w=Ie(h.shape),C=Ie(f.shape),_=df(h.shape,A,m,1,y),T=_.strideDepth,B=_.strideHeight,O=_.strideWidth,U=_.filterDepth,W=_.filterHeight,z=_.filterWidth,X=new Zs(_.filterShape,"float32"),re=X.values,[se,le,ge,ye]=X.strides,be=o.data.get(f.dataId).values,[Se,Be,Ye,et]=C,tt=o.data.get(h.dataId).values,[ot,st,ct,gt]=w,mt=_.padInfo.front,bt=_.padInfo.left,Vt=_.padInfo.top;for(let Bt=0;Bt<U;++Bt){const $t=Math.max(0,Math.ceil((mt-Bt)/T)),Qt=Math.min(_.outDepth,(_.inDepth+mt-Bt)/T),rn=Bt*se;for(let an=0;an<W;++an){const Dn=Math.max(0,Math.ceil((Vt-an)/B)),Tn=Math.min(_.outHeight,(_.inHeight+Vt-an)/B),Fn=an*le+rn;for(let qn=0;qn<z;++qn){const ni=Math.max(0,Math.ceil((bt-qn)/O)),wi=Math.min(_.outWidth,(_.inWidth+bt-qn)/O),zi=qn*ge+Fn;for(let kr=0;kr<_.inChannels;++kr){const yr=kr*ye+zi;for(let dr=0;dr<_.outChannels;++dr){let fr=0;for(let Ar=0;Ar<_.batchSize;++Ar){const Kr=Ar*ot,qh=Ar*Se;for(let Vo=$t;Vo<Qt;++Vo){const Jh=(Bt+Vo*T-mt)*st+Kr,xl=Vo*Be+qh;for(let $u=Dn;$u<Tn;++$u){const kf=(an+$u*B-Vt)*ct+Jh,Qu=$u*Ye+xl;for(let Uc=ni;Uc<wi;++Uc){const Rf=(qn+Uc*O-bt)*gt+kf,fb=Uc*et+Qu;fr+=tt[Rf+kr]*be[fb+dr]}}}}re[yr+dr]=fr}}}}}return o.makeTensorInfo(X.shape,X.dtype,X.values)}const Iye={kernelName:ks,backendName:"cpu",kernelFunc:_ye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Sye(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{pad:m,strides:y,inputShape:A}=c;wn([h],"conv3dBackpropInputV2");const w=Ie(h.shape),C=Ie(f.shape),_=df(A,f.shape,y,1,m),T=new Zs(_.inShape,"float32"),B=T.values,[O,U,W,z]=T.strides,X=o.data.get(h.dataId).values,[re,se,le,ge]=w,ye=o.data.get(f.dataId).values,[be,Se,Be,Ye]=C,{batchSize:et,filterDepth:tt,filterHeight:ot,filterWidth:st,inChannels:ct,inDepth:gt,inHeight:mt,inWidth:bt,outChannels:Vt,outDepth:Bt,outHeight:$t,outWidth:Qt,strideDepth:rn,strideHeight:an,strideWidth:Dn}=_,Tn=tt-1-_.padInfo.front,Fn=ot-1-_.padInfo.top,qn=st-1-_.padInfo.left;for(let ni=0;ni<et;++ni)for(let wi=0;wi<ct;++wi)for(let zi=0;zi<gt;++zi){const kr=zi-Tn,yr=Math.max(0,Math.ceil(kr/rn)),dr=Math.min(Bt,(tt+kr)/rn);for(let fr=0;fr<mt;++fr){const Ar=fr-Fn,Kr=Math.max(0,Math.ceil(Ar/an)),qh=Math.min($t,(ot+Ar)/an);for(let Vo=0;Vo<bt;++Vo){const Jh=Vo-qn,xl=Math.max(0,Math.ceil(Jh/Dn)),$u=Math.min(Qt,(st+Jh)/Dn);let kf=0;for(let Qu=yr;Qu<dr;++Qu){const Uc=Qu*rn-kr;for(let Rf=Kr;Rf<qh;++Rf){const fb=Rf*an-Ar;for(let HC=xl;HC<$u;++HC){const yLe=HC*Dn-Jh,ALe=re*ni+se*Qu+le*Rf+ge*HC,vLe=be*(tt-1-Uc)+Se*(ot-1-fb)+Be*(st-1-yLe)+Ye*wi;for(let XC=0;XC<Vt;++XC){const bLe=X[ALe+XC],xLe=ye[vLe+XC];kf+=bLe*xLe}}}}B[O*ni+U*zi+W*fr+z*Vo+wi]=kf}}}return o.makeTensorInfo(T.shape,T.dtype,T.values)}const Tye={kernelName:Fl,backendName:"cpu",kernelFunc:Sye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mye=Yi(Io,a=>Math.cos(a)),kye={kernelName:Io,backendName:"cpu",kernelFunc:Mye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Rye=Yi(So,a=>Math.cosh(a)),Lye={kernelName:So,backendName:"cpu",kernelFunc:Rye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bye(a){const{inputs:r,backend:o,attrs:c}=a,{image:h,boxes:f,boxInd:m}=r,{cropSize:y,method:A,extrapolationValue:w}=c,[C,_,T,B]=h.shape,O=f.shape[0],[U,W]=y,z=yi([O,U,W,B],"float32"),X=o.data.get(f.dataId).values,re=o.data.get(m.dataId).values,se=o.data.get(h.dataId).values,le=Ie(h.shape),ge=Ie(z.shape);for(let ye=0;ye<O;ye++){const be=ye*4,Se=X[be],Be=X[be+1],Ye=X[be+2],et=X[be+3],tt=re[ye];if(tt>=C)continue;const ot=U>1?(Ye-Se)*(_-1)/(U-1):0,st=W>1?(et-Be)*(T-1)/(W-1):0;for(let ct=0;ct<U;ct++){const gt=U>1?Se*(_-1)+ct*ot:.5*(Se+Ye)*(_-1);if(gt<0||gt>_-1){for(let mt=0;mt<W;mt++)for(let bt=0;bt<B;bt++){const Vt=bt+mt*ge[2]+ct*ge[1]+ye*ge[0];z.values[Vt]=w}continue}if(A==="bilinear"){const mt=Math.floor(gt),bt=Math.ceil(gt),Vt=gt-mt;for(let Bt=0;Bt<W;Bt++){const $t=W>1?Be*(T-1)+Bt*st:.5*(Be+et)*(T-1);if($t<0||$t>T-1){for(let Dn=0;Dn<B;Dn++){const Tn=Dn+Bt*ge[2]+ct*ge[1]+ye*ge[0];z.values[Tn]=w}continue}const Qt=Math.floor($t),rn=Math.ceil($t),an=$t-Qt;for(let Dn=0;Dn<B;Dn++){let Tn=Dn+Qt*le[2]+mt*le[1]+tt*le[0];const Fn=se[Tn];Tn=Dn+rn*le[2]+mt*le[1]+tt*le[0];const qn=se[Tn];Tn=Dn+Qt*le[2]+bt*le[1]+tt*le[0];const ni=se[Tn];Tn=Dn+rn*le[2]+bt*le[1]+tt*le[0];const wi=se[Tn],zi=Fn+(qn-Fn)*an,kr=ni+(wi-ni)*an;Tn=Dn+Bt*ge[2]+ct*ge[1]+ye*ge[0],z.values[Tn]=zi+(kr-zi)*Vt}}}else for(let mt=0;mt<W;++mt){const bt=W>1?Be*(T-1)+mt*st:.5*(Be+et)*(T-1);if(bt<0||bt>T-1){for(let $t=0;$t<B;$t++){const Qt=$t+mt*ge[2]+ct*ge[1]+ye*ge[0];z.values[Qt]=w}continue}const Vt=Math.round(bt),Bt=Math.round(gt);for(let $t=0;$t<B;$t++){const Qt=$t+Vt*le[2]+Bt*le[1]+tt*le[0],rn=$t+mt*ge[2]+ct*ge[1]+ye*ge[0];z.values[rn]=se[Qt]}}}}return o.makeTensorInfo(z.shape,z.dtype,z.values)}const Pye={kernelName:Ac,backendName:"cpu",kernelFunc:Bye};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,exclusive:m,reverse:y}=c;wn(h,"cumprod");const A=Tr([f],h.shape.length);let w=h;A!=null&&(w=ga({inputs:{x:h},backend:o,attrs:{perm:A}}));const C=Hr(1,h.shape.length)[0];if(C!==w.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${w.shape.length-1} but got axis=${C}`);const _=Ua(w.dtype,"int32"),T=xt(M(w.shape),_),B=o.data.get(w.dataId).values,O=w.shape[w.shape.length-1],U=y?(z,X)=>z+O-X-1:(z,X)=>z+X;for(let z=0;z<B.length;z+=O)for(let X=0;X<O;X++){const re=U(z,X);if(X===0)T[re]=m?1:B[re];else{const se=U(z,X-1);T[re]=m?B[se]*T[se]:B[re]*T[se]}}const W=o.makeTensorInfo(w.shape,_,T);if(A!=null){const z=ff(A),X=ga({inputs:{x:W},backend:o,attrs:{perm:z}});return o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(w),X}return W}const Dye={kernelName:na,backendName:"cpu",kernelFunc:Nye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,exclusive:m,reverse:y}=c;wn(h,"cumsum");const A=Tr([f],h.shape.length);let w=h;A!=null&&(w=ga({inputs:{x:h},backend:o,attrs:{perm:A}}));const C=Hr(1,h.shape.length)[0];if(C!==w.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${w.shape.length-1} but got axis=${C}`);const _=Ua(w.dtype,"int32"),T=At(M(w.shape),_),B=o.data.get(w.dataId).values,O=w.shape[w.shape.length-1],U=y?(z,X)=>z+O-X-1:(z,X)=>z+X;for(let z=0;z<B.length;z+=O)for(let X=0;X<O;X++){const re=U(z,X);if(X===0)T[re]=m?0:B[re];else{const se=U(z,X-1);T[re]=m?B[se]+T[se]:B[re]+T[se]}}const W=o.makeTensorInfo(w.shape,_,T);if(A!=null){const z=ff(A),X=ga({inputs:{x:W},backend:o,attrs:{perm:z}});return o.disposeIntermediateTensorInfo(W),o.disposeIntermediateTensorInfo(w),X}return W}const Oye={kernelName:ro,backendName:"cpu",kernelFunc:Fye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,weights:f}=r,{size:m,binaryOutput:y}=c;if(h.shape.length===1){const A=o.data.get(h.dataId).values,w=o.data.get(f.dataId).values,C=AR(A,w,f.dtype,f.shape,m);return o.makeTensorInfo([m],f.dtype,C)}else if(h.shape.length===2){const A=o.bufferSync(h),w=o.bufferSync(f),C=h4(A,w,m,y);return o.makeTensorInfo(C.shape,f.dtype,C.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${h.shape.length}.`)}const Uye={kernelName:uu,backendName:"cpu",kernelFunc:Vye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockSize:f,dataFormat:m}=c;b(m==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${m}`);const y=h.shape[0],A=h.shape[1],w=h.shape[2],C=h.shape[3],_=A*f,T=w*f,B=C/(f*f),O=o.data.get(h.dataId).values,U=new Float32Array(y*_*T*B);let W=0;for(let z=0;z<y;++z)for(let X=0;X<_;++X){const re=Math.floor(X/f),se=X%f;for(let le=0;le<T;++le){const ge=Math.floor(le/f),ye=le%f,be=(se*f+ye)*B;for(let Se=0;Se<B;++Se){const Be=Se+be+C*(ge+w*(re+A*z));U[W++]=O[Be]}}}return o.makeTensorInfo([y,_,T,B],h.dtype,U)}const Gye={kernelName:_h,backendName:"cpu",kernelFunc:zye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function m9(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dilations:A,dimRoundingMode:w}=c;wn([h,f],"depthwiseConv2DNative");const C=Ie(h.shape),_=Ie(f.shape);let T=A;T==null&&(T=[1,1]),b(fo(m,T),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${m} and dilations '${T}'`);const B=js(h.shape,f.shape,m,T,y,w,!0),{filterHeight:O,filterWidth:U,dilationHeight:W,dilationWidth:z,padInfo:X}=B,re=X.left,se=X.top,le=B.outChannels/B.inChannels,ge=new Zs(B.outShape,h.dtype),ye=o.data.get(h.dataId).values,be=o.data.get(f.dataId).values,Se=ge.values;for(let Be=0;Be<B.batchSize;++Be){const Ye=Be*C[0],et=Be*ge.strides[0];for(let tt=0;tt<B.outHeight;++tt){const ot=et+tt*ge.strides[1],st=tt*B.strideHeight-se;for(let ct=0;ct<O;++ct){const gt=st+ct*W;if(gt<0||gt>=B.inHeight)continue;const mt=ct*_[0],bt=Ye+gt*C[1];for(let Vt=0;Vt<B.outWidth;++Vt){const Bt=ot+Vt*ge.strides[2],$t=Vt*B.strideWidth-re;for(let Qt=0;Qt<U;++Qt){const rn=$t+Qt*z;if(rn<0||rn>=B.inWidth)continue;const an=mt+Qt*_[1],Dn=bt+rn*B.inChannels;let Tn=Bt,Fn=an;for(let qn=0;qn<B.inChannels;++qn){const ni=ye[Dn+qn];for(let wi=0;wi<le;++wi)Se[Tn+wi]+=ni*be[Fn+wi];Tn+=le,Fn+=le}}}}}}return o.makeTensorInfo(ge.shape,ge.dtype,ge.values)}const Wye={kernelName:ll,backendName:"cpu",kernelFunc:m9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Hye(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,dilations:y,pad:A,dimRoundingMode:w,filterShape:C}=c;wn([h,f],"depthwiseConv2dNativeBackpropFilter");const _=js(h.shape,C,m,y,A,w,!0),{strideHeight:T,strideWidth:B,filterHeight:O,filterWidth:U}=_,W=new Zs(_.filterShape,"float32"),z=_.padInfo.left,X=_.padInfo.top,re=_.outChannels/_.inChannels,se=o.data.get(h.dataId).values,le=new Zs(h.shape,h.dtype,se),ge=o.data.get(f.dataId).values,ye=new Zs(f.shape,f.dtype,ge);for(let be=0;be<O;++be){const Se=Math.max(0,Math.ceil((X-be)/T)),Be=Math.min(_.outHeight,(_.inHeight+X-be)/T);for(let Ye=0;Ye<U;++Ye){const et=Math.max(0,Math.ceil((z-Ye)/B)),tt=Math.min(_.outWidth,(_.inWidth+z-Ye)/B);for(let ot=0;ot<_.outChannels;++ot){const st=Math.trunc(ot/re),ct=ot%re;let gt=0;for(let mt=0;mt<_.batchSize;++mt)for(let bt=Se;bt<Be;++bt){const Vt=be+bt*T-X;for(let Bt=et;Bt<tt;++Bt){const $t=Ye+Bt*B-z;gt+=le.get(mt,Vt,$t,st)*ye.get(mt,bt,Bt,ot)}}W.set(gt,be,Ye,st,ct)}}}return o.makeTensorInfo(W.shape,W.dtype,W.values)}const Xye={kernelName:hu,backendName:"cpu",kernelFunc:Hye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $ye(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{strides:m,dilations:y,pad:A,dimRoundingMode:w,inputShape:C}=c;wn([h,f],"depthwiseConv2DNativeBackpropInput");const _=Ie(h.shape),T=Ie(f.shape),B=js(C,f.shape,m,y,A,w,!0),O=new Zs(B.inShape,"float32"),U=O.values,[W,z,X]=O.strides,re=o.data.get(h.dataId).values,[se,le,ge]=_,ye=o.data.get(f.dataId).values,[be,Se,Be]=T,{batchSize:Ye,filterHeight:et,filterWidth:tt,inChannels:ot,inHeight:st,inWidth:ct,outChannels:gt,outHeight:mt,outWidth:bt,strideHeight:Vt,strideWidth:Bt}=B,$t=et-1-B.padInfo.top,Qt=tt-1-B.padInfo.left,rn=gt/ot;for(let an=0;an<Ye;++an)for(let Dn=0;Dn<ot;++Dn)for(let Tn=0;Tn<st;++Tn){const Fn=Tn-$t,qn=Math.max(0,Math.ceil(Fn/Vt)),ni=Math.min(mt,(et+Fn)/Vt);for(let wi=0;wi<ct;++wi){const zi=wi-Qt,kr=Math.max(0,Math.ceil(zi/Bt)),yr=Math.min(bt,(tt+zi)/Bt);let dr=0;for(let fr=qn;fr<ni;++fr){const Ar=fr*Vt-Fn;for(let Kr=kr;Kr<yr;++Kr){const qh=Kr*Bt-zi,Vo=se*an+le*fr+ge*Kr,Jh=be*(et-1-Ar)+Se*(tt-1-qh)+Be*Dn;for(let xl=0;xl<rn;++xl){const $u=Dn*rn+xl,kf=re[Vo+$u],Qu=ye[Jh+xl];dr+=kf*Qu}}}U[W*an+z*Tn+X*wi+Dn]=dr}}return o.makeTensorInfo(O.shape,O.dtype,O.values)}const Qye={kernelName:Ol,backendName:"cpu",kernelFunc:$ye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Kye(a){const{inputs:r,backend:o}=a,{x:c}=r,h=M(c.shape),f=o.data.get(c.dataId).values,m=yi([h,h],c.dtype),y=m.values;for(let w=0;w<f.length;w++)y[w*h+w]=f[w];const A=[...c.shape,...c.shape];return o.makeTensorInfo(A,m.dtype,m.values)}const Zye={kernelName:Vl,backendName:"cpu",kernelFunc:Kye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const jye={kernelName:pe,backendName:"cpu",kernelFunc:({inputs:a,backend:r,attrs:o})=>{const{x:c,filter:h}=a,{strides:f,pad:m,dilations:y}=o,A=r,w=A.data.get(c.dataId).values,C=c.shape.length,_=A.data.get(h.dataId).values,T=h.shape.length,{batchSize:B,inHeight:O,inWidth:U,inChannels:W,outHeight:z,outWidth:X,padInfo:re,strideHeight:se,strideWidth:le,filterHeight:ge,filterWidth:ye,dilationHeight:be,dilationWidth:Se,outShape:Be}=xv(c.shape,h.shape,f,m,"NHWC",y),Ye=M(Be),et=Be.length,tt=Q(c.dtype,Ye);for(let ot=0;ot<B;++ot)for(let st=0;st<z;++st){const ct=st*se-re.top;for(let gt=0;gt<X;++gt){const mt=gt*le-re.left;for(let bt=0;bt<W;++bt){let Vt=Number.MIN_SAFE_INTEGER;for(let $t=0;$t<ge;++$t){const Qt=ct+$t*be;if(Qt>=0&&Qt<O)for(let rn=0;rn<ye;++rn){const an=mt+rn*Se;if(an>=0&&an<U){const Dn=Ze([ot,Qt,an,bt],C,Ie(c.shape)),Tn=Ze([$t,rn,bt],T,Ie(h.shape)),Fn=w[Dn]+_[Tn];Fn>Vt&&(Vt=Fn)}}}const Bt=Ze([ot,st,gt,bt],et,Ie(Be));tt[Bt]=Vt}}}return{dataId:A.write(Uh(tt,c.dtype),Be,c.dtype),shape:Be,dtype:c.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yye={kernelName:nt,backendName:"cpu",kernelFunc:({inputs:a,backend:r,attrs:o})=>{const{x:c,filter:h,dy:f}=a,{strides:m,pad:y,dilations:A}=o,w=r,C=dt(c.shape,w.data.get(c.dataId).values),_=dt(h.shape,w.data.get(h.dataId).values),{batchSize:T,inHeight:B,inWidth:O,inChannels:U,outHeight:W,outWidth:z,padInfo:X,strideHeight:re,strideWidth:se,filterHeight:le,filterWidth:ge,dilationHeight:ye,dilationWidth:be,outShape:Se}=xv(c.shape,h.shape,m,y,"NHWC",A);b(f.rank===Se.length,()=>`Error in ${nt}, dy must have the same rank as output ${Se.length}, but got ${f.rank}`);const Be=dt(Se,w.data.get(f.dataId).values),Ye=Rt(h.shape,h.dtype);for(let et=0;et<T;++et)for(let tt=0;tt<W;++tt){const ot=tt*re-X.top;for(let st=0;st<z;++st){const ct=st*se-X.left;for(let gt=0;gt<U;++gt){let mt=Number.MIN_SAFE_INTEGER,bt=0,Vt=0;for(let Bt=0;Bt<le;++Bt){const $t=ot+Bt*ye;if($t>=0&&$t<B)for(let Qt=0;Qt<ge;++Qt){const rn=ct+Qt*be;if(rn>=0&&rn<O){const an=C[et][$t][rn][gt]+_[Bt][Qt][gt];an>mt&&(mt=an,bt=Bt,Vt=Qt)}}}Ye[bt][Vt][gt]+=Be[et][tt][st][gt]}}}return{dataId:w.write(Uh(Ye,c.dtype),h.shape,h.dtype),shape:h.shape,dtype:h.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qye={kernelName:ze,backendName:"cpu",kernelFunc:({inputs:a,backend:r,attrs:o})=>{const{x:c,filter:h,dy:f}=a,{strides:m,pad:y,dilations:A}=o,w=r,C=dt(c.shape,w.data.get(c.dataId).values),_=dt(h.shape,w.data.get(h.dataId).values),{batchSize:T,inHeight:B,inWidth:O,inChannels:U,outHeight:W,outWidth:z,padInfo:X,strideHeight:re,strideWidth:se,filterHeight:le,filterWidth:ge,dilationHeight:ye,dilationWidth:be,outShape:Se}=xv(c.shape,h.shape,m,y,"NHWC",A);b(f.rank===Se.length,()=>`Error in ${ze}, dy must have the same rank as output ${Se.length}, but got ${f.rank}`);const Be=dt(Se,w.data.get(f.dataId).values),Ye=Rt(c.shape,c.dtype);for(let et=0;et<T;++et)for(let tt=0;tt<W;++tt){const ot=tt*re-X.top;for(let st=0;st<z;++st){const ct=st*se-X.left;for(let gt=0;gt<U;++gt){let mt=Number.MIN_SAFE_INTEGER,bt=ot<0?0:ot,Vt=ct<0?0:ct;for(let Bt=0;Bt<le;++Bt){const $t=ot+Bt*ye;if($t>=0&&$t<B)for(let Qt=0;Qt<ge;++Qt){const rn=ct+Qt*be;if(rn>=0&&rn<O){const an=C[et][$t][rn][gt]+_[Bt][Qt][gt];an>mt&&(mt=an,bt=$t,Vt=rn)}}}Ye[et][bt][Vt][gt]+=Be[et][tt][st][gt]}}}return{dataId:w.write(Uh(Ye,c.dtype),c.shape,c.dtype),shape:c.shape,dtype:c.dtype}}};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jye(a){const{inputs:r,backend:o,attrs:c}=a,{image:h}=r,{canvas:f,options:m}=c,{contextOptions:y,imageOptions:A}=m||{},w=(A==null?void 0:A.alpha)||1,C=(y==null?void 0:y.contextType)||"2d";if(C!=="2d")throw new Error(`Context type ${y.contextType} is not supported by the CPU backend.`);const _=f.getContext(C,(y==null?void 0:y.contextAttributes)||{});if(_==null)throw new Error(`Could not get the context with ${C} type.`);const[T,B]=h.shape.slice(0,2),O=h.shape.length===2?1:h.shape[2],U=o.data.get(h.dataId).values,W=h.dtype==="float32"?255:1,z=new Uint8ClampedArray(B*T*4);for(let re=0;re<T*B;++re){const se=[0,0,0,255*w];for(let ge=0;ge<O;ge++){const ye=U[re*O+ge];if(h.dtype==="float32"){if(ye<0||ye>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${ye}.`)}else if(h.dtype==="int32"&&(ye<0||ye>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${ye}.`);O===1?(se[0]=ye*W,se[1]=ye*W,se[2]=ye*W):se[ge]=ye*W}const le=re*4;z[le+0]=Math.round(se[0]),z[le+1]=Math.round(se[1]),z[le+2]=Math.round(se[2]),z[le+3]=Math.round(se[3])}f.width=B,f.height=T;const X=new ImageData(z,B,T);return _.putImageData(X,0,0),h}const eAe={kernelName:rt,backendName:"cpu",kernelFunc:Jye};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qv(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;wn(h,"sum");let y;h.dtype==="bool"?y=_f({inputs:{x:h},backend:o,attrs:{dtype:"int32"}}):y=zu({inputs:{x:h},backend:o});const A=y.shape.length,w=q(f,y.shape),C=Tr(w,A);let _=w,T=y;C!=null&&(T=ga({inputs:{x:y},backend:o,attrs:{perm:C}}),_=Hr(_.length,A)),Ys("sum",_,T.shape.length);const[B,O]=Ps(T.shape,_),U=Ua(T.dtype,"int32");let W=pC(o,B,U);const z=M(O),X=o.data.get(W.dataId).values,re=o.data.get(T.dataId).values;for(let se=0;se<X.length;++se){const le=se*z;let ge=0;for(let ye=0;ye<z;++ye)ge+=re[le+ye];X[se]=ge}if(m){const se=ns(W.shape,w),le=W;W=hr({inputs:{x:W},backend:o,attrs:{shape:se}}),o.disposeIntermediateTensorInfo(le)}return o.disposeIntermediateTensorInfo(y),C!=null&&o.disposeIntermediateTensorInfo(T),W}const tAe={kernelName:so,backendName:"cpu",kernelFunc:qv};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nAe(a){const{inputs:r,backend:o,attrs:c}=a,{equation:h}=c,f=r,{allDims:m,summedDims:y,idDims:A}=_k(h,f.length);Sk(m.length,A,f);const{path:w,steps:C}=Tk(y,A),_=C.length;let T=null,B=m.length;const O=[];for(let U=0;U<_;++U){for(const W of C[U]){const{permutationIndices:z,expandDims:X}=Ik(B,A[W]);let re;Mk(z)?re=f[W]:(re=ga({inputs:{x:f[W]},backend:o,attrs:{perm:z}}),O.push(re));const se=re.shape.slice();for(let le=0;le<X.length;++le)se.splice(X[le],0,1);R(re.shape,se)||(re=hr({inputs:{x:re},backend:o,attrs:{shape:se}}),O.push(re)),T===null?T=re:(T=mC({inputs:{a:re,b:T},backend:o}),O.push(T))}U<_-1&&(w[U]>=0&&(T=qv({inputs:{x:T},backend:o,attrs:{axis:w[U]-(m.length-B),keepDims:!1}}),O.push(T)),B--)}for(const U of O)U!==T&&o.disposeIntermediateTensorInfo(U);return T}const iAe={kernelName:Nt,backendName:"cpu",kernelFunc:nAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rAe(a){const{inputs:r,backend:o}=a,{dy:c,y:h}=r;wn([c,h],"eluGrad");const f=new Float32Array(M(h.shape)),m=o.data.get(h.dataId).values,y=o.data.get(c.dataId).values;for(let A=0;A<m.length;++A){const w=m[A];w>=0?f[A]=y[A]:f[A]=y[A]*(w+1)}return o.makeTensorInfo(h.shape,"float32",f)}const sAe={kernelName:on,backendName:"cpu",kernelFunc:rAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oAe=yk,aAe=Ak,lAe=vk,cAe=bk,uAe=xk,hAe=wk,dAe=Yi(dn,a=>{const r=Math.sign(a),o=Math.abs(a),c=1/(1+oAe*o);return r*(1-((((hAe*c+uAe)*c+cAe)*c+lAe)*c+aAe)*c*Math.exp(-o*o))}),fAe={kernelName:dn,backendName:"cpu",kernelFunc:dAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function AC(a){const{inputs:r,backend:o,attrs:c}=a,{input:h}=r,{dim:f}=c,m=h.shape.length,y=h.shape.slice();let A=f;return f<0&&(b(-(m+1)<=f,()=>`Axis must be in the interval [${-(m+1)}, ${m}]`),A=m+f+1),y.splice(A,0,1),hr({inputs:{x:h},backend:o,attrs:{shape:y}})}const pAe={kernelName:zt,backendName:"cpu",kernelFunc:AC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mAe=Qr((a,r)=>a/r),ER=ws(Ge,mAe),_R={kernelName:Ge,backendName:"cpu",kernelFunc:ER};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function g9(a,r,o){const c=a.shape,h=c[0],f=c[1],m=o.data.get(a.dataId),y=m.complexTensorInfos.real,A=m.complexTensorInfos.imag,w=[h,f],C=M(w),_=K("float32",C),T=K("float32",C);for(let W=0;W<h;W++){const z=Lm({inputs:{x:y},backend:o,attrs:{begin:[W,0],size:[1,f]}}),X=Lm({inputs:{x:A},backend:o,attrs:{begin:[W,0],size:[1,f]}}),re=Wa({inputs:{real:z,imag:X},backend:o}),{real:se,imag:le}=gAe(re,r,o),ge=$h(se,le);for(let ye=0;ye<f;ye++){const be=Ck(ge,ye);_[W*f+ye]=be.real,T[W*f+ye]=be.imag}o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(re)}const B=o.makeTensorInfo(w,"float32",_),O=o.makeTensorInfo(w,"float32",T),U=Wa({inputs:{real:B,imag:O},backend:o});return o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),U}function gAe(a,r,o){const c=M(a.shape),h=o.data.get(a.dataId),f=o.data.get(h.complexTensorInfos.real.dataId).values,m=o.data.get(h.complexTensorInfos.imag.dataId).values;if(yAe(c)){const y=IR(f,m,c,r,o),A=[a.shape[0],a.shape[1]];if(r){const w=o.makeTensorInfo(A,"float32",y.real),C=o.makeTensorInfo(A,"float32",y.imag),_=o.makeTensorInfo([],"float32",Br(c,"float32")),T=zu({inputs:{x:_},backend:o}),B=_R.kernelFunc({inputs:{a:w,b:_},backend:o}),O=_R.kernelFunc({inputs:{a:C,b:T},backend:o}),U=o.data.get(B.dataId).values,W=o.data.get(O.dataId).values;return o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),{real:U,imag:W}}return y}else{const y=$h(f,m),A=AAe(y,c,r);return Kz(A)}}function yAe(a){return(a&a-1)===0}function IR(a,r,o,c,h){if(o===1)return{real:a,imag:r};const f=$h(a,r),m=o/2,y=Zz(f),A=y.real,w=y.imag,C=[A.length],_=h.makeTensorInfo(C,"float32",A),T=h.makeTensorInfo(C,"float32",w),B=Wa({inputs:{real:_,imag:T},backend:h}),O=jz(f),U=O.real,W=O.imag,z=[U.length],X=h.makeTensorInfo(z,"float32",U),re=h.makeTensorInfo(z,"float32",W),se=Wa({inputs:{real:X,imag:re},backend:h}),le=IR(A,w,m,c,h),ge=le.real,ye=le.imag,be=[ge.length],Se=h.makeTensorInfo(be,"float32",ge),Be=h.makeTensorInfo(be,"float32",ye),Ye=Wa({inputs:{real:Se,imag:Be},backend:h}),et=IR(U,W,m,c,h),tt=et.real,ot=et.imag,st=[tt.length],ct=h.makeTensorInfo(st,"float32",tt),gt=h.makeTensorInfo(st,"float32",ot),mt=Wa({inputs:{real:ct,imag:gt},backend:h}),bt=qz(o,c),Vt=[bt.real.length],Bt=h.makeTensorInfo(Vt,"float32",bt.real),$t=h.makeTensorInfo(Vt,"float32",bt.imag),Qt=Wa({inputs:{real:Bt,imag:$t},backend:h}),rn=mC({inputs:{a:Qt,b:mt},backend:h}),an=W0({inputs:{a:Ye,b:rn},backend:h}),Dn=wR({inputs:{a:Ye,b:rn},backend:h}),Tn=km({inputs:{input:an},backend:h}),Fn=km({inputs:{input:Dn},backend:h}),qn=H0({inputs:{input:an},backend:h}),ni=H0({inputs:{input:Dn},backend:h}),wi=X0({inputs:[Tn,Fn],backend:h,attrs:{axis:0}}),zi=X0({inputs:[qn,ni],backend:h,attrs:{axis:0}}),kr=h.data.get(wi.dataId).values,yr=h.data.get(zi.dataId).values;return h.disposeIntermediateTensorInfo(_),h.disposeIntermediateTensorInfo(T),h.disposeIntermediateTensorInfo(B),h.disposeIntermediateTensorInfo(X),h.disposeIntermediateTensorInfo(re),h.disposeIntermediateTensorInfo(se),h.disposeIntermediateTensorInfo(Se),h.disposeIntermediateTensorInfo(Be),h.disposeIntermediateTensorInfo(Ye),h.disposeIntermediateTensorInfo(ct),h.disposeIntermediateTensorInfo(gt),h.disposeIntermediateTensorInfo(mt),h.disposeIntermediateTensorInfo(Bt),h.disposeIntermediateTensorInfo($t),h.disposeIntermediateTensorInfo(Qt),h.disposeIntermediateTensorInfo(rn),h.disposeIntermediateTensorInfo(an),h.disposeIntermediateTensorInfo(Dn),h.disposeIntermediateTensorInfo(Tn),h.disposeIntermediateTensorInfo(qn),h.disposeIntermediateTensorInfo(Fn),h.disposeIntermediateTensorInfo(ni),h.disposeIntermediateTensorInfo(wi),h.disposeIntermediateTensorInfo(zi),{real:kr,imag:yr}}function AAe(a,r,o){const c=new Float32Array(r*2);for(let h=0;h<r;h++){let f=0,m=0;for(let y=0;y<r;y++){const A=Jz(h*y,r,o),w=Ck(a,y);f+=w.real*A.real-w.imag*A.imag,m+=w.real*A.imag+w.imag*A.real}o&&(f/=r,m/=r),Yz(c,f,m,h)}return c}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vAe(a){const{inputs:r,backend:o}=a,{input:c}=r,h=M(c.shape),f=c.shape[c.shape.length-1],m=h/f,y=hr({inputs:{x:c},backend:o,attrs:{shape:[m,f]}}),A=g9(y,!1,o),w=hr({inputs:{x:A},backend:o,attrs:{shape:c.shape}});return o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(A),w}const bAe={kernelName:Hn,backendName:"cpu",kernelFunc:vAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SR(a){const{backend:r,attrs:o}=a,{shape:c,value:h,dtype:f}=o,m=f||Ne(h),y=Q(m,M(c));return wAe(y,h),r.makeTensorInfo(c,m,y)}const xAe={kernelName:Ci,backendName:"cpu",kernelFunc:SR};function wAe(a,r,o){a.fill(r)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CAe={kernelName:bi,backendName:"cpu",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{image:c}=a,h=o,f=K(c.dtype,M(c.shape)),[m,y,A,w]=c.shape,C=h.data.get(c.dataId).values;for(let _=0;_<m;_++){const T=_*A*y*w;for(let B=0;B<y;B++){const O=B*(A*w);for(let U=0;U<A;U++){const W=U*w;for(let z=0;z<w;z++){const X=Math.round(A-U-1),re=T+O+W+z;let se=C[re];if(X>=0&&X<A){const le=X*w,ge=T+O+le+z;se=C[ge]}f[re]=se}}}}return{dataId:h.write(f,c.shape,c.dtype),shape:c.shape,dtype:c.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EAe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f,bias:m,preluActivationWeights:y}=r,{strides:A,pad:w,dataFormat:C,dilations:_,dimRoundingMode:T,activation:B,leakyreluAlpha:O}=c;let U=p9({inputs:{x:h,filter:f},backend:o,attrs:{strides:A,pad:w,dataFormat:C,dilations:_,dimRoundingMode:T}});if(m){const W=U;if(C==="NCHW"&&m.shape.length===1&&m.shape[0]!==1){const z=hr({inputs:{x:m},backend:o,attrs:{shape:[m.shape[0],1,1]}});U=W0({inputs:{a:U,b:z},backend:o}),o.disposeIntermediateTensorInfo(z)}else U=W0({inputs:{a:U,b:m},backend:o});o.disposeIntermediateTensorInfo(W)}if(B){const W=U;if(C==="NCHW"&&B==="prelu"&&y.shape.length===1&&y.shape[0]!==1){const z=hr({inputs:{x:y},backend:o,attrs:{shape:[y.shape[0],1,1]}});U=yC(o,U,B,z,O),o.disposeIntermediateTensorInfo(z)}else U=yC(o,U,B,y,O);o.disposeIntermediateTensorInfo(W)}return U}const _Ae={kernelName:Nh,backendName:"cpu",kernelFunc:EAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IAe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f,bias:m,preluActivationWeights:y}=r,{strides:A,pad:w,dataFormat:C,dilations:_,dimRoundingMode:T,activation:B,leakyreluAlpha:O}=c;let U=m9({inputs:{x:h,filter:f},backend:o,attrs:{strides:A,pad:w,dataFormat:C,dilations:_,dimRoundingMode:T}});if(m){const W=U;U=W0({inputs:{a:U,b:m},backend:o}),o.disposeIntermediateTensorInfo(W)}if(B){const W=U;U=yC(o,U,B,y,O),o.disposeIntermediateTensorInfo(W)}return U}const SAe={kernelName:A0,backendName:"cpu",kernelFunc:IAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TAe(a){const{inputs:r,backend:o}=a,{params:c,indices:h}=r,f=M(c.shape),m=h.shape,y=m[m.length-1],[A,w,C,_]=sk(c,h);if(w===0)return o.makeTensorInfo(A,c.dtype,[]);const T=o.data.get(h.dataId).values,B=o.bufferSync(c),O=w4(T,B,c.dtype,w,y,C,_,c.shape,f);return o.makeTensorInfo(A,c.dtype,O.values)}const MAe={kernelName:ti,backendName:"cpu",kernelFunc:TAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kAe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,indices:f}=r,{axis:m,batchDims:y}=c;wn([h,f],"gatherV2");const A=q(m,h.shape)[0],w=o.data.get(f.dataId).values,C=h.shape[A];for(let se=0;se<w.length;++se){const le=w[se];b(le<=C-1&&le>=0,()=>`GatherV2: the index value ${le} is not in [0, ${C-1}]`)}let _=y;y==null&&(_=0);const T=M(f.shape),B=Lk(h,f,A,_),O=hr({inputs:{x:h},backend:o,attrs:{shape:[B.batchSize,B.outerSize,B.dimSize,B.sliceSize]}}),U=hr({inputs:{x:f},backend:o,attrs:{shape:[B.batchSize,T/B.batchSize]}}),W=[B.batchSize,B.outerSize,T/B.batchSize,B.sliceSize],z=o.bufferSync(U),X=o.bufferSync(O),re=C4(X,z,W);return o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(U),o.makeTensorInfo(B.outputShape,re.dtype,re.values)}const RAe={kernelName:us,backendName:"cpu",kernelFunc:kAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LAe(a){const{inputs:r,backend:o}=a,{input:c}=r,h=M(c.shape),f=c.shape[c.shape.length-1],m=h/f,y=hr({inputs:{x:c},backend:o,attrs:{shape:[m,f]}}),A=g9(y,!0,o),w=hr({inputs:{x:A},backend:o,attrs:{shape:c.shape}});return o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(A),w}const BAe={kernelName:ds,backendName:"cpu",kernelFunc:LAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PAe=Yi(Vi,a=>Number.isFinite(a)?1:0,"bool"),NAe={kernelName:Vi,backendName:"cpu",kernelFunc:PAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DAe=Yi(pr,a=>Math.abs(a)===1/0?1:0,"bool"),FAe={kernelName:pr,backendName:"cpu",kernelFunc:DAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OAe=Yi(mi,a=>Number.isNaN(a)?1:0,"bool"),VAe={kernelName:mi,backendName:"cpu",kernelFunc:OAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UAe(a){const{backend:r,attrs:o}=a,{start:c,stop:h,num:f}=o,m=T4(c,h,f);return r.makeTensorInfo([m.length],"float32",m)}const zAe={kernelName:Ih,backendName:"cpu",kernelFunc:UAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GAe=Yi(To,a=>Math.log1p(a)),WAe={kernelName:To,backendName:"cpu",kernelFunc:GAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HAe=Qr((a,r)=>a&&r),XAe=ws(du,HAe,null,"bool"),$Ae={kernelName:du,backendName:"cpu",kernelFunc:XAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QAe=Yi(vc,a=>a?0:1,"bool"),KAe={kernelName:vc,backendName:"cpu",kernelFunc:QAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ZAe=Qr((a,r)=>a||r),jAe=ws(Sh,ZAe,null,"bool"),YAe={kernelName:Sh,backendName:"cpu",kernelFunc:jAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qAe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{depthRadius:f,bias:m,alpha:y,beta:A}=c;wn(h,"LRN");const w=h.shape[3],C=w-1,_=o.data.get(h.dataId).values,T=M(h.shape),B=new Float32Array(T);function O(U){const W=U%w;let z=U-W+Math.max(0,W-f);const X=U-W+Math.min(W+f,C);let re=0;for(;z<=X;z++){const se=_[z];re+=se*se}return re}for(let U=0;U<T;U++){const W=O(U),z=_[U]*Math.pow(m+y*W,-A);B[U]=z}return o.makeTensorInfo(h.shape,h.dtype,B)}const JAe={kernelName:Zd,backendName:"cpu",kernelFunc:qAe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,y:f,dy:m}=r,{depthRadius:y,bias:A,alpha:w,beta:C}=c;wn(m,"LRNGrad");const _=M(m.shape),T=m.shape[3],B=o.data.get(m.dataId).values,O=o.data.get(h.dataId).values,U=o.data.get(f.dataId).values,W=new Float32Array(_),z=_;for(let X=0;X<z;X++){const re=X%T,se=X-re+Math.max(0,re-y),le=X-re+Math.min(T,re+y+1);let ge=0;for(let ye=se;ye<le;ye++)ge+=Math.pow(O[ye],2);ge=w*ge+A;for(let ye=se;ye<le;ye++){let be=-2*w*C*O[ye]*U[X]/ge;X===ye&&(be+=Math.pow(ge,-C)),be*=B[X],W[ye]+=be}}return o.makeTensorInfo(m.shape,h.dtype,W)}const tve={kernelName:Xn,backendName:"cpu",kernelFunc:eve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function y9(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{reductionIndices:f,keepDims:m}=c,y=o;let A=h.shape;const w=A.length,C=q(f,A);let _=C;const T=Tr(_,w);let B=y.data.get(h.dataId).values;if(T!=null){const se=new Array(w);for(let le=0;le<se.length;le++)se[le]=A[T[le]];B=bR(B,A,h.dtype,T,se),_=Hr(_.length,w),A=se}wn(h,"max"),Ys("max",_,w);const[O,U]=Ps(A,_),W=M(U),z=k4(B,W,O,h.dtype),X=y.write(z,O,h.dtype);let re=O;return m&&(re=ns(O,C)),{dataId:X,shape:re,dtype:h.dtype}}const nve={kernelName:ps,backendName:"cpu",kernelFunc:y9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ive(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r;wn(h,"maxPool");const{filterSize:f,strides:m,pad:y,dimRoundingMode:A}=c,w=1;b(fo(m,w),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${m} and dilations '${w}'`);const C=Hl(h.shape,f,m,w,y,A);let _;if(C.filterWidth===1&&C.filterHeight===1&&R(C.inShape,C.outShape))_=zu({inputs:{x:h},backend:o});else{const T=o.data.get(h.dataId).values,B=Ie(h.shape),O=CR(T,h.shape,h.dtype,B,C,"max");_=o.makeTensorInfo(C.outShape,h.dtype,O.values)}return _}const rve={kernelName:ul,backendName:"cpu",kernelFunc:ive};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{filterSize:f,strides:m,pad:y,dimRoundingMode:A,dataFormat:w}=c;wn(h,"maxPool3d");const C=Gh(h.shape,f,m,1,y,A,w),_=o.data.get(h.dataId).values,T=f9(_,h.shape,h.dtype,Ie(h.shape),C,"max");return o.makeTensorInfo(T.shape,"float32",T.values)}const ove={kernelName:bc,backendName:"cpu",kernelFunc:sve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ave(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,{filterSize:m,strides:y,pad:A,dimRoundingMode:w}=c;wn([h,f],"maxPool3DGrad");const C=Gh(f.shape,m,y,1,A,w),_=o.bufferSync(f),T=j0e(_,C),B=C.strideDepth,O=C.strideHeight,U=C.strideWidth,W=C.dilationDepth,z=C.dilationHeight,X=C.dilationWidth,re=C.effectiveFilterDepth,se=C.effectiveFilterHeight,le=C.effectiveFilterWidth,ge=re-1-C.padInfo.front,ye=le-1-C.padInfo.left,be=se-1-C.padInfo.top,Se=yi(f.shape,"float32"),Be=o.bufferSync(h);for(let Ye=0;Ye<C.batchSize;++Ye)for(let et=0;et<C.inChannels;++et)for(let tt=0;tt<C.inDepth;++tt)for(let ot=0;ot<C.inHeight;++ot)for(let st=0;st<C.inWidth;++st){const ct=tt-ge,gt=ot-be,mt=st-ye;let bt=0;for(let Vt=0;Vt<re;Vt+=W){const Bt=(ct+Vt)/B;if(!(Bt<0||Bt>=C.outDepth||Math.floor(Bt)!==Bt))for(let $t=0;$t<se;$t+=z){const Qt=(gt+$t)/O;if(!(Qt<0||Qt>=C.outHeight||Math.floor(Qt)!==Qt))for(let rn=0;rn<le;rn+=X){const an=(mt+rn)/U;if(an<0||an>=C.outWidth||Math.floor(an)!==an)continue;const Dn=re*se*le-1-T.get(Ye,Bt,Qt,an,et),Tn=Vt*se*le+$t*le+rn,Fn=Dn===Tn?1:0;if(Fn===0)continue;const qn=Be.get(Ye,Bt,Qt,an,et);bt+=qn*Fn}}}Se.set(bt,Ye,tt,ot,st,et)}return o.makeTensorInfo(Se.shape,Se.dtype,Se.values)}const lve={kernelName:xc,backendName:"cpu",kernelFunc:ave};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cve(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f,output:m}=r,y=f;wn([f,m],"maxPoolGrad");const{filterSize:A,strides:w,pad:C,dimRoundingMode:_}=c,T=Hl(y.shape,A,w,1,C,_),B=o.data.get(y.dataId).values,O=yi(T.outShape,y.dtype,d9(B,y.shape,y.dtype,T).values),U=T.strideHeight,W=T.strideWidth,z=T.dilationHeight,X=T.dilationWidth,re=T.effectiveFilterHeight,se=T.effectiveFilterWidth,le=se-1-T.padInfo.left,ge=re-1-T.padInfo.top,ye=yi(y.shape,"float32"),be=o.data.get(h.dataId).values,Se=yi(h.shape,"float32",be);for(let Be=0;Be<T.batchSize;++Be)for(let Ye=0;Ye<T.inChannels;++Ye)for(let et=0;et<T.inHeight;++et)for(let tt=0;tt<T.inWidth;++tt){const ot=et-ge,st=tt-le;let ct=0;for(let gt=0;gt<re;gt+=z){const mt=(ot+gt)/U;if(!(mt<0||mt>=T.outHeight||Math.floor(mt)!==mt))for(let bt=0;bt<se;bt+=X){const Vt=(st+bt)/W;if(Vt<0||Vt>=T.outWidth||Math.floor(Vt)!==Vt)continue;const Bt=re*se-1-O.get(Be,mt,Vt,Ye),$t=gt*se+bt,Qt=Bt===$t?1:0;if(Qt===0)continue;const rn=Se.get(Be,mt,Vt,Ye);ct+=rn*Qt}}ye.set(ct,Be,et,tt,Ye)}return o.makeTensorInfo(ye.shape,ye.dtype,ye.values)}const uve={kernelName:hl,backendName:"cpu",kernelFunc:cve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hve(a,r,o,c,h){const f=Ie(r),m=CR(a,r,o,f,h,"max"),y=d9(a,r,o,h,!0,c);return[m.values,y.values]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const dve={kernelName:Ui,backendName:"cpu",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{x:c}=a,{filterSize:h,strides:f,pad:m,includeBatchInIndex:y}=r,A=o;wn(c,"MaxPoolWithArgmax");const w=A.data.get(c.dataId).values,C=Hl(c.shape,h,f,[1,1],m),[_,T]=hve(w,c.shape,c.dtype,y,C),B=A.write(_,C.outShape,c.dtype),O=A.write(T,C.outShape,c.dtype);return[{dataId:B,shape:C.outShape,dtype:c.dtype},{dataId:O,shape:C.outShape,dtype:"int32"}]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c,y=q(f,h.shape),A=Ps(h.shape,y)[1],w=M(A),C=[],_=o.makeTensorInfo([],"float32",new Float32Array([w]));C.push(_);const T=_f({inputs:{x:h},backend:o,attrs:{dtype:"float32"}});C.push(T);const B=ER({inputs:{a:T,b:_},backend:o});C.push(B);const O=qv({inputs:{x:B},backend:o,attrs:{axis:f,keepDims:m}});return C.forEach(U=>o.disposeIntermediateTensorInfo(U)),O}const pve={kernelName:fu,backendName:"cpu",kernelFunc:fve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;wn(h,"min");const y=q(f,h.shape);let A=y;const w=Tr(A,h.shape.length);let C=h;w!=null&&(C=ga({inputs:{x:h},backend:o,attrs:{perm:w}}),A=Hr(A.length,h.shape.length)),Ys("min",A,C.shape.length);const[_,T]=Ps(C.shape,A),B=M(T),O=At(M(_),C.dtype),U=o.data.get(C.dataId).values;for(let z=0;z<O.length;++z){const X=z*B;let re=U[X];for(let se=0;se<B;++se){const le=U[X+se];(Number.isNaN(le)||le<re)&&(re=le)}O[z]=re}w!=null&&o.disposeIntermediateTensorInfo(C);const W=o.makeTensorInfo(_,C.dtype,O);if(m){const z=ns(_,y),X=hr({inputs:{x:W},backend:o,attrs:{shape:z}});return o.disposeIntermediateTensorInfo(W),X}return W}const gve={kernelName:Ul,backendName:"cpu",kernelFunc:mve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{paddings:f,mode:m}=c;wn(h,"mirrorPad");const y=f.map((X,re)=>X[0]+h.shape[re]+X[1]),A=f.map(X=>X[0]),w=f.map((X,re)=>X[0]+h.shape[re]),C=m==="reflect"?0:1,_=o.data.get(h.dataId).values,T=h.shape.length,B=Ie(h.shape),O=M(y),U=y.length,W=Ie(y),z=K(h.dtype,O);for(let X=0;X<O;X++){let re=It(X,U,W);for(let le=0;le<U;le++)re[le]<A[le]?re[le]=A[le]*2-re[le]-C:re[le]>=w[le]&&(re[le]=(w[le]-1)*2-re[le]+C);re=re.map((le,ge)=>le-A[ge]);const se=Ze(re,T,B);z[X]=_[se]}return{dataId:o.write(z,y,h.dtype),shape:y,dtype:h.dtype}}const Ave={kernelName:ia,backendName:"cpu",kernelFunc:yve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vve=Qr((a,r)=>{const o=a%r;return a<0&&r<0||a>=0&&r>=0?o:(o+r)%r}),bve=ws(wc,vve),xve={kernelName:wc,backendName:"cpu",kernelFunc:bve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function A9(a){const{inputs:r,backend:o,attrs:c}=a,{logits:h}=r,{dim:f}=c,m=h.shape.length;let y=f;if(y===-1&&(y=m-1),y!==m-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${m} and dim was ${y}`);const A=q([y],h.shape),w=y9({inputs:{x:h},backend:o,attrs:{reductionIndices:A,keepDims:!1}}),C=ns(w.shape,A),_=hr({inputs:{x:w},backend:o,attrs:{shape:C}}),T=wR({inputs:{a:h,b:_},backend:o}),B=A4({inputs:{x:T},backend:o}),O=qv({inputs:{x:B},backend:o,attrs:{axis:A,keepDims:!1}}),U=hr({inputs:{x:O},backend:o,attrs:{shape:C}}),W=ER({inputs:{a:B,b:U},backend:o});return o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(U),W}const wve={kernelName:oa,backendName:"cpu",kernelFunc:A9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Cve(a){const{inputs:r,backend:o,attrs:c}=a,{logits:h}=r,{numSamples:f,seed:m,normalized:y}=c;wn(h,"multinomial");const A=y?h:A9({inputs:{logits:h},backend:o,attrs:{dim:-1}}),w=A.shape[0],C=A.shape[1],_=o.data.get(A.dataId).values,T=[w,f],B=At(M(T),"int32");for(let O=0;O<w;++O){const U=O*C,W=new Float32Array(C-1);W[0]=_[U];for(let re=1;re<W.length;++re)W[re]=W[re-1]+_[U+re];const z=WM.alea(m.toString()),X=O*f;for(let re=0;re<f;++re){const se=z();B[X+re]=W.length;for(let le=0;le<W.length;le++)if(se<W[le]){B[X+re]=le;break}}}return y||o.disposeIntermediateTensorInfo(A),o.makeTensorInfo(T,"int32",B)}const Eve={kernelName:pu,backendName:"cpu",kernelFunc:Cve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _ve=ek;function Ive(a){const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A}=c;wn(h,"NonMaxSuppression");const w=o.data.get(h.dataId).values,C=o.data.get(f.dataId).values,{selectedIndices:_}=_ve(w,C,m,y,A);return o.makeTensorInfo([_.length],"int32",new Int32Array(_))}const Sve={kernelName:Cc,backendName:"cpu",kernelFunc:Ive};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Tve=tk;function Mve(a){const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A,padToMaxOutputSize:w}=c;wn(h,"NonMaxSuppressionPadded");const C=o.data.get(h.dataId).values,_=o.data.get(f.dataId).values,{selectedIndices:T,validOutputs:B}=Tve(C,_,m,y,A,w);return[o.makeTensorInfo([T.length],"int32",new Int32Array(T)),o.makeTensorInfo([],"int32",new Int32Array([B]))]}const kve={kernelName:Th,backendName:"cpu",kernelFunc:Mve};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Rve=nk;function Lve(a){const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A,softNmsSigma:w}=c;wn(h,"NonMaxSuppressionWithScore");const C=o.data.get(h.dataId).values,_=o.data.get(f.dataId).values,T=m,B=y,O=A,U=w,{selectedIndices:W,selectedScores:z}=Rve(C,_,T,B,O,U);return[o.makeTensorInfo([W.length],"int32",new Int32Array(W)),o.makeTensorInfo([z.length],"float32",new Float32Array(z))]}const Bve={kernelName:ui,backendName:"cpu",kernelFunc:Lve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pve(a){const{inputs:r,backend:o,attrs:c}=a,{indices:h}=r,{dtype:f,depth:m,onValue:y,offValue:A}=c;wn(h,"oneHot");const w=M(h.shape),C=new Float32Array(w*m);C.fill(A);const _=o.data.get(h.dataId).values;for(let T=0;T<w;++T)_[T]>=0&&_[T]<m&&(C[T*m+_[T]]=y);return o.makeTensorInfo([...h.shape,m],f,C)}const Nve={kernelName:Rs,backendName:"cpu",kernelFunc:Pve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vC(a){const{inputs:r,backend:o}=a,{x:c}=r;if(c.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(c.dtype==="complex64"){const h=km({inputs:{input:c},backend:o}),f=vC({inputs:{x:h},backend:o}),m=H0({inputs:{input:c},backend:o}),y=vC({inputs:{x:m},backend:o}),A=Wa({inputs:{real:f,imag:y},backend:o});return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(y),A}else return SR({backend:o,attrs:{shape:c.shape,value:0,dtype:c.dtype}})}const Dve={kernelName:g0,backendName:"cpu",kernelFunc:vC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function v9(a){const{inputs:r,backend:o}=a,{x:c}=r;if(c.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(c.dtype==="complex64"){const h=km({inputs:{input:c},backend:o}),f=v9({inputs:{x:h},backend:o}),m=H0({inputs:{input:c},backend:o}),y=vC({inputs:{x:m},backend:o}),A=Wa({inputs:{real:f,imag:y},backend:o});return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(y),A}else return SR({backend:o,attrs:{shape:c.shape,value:1,dtype:c.dtype}})}const Fve={kernelName:Ec,backendName:"cpu",kernelFunc:v9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function b9(a){const{inputs:r,backend:o,attrs:c}=a,{axis:h}=c;if(r.length===1)return AC({inputs:{input:r[0]},backend:o,attrs:{dim:h}});const f=r[0].shape,m=r[0].dtype;r.forEach(C=>{E(f,C.shape,"All tensors passed to stack must have matching shapes"),b(m===C.dtype,()=>"All tensors passed to stack must have matching dtypes")});const y=[],A=r.map(C=>{const _=AC({inputs:{input:C},backend:o,attrs:{dim:h}});return y.push(_),_}),w=X0({inputs:A,backend:o,attrs:{axis:h}});return y.forEach(C=>o.disposeIntermediateTensorInfo(C)),w}const Ove={kernelName:ra,backendName:"cpu",kernelFunc:b9};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vve(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{paddings:f,constantValue:m}=c;wn(h,"pad");const y=f.map((z,X)=>z[0]+h.shape[X]+z[1]),A=f.map(z=>z[0]),w=o.data.get(h.dataId).values,C=M(h.shape),_=h.shape.length,T=Ie(h.shape),B=M(y),O=y.length,U=Ie(y),W=K(h.dtype,B);m!==0&&W.fill(m);for(let z=0;z<C;z++){const X=It(z,_,T).map((se,le)=>se+A[le]),re=Ze(X,O,U);W[re]=w[z]}return{dataId:o.write(W,y,h.dtype),shape:y,dtype:h.dtype}}const x9={kernelName:Mh,backendName:"cpu",kernelFunc:Vve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Uve=Qr((a,r)=>Math.pow(a,r)),zve=ws(yu,Uve),Gve={kernelName:yu,backendName:"cpu",kernelFunc:zve};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wve(a){const{inputs:r,backend:o,attrs:c}=a,{paramsNestedSplits:h,paramsDenseValues:f,indices:m}=r,y=h.map(W=>o.data.get(W.dataId).values),A=h.map(W=>W.shape),w=o.data.get(f.dataId).values,C=o.data.get(m.dataId).values,[_,T,B]=F4(y,A,w,f.shape,f.dtype,C,m.shape),O=_.map(W=>o.makeTensorInfo([W.length],"int32",W)),U=o.makeTensorInfo(B,f.dtype,T);return O.concat([U])}const Hve={kernelName:jd,backendName:"cpu",kernelFunc:Wve};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xve(a){const{inputs:r,backend:o}=a,{starts:c,limits:h,deltas:f}=r,m=o.data.get(c.dataId).values,y=o.data.get(h.dataId).values,A=o.data.get(f.dataId).values,[w,C]=V4(m,c.shape,c.dtype,y,h.shape,A,f.shape),_=o.makeTensorInfo([w.length],"int32",w),T=o.makeTensorInfo([C.length],c.dtype,C);return[_,T]}const $ve={kernelName:Yd,backendName:"cpu",kernelFunc:Xve};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Qve(a){const{inputs:r,backend:o,attrs:c}=a,{shape:h,values:f,defaultValue:m,rowPartitionTensors:y}=r,{rowPartitionTypes:A}=c,w=o.data.get(h.dataId).values,C=o.data.get(f.dataId).values,_=o.data.get(m.dataId).values,T=y.map(W=>o.data.get(W.dataId).values),B=y.map(W=>W.shape),[O,U]=G4(w,h.shape,C,f.shape,f.dtype,_,m.shape,T,B,A);return o.makeTensorInfo(O,f.dtype,U)}const Kve={kernelName:qd,backendName:"cpu",kernelFunc:Qve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Zve(a){const{backend:r,attrs:o}=a,{start:c,stop:h,dtype:f,step:m}=o,y=W4(c,h,m,f);return r.makeTensorInfo([y.length],f,y)}const jve={kernelName:Au,backendName:"cpu",kernelFunc:Zve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Yve=Yi(Ls,a=>1/a),qve={kernelName:Ls,backendName:"cpu",kernelFunc:Yve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Jve(a){const{inputs:r,backend:o,attrs:c}=a,{images:h}=r,{alignCorners:f,halfPixelCenters:m,size:y}=c;wn(h,"resizeBilinear");const A=Ie(h.shape),[w,C]=y,[_,T,B,O]=h.shape,U=o.data.get(h.dataId).values,W=new Float32Array(M([_,w,C,O])),z=[f&&w>1?T-1:T,f&&C>1?B-1:B],X=[f&&w>1?w-1:w,f&&C>1?C-1:C];let re=0;const se=z[0]/X[0],le=z[1]/X[1];for(let ge=0;ge<_;ge++)for(let ye=0;ye<w;ye++){let be;m?be=se*(ye+.5)-.5:be=se*ye;const Se=Math.max(0,Math.floor(be)),Be=be-Se,Ye=Math.min(T-1,Math.ceil(be)),et=ge*A[0]+Se*A[1],tt=ge*A[0]+Ye*A[1];for(let ot=0;ot<C;ot++){let st;m?st=le*(ot+.5)-.5:st=le*ot;const ct=Math.max(0,Math.floor(st)),gt=st-ct,mt=Math.min(B-1,Math.ceil(st)),bt=et+ct*A[2],Vt=tt+ct*A[2],Bt=et+mt*A[2],$t=tt+mt*A[2];for(let Qt=0;Qt<O;Qt++){const rn=U[bt+Qt],an=U[Vt+Qt],Dn=U[Bt+Qt],Tn=U[$t+Qt],Fn=rn+(Dn-rn)*gt,qn=an+(Tn-an)*gt,ni=Fn+(qn-Fn)*Be;W[re++]=ni}}}return o.makeTensorInfo([_,w,C,O],"float32",W)}const ebe={kernelName:xu,backendName:"cpu",kernelFunc:Jve};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function tbe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h,dy:f}=r,{alignCorners:m}=c;wn([f,h],"resizeBilinearGrad");const y=Ie(h.shape),[A,w,C,_]=h.shape,[,T,B]=f.shape,O=new Float32Array(A*w*C*_),U=[m&&T>1?w-1:w,m&&B>1?C-1:C],W=[m&&T>1?T-1:T,m&&B>1?B-1:B],z=U[0]/W[0],X=U[1]/W[1],re=o.data.get(f.dataId).values;let se=0;for(let le=0;le<A;le++){const ge=le*y[0];for(let ye=0;ye<T;ye++){const be=ye*z,Se=Math.floor(be),Be=Math.min(Math.ceil(be),w-1),Ye=ge+Se*y[1],et=ge+Be*y[1],tt=be-Se,ot=1-tt;for(let st=0;st<B;st++){const ct=st*X,gt=Math.floor(ct),mt=Math.min(Math.ceil(ct),C-1),bt=ct-gt,Vt=1-bt,Bt=Ye+gt*y[2],$t=Ye+mt*y[2],Qt=et+gt*y[2],rn=et+mt*y[2],an=ot*Vt,Dn=ot*bt,Tn=tt*Vt,Fn=tt*bt;for(let qn=0;qn<_;qn++){const ni=re[se++];O[Bt+qn]+=ni*an,O[$t+qn]+=ni*Dn,O[Qt+qn]+=ni*Tn,O[rn+qn]+=ni*Fn}}}}return o.makeTensorInfo([A,C,w,_],"float32",O)}const nbe={kernelName:wu,backendName:"cpu",kernelFunc:tbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ibe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h}=r,{alignCorners:f,halfPixelCenters:m,size:y}=c;wn(h,"resizeNearestNeighbor");const A=Ie(h.shape),[w,C]=y,[_,T,B,O]=h.shape,U=o.data.get(h.dataId).values,W=new Float32Array(_*w*C*O),z=[f&&w>1?T-1:T,f&&C>1?B-1:B],X=[f&&w>1?w-1:w,f&&C>1?C-1:C],re=z[0]/X[0],se=z[1]/X[1];let le=0;for(let ge=0;ge<_;ge++){const ye=ge*A[0];for(let be=0;be<w;be++){const Se=m?re*(be+.5):re*be;let Be=Math.min(T-1,f?Math.round(Se):Math.floor(Se));m&&(Be=Math.max(0,Be));const Ye=ye+Be*A[1];for(let et=0;et<C;et++){const tt=m?se*(et+.5):se*et;let ot=Math.min(B-1,f?Math.round(tt):Math.floor(tt));m&&(ot=Math.max(0,ot));const st=Ye+ot*A[2];for(let ct=0;ct<O;ct++){const gt=U[st+ct];W[le++]=gt}}}}return o.makeTensorInfo([_,w,C,O],h.dtype,W)}const rbe={kernelName:ko,backendName:"cpu",kernelFunc:ibe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function sbe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h,dy:f}=r,{alignCorners:m}=c;wn([f,h],"resizeNearestNeighborGrad");const y=Ie(h.shape),A=Ie(f.shape),[w,C,_,T]=h.shape,[,B,O]=f.shape,U=new Float32Array(w*C*_*T),W=o.data.get(f.dataId).values,z=[m&&B>1?C-1:C,m&&O>1?_-1:_],X=[m&&B>1?B-1:B,m&&O>1?O-1:O],re=z[0]/X[0],se=z[1]/X[1],le=1/re,ge=1/se,ye=Math.ceil(le)*2+2,be=Math.ceil(ge)*2+2;for(let Se=0;Se<w;Se++){const Be=Se*y[0];for(let Ye=0;Ye<C;Ye++){const et=Be+Ye*y[1],tt=Math.floor(Ye*le),ot=Math.floor(tt-ye/2);for(let st=0;st<_;st++){const ct=et+st*y[2],gt=Math.floor(st*ge),mt=Math.floor(gt-be/2);for(let bt=0;bt<T;bt++){let Vt=0;for(let Bt=0;Bt<ye;Bt++){const $t=Bt+ot;if($t<0||$t>=B)continue;const Qt=Be+$t*A[1],rn=$t*re,an=Math.min(C-1,m?Math.round(rn):Math.floor(rn));if(Ye===an)for(let Dn=0;Dn<be;Dn++){const Tn=Dn+mt;if(Tn<0||Tn>=O)continue;const Fn=Qt+Tn*A[2],qn=Tn*se,ni=Math.min(_-1,m?Math.round(qn):Math.floor(qn));st===ni&&(Vt+=W[Fn+bt])}}U[ct+bt]=Vt}}}}return o.makeTensorInfo(h.shape,h.dtype,U)}const obe={kernelName:Rh,backendName:"cpu",kernelFunc:sbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function abe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{dims:f}=c;wn(h,"reverse");const m=h.shape.length,y=q(f,h.shape);if(m===0)return zu({inputs:{x:h},backend:o});const A=new Zs(h.shape,h.dtype),w=o.bufferSync(h);for(let C=0;C<A.size;C++){const _=A.indexToLoc(C),T=_.slice();y.forEach(B=>T[B]=h.shape[B]-1-T[B]),A.set(w.get(...T),..._)}return o.makeTensorInfo(A.shape,A.dtype,A.values)}const lbe={kernelName:es,backendName:"cpu",kernelFunc:abe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const cbe={kernelName:y0,backendName:"cpu",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{image:c}=a,{radians:h,fillValue:f,center:m}=r,y=o,A=K(c.dtype,M(c.shape)),[w,C,_,T]=c.shape,[B,O]=pk(m,C,_),U=255,W=Math.sin(h),z=Math.cos(h),X=y.data.get(c.dataId).values;for(let re=0;re<w;re++){const se=re*_*C*T;for(let le=0;le<C;le++){const ge=le*(_*T);for(let ye=0;ye<_;ye++){const be=ye*T;for(let Se=0;Se<T;Se++){const Be=[w,le,ye,Se],Ye=Be[2],et=Be[1];let tt=(Ye-B)*z-(et-O)*W,ot=(Ye-B)*W+(et-O)*z;tt=Math.round(tt+B),ot=Math.round(ot+O);let st=f;if(typeof f!="number"&&(Se===3?st=U:st=f[Se]),tt>=0&&tt<_&&ot>=0&&ot<C){const gt=ot*(_*T),mt=tt*T,bt=se+gt+mt+Se;st=X[bt]}const ct=se+ge+be+Se;A[ct]=st}}}}return{dataId:y.write(A,c.shape,c.dtype),shape:c.shape,dtype:c.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ube=Yi(_c,a=>{const r=Math.floor(a);return a-r<.5?Math.floor(a):a-r>.5?Math.ceil(a):r%2===0?r:r+1}),hbe={kernelName:_c,backendName:"cpu",kernelFunc:ube};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dbe(a){const{inputs:r,backend:o,attrs:c}=a,{indices:h,updates:f}=r,{shape:m}=c,{sliceRank:y,numUpdates:A,sliceSize:w,strides:C,outputSize:_}=bm(f,h,m),T=!0,B=o.bufferSync(h),O=o.bufferSync(f),U=Rm(B,O,m,_,w,A,y,C,0,T);return o.makeTensorInfo(m,U.dtype,U.values)}const fbe={kernelName:Ic,backendName:"cpu",kernelFunc:dbe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pbe(a,r){let o=0,c=a.length,h=0;for(;o<c;)h=Math.floor((o+c)/2),a[h]<r?o=h+1:c=h;return c}function mbe(a,r){let o=0,c=a.length,h=0;for(;o<c;)h=Math.floor((o+c)/2),a[h]<=r?o=h+1:c=h;return c}function gbe(a,r,o,c,h,f){const m=Q("int32",o*h);for(let y=0;y<o;++y){const A=a.slice(y*c,(y+1)*c),w=y*h;for(let C=0;C<h;++C)m[w+C]=f==="left"?pbe(A,r[C+w]):mbe(A,r[C+w])}return m}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ybe(a){const{inputs:r,backend:o,attrs:c}=a,{sortedSequence:h,values:f}=r,{side:m}=c,y=o.data.get(h.dataId).values,A=o.data.get(f.dataId).values,w=gbe(y,A,h.shape[0],h.shape[1],f.shape[1],m);return o.makeTensorInfo(f.shape,"int32",w)}const Abe={kernelName:J,backendName:"cpu",kernelFunc:ybe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function vbe(a){const{inputs:r,backend:o}=a,{condition:c,t:h,e:f}=r;wn([c,h,f],"select");const m=c.shape.length,y=o.data.get(c.dataId).values,A=o.data.get(h.dataId).values,w=o.data.get(f.dataId).values,C=Ua(h.dtype,f.dtype),_=At(M(h.shape),C);let T=0;const B=m===0||m>1||h.shape.length===1?1:M(h.shape.slice(1));for(let O=0;O<y.length;O++)for(let U=0;U<B;U++)y[O]===1?_[T++]=A[O]:_[T++]=w[O];return o.makeTensorInfo(h.shape,C,_)}const bbe={kernelName:ae,backendName:"cpu",kernelFunc:vbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xbe=Gw,wbe=Ww,Cbe=Yi(me,a=>a>=0?wbe*a:xbe*(Math.exp(a)-1)),Ebe={kernelName:me,backendName:"cpu",kernelFunc:Cbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _be=Yi(zn,a=>a<0?-1:a>0?1:0),Ibe={kernelName:zn,backendName:"cpu",kernelFunc:_be};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Sbe=Yi(it,a=>Math.sin(a)),Tbe={kernelName:it,backendName:"cpu",kernelFunc:Sbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Mbe=Yi(Xt,a=>Math.sinh(a)),kbe={kernelName:Xt,backendName:"cpu",kernelFunc:Mbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const w9=Math.log(11920928955078125e-23)+2,Rbe=Yi(Ii,a=>{const r=a>-w9,o=a<w9,c=Math.exp(a);let h;return o?h=c:r?h=a:h=Math.log(1+c),h}),Lbe={kernelName:Ii,backendName:"cpu",kernelFunc:Rbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Bbe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockShape:f,paddings:m}=c;wn([h],"spaceToBatchND");const y=M(f),A=[[0,0]];A.push(...m);for(let W=1+f.length;W<h.shape.length;++W)A.push([0,0]);const w=x9.kernelFunc({inputs:{x:h},backend:o,attrs:{paddings:A,constantValue:0}}),C=Lv(w.shape,f,y,!1),_=Bv(C.length,f.length,!1),T=Pv(w.shape,f,y,!1),B=hr({inputs:{x:w},backend:o,attrs:{shape:C}}),O=ga({inputs:{x:B},backend:o,attrs:{perm:_}}),U=hr({inputs:{x:O},backend:o,attrs:{shape:T}});return o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),U}const Pbe={kernelName:Ro,backendName:"cpu",kernelFunc:Bbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Nbe(a){const{inputs:r,backend:o}=a,{indices:c,values:h,denseShape:f,defaultValue:m}=r;if(f.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${f.shape}`);if(c.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${c.shape}`);if(h.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${h.shape}`);if(m.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${m.shape}`);const y=o.data.get(c.dataId).values,A=o.data.get(h.dataId).values,w=o.data.get(f.dataId).values,C=o.data.get(m.dataId).values[0],[_,T,B,O,U]=Q4(y,c.shape,c.dtype,A,h.dtype,w,C);return[o.makeTensorInfo(T,c.dtype,_),o.makeTensorInfo([T[0]],h.dtype,B),o.makeTensorInfo([O.length],"bool",new Uint8Array(O.map(W=>Number(W)))),o.makeTensorInfo([U.length],c.dtype,new Int32Array(U))]}const Dbe={kernelName:Lh,backendName:"cpu",kernelFunc:Nbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Fbe(a){const{inputs:r,backend:o}=a,{inputIndices:c,inputShape:h,newShape:f}=r;if(c.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${c.shape}`);if(h.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${h.shape}`);if(f.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${f.shape}`);const m=Array.from(o.data.get(h.dataId).values),y=o.data.get(c.dataId).values,A=Array.from(o.data.get(f.dataId).values),[w,C,_]=K4(y,c.shape,c.dtype,m,A);return[o.makeTensorInfo(C,c.dtype,w),o.makeTensorInfo([_.length],f.dtype,new Int32Array(_))]}const Obe={kernelName:Bh,backendName:"cpu",kernelFunc:Fbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vbe(a){const{inputs:r,backend:o}=a,{data:c,indices:h,segmentIds:f}=r;if(c.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(h.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${h.shape}`);if(f.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${f.shape}`);if(h.shape[0]!==f.shape[0])throw new Error("segmentIds and indices should have same size.");const m=o.data.get(c.dataId).values,y=o.data.get(h.dataId).values,A=o.data.get(f.dataId).values,[w,C]=xR(m,c.shape,c.dtype,y,A,!0);return o.makeTensorInfo(C,c.dtype,w)}const Ube={kernelName:yw,backendName:"cpu",kernelFunc:Vbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function zbe(a){const{inputs:r,backend:o}=a,{data:c,indices:h,segmentIds:f}=r;if(c.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(h.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${h.shape}`);if(f.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${f.shape}`);if(h.shape[0]!==f.shape[0])throw new Error("segmentIds and indices should have same size.");const m=o.data.get(c.dataId).values,y=o.data.get(h.dataId).values,A=o.data.get(f.dataId).values,[w,C]=xR(m,c.shape,c.dtype,y,A);return o.makeTensorInfo(C,c.dtype,w)}const Gbe={kernelName:Da,backendName:"cpu",kernelFunc:zbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Wbe(a){const{inputs:r,backend:o,attrs:c}=a,{sparseIndices:h,sparseValues:f,defaultValue:m}=r,{outputShape:y}=c,{sliceRank:A,numUpdates:w,sliceSize:C,strides:_,outputSize:T}=bm(f,h,y),B=!1,O=o.bufferSync(h);let U;switch(f.dtype){case"bool":{const W=o.bufferSync(f),z=!!o.data.get(m.dataId).values[0];U=Rm(O,W,y,T,C,w,A,_,z,B);break}case"float32":{const W=o.bufferSync(f),z=o.data.get(m.dataId).values[0];U=Rm(O,W,y,T,C,w,A,_,z,B);break}case"int32":{const W=o.bufferSync(f),z=o.data.get(m.dataId).values[0];U=Rm(O,W,y,T,C,w,A,_,z,B);break}case"string":{const W=o.bufferSync(f),z=Tc(o.data.get(m.dataId).values[0]);U=Rm(O,W,y,T,C,w,A,_,z,B);break}default:throw new Error(`Unsupported type ${f.dtype}`)}return o.makeTensorInfo(y,U.dtype,U.values)}const Hbe={kernelName:Ph,backendName:"cpu",kernelFunc:Wbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Xbe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{numOrSizeSplits:f,axis:m}=c,y=q(m,h.shape)[0],A=kk(h,f,y),w=new Array(h.shape.length).fill(0),C=h.shape.slice();return A.map(_=>{const T=[...C];T[y]=_;const B=Lm({inputs:{x:h},backend:o,attrs:{begin:w,size:T}});return w[y]+=_,B})}const $be={kernelName:oo,backendName:"cpu",kernelFunc:Xbe};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Qbe={kernelName:dl,backendName:"cpu",kernelFunc:({inputs:a,backend:r})=>{const{x:o}=a,c=r;wn(o,"square");const h=c.data.get(o.dataId).values,f=new Float32Array(h.length);for(let m=0;m<h.length;++m){const y=h[m];f[m]=y*y}return{dataId:c.write(f,o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Kbe=Yi(aa,(a,r)=>{const o=r;return isNaN(a)?NaN:a>0?1:o.alpha}),Zbe={kernelName:aa,backendName:"cpu",kernelFunc:Kbe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jbe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{begin:f,end:m,strides:y,beginMask:A,endMask:w,ellipsisMask:C,newAxisMask:_,shrinkAxisMask:T}=c;wn(h,"stridedSlice");const{finalShapeSparse:B,finalShape:O,isIdentity:U,sliceDim0:W,isSimpleSlice:z,begin:X,end:re,strides:se}=hk(h.shape,f,m,y,A,w,C,_,T);let le;if(U)le=hr({inputs:{x:h},backend:o,attrs:{shape:O}});else if(W||z){b(h.shape.length>=1,()=>`Input must have rank at least 1, got: ${h.shape.length}`);const ge=lk(X,re,se),ye=Lm({inputs:{x:h},backend:o,attrs:{begin:X,size:ge}});le=hr({inputs:{x:ye},backend:o,attrs:{shape:O}}),o.disposeIntermediateTensorInfo(ye)}else{const ge=o.bufferSync(h),ye=Y4(B,ge,se,X);le=o.makeTensorInfo(O,ye.dtype,ye.values)}return le}const Ybe={kernelName:Eu,backendName:"cpu",kernelFunc:jbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function qbe(a){const{inputs:r,backend:o,attrs:c}=a,{separator:h,nGramWidths:f,leftPad:m,rightPad:y,padWidth:A,preserveShortSequences:w}=c,{data:C,dataSplits:_}=r,T=o.data.get(C.dataId).values,B=o.data.get(_.dataId).values,[O,U]=q4(T,B,h,f,m,y,A,w);return[o.makeTensorInfo([O.length],"string",O),o.makeTensorInfo(_.shape,"int32",U)]}const Jbe={kernelName:Aw,backendName:"cpu",kernelFunc:qbe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function exe(a){const{inputs:r,backend:o,attrs:c}=a,{skipEmpty:h}=c,{input:f,delimiter:m}=r;if(f.dtype!=="string")throw new Error("Input must be of datatype string");if(f.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${f.shape}`);if(m.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${m.shape}`);const y=o.data.get(f.dataId).values,A=o.data.get(m.dataId).values[0],[w,C,_]=J4(y,A,h),T=C.length;return[o.makeTensorInfo([T,2],"int32",w),o.makeTensorInfo([T],"string",C),o.makeTensorInfo([2],"int32",new Int32Array(_))]}const txe={kernelName:Jd,backendName:"cpu",kernelFunc:exe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nxe(a){const{inputs:r,backend:o,attrs:c}=a,{numBuckets:h}=c,{input:f}=r;if(f.dtype!=="string")throw new Error("Input must be of datatype string");if(h<=0)throw new Error("Number of buckets must be at least 1");const m=o.data.get(f.dataId).values,y=e9(m,h);return o.makeTensorInfo(f.shape,"int32",y)}const ixe={kernelName:ov,backendName:"cpu",kernelFunc:nxe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rxe=Yi(im,a=>Math.tan(a)),sxe={kernelName:im,backendName:"cpu",kernelFunc:rxe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oxe=Yi(Fa,a=>Math.tanh(a)),axe={kernelName:Fa,backendName:"cpu",kernelFunc:oxe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function lxe(a){const{inputs:r,backend:o}=a,{tensor:c,indices:h,updates:f}=r,{sliceRank:m,numUpdates:y,sliceSize:A,strides:w,outputSize:C}=bm(f,h,c.shape),_=!1,T=o.bufferSync(h),B=o.bufferSync(f),O=o.bufferSync(c),U=Rm(T,B,c.shape,C,A,y,m,w,O,_);return o.makeTensorInfo(c.shape,U.dtype,U.values)}const cxe={kernelName:N,backendName:"cpu",kernelFunc:lxe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uxe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{reps:f}=c;wn(h,"tile");const m=n9(o.bufferSync(h),f);return o.makeTensorInfo(m.shape,m.dtype,m.values)}const hxe={kernelName:Iu,backendName:"cpu",kernelFunc:uxe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dxe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{k:f,sorted:m}=c;wn(h,"topk");const y=o.data.get(h.dataId).values,[A,w]=r9(y,h.shape,h.dtype,f,m);return[o.makeTensorInfo(A.shape,A.dtype,A.values),o.makeTensorInfo(w.shape,w.dtype,w.values)]}const fxe={kernelName:av,backendName:"cpu",kernelFunc:dxe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pxe(a){const{inputs:r,attrs:o,backend:c}=a,{image:h,transforms:f}=r,{interpolation:m,fillMode:y,fillValue:A,outputShape:w}=o,[C,_,T,B]=h.shape,[O,U]=w??[_,T],W=[C,O,U,B],z=Ie(h.shape),X=z[0],re=z[1],se=z[2],le=Ie(W),ge=le[0],ye=le[1],be=le[2],Se=K(h.dtype,M(W));Se.fill(A);const Be=c.data.get(h.dataId).values,Ye=c.data.get(f.dataId).values;for(let et=0;et<C;++et){const tt=f.shape[0]===1?Ye:Ye.subarray(et*8,et*8+8);for(let ot=0;ot<O;++ot)for(let st=0;st<U;++st)for(let ct=0;ct<B;++ct){let gt;const mt=tt[6]*st+tt[7]*ot+1;if(mt===0)continue;const bt=(tt[0]*st+tt[1]*ot+tt[2])/mt,Vt=(tt[3]*st+tt[4]*ot+tt[5])/mt,Bt=C9(bt,T,y),$t=C9(Vt,_,y);switch(m){case"nearest":gt=bxe(Be,_,T,X,re,se,et,$t,Bt,ct,A);break;case"bilinear":gt=xxe(Be,_,T,X,re,se,et,$t,Bt,ct,A);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${m}`)}const Qt=et*ge+ot*ye+st*be+ct;Se[Qt]=gt}return c.makeTensorInfo(W,h.dtype,Se)}return{dataId:c.write(Se,W,h.dtype),shape:h.shape,dtype:h.dtype}}const mxe={kernelName:rm,backendName:"cpu",kernelFunc:pxe};function C9(a,r,o){switch(o){case"reflect":return gxe(a,r);case"wrap":return yxe(a,r);case"nearest":return vxe(a,r);case"constant":default:return Axe(a)}}function gxe(a,r){let o=a;if(o<0)if(r<=1)o=0;else{const c=2*r;o<c&&(o=c*Math.trunc(-o/c)+o),o=o<-r?o+c:-o-1}else if(o>r-1)if(r<=1)o=0;else{const c=2*r;o-=c*Math.trunc(o/c),o>=r&&(o=c-o-1)}return d(0,o,r-1)}function yxe(a,r){let o=a;if(o<0)if(r<=1)o=0;else{const c=r-1;o+=r*(Math.trunc(-o/c)+1)}else if(o>r-1)if(r<=1)o=0;else{const c=r-1;o-=r*Math.trunc(o/c)}return d(0,o,r-1)}function Axe(a,r){return a}function vxe(a,r){return d(0,a,r-1)}function Jv(a,r,o,c,h,f,m,y,A,w,C){const _=m*c+y*h+A*f+w;return 0<=y&&y<r&&0<=A&&A<o?a[_]:C}function bxe(a,r,o,c,h,f,m,y,A,w,C){const _=Math.round(y),T=Math.round(A);return Jv(a,r,o,c,h,f,m,_,T,w,C)}function xxe(a,r,o,c,h,f,m,y,A,w,C){const _=Math.floor(y),T=Math.floor(A),B=_+1,O=T+1,U=(O-A)*Jv(a,r,o,c,h,f,m,_,T,w,C)+(A-T)*Jv(a,r,o,c,h,f,m,_,O,w,C),W=(O-A)*Jv(a,r,o,c,h,f,m,B,T,w,C)+(A-T)*Jv(a,r,o,c,h,f,m,B,O,w,C);return(B-y)*U+(y-_)*W}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wxe(a){const{inputs:r,attrs:o,backend:c}=a,{axis:h}=o,{x:f}=r;wn(f,"unique");const m=c.data.get(f.dataId).values,{outputValues:y,outputShape:A,indices:w}=s9(m,h,f.shape,f.dtype);return[c.makeTensorInfo(A,f.dtype,y),c.makeTensorInfo([w.length],"int32",w)]}const Cxe={kernelName:fl,backendName:"cpu",kernelFunc:wxe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Exe(a){const{inputs:r,backend:o,attrs:c}=a,{value:h}=r;let{axis:f}=c;f<0&&(f+=h.shape.length);const m=h.shape.length,y=h.shape[f],A=new Array(m-1);let w=0;for(let B=0;B<m;B++)B!==f&&(A[w++]=h.shape[B]);const C=new Array(m).fill(0),_=h.shape.slice();_[f]=1;const T=new Array(y);for(let B=0;B<T.length;B++){C[f]=B;const O=Lm({inputs:{x:h},backend:o,attrs:{begin:C,size:_}});T[B]=hr({inputs:{x:O},backend:o,attrs:{shape:A}}),o.disposeIntermediateTensorInfo(O)}return T}const _xe={kernelName:m0,backendName:"cpu",kernelFunc:Exe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ixe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,segmentIds:f}=r,{numSegments:m}=c;wn(h,"unsortedSegmentSum");const y=h.shape.length,A=f.shape.length,w=[],C=[],_=y-A;let T=f;for(let O=0;O<_;++O){const U=AC({inputs:{input:T},backend:o,attrs:{dim:O+1}});T=U,C.push(U)}for(let O=0;O<m;++O){const U=Br(O,"int32"),W=o.makeTensorInfo([],"int32",U),z=g4({inputs:{a:W,b:T},backend:o}),X=_f({inputs:{x:z},backend:o,attrs:{dtype:"float32"}}),re=mC({inputs:{a:X,b:h},backend:o}),se=qv({inputs:{x:re},backend:o,attrs:{axis:0,keepDims:!1}});w.push(se),C.push(W),C.push(z),C.push(X),C.push(re),C.push(se)}const B=b9({inputs:w,backend:o,attrs:{axis:0}});return C.forEach(O=>o.disposeIntermediateTensorInfo(O)),B}const Sxe={kernelName:Sc,backendName:"cpu",kernelFunc:Ixe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Txe=[E0e,rge,I0e,T0e,uge,k0e,L0e,P0e,D0e,O0e,U0e,G0e,H0e,Q0e,Z0e,q0e,eye,nye,rye,w0e,oye,lye,uye,dge,dye,lge,pge,pye,sge,mye,yye,Aye,bye,wye,Eye,Iye,Tye,kye,Lye,Pye,Dye,Oye,Uye,Gye,Wye,Xye,Qye,Zye,jye,Yye,qye,eAe,iAe,m0e,sAe,mge,fAe,gge,pAe,Age,bAe,xAe,CAe,bge,wge,_Ae,SAe,MAe,RAe,Ege,Ige,oge,BAe,gye,NAe,FAe,VAe,g0e,Tge,kge,zAe,Lge,WAe,$Ae,KAe,YAe,JAe,tve,nve,Pge,rve,ove,lve,uve,dve,pve,gve,Dge,Ave,xve,Eve,Oge,Uge,Sve,kve,Bve,Gge,Nve,Fve,Ove,x9,Gve,A0e,Xge,Hve,$ve,Kve,jve,age,_R,qve,v0e,b0e,x0e,ebe,nbe,rbe,obe,lbe,cbe,hbe,Jge,fbe,Abe,bbe,Ebe,t0e,Ibe,Tbe,kbe,n0e,wve,Lbe,Pbe,Dbe,Obe,Ube,Gbe,Hbe,$be,s0e,Qbe,a0e,c0e,Zbe,Ybe,Jbe,txe,ixe,f0e,tAe,sxe,axe,cxe,hxe,fxe,mxe,Wge,Cxe,_xe,Sxe,Dve];for(const a of Txe)la(a);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Bm={},bC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Mxe(a,r){Bm[a]=r}function Vc(a,r){if(!(a in Bm)||r!=null){const c=Rxe(a,r);if(c!==null)Bm[a]=c;else return console.log("Could not get context for WebGL version",a),null}const o=Bm[a];return o==null||o.isContextLost()?(delete Bm[a],Vc(a)):(o.disable(o.DEPTH_TEST),o.disable(o.STENCIL_TEST),o.disable(o.BLEND),o.disable(o.DITHER),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SAMPLE_COVERAGE),o.enable(o.SCISSOR_TEST),o.enable(o.CULL_FACE),o.cullFace(o.BACK),Bm[a])}function kxe(a){if(!Te().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Rxe(a,r){if(a!==1&&a!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const o=r??kxe(a);return o.addEventListener("webglcontextlost",c=>{c.preventDefault(),delete Bm[a]},!1),Te().getBool("SOFTWARE_WEBGL_ENABLED")&&(bC.failIfMajorPerformanceCaveat=!1),a===1?o.getContext("webgl",bC)||o.getContext("experimental-webgl",bC):o.getContext("webgl2",bC)}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/var eb;(function(a){a[a.DENSE=0]="DENSE",a[a.SHARED_BATCH=1]="SHARED_BATCH"})(eb||(eb={}));var bl;(function(a){a[a.RENDER=0]="RENDER",a[a.UPLOAD=1]="UPLOAD",a[a.PIXELS=2]="PIXELS",a[a.DOWNLOAD=3]="DOWNLOAD"})(bl||(bl={}));var qs;(function(a){a[a.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",a[a.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",a[a.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",a[a.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",a[a.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(qs||(qs={}));function tb(a,r){return[r,a]}function Lxe(a,r){return a*r}function xC(a){const r=M(a),o=Math.ceil(r/4);return k(o)}function $0(a,r){return[Math.max(1,Math.ceil(r/2)),Math.max(1,Math.ceil(a/2))]}function Bxe(a,r){const[o,c]=$0(a,r);return o*c*4}function TR(a,r){const o=a;let c,h,f,m,y,A,w,C,_,T;return Te().getNumber("WEBGL_VERSION")===2?(c=o.R32F,h=o.R16F,f=o.RGBA16F,m=o.RGBA32F,y=o.RED,w=4,C=1,_=o.HALF_FLOAT,T=o.FLOAT,A=o.RGBA8):(c=a.RGBA,h=a.RGBA,f=a.RGBA,m=o.RGBA,y=a.RGBA,w=4,C=4,_=r!=null?r.HALF_FLOAT_OES:null,T=a.FLOAT,A=a.RGBA),{internalFormatFloat:c,internalFormatHalfFloat:h,internalFormatPackedHalfFloat:f,internalFormatPackedFloat:m,textureFormatFloat:y,downloadTextureFormat:A,downloadUnpackNumChannels:w,defaultNumChannels:C,textureTypeHalfFloat:_,textureTypeFloat:T}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mn(a,r){const o=r();return Te().getBool("DEBUG")&&Pxe(a),o}function Pxe(a){const r=a.getError();if(r!==a.NO_ERROR)throw new Error("WebGL Error: "+Oxe(a,r))}const Nxe=596e-10,Dxe=65504;function Fxe(a){return!!(Te().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||a===0||Nxe<Math.abs(a)&&Math.abs(a)<Dxe)}function Oxe(a,r){switch(r){case a.NO_ERROR:return"NO_ERROR";case a.INVALID_ENUM:return"INVALID_ENUM";case a.INVALID_VALUE:return"INVALID_VALUE";case a.INVALID_OPERATION:return"INVALID_OPERATION";case a.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case a.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case a.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${r}`}}function wC(a,r){return Yh(a,()=>a.getExtension(r),'Extension "'+r+'" not supported on this browser.')}function Vxe(a,r){const o=Yh(a,()=>a.createShader(a.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(mn(a,()=>a.shaderSource(o,r)),mn(a,()=>a.compileShader(o)),a.getShaderParameter(o,a.COMPILE_STATUS)===!1)throw console.log(a.getShaderInfoLog(o)),new Error("Failed to compile vertex shader.");return o}function Uxe(a,r){const o=Yh(a,()=>a.createShader(a.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(mn(a,()=>a.shaderSource(o,r)),mn(a,()=>a.compileShader(o)),Te().get("ENGINE_COMPILE_ONLY"))return o;if(a.getShaderParameter(o,a.COMPILE_STATUS)===!1)throw E9(r,a.getShaderInfoLog(o)),new Error("Failed to compile fragment shader.");return o}const zxe=/ERROR: [0-9]+:([0-9]+):/g;function E9(a,r){const o=zxe.exec(r);if(o==null){console.log(`Couldn't parse line number in error: ${r}`),console.log(a);return}const c=+o[1],h=a.split(`
`),f=h.length.toString().length+2,m=h.map((_,T)=>F((T+1).toString(),f)+_);let y=0;for(let _=0;_<m.length;_++)y=Math.max(m[_].length,y);const A=m.slice(0,c-1),w=m.slice(c-1,c),C=m.slice(c);console.log(A.join(`
`)),console.log(r.split(`
`)[0]),console.log(`%c ${F(w[0],y)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(C.join(`
`))}function Gxe(a){return Yh(a,()=>a.createProgram(),"Unable to create WebGLProgram.")}function Wxe(a,r){if(mn(a,()=>a.linkProgram(r)),!Te().get("ENGINE_COMPILE_ONLY")&&a.getProgramParameter(r,a.LINK_STATUS)===!1)throw console.log(a.getProgramInfoLog(r)),new Error("Failed to link vertex and fragment shaders.")}function MR(a,r){if(mn(a,()=>a.validateProgram(r)),a.getProgramParameter(r,a.VALIDATE_STATUS)===!1)throw console.log(a.getProgramInfoLog(r)),new Error("Shader program validation failed.")}function Hxe(a,r){const o=Yh(a,()=>a.createBuffer(),"Unable to create WebGLBuffer");return mn(a,()=>a.bindBuffer(a.ARRAY_BUFFER,o)),mn(a,()=>a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW)),o}function Xxe(a,r){const o=Yh(a,()=>a.createBuffer(),"Unable to create WebGLBuffer");return mn(a,()=>a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,o)),mn(a,()=>a.bufferData(a.ELEMENT_ARRAY_BUFFER,r,a.STATIC_DRAW)),o}function $xe(a){return Yh(a,()=>a.createTexture(),"Unable to create WebGLTexture.")}function Qxe(a,r){const o=Te().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(a<=0||r<=0){const c=`[${a}x${r}]`;throw new Error("Requested texture size "+c+" is invalid.")}if(a>o||r>o){const c=`[${a}x${r}]`,h=`[${o}x${o}]`;throw new Error("Requested texture size "+c+" greater than WebGL maximum on this browser / GPU "+h+".")}}function Kxe(a){return Yh(a,()=>a.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function _9(a,r,o,c,h,f,m){const y=a.getAttribLocation(r,o);return y===-1?!1:(mn(a,()=>a.bindBuffer(a.ARRAY_BUFFER,c)),mn(a,()=>a.vertexAttribPointer(y,h,a.FLOAT,!1,f,m)),mn(a,()=>a.enableVertexAttribArray(y)),!0)}function Zxe(a,r,o){e1e(a,o),mn(a,()=>a.activeTexture(a.TEXTURE0+o)),mn(a,()=>a.bindTexture(a.TEXTURE_2D,r))}function jxe(a,r,o){return Yh(a,()=>a.getUniformLocation(r,o),'uniform "'+o+'" not present in program.')}function Yxe(a,r,o){return a.getUniformLocation(r,o)}function qxe(a,r,o,c){mn(a,()=>Zxe(a,r,c)),mn(a,()=>a.uniform1i(o,c))}function kR(a,r,o){mn(a,()=>a.bindFramebuffer(a.FRAMEBUFFER,o)),mn(a,()=>a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,r,0))}function I9(a,r){mn(a,()=>a.bindFramebuffer(a.FRAMEBUFFER,r)),mn(a,()=>a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0))}function CC(a){const r=a.checkFramebufferStatus(a.FRAMEBUFFER);if(r!==a.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Jxe(a,r))}function Jxe(a,r){switch(r){case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case a.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${r}`}}function Yh(a,r,o){const c=mn(a,()=>r());if(c==null)throw new Error(o);return c}function e1e(a,r){const o=a.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,c=r+a.TEXTURE0;if(c<a.TEXTURE0||c>o){const h=`[gl.TEXTURE0, gl.TEXTURE${o}]`;throw new Error(`textureUnit must be in ${h}.`)}}function Q0(a,r=2){return M(a.slice(0,a.length-r))}function K0(a){if(a.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[a.length>1?a[a.length-2]:1,a[a.length-1]]}function EC(a){let r=[1,1,1];return a.length===0||a.length===1&&a[0]===1||(r=[Q0(a),...K0(a)]),r}function t1e(a,r=!1){let o=Te().getNumber("WEBGL_MAX_TEXTURE_SIZE"),c=Te().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");c===1/0&&Te().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(c=o/2),r&&(o=o*2,c=c*2,a=a.map((y,A)=>A>=a.length-2?p(a[A]):a[A]),a.length===1&&(a=[2,a[0]])),a.length!==2&&(a=ne(a).newShape);let h=M(a),f=null;a.length<=1&&h<=o?f=[1,h]:a.length===2&&a[0]<=o&&a[1]<=o?f=a:a.length===3&&a[0]*a[1]<=o&&a[2]<=o?f=[a[0]*a[1],a[2]]:a.length===3&&a[0]<=o&&a[1]*a[2]<=o?f=[a[0],a[1]*a[2]]:a.length===4&&a[0]*a[1]*a[2]<=o&&a[3]<=o?f=[a[0]*a[1]*a[2],a[3]]:a.length===4&&a[0]<=o&&a[1]*a[2]*a[3]<=o&&(f=[a[0],a[1]*a[2]*a[3]]);const m=f!=null&&Math.max(...f)>c&&Math.min(...f)<=(r?2:1)&&Math.min(...f)>0;if(f==null||m)if(r){const y=Q0(a);let A=2,w=2;a.length&&([A,w]=K0(a)),h=y*(A/2)*(w/2),f=k(h).map(C=>C*2)}else f=k(h);return f}function _C(a){return a%2===0}function IC(a,r){if(a=a.slice(-2),r=r.slice(-2),R(a,r)||!a.length||!r.length||a[0]===0||a[1]===0||r[0]===0||r[1]===0)return!0;if(a.length!==r.length){const o=a[a.length-1],c=r[r.length-1];if(o===c||_C(o)&&_C(c)&&(a[0]===1||r[0]===1))return!0}return a[1]===r[1]&&_C(a[0])&&_C(r[0])}let RR,LR;function n1e(a){if(RR==null){const r=Vc(a);RR=r.getParameter(r.MAX_TEXTURE_SIZE)}return RR}function i1e(a){if(LR==null){const r=Vc(a);LR=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,LR)}function r1e(a){if(a===0)return 0;let r;const o=Vc(a);return ql(o,"EXT_disjoint_timer_query_webgl2")&&a===2?r=2:ql(o,"EXT_disjoint_timer_query")?r=1:r=0,r}function ql(a,r){return a.getExtension(r)!=null}function S9(a){try{if(Vc(a)!=null)return!0}catch(r){return console.log("Error when getting WebGL context: ",r),!1}return!1}function s1e(a){if(a===0)return!1;const r=Vc(a);if(a===1){if(!ql(r,"OES_texture_float"))return!1}else if(!ql(r,"EXT_color_buffer_float"))return!1;return BR(r)}function o1e(a){if(a===0)return!1;const r=Vc(a);if(a===1){if(!ql(r,"OES_texture_float")||!ql(r,"WEBGL_color_buffer_float"))return!1}else{if(ql(r,"EXT_color_buffer_float"))return BR(r);const o="EXT_color_buffer_half_float";if(ql(r,o)){const c=r.getExtension(o);return a1e(r,c)}return!1}return BR(r)}function BR(a){const r=TR(a),o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o),a.texImage2D(a.TEXTURE_2D,0,r.internalFormatFloat,1,1,0,r.textureFormatFloat,r.textureTypeFloat,null);const c=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,c),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,o,0);const h=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(o),a.deleteFramebuffer(c),h}function a1e(a,r){const o=TR(a,r),c=a.createTexture();a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);const h=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,h),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,c,0);const f=a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE;return a.bindTexture(a.TEXTURE_2D,null),a.bindFramebuffer(a.FRAMEBUFFER,null),a.deleteTexture(c),a.deleteFramebuffer(h),f}function l1e(a){return a!==2?!1:Vc(a).fenceSync!=null}function nb(a,r){Array.isArray(a)||(a=[a]),a.forEach(o=>{o!=null&&b(o.dtype!=="complex64",()=>`${r} does not support complex64 tensors in the WebGL backend.`)})}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Cn=Te();Cn.registerFlag("HAS_WEBGL",()=>Cn.getNumber("WEBGL_VERSION")>0),Cn.registerFlag("WEBGL_VERSION",()=>S9(2)?2:S9(1)?1:0),Cn.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),Cn.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Cn.get("WEBGL_VERSION")===2),Cn.registerFlag("WEBGL_CPU_FORWARD",()=>!0),Cn.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),Cn.registerFlag("WEBGL_PACK",()=>Cn.getBool("HAS_WEBGL")),Cn.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_CLIP",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_REDUCE",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_LAZILY_UNPACK",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_CONV_IM2COL",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Cn.getBool("WEBGL_PACK")),Cn.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>n1e(Cn.getNumber("WEBGL_VERSION"))),Cn.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>i1e(Cn.getNumber("WEBGL_VERSION"))),Cn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const a=Cn.getNumber("WEBGL_VERSION");return a===0?0:r1e(a)}),Cn.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Cn.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!EU()),Cn.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>s1e(Cn.getNumber("WEBGL_VERSION"))),Cn.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Cn.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Cn.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),Cn.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>o1e(Cn.getNumber("WEBGL_VERSION"))),Cn.registerFlag("WEBGL_FENCE_API_ENABLED",()=>l1e(Cn.getNumber("WEBGL_VERSION"))),Cn.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Cn.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),Cn.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,a=>{if(typeof a!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${a}.`);if(a<0&&a!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${a}.`)}),Cn.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>EU()?1:-1,a=>{if(typeof a!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${a}.`);if(a<0&&a!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${a}.`)}),Cn.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),Cn.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),Cn.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),Cn.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),Cn.registerFlag("WEBGL_EXP_CONV",()=>!1),Cn.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Cn.getBool("IS_TEST")),Cn.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),Cn.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),Cn.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),Cn.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Do(){let a,r,o,c,h,f,m,y,A,w;return Te().getNumber("WEBGL_VERSION")===2?(a="#version 300 es",r="in",o="out",c="in",h="texture",f="outputColor",m="out vec4 outputColor;",y=Te().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",A="",w=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(a="",r="attribute",o="varying",c="varying",h="texture2D",f="gl_FragColor",m="",y=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,A=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,w=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:a,attribute:r,varyingVs:o,varyingFs:c,texture2D:h,output:f,defineOutput:m,defineSpecialNaN:y,defineSpecialInf:A,defineRound:w}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Pm(a,r,o="index"){const c=Ie(r);return c.map((h,f)=>{const m=`int ${a[f]} = ${o} / ${h}`,y=f===c.length-1?`int ${a[f+1]} = ${o} - ${a[f]} * ${h}`:`index -= ${a[f]} * ${h}`;return`${m}; ${y};`}).join("")}function SC(a,r,o="index"){const c=Ie(r);return c.map((h,f)=>{const m=`int ${a[f]} = ${o} / outShapeStrides[${f}]`,y=f===c.length-1?`int ${a[f+1]} = ${o} - ${a[f]} * outShapeStrides[${f}]`:`index -= ${a[f]} * outShapeStrides[${f}]`;return`${m}; ${y};`}).join("")}function c1e(a,r){const o=a.length,c=a.map(f=>`${r}[${f}]`),h=new Array(o-1);h[o-2]=c[o-1];for(let f=o-3;f>=0;--f)h[f]=`(${h[f+1]} * ${c[f+1]})`;return h}function u1e(a,r,o="index"){const c=a.map((f,m)=>m),h=c1e(c,r);return h.map((f,m)=>{const y=`int ${a[m]} = ${o} / ${h[m]}`,A=m===h.length-1?`int ${a[m+1]} = ${o} - ${a[m]} * ${h[m]}`:`index -= ${a[m]} * ${h[m]}`;return`${y}; ${A};`}).join("")}function PR(a){const r=Ie(a).map(o=>o.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${r[0]} + coords.y * ${r[1]} + coords.z;
  }
`}function NR(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const T9=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{getBroadcastDims:M9}=sde;function h1e(a,r,o){const c=[];if(a.forEach(T=>{const B=M(T.shapeInfo.logicalShape);if(T.shapeInfo.isUniform?c.push(`uniform float ${T.name}${B>1?`[${B}]`:""};`):(c.push(`uniform sampler2D ${T.name};`),c.push(`uniform int offset${T.name};`)),o.enableShapeUniforms){const{uniformShape:O}=DR(o.packedInputs,T.shapeInfo.logicalShape,T.shapeInfo.texShape);switch(O.length){case 1:c.push(`uniform int ${T.name}Shape;`);break;case 2:c.push(`uniform ivec2 ${T.name}Shape;`);break;case 3:c.push(`uniform ivec3 ${T.name}Shape;`);break;case 4:c.push(`uniform ivec4 ${T.name}Shape;`);break}c.push(`uniform ivec2 ${T.name}TexShape;`)}}),o.enableShapeUniforms){switch(r.logicalShape.length){case 1:c.push("uniform int outShape;");break;case 2:c.push("uniform ivec2 outShape;"),c.push("uniform int outShapeStrides;");break;case 3:c.push("uniform ivec3 outShape;"),c.push("uniform ivec2 outShapeStrides;");break;case 4:c.push("uniform ivec4 outShape;"),c.push("uniform ivec3 outShapeStrides;");break}c.push("uniform ivec2 outTexShape;")}o.customUniforms&&o.customUniforms.forEach(T=>{c.push(`uniform ${T.type} ${T.name}${T.arrayIndex?`[${T.arrayIndex}]`:""};`)});const h=c.join(`
`),f=a.map(T=>d1e(T,r,o.packedInputs,o.enableShapeUniforms)).join(`
`),m=r.texShape,y=Do(),A=m1e(y);let w,C,_=A1e(y);return r.isPacked?(w=f1e(r.logicalShape,m,o.enableShapeUniforms),C=y1e(y)):(w=p1e(r.logicalShape,m,o.enableShapeUniforms),C=g1e(y)),o.packedInputs&&(_+=w1e),[_,A,C,h,w,f,o.userCode].join(`
`)}function Z0(a,r=!1){const o=a.shapeInfo.logicalShape;switch(o.length){case 0:return P1e(a,r);case 1:return D1e(a,r);case 2:return O1e(a,r);case 3:return U1e(a,r);case 4:return G1e(a,r);case 5:return W1e(a);case 6:return H1e(a);default:throw new Error(`${o.length}-D input sampling is not yet supported`)}}function k9(a,r){switch(a.shapeInfo.logicalShape.length){case 0:return B1e(a);case 1:return N1e(a,r);case 2:return F1e(a,r);case 3:return V1e(a,r);default:return z1e(a,r)}}function d1e(a,r,o=!1,c){let h="";o?h+=k9(a,c):h+=Z0(a,c);const f=a.shapeInfo.logicalShape,m=r.logicalShape;return f.length<=m.length&&(o?h+=X1e(a,r):h+=$1e(a,r)),h}function f1e(a,r,o){switch(a.length){case 0:return R9();case 1:return C1e(a,r,o);case 2:return R1e(a,r,o);case 3:return _1e(a,r,o);default:return S1e(a,r,o)}}function p1e(a,r,o){switch(a.length){case 0:return R9();case 1:return E1e(a,r,o);case 2:return L1e(a,r,o);case 3:return I1e(a,r,o);case 4:return T1e(a,r,o);case 5:return M1e(a,r);case 6:return k1e(a,r);default:throw new Error(`${a.length}-D output sampling is not yet supported`)}}function m1e(a){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${a.texture2D}(textureSampler, uv).r;
    }
  `}function g1e(a){return`
    void setOutput(float val) {
      ${a.output} = vec4(val, 0, 0, 0);
    }
  `}function y1e(a){return`
    void setOutput(vec4 val) {
      ${a.output} = val;
    }
  `}function A1e(a){return`${a.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${a.varyingFs} vec2 resultUV;
    ${a.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${a.defineSpecialNaN}
    ${a.defineSpecialInf}
    ${a.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${v1e}
    ${b1e}
    ${x1e}
  `}const v1e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,b1e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,x1e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,w1e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function R9(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function C1e(a,r,o){const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return c[0]===1?o?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${c[1]}.0);
      }
    `:c[1]===1?o?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${c[0]}.0);
      }
    `:o?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${c[0]}, ${c[1]}));
      return 2 * (resTexRC.x * ${c[1]} + resTexRC.y);
    }
  `}function E1e(a,r,o){return r[0]===1?o?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${r[1]}.0);
      }
    `:r[1]===1?o?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${r[0]}.0);
      }
    `:o?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      return resTexRC.x * ${r[1]} + resTexRC.y;
    }
  `}function _1e(a,r,o){if(o)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],h=Math.ceil(a[2]/2),f=h*Math.ceil(a[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${c[0]}, ${c[1]}));
      int index = resTexRC.x * ${c[1]} + resTexRC.y;

      int b = index / ${f};
      index -= b * ${f};

      int r = 2 * (index / ${h});
      int c = imod(index, ${h}) * 2;

      return ivec3(b, r, c);
    }
  `}function I1e(a,r,o){if(o)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${SC(["r","c","d"],a)}
    return ivec3(r, c, d);
  }
`;const c=Pm(["r","c","d"],a);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      ${c}
      return ivec3(r, c, d);
    }
  `}function S1e(a,r,o){if(o)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],h=Math.ceil(a[a.length-1]/2),f=h*Math.ceil(a[a.length-2]/2);let m=f,y="",A="b, r, c";for(let w=2;w<a.length-1;w++)m*=a[a.length-w-1],y=`
      int b${w} = index / ${m};
      index -= b${w} * ${m};
    `+y,A=`b${w}, `+A;return`
    ivec${a.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${c[0]}, ${c[1]}));
      int index = resTexRC.x * ${c[1]} + resTexRC.y;

      ${y}

      int b = index / ${f};
      index -= b * ${f};

      int r = 2 * (index / ${h});
      int c = imod(index, ${h}) * 2;

      return ivec${a.length}(${A});
    }
  `}function T1e(a,r,o){if(o)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${SC(["r","c","d","d2"],a)}
      return ivec4(r, c, d, d2);
    }
  `;const c=Pm(["r","c","d","d2"],a);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      ${c}
      return ivec4(r, c, d, d2);
    }
  `}function M1e(a,r){const o=Pm(["r","c","d","d2","d3"],a);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${r[0]},
                             ${r[1]}));

      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${o}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function k1e(a,r){const o=Pm(["r","c","d","d2","d3","d4"],a);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;

      ${o}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function R1e(a,r,o){const c=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];if(R(a,r))return o?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${c[0]}, ${c[1]}));
      }
    `;const h=Math.ceil(a[1]/2);return o?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${c[0]}, ${c[1]}));

      int index = resTexRC.x * ${c[1]} + resTexRC.y;
      int r = 2 * (index / ${h});
      int c = imod(index, ${h}) * 2;

      return ivec2(r, c);
    }
  `}function L1e(a,r,o){return R(a,r)?o?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${r[0]}, ${r[1]}));
      }
    `:a[1]===1?o?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${r[0]}, ${r[1]}));
        int index = resTexRC.x * ${r[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:a[0]===1?o?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${r[0]}, ${r[1]}));
        int index = resTexRC.x * ${r[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:o?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${r[0]}, ${r[1]}));
      int index = resTexRC.x * ${r[1]} + resTexRC.y;
      int r = index / ${a[1]};
      int c = index - r * ${a[1]};
      return ivec2(r, c);
    }
  `}function Nm(a){return`offset${a}`}function B1e(a){const r=a.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=Do();return`
    vec4 ${o}() {
      return ${c.texture2D}(${r}, halfCR);
    }
  `}function P1e(a,r){const o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1);if(a.shapeInfo.isUniform)return`float ${c}() {return ${o};}`;const[h,f]=a.shapeInfo.texShape;if(h===1&&f===1)return`
      float ${c}() {
        return sampleTexture(${o}, halfCR);
      }
    `;const m=Nm(o);if(r)return`
    float ${c}() {
      vec2 uv = uvFromFlat(${o}TexShape[0], ${o}TexShape[1], ${m});
      return sampleTexture(${o}, uv);
    }
  `;const[y,A]=a.shapeInfo.texShape;return`
    float ${c}() {
      vec2 uv = uvFromFlat(${y}, ${A}, ${m});
      return sampleTexture(${o}, uv);
    }
  `}function N1e(a,r){const o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1),h=a.shapeInfo.texShape,f=Do();if(r)return`
    vec4 ${c}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${o}TexShape[0]) / 2.0), ceil(float(${o}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${f.texture2D}(${o}, uv);
    }
  `;const m=[Math.ceil(h[0]/2),Math.ceil(h[1]/2)];return`
    vec4 ${c}(int index) {
      vec2 uv = packedUVfrom1D(
        ${m[0]}, ${m[1]}, index);
      return ${f.texture2D}(${o}, uv);
    }
  `}function D1e(a,r){const o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1);if(a.shapeInfo.isUniform)return`
      float ${c}(int index) {
        ${j0(a)}
      }
    `;const h=a.shapeInfo.texShape,f=h[0],m=h[1];if(m===1&&f===1)return`
      float ${c}(int index) {
        return sampleTexture(${o}, halfCR);
      }
    `;const y=Nm(o);return m===1?r?`
      float ${c}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${y}) + 0.5) / float(${o}TexShape[0]));
        return sampleTexture(${o}, uv);
      }
    `:`
      float ${c}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${y}) + 0.5) / ${f}.0);
        return sampleTexture(${o}, uv);
      }
    `:f===1?r?`
      float ${c}(int index) {
        vec2 uv = vec2((float(index + ${y}) + 0.5) / float(${o}TexShape[1]), 0.5);
        return sampleTexture(${o}, uv);
      }
    `:`
      float ${c}(int index) {
        vec2 uv = vec2((float(index + ${y}) + 0.5) / ${m}.0, 0.5);
        return sampleTexture(${o}, uv);
      }
    `:r?`
    float ${c}(int index) {
      vec2 uv = uvFromFlat(${o}TexShape[0], ${o}TexShape[1], index + ${y});
      return sampleTexture(${o}, uv);
    }
  `:`
    float ${c}(int index) {
      vec2 uv = uvFromFlat(${f}, ${m}, index + ${y});
      return sampleTexture(${o}, uv);
    }
  `}function F1e(a,r){const o=a.shapeInfo.logicalShape,c=a.name,h="get"+c.charAt(0).toUpperCase()+c.slice(1),f=a.shapeInfo.texShape,m=f[0],y=f[1],A=Do();if(f!=null&&R(o,f))return r?`
      vec4 ${h}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${c}TexShape[1], ${c}TexShape[0]);

        return ${A.texture2D}(${c}, uv);
      }
    `:`
      vec4 ${h}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${y}.0, ${m}.0);

        return ${A.texture2D}(${c}, uv);
      }
    `;if(r)return`
    vec4 ${h}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${c}TexShape[0]) / 2.0), ceil(float(${c}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${c}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${A.texture2D}(${c}, uv);
    }
  `;const w=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)],C=Math.ceil(o[1]/2);return`
    vec4 ${h}(int row, int col) {
      vec2 uv = packedUVfrom2D(${C}, ${w[0]}, ${w[1]}, row, col);
      return ${A.texture2D}(${c}, uv);
    }
  `}function O1e(a,r){const o=a.shapeInfo.logicalShape,c=a.name,h="get"+c.charAt(0).toUpperCase()+c.slice(1),f=a.shapeInfo.texShape;if(f!=null&&R(o,f)){if(r)return`
      float ${h}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${c}TexShape[1], ${c}TexShape[0]);
        return sampleTexture(${c}, uv);
      }
    `;const T=f[0],B=f[1];return`
    float ${h}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${B}.0, ${T}.0);
      return sampleTexture(${c}, uv);
    }
  `}const{newShape:m,keptDims:y}=ne(o),A=m;if(A.length<o.length){const T=Y0(a,A),B=["row","col"];return`
      ${Z0(T,r)}
      float ${h}(int row, int col) {
        return ${h}(${q0(B,y)});
      }
    `}if(a.shapeInfo.isUniform)return`
      float ${h}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${o[1]}, 1)));
        ${j0(a)}
      }
    `;const w=f[0],C=f[1],_=Nm(c);return C===1?r?`
      float ${h}(int row, int col) {
        float index = dot(vec3(row, col, ${_}), vec3(${c}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${c}TexShape[0]));
        return sampleTexture(${c}, uv);
      }
    `:`
    float ${h}(int row, int col) {
      float index = dot(vec3(row, col, ${_}), vec3(${o[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${w}.0);
      return sampleTexture(${c}, uv);
    }
  `:w===1?r?`
      float ${h}(int row, int col) {
        float index = dot(vec3(row, col, ${_}), vec3(${c}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${c}TexShape[1]), 0.5);
        return sampleTexture(${c}, uv);
      }
    `:`
    float ${h}(int row, int col) {
      float index = dot(vec3(row, col, ${_}), vec3(${o[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${C}.0, 0.5);
      return sampleTexture(${c}, uv);
    }
  `:r?`
      float ${h}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${c}Shape[1] + col + ${_};
        vec2 uv = uvFromFlat(${c}TexShape[0], ${c}TexShape[1], index);
        return sampleTexture(${c}, uv);
      }
    `:`
  float ${h}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${o[1]} + col + ${_};
    vec2 uv = uvFromFlat(${w}, ${C}, index);
    return sampleTexture(${c}, uv);
  }
`}function V1e(a,r){const o=a.shapeInfo.logicalShape,c=a.name,h="get"+c.charAt(0).toUpperCase()+c.slice(1),f=a.shapeInfo.texShape,m=[Math.ceil(f[0]/2),Math.ceil(f[1]/2)];if(o[0]===1){const T=o.slice(1),B=[1,2],O=Y0(a,T),U=["b","row","col"];return`
        ${k9(O,r)}
        vec4 ${h}(int b, int row, int col) {
          return ${h}(${q0(U,B)});
        }
      `}const y=Do();if(r)return`
    vec4 ${h}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${c}TexShape[0]) / 2.0), ceil(float(${c}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${c}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${c}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${y.texture2D}(${c}, uv);
    }
  `;const A=m[0],w=m[1],C=Math.ceil(o[2]/2),_=C*Math.ceil(o[1]/2);return`
    vec4 ${h}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${A}, ${w}, ${_}, ${C}, b, row, col);
      return ${y.texture2D}(${c}, uv);
    }
  `}function U1e(a,r){const o=a.shapeInfo.logicalShape,c=a.name,h="get"+c.charAt(0).toUpperCase()+c.slice(1),f=o[1]*o[2],m=o[2],{newShape:y,keptDims:A}=ne(o),w=y;if(w.length<o.length){const U=Y0(a,w),W=["row","col","depth"];return`
        ${Z0(U,r)}
        float ${h}(int row, int col, int depth) {
          return ${h}(${q0(W,A)});
        }
      `}if(a.shapeInfo.isUniform)return`
      float ${h}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${f}, ${m}, 1)));
        ${j0(a)}
      }
    `;const C=a.shapeInfo.texShape,_=C[0],T=C[1],B=a.shapeInfo.flatOffset;if(T===f&&B==null)return r?`
      float ${h}(int row, int col, int depth) {
        int stride1 = ${c}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${c}TexShape[1], ${c}TexShape[0]);
        return sampleTexture(${c}, uv);
      }
    `:`
        float ${h}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${m}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${T}.0, ${_}.0);
          return sampleTexture(${c}, uv);
        }
      `;if(T===m&&B==null)return r?`
      float ${h}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${c}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}TexShape[1], ${c}TexShape[0]);
        return sampleTexture(${c}, uv);
      }
    `:`
    float ${h}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${o[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${T}.0, ${_}.0);
      return sampleTexture(${c}, uv);
    }
  `;const O=Nm(c);return r?`
    float ${h}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${c}Shape[1] * ${c}Shape[2];
      int stride1 = ${c}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${O};
      vec2 uv = uvFromFlat(${c}TexShape[0], ${c}TexShape[1], index);
      return sampleTexture(${c}, uv);
    }
    `:`
      float ${h}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${f} + col * ${m} + depth + ${O};
        vec2 uv = uvFromFlat(${_}, ${T}, index);
        return sampleTexture(${c}, uv);
      }
  `}function z1e(a,r){const o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1),h=Do();if(r)return`
    vec4 ${c}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${o}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${o}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${o}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${o}TexShape[0]) / 2.0), ceil(float(${o}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${h.texture2D}(${o}, uv);
    }
  `;const f=a.shapeInfo.logicalShape,m=f.length,y=a.shapeInfo.texShape,A=[Math.ceil(y[0]/2),Math.ceil(y[1]/2)],w=A[0],C=A[1],_=Math.ceil(f[m-1]/2);let T=_*Math.ceil(f[m-2]/2),B="int b, int row, int col",O=`b * ${T} + (row / 2) * ${_} + (col / 2)`;for(let U=2;U<m-1;U++)B=`int b${U}, `+B,T*=f[m-U-1],O=`b${U} * ${T} + `+O;return`
    vec4 ${c}(${B}) {
      int index = ${O};
      int texR = index / ${C};
      int texC = index - texR * ${C};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${C}, ${w});
      return ${h.texture2D}(${o}, uv);
    }
  `}function G1e(a,r){const o=a.shapeInfo.logicalShape,c=a.name,h="get"+c.charAt(0).toUpperCase()+c.slice(1),f=o[3],m=o[2]*f,y=o[1]*m,{newShape:A,keptDims:w}=ne(o);if(A.length<o.length){const X=Y0(a,A),re=["row","col","depth","depth2"];return`
      ${Z0(X,r)}
      float ${h}(int row, int col, int depth, int depth2) {
        return ${h}(${q0(re,w)});
      }
    `}if(a.shapeInfo.isUniform)return`
      float ${h}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${y}, ${m}, ${f}, 1)));
        ${j0(a)}
      }
    `;const C=a.shapeInfo.flatOffset,_=a.shapeInfo.texShape,T=_[0],B=_[1],O=`int stride2 = ${c}Shape[3];`,U=`int stride1 = ${c}Shape[2] * stride2;`,W=`int stride0 = ${c}Shape[1] * stride1;`;if(B===y&&C==null)return r?`
      float ${h}(int row, int col, int depth, int depth2) {
        ${O}
        ${U}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${c}TexShape[1], ${c}TexShape[0]);
        return sampleTexture(${c}, uv);
      }
    `:`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${m}, ${f}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${B}.0, ${T}.0);
        return sampleTexture(${c}, uv);
      }
    `;if(B===f&&C==null)return r?`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${c}Shape[1] * ${c}Shape[2], ${c}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${c}TexShape[1], ${c}TexShape[0]);
        return sampleTexture(${c}, uv);
      }
    `:`
      float ${h}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${o[1]*o[2]}, ${o[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${B}.0, ${T}.0);
        return sampleTexture(${c}, uv);
      }
    `;const z=Nm(c);return r?`
    float ${h}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${O}
      ${U}
      ${W}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${c}TexShape[0], ${c}TexShape[1], index + ${z});
      return sampleTexture(${c}, uv);
    }
  `:`
    float ${h}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${y} + col * ${m} +
          depth * ${f} + depth2;
      vec2 uv = uvFromFlat(${T}, ${B}, index + ${z});
      return sampleTexture(${c}, uv);
    }
  `}function W1e(a){const r=a.shapeInfo.logicalShape,o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1),h=r[4],f=r[3]*h,m=r[2]*f,y=r[1]*m,{newShape:A,keptDims:w}=ne(r);if(A.length<r.length){const U=Y0(a,A),W=["row","col","depth","depth2","depth3"];return`
      ${Z0(U)}
      float ${c}(int row, int col, int depth, int depth2, int depth3) {
        return ${c}(${q0(W,w)});
      }
    `}if(a.shapeInfo.isUniform)return`
      float ${c}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${y}, ${m}, ${f}, ${h})) +
          depth3;
        ${j0(a)}
      }
    `;const C=a.shapeInfo.flatOffset,_=a.shapeInfo.texShape,T=_[0],B=_[1];if(B===y&&C==null)return`
      float ${c}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${m}, ${f}, ${h}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${B}.0, ${T}.0);
        return sampleTexture(${o}, uv);
      }
    `;if(B===h&&C==null)return`
      float ${c}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${r[1]*r[2]*r[3]},
               ${r[2]*r[3]}, ${r[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${B}.0, ${T}.0);
        return sampleTexture(${o}, uv);
      }
    `;const O=Nm(o);return`
    float ${c}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${y} + col * ${m} + depth * ${f} +
          depth2 * ${h} + depth3 + ${O};
      vec2 uv = uvFromFlat(${T}, ${B}, index);
      return sampleTexture(${o}, uv);
    }
  `}function H1e(a){const r=a.shapeInfo.logicalShape,o=a.name,c="get"+o.charAt(0).toUpperCase()+o.slice(1),{newShape:h,keptDims:f}=ne(r);if(h.length<r.length){const W=Y0(a,h),z=["row","col","depth","depth2","depth3","depth4"];return`
      ${Z0(W)}
      float ${c}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${c}(${q0(z,f)});
      }
    `}const m=r[5],y=r[4]*m,A=r[3]*y,w=r[2]*A,C=r[1]*w;if(a.shapeInfo.isUniform)return`
      float ${c}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${C}, ${w}, ${A}, ${y})) +
          dot(
            vec2(depth3, depth4),
            vec2(${m}, 1)));
        ${j0(a)}
      }
    `;const _=a.shapeInfo.flatOffset,T=a.shapeInfo.texShape,B=T[0],O=T[1];if(O===C&&_==null)return`
      float ${c}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${w}, ${A}, ${y}, ${m})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${O}.0, ${B}.0);
        return sampleTexture(${o}, uv);
      }
    `;if(O===m&&_==null)return`
      float ${c}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${r[1]*r[2]*r[3]*r[4]},
               ${r[2]*r[3]*r[4]},
               ${r[3]*r[4]},
               ${r[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${O}.0, ${B}.0);
        return sampleTexture(${o}, uv);
      }
    `;const U=Nm(o);return`
    float ${c}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${C} + col * ${w} + depth * ${A} +
          depth2 * ${y} + depth3 * ${m} + depth4 + ${U};
      vec2 uv = uvFromFlat(${B}, ${O}, index);
      return sampleTexture(${o}, uv);
    }
  `}function j0(a){const r=a.name,o=M(a.shapeInfo.logicalShape);return o<2?`return ${r};`:`
    for (int i = 0; i < ${o}; i++) {
      if (i == index) {
        return ${r}[i];
      }
    }
  `}function X1e(a,r){const o=a.name,c=o.charAt(0).toUpperCase()+o.slice(1),h="get"+c+"AtOutCoords",f=a.shapeInfo.logicalShape.length,m=r.logicalShape.length,y=M9(a.shapeInfo.logicalShape,r.logicalShape),A=er(m),w=m-f;let C;const _=["x","y","z","w","u","v"];f===0?C="":m<2&&y.length>=1?C="coords = 0;":C=y.map(W=>`coords.${_[W+w]} = 0;`).join(`
`);let T="";m<2&&f>0?T="coords":T=a.shapeInfo.logicalShape.map((W,z)=>`coords.${_[z+w]}`).join(", ");let B="return outputValue;";const O=M(a.shapeInfo.logicalShape)===1,U=M(r.logicalShape)===1;if(f===1&&!O&&!U)B=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(O&&!U)m===1?B=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:B=`
        return vec4(outputValue.x);
      `;else if(y.length){const W=f-2,z=f-1;y.indexOf(W)>-1&&y.indexOf(z)>-1?B="return vec4(outputValue.x);":y.indexOf(W)>-1?B="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":y.indexOf(z)>-1&&(B="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${h}() {
      ${A} coords = getOutputCoords();
      ${C}
      vec4 outputValue = get${c}(${T});
      ${B}
    }
  `}function $1e(a,r){const o=a.name,c=o.charAt(0).toUpperCase()+o.slice(1),h="get"+c+"AtOutCoords",f=r.texShape,m=a.shapeInfo.texShape,y=a.shapeInfo.logicalShape.length,A=r.logicalShape.length;if(!a.shapeInfo.isUniform&&y===A&&a.shapeInfo.flatOffset==null&&R(m,f))return`
      float ${h}() {
        return sampleTexture(${o}, resultUV);
      }
    `;const w=er(A),C=M9(a.shapeInfo.logicalShape,r.logicalShape),_=A-y;let T;const B=["x","y","z","w","u","v"];y===0?T="":A<2&&C.length>=1?T="coords = 0;":T=C.map(U=>`coords.${B[U+_]} = 0;`).join(`
`);let O="";return A<2&&y>0?O="coords":O=a.shapeInfo.logicalShape.map((U,W)=>`coords.${B[W+_]}`).join(", "),`
    float ${h}() {
      ${w} coords = getOutputCoords();
      ${T}
      return get${c}(${O});
    }
  `}function er(a){if(a<=1)return"int";if(a===2)return"ivec2";if(a===3)return"ivec3";if(a===4)return"ivec4";if(a===5)return"ivec5";if(a===6)return"ivec6";throw Error(`GPU for rank ${a} is not yet supported`)}function DR(a,r,o){const{newShape:c,keptDims:h}=ne(r),f=r.length,m=a&&f===3&&r[0]===1,y=m?r.slice(1):c,A=!a&&f>1&&!R(r,o)&&c.length<f||m;return{useSqueezeShape:A,uniformShape:A?y:r,keptDims:h}}function Y0(a,r){const o=JSON.parse(JSON.stringify(a));return o.shapeInfo.logicalShape=r,o}function q0(a,r){return r.map(o=>a[o]).join(", ")}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q1e(a,r,o,c){const h=o.map((C,_)=>{const T={logicalShape:C.shape,texShape:C.isUniform?null:C.texData.texShape,isUniform:C.isUniform,isPacked:C.isUniform?!1:C.texData.isPacked,flatOffset:null};return C.texData!=null&&C.texData.slice!=null&&C.texData.slice.flatOffset>0&&(T.flatOffset=C.texData.slice.flatOffset),{name:r.variableNames[_],shapeInfo:T}}),f=h.map(C=>C.shapeInfo),m={logicalShape:c.shape,texShape:c.texData.texShape,isUniform:!1,isPacked:c.texData.isPacked,flatOffset:null},y=h1e(h,m,r),A=Uxe(a.gl,y),w=a.createProgram(A);return Te().get("ENGINE_COMPILE_ONLY")?{program:r,fragmentShader:A,source:y,webGLProgram:w,inShapeInfos:f,outShapeInfo:m,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(a.buildVao(w),Object.assign({program:r,fragmentShader:A,source:y,webGLProgram:w,inShapeInfos:f,outShapeInfo:m},L9(a,r,w)))}function L9(a,r,o){const c=[],h=[];let f,m,y,A=null,w=null;w=a.getUniformLocation(o,"NAN",!1),Te().getNumber("WEBGL_VERSION")===1&&(A=a.getUniformLocation(o,"INFINITY",!1));const C=!1;for(const _ of r.variableNames){const T={name:_,uniform:a.getUniformLocation(o,_,C),offset:a.getUniformLocation(o,`offset${_}`,C)};r.enableShapeUniforms&&(T.shape=a.getUniformLocation(o,`${_}Shape`,C),T.texShape=a.getUniformLocation(o,`${_}TexShape`,C)),c.push(T)}if(r.enableShapeUniforms&&(f=a.getUniformLocation(o,"outShape",C),y=a.getUniformLocation(o,"outShapeStrides",C),m=a.getUniformLocation(o,"outTexShape",C)),r.customUniforms)for(const _ of r.customUniforms)h.push(a.getUniformLocation(o,_.name,C));return{variablesLocations:c,customUniformLocations:h,infLoc:A,nanLoc:w,outShapeLocation:f,outShapeStridesLocation:y,outTexShapeLocation:m}}function B9(a,r){if(a.length!==r.length)throw Error(`Binary was compiled with ${a.length} inputs, but was executed with ${r.length} inputs`);a.forEach((o,c)=>{const h=o.logicalShape,f=r[c],m=f.shape;if(!R(h,m))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${h} and ${m} must match`);if(o.isUniform&&f.isUniform)return;const y=o.texShape,A=f.isUniform?null:f.texData.texShape;if(!R(y,A))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${y} and ${A} must match`)})}function K1e(a,r,o,c,h){r.program.enableShapeUniforms||(B9(r.inShapeInfos,o),B9([r.outShapeInfo],[c]));const f=c.texData.texture,m=c.texData.texShape;c.texData.isPacked?a.setOutputPackedMatrixTexture(f.texture,m[0],m[1]):a.setOutputMatrixTexture(f.texture,m[0],m[1]),a.setProgram(r.webGLProgram),a.bindVertexArray(r.webGLProgram.vao),Te().getNumber("WEBGL_VERSION")===1&&r.infLoc!==null&&a.gl.uniform1f(r.infLoc,1/0),r.nanLoc!==null&&a.gl.uniform1f(r.nanLoc,NaN);for(let A=0;A<o.length;++A){const w=o[A],{uniform:C,offset:_,shape:T,texShape:B}=r.variablesLocations[A];if(T){const{uniformShape:O}=DR(r.program.packedInputs,w.shape,w.texData.texShape);switch(O.length){case 1:a.gl.uniform1iv(T,new Int32Array(O));break;case 2:a.gl.uniform2iv(T,new Int32Array(O));break;case 3:a.gl.uniform3iv(T,new Int32Array(O));break;case 4:a.gl.uniform4iv(T,new Int32Array(O));break}}if(B&&a.gl.uniform2i(B,w.texData.texShape[0],w.texData.texShape[1]),C!=null){if(w.isUniform){if(M(w.shape)<2)a.gl.uniform1f(C,w.uniformValues[0]);else{let O=w.uniformValues;O instanceof Float32Array||(O=new Float32Array(O)),a.gl.uniform1fv(C,O)}continue}w.texData.slice!=null&&_!=null&&a.gl.uniform1i(_,w.texData.slice.flatOffset),a.setInputMatrixTexture(w.texData.texture.texture,C,A)}}const y=r.outShapeLocation;if(y)switch(c.shape.length){case 1:a.gl.uniform1iv(y,new Int32Array(c.shape));break;case 2:a.gl.uniform2iv(y,new Int32Array(c.shape));break;case 3:a.gl.uniform3iv(y,new Int32Array(c.shape));break;case 4:a.gl.uniform4iv(y,new Int32Array(c.shape));break}if(r.outShapeStridesLocation){const A=Ie(c.shape);switch(c.shape.length){case 2:a.gl.uniform1iv(r.outShapeStridesLocation,new Int32Array(A));break;case 3:a.gl.uniform2iv(r.outShapeStridesLocation,new Int32Array(A));break;case 4:a.gl.uniform3iv(r.outShapeStridesLocation,new Int32Array(A));break}}if(r.outTexShapeLocation&&a.gl.uniform2i(r.outTexShapeLocation,c.texData.texShape[0],c.texData.texShape[1]),r.program.customUniforms&&h)for(let A=0;A<r.program.customUniforms.length;++A){const w=r.program.customUniforms[A],C=r.customUniformLocations[A],_=h[A];if(w.type==="float")a.gl.uniform1fv(C,_);else if(w.type==="vec2")a.gl.uniform2fv(C,_);else if(w.type==="vec3")a.gl.uniform3fv(C,_);else if(w.type==="vec4")a.gl.uniform4fv(C,_);else if(w.type==="int")a.gl.uniform1iv(C,_);else if(w.type==="ivec2")a.gl.uniform2iv(C,_);else if(w.type==="ivec3")a.gl.uniform3iv(C,_);else if(w.type==="ivec4")a.gl.uniform4iv(C,_);else throw Error(`uniform type ${w.type} is not supported yet.`)}a.executeProgram()}function Z1e(a,r,o){let c="";r.concat(o).forEach(m=>{const y=m.texData!=null&&m.texData.slice!=null&&m.texData.slice.flatOffset>0;if(a.enableShapeUniforms&&!m.isUniform){const A=m.texData.texShape,{useSqueezeShape:w,uniformShape:C,keptDims:_}=DR(a.packedInputs,m.shape,A);let T="",B="",O="";if(C.length===1&&a.packedInputs){const le=[Math.ceil(A[0]/2),Math.ceil(A[1]/2)];T=`${le[0]>1}_${le[1]>1}`}else if(C.length===2&&!a.packedInputs)B=`${C[0]>1}_${C[1]>1}`;else if(C.length>2&&!a.packedInputs){const le=Ie(C);O=`${le[0]===A[1]}_${le[le.length-1]===A[1]}`}const U=m.shape.length,W=C.length===2&&R(m.shape,A),z=M(m.shape)===1,X=R0(m.shape,o.shape),re=!a.packedInputs&&U===o.shape.length&&R(A,o.texData.texShape),se=a.packedInputs||C.length>2?"":`${A[0]>1}_${A[1]>1}`;c+=`${U}_${re}_${w?_:""}_${C.length}_${z}_${X}_${W}_${T}_${B}_${O}_${se}_${y}`}else{const A=m.isUniform?"uniform":m.texData.texShape;c+=`${m.shape}_${A}_${y}`}});const h=a.userCode;let f=a.constructor.name;return f+="_"+c+"_"+h+`${Te().getNumber("WEBGL_VERSION")}`,f}function po(a){return Te().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&a<=4}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class j1e{constructor(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=eb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=Do();this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?SC(["r","c","d"],r):Pm(["r","c","d"],r)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${o.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Y1e{constructor(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=eb.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const o=Do();this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?SC(["r","c","d"],r):Pm(["r","c","d"],r)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${o.output} = result;
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class q1e{constructor(r){this.variableNames=["A"],this.outTexUsage=bl.DOWNLOAD;const o=Do();this.outputShape=r,this.userCode=`
      ${T9}

      void main() {
        float x = getAAtOutCoords();
        ${o.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class J1e{constructor(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=bl.DOWNLOAD;const o=Do();this.outputShape=r,this.userCode=`
      ${T9}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${o.output} = encode_float(x);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ewe={R:0,G:1,B:2,A:3};class P9{constructor(r,o=!1,c="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const h=Do();this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length);let f="result";o&&(f="floor(result * 255. + 0.5)");let m="";for(let y=0;y<c.length;y++){const A=c[y];m+=`
          if(offset == ${y}) {
            result = values[${ewe[A]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?NR():PR(r)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${c.length});

        flatIndex = idiv(flatIndex, ${c.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${h.texture2D}(A, uv);
          ${m}
        }
        ${h.output} = vec4(${f}, 0., 0., 0.);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class twe{constructor(r,o=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const c=Do();this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length);let h="",f="result";o&&(f="floor(result * 255. + 0.5)");for(let m=0;m<=1;m++)for(let y=0;y<=1;y++){const A=m*2+y;h+=`
          localCoords = coords;
          if(localCoords[2] + ${y} < ${this.enableShapeUniforms?"outShape[2]":`${r[2]}`}) {
          localCoords[2] += ${y};
          if (localCoords[1] + ${m} < ${this.enableShapeUniforms?"outShape[1]":`${r[1]}`}) {
            localCoords[1] += ${m};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${c.texture2D}(A, uv);

            if (offset == 0) {
              result[${A}] = values[0];
            } else if (offset == 1) {
              result[${A}] = values[1];
            } else if (offset == 2) {
              result[${A}] = values[2];
            } else {
              result[${A}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?NR():PR(r)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${h}

          ${c.output} = ${f};
        }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nwe(a){const r=Do(),o=`${r.version}
    precision highp float;
    ${r.attribute} vec3 clipSpacePos;
    ${r.attribute} vec2 uv;
    ${r.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Vxe(a,o)}function iwe(a){const r=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Hxe(a,r)}function rwe(a){const r=new Uint16Array([0,1,2,2,1,3]);return Xxe(a,r)}function ib(a,r,o,c,h,f){Qxe(r,o);const m=$xe(a),y=a.TEXTURE_2D;return mn(a,()=>a.bindTexture(y,m)),mn(a,()=>a.texParameteri(y,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE)),mn(a,()=>a.texParameteri(y,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)),mn(a,()=>a.texParameteri(y,a.TEXTURE_MIN_FILTER,a.NEAREST)),mn(a,()=>a.texParameteri(y,a.TEXTURE_MAG_FILTER,a.NEAREST)),Te().getNumber("WEBGL_VERSION")===1?mn(a,()=>a.texImage2D(y,0,c,r,o,0,h,f,null)):mn(a,()=>a.texStorage2D(y,1,c,r,o)),mn(a,()=>a.bindTexture(a.TEXTURE_2D,null)),{texture:m,texShape:[o,r]}}function N9(a){return a.internalFormatFloat}function swe(a,r,o,c){const[h,f]=tb(r,o);return ib(a,h,f,N9(c),c.textureFormatFloat,a.FLOAT)}function D9(a){return a.internalFormatHalfFloat}function owe(a,r,o,c){const[h,f]=tb(r,o);return ib(a,h,f,D9(c),c.textureFormatFloat,c.textureTypeHalfFloat)}function F9(a){return a.downloadTextureFormat}function awe(a,r,o,c){const[h,f]=tb(r,o);return ib(a,h,f,F9(c),a.RGBA,a.UNSIGNED_BYTE)}function O9(a){return a.internalFormatPackedFloat}function lwe(a,r,o,c){const[h,f]=$0(r,o);return ib(a,h,f,O9(c),a.RGBA,a.FLOAT)}function V9(a){return a.internalFormatPackedHalfFloat}function cwe(a,r,o,c){const[h,f]=$0(r,o);return ib(a,h,f,V9(c),a.RGBA,c.textureTypeHalfFloat)}function uwe(a,r,o){return mn(a,()=>a.bindBuffer(a.ARRAY_BUFFER,o)),_9(a,r,"clipSpacePos",o,3,20,0)&&_9(a,r,"uv",o,2,20,12)}function hwe(a,r,o,c,h,f){mn(a,()=>a.bindTexture(a.TEXTURE_2D,r));let m,y,A;h instanceof Uint8Array?(m=new Uint8Array(o*c*4),y=a.UNSIGNED_BYTE,A=a.RGBA):(m=new Float32Array(o*c*4),y=a.FLOAT,A=f.internalFormatPackedFloat),m.set(h),Te().getNumber("WEBGL_VERSION")===2?mn(a,()=>a.texSubImage2D(a.TEXTURE_2D,0,0,0,o,c,a.RGBA,y,m)):mn(a,()=>a.texImage2D(a.TEXTURE_2D,0,A,o,c,0,a.RGBA,y,m)),mn(a,()=>a.bindTexture(a.TEXTURE_2D,null))}function dwe(a,r,o){mn(a,()=>a.bindTexture(a.TEXTURE_2D,r)),o.data instanceof Uint8Array?Te().getNumber("WEBGL_VERSION")===2?mn(a,()=>a.texSubImage2D(a.TEXTURE_2D,0,0,0,o.width,o.height,a.RGBA,a.UNSIGNED_BYTE,o.data)):mn(a,()=>a.texImage2D(a.TEXTURE_2D,0,a.RGBA,o.width,o.height,0,a.RGBA,a.UNSIGNED_BYTE,o.data)):Te().getNumber("WEBGL_VERSION")===2?mn(a,()=>a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,o)):mn(a,()=>a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o)),mn(a,()=>a.bindTexture(a.TEXTURE_2D,null))}function fwe(a,r,o,c){const h=a.createBuffer();mn(a,()=>a.bindBuffer(a.PIXEL_PACK_BUFFER,h));const f=4*4*r*o;return mn(a,()=>a.bufferData(a.PIXEL_PACK_BUFFER,f,a.STREAM_READ)),mn(a,()=>a.readPixels(0,0,o,r,a.RGBA,a.FLOAT,0)),mn(a,()=>a.bindBuffer(a.PIXEL_PACK_BUFFER,null)),h}function pwe(a,r,o){const c=a,h=new Float32Array(o);return c.bindBuffer(c.PIXEL_PACK_BUFFER,r),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,h),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),h}function mwe(a,r,o,c){const[h,f]=tb(r,o),m=4,y=new Uint8Array(Lxe(r*o,m));return mn(a,()=>a.readPixels(0,0,h,f,c.downloadTextureFormat,a.UNSIGNED_BYTE,y)),new Float32Array(y.buffer)}function gwe(a,r,o,c,h,f,m,y){const A=a,w=new Float32Array(Bxe(f,m));return A.bindBuffer(A.PIXEL_PACK_BUFFER,r),A.getBufferSubData(A.PIXEL_PACK_BUFFER,0,w),A.bindBuffer(A.PIXEL_PACK_BUFFER,null),w}function ywe(a,r,o){const c=new Float32Array(r*o*4);return mn(a,()=>a.readPixels(0,0,o,r,a.RGBA,a.FLOAT,c)),c}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class FR{constructor(r){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const o=Te().getNumber("WEBGL_VERSION");if(r!=null?(this.gl=r,Mxe(o,r)):this.gl=Vc(o),r=this.gl,Te().getNumber("WEBGL_VERSION")===2){const f=r;this.createVertexArray=()=>mn(f,()=>f.createVertexArray()),this.bindVertexArray=m=>mn(f,()=>f.bindVertexArray(m)),this.deleteVertexArray=m=>mn(f,()=>f.deleteVertexArray(m)),this.getVertexArray=()=>mn(f,()=>f.getParameter(f.VERTEX_ARRAY_BINDING))}else if(r!=null){const f=r.getExtension("OES_vertex_array_object");if(f==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>mn(r,()=>f.createVertexArrayOES()),this.bindVertexArray=m=>mn(r,()=>f.bindVertexArrayOES(m)),this.deleteVertexArray=m=>mn(r,()=>f.deleteVertexArrayOES(m)),this.getVertexArray=()=>mn(r,()=>r.getParameter(f.VERTEX_ARRAY_BINDING_OES))}let c="WEBGL_color_buffer_float";const h="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),Te().getNumber("WEBGL_VERSION")===1){const f="OES_texture_float",m="OES_texture_half_float";if(this.textureFloatExtension=wC(this.gl,f),ql(this.gl,m))this.textureHalfFloatExtension=wC(this.gl,m);else if(Te().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(c),ql(this.gl,h))this.colorBufferHalfFloatExtension=wC(this.gl,h);else if(Te().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(c="EXT_color_buffer_float",ql(this.gl,c))this.colorBufferFloatExtension=this.gl.getExtension(c);else if(ql(this.gl,h))this.colorBufferHalfFloatExtension=this.gl.getExtension(h);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=iwe(this.gl),this.indexBuffer=rwe(this.gl),this.framebuffer=Kxe(this.gl),this.textureConfig=TR(this.gl,this.textureHalfFloatExtension)}get debug(){return Te().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const r=this.gl;mn(r,()=>r.finish()),mn(r,()=>r.bindFramebuffer(r.FRAMEBUFFER,null)),mn(r,()=>r.deleteFramebuffer(this.framebuffer)),mn(r,()=>r.bindBuffer(r.ARRAY_BUFFER,null)),mn(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null)),mn(r,()=>r.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(r,o){return this.throwIfDisposed(),swe(this.gl,r,o,this.textureConfig)}createFloat16MatrixTexture(r,o){return this.throwIfDisposed(),owe(this.gl,r,o,this.textureConfig)}createUnsignedBytesMatrixTexture(r,o){return this.throwIfDisposed(),awe(this.gl,r,o,this.textureConfig)}uploadPixelDataToTexture(r,o){this.throwIfDisposed(),dwe(this.gl,r,o)}uploadDenseMatrixToTexture(r,o,c,h){this.throwIfDisposed(),hwe(this.gl,r,o,c,h,this.textureConfig)}createFloat16PackedMatrixTexture(r,o){return this.throwIfDisposed(),cwe(this.gl,r,o,this.textureConfig)}createPackedMatrixTexture(r,o){return this.throwIfDisposed(),lwe(this.gl,r,o,this.textureConfig)}deleteMatrixTexture(r){this.throwIfDisposed(),this.outputTexture===r&&(I9(this.gl,this.framebuffer),this.outputTexture=null),mn(this.gl,()=>this.gl.deleteTexture(r))}downloadByteEncodedFloatMatrixFromOutputTexture(r,o,c){return this.downloadMatrixDriver(r,()=>mwe(this.gl,o,c,this.textureConfig))}downloadPackedMatrixFromBuffer(r,o,c,h,f,m){return gwe(this.gl,r,o,c,h,f,m,this.textureConfig)}downloadFloat32MatrixFromBuffer(r,o){return pwe(this.gl,r,o)}createBufferFromTexture(r,o,c){this.bindTextureToFrameBuffer(r);const h=fwe(this.gl,o,c,this.textureConfig);return this.unbindTextureToFrameBuffer(),h}createAndWaitForFence(){const r=this.createFence(this.gl);return this.pollFence(r)}createFence(r){let o,c;if(Te().getBool("WEBGL_FENCE_API_ENABLED")){const h=r,f=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);r.flush(),c=()=>{const m=h.clientWaitSync(f,0,0);return m===h.ALREADY_SIGNALED||m===h.CONDITION_SATISFIED},o=f}else Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(o=this.beginQuery(),this.endQuery(),c=()=>this.isQueryAvailable(o,Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):c=()=>!0;return{query:o,isFencePassed:c}}downloadMatrixFromPackedTexture(r,o,c){return this.downloadMatrixDriver(r,()=>ywe(this.gl,o,c))}createProgram(r){this.throwIfDisposed();const o=this.gl;this.vertexShader==null&&(this.vertexShader=nwe(o));const c=Gxe(o);mn(o,()=>o.attachShader(c,this.vertexShader)),mn(o,()=>o.attachShader(c,r)),Wxe(o,c);const h=Object.assign(c,{vao:this.createVertexArray()});return this.debug&&MR(o,h),h}buildVao(r){this.setProgram(r),this.bindVertexArray(r.vao);const o=this.gl;mn(o,()=>o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),uwe(o,r,this.vertexBuffer)}deleteProgram(r){this.throwIfDisposed(),r===this.program&&(this.program=null),r!=null&&(mn(this.gl,()=>this.gl.deleteProgram(r)),this.deleteVertexArray(r.vao))}setProgram(r){this.throwIfDisposed(),this.program=r,this.program!=null&&this.debug&&MR(this.gl,this.program),mn(this.gl,()=>this.gl.useProgram(r))}getUniformLocation(r,o,c=!0){return this.throwIfDisposed(),c?jxe(this.gl,r,o):Yxe(this.gl,r,o)}getAttributeLocation(r,o){return this.throwIfDisposed(),mn(this.gl,()=>this.gl.getAttribLocation(r,o))}getUniformLocationNoThrow(r,o){return this.throwIfDisposed(),this.gl.getUniformLocation(r,o)}setInputMatrixTexture(r,o,c){this.throwIfDisposed(),this.throwIfNoProgram(),qxe(this.gl,r,o,c)}setOutputMatrixTexture(r,o,c){this.setOutputMatrixTextureDriver(r,c,o)}setOutputPackedMatrixTexture(r,o,c){this.throwIfDisposed();const[h,f]=$0(o,c);this.setOutputMatrixTextureDriver(r,h,f)}setOutputMatrixWriteRegion(r,o,c,h){this.setOutputMatrixWriteRegionDriver(c,r,h,o)}setOutputPackedMatrixWriteRegion(r,o,c,h){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&MR(this.gl,this.program),CC(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const r=this.gl;if(this.debug){const o=this.getVertexArray();console.assert(o===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}mn(r,()=>r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),mn(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=wC(this.gl,Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const c=this.gl,h=this.getQueryTimerExtensionWebGL2(),f=c.createQuery();return c.beginQuery(h.TIME_ELAPSED_EXT,f),f}const r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o}endQuery(){if(Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const o=this.gl,c=this.getQueryTimerExtensionWebGL2();o.endQuery(c.TIME_ELAPSED_EXT);return}const r=this.getQueryTimerExtensionWebGL1();r.endQueryEXT(r.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(r){return await V(()=>this.disposed||this.isQueryAvailable(r,Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(r,Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(r,o){if(o===0)return null;if(o===2){const c=this.gl;return c.getQueryParameter(r,c.QUERY_RESULT)/1e6}else{const c=this.getQueryTimerExtensionWebGL1();return c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(r,o){if(o===0)return!0;if(o===2){const c=this.gl,h=this.getQueryTimerExtensionWebGL2(),f=c.getQueryParameter(r,c.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(h.GPU_DISJOINT_EXT)),f&&!this.disjoint}else{const c=this.getQueryTimerExtensionWebGL1(),h=c.getQueryObjectEXT(r,c.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(c.GPU_DISJOINT_EXT)),h&&!this.disjoint}}pollFence(r){return new Promise(o=>{this.addItemToPoll(()=>r.isFencePassed(),()=>o())})}pollItems(){const r=Awe(this.itemsToPoll.map(o=>o.isDoneFn));for(let o=0;o<=r;++o){const{resolveFn:c}=this.itemsToPoll[o];c()}this.itemsToPoll=this.itemsToPoll.slice(r+1)}addItemToPoll(r,o){if(this.itemsToPoll.push({isDoneFn:r,resolveFn:o}),this.itemsToPoll.length>1)return;let c;"setTimeoutCustom"in Te().platform&&(c=Te().platform.setTimeoutCustom.bind(Te().platform)),V(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,c)}bindTextureToFrameBuffer(r){this.throwIfDisposed(),kR(this.gl,r,this.framebuffer),this.debug&&CC(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(kR(this.gl,this.outputTexture,this.framebuffer),this.debug&&CC(this.gl)):I9(this.gl,this.framebuffer)}downloadMatrixDriver(r,o){this.bindTextureToFrameBuffer(r);const c=o();return this.unbindTextureToFrameBuffer(),c}setOutputMatrixTextureDriver(r,o,c){this.throwIfDisposed();const h=this.gl;kR(h,r,this.framebuffer),this.debug&&CC(h),this.outputTexture=r,mn(h,()=>h.viewport(0,0,o,c)),mn(h,()=>h.scissor(0,0,o,c))}setOutputMatrixWriteRegionDriver(r,o,c,h){this.throwIfDisposed(),mn(this.gl,()=>this.gl.scissor(r,o,c,h))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Awe(a){let r=0;for(;r<a.length&&a[r]();++r);return r-1}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const{addImpl:vwe,bincountImpl:U9,bincountReduceImpl:bwe,bitwiseAndImpl:xwe,castImpl:wwe,ceilImpl:Cwe,concatImpl:Ewe,equalImpl:_we,expImpl:Iwe,expm1Impl:Swe,floorImpl:Twe,gatherNdImpl:Mwe,gatherV2Impl:kwe,greaterImpl:Rwe,greaterEqualImpl:Lwe,lessImpl:Bwe,lessEqualImpl:Pwe,linSpaceImpl:Nwe,logImpl:Dwe,maxImpl:Fwe,maximumImpl:Owe,minimumImpl:Vwe,multiplyImpl:Uwe,negImpl:zwe,notEqualImpl:Gwe,prodImpl:Wwe,raggedGatherImpl:Hwe,raggedRangeImpl:Xwe,raggedTensorToTensorImpl:$we,rangeImpl:Qwe,rsqrtImpl:Kwe,scatterImpl:Zwe,sigmoidImpl:jwe,simpleAbsImpl:z9,sliceImpl:Ywe,sparseFillEmptyRowsImpl:qwe,sparseReshapeImpl:Jwe,sparseSegmentReductionImpl:G9,sqrtImpl:eCe,staticRegexReplaceImpl:tCe,stridedSliceImpl:nCe,stringNGramsImpl:iCe,stringSplitImpl:rCe,stringToHashBucketFastImpl:sCe,subImpl:oCe,tileImpl:aCe,topKImpl:lCe,transposeImpl:OR,uniqueImpl:cCe}=p0e;/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function W9(a,r){return["x","y","z","w","u","v"].slice(0,r).map(o=>`${a}.${o}`)}function Fo(a,r){return r===1?[a]:W9(a,r)}function uCe(a,r){if(a===1)return"rc";let o="";for(let c=0;c<a;c++)o+=r[c],c<a-1&&(o+=",");return o}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class hCe{constructor(r){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r,this.rank=r.length,this.enableShapeUniforms=po(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const o=Fo("rc",this.rank),c=er(this.rank),h=this.getOutOfBoundsCondition(o),f=this.getSetup(o),m=this.getOutput(o);this.userCode=`
        void main() {
          ${c} rc = getOutputCoords();

          if(${h}) {
            setOutput(vec4(0));
          } else {
            ${f}

            setOutput(vec4(${m}));
          }
        }
      `}}getSourceCoordsArr(r){const o=[];for(let c=0;c<=1;c++)for(let h=0;h<=1;h++){let f=`${c===0?"r":"rp1"}, ${h===0?"c":"cp1"}`;for(let m=2;m<this.rank;m++)f=`${r[r.length-1-m]},`+f;o.push(f)}return o}getOutOfBoundsCondition(r){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let o="";for(let c=this.rank-2;c<this.rank;c++)o+=`${r[c]} >= ${this.enableShapeUniforms?`outShape[${c}]`:this.outputShape[c]}`,c<this.rank-1&&(o+="||");return o}getSetup(r){if(this.rank===1)return"";const o=r.slice(-2),c=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],h=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${o[0]};
      int c = ${o[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${c};
      bool rEdge = rp1 >= ${h};
    `}getOutput(r){const o=this.getSourceCoordsArr(r);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${o[0]}),
            cEdge ? 0. : getA(${o[1]}),
            rEdge ? 0. : getA(${o[2]}),
            rEdge || cEdge ? 0. : getA(${o[3]})`}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class H9{constructor(r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length);let c="";for(let h=0;h<4;h++){let f="thisRC = rc;";h%2===1&&(f+="thisRC.z += 1;"),h>1&&(f+="thisRC.y += 1;"),c+=`
        ${f}
        ${h>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${h}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${h>0?"}":""}
      `}this.userCode=`
      ${dCe(o,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?NR():PR(r)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":r[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":r[2]};

        ${c}

        setOutput(result);
      }
    `}}function dCe(a,r){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${r?u1e(["r","c","d"],"inputShape"):Pm(["r","c","d"],a)}
      return ivec3(r, c, d);
    }
  `}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fCe{constructor(r){this.gpgpu=r,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(r,o,c){const h=$9(o,c),f=Q9(r,h,c);f in this.freeTextures||(this.freeTextures[f]=[]),f in this.usedTextures||(this.usedTextures[f]=[]);const m=X9(r,h,this.gpgpu.gl,this.gpgpu.textureConfig,c);if(this.freeTextures[f].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=m,this.log();const A=this.freeTextures[f].pop();return this.usedTextures[f].push(A),A}let y;return h===qs.PACKED_2X2_FLOAT32?y=this.gpgpu.createPackedMatrixTexture(r[0],r[1]):h===qs.PACKED_2X2_FLOAT16?y=this.gpgpu.createFloat16PackedMatrixTexture(r[0],r[1]):h===qs.UNPACKED_FLOAT32?y=this.gpgpu.createFloat32MatrixTexture(r[0],r[1]):h===qs.UNPACKED_FLOAT16?y=this.gpgpu.createFloat16MatrixTexture(r[0],r[1]):h===qs.PACKED_4X1_UNSIGNED_BYTE&&(y=this.gpgpu.createUnsignedBytesMatrixTexture(r[0],r[1])),this.usedTextures[f].push(y),this.numUsedTextures++,this._numBytesAllocated+=m,this.log(),y}releaseTexture(r,o,c,h){if(this.freeTextures==null)return;const f=$9(c,h),m=Q9(o,f,h);m in this.freeTextures||(this.freeTextures[m]=[]);const y=X9(o,f,this.gpgpu.gl,this.gpgpu.textureConfig,h),A=Te().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");A!==-1&&this._numBytesAllocated>A?(this.gpgpu.deleteMatrixTexture(r.texture),this._numBytesAllocated-=y):(this.freeTextures[m].push(r),this.numFreeTextures++,this._numBytesFree+=y),this.numUsedTextures--;const w=this.usedTextures[m],C=w&&w.indexOf(r);if(C==null||C<0)throw new Error("Cannot release a texture that was never provided by this texture manager");w[C]=w[w.length-1],w.pop(),this.log()}log(){if(!this.logEnabled)return;const r=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${r})`);const o=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*o)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const r in this.freeTextures)this.freeTextures[r].forEach(o=>{this.gpgpu.deleteMatrixTexture(o.texture)});for(const r in this.usedTextures)this.usedTextures[r].forEach(o=>{this.gpgpu.deleteMatrixTexture(o.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function pCe(a,r){const o=a;if(r===o.R32F)return 4;if(r===o.R16F)return 2;if(r===o.RGBA32F||r===a.RGBA)return 16;if(r===o.RGBA16F)return 8;if(r===o.RGBA8)return 4;throw new Error(`Unknown internal format ${r}`)}function X9(a,r,o,c,h){const f=mCe(r,c);let m;if(h){const[A,w]=$0(a[0],a[1]);m=A*w}else{const[A,w]=tb(a[0],a[1]);m=A*w}const y=pCe(o,f);return m*y}function mCe(a,r){switch(a){case qs.PACKED_2X2_FLOAT32:return O9(r);case qs.PACKED_2X2_FLOAT16:return V9(r);case qs.UNPACKED_FLOAT32:return N9(r);case qs.UNPACKED_FLOAT16:return D9(r);case qs.PACKED_4X1_UNSIGNED_BYTE:return F9(r);default:throw new Error(`Unknown physical texture type ${a}`)}}function gCe(a){return Te().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?a?qs.PACKED_2X2_FLOAT32:qs.UNPACKED_FLOAT32:a?qs.PACKED_2X2_FLOAT16:qs.UNPACKED_FLOAT16}function $9(a,r){if(a===bl.UPLOAD)return qs.PACKED_2X2_FLOAT32;if(a===bl.RENDER||a==null)return gCe(r);if(a===bl.DOWNLOAD||a===bl.PIXELS)return qs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${a}`)}function Q9(a,r,o){return`${a[0]}_${a[1]}_${r}_${o}`}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Wu{constructor(r,o){this.variableNames=["A"],this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${o}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Jl="if (isnan(x)) return x;",yCe="return x;",K9="return abs(x);",ACe="return (x >= 0.0) ? x : (exp(x) - 1.0);",vCe=Jl+`
  return (x < 0.0) ? 0.0 : x;
`,bCe=Jl+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Sf="return x;",xCe="return 1.0 / (1.0 + exp(-1.0 * x));";/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wCe="return x;",CCe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ECe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_Ce=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ICe="return 1.0 / (1.0 + exp(-1.0 * x));";class Tf{constructor(r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${o}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class SCe{constructor(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length);const o=r.length,c=Fo("rc",o),h=er(o),f=uCe(o,c),m=c.slice(-2),y=o<=1?"rc":`vec2(${m.join(",")})`;this.userCode=`
      void main() {
        ${h} rc = getOutputCoords();
        vec4 packedInput = getA(${f});

        setOutput(getChannel(packedInput, ${y}));
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TCe=Cz,MCe=1e-7,kCe=1e-4,VR={};function RCe(a){return a in VR||(VR[a]={}),VR[a]}const LCe=Te().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),BCe=600;function PCe(){return Te().global.screen==null?1024:Te().global.screen.height*Te().global.screen.width*window.devicePixelRatio*BCe/1024/1024}class TC extends s{nextDataId(){return TC.nextDataId++}constructor(r){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!Te().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let o;if(r!=null){if(r instanceof FR)o=r;else{const c=Vc(Te().getNumber("WEBGL_VERSION"),r);o=new FR(c)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const c=Vc(Te().getNumber("WEBGL_VERSION"));o=new FR(c),this.binaryCache=RCe(Te().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=o,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new fCe(this.gpgpu),this.numMBBeforeWarning=PCe(),this.texData=new i(this,cr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(r,o,c,h,f,m){const y=this.makeTensorInfo(o,c),A=this.texData.get(y.dataId);A.isPacked=!1,A.texture={texture:r,texShape:[h,f]},A.texShape=[h,f];const w=EC(o),C=new P9(w,!1,m),_=this.runWebGLProgram(C,[y],c,[[h,f]]);return _.shape=o,A.texture=null,this.disposeIntermediateTensorInfo(y),_.dataId}write(r,o,c){if((Te().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Te().getBool("DEBUG"))&&this.checkNumericalProblems(r),c==="complex64"&&r!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const h={id:this.nextDataId()};return this.texData.set(h,{shape:o,dtype:c,values:r,usage:bl.UPLOAD,refCount:1}),h}refCount(r){return this.texData.has(r)?this.texData.get(r).refCount:0}incRef(r){const o=this.texData.get(r);o.refCount++}decRef(r){if(this.texData.has(r)){const o=this.texData.get(r);o.refCount--}}move(r,o,c,h,f){if(Te().getBool("DEBUG")&&this.checkNumericalProblems(o),h==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(r,{shape:c,dtype:h,values:o,usage:bl.UPLOAD,refCount:f})}disposeIntermediateTensorInfo(r){this.disposeData(r.dataId)}readSync(r){const o=this.texData.get(r),{values:c,dtype:h,complexTensorInfos:f,slice:m,shape:y,isPacked:A}=o;if(m!=null){let T;A?T=new Tf(y,Sf):T=new Wu(y,Sf);const B=this.runWebGLProgram(T,[{dataId:r,shape:y,dtype:h}],h),O=this.readSync(B.dataId);return this.disposeIntermediateTensorInfo(B),O}if(c!=null)return this.convertAndCacheOnCPU(r);if(h==="string")return c;const w=this.activeTimers!=null;let C;w&&(C=ho());let _;if(h==="complex64"){const T=this.readSync(f.real.dataId),B=this.readSync(f.imag.dataId);_=$h(T,B)}else _=this.getValuesFromTexture(r);return w&&(this.downloadWaitMs+=ho()-C),this.convertAndCacheOnCPU(r,_)}async read(r){if(this.pendingRead.has(r)){const O=this.pendingRead.get(r);return new Promise(U=>O.push(U))}const o=this.texData.get(r),{values:c,shape:h,slice:f,dtype:m,complexTensorInfos:y,isPacked:A}=o;if(f!=null){let O;A?O=new Tf(h,Sf):O=new Wu(h,Sf);const U=this.runWebGLProgram(O,[{dataId:r,shape:h,dtype:m}],m),W=this.read(U.dataId);return this.disposeIntermediateTensorInfo(U),W}if(c!=null)return this.convertAndCacheOnCPU(r);if(Te().getBool("DEBUG")&&!Te().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Te().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let w=null,C;if(m!=="complex64"&&Te().get("WEBGL_BUFFER_SUPPORTED")){C=this.decode(r);const O=this.texData.get(C.dataId);w=this.gpgpu.createBufferFromTexture(O.texture.texture,...xC(h))}this.pendingRead.set(r,[]),m!=="complex64"&&await this.gpgpu.createAndWaitForFence();let _;if(m==="complex64"){const O=await Promise.all([this.read(y.real.dataId),this.read(y.imag.dataId)]),U=O[0],W=O[1];_=$h(U,W)}else if(w==null)_=this.getValuesFromTexture(r);else{const O=M(h);_=this.gpgpu.downloadFloat32MatrixFromBuffer(w,O)}if(C!=null&&this.disposeIntermediateTensorInfo(C),w!=null){const O=this.gpgpu.gl;mn(O,()=>O.deleteBuffer(w))}const T=this.convertAndCacheOnCPU(r,_),B=this.pendingRead.get(r);return this.pendingRead.delete(r),B.forEach(O=>O(T)),this.pendingDisposal.has(r)&&(this.pendingDisposal.delete(r),this.disposeData(r)&&cr().removeDataId(r,this),this.pendingDeletes--),T}readToGPU(r,o={}){const c=this.texData.get(r),{values:h,shape:f,slice:m,dtype:y,isPacked:A,texture:w}=c;if(y==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(m!=null){let B;A?B=new Tf(f,Sf):B=new Wu(f,Sf);const O=this.runWebGLProgram(B,[{dataId:r,shape:f,dtype:y}],y),U=this.readToGPU(O,o);return this.disposeIntermediateTensorInfo(O),U}if(w==null)throw h!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const C=this.decode(r,o.customTexShape),_=cr().makeTensorFromTensorInfo(C),T=this.texData.get(C.dataId);return Object.assign({tensorRef:_},T.texture)}bufferSync(r){const o=this.readSync(r.dataId);if(r.dtype==="string")try{const c=o.map(h=>Tc(h));return yi(r.shape,r.dtype,c)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return yi(r.shape,r.dtype,o)}checkNumericalProblems(r){if(r!=null)for(let o=0;o<r.length;o++){const c=r[o];if(!Fxe(c))throw Te().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${c} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${c} cannot be represented on this device.`)}}getValuesFromTexture(r){const{shape:o,dtype:c,isPacked:h}=this.texData.get(r),f=M(o);if(Te().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const T=this.decode(r),B=this.texData.get(T.dataId),O=this.gpgpu.downloadMatrixFromPackedTexture(B.texture.texture,...xC(o)).subarray(0,f);return this.disposeIntermediateTensorInfo(T),O}const m=Te().getBool("WEBGL_PACK")&&h===!0,y=m?EC(o):o,A=m?new J1e(y):new q1e(y),w=this.runWebGLProgram(A,[{shape:y,dtype:c,dataId:r}],"float32"),C=this.texData.get(w.dataId),_=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(C.texture.texture,C.texShape[0],C.texShape[1]).subarray(0,f);return this.disposeIntermediateTensorInfo(w),_}timerAvailable(){return Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(r){const o=this.activeTimers,c=[];let h=!1;this.programTimersStack==null?(this.programTimersStack=c,h=!0):this.activeTimers.push(c),this.activeTimers=c,r();const f=Mu(this.activeTimers.map(A=>A.query)).filter(A=>A!=null),m=Mu(this.activeTimers.map(A=>A.name)).filter(A=>A!=null);this.activeTimers=o,h&&(this.programTimersStack=null);const y={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const A=await Promise.all(f);y.kernelMs=x(A),y.getExtraProfileInfo=()=>A.map((w,C)=>({name:m[C],ms:w})).map(w=>`${w.name}: ${w.ms}`).join(", ")}else y.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,y})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ho(),endMs:null}}endTimer(r){return Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),r):(r.endMs=ho(),r)}async getQueryTime(r){if(Te().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(r);const o=r;return o.endMs-o.startMs}disposeData(r,o=!1){if(this.pendingDisposal.has(r))return!1;if(!this.texData.has(r))return!0;if(o?this.texData.get(r).refCount=0:this.texData.get(r).refCount--,!o&&this.texData.get(r).refCount>0)return!1;if(this.pendingRead.has(r))return this.pendingDisposal.add(r),this.pendingDeletes++,!1;this.releaseGPUData(r);const{complexTensorInfos:c}=this.texData.get(r);return c!=null&&(this.disposeData(c.real.dataId,o),this.disposeData(c.imag.dataId,o)),this.texData.delete(r),!0}releaseGPUData(r){const{texture:o,dtype:c,texShape:h,usage:f,isPacked:m,slice:y}=this.texData.get(r),A=y&&y.origDataId||r,w=this.dataRefCount.get(A);w>1?this.dataRefCount.set(A,w-1):(this.dataRefCount.delete(A),o!=null&&(this.numBytesInGPU-=this.computeBytes(h,c),this.textureManager.releaseTexture(o,h,f,m)));const C=this.texData.get(r);C.texture=null,C.texShape=null,C.isPacked=!1,C.slice=null}getTexture(r){return this.uploadToGPU(r),this.texData.get(r).texture.texture}getDataInfo(r){return this.texData.get(r)}shouldExecuteOnCPU(r,o=LCe){return Te().getBool("WEBGL_CPU_FORWARD")&&r.every(c=>this.texData.get(c.dataId).texture==null&&M(c.shape)<o)}getGPGPUContext(){return this.gpgpu}where(r){Ks("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const o=r.dataSync();return TCe(r.shape,o)}packedUnaryOp(r,o,c){const h=new Tf(r.shape,o),f=this.compileAndRun(h,[r],c);return cr().makeTensorFromTensorInfo(f)}abs(r){if(this.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){const h=z9(this.texData.get(r.dataId).values);return this.makeOutput(r.shape,r.dtype,h)}if(Te().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(r,K9,r.dtype);const o=new Wu(r.shape,K9),c=this.compileAndRun(o,[r]);return cr().makeTensorFromTensorInfo(c)}makeTensorInfo(r,o,c){let h;if(o==="string"&&c!=null&&c.length>0&&we(c[0])){const f=c.map(m=>Tu(m));h=this.write(f,r,o)}else h=this.write(c,r,o);return this.texData.get(h).usage=null,{dataId:h,shape:r,dtype:o}}makeOutput(r,o,c){return cr().makeTensorFromTensorInfo(this.makeTensorInfo(r,o,c),this)}unpackTensor(r){const o=new SCe(r.shape);return this.runWebGLProgram(o,[r],r.dtype)}packTensor(r){const o=new hCe(r.shape);return this.runWebGLProgram(o,[r],r.dtype,null,!0)}packedReshape(r,o){const c=[Q0(r.shape),...K0(r.shape)],h={dtype:r.dtype,shape:c,dataId:r.dataId},f=[Q0(o),...K0(o)],m=new H9(f,c),y=!0,A=[c],w=this.runWebGLProgram(m,[h],r.dtype,A,y);return{dataId:w.dataId,shape:o,dtype:w.dtype}}decode(r,o){const c=this.texData.get(r),{isPacked:h,shape:f,dtype:m}=c;if(o!=null){const T=M(f),B=o[0]*o[1]*4;b(T<=B,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const y=EC(f);let A;h?A=new Y1e(y):A=new j1e(y);const w=!0,C=[o??xC(y)],_=this.runWebGLProgram(A,[{shape:y,dtype:m,dataId:r}],m,C,w,o);return{dtype:m,shape:f,dataId:_.dataId}}runWebGLProgram(r,o,c,h,f=!1,m){const y=this.makeTensorInfo(r.outputShape,c),A=this.texData.get(y.dataId);if(r.packedOutput&&(A.isPacked=!0),r.outPackingScheme===eb.DENSE){const z=m??xC(r.outputShape);A.texShape=z.map(X=>X*2)}if(r.outTexUsage!=null&&(A.usage=r.outTexUsage),M(y.shape)===0)return A.values=K(y.dtype,0),y;const w=[],C=o.map(z=>{if(z.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let X=this.texData.get(z.dataId);if(X.texture==null){if(!r.packedInputs&&M(z.shape)<=Te().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:z.shape,texData:null,isUniform:!0,uniformValues:X.values};r.packedInputs&&(X.isPacked=!0,X.shape=z.shape)}if(this.uploadToGPU(z.dataId),!!X.isPacked!=!!r.packedInputs)z=X.isPacked?this.unpackTensor(z):this.packTensor(z),w.push(z),X=this.texData.get(z.dataId);else if(X.isPacked&&!IC(X.shape,z.shape)){const re=z,se=z.shape;z.shape=X.shape,z=this.packedReshape(z,se),w.push(z),X=this.texData.get(z.dataId),re.shape=se}return{shape:z.shape,texData:X,isUniform:!1}});this.uploadToGPU(y.dataId);const _={shape:y.shape,texData:A,isUniform:!1},T=Z1e(r,C,_),B=this.getAndSaveBinary(T,()=>Q1e(this.gpgpu,r,C,_)),O=this.activeTimers!=null;let U;O&&(U=this.startTimer()),Te().get("ENGINE_COMPILE_ONLY")||K1e(this.gpgpu,B,C,_,h),w.forEach(z=>this.disposeIntermediateTensorInfo(z)),O&&(U=this.endTimer(U),this.activeTimers.push({name:r.constructor.name,query:this.getQueryTime(U)}));const W=Te().getNumber("WEBGL_FLUSH_THRESHOLD");if(W>0){const z=ho();z-this.lastGlFlushTime>W&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=z)}if(!Te().getBool("WEBGL_LAZILY_UNPACK")&&A.isPacked&&f===!1){const z=this.unpackTensor(y);return this.disposeIntermediateTensorInfo(y),z}return y}compileAndRun(r,o,c,h,f=!1){return c=c||o[0].dtype,this.runWebGLProgram(r,o,c,h,f)}getAndSaveBinary(r,o){return r in this.binaryCache||(this.binaryCache[r]=o()),this.binaryCache[r]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(Te().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Qe(()=>{if(!Te().get("WEBGL_RENDER_FLOAT32_ENABLED")){const r=Te().getBool("DEBUG");Te().set("DEBUG",!1);const o=this.abs(Qi(1e-8)).dataSync()[0];if(Te().set("DEBUG",r),o>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?MCe:kCe}uploadToGPU(r){const o=this.texData.get(r),{shape:c,dtype:h,values:f,texture:m,usage:y,isPacked:A}=o;if(m!=null)return;const w=this.activeTimers!=null;let C;w&&(C=ho());let _=o.texShape;if(_==null&&(_=t1e(c,A),o.texShape=_),f!=null){const T=EC(c);let B,O=_[1],U=_[0];const W=f instanceof Uint8Array||f instanceof Uint8ClampedArray;(A||!W)&&([O,U]=$0(_[0],_[1])),A?B=new twe(T,W):B=new P9(T,W);const z=W?[U,O]:_,X=this.makeTensorInfo(z,h),re=this.texData.get(X.dataId);W?re.usage=bl.PIXELS:re.usage=bl.UPLOAD,re.texShape=z,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(X.dataId),O,U,f);const se=[[U,O]],le=this.runWebGLProgram(B,[X],h,se,!0),ge=this.texData.get(le.dataId);o.texShape=ge.texShape,o.isPacked=ge.isPacked,o.usage=ge.usage,Te().get("ENGINE_COMPILE_ONLY")?this.disposeData(le.dataId):(o.texture=ge.texture,o.values=null,this.texData.delete(le.dataId)),this.disposeIntermediateTensorInfo(X),w&&(this.uploadWaitMs+=ho()-C)}else{const T=this.acquireTexture(_,y,h,A);o.texture=T}}convertAndCacheOnCPU(r,o){const c=this.texData.get(r),{dtype:h}=c;return o!=null&&(c.values=NCe(o,h)),c.values}acquireTexture(r,o,c,h){if(this.numBytesInGPU+=this.computeBytes(r,c),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const f=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${f} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(r,o,h)}computeBytes(r,o){return r[0]*r[1]*de(o)}checkCompileCompletion(){for(const[,r]of Object.entries(this.binaryCache))this.checkCompletion_(r)}async checkCompileCompletionAsync(){const r=[];if(this.gpgpu.parallelCompilationExtension){for(const[,o]of Object.entries(this.binaryCache))r.push(this.checkCompletionAsync_(o));return Promise.all(r)}else{for(const[,o]of Object.entries(this.binaryCache)){const c=new Promise(h=>{try{this.checkCompletion_(o),h(!0)}catch(f){throw f}});r.push(c)}return Promise.all(r)}}async checkCompletionAsync_(r){return this.gpgpu.gl.getProgramParameter(r.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(r):(await Uw(),this.checkCompletionAsync_(r))}checkCompletion_(r){if(this.gpgpu.gl.getProgramParameter(r.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(r.webGLProgram)),this.gpgpu.gl.getShaderParameter(r.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(E9(r.source,this.gpgpu.gl.getShaderInfoLog(r.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const r of Object.values(this.binaryCache)){this.gpgpu.buildVao(r.webGLProgram);const{variablesLocations:o,customUniformLocations:c,infLoc:h,nanLoc:f,outShapeLocation:m,outShapeStridesLocation:y,outTexShapeLocation:A}=L9(this.gpgpu,r.program,r.webGLProgram);r.variablesLocations=o,r.customUniformLocations=c,r.infLoc=h,r.nanLoc=f,r.outShapeLocation=m,r.outShapeStridesLocation=y,r.outTexShapeLocation=A}}createTensorFromGPUData(r,o,c){r.channels=r.channels||"RGBA";const{texture:h,height:f,width:m,channels:y}=r,A=cr().backend;if(!A.gpgpu.gl.isTexture(h))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const w=A.writeTexture(h,o,c,f,m,y);return cr().makeTensorFromDataId(w,o,c,A)}}TC.nextDataId=0;function NCe(a,r){if(r==="float32"||r==="complex64")return a;if(r==="int32"||r==="bool"){const o=r==="int32"?new Int32Array(a.length):new Uint8Array(a.length);for(let c=0;c<o.length;++c)o[c]=Math.round(a[c]);return o}else throw new Error(`Unknown dtype ${r}`)}/**
* @license
* Copyright 2020 Google Inc. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/_U()&&MU("webgl",()=>new TC,2);/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const UR=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Dm{constructor(r,o,c){this.variableNames=["A","B"],this.outputShape=si(o,c),this.enableShapeUniforms=po(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${r}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Fm=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class J0{constructor(r,o,c,h=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=si(o,c);const f=this.outputShape.length;this.enableShapeUniforms=po(f);let m="";if(h)if(f===0||M(this.outputShape)===1)m=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(m=`
          ${er(f)} coords = getOutputCoords();
        `,f===1)this.enableShapeUniforms?m+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:m+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const y=Fo("coords",f);this.enableShapeUniforms?m+=`
            bool nextRowOutOfBounds =
              (${y[f-2]} + 1) >= outShape[${f} - 2];
            bool nextColOutOfBounds =
              (${y[f-1]} + 1) >= outShape[${f} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:m+=`
            bool nextRowOutOfBounds =
              (${y[f-2]} + 1) >= ${this.outputShape[f-2]};
            bool nextColOutOfBounds =
              (${y[f-1]} + 1) >= ${this.outputShape[f-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${r}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${m}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Ha(a){const{inputs:r,backend:o}=a,{x:c}=r;return o.incRef(c.dataId),{dataId:c.dataId,shape:c.shape,dtype:c.dtype}}const DCe={kernelName:hs,backendName:"webgl",kernelFunc:Ha};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Mf(a){const{inputs:r,backend:o}=a,{real:c,imag:h}=r,f=o.makeTensorInfo(c.shape,"complex64"),m=o.texData.get(f.dataId),y=Ha({inputs:{x:c},backend:o}),A=Ha({inputs:{x:h},backend:o});return m.complexTensorInfos={real:y,imag:A},f}const FCe={kernelName:ar,backendName:"webgl",kernelFunc:Mf};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Z9="return (a < 0.) ? b * a : a;",j9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function OCe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{alpha:f}=c,m=o.makeTensorInfo([],"float32",Br(f,"float32")),y=Te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new J0(j9,h.shape,m.shape):new Dm(Z9,h.shape,m.shape),A=o.runWebGLProgram(y,[h,m],"float32");return o.disposeIntermediateTensorInfo(m),A}const VCe={kernelName:Qs,backendName:"webgl",kernelFunc:OCe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y9="return (a < 0.) ? b * a : a;",q9=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function UCe(a){const{inputs:r,backend:o}=a,{x:c,alpha:h}=r,f=Te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new J0(q9,c.shape,h.shape):new Dm(Y9,c.shape,h.shape);return o.runWebGLProgram(f,[c,h],"float32")}const zCe={kernelName:Na,backendName:"webgl",kernelFunc:UCe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ey="if (isnan(x)) return x;";function Bi({opSnippet:a,packedOpSnippet:r,cpuKernelImpl:o,dtype:c}){return({inputs:h,backend:f})=>{const{x:m}=h,y=f,A=c||m.dtype;if(y.shouldExecuteOnCPU([m])&&o!=null){const _=y.texData.get(m.dataId),T=o(_.values,A);return y.makeTensorInfo(m.shape,A,T)}const w=Te().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&r!=null;let C;return w?C=new Tf(m.shape,r):C=new Wu(m.shape,a),y.runWebGLProgram(C,[m],A)}}function Js({opSnippet:a,packedOpSnippet:r,checkOutOfBounds:o=!1,supportsComplex:c=!1,cpuKernelImpl:h,dtype:f}){return({inputs:m,backend:y})=>{const{a:A,b:w}=m,C=y;if(c&&A.dtype==="complex64"){const O=C.texData.get(A.dataId),U=C.texData.get(w.dataId),[W,z]=[[O.complexTensorInfos.real,U.complexTensorInfos.real],[O.complexTensorInfos.imag,U.complexTensorInfos.imag]].map(re=>{const[se,le]=re,ge={dataId:se.dataId,dtype:se.dtype,shape:A.shape},ye={dataId:le.dataId,dtype:le.dtype,shape:w.shape},be=new Dm(a,A.shape,w.shape);return C.runWebGLProgram(be,[ge,ye],Ua(se.dtype,le.dtype))}),X=Mf({inputs:{real:W,imag:z},backend:C});return C.disposeIntermediateTensorInfo(W),C.disposeIntermediateTensorInfo(z),X}const _=f||Ua(A.dtype,w.dtype);if((A.dtype==="string"||w.dtype==="string"||C.shouldExecuteOnCPU([A,w]))&&h!=null){const O=C.texData.get(A.dataId).values,U=C.texData.get(w.dataId).values,W=A.dtype==="string"?Qh(O):O,z=A.dtype==="string"?Qh(U):U,[X,re]=h(A.shape,w.shape,W,z,_),se=C.makeTensorInfo(re,_),le=C.texData.get(se.dataId);return le.values=X,se}const T=Te().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&r!=null;let B;return T?B=new J0(r,A.shape,w.shape,o):B=new Dm(a,A.shape,w.shape),C.runWebGLProgram(B,[A,w],_)}}function rb(a,r=!1){if(a==="linear")return r?wCe:yCe;if(a==="relu")return r?ECe:vCe;if(a==="elu")return r?CCe:ACe;if(a==="relu6")return r?_Ce:bCe;if(a==="prelu")return r?q9:Y9;if(a==="leakyrelu")return r?j9:Z9;if(a==="sigmoid")return r?ICe:xCe;throw new Error(`Activation ${a} has not been implemented for the WebGL backend.`)}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class J9{constructor(r,o,c,h=!1,f=!1,m=!1,y=null,A=!1,w=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=c,this.enableShapeUniforms=po(this.outputShape.length);const C=h?r[1]:r[2],_=Math.ceil(C/2),T=h?"i * 2, rc.y":"rc.y, i * 2",B=f?"rc.z, i * 2":"i * 2, rc.z",O=h?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],U=f?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let W="",z="";y&&(A?W=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${y}
        }`:w?W=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${y}
        }`:W=`vec4 activation(vec4 x) {
          ${y}
        }`,z="result = activation(result);");const X=m?"result += getBiasAtOutCoords();":"";m&&this.variableNames.push("bias"),A&&this.variableNames.push("preluActivationWeights"),w&&this.variableNames.push("leakyreluAlpha");let re="rc.x",se="rc.x";r[0]<o[0]?re=`imod(rc.x, ${r[0]})`:o[0]<r[0]&&(se=`imod(rc.x, ${o[0]})`),this.userCode=`
      ${W}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${_}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${re};
        int batchB = ${se};
        for (int i = 0; i < ${_}; i++) {
          vec4 a = getMatrixA(batchA, ${T});
          vec4 b = getMatrixB(batchB, ${B});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${O[0]} * ${U[0]});
          result += (${O[1]} * ${U[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${X}

        ${z}

        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eH={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class tH{constructor(r,o,c){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=si(o,c),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${r}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const nH="return a * b;";function zR(a){const{inputs:r,backend:o}=a,{a:c,b:h}=r,f=Ua(c.dtype,h.dtype);if(c.dtype==="complex64"){const y=o.texData.get(c.dataId),A=o.texData.get(h.dataId),w=new tH(eH.REAL,c.shape,h.shape),C=new tH(eH.IMAG,c.shape,h.shape),_=[{dataId:y.complexTensorInfos.real.dataId,dtype:y.complexTensorInfos.real.dtype,shape:c.shape},{dataId:y.complexTensorInfos.imag.dataId,dtype:y.complexTensorInfos.imag.dtype,shape:c.shape},{dataId:A.complexTensorInfos.real.dataId,dtype:A.complexTensorInfos.real.dtype,shape:h.shape},{dataId:A.complexTensorInfos.imag.dataId,dtype:A.complexTensorInfos.imag.dtype,shape:h.shape}],T=o.runWebGLProgram(w,_,"float32"),B=o.runWebGLProgram(C,_,"float32"),O=Mf({inputs:{real:T,imag:B},backend:o});return o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B),O}if(o.shouldExecuteOnCPU([c,h])){const y=o.texData.get(c.dataId),A=o.texData.get(h.dataId),[w,C]=Uwe(c.shape,h.shape,y.values,A.values,f),_=o.makeTensorInfo(C,f),T=o.texData.get(_.dataId);return T.values=w,_}let m;return Te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?m=new J0(nH,c.shape,h.shape):m=new Dm(nH,c.shape,h.shape),o.runWebGLProgram(m,[c,h],f)}const GCe={kernelName:Mo,backendName:"webgl",kernelFunc:zR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function WCe(a,r,o){const c=[Q0(a.shape),...K0(a.shape)],h={dtype:a.dtype,shape:c,dataId:a.dataId},f=[Q0(r),...K0(r)],m=new H9(f,c),y=!0,A=[c],w=o.runWebGLProgram(m,[h],a.dtype,A,y);return{dataId:w.dataId,shape:r,dtype:w.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function nn(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{shape:f}=c,m=o,y=M(h.shape),A=G(f,y),w=M(A);b(y===w,()=>`The new shape (${A}) has ${w} elements and the old shape (${h.shape}) has ${y} elements. The new shape and old shape must have the same number of elements.`);const C=m.texData.get(h.dataId);return C.isPacked&&!IC(h.shape,A)&&!(C.texture!==null&&IC(C.shape,A))?WCe(h,A,m):(m.incRef(h.dataId),{dataId:h.dataId,shape:A,dtype:h.dtype})}const HCe={kernelName:sa,backendName:"webgl",kernelFunc:nn};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class iH{constructor(r,o){this.variableNames=["x"];const{windowSize:c,batchSize:h,inSize:f,outSize:m}=r;this.outputShape=[h,m];const y=Math.floor(c/4)*4,A=c%4;let w="sumValue += dot(values, ones);";if(o!=null){const _=1/o;w=`sumValue += dot(values * ${P(_)?_.toPrecision(2):_}, ones);`}let C="";f%c>0&&(C=`
        if (inIdx < 0 || inIdx >= ${f}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${C}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${c};

        float sumValue = 0.0;

        for (int i = 0; i < ${y}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${w}
        }

        int inIdx = inOffset + ${y};
        if (${A===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${w}
        } else if (${A===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${w}
        } else if (${A===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${w}
        }
        setOutput(sumValue);
      }
    `}}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class XCe{constructor(r,o){this.variableNames=["x"];const{windowSize:c,batchSize:h,inSize:f,outSize:m}=r;this.outputShape=[h,m];let y="0.0",A="";o==="prod"?y="1.0":o==="min"?(y="1.0 / 1e-20",A="min"):o==="max"&&(y="-1.0 / 1e-20",A="max");let w=`${o}(${o}(${o}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;o==="sum"?w="sumValue":o==="prod"?w="prodValue":o==="all"?w="allValue":o==="any"&&(w="anyValue");const C=Math.floor(c/4)*4,_=c%4;let T=`
      if (${o==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${o==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${A}(values, minMaxValue);
        if (${o==="min"} || ${o==="max"}) {
          minMaxValue = ${A}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,B="vec4";o==="all"?(y="1.0",T=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,B="bvec4"):o==="any"&&(y="0.0",T=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,B="bvec4");let O="";f%c>0&&(O=`
        if (inIdx < 0 || inIdx >= ${f}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${O}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${c};

        vec4 minMaxValue = vec4(${y});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${C}; i += 4) {
          int inIdx = inOffset + i;
          ${B} values = ${B}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${T}
        }

        int inIdx = inOffset + ${C};
        if (${_===1}) {
          ${B} values = ${B}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${T}
        } else if (${_===2}) {
          ${B} values = ${B}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${T}
        } else if (${_===3}) {
          ${B} values = ${B}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${T}
        }
        setOutput(${w});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $Ce(a){const r=[];for(;r.length===0||r[r.length-1].outSize!==1;){const o=r.length?r[r.length-1].outSize:a[1],c=zw(o);r.push({inSize:o,windowSize:c,outSize:Math.ceil(o/c)})}return r}function Om(a,r,o,c){const h=$Ce(a.shape);let f=a;for(let m=0;m<h.length;m++){const{inSize:y,windowSize:A,outSize:w}=h[m];let C,_;o==="mean"?C=m===0?new iH({windowSize:A,inSize:y,batchSize:a.shape[0],outSize:w},y):new iH({windowSize:A,inSize:y,batchSize:a.shape[0],outSize:w}):C=new XCe({windowSize:A,inSize:y,batchSize:a.shape[0],outSize:w},o),_=f,f=c.runWebGLProgram(C,[f],r),_.dataId!==a.dataId&&c.disposeIntermediateTensorInfo(_)}return f}/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class QCe{constructor(r,o){this.variableNames=["A"];const c=new Array(r.length);for(let m=0;m<c.length;m++)c[m]=r[o[m]];this.outputShape=c,this.rank=c.length;const h=er(this.rank),f=KCe(o);this.userCode=`
    void main() {
      ${h} resRC = getOutputCoords();
      setOutput(getA(${f}));
    }
    `}}function KCe(a){const r=a.length;if(r>6)throw Error(`Transpose for rank ${r} is not yet supported`);const o=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(r);for(let h=0;h<a.length;h++)c[a[h]]=o[h];return c.join()}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ZCe{constructor(r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const c=new Array(r.length);for(let C=0;C<c.length;C++)c[C]=r[o[C]];if(this.outputShape=c,this.rank=c.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const h=er(this.rank),f=W9("rc",this.rank),m=new Array(this.rank);for(let C=0;C<o.length;C++)m[o[C]]=f[C];const y=`vec2(${m.slice(-2).join()})`,A=`++${f[this.rank-1]} < ${c[this.rank-1]}`,w=`getChannel(getA(${m.join()}), ${y})`;this.userCode=`
    void main() {
      ${h} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${w};
      if(${A}) {
        result[1] = ${w};
      }
      --${f[this.rank-1]};
      if(++${f[this.rank-2]} < ${c[this.rank-2]}) {
        result[2] = ${w};
        if(${A}) {
          result[3] = ${w};
        }
      }
      setOutput(result);
    }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MC(a,r,o){const c=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZCe(a.shape,r):new QCe(a.shape,r);return o.runWebGLProgram(c,[a],a.dtype)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jCe(a,r,o,c){const h=r,f=a.shape.length,m=q(h,a.shape);let y=m;const A=Tr(y,f),w=A!=null;let C=a;w&&(C=MC(a,A,c),y=Hr(y.length,f)),Ys("sum",y,f);const[_,T]=Ps(C.shape,y);let B=_;o&&(B=ns(_,m));const O=M(T),U=M(a.shape)/O,W=nn({inputs:{x:C},attrs:{shape:[U,O]},backend:c}),z=mM(a.dtype),X=Om(W,z,"sum",c),re=nn({inputs:{x:X},attrs:{shape:B},backend:c});return c.disposeIntermediateTensorInfo(W),c.disposeIntermediateTensorInfo(X),w&&c.disposeIntermediateTensorInfo(C),re}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kC(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c;return jCe(h,f,m,o)}const YCe={kernelName:so,backendName:"webgl",kernelFunc:kC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Oo(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{perm:f}=c,m=o,y=h.shape.length,A=new Array(y);for(let C=0;C<A.length;C++)A[C]=h.shape[f[C]];let w;if(m.shouldExecuteOnCPU([h])){const C=m.texData.get(h.dataId).values,_=OR(C,h.shape,h.dtype,f,A);w=m.makeTensorInfo(A,h.dtype);const T=m.texData.get(w.dataId);T.values=_}else w=MC(h,f,m);return w}const qCe={kernelName:ef,backendName:"webgl",kernelFunc:Oo};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const rH=1e3;function RC({a,b:r,transposeA:o,transposeB:c,backend:h,bias:f=null,preluActivationWeights:m=null,leakyreluAlpha:y=0,activation:A=null}){const w=a.shape.length,C=r.shape.length,_=o?a.shape[w-2]:a.shape[w-1],T=c?r.shape[C-1]:r.shape[C-2],B=o?a.shape[w-1]:a.shape[w-2],O=c?r.shape[C-2]:r.shape[C-1],U=a.shape.slice(0,-2),W=r.shape.slice(0,-2),z=M(U),X=M(W),re=si(a.shape.slice(0,-2),r.shape.slice(0,-2)).concat([B,O]);b(_===T,()=>`Error in matMul: inner shapes (${_}) and (${T}) of Tensors with shapes ${a.shape} and ${r.shape} and transposeA=${o} and transposeB=${c} must match.`);const se=o?[z,_,B]:[z,B,_],le=c?[X,O,T]:[X,T,O],ge=nn({inputs:{x:a},backend:h,attrs:{shape:se}}),ye=nn({inputs:{x:r},backend:h,attrs:{shape:le}}),be=[ge,ye],Se=Math.max(z,X),Be=o?ge.shape[1]:ge.shape[2],Ye=f!=null,et=m!=null,tt=A==="leakyrelu",ot=A!=null?rb(A,!0):null,st=Ye||et||tt||ot!=null;let ct;if((B===1||O===1)&&Be>rH&&st===!1){let mt=ge,bt=ye;o&&(mt=Oo({inputs:{x:ge},backend:h,attrs:{perm:[0,2,1]}}),be.push(mt)),c&&(bt=Oo({inputs:{x:ye},backend:h,attrs:{perm:[0,2,1]}}),be.push(bt));const Vt=O!==1,Bt=O===1;let $t=mt;Vt&&($t=nn({inputs:{x:mt},backend:h,attrs:{shape:[Se,Be,1]}}),be.push($t));const Qt=O===1?2:1;let rn=bt;Bt&&(rn=nn({inputs:{x:bt},backend:h,attrs:{shape:[Se,1,Be]}}),be.push(rn));const an=zR({inputs:{a:$t,b:rn},backend:h});ct=kC({inputs:{x:an},backend:h,attrs:{axis:Qt,keepDims:!0}}),be.push(an)}else{const mt=Ua(a.dtype,r.dtype),bt=new J9(se,le,[Se,B,O],o,c,Ye,ot,et,tt),Vt=[ge,ye];if(f!=null&&Vt.push(f),et&&Vt.push(m),tt){const Bt=h.makeTensorInfo([],"float32",Br(y,"float32"));Vt.push(Bt),be.push(Bt)}ct=h.runWebGLProgram(bt,Vt,mt)}const gt=nn({inputs:{x:ct},backend:h,attrs:{shape:re}});be.push(ct);for(const mt of be)h.disposeIntermediateTensorInfo(mt);return gt}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function JCe(a){const{inputs:r,backend:o,attrs:c}=a,{a:h,b:f,bias:m,preluActivationWeights:y}=r,{transposeA:A,transposeB:w,activation:C,leakyreluAlpha:_}=c;return RC({a:h,b:f,transposeA:A,transposeB:w,backend:o,bias:m,preluActivationWeights:y,leakyreluAlpha:_,activation:C})}const eEe={kernelName:nf,backendName:"webgl",kernelFunc:JCe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sH="return abs(x);";function tEe(a){const{inputs:r,backend:o}=a,{x:c}=r;if(o.shouldExecuteOnCPU([c])&&c.dtype!=="complex64"){const f=o.texData.get(c.dataId),m=z9(f.values);return o.makeTensorInfo(c.shape,c.dtype,m)}let h;return Te().getBool("WEBGL_PACK_UNARY_OPERATIONS")?h=new Tf(c.shape,sH):h=new Wu(c.shape,sH),o.runWebGLProgram(h,[c],c.dtype)}const nEe={kernelName:We,backendName:"webgl",kernelFunc:tEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iEe=Jl+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,rEe=Bi({opSnippet:iEe}),sEe={kernelName:at,backendName:"webgl",kernelFunc:rEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oEe=Jl+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,aEe=Bi({opSnippet:oEe}),lEe={kernelName:ln,backendName:"webgl",kernelFunc:aEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oH="return a + b;",cEe=Js({opSnippet:oH,packedOpSnippet:oH,supportsComplex:!0,cpuKernelImpl:vwe}),uEe={kernelName:ve,backendName:"webgl",kernelFunc:cEe};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class hEe{constructor(r,o){this.outputShape=[],this.outputShape=r,this.variableNames=o.map((f,m)=>`T${m}`);const c=[];this.variableNames.forEach(f=>{c.push(`float v${f} = get${f}AtOutCoords();`)});const h=this.variableNames.map(f=>`v${f}`).join(" + ");this.userCode=`
      void main() {
        ${c.join(`
        `)}

        float result = ${h};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class dEe{constructor(r,o){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=o.map((f,m)=>`T${m}`);const c=[];this.variableNames.forEach(f=>{c.push(`vec4 v${f} = get${f}AtOutCoords();`)});const h=this.variableNames.map(f=>`v${f}`).join(" + ");this.userCode=`
      void main() {
        ${c.join(`
        `)}

        vec4 result = ${h};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LC(a){const{inputs:r,backend:o}=a,c=r;if(c.length===1)return Ha({inputs:{x:c[0]},backend:o});if(c.length>Te().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const y=Math.floor(c.length/2),A=LC({inputs:c.slice(0,y),backend:o}),w=LC({inputs:c.slice(y),backend:o});return LC({inputs:[A,w],backend:o})}const h=c.map(y=>y.dtype).reduce((y,A)=>Ua(y,A)),f=c.map(y=>y.shape),m=Te().getBool("WEBGL_PACK")?new dEe(c[0].shape,f):new hEe(c[0].shape,f);return o.runWebGLProgram(m,c,h)}const fEe={kernelName:ue,backendName:"webgl",kernelFunc:LC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c,y=h.shape.length,A=q(f,h.shape);let w=A;const C=Tr(w,y);let _=h;C!=null&&(_=Oo({inputs:{x:h},backend:o,attrs:{perm:C}}),w=Hr(w.length,y)),Ys("all",w,y);const[T,B]=Ps(_.shape,w),O=M(B),U=nn({inputs:{x:_},backend:o,attrs:{shape:[-1,O]}}),W=Om(U,U.dtype,"all",o);let z;if(m){const X=ns(T,A);z=nn({inputs:{x:W},backend:o,attrs:{shape:X}})}else z=nn({inputs:{x:W},backend:o,attrs:{shape:T}});return o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(W),C!=null&&o.disposeIntermediateTensorInfo(_),z}const mEe={kernelName:Oe,backendName:"webgl",kernelFunc:pEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c,y=h.shape.length,A=q(f,h.shape);let w=A;const C=Tr(w,y);let _=h;C!=null&&(_=Oo({inputs:{x:h},backend:o,attrs:{perm:C}}),w=Hr(w.length,y)),Ys("any",w,y);const[T,B]=Ps(_.shape,w),O=M(B),U=nn({inputs:{x:_},backend:o,attrs:{shape:[-1,O]}}),W=Om(U,U.dtype,"any",o);let z;if(m){const X=ns(T,A);z=nn({inputs:{x:W},backend:o,attrs:{shape:X}})}else z=nn({inputs:{x:W},backend:o,attrs:{shape:T}});return o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(W),C!=null&&o.disposeIntermediateTensorInfo(_),z}const yEe={kernelName:ut,backendName:"webgl",kernelFunc:gEe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AEe{constructor(r,o,c){this.variableNames=["A"];const{windowSize:h,batchSize:f,outSize:m}=r;c||this.variableNames.push("bestIndicesA"),this.outputShape=[f,m];const y=o==="max"?">":"<",A=c?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${h};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${h}; i++) {
          int inIdx = ${A};
          float candidate = getA(batch, inIdx);
          if (candidate ${y} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vEe{constructor(r,o,c,h){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,b(r.length>2,()=>`Packed arg${c.charAt(0).toUpperCase()+c.slice(1)} supports only inputs with rank above 2.`);const f=r[r.length-1],m=Math.ceil(f/o);this.outputShape=r.slice(0,-1),m>1&&this.outputShape.push(m),h||this.variableNames.push("bestIndicesA");const y=this.outputShape,A=y.length,w=er(A),C=Fo("coords",A);let _,T;if(m===1){T=A+1;const be=er(T);_=`
        ${be} sourceLocR = ${be}(${C.join()}, 0);
        ++${C[A-1]};
        ${be} sourceLocG = ${be}(${C.join()}, 0);
        ++${C[A-2]};
        ${be} sourceLocA = ${be}(${C.join()}, 0);
        --${C[A-1]};
        ${be} sourceLocB = ${be}(${C.join()}, 0);
        --${C[A-2]};`}else T=A,_=`
        ${w} sourceLocR = coords;
        ++${C[A-1]};
        ${w} sourceLocG = coords;
        ++${C[A-2]};
        ${w} sourceLocA = coords;
        --${C[A-1]};
        ${w} sourceLocB = coords;
        --${C[A-2]};`;const B=["x","y","z","w","u","v"].slice(0,T),O="."+B[T-1],U=B.map(be=>"int "+be),W=Fo("sourceLocR",T-1).concat("inIdx.r"),z=Fo("sourceLocG",T-1).concat("inIdx.g"),X=Fo("sourceLocB",T-1).concat("inIdx.b"),re=Fo("sourceLocA",T-1).concat("inIdx.a"),se=c==="max"?"greaterThan":"lessThan",le=h?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${W.join()}),
                             getBestIndicesAChannel(${z.join()}),
                             getBestIndicesAChannel(${X.join()}),
                             getBestIndicesAChannel(${re.join()})));`,ge=`vec4(
            getAChannel(${W.join()}),
            hasNextCol ? getAChannel(${z.join()}) : 0.,
            hasNextRow ? getAChannel(${X.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${re.join()}) : 0.)`,ye=h?"":`
      float getBestIndicesAChannel(${U.join()}) {
        return getChannel(getBestIndicesA(${B.join()}),
                                          vec2(${B.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${U.join()}) {
        return getChannel(getA(${B.join()}),
                               vec2(${B.slice(-2).join()}));
      }
      ${ye}
      void main() {
        ${w} coords = getOutputCoords();
        bool hasNextCol = ${C[A-1]} < ${y[A-1]-1};
        bool hasNextRow = ${C[A-2]} < ${y[A-2]-1};
        ${_}
        ivec4 srcIdx = ivec4(sourceLocR${O}, sourceLocG${O},
          sourceLocB${O}, sourceLocA${O}) * ${o};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${ge};

        for (int i = 0; i < ${o}; i++) {
          inIdx = srcIdx;
          ${le}
          vec4 candidate = ${ge};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${se}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aH(a,r,o,c=null){let h=r.shape[0],f=r.shape[1];c!=null&&(h=c.shape[0],f=c.shape[1]);const m=zw(f),y={windowSize:m,inSize:f,batchSize:h,outSize:Math.ceil(f/m)},A=new AEe(y,o,c==null),w=[r];c!=null&&w.push(c);const C=a.runWebGLProgram(A,w,"int32");if(C.shape[1]===1)return C;const _=aH(a,r,o,C);return a.disposeIntermediateTensorInfo(C),_}function lH(a,r,o,c=null){const h=c!=null?c.shape:r.shape,f=h[h.length-1],m=zw(f),y=new vEe(h,m,o,c==null),A=c==null?[r]:[r,c],w=a.runWebGLProgram(y,A,"int32");if(w.shape.length===r.shape.length){const C=lH(a,r,o,w);return a.disposeIntermediateTensorInfo(w),C}return w}function cH(a,r,o,c){const h=[o];if(Ys("arg"+c.charAt(0).toUpperCase()+c.slice(1),h,r.shape.length),!Te().getBool("WEBGL_PACK_REDUCE")||r.shape.length<=2){const f=[],m=a.texData.get(r.dataId),y=m!==null&&m.isPacked;let A=r;y&&(A=a.unpackTensor(r),f.push(A));const[w,C]=Ps(A.shape,h),_=M(C),T=nn({inputs:{x:A},backend:a,attrs:{shape:[-1,_]}});f.push(T);const B=aH(a,T,c);f.push(B);const O=nn({inputs:{x:B},backend:a,attrs:{shape:w}});return f.forEach(U=>a.disposeIntermediateTensorInfo(U)),O}return lH(a,r,c)}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f}=c;let m=q(f,h.shape);const y=Tr(m,h.shape.length);let A=h;const w=[];y!=null&&(A=Oo({inputs:{x:h},backend:o,attrs:{perm:y}}),w.push(A),m=Hr(m.length,A.shape.length)),Ys("argMax",[m[0]],A.shape.length);const C=cH(o,A,m[0],"max");return w.forEach(_=>o.disposeIntermediateTensorInfo(_)),C}const xEe={kernelName:vt,backendName:"webgl",kernelFunc:bEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f}=c;let m=q(f,h.shape);const y=Tr(m,h.shape.length);let A=h;const w=[];y!=null&&(A=Oo({inputs:{x:h},backend:o,attrs:{perm:y}}),w.push(A),m=Hr(m.length,A.shape.length)),Ys("argMin",[m[0]],A.shape.length);const C=cH(o,A,m[0],"min");return w.forEach(_=>o.disposeIntermediateTensorInfo(_)),C}const CEe={kernelName:pt,backendName:"webgl",kernelFunc:wEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const EEe=Jl+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_Ee=Bi({opSnippet:EEe}),IEe={kernelName:cn,backendName:"webgl",kernelFunc:_Ee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SEe=Jl+"return log(x + sqrt(x * x + 1.0));",TEe=Bi({opSnippet:SEe}),MEe={kernelName:Tt,backendName:"webgl",kernelFunc:TEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const kEe=Jl+`
  return atan(x);
`,REe=Bi({opSnippet:kEe}),LEe={kernelName:Zt,backendName:"webgl",kernelFunc:REe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const BEe=UR+`
  return atan(a, b);
`,PEe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fm+`
  return result;
`,NEe=Js({opSnippet:BEe,packedOpSnippet:PEe}),DEe={kernelName:Ft,backendName:"webgl",kernelFunc:NEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FEe=Jl+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,OEe=Bi({opSnippet:FEe}),VEe={kernelName:kn,backendName:"webgl",kernelFunc:OEe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sb{constructor(r,o,c,h=!1,f=!1){if(this.variableNames=["x"],o==="avg"&&c)throw new Error("Cannot compute positions for average pool.");const m=r.filterWidth,y=r.strideHeight,A=r.strideWidth,w=r.dilationHeight,C=r.dilationWidth,_=r.effectiveFilterHeight,T=r.effectiveFilterWidth,B=r.padInfo.top,O=r.padInfo.left;this.outputShape=r.outShape;const U=o==="avg",W=`((batch  * ${r.inHeight} + xR) * ${r.inWidth} + xC) * ${r.inChannels} + d`,z=`(xR * ${r.inWidth} + xC) * ${r.inChannels} + d`;let X="0.0";if(U||(X="-1.0 / 1e-20"),c){const be=">=";this.userCode=`
        const ivec2 strides = ivec2(${y}, ${A});
        const ivec2 pads = ivec2(${B}, ${O});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${_};
              wR += ${w}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${r.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${T};
                wC += ${C}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${r.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${be} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${h?f?W:z:`wR * ${T} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const re="max";let se=`${o}(${o}(${o}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;o==="avg"&&(se="avgValue / max(count, 1.0)");const le=Math.floor(m/4)*4,ge=m%4,ye=`
      if (${U}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${re}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${y}, ${A});
      const ivec2 pads = ivec2(${B}, ${O});
      const float initializationValue = ${X};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${r.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${X});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${_};
            wR += ${w}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${r.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${le}; wC += 4) {
            int xC = xCCorner + wC * ${C};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${C}, d),
              getValue(batch, xR, xC + 2 * ${C}, d),
              getValue(batch, xR, xC + 3 * ${C}, d)
            );

            ${ye}
          }

          int xC = xCCorner + ${le};
          if (${ge===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${ye}
          } else if (${ge===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${C}, d),
              initializationValue,
              initializationValue
            );

            ${ye}
          } else if (${ge===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${C}, d),
              getValue(batch, xR, xC + 2 * ${C}, d),
              initializationValue
            );

            ${ye}
          }
        }
        setOutput(${se});
      }
    `}}class GR{constructor(r,o,c,h=!1,f=!1){if(this.variableNames=["x"],o==="avg"&&c)throw new Error("Cannot compute positions for average pool.");const m=r.filterWidth,y=r.strideDepth,A=r.strideHeight,w=r.strideWidth,C=r.dilationDepth,_=r.dilationHeight,T=r.dilationWidth,B=r.effectiveFilterDepth,O=r.effectiveFilterHeight,U=r.effectiveFilterWidth,W=r.padInfo.front,z=r.padInfo.top,X=r.padInfo.left;this.outputShape=r.outShape;const re=o==="avg";let se="0.0";if(re||(se="-1.0 / 1e-20"),c){const Be=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${y}, ${A}, ${w});
        const ivec3 pads = ivec3(${W}, ${z}, ${X});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${B};
              wD += ${C}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${r.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${O};
                wR += ${_}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${r.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${U};
                  wC += ${T}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${r.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${Be} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${h?f?`(((batch * ${r.inDepth} + xD) * ${r.inHeight} + xR) * ${r.inWidth} + xC) * ${r.inChannels} + ch`:`((xD * ${r.inHeight} + xR) * ${r.inWidth} + xC) * ${r.inChannels} + ch`:`wD * ${O} * ${U} +
                      wR * ${U} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const le="max";let ge=`${o}(${o}(${o}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;o==="avg"&&(ge="avgValue / max(count, 1.0)");const ye=Math.floor(m/4)*4,be=m%4,Se=`
      if (${re}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${le}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${y}, ${A}, ${w});
      const ivec3 pads = ivec3(${W}, ${z}, ${X});
      const float initializationValue = ${se};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${r.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${se});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${B};
            wD += ${C}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${r.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${O};
            wR += ${_}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${r.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${ye}; wC += 4) {
              int xC = xCCorner + wC * ${T};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${T}, ch),
                getValue(batch, xD, xR, xC + 2 * ${T}, ch),
                getValue(batch, xD, xR, xC + 3 * ${T}, ch)
              );

              ${Se}
            }

            int xC = xCCorner + ${ye};
            if (${be===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${Se}
            } else if (${be===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${T}, ch),
                initializationValue,
                initializationValue
              );

              ${Se}
            } else if (${be===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${T}, ch),
                getValue(batch, xD, xR, xC + 2 * ${T}, ch),
                initializationValue
              );

              ${Se}
            }
          }
        }
        setOutput(${ge});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r;nb(h,"avgPool");const{filterSize:f,strides:m,pad:y,dimRoundingMode:A}=c,w=1;b(fo(m,w),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${m} and dilations '${w}'`);const C=Hl(h.shape,f,m,w,y,A);if(C.filterWidth===1&&C.filterHeight===1&&R(C.inShape,C.outShape))return Ha({inputs:{x:h},backend:o});const _=new sb(C,"avg",!1);return o.runWebGLProgram(_,[h],"float32")}const zEe={kernelName:vn,backendName:"webgl",kernelFunc:UEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GEe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{filterSize:f,strides:m,pad:y,dimRoundingMode:A,dataFormat:w}=c,C=[1,1,1],_=Gh(h.shape,f,m,C,y,A,w),T=new GR(_,"avg",!1);return o.runWebGLProgram(T,[h],"float32")}const WEe={kernelName:Pe,backendName:"webgl",kernelFunc:GEe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HEe{constructor(r){this.variableNames=["dy"],this.outputShape=r.inShape;const o=r.filterHeight,c=r.filterWidth,h=r.strideHeight,f=r.strideWidth,m=r.dilationHeight,y=r.dilationWidth,A=r.effectiveFilterHeight,w=r.effectiveFilterWidth,C=A-1-r.padInfo.top,_=w-1-r.padInfo.left,T=1/(o*c);this.userCode=`
      const ivec2 pads = ivec2(${C}, ${_});
      const float avgMultiplier = float(${T});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${A};
            wR += ${m}) {
          float dyR = float(dyRCorner + wR) / ${h}.0;

          if (dyR < 0.0 || dyR >= ${r.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${w};
            wC+= ${y}) {
            float dyC = float(dyCCorner + wC) / ${f}.0;

            if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class XEe{constructor(r){this.variableNames=["dy"],this.outputShape=r.inShape;const o=r.filterDepth,c=r.filterHeight,h=r.filterWidth,f=r.strideDepth,m=r.strideHeight,y=r.strideWidth,A=r.dilationDepth,w=r.dilationHeight,C=r.dilationWidth,_=r.effectiveFilterDepth,T=r.effectiveFilterHeight,B=r.effectiveFilterWidth,O=_-1-r.padInfo.front,U=T-1-r.padInfo.top,W=B-1-r.padInfo.left,z=1/(o*c*h);this.userCode=`
      const ivec3 pads = ivec3(${O}, ${U}, ${W});
      const float avgMultiplier = float(${z});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${_};
            wD += ${A}) {
          float dyD = float(dyDCorner + wD) / ${f}.0;

          if (dyD < 0.0 || dyD >= ${r.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${T};
              wR += ${w}) {
            float dyR = float(dyRCorner + wR) / ${m}.0;

            if (dyR < 0.0 || dyR >= ${r.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${B};
                wC += ${C}) {
              float dyC = float(dyCCorner + wC) / ${y}.0;

              if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function $Ee(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,m=f,{filterSize:y,strides:A,pad:w,dimRoundingMode:C}=c,_=[1,1,1],T=Gh(m.shape,y,A,_,w,C),B=new XEe(T);return o.runWebGLProgram(B,[h],m.dtype)}const QEe={kernelName:ft,backendName:"webgl",kernelFunc:$Ee};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function KEe(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,m=f;nb([h,f],"avgPoolGrad");const{filterSize:y,strides:A,pad:w}=c,C=Hl(m.shape,y,A,1,w),_=new HEe(C);return o.runWebGLProgram(_,[h],m.dtype)}const ZEe={kernelName:jn,backendName:"webgl",kernelFunc:KEe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function jEe(a){const{inputs:r,backend:o,attrs:c}=a,{a:h,b:f}=r,{transposeA:m,transposeB:y}=c;return RC({a:h,b:f,transposeA:m,transposeB:y,backend:o})}const YEe={kernelName:Pt,backendName:"webgl",kernelFunc:jEe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class qEe{constructor(r,o,c,h,f,m){this.outputShape=[],this.variableNames=["x","mean","variance"],si(r,o),si(r,c);let y="0.0";h!=null&&(si(r,h),this.variableNames.push("offset"),y="getOffsetAtOutCoords()");let A="1.0";f!=null&&(si(r,f),this.variableNames.push("scale"),A="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${y};
        float scale = ${A};
        float inv = scale * inversesqrt(variance + float(${m}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class JEe{constructor(r,o,c,h,f,m){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],si(r,o),si(r,c);let y="vec4(0.0)";h!=null&&(si(r,h),this.variableNames.push("offset"),y="getOffsetAtOutCoords()");let A="vec4(1.0)";f!=null&&(si(r,f),this.variableNames.push("scale"),A="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = ${y};
        vec4 scale = ${A};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${m}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const e_e={kernelName:jt,backendName:"webgl",kernelFunc:({inputs:a,backend:r,attrs:o})=>{const{x:c,mean:h,variance:f,offset:m,scale:y}=a;b(h.shape.length===f.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b(m==null||h.shape.length===m.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b(y==null||h.shape.length===y.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:A}=o;A==null&&(A=.001);const w=[c,h,f];let C=null;m!=null&&(C=m.shape,w.push(m));let _=null;y!=null&&(_=y.shape,w.push(y));const T=Te().getBool("WEBGL_PACK_NORMALIZATION")?new JEe(c.shape,h.shape,f.shape,C,_,A):new qEe(c.shape,h.shape,f.shape,C,_,A);return r.runWebGLProgram(T,w,w[0].dtype)}};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class t_e{constructor(r){this.variableNames=["source"],this.outputShape=r,this.rank=r.length;const o=er(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const c=n_e(this.rank);let h;const f=r.map((m,y)=>`sourceLoc.${WR[y]} = start[${y}] + coords.${WR[y]};`);h=`
        ${o} sourceLoc;
        ${o} coords = getOutputCoords();
        ${f.join(`
`)}
      `,this.userCode=`
      void main() {
        ${h}
        setOutput(getSource(${c}));
      }
    `}}const WR=["x","y","z","w","u","v"];function n_e(a){if(a===1)return"sourceLoc";if(a<=6)return WR.slice(0,a).map(r=>"sourceLoc."+r).join(",");throw Error(`Slicing for rank ${a} is not yet supported`)}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class i_e{constructor(r){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.rank=r.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const o=er(this.rank),c=Fo("coords",this.rank),h=Fo("sourceLoc",this.rank),f=this.rank===1?"sourceLoc":`vec2(${h.slice(-2).join()})`,m=`getChannel(getSource(${h.join()}), ${f})`,y=`
      result.x = ${m};
      if (++${c[this.rank-1]} < ${r[this.rank-1]}) {
        ++${h[this.rank-1]};
        result.y = ${m};
        --${h[this.rank-1]};
      }
    `,A=this.rank===1?"":`
      --${c[this.rank-1]};
      if (++${c[this.rank-2]} < ${r[this.rank-2]}) {
        ++${h[this.rank-2]};
        result.z = ${m};
        if (++${c[this.rank-1]} < ${r[this.rank-1]}) {
          ++${h[this.rank-1]};
          result.w = ${m};
        }
      }
    `,w=this.rank<=4?`sourceLoc = coords +
            ${o}(${r.map((C,_)=>`start[${_}]`).join()});`:r.map((C,_)=>`${h[_]} = ${c[_]} + start[${_}];`).join(`
`);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        ${o} sourceLoc;
        ${w}
        vec4 result = vec4(0.);
        ${y}
        ${A}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function r_e(a,r,o,c){const h=c.texData.get(a.dataId),f=c.makeTensorInfo(o,a.dtype),m=c.texData.get(f.dataId);Object.assign(m,h),m.refCount=1,m.shape=o,m.dtype=a.dtype;let y=uk(r,Ie(a.shape));h.slice&&(y+=h.slice.flatOffset),m.slice={flatOffset:y,origDataId:h.slice&&h.slice.origDataId||a.dataId};const A=c.dataRefCount.get(m.slice.origDataId)||1;return c.dataRefCount.set(m.slice.origDataId,A+1),f}function ty(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{begin:f,size:m}=c,[y,A]=Vw(h,f,m);if(ak(h,y,A),M(A)===0)return o.makeTensorInfo(A,h.dtype,[]);if(o.shouldExecuteOnCPU([h])||h.dtype==="string"){const _=o.texData.get(h.dataId),T=Ywe(_.values,y,A,h.shape,h.dtype);return o.makeTensorInfo(A,h.dtype,T)}const{isPacked:w}=o.texData.get(h.dataId),C=ck(h.shape,y,A);if(w||!C){const _=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new i_e(A):new t_e(A),T=[y];return o.runWebGLProgram(_,[h],h.dtype,T)}return o.uploadToGPU(h.dataId),r_e(h,y,A,o)}const s_e={kernelName:Ke,backendName:"webgl",kernelFunc:ty};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const o_e={kernelName:Dt,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockShape:f,crops:m}=c;b(h.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const y=f.reduce((X,re)=>X*re),A=Lv(h.shape,f,y),w=Bv(A.length,f.length),C=Pv(h.shape,f,y),_=mk(m,f.length),T=gk(C,m,f.length),B=[],O=nn({inputs:{x:h},backend:o,attrs:{shape:A}}),U=Oo({inputs:{x:O},backend:o,attrs:{perm:w}}),W=nn({inputs:{x:U},backend:o,attrs:{shape:C}}),z=ty({inputs:{x:W},backend:o,attrs:{begin:_,size:T}});return B.push(O),B.push(U),B.push(W),B.forEach(X=>o.disposeIntermediateTensorInfo(X)),z}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,weights:f}=r,{size:m}=c,y=o.readSync(h.dataId),A=o.readSync(f.dataId),w=U9(y,A,f.dtype,f.shape,m);return o.makeTensorInfo([m],f.dtype,w)}const l_e={kernelName:qt,backendName:"webgl",kernelFunc:a_e};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const c_e=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,u_e=`
  return float(int(a.r) & int(b.r));
`;function h_e(a){const{inputs:r,backend:o}=a,{a:c,b:h}=r,f=Te().getBool("WEBGL_PACK_BINARY_OPERATIONS"),m=Te().getNumber("WEBGL_VERSION");if(o.shouldExecuteOnCPU([c,h])||m===1){const A=o.texData.get(c.dataId).values,w=o.texData.get(h.dataId).values,[C,_]=xwe(c.shape,h.shape,A,w,c.dtype),T=o.makeTensorInfo(_,c.dtype),B=o.texData.get(T.dataId);return B.values=C,T}let y;return f?y=new J0(c_e,c.shape,h.shape,!1):y=new Dm(u_e,c.shape,h.shape),o.runWebGLProgram(y,[c,h],c.dtype)}const d_e={kernelName:sn,backendName:"webgl",kernelFunc:h_e};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function f_e(a){const{inputs:r,backend:o}=a,{s0:c,s1:h}=r,f=o.readSync(c.dataId),m=o.readSync(h.dataId),y=si(Array.from(f),Array.from(m));return o.makeTensorInfo([y.length],"int32",Int32Array.from(y))}const p_e={kernelName:tn,backendName:"webgl",kernelFunc:f_e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const uH=Js({opSnippet:"return float(a != b);",cpuKernelImpl:Gwe,dtype:"bool"}),m_e={kernelName:gu,backendName:"webgl",kernelFunc:uH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ob(a){const{inputs:r,backend:o}=a,{input:c}=r,h=o.texData.get(c.dataId);return Ha({inputs:{x:h.complexTensorInfos.real},backend:o})}const g_e={kernelName:vu,backendName:"webgl",kernelFunc:ob};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y_e="return float(int(x));";function A_e(a,r){const o=new Wu(a.shape,y_e),c=r.runWebGLProgram(o,[a],"int32");return{dataId:c.dataId,shape:c.shape,dtype:c.dtype}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function HR(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{dtype:f}=c;if(f==="complex64"){if(h.dtype==="complex64")return Ha({inputs:{x:h},backend:o});const m=Ns(h.shape),y=HR({inputs:{x:h},backend:o,attrs:{dtype:"float32"}}),A=Mf({inputs:{real:y,imag:m},backend:o});return m.dispose(),o.disposeIntermediateTensorInfo(y),A}if(h.dtype==="complex64"){const m=ob({inputs:{input:h},backend:o}),y=HR({inputs:{x:m},backend:o,attrs:{dtype:f}});return o.disposeIntermediateTensorInfo(m),y}if(!ee(h.dtype,f)){const m=Ha({inputs:{x:h},backend:o});return{dataId:m.dataId,shape:m.shape,dtype:f}}if(o.shouldExecuteOnCPU([h])){const m=o.texData.get(h.dataId).values,[y,A,w]=wwe(m,h.shape,h.dtype,f);return o.makeTensorInfo(y,A,w)}if(f==="int32")return A_e(h,o);if(f==="bool"){const m=o.makeTensorInfo([],"bool",K("bool",1)),y=uH({inputs:{a:h,b:m},backend:o});return o.disposeIntermediateTensorInfo(m),y}throw new Error(`Error in Cast: failed to cast ${h.dtype} to ${f}`)}const v_e={kernelName:Jt,backendName:"webgl",kernelFunc:HR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hH="return ceil(x);",b_e=Bi({opSnippet:hH,packedOpSnippet:hH,cpuKernelImpl:Cwe}),x_e={kernelName:fn,backendName:"webgl",kernelFunc:b_e};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class w_e{constructor(r){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=r,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class C_e{constructor(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=r,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function E_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{clipValueMin:f,clipValueMax:m}=c;let y;Te().getBool("WEBGL_PACK_CLIP")?y=new C_e(h.shape):y=new w_e(h.shape);const A=[[f],[m]];return o.runWebGLProgram(y,[h],h.dtype,A)}const __e={kernelName:ei,backendName:"webgl",kernelFunc:E_e};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class I_e{constructor(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dH(a,r){return{dataId:r.dataId,dtype:r.dtype,shape:a.shape}}function S_e(a){const{inputs:r,backend:o}=a,{x:c}=r,h=o.texData.get(c.dataId),f=new I_e(c.shape),m=[dH(c,h.complexTensorInfos.real),dH(c,h.complexTensorInfos.imag)];return o.runWebGLProgram(f,m,m[0].dtype)}const T_e={kernelName:ta,backendName:"webgl",kernelFunc:S_e};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class M_e{constructor(r){this.outputShape=[],this.outputShape=Nu(r,1),this.variableNames=r.map((m,y)=>`T${y}`);const o=new Array(r.length-1);o[0]=r[0][1];for(let m=1;m<o.length;m++)o[m]=o[m-1]+r[m][1];const c=[`if (yC < ${o[0]}) setOutput(getT0(yR, yC));`];for(let m=1;m<o.length;m++){const y=o[m-1];c.push(`else if (yC < ${o[m]}) setOutput(getT${m}(yR, yC-${y}));`)}const h=o.length,f=o[o.length-1];c.push(`else setOutput(getT${h}(yR, yC-${f}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${c.join(`
        `)}
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class k_e{constructor(r,o){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Nu(r,o);const c=this.outputShape,h=c.length,f=er(h),m=Fo("coords",h),y=["x","y","z","w","u","v"].slice(0,h);this.variableNames=r.map((U,W)=>`T${W}`);const A=new Array(r.length-1);A[0]=r[0][o];for(let U=1;U<A.length;U++)A[U]=A[U-1]+r[U][o];const w=y[o],C=y.slice(-2),_=y.join();let T=`if (${w} < ${A[0]}) {
        return getChannel(
            getT0(${_}), vec2(${C.join()}));
        }`;for(let U=1;U<A.length;U++){const W=A[U-1];T+=`
        if (${w} < ${A[U]}  && ${w} >= ${A[U-1]}) {
          return getChannel(
            getT${U}(${BC(y,w,W)}),
            vec2(${BC(C,w,W)}));
        }`}const B=A.length,O=A[A.length-1];T+=`
        return getChannel(
          getT${B}(${BC(y,w,O)}),
          vec2(${BC(C,w,O)}));`,this.userCode=`
      float getValue(${y.map(U=>"int "+U)}) {
        ${T}
      }

      void main() {
        ${f} coords = getOutputCoords();
        vec4 result = vec4(getValue(${m}), 0., 0., 0.);

        ${m[h-1]} = ${m[h-1]} + 1;
        if (${m[h-1]} < ${c[h-1]}) {
          result.g = getValue(${m});
        }

        ${m[h-2]} = ${m[h-2]} + 1;
        if (${m[h-2]} < ${c[h-2]}) {
          result.a = getValue(${m});
        }

        ${m[h-1]} = ${m[h-1]} - 1;
        if (${m[h-2]} < ${c[h-2]} &&
            ${m[h-1]} < ${c[h-1]}) {
          result.b = getValue(${m});
        }
        setOutput(result);
      }
    `}}function BC(a,r,o){const c=a.indexOf(r);return a.map((h,f)=>f===c?`${h} - ${o}`:h).join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PC(a){const{inputs:r,backend:o}=a,{input:c}=r,h=o.texData.get(c.dataId);return Ha({inputs:{x:h.complexTensorInfos.imag},backend:o})}const R_e={kernelName:Nn,backendName:"webgl",kernelFunc:PC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ab(a,r,o){const c=a[0].dtype;if(c==="complex64"){const B=a.map(X=>ob({inputs:{input:X},backend:o})),O=a.map(X=>PC({inputs:{input:X},backend:o})),U=ab(B,r,o),W=ab(O,r,o),z=Mf({inputs:{real:U,imag:W},backend:o});return B.forEach(X=>o.disposeIntermediateTensorInfo(X)),O.forEach(X=>o.disposeIntermediateTensorInfo(X)),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(W),z}let h=o.shouldExecuteOnCPU(a);if(c==="string"&&(h=!0),h){const B=a.map(se=>{const le=[-1,M(se.shape.slice(r))];return nn({inputs:{x:se},backend:o,attrs:{shape:le}})}),O=B.map(se=>({vals:o.readSync(se.dataId),shape:se.shape})),U=Nu(B.map(se=>se.shape),1),W=B[0].shape[0]===1,z=Ewe(O,U,c,W),X=Nu(a.map(se=>se.shape),r),re=o.makeTensorInfo(X,c,z);return B.forEach(se=>o.disposeIntermediateTensorInfo(se)),re}const f=a.filter(B=>M(B.shape)>0),m=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&f[0].shape.length>1;if(f.length===1){const B=m?new Wu(a[0].shape,Sf):new Tf(a[0].shape,Sf);return o.runWebGLProgram(B,a,c)}const y=Te().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(f.length>y){const B=[];for(let U=0;U<f.length;U+=y){const W=f.slice(U,U+y);B.push(ab(W,r,o))}const O=ab(B,r,o);for(const U of B)o.disposeIntermediateTensorInfo(U);return O}if(m){const B=new k_e(f.map(O=>O.shape),r);return o.runWebGLProgram(B,f,c)}const{tensors2D:A,outShape:w}=L_e(f,r,o),C=new M_e(A.map(B=>B.shape)),_=o.runWebGLProgram(C,A,c);A.forEach(B=>o.disposeIntermediateTensorInfo(B));const T=nn({inputs:{x:_},attrs:{shape:w},backend:o});return o.disposeIntermediateTensorInfo(_),T}function L_e(a,r,o){const c=Nu(a.map(h=>h.shape),r);return{tensors2D:a.map(h=>nn({inputs:{x:h},attrs:{shape:[-1,M(h.shape.slice(r))]},backend:o})),outShape:c}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fH(a){const{inputs:r,backend:o,attrs:c}=a,{axis:h}=c,f=q(h,r[0].shape)[0],m=r.map(w=>w.shape);dk(m,f);const y=Nu(r.map(w=>w.shape),f);if(M(y)===0)return o.makeTensorInfo(y,r[0].dtype,[]);const A=r.filter(w=>M(w.shape)>0);return A.length===1?Ha({inputs:{x:A[0]},backend:o}):ab(A,f,o)}const B_e={kernelName:yc,backendName:"webgl",kernelFunc:fH};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class pH{constructor(r,o=!1,c=null,h=!1,f=!1){this.variableNames=["x","W"],this.outputShape=r.outShape;const m=r.padInfo.top,y=r.padInfo.left,A=r.strideHeight,w=r.strideWidth,C=r.dilationHeight,_=r.dilationWidth,T=r.filterHeight,B=r.filterWidth,O=Math.floor(r.inChannels/4)*4,U=r.inChannels%4,W=r.dataFormat==="channelsLast",z=W?1:2,X=W?2:3,re=W?3:1;let se="",le="";c&&(h?se=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${c}
        }`:f?se=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${c}
        }`:se=`
          float activation(float x) {
            ${c}
          }
        `,le="result = activation(result);");const ge=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),f&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${se}

      const ivec2 strides = ivec2(${A}, ${w});
      const ivec2 pads = ivec2(${m}, ${y});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${re}];

        ivec2 xRCCorner =
            ivec2(coords[${z}], coords[${X}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${T}; wR++) {
          int xR = xRCorner + wR * ${C};

          if (xR < 0 || xR >= ${r.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${B}; wC++) {
            int xC = xCCorner + wC * ${_};

            if (xC < 0 || xC >= ${r.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${O}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${W}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${U===1}) {

              if (${W}) {
                dotProd +=
                    getX(batch, xR, xC, ${O}) *
                    getW(wR, wC, ${O}, d2);
              } else {
                dotProd +=
                    getX(batch, ${O}, xR, xC) *
                    getW(wR, wC, ${O}, d2);
              }

            } else if (${U===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${O}, d2),
                getW(wR, wC, ${O} + 1, d2)
              );

              if (${W}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${O}),
                  getX(batch, xR, xC, ${O} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${O}, xR, xC),
                  getX(batch, ${O} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${U===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${O}, d2),
                getW(wR, wC, ${O} + 1, d2),
                getW(wR, wC, ${O} + 2, d2)
              );

              if (${W}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${O}),
                  getX(batch, xR, xC, ${O} + 1),
                  getX(batch, xR, xC, ${O} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${O}, xR, xC),
                  getX(batch, ${O} + 1, xR, xC),
                  getX(batch, ${O} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${ge}
        ${le}
        setOutput(result);
      }
    `}}class P_e{constructor(r){this.variableNames=["x","W"],this.outputShape=r.outShape;const o=r.padInfo.front,c=r.padInfo.top,h=r.padInfo.left,f=r.strideDepth,m=r.strideHeight,y=r.strideWidth,A=r.dilationDepth,w=r.dilationHeight,C=r.dilationWidth,_=r.filterDepth,T=r.filterHeight,B=r.filterWidth,O=Math.floor(r.inChannels/4)*4,U=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${f}, ${m}, ${y});
      const ivec3 pads = ivec3(${o}, ${c}, ${h});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${_}; wF++) {
          int xF = xFCorner + wF * ${A};

          if (xF < 0 || xF >= ${r.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${T}; wR++) {
            int xR = xRCorner + wR * ${w};

            if (xR < 0 || xR >= ${r.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${B}; wC++) {
              int xC = xCCorner + wC * ${C};

              if (xC < 0 || xC >= ${r.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${O}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${U===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${O}) *
                  getW(wF, wR, wC, ${O}, d2);
              } else if (${U===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${O}),
                  getX(batch, xF, xR, xC, ${O} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${O}, d2),
                  getW(wF, wR, wC, ${O} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${U===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${O}),
                  getX(batch, xF, xR, xC, ${O} + 1),
                  getX(batch, xF, xR, xC, ${O} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${O}, d2),
                  getW(wF, wR, wC, ${O} + 1, d2),
                  getW(wF, wR, wC, ${O} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class mH{constructor(r,o=!1,c=null,h=!1,f=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=r.outShape,this.enableShapeUniforms=po(this.outputShape.length);const m=r.padInfo.left,y=r.strideWidth,A=r.dilationWidth,w=r.filterHeight,C=r.filterWidth,_=C;let T=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let W=0;W<C;W++)T+=`
           vec4 xTexelC${W*2};
           int xTexelC${W*2}Ready;
           vec4 xTexelC${W*2+1};
           int xTexelC${W*2+1}Ready;
           vec4 xC${W};`;T+=`
     for (int r = 0; r < ${w}; r++) {
      for (int d1 = 0; d1 < ${r.inChannels}; d1 += 2) {
       `;for(let W=0;W<C;W++)T+=`
           xTexelC${W*2} = vec4(0.0);
           xTexelC${W*2}Ready = 0;
           xTexelC${W*2+1} = vec4(0.0);
           xTexelC${W*2+1}Ready = 0;
           xC${W} = vec4(0.0);`;T+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let W=0;W<(_+1)/2;W++){const z=W*2;if(T+=`
           xC = xCCorner + ${z*A};
           `,y===1){if(z<C&&(m%2===1?(T+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${z}Ready == 0) {
                   xTexelC${z} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${z}.zw = vec2(0.0);
                   }
                   xTexelC${z}Ready = 1;
                 }
               `,A===1&&z>0?T+=`
                 xC${z} = vec4(xTexelC${z-2}.zw, xTexelC${z}.xy);
                 `:T+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${z} = vec4(previous.zw, xTexelC${z}.xy);
                   } else {
                     xC${z} = vec4(0.0, 0.0, xTexelC${z}.xy);
                   }
                   `):T+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${z}Ready == 0) {
                   xTexelC${z} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${z}.zw = vec2(0.0);
                   }
                   xTexelC${z}Ready = 1;
                 }

                 xC${z} = xTexelC${z};
                 `,z+1<C)){const X=m%2===0?p(A):A;A%2===0&&m%2===1||A%2!==0&&m%2!==1?(T+=`
                   xCOffset = xC + imod(pads[1], 2) + ${X};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${z+1}Ready == 0) {
                     xTexelC${z+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${z+1}.zw = vec2(0.0);
                     }
                     xTexelC${z+1}Ready = 1;
                   }
                   `,A>1?T+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${z+1} = vec4(previous.zw, xTexelC${z+1}.xy);
                     } else {
                      xC${z+1} = vec4(0.0, 0.0, xTexelC${z+1}.xy);
                     }
                     `:T+=`
                     xC${z+1} = vec4(xTexelC${z}.zw, xTexelC${z+1}.xy);
                     `):X===1?T+=`
                     xC${z+1} = xTexelC${z};
                     `:T+=`
                     xCOffset = xC + ${X};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${z+1}Ready == 0) {
                       xTexelC${z+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${z+1}.zw = vec2(0.0);
                       }
                       xTexelC${z+1}Ready = 1;
                     }

                     xC${z+1} = xTexelC${z+1};
                     `}}else z<C&&(m%2===1?(T+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${z}Ready == 0) {
                   xTexelC${z} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${z}.zw = vec2(0.0);
                   }
                   xTexelC${z}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${z+1}Ready == 0) {
                   xTexelC${z+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${z+1}.zw = vec2(0.0);
                   }
                   xTexelC${z+1}Ready = 1;
                 }

                 xC${z} = vec4(xTexelC${z}.zw, xTexelC${z+1}.zw);
               `,z+1<C&&(T+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${z+1} = vec4(xTexelC${z+1}.xy, final.xy);
                 `)):(T+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${z}Ready == 0) {
                   xTexelC${z} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${z}.zw = vec2(0.0);
                   }
                   xTexelC${z}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${z+1}Ready == 0) {
                   xTexelC${z+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${z+1}.zw = vec2(0.);
                   }
                   xTexelC${z+1}Ready = 1;
                 }

                 xC${z} = vec4(
                   xTexelC${z}.xy, xTexelC${z+1}.xy);
               `,z+1<C&&(T+=`
                   xC${z+1} = vec4(xTexelC${z}.zw, xTexelC${z+1}.zw);
                 `)));z<C&&(T+=`
             wTexel = getW(r, ${z}, d1, d2);
             dotProd += xC${z}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${r.inChannels}) {
               dotProd += xC${z}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,z+1<C&&(T+=`
               wTexel = getW(r, ${z+1}, d1, d2);
               dotProd += xC${z+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${r.inChannels}) {
                 dotProd += xC${z+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}T+=`
     }
   `,T+=`
     }
   `,T+=`
     }
   `;let B="",O="";c&&(h?B=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${c}
         }`:f?B=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${c}
         }`:B=`vec4 activation(vec4 x) {
           ${c}
         }`,O="result = activation(result);");const U=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),f&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${B}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${T}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${U}
         ${O}
         setOutput(result);
       }
     `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class N_e{constructor(r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=r,this.enableShapeUniforms=po(this.outputShape.length);const{dataFormat:c}=o,h=Do(),f=c==="channelsLast",m=f?1:2,y=f?2:3,A=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${r[2]} && pos < ${r[1]}) {`;let w="";for(let C=0;C<=1;C++)for(let _=0;_<=1;_++)w+=`
          blockIndex = rc.z + ${_};
          pos = rc.y + ${C};

          ${A}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${m}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${y}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${f}) {
                  innerDims = vec2(d1, ch);
                  result[${C*2+_}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${C*2+_}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${w}

        ${h.output} = result;
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NC(a,r){const o=a.length;return o>=3?r?[...a.slice(0,-3),a[o-3]*a[o-2],a[o-1]]:[...a.slice(0,-3),a[o-3],a[o-2]*a[o-1]]:!r&&o===1&&a[0]>1?[a[0],1]:null}function gH({x:a,filter:r,convInfo:o,backend:c,bias:h=null,preluActivationWeights:f=null,leakyreluAlpha:m=0,activation:y=null}){const A=a.shape,w=c.texData.get(a.dataId),C=o.inChannels,_=A[0]*A[1]*A[2],T=o.outChannels,B=o.dataFormat==="channelsLast",O=!1,U=!1;let W;const z=[];if(f!=null){const X=NC(f.shape,B);X!=null&&(f=nn({inputs:{x:f},backend:c,attrs:{shape:X}}),z.push(f))}if(h!=null){const X=NC(h.shape,B);X!=null&&(h=nn({inputs:{x:h},backend:c,attrs:{shape:X}}),z.push(h))}if(!((_===1||T===1)&&C>rH)&&w.isPacked&&B&&w.texture!=null&&A[2]%2!==0&&R(w.shape.slice(-3),A.slice(-3))){const X=A[0]*A[1]*(A[2]+1),re={dataId:a.dataId,shape:[1,X,o.inChannels],dtype:a.dtype},se=w.shape;w.shape=w.shape.slice(),w.shape[w.shape.length-2]++,b(IC(w.shape,re.shape),()=>`packed reshape ${w.shape} to ${re.shape} isn't free`);const le=nn({inputs:{x:r},backend:c,attrs:{shape:[1,o.inChannels,o.outChannels]}});z.push(le);const ge=RC({a:re,b:le,backend:c,transposeA:O,transposeB:U,bias:h,activation:y,preluActivationWeights:f,leakyreluAlpha:m}),ye=c.texData.get(ge.dataId);b(ye.isPacked,()=>"batchMatMul result is expected to be packed"),w.shape=se,ye.shape=o.outShape,W=Ha({inputs:{x:ge},backend:c}),W.shape=o.outShape,z.push(ge)}else{const X=o.outHeight*o.outWidth,re=nn({inputs:{x:a},backend:c,attrs:{shape:B?[o.batchSize,X,o.inChannels]:[o.batchSize,o.inChannels,X]}}),se=nn({inputs:{x:r},backend:c,attrs:{shape:[1,o.inChannels,o.outChannels]}}),le=RC({a:B?re:se,b:B?se:re,transposeA:!B,transposeB:U,backend:c,bias:h,activation:y,preluActivationWeights:f,leakyreluAlpha:m});W=nn({inputs:{x:le},backend:c,attrs:{shape:o.outShape}}),z.push(re),z.push(se),z.push(le)}for(const X of z)c.disposeIntermediateTensorInfo(X);return W}function yH({x:a,filter:r,convInfo:o,backend:c,bias:h=null,preluActivationWeights:f=null,leakyreluAlpha:m=0,activation:y=null}){const{filterWidth:A,filterHeight:w,inChannels:C,outWidth:_,outHeight:T,dataFormat:B}=o,O=B==="channelsLast",U=A*w*C,W=T*_,z=[o.batchSize,U,W],X=!0,re=!1,se=[];if(f!=null){const mt=NC(f.shape,O);mt!=null&&(f=nn({inputs:{x:f},backend:c,attrs:{shape:mt}}),se.push(f))}if(h!=null){const mt=NC(h.shape,O);mt!=null&&(h=nn({inputs:{x:h},backend:c,attrs:{shape:mt}}),se.push(h))}const le=nn({inputs:{x:r},backend:c,attrs:{shape:[1,U,M(r.shape)/U]}});se.push(le);const ge=new N_e(z,o),ye=[a.shape,[o.padInfo.top,o.padInfo.left],[o.strideHeight,o.strideWidth],[o.dilationHeight,o.dilationWidth],[o.inChannels],[o.filterWidth*o.inChannels],[o.outWidth]],be=c.runWebGLProgram(ge,[a],"float32",ye),Se=nn({inputs:{x:be},backend:c,attrs:{shape:z}});se.push(be),se.push(Se);const Be=h!=null,Ye=f!=null,et=y==="leakyrelu",tt=y?rb(y,!0):null,ot=new J9(O?Se.shape:le.shape,O?le.shape:Se.shape,O?[o.batchSize,W,o.outChannels]:[o.batchSize,o.outChannels,W],X,re,Be,tt,Ye,et),st=O?[Se,le]:[le,Se];if(h&&st.push(h),Ye&&st.push(f),et){const mt=c.makeTensorInfo([],"float32",Br(m,"float32"));st.push(mt),se.push(mt)}const ct=c.runWebGLProgram(ot,st,"float32"),gt=nn({inputs:{x:ct},backend:c,attrs:{shape:o.outShape}});se.push(ct);for(const mt of se)c.disposeIntermediateTensorInfo(mt);return gt}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function D_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dataFormat:A,dilations:w,dimRoundingMode:C}=c,_=Wh(A),T=js(h.shape,f.shape,m,w,y,C,!1,_);let B;if(T.filterHeight===1&&T.filterWidth===1&&T.dilationHeight===1&&T.dilationWidth===1&&T.strideHeight===1&&T.strideWidth===1&&(T.padInfo.type==="SAME"||T.padInfo.type==="VALID"))B=gH({x:h,filter:f,convInfo:T,backend:o});else if(T.strideWidth<=2&&_==="channelsLast"&&Te().getBool("WEBGL_EXP_CONV")){const U=new mH(T),W=[[T.padInfo.top,T.padInfo.left],[T.strideHeight,T.strideWidth],[T.dilationHeight,T.dilationWidth],[T.inHeight,T.inWidth]];B=o.runWebGLProgram(U,[h,f],"float32",W)}else if(Te().getBool("WEBGL_CONV_IM2COL"))B=yH({x:h,filter:f,convInfo:T,backend:o});else{const U=new pH(T);B=o.runWebGLProgram(U,[h,f],"float32")}const O=nn({inputs:{x:B},backend:o,attrs:{shape:T.outShape}});return o.disposeIntermediateTensorInfo(B),O}const F_e={kernelName:Dl,backendName:"webgl",kernelFunc:D_e};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class O_e{constructor(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;const o=r.strideHeight,c=r.strideWidth,h=r.padInfo.top,f=r.padInfo.left,m=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${r.batchSize}; b++) {
          for (int yR = 0; yR < ${r.outHeight}; yR++) {
            int xR = wR + yR * ${o} - ${h};

            if (xR < 0 || xR >= ${r.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${r.outWidth}; yC++) {
              int xC = wC + yC * ${c} - ${f};

              if (xC < 0 || xC >= ${r.inWidth}) {
                continue;
              }

              ${m?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class V_e{constructor(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;const o=r.filterHeight,c=r.filterWidth,h=r.strideHeight,f=r.strideWidth,m=r.dataFormat==="channelsLast",y=o-1-r.padInfo.top,A=c-1-r.padInfo.left,w=m?1:2,C=m?2:3,_=m?3:1;this.userCode=`
      const ivec2 pads = ivec2(${y}, ${A});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${_}];

        ivec2 dyCorner = ivec2(coords[${w}], coords[${C}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o}; wR++) {
          float dyR = float(dyRCorner + wR) / ${h}.0;

          if (dyR < 0.0 || dyR >= ${r.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${o} - 1 - wR;

          for (int wC = 0; wC < ${c}; wC++) {
            float dyC = float(dyCCorner + wC) / ${f}.0;

            if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${c} - 1 - wC;

            for (int d2 = 0; d2 < ${r.outChannels}; d2++) {

              if (${m}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class U_e{constructor(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;const o=r.strideDepth,c=r.strideHeight,h=r.strideWidth,f=r.padInfo.front,m=r.padInfo.top,y=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${r.batchSize}; b++) {
          for (int yF = 0; yF < ${r.outDepth}; yF++) {
            int xF = wF + yF * ${o} - ${f};

            if (xF < 0 || xF >= ${r.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${r.outHeight}; yR++) {
              int xR = wR + yR * ${c} - ${m};

              if (xR < 0 || xR >= ${r.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${r.outWidth}; yC++) {
                int xC = wC + yC * ${h} - ${y};

                if (xC < 0 || xC >= ${r.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class z_e{constructor(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;const o=r.filterDepth,c=r.filterHeight,h=r.filterWidth,f=r.strideDepth,m=r.strideHeight,y=r.strideWidth,A=o-1-r.padInfo.front,w=c-1-r.padInfo.top,C=h-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${A}, ${w}, ${C});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${o}; wF++) {
          float dyF = float(dyFCorner + wF) / ${f}.0;

          if (dyF < 0.0 || dyF >= ${r.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${o} - 1 - wF;

          for (int wR = 0; wR < ${c}; wR++) {
            float dyR = float(dyRCorner + wR) / ${m}.0;

            if (dyR < 0.0 || dyR >= ${r.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${c} - 1 - wR;

            for (int wC = 0; wC < ${h}; wC++) {
              float dyC = float(dyCCorner + wC) / ${y}.0;

              if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${h} - 1 - wC;

              for (int d2 = 0; d2 < ${r.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function G_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,pad:y,dataFormat:A,dimRoundingMode:w,filterShape:C}=c,_=Wh(A),T=js(h.shape,C,m,1,y,w,!1,_),B=new O_e(T);return o.runWebGLProgram(B,[h,f],"float32")}const W_e={kernelName:qr,backendName:"webgl",kernelFunc:G_e};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class H_e{constructor(r){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=r.inShape,this.enableShapeUniforms=po(this.outputShape.length);const o=r.filterHeight,c=r.filterWidth,h=o-1-r.padInfo.top,f=c-1-r.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${h}, ${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${o}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${r.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${o} - 1 - wR;

          for (int wC = 0; wC < ${c}; wC++) {
            int wCPerm = ${c} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${r.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${r.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${r.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${r.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${r.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function X_e(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{inputShape:m,strides:y,pad:A,dataFormat:w,dimRoundingMode:C}=c,_=Wh(w),T=js(m,f.shape,y,1,A,C,!1,_);if(Te().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&_==="channelsLast"){const B=[[T.strideHeight,T.strideWidth]],O=new H_e(T);return o.runWebGLProgram(O,[h,f],"float32",B)}else{const B=new V_e(T);return o.runWebGLProgram(B,[h,f],"float32")}}const $_e={kernelName:hn,backendName:"webgl",kernelFunc:X_e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Q_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dilations:A}=c,w=df(h.shape,f.shape,m,A,y),C=new P_e(w);return o.runWebGLProgram(C,[h,f],"float32")}const K_e={kernelName:al,backendName:"webgl",kernelFunc:Q_e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Z_e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,pad:y,filterShape:A}=c,w=df(h.shape,A,m,1,y),C=new U_e(w);return o.runWebGLProgram(C,[h,f],"float32")}const j_e={kernelName:ks,backendName:"webgl",kernelFunc:Z_e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Y_e(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{pad:m,strides:y,inputShape:A}=c,w=df(A,f.shape,y,1,m),C=new z_e(w);return o.runWebGLProgram(C,[h,f],"float32")}const q_e={kernelName:Fl,backendName:"webgl",kernelFunc:Y_e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const J_e=ey+`
  return cos(x);
`,eIe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${Fm}
  return result;
`,tIe=Bi({opSnippet:J_e,packedOpSnippet:eIe}),nIe={kernelName:Io,backendName:"webgl",kernelFunc:tIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const iIe=Bi({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),rIe={kernelName:So,backendName:"webgl",kernelFunc:iIe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class sIe{constructor(r,o,c,h,f){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[m,y,A,w]=r,[C]=o,[_,T]=c;this.outputShape=[C,_,T,w];const B=h==="bilinear"?1:0,[O,U]=[`${y-1}.0`,`${A-1}.0`],[W,z,X]=_>1?[`${(y-1)/(_-1)}`,"(y2-y1) * height_ratio",`y1*${O} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${O}`],[re,se,le]=T>1?[`${(A-1)/(T-1)}`,"(x2-x1) * width_ratio",`x1*${U} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${U}`];this.userCode=`
      const float height_ratio = float(${W});
      const float width_ratio = float(${re});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${m}) {
          return;
        }

        float height_scale = ${z};
        float width_scale = ${se};

        float in_y = ${X};
        if( in_y < 0.0 || in_y > ${O} ) {
          setOutput(float(${f}));
          return;
        }
        float in_x = ${le};
        if( in_x < 0.0 || in_x > ${U} ) {
          setOutput(float(${f}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${B} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const oIe={kernelName:Ac,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{image:h,boxes:f,boxInd:m}=r,{cropSize:y,method:A,extrapolationValue:w}=c,C=new sIe(h.shape,f.shape,y,A,w);return o.runWebGLProgram(C,[h,f,m],"float32")}};var lb;(function(a){a.Prod="*",a.Sum="+"})(lb||(lb={}));class AH{constructor(r,o,c,h){this.op=r,this.outputShape=o,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const f=this.outputShape.length,m=this.op===lb.Prod?"1.0":"0.0",y=c?m:`getX(${vH(f,"coords",this.op)})`,A=this.outputShape[this.outputShape.length-1];let w="",C="";c?(w=h?`end != ${A-1}`:"end != 0",C=h?"end + 1":"end - 1"):(w=h?`end + pow2 < ${A}`:"end >= pow2",C=h?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${er(f)} coords = getOutputCoords();
        int end = ${bH(f,"coords",this.op)};
        float val = ${y};
        int pow2 = int(pow(2.0, index));
        if (${w}) {
          int idx = ${C};
          ${bH(f,"coords",this.op)} = idx;
          val ${this.op}= getX(${vH(f,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function vH(a,r,o){if(a===1)return`${r}`;if(a===2)return`${r}.x, ${r}.y`;if(a===3)return`${r}.x, ${r}.y, ${r}.z`;if(a===4)return`${r}.x, ${r}.y, ${r}.z, ${r}.w`;throw new Error(`Cumulative ${o} for rank ${a} is not yet supported`)}function bH(a,r,o){if(a===1)return`${r}`;if(a===2)return`${r}.y`;if(a===3)return`${r}.z`;if(a===4)return`${r}.w`;throw new Error(`Cumulative ${o} for rank ${a} is not yet supported`)}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function xH(a,r,o,c,h,f){const m=r.shape.length,y=Tr([c],m);let A=r;y!=null&&(A=Oo({inputs:{x:r},backend:o,attrs:{perm:y}}));const w=Hr(1,m)[0];if(w!==m-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${r.shape.length-1} but got axis=${c}`);const C=A.shape[w];let _=Ha({inputs:{x:A},backend:o});for(let T=0;T<=Math.ceil(Math.log2(C))-1;T++){const B=new AH(a,A.shape,!1,f),O=[[T]],U=_;_=o.runWebGLProgram(B,[_],_.dtype,O),o.disposeIntermediateTensorInfo(U)}if(h){const T=new AH(a,A.shape,h,f),B=_;_=o.runWebGLProgram(T,[_],_.dtype),o.disposeIntermediateTensorInfo(B)}if(y!=null){const T=ff(y),B=Oo({inputs:{x:_},backend:o,attrs:{perm:T}});return o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(A),B}return _}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function aIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,exclusive:m,reverse:y}=c;return xH(lb.Prod,h,o,f,m,y)}const lIe={kernelName:na,backendName:"webgl",kernelFunc:aIe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,exclusive:m,reverse:y}=c;return xH(lb.Sum,h,o,f,m,y)}const uIe={kernelName:ro,backendName:"webgl",kernelFunc:cIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,weights:f}=r,{size:m,binaryOutput:y}=c;if(h.shape.length===1){const A=o.readSync(h.dataId),w=o.readSync(f.dataId),C=U9(A,w,f.dtype,f.shape,m);return o.makeTensorInfo([m],f.dtype,C)}else if(h.shape.length===2){const A=o.bufferSync(h),w=o.bufferSync(f),C=bwe(A,w,m,y);return o.makeTensorInfo(C.shape,f.dtype,C.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${h.shape.length}.`)}const dIe={kernelName:uu,backendName:"webgl",kernelFunc:hIe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class fIe{constructor(r,o,c){this.variableNames=["x"],this.outputShape=[],this.outputShape=r,this.blockSize=o,this.dataFormat=c,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${o};
      int offset_h = imod(h, ${o});
      int in_w = w / ${o};
      int offset_w = imod(w, ${o});
      int offset_d = (offset_h * ${o} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockSize:f,dataFormat:m}=c,y=h.shape[0],A=m==="NHWC"?h.shape[1]:h.shape[2],w=m==="NHWC"?h.shape[2]:h.shape[3],C=m==="NHWC"?h.shape[3]:h.shape[1],_=A*f,T=w*f,B=C/(f*f),O=m==="NHWC"?[y,_,T,B]:[y,B,_,T],U=new fIe(O,f,m);return o.runWebGLProgram(U,[h],h.dtype)}const mIe={kernelName:_h,backendName:"webgl",kernelFunc:pIe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class wH{constructor(r,o=!1,c=null,h=!1,f=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=r.outShape,this.enableShapeUniforms=po(this.outputShape.length);const m=r.filterHeight,y=r.filterWidth,A=r.outChannels/r.inChannels;let w="",C="";c&&(h?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${c}
        }`:f?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${c}
        }`:w=`
          float activation(float x) {
            ${c}
          }
        `,C="result = activation(result);");const _=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),f&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${A};
        int q = d2 - d1 * ${A};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${y}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${_}
        ${C}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class CH{constructor(r,o=!1,c=null,h=!1,f=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=r.outShape,this.enableShapeUniforms=po(this.outputShape.length);const m=r.outChannels/r.inChannels,y=r.padInfo.left,A=r.strideWidth,w=r.dilationWidth,C=r.filterHeight,_=r.filterWidth,T=_;let B=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let z=0;z<_;z++)B+=`
          vec4 xTexelC${z*2};
          int xTexelC${z*2}Ready;
          vec4 xTexelC${z*2+1};
          int xTexelC${z*2+1}Ready;
          vec4 xC${z};`;B+=`
    for (int r = 0; r < ${C}; r++) {
      `;for(let z=0;z<_;z++)B+=`
          xTexelC${z*2} = vec4(0.0);
          xTexelC${z*2}Ready = 0;
          xTexelC${z*2+1} = vec4(0.0);
          xTexelC${z*2+1}Ready = 0;
          xC${z} = vec4(0.0);`;B+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let z=0;z<(T+1)/2;z++){const X=z*2;if(B+=`
          xC = xCCorner + ${X*w};
          `,A===1){if(X<_&&(y%2===1?(B+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }
              `,w===1&&X>0?B+=`
                xC${X} = vec4(xTexelC${X-2}.zw, xTexelC${X}.xy);
                `:B+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${X} = vec4(previous.zw, xTexelC${X}.xy);
                  } else {
                    xC${X} = vec4(0.0, 0.0, xTexelC${X}.xy);
                  }
                  `):B+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                xC${X} = xTexelC${X};
                `,X+1<_)){const re=y%2===0?p(w):w;w%2===0&&y%2===1||w%2!==0&&y%2!==1?(B+=`
                  xCOffset = xC + imod(pads[1], 2) + ${re};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                    xTexelC${X+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${X+1}.zw = vec2(0.0);
                    }
                    xTexelC${X+1}Ready = 1;
                  }
                  `,w>1?B+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${X+1} = vec4(previous.zw, xTexelC${X+1}.xy);
                    } else {
                     xC${X+1} = vec4(0.0, 0.0, xTexelC${X+1}.xy);
                    }
                    `:B+=`
                    xC${X+1} = vec4(xTexelC${X}.zw, xTexelC${X+1}.xy);
                    `):re===1?B+=`
                    xC${X+1} = xTexelC${X};
                    `:B+=`
                    xCOffset = xC + ${re};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                      xTexelC${X+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${X+1}.zw = vec2(0.0);
                      }
                      xTexelC${X+1}Ready = 1;
                    }

                    xC${X+1} = xTexelC${X+1};
                    `}}else X<_&&(y%2===1?(B+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${X+1}Ready == 0) {
                  xTexelC${X+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${X+1}.zw = vec2(0.0);
                  }
                  xTexelC${X+1}Ready = 1;
                }

                xC${X} = vec4(xTexelC${X}.zw, xTexelC${X+1}.zw);
              `,X+1<_&&(B+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${X+1} = vec4(xTexelC${X+1}.xy, final.xy);
                `)):(B+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${X}Ready == 0) {
                  xTexelC${X} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${X}.zw = vec2(0.0);
                  }
                  xTexelC${X}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${X+1}Ready == 0) {
                  xTexelC${X+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${X+1}.zw = vec2(0.);
                  }
                  xTexelC${X+1}Ready = 1;
                }

                xC${X} = vec4(
                  xTexelC${X}.xy, xTexelC${X+1}.xy);
              `,X+1<_&&(B+=`
                  xC${X+1} = vec4(xTexelC${X}.zw, xTexelC${X+1}.zw);
                `)));X<_&&(B+=`
            wTexel = getW(r, ${X}, d1, q);
            dotProd += xC${X} * vec4(wTexel.xz, wTexel.xz);
          `,X+1<_&&(B+=`
              wTexel = getW(r, ${X+1}, d1, q);
              dotProd += xC${X+1} * vec4(wTexel.xz, wTexel.xz);
            `))}B+=`
    }
  `,B+=`
      }
    `;let O="",U="";c&&(h?O=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${c}
        }`:f?O=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${c}
        }`:O=`vec4 activation(vec4 x) {
          ${c}
        }`,U="result = activation(result);");const W=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),h&&this.variableNames.push("preluActivationWeights"),f&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${O}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${m};
        int q = d2 - d1 * ${m};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${B}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${W}
        ${U}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dilations:A,dimRoundingMode:w}=c;let C=A;C==null&&(C=[1,1]),b(fo(m,C),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${m} and dilations '${C}'`);const _=js(h.shape,f.shape,m,C,y,w,!0);let T;Te().getBool("WEBGL_PACK_DEPTHWISECONV")&&_.strideWidth<=2&&_.outChannels/_.inChannels===1?T=new CH(_):T=new wH(_);const B=[[_.padInfo.top,_.padInfo.left],[_.strideHeight,_.strideWidth],[_.dilationHeight,_.dilationWidth],[_.inHeight,_.inWidth]];return o.runWebGLProgram(T,[h,f],"float32",B)}const yIe={kernelName:ll,backendName:"webgl",kernelFunc:gIe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class AIe{constructor(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;const o=r.strideHeight,c=r.strideWidth,h=r.padInfo.top,f=r.padInfo.left,m=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${m} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${r.batchSize}; b++) {
          for (int yR = 0; yR < ${r.outHeight}; yR++) {
            int xR = wR + yR * ${o} - ${h};

            if (xR < 0 || xR >= ${r.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${r.outWidth}; yC++) {
              int xC = wC + yC * ${c} - ${f};

              if (xC < 0 || xC >= ${r.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class vIe{constructor(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;const o=r.filterHeight,c=r.filterWidth,h=r.strideHeight,f=r.strideWidth,m=o-1-r.padInfo.top,y=c-1-r.padInfo.left,A=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${m}, ${y});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${o}; wR++) {
          float dyR = float(dyRCorner + wR) / ${h}.0;

          if (dyR < 0.0 || dyR >= ${r.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${o} - 1 - wR;

          for (int wC = 0; wC < ${c}; wC++) {
            float dyC = float(dyCCorner + wC) / ${f}.0;

            if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${c} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${A}; dm++) {
              int d2 = d1 * ${A} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,dy:f}=r,{strides:m,dilations:y,pad:A,dimRoundingMode:w,filterShape:C}=c,_=js(h.shape,C,m,y,A,w,!0),T=new AIe(_);return o.runWebGLProgram(T,[h,f],"float32")}const xIe={kernelName:hu,backendName:"webgl",kernelFunc:bIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wIe(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,filter:f}=r,{strides:m,dilations:y,pad:A,dimRoundingMode:w,inputShape:C}=c,_=js(C,f.shape,m,y,A,w,!0),T=new vIe(_);return o.runWebGLProgram(T,[h,f],"float32")}const CIe={kernelName:Ol,backendName:"webgl",kernelFunc:wIe};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class EIe{constructor(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function _Ie(a){const{inputs:r,backend:o}=a,{x:c}=r,h=[...c.shape,...c.shape],f=M(c.shape),m=nn({inputs:{x:c},backend:o,attrs:{shape:[f]}}),y=new EIe(f),A=o.runWebGLProgram(y,[m],m.dtype),w=nn({inputs:{x:A},backend:o,attrs:{shape:h}});return o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(A),w}const IIe={kernelName:Vl,backendName:"webgl",kernelFunc:_Ie};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class SIe{constructor(r){this.variableNames=["x","W"],this.outputShape=r.outShape;const{inHeight:o,inWidth:c,padInfo:h,strideHeight:f,strideWidth:m,filterHeight:y,filterWidth:A,dilationHeight:w,dilationWidth:C}=r,{top:_,left:T}=h;this.userCode=`
      const ivec2 strides = ivec2(${f}, ${m});
      const ivec2 pads = ivec2(${_}, ${T});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${y}; h++) {
          int hIn = hBeg + h * ${w};

          if (hIn >= 0 && hIn < ${o}) {
            for (int w = 0; w < ${A}; w++) {
              int wIn = wBeg + w * ${C};

              if (wIn >= 0 && wIn < ${c}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TIe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f}=r,{strides:m,pad:y,dilations:A}=c,w=xv(h.shape,f.shape,m,y,"NHWC",A);let C;const _=new SIe(w);C=o.runWebGLProgram(_,[h,f],"float32");const T=nn({inputs:{x:C},backend:o,attrs:{shape:w.outShape}});return o.disposeIntermediateTensorInfo(C),T}const MIe={kernelName:pe,backendName:"webgl",kernelFunc:TIe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kIe(a){const{inputs:r,backend:o,attrs:c}=a,{equation:h}=c,f=r,{allDims:m,summedDims:y,idDims:A}=_k(h,f.length);Sk(m.length,A,f);const{path:w,steps:C}=Tk(y,A),_=C.length;let T=null,B=m.length;const O=[];for(let U=0;U<_;++U){for(const W of C[U]){const{permutationIndices:z,expandDims:X}=Ik(B,A[W]);let re;Mk(z)?re=f[W]:(re=Oo({inputs:{x:f[W]},backend:o,attrs:{perm:z}}),O.push(re));const se=re.shape.slice();for(let le=0;le<X.length;++le)se.splice(X[le],0,1);R(re.shape,se)||(re=nn({inputs:{x:re},backend:o,attrs:{shape:se}}),O.push(re)),T===null?T=re:(T=zR({inputs:{a:re,b:T},backend:o}),O.push(T))}U<_-1&&(w[U]>=0&&(T=kC({inputs:{x:T},backend:o,attrs:{axis:w[U]-(m.length-B),keepDims:!1}}),O.push(T)),B--)}for(const U of O)U!==T&&o.disposeIntermediateTensorInfo(U);return T}const RIe={kernelName:Nt,backendName:"webgl",kernelFunc:kIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LIe=Bi({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),BIe={kernelName:Kt,backendName:"webgl",kernelFunc:LIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const PIe="return (b >= 0.0) ? a : a * (b + 1.0);",NIe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,DIe={kernelName:on,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o}=a,{dy:c,y:h}=r,f=Te().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new J0(NIe,c.shape,h.shape):new Dm(PIe,c.shape,h.shape);return o.runWebGLProgram(f,[c,h],c.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FIe=Js({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:_we}),OIe={kernelName:Ln,backendName:"webgl",kernelFunc:FIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VIe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${yk};
  float a1 = ${Ak};
  float a2 = ${vk};
  float a3 = ${bk};
  float a4 = ${xk};
  float a5 = ${wk};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,UIe=Bi({opSnippet:VIe}),zIe={kernelName:dn,backendName:"webgl",kernelFunc:UIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const GIe=ey+`
  return exp(x);
`,EH=Bi({opSnippet:GIe,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:Iwe,dtype:"float32"}),WIe={kernelName:Sn,backendName:"webgl",kernelFunc:EH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XR(a){const{inputs:r,attrs:o,backend:c}=a,{dim:h}=o,{input:f}=r,m=f.shape.length,y=f.shape.slice();let A=h;return h<0&&(b(-(m+1)<=h,()=>`Axis must be in the interval [${-(m+1)}, ${m}]`),A=m+h+1),y.splice(A,0,1),nn({inputs:{x:f},backend:c,attrs:{shape:y}})}const HIe={kernelName:zt,backendName:"webgl",kernelFunc:XR};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _H="return exp(x) - 1.0;",XIe=Bi({opSnippet:_H,packedOpSnippet:_H,cpuKernelImpl:Swe}),$Ie={kernelName:gn,backendName:"webgl",kernelFunc:XIe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class IH{constructor(r,o,c){this.variableNames=["real","imag"];const h=o[1];this.outputShape=o;const f=c?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,m=c?`${h}.0`:"1.0";let y;if(r==="real")y="return real * expR - imag * expI;";else if(r==="imag")y="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${r}.`);this.userCode=`
      const float exponentMultiplier = ${f};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${y}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${h});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${h}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${m};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function SH(a,r,o){const c=o.texData.get(a.dataId),h=M(a.shape),f=a.shape[a.shape.length-1],m=h/f,y=nn({inputs:{x:a},backend:o,attrs:{shape:[m,f]}}),A=y.shape,w=new IH("real",A,r),C=new IH("imag",A,r),_=[{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:A},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:A}],T=o.runWebGLProgram(w,_,"float32"),B=o.runWebGLProgram(C,_,"float32"),O=Mf({inputs:{real:T,imag:B},backend:o});o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B);const U=nn({inputs:{x:O},backend:o,attrs:{shape:a.shape}});return o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(O),U}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QIe(a){const{inputs:r,backend:o}=a,{input:c}=r;return SH(c,!1,o)}const KIe={kernelName:Hn,backendName:"webgl",kernelFunc:QIe};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ZIe{constructor(r,o){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=r,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cb(a){const{backend:r,attrs:o}=a,{shape:c,value:h}=o;let{dtype:f}=o;if(f=f||Ne(h),f==="string"){const m=Q(f,M(c));return m.fill(h),r.makeTensorInfo(c,f,m)}else{const m=new ZIe(c,h),y=[[h]];return r.runWebGLProgram(m,[],f,y)}}const jIe={kernelName:Ci,backendName:"webgl",kernelFunc:cb};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class YIe{constructor(r){this.variableNames=["Image"],this.outputShape=[];const o=r[2];this.outputShape=r,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${o} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${o}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const qIe={kernelName:bi,backendName:"webgl",kernelFunc:({inputs:a,backend:r})=>{const{image:o}=a,c=r,h=new YIe(o.shape);return c.runWebGLProgram(h,[o],o.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const TH="return floor(x);",JIe=Bi({opSnippet:TH,packedOpSnippet:TH,cpuKernelImpl:Twe}),e2e={kernelName:Yn,backendName:"webgl",kernelFunc:JIe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const t2e=Js({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),n2e={kernelName:Ht,backendName:"webgl",kernelFunc:t2e};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class i2e{constructor(r){this.variableNames=["A"];const o=Do(),[c,h]=r;this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${c}.0);

        vec4 values = ${o.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class r2e{constructor(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const o=Do(),[c,h]=r;this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${h}.0, ${c}.0);
            vec4 values = ${o.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${o.output} = result;
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const s2e={kernelName:tf,backendName:"webgl",kernelFunc:o2e};let ny,$R=Te().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function o2e(a){const{inputs:r,backend:o,attrs:c}=a;let{pixels:h}=r;const{numChannels:f}=c,m=typeof HTMLVideoElement<"u"&&h instanceof HTMLVideoElement,y=typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement,[A,w]=m?[h.videoWidth,h.videoHeight]:[h.width,h.height],C=[w,A],_=[w,A,f];if(y||m){const U=Te().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ny==null||U!==$R)&&($R=U,ny=document.createElement("canvas").getContext("2d",{willReadFrequently:$R})),ny.canvas.width=A,ny.canvas.height=w,ny.drawImage(h,0,0,A,w),h=ny.canvas}const T=o.makeTensorInfo(C,"int32");o.texData.get(T.dataId).usage=bl.PIXELS,o.gpgpu.uploadPixelDataToTexture(o.getTexture(T.dataId),h);const B=Te().getBool("WEBGL_PACK")?new r2e(_):new i2e(_),O=o.runWebGLProgram(B,[T],"int32");return o.disposeData(T.dataId),O}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function a2e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f,bias:m,preluActivationWeights:y}=r,{strides:A,pad:w,dataFormat:C,dilations:_,dimRoundingMode:T,activation:B,leakyreluAlpha:O}=c,U=Wh(C),W=js(h.shape,f.shape,A,_,w,T,!1,U);let z;const X=[],re=m!=null,se=y!=null,le=B==="leakyrelu",ge=()=>{const be=[h,f],Se=(Be,Ye)=>{if(Ye==="NCHW"&&Be.shape.length===1&&Be.shape[0]!==1){const et=nn({inputs:{x:Be},backend:o,attrs:{shape:[Be.shape[0],1,1]}});return X.push(et),et}return Be};if(re&&be.push(Se(m,C)),se&&be.push(Se(y,C)),le){const Be=o.makeTensorInfo([],"float32",Br(O,"float32"));be.push(Be),X.push(Be)}return be};if(W.filterHeight===1&&W.filterWidth===1&&W.dilationHeight===1&&W.dilationWidth===1&&W.strideHeight===1&&W.strideWidth===1&&(W.padInfo.type==="SAME"||W.padInfo.type==="VALID"))z=gH({x:h,filter:f,convInfo:W,backend:o,bias:m,activation:B,preluActivationWeights:y,leakyreluAlpha:O});else if(W.strideWidth<=2&&U==="channelsLast"&&Te().getBool("WEBGL_EXP_CONV")){const be=B?rb(B,!0):null,Se=new mH(W,re,be,se,le),Be=[[W.padInfo.top,W.padInfo.left],[W.strideHeight,W.strideWidth],[W.dilationHeight,W.dilationWidth],[W.inHeight,W.inWidth]],Ye=ge();z=o.runWebGLProgram(Se,Ye,"float32",Be)}else if(Te().getBool("WEBGL_CONV_IM2COL"))z=yH({x:h,filter:f,convInfo:W,backend:o,bias:m,activation:B,preluActivationWeights:y,leakyreluAlpha:O});else{const be=B?rb(B,!1):null,Se=new pH(W,re,be,se,le),Be=ge();z=o.runWebGLProgram(Se,Be,"float32")}const ye=nn({inputs:{x:z},backend:o,attrs:{shape:W.outShape}});return X.push(z),X.forEach(be=>o.disposeIntermediateTensorInfo(be)),ye}const l2e={kernelName:Nh,backendName:"webgl",kernelFunc:a2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function c2e(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,filter:f,bias:m,preluActivationWeights:y}=r,{strides:A,pad:w,dilations:C,dimRoundingMode:_,activation:T,leakyreluAlpha:B}=c,O=[];let U=C;U==null&&(U=[1,1]),b(fo(A,U),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${A} and dilations '${U}'`);const W=js(h.shape,f.shape,A,U,w,_,!0),z=Te().getBool("WEBGL_PACK_DEPTHWISECONV")&&W.strideWidth<=2&&W.outChannels/W.inChannels===1,X=T?rb(T,z):null,re=[h,f],se=m!=null,le=y!=null,ge=T==="leakyrelu";if(se&&re.push(m),le&&re.push(y),ge){const Be=o.makeTensorInfo([],"float32",Br(B,"float32"));re.push(Be),O.push(Be)}let ye;z?ye=new CH(W,se,X,le,ge):ye=new wH(W,se,X,le,ge);const be=[[W.padInfo.top,W.padInfo.left],[W.strideHeight,W.strideWidth],[W.dilationHeight,W.dilationWidth],[W.inHeight,W.inWidth]],Se=o.runWebGLProgram(ye,re,"float32",be);return O.forEach(Be=>o.disposeIntermediateTensorInfo(Be)),Se}const u2e={kernelName:A0,backendName:"webgl",kernelFunc:c2e};class h2e{constructor(r,o,c,h){this.sliceDim=r,this.strides=o,this.paramsShape=h,this.variableNames=["x","indices"],this.outputShape=c;const f=er(c.length);let m=`
    int index;`;for(let y=0;y<this.sliceDim;y++)m+=`
          index = round(getIndices(coords[0], ${y}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[y]};
          flattenIndex += index * ${this.strides[y]};`;this.userCode=`
         void main() {
          ${f} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${m}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function d2e(a){const{inputs:r,backend:o}=a,{params:c,indices:h}=r,f=h.shape,m=f[f.length-1],y=M(c.shape),[A,w,C,_]=sk(c,h),T=nn({inputs:{x:h},backend:o,attrs:{shape:[w,m]}}),B=nn({inputs:{x:c},backend:o,attrs:{shape:[M(c.shape)/C,C]}});if(o.shouldExecuteOnCPU([c,h])||c.dtype==="string"){const z=o.readSync(h.dataId),X=o.bufferSync(c),re=Mwe(z,X,c.dtype,w,m,C,_,c.shape,y);return o.makeTensorInfo(A,c.dtype,re.values)}const O=new h2e(m,_,[w,C],c.shape),U=o.runWebGLProgram(O,[B,T],B.dtype),W=nn({inputs:{x:U},backend:o,attrs:{shape:A}});return o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(U),W}const f2e={kernelName:ti,backendName:"webgl",kernelFunc:d2e};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class p2e{constructor(r,o){this.variableNames=["A","indices"],this.outputShape=o,this.rank=o.length;const c=er(this.rank),h=m2e(r);this.userCode=`
      void main() {
        ${c} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${r[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${h}));
      }
    `}}function m2e(a,r){const o=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[];for(let h=0;h<a.length;h++)h===2?c.push("index"):c.push(`${o[h]}`);return c.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function MH(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,indices:f}=r,{axis:m,batchDims:y}=c,A=q(m,h.shape)[0];if(Te().get("DEBUG")){const X=o.readSync(f.dataId),re=h.shape[A];for(let se=0;se<X.length;++se){const le=X[se];b(le<=re-1&&le>=0,()=>`GatherV2: the index value ${le} is not in [0, ${re-1}]`)}}const w=Lk(h,f,A,y),C=M(f.shape),_=[],T=nn({inputs:{x:h},backend:o,attrs:{shape:[w.batchSize,w.outerSize,w.dimSize,w.sliceSize]}}),B=nn({inputs:{x:f},backend:o,attrs:{shape:[w.batchSize,C/w.batchSize]}});_.push(T),_.push(B);const O=[w.batchSize,w.outerSize,C/w.batchSize,w.sliceSize];if(o.shouldExecuteOnCPU([h,f])||h.dtype==="string"){const X=o.bufferSync(B),re=o.bufferSync(T),se=kwe(re,X,O);return _.forEach(le=>o.disposeIntermediateTensorInfo(le)),o.makeTensorInfo(w.outputShape,se.dtype,se.values)}const U=new p2e(T.shape,O),W=o.runWebGLProgram(U,[T,B],T.dtype);_.push(W);const z=nn({inputs:{x:W},backend:o,attrs:{shape:w.outputShape}});return _.forEach(X=>o.disposeIntermediateTensorInfo(X)),z}const g2e={kernelName:us,backendName:"webgl",kernelFunc:MH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const y2e=Js({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:Rwe,dtype:"bool"}),A2e={kernelName:Oi,backendName:"webgl",kernelFunc:y2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const v2e=Js({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:Lwe}),b2e={kernelName:Jr,backendName:"webgl",kernelFunc:v2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function x2e(a){const{inputs:r,backend:o}=a,{input:c}=r;return SH(c,!0,o)}const w2e={kernelName:ds,backendName:"webgl",kernelFunc:x2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const C2e=Bi({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),E2e={kernelName:Vi,backendName:"webgl",kernelFunc:C2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const _2e=Bi({opSnippet:"return float(isinf(x));",dtype:"bool"}),I2e={kernelName:pr,backendName:"webgl",kernelFunc:_2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const S2e=Bi({opSnippet:"return float(isnan(x));",dtype:"bool"}),T2e={kernelName:mi,backendName:"webgl",kernelFunc:S2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const M2e=Js({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:Bwe,dtype:"bool"}),k2e={kernelName:fs,backendName:"webgl",kernelFunc:M2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const R2e=Js({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:Pwe,dtype:"bool"}),L2e={kernelName:Ba,backendName:"webgl",kernelFunc:R2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function B2e(a){const{backend:r,attrs:o}=a,{start:c,stop:h,num:f}=o,m=Nwe(c,h,f);return r.makeTensorInfo([m.length],"float32",m)}const P2e={kernelName:Ih,backendName:"webgl",kernelFunc:B2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const N2e=ey+`
  return x < 0.0 ? 0./0. : log(x);
`,D2e=Bi({opSnippet:N2e,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:Dwe}),F2e={kernelName:cl,backendName:"webgl",kernelFunc:D2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const O2e=ey+`
  return log(1.0 + x);
`,V2e=Bi({opSnippet:O2e}),U2e={kernelName:To,backendName:"webgl",kernelFunc:V2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const z2e=Js({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),G2e={kernelName:du,backendName:"webgl",kernelFunc:z2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const W2e=Bi({opSnippet:"return float(!(x >= 1.0));"}),H2e={kernelName:vc,backendName:"webgl",kernelFunc:W2e};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const X2e=Js({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),$2e={kernelName:Sh,backendName:"webgl",kernelFunc:X2e};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class Q2e{constructor(r,o,c,h,f){this.variableNames=["x"],this.outputShape=[];const m=o,y=r[3]-1;this.outputShape=r;let A;const w=`float(${c}) + float(${h}) * sum`;f===.5?A=`inversesqrt(${w})`:f===1?A=`1.0/(${w})`:A=`exp(log(${w}) * float(-${f}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${m}; j <= ${m}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${y}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${A};
        setOutput(val);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class K2e{constructor(r,o,c,h,f){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const m=o,y=r[3]-1;this.outputShape=r;let A;const w=`float(${c}) + float(${h}) * sum`;f===.5?A=`inversesqrt(${w})`:f===1?A=`1.0/(${w})`:A=`exp(log(${w}) * float(-${f}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${m};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${m}; j <= ${m}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${y}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${A};
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Z2e={kernelName:Zd,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{depthRadius:f,bias:m,alpha:y,beta:A}=c,w=Te().getBool("WEBGL_PACK_NORMALIZATION")?new K2e(h.shape,f,m,y,A):new Q2e(h.shape,f,m,y,A);return o.runWebGLProgram(w,[h],h.dtype)}};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class j2e{constructor(r,o,c,h,f){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=o,this.bias=c,this.alpha=h,this.beta=f,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${o})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${o} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${h}) * norm + float(${c});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${h})
                * float(${f})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${f});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const Y2e={kernelName:Xn,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{x:h,y:f,dy:m}=r,{depthRadius:y,bias:A,alpha:w,beta:C}=c,_=new j2e(h.shape,y,A,w,C);return o.runWebGLProgram(_,[h,f,m],h.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function q2e(a,r,o,c){const h=M(r),f=M(a.shape)/h,m=nn({inputs:{x:a},attrs:{shape:[f,h]},backend:c}),y=Om(m,a.dtype,"max",c),A=nn({inputs:{x:y},attrs:{shape:o},backend:c});return c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(y),A}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kH(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{reductionIndices:f,keepDims:m}=c,y=h.shape.length,A=q(f,h.shape);let w=A;const C=Tr(w,y),_=C!=null,T=o.shouldExecuteOnCPU([h]);let B=h;if(_){if(T){const X=o.texData.get(B.dataId).values,re=new Array(y);for(let ge=0;ge<re.length;ge++)re[ge]=h.shape[C[ge]];const se=OR(X,h.shape,h.dtype,C,re);B=o.makeTensorInfo(re,h.dtype);const le=o.texData.get(B.dataId);le.values=se}else B=MC(h,C,o);w=Hr(w.length,y)}Ys("max",w,y);const[O,U]=Ps(B.shape,w);let W=O;m&&(W=ns(O,A));let z;if(T){const X=o.texData.get(B.dataId).values,re=Fwe(X,M(U),W,h.dtype);z=o.makeTensorInfo(W,h.dtype);const se=o.texData.get(z.dataId);se.values=re}else z=q2e(B,U,W,o);return _&&o.disposeIntermediateTensorInfo(B),z}const J2e={kernelName:ps,backendName:"webgl",kernelFunc:kH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const eSe=UR+`
  return max(a, b);
`,tSe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fm+`
  return result;
`,nSe=Js({opSnippet:eSe,packedOpSnippet:tSe,cpuKernelImpl:Owe}),iSe={kernelName:ki,backendName:"webgl",kernelFunc:nSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function rSe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r;nb(h,"maxPool");const{filterSize:f,strides:m,pad:y,dimRoundingMode:A}=c,w=1;b(fo(m,w),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${m} and dilations '${w}'`);const C=Hl(h.shape,f,m,w,y,A);if(C.filterWidth===1&&C.filterHeight===1&&R(C.inShape,C.outShape))return Ha({inputs:{x:h},backend:o});const _=new sb(C,"max",!1);return o.runWebGLProgram(_,[h],h.dtype)}const sSe={kernelName:ul,backendName:"webgl",kernelFunc:rSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function oSe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{filterSize:f,strides:m,pad:y,dataFormat:A,dimRoundingMode:w}=c,C=[1,1,1],_=Gh(h.shape,f,m,C,y,w,A),T=new GR(_,"max",!1);return o.runWebGLProgram(T,[h],h.dtype)}const aSe={kernelName:bc,backendName:"webgl",kernelFunc:oSe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class lSe{constructor(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;const o=r.strideHeight,c=r.strideWidth,h=r.dilationHeight,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,y=f-1-r.padInfo.top,A=m-1-r.padInfo.left,w=f*m-1;this.userCode=`
      const ivec2 pads = ivec2(${y}, ${A});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f};
          wR += ${h}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${r.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${m}; wC++) {
            float dyC = float(dyCCorner + wC) / ${c}.0;

            if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${w} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${m} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class cSe{constructor(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;const o=r.strideDepth,c=r.strideHeight,h=r.strideWidth,f=r.dilationDepth,m=r.dilationHeight,y=r.dilationWidth,A=r.effectiveFilterDepth,w=r.effectiveFilterHeight,C=r.effectiveFilterWidth,_=A-1-r.padInfo.front,T=w-1-r.padInfo.top,B=C-1-r.padInfo.left,O=A*w*C-1;this.userCode=`
      const ivec3 pads = ivec3(${_}, ${T}, ${B});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${A};
           wD += ${f}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${r.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${w};
              wR += ${m}) {
            float dyR = float(dyRCorner + wR) / ${c}.0;

            if (dyR < 0.0 || dyR >= ${r.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${C};
                wC += ${y}) {
              float dyC = float(dyCCorner + wC) / ${h}.0;

              if (dyC < 0.0 || dyC >= ${r.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${O} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${w} * ${C} +
                  wR * ${C} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function uSe(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f}=r,m=f,{filterSize:y,strides:A,pad:w,dimRoundingMode:C}=c,_=[1,1,1],T=Gh(m.shape,y,A,_,w,C),B=new GR(T,"max",!0),O=o.runWebGLProgram(B,[m],m.dtype),U=new cSe(T),W=o.runWebGLProgram(U,[h,O],m.dtype);return o.disposeIntermediateTensorInfo(O),W}const hSe={kernelName:xc,backendName:"webgl",kernelFunc:uSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function dSe(a){const{inputs:r,backend:o,attrs:c}=a,{dy:h,input:f,output:m}=r,y=f;nb([f,m],"maxPoolGrad");const{filterSize:A,strides:w,pad:C,dimRoundingMode:_}=c,T=Hl(y.shape,A,w,1,C,_),B=!0,O=new sb(T,"max",B),U=o.runWebGLProgram(O,[y],y.dtype),W=new lSe(T),z=o.runWebGLProgram(W,[h,U],y.dtype);return o.disposeIntermediateTensorInfo(U),z}const fSe={kernelName:hl,backendName:"webgl",kernelFunc:dSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function pSe(a,r,o,c){let h=new sb(o,"max",!1);const f=c.runWebGLProgram(h,[a],"float32");h=new sb(o,"max",!0,!0,r);const m=c.runWebGLProgram(h,[a],"float32");return[f,m]}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const mSe={kernelName:Ui,backendName:"webgl",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{x:c}=a,{filterSize:h,strides:f,pad:m,includeBatchInIndex:y}=r,A=o;b(c.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${c.shape.length}.`);const w=[1,1];b(fo(f,w),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${f} and dilations '${w}'`);const C=Hl(c.shape,h,f,w,m),[_,T]=pSe(c,y,C,A);return[_,T]}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function gSe(a,r,o,c){const h=M(r),f=M(a.shape)/h,m=nn({inputs:{x:a},attrs:{shape:[f,h]},backend:c}),y=Om(m,"float32","mean",c),A=nn({inputs:{x:y},attrs:{shape:o},backend:c});return c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(y),A}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ySe={kernelName:fu,backendName:"webgl",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{x:c}=a,{keepDims:h,axis:f}=r,m=o,y=c.shape.length,A=q(f,c.shape);let w=A;const C=Tr(w,y),_=C!=null,T=m.shouldExecuteOnCPU([c]),B=[];let O=c;if(_){if(T){const re=m.texData.get(O.dataId).values,se=new Array(y);for(let ye=0;ye<se.length;ye++)se[ye]=c.shape[C[ye]];const le=OR(re,c.shape,c.dtype,C,se);O=m.makeTensorInfo(se,c.dtype);const ge=m.texData.get(O.dataId);ge.values=le}else O=MC(c,C,m);B.push(O),w=Hr(w.length,y)}Ys("sum",w,y);const[U,W]=Ps(O.shape,w);let z=U;h&&(z=ns(U,A));const X=gSe(O,W,z,m);for(const re of B)m.disposeIntermediateTensorInfo(re);return X}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ASe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c,y=h.shape.length,A=q(f,h.shape);let w=A;const C=Tr(w,y);let _=h;C!=null&&(_=Oo({inputs:{x:h},backend:o,attrs:{perm:C}}),w=Hr(w.length,h.shape.length)),Ys("min",w,y);const[T,B]=Ps(_.shape,w),O=M(B),U=nn({inputs:{x:_},backend:o,attrs:{shape:[-1,O]}}),W=Om(U,U.dtype,"min",o);let z;if(m){const X=ns(T,A);z=nn({inputs:{x:W},backend:o,attrs:{shape:X}})}else z=nn({inputs:{x:W},backend:o,attrs:{shape:T}});return o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(W),C!=null&&o.disposeIntermediateTensorInfo(_),z}const vSe={kernelName:Ul,backendName:"webgl",kernelFunc:ASe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bSe=UR+`
  return min(a, b);
`,xSe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Fm+`
  return result;
`,wSe=Js({opSnippet:bSe,packedOpSnippet:xSe,cpuKernelImpl:Vwe}),CSe={kernelName:mr,backendName:"webgl",kernelFunc:wSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ESe{constructor(r,o,c){this.variableNames=["x"],this.outputShape=o.map((C,_)=>C[0]+r[_]+C[1]);const h=r.length,f=er(h),m=o.map(C=>C[0]).join(","),y=o.map((C,_)=>C[0]+r[_]).join(","),A=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,h),w=c==="reflect"?0:1;if(h===1){this.userCode=`
        int start = ${m};
        int end = ${y};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${w};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${w};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${f} start = ${f}(${m});
      ${f} end = ${f}(${y});

      void main() {
        ${f} outC = getOutputCoords();
        for (int i = 0; i < ${h}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${w};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${w};
          }
        }
        ${f} coords = outC - start;
        setOutput(getX(${A}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class _Se{constructor(r,o,c){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o.map((O,U)=>O[0]+r[U]+O[1]);const h=r.length,f=er(h),m=o.map(O=>O[0]).join(","),y=o.map((O,U)=>O[0]+r[U]).join(","),A=Fo("rc",h),w=Fo("source",h),C=`${A[h-1]} < ${this.outputShape[h-1]}`,_=h===1?"source":`vec2(${w.slice(-2).join()})`,T=c==="reflect"?0:1;let B="";if(h===1){const O=`
        ${f} source = rc;
        if (source < start) {
          source = start * 2 - source - ${T};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${T};
        }
        source -= start;
      `;B=`
        ${f} rc = outputLoc;
        ${O}
        result[0] = getChannel(getX(${w.join()}), ${_});
        ${A[h-1]} += 1;
        if(${C}) {
          ${O}
          result[1] = getChannel(getX(${w.join()}), ${_});
        }
      `}else{const O=`
        ${f} source = rc;
        ${f} lt = ${f}(lessThan(source, start));
        ${f} gte = ${f}(greaterThanEqual(source, end));
        ${f} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${T}) +
                gte * ((end - 1) * 2 - source + ${T});
        source -= start;
      `;B=`
        ${f} rc = outputLoc;
        ${O}
        result[0] = getChannel(getX(${w.join()}), ${_});
        ${A[h-1]} += 1;
        if(${C}) {
          ${O}
          result[1] = getChannel(getX(${w.join()}), ${_});
        }
        rc = outputLoc;
        ${A[h-2]} += 1;
        if(${A[h-2]} < ${this.outputShape[h-2]}) {
          ${O}
          result[2] = getChannel(getX(${w.join()}), ${_});
          ${A[h-1]} += 1;
          if(${C}) {
            ${O}
            result[3] = getChannel(getX(${w.join()}), ${_});
          }
        }
      `}this.userCode=`
      const ${f} start = ${f}(${m});
      const ${f} end = ${f}(${y});

      void main() {
        ${f} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${B}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ISe={kernelName:ia,backendName:"webgl",kernelFunc:({inputs:a,backend:r,attrs:o})=>{const{x:c}=a,{paddings:h,mode:f}=o,m=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new _Se(c.shape,h,f):new ESe(c.shape,h,f);return r.runWebGLProgram(m,[c],c.dtype)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const SSe=`if (b == 0.0) return NAN;
  return mod(a, b);`,TSe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Fm+`
  return result;
`,MSe=Js({opSnippet:SSe,packedOpSnippet:TSe}),kSe={kernelName:wc,backendName:"webgl",kernelFunc:MSe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class RSe{constructor(r,o,c){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[r,c],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${o-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${o-1}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const RH=Js({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),LSe={kernelName:Ge,backendName:"webgl",kernelFunc:RH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const LH="return a - b;",BH=Js({opSnippet:LH,packedOpSnippet:LH,supportsComplex:!0,cpuKernelImpl:oCe}),BSe={kernelName:_u,backendName:"webgl",kernelFunc:BH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function PH(a){const{inputs:r,backend:o,attrs:c}=a,{logits:h}=r,{dim:f}=c,m=q([f],h.shape),y=kH({inputs:{x:h},backend:o,attrs:{reductionIndices:m,keepDims:!1}}),A=ns(y.shape,m),w=nn({inputs:{x:y},backend:o,attrs:{shape:A}}),C=BH({inputs:{a:h,b:w},backend:o}),_=EH({inputs:{x:C},backend:o}),T=kC({inputs:{x:_},backend:o,attrs:{axis:m,keepDims:!1}}),B=nn({inputs:{x:T},backend:o,attrs:{shape:A}}),O=RH({inputs:{a:_,b:B},backend:o});return o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(T),o.disposeIntermediateTensorInfo(B),O}const PSe={kernelName:oa,backendName:"webgl",kernelFunc:PH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NSe(a){const{inputs:r,backend:o,attrs:c}=a,{logits:h}=r,{numSamples:f,seed:m,normalized:y}=c,A=y?h:PH({inputs:{logits:h},backend:o,attrs:{dim:h.shape.length-1}}),w=A.shape[0],C=A.shape[1],_=new RSe(w,C,f),T=[[m]],B=o.runWebGLProgram(_,[A],"int32",T);return y||o.disposeIntermediateTensorInfo(A),B}const DSe={kernelName:pu,backendName:"webgl",kernelFunc:NSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FSe=Jl+`
  return -x;
`,OSe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function VSe(a){const{inputs:r,backend:o}=a,{x:c}=r;if(o.shouldExecuteOnCPU([c])){const f=o.texData.get(c.dataId),[m,y]=zwe(f.values,c.shape,c.dtype);return o.makeTensorInfo(y,c.dtype,m)}let h;return Te().getBool("WEBGL_PACK_UNARY_OPERATIONS")?h=new Tf(c.shape,OSe):h=new Wu(c.shape,FSe),o.runWebGLProgram(h,[c],c.dtype)}const USe={kernelName:mu,backendName:"webgl",kernelFunc:VSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const zSe=ek;function GSe(a){Ks("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A}=c,w=o.readSync(h.dataId),C=o.readSync(f.dataId),{selectedIndices:_}=zSe(w,C,m,y,A);return o.makeTensorInfo([_.length],"int32",new Int32Array(_))}const WSe={kernelName:Cc,backendName:"webgl",kernelFunc:GSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const HSe=tk;function XSe(a){Ks("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A,padToMaxOutputSize:w}=c,C=o.readSync(h.dataId),_=o.readSync(f.dataId),{selectedIndices:T,validOutputs:B}=HSe(C,_,m,y,A,w);return[o.makeTensorInfo([T.length],"int32",new Int32Array(T)),o.makeTensorInfo([],"int32",new Int32Array([B]))]}const $Se={kernelName:Th,backendName:"webgl",kernelFunc:XSe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const QSe=nk;function KSe(a){Ks("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:r,backend:o,attrs:c}=a,{boxes:h,scores:f}=r,{maxOutputSize:m,iouThreshold:y,scoreThreshold:A,softNmsSigma:w}=c,C=o.readSync(h.dataId),_=o.readSync(f.dataId),T=m,B=y,O=A,U=w,{selectedIndices:W,selectedScores:z}=QSe(C,_,T,B,O,U);return[o.makeTensorInfo([W.length],"int32",new Int32Array(W)),o.makeTensorInfo([z.length],"float32",new Float32Array(z))]}const ZSe={kernelName:ui,backendName:"webgl",kernelFunc:KSe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jSe{constructor(r,o,c,h){this.variableNames=["indices"],this.outputShape=[r,o],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${h}), float(${c}),
                      float(index == coords.y)));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const YSe={kernelName:Rs,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{indices:h}=r,{dtype:f,depth:m,onValue:y,offValue:A}=c,w=M(h.shape),C=new jSe(w,m,y,A),_=nn({inputs:{x:h},backend:o,attrs:{shape:[w]}}),T=o.runWebGLProgram(C,[_],f);o.disposeIntermediateTensorInfo(_);const B=[...h.shape,m],O=nn({inputs:{x:T},backend:o,attrs:{shape:B}});return o.disposeIntermediateTensorInfo(T),O}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function DC(a){const{inputs:r,backend:o}=a,{x:c}=r;if(c.dtype==="complex64"){const h=ob({inputs:{input:c},backend:o}),f=DC({inputs:{x:h},backend:o}),m=PC({inputs:{input:c},backend:o}),y=DC({inputs:{x:m},backend:o}),A=Mf({inputs:{real:f,imag:y},backend:o});return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(y),A}else return cb({attrs:{shape:c.shape,dtype:c.dtype,value:c.dtype==="string"?"":0},backend:o})}const qSe={kernelName:g0,backendName:"webgl",kernelFunc:DC};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NH(a){const{inputs:r,backend:o}=a,{x:c}=r;if(c.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(c.dtype==="complex64"){const h=ob({inputs:{input:c},backend:o}),f=NH({inputs:{x:h},backend:o}),m=PC({inputs:{input:c},backend:o}),y=DC({inputs:{x:m},backend:o}),A=Mf({inputs:{real:f,imag:y},backend:o});return o.disposeIntermediateTensorInfo(h),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(m),o.disposeIntermediateTensorInfo(y),A}else return cb({attrs:{shape:c.shape,dtype:c.dtype,value:1},backend:o})}const JSe={kernelName:Ec,backendName:"webgl",kernelFunc:NH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eTe(a){const{inputs:r,backend:o,attrs:c}=a,{axis:h}=c;if(r.length===1)return XR({inputs:{input:r[0]},backend:o,attrs:{dim:h}});const f=r[0].shape,m=r[0].dtype;r.forEach(C=>{E(f,C.shape,"All tensors passed to stack must have matching shapes"),b(m===C.dtype,()=>"All tensors passed to stack must have matching dtypes")});const y=[],A=r.map(C=>{const _=XR({inputs:{input:C},backend:o,attrs:{dim:h}});return y.push(_),_}),w=fH({inputs:A,backend:o,attrs:{axis:h}});return y.forEach(C=>o.disposeIntermediateTensorInfo(C)),w}const tTe={kernelName:ra,backendName:"webgl",kernelFunc:eTe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class nTe{constructor(r,o,c){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=o.map((w,C)=>w[0]+r[C]+w[1]);const h=r.length,f=er(h),m=o.map(w=>w[0]).join(","),y=o.map((w,C)=>w[0]+r[C]).join(","),A=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,h);if(h===1){this.userCode=`
        int start = ${m};
        int end = ${y};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${f} start = ${f}(${m});
      ${f} end = ${f}(${y});

      void main() {
        ${f} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${f} coords = outC - start;
          setOutput(getX(${A}));
        }
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class iTe{constructor(r,o,c){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=o.map((U,W)=>U[0]+r[W]+U[1]);const h=r.length,f=er(h),m=o.map(U=>U[0]).join(","),y=o.map((U,W)=>U[0]+r[W]).join(","),A=Fo("rc",h),w=Fo("source",h),C=`${A[h-1]} < ${this.outputShape[h-1]}`,_=h===1?"source":`vec2(${w.slice(-2).join()})`,T=[`${f} rc = outputLoc;`,`${A[h-1]} += 1;
       if(${C}) {
      `,h===1?"":`}
       rc = outputLoc;
       ${A[h-2]} += 1;
       if(${A[h-2]} < ${this.outputShape[h-2]}) {`,h===1?"":`  ${A[h-1]} += 1;
         if(${C}) {`],B=h===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let O="";for(let U=0,W=h===1?2:4;U<W;U++)O+=`
        ${T[U]}
        if (${B}) {
          result[${U}] = float(value);
        } else {
          ${f} source = rc - start;
          result[${U}] = getChannel(getX(${w.join()}), ${_});
        }
      `;O+=h===1?"} ":"}}",this.userCode=`
      const ${f} start = ${f}(${m});
      const ${f} end = ${f}(${y});

      void main() {
        ${f} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${O}
        setOutput(result);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DH=a=>{const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{paddings:f,constantValue:m}=c;if(M(h.shape)===0){const w=f.map((C,_)=>C[0]+h.shape[_]+C[1]);return cb({backend:o,attrs:{shape:w,value:m,dtype:h.dtype}})}const y=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new iTe(h.shape,f,m):new nTe(h.shape,f,m),A=[[m]];return o.runWebGLProgram(y,[h],h.dtype,A)},rTe={kernelName:Mh,backendName:"webgl",kernelFunc:DH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sTe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,oTe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Fm+`
  return result;
`,aTe=Js({opSnippet:sTe,packedOpSnippet:oTe}),lTe={kernelName:yu,backendName:"webgl",kernelFunc:aTe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function cTe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{axis:f,keepDims:m}=c,y=h.shape.length,A=[],w=q(f,h.shape);let C=w;const _=Tr(C,y);let T=h;_!=null&&(T=Oo({inputs:{x:h},backend:o,attrs:{perm:_}}),C=Hr(C.length,y),A.push(T)),Ys("prod",C,y);let B;if(o.shouldExecuteOnCPU([T])){const O=o.texData.get(T.dataId).values,{outVals:U,outShape:W,outDtype:z}=Wwe(T.shape,T.dtype,O,C);B=o.makeTensorInfo(W,z,U)}else{const[O,U]=Ps(T.shape,C),W=M(U),z=nn({inputs:{x:T},backend:o,attrs:{shape:[-1,W]}}),X=mM(h.dtype),re=Om(z,X,"prod",o);B=nn({inputs:{x:re},backend:o,attrs:{shape:O}}),A.push(z),A.push(re)}if(m){A.push(B);const O=ns(B.shape,w);B=nn({inputs:{x:B},backend:o,attrs:{shape:O}})}return A.forEach(O=>o.disposeIntermediateTensorInfo(O)),B}const uTe={kernelName:kh,backendName:"webgl",kernelFunc:cTe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function hTe(a){const{inputs:r,backend:o,attrs:c}=a,{paramsNestedSplits:h,paramsDenseValues:f,indices:m}=r,{outputRaggedRank:y}=c,A=h.map(z=>o.readSync(z.dataId)),w=h.map(z=>z.shape),C=o.readSync(f.dataId),_=o.readSync(m.dataId),[T,B,O]=Hwe(A,w,C,f.shape,f.dtype,_,m.shape,y),U=T.map(z=>o.makeTensorInfo([z.length],"int32",z)),W=o.makeTensorInfo(O,f.dtype,B);return U.concat([W])}const dTe={kernelName:jd,backendName:"webgl",kernelFunc:hTe};/**
* @license
* Copyright 2022 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fTe(a){const{inputs:r,backend:o}=a,{starts:c,limits:h,deltas:f}=r,m=o.readSync(c.dataId),y=o.readSync(h.dataId),A=o.readSync(f.dataId),[w,C]=Xwe(m,c.shape,c.dtype,y,h.shape,A,f.shape),_=o.makeTensorInfo([w.length],"int32",w),T=o.makeTensorInfo([C.length],c.dtype,C);return[_,T]}const pTe={kernelName:Yd,backendName:"webgl",kernelFunc:fTe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mTe(a){const{inputs:r,backend:o,attrs:c}=a,{shape:h,values:f,defaultValue:m,rowPartitionTensors:y}=r,{rowPartitionTypes:A}=c,w=o.readSync(h.dataId),C=o.readSync(f.dataId),_=o.readSync(m.dataId),T=y.map(W=>o.readSync(W.dataId)),B=y.map(W=>W.shape),[O,U]=$we(w,h.shape,C,f.shape,f.dtype,_,m.shape,T,B,A);return o.makeTensorInfo(O,f.dtype,U)}const gTe={kernelName:qd,backendName:"webgl",kernelFunc:mTe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const FH=a=>{const{backend:r,attrs:o}=a,{start:c,stop:h,step:f,dtype:m}=o,y=Qwe(c,h,f,m);return r.makeTensorInfo([y.length],m,y)},yTe={kernelName:Au,backendName:"webgl",kernelFunc:FH};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const ATe=Bi({opSnippet:"return 1.0 / x;"}),vTe={kernelName:Ls,backendName:"webgl",kernelFunc:ATe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const bTe=Jl+`
  return (x < 0.0) ? 0.0 : x;
`,xTe=Bi({opSnippet:bTe,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),wTe={kernelName:bu,backendName:"webgl",kernelFunc:xTe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const CTe=Jl+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ETe=Bi({opSnippet:CTe,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),_Te={kernelName:zl,backendName:"webgl",kernelFunc:ETe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ITe{constructor(r,o,c,h,f){this.variableNames=["A"],this.outputShape=[];const[m,y,A,w]=r;this.outputShape=[m,o,c,w];const C=[h&&o>1?y-1:y,h&&c>1?A-1:A],_=[h&&o>1?o-1:o,h&&c>1?c-1:c];let T;f?T="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":T="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${C[0]/_[0]},
          ${C[1]/_[1]});
      const vec2 inputShapeRC = vec2(${y}.0, ${A}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${T};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class STe{constructor(r,o,c,h,f){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[m,y,A,w]=r;this.outputShape=[m,o,c,w];const C=[h&&o>1?y-1:y,h&&c>1?A-1:A],_=[h&&o>1?o-1:o,h&&c>1?c-1:c];let T;f?T="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":T="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${C[0]/_[0]},
          ${C[1]/_[1]},
          ${C[1]/_[1]});
      const vec3 inputShapeRC = vec3(${y}.0, ${A}.0,
                                     ${A}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${T};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${w-1};
        bool hasNextRow = coords.z < ${c-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TTe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h}=r,{alignCorners:f,halfPixelCenters:m,size:y}=c,[A,w]=y,C=Te().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new STe(h.shape,A,w,f,m):new ITe(h.shape,A,w,f,m);return o.runWebGLProgram(C,[h],"float32")}const MTe={kernelName:xu,backendName:"webgl",kernelFunc:TTe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class kTe{constructor(r,o,c){this.variableNames=["dy"],this.outputShape=[],this.outputShape=o;const[,h,f]=o,[,m,y]=r,A=[c&&m>1?h-1:h,c&&y>1?f-1:f],w=[c&&m>1?m-1:m,c&&y>1?y-1:y],C=A[0]/w[0],_=A[1]/w[1],T=1/C,B=1/_,O=Math.ceil(T)*2+2,U=Math.ceil(B)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${C});
        const float widthScale = float(${_});

        const float invHeightScale = float(${T});
        const float invWidthScale = float(${B});

        const int winHeight = int(${O});
        const int winWidth = int(${U});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${m}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${y}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${h-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${f-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function RTe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h,dy:f}=r,{alignCorners:m}=c,y=new kTe(f.shape,h.shape,m);return o.runWebGLProgram(y,[f],f.dtype)}const LTe={kernelName:wu,backendName:"webgl",kernelFunc:RTe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class BTe{constructor(r,o,c,h,f){this.variableNames=["A"],this.outputShape=[];const[m,y,A,w]=r;this.outputShape=[m,o,c,w];const C=[h&&o>1?y-1:y,h&&c>1?A-1:A],_=[h&&o>1?o-1:o,h&&c>1?c-1:c],T=h?"0.5":"0.0";let B;f?B="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":B="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${C[0]/_[0]},
          ${C[1]/_[1]});
      const vec2 inputShapeRC = vec2(${y}.0, ${A}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${B};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${T})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class PTe{constructor(r,o,c,h,f){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[m,y,A,w]=r;this.outputShape=[m,o,c,w];const C=[h&&o>1?y-1:y,h&&c>1?A-1:A],_=[h&&o>1?o-1:o,h&&c>1?c-1:c],T=h?"0.5":"0.0";let B;f?B="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":B="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${C[0]/_[0]},
          ${C[1]/_[1]},
          ${C[1]/_[1]});
      const vec3 inputShapeRC = vec3(${y}.0, ${A}.0,
                                     ${A}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${B};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${T})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${w-1};
        bool hasNextRow = coords.z < ${c-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function NTe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h}=r,{alignCorners:f,halfPixelCenters:m,size:y}=c,[A,w]=y,C=Te().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new PTe(h.shape,A,w,f,m):new BTe(h.shape,A,w,f,m);return o.runWebGLProgram(C,[h],h.dtype)}const DTe={kernelName:ko,backendName:"webgl",kernelFunc:NTe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class FTe{constructor(r,o,c){this.variableNames=["dy"],this.outputShape=[],this.outputShape=o;const[,h,f]=o,[,m,y]=r,A=[c&&m>1?h-1:h,c&&y>1?f-1:f],w=[c&&m>1?m-1:m,c&&y>1?y-1:y],C=A[0]/w[0],_=A[1]/w[1],T=1/C,B=1/_,O=Math.ceil(T)*2+2,U=Math.ceil(B)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${C});
        const float widthScale = float(${_});

        const float invHeightScale = float(${T});
        const float invWidthScale = float(${B});

        const int winHeight = int(${O});
        const int winWidth = int(${U});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${m}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${y}) {
              continue;
            }

            float sourceFracRow =
              float(${A[0]}) *
                (float(dyR) / float(${w[0]}));

            float sourceFracCol =
                float(${A[1]}) *
                  (float(dyC) / float(${w[1]}));

            int sourceNearestRow = int(min(
                float(int(${h}) - 1),
                ${c} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${f}) - 1),
                ${c} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function OTe(a){const{inputs:r,backend:o,attrs:c}=a,{images:h,dy:f}=r,{alignCorners:m}=c,y=new FTe(f.shape,h.shape,m);return o.runWebGLProgram(y,[f],f.dtype)}const VTe={kernelName:Rh,backendName:"webgl",kernelFunc:OTe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class UTe{constructor(r,o){this.variableNames=["x"];const c=r.length;if(c>4)throw new Error(`WebGL backend: Reverse of rank-${c} tensor is not yet supported`);if(this.outputShape=r,c===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${r[0]} - coord - 1));
        }
      `;return}const h=y=>o.indexOf(y)!==-1&&r[y]!==1?`${r[y]} - coords[${y}] - 1`:`coords[${y}]`,f=r.map((y,A)=>h(A)).join(","),m=er(c);this.userCode=`
      void main() {
        ${m} coords = getOutputCoords();
        setOutput(getX(${f}));
      }
    `}}/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class zTe{constructor(r,o){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const c=r.length;if(c>4)throw new Error(`WebGL backend: Reverse of rank-${c} tensor is not yet supported`);this.outputShape=r;const h=Fo("rc",c),f=`${h[c-1]} + 1 < ${this.outputShape[c-1]}`,m=`${h[c-2]} + 1 < ${this.outputShape[c-2]}`,y=er(c);c===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${r[0]} - rc - 1),
            ${r[0]} - rc - 1);
          if(${f}){
              result.g = getChannel(getX(${r[0]} - (rc  + 1) - 1),
                ${r[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${y} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${A(h.slice())};
          if(${f}){
            result.g = ${w(h.slice())};
          }
          if(${m}) {
            result.b = ${C(h.slice())};
            if(${f}) {
              result.a = ${_(h.slice())};
            }
          }
          setOutput(result);
        }
    `;function A(O){return T(O)}function w(O){return O[c-1]="("+O[c-1]+" + 1)",T(O)}function C(O){return O[c-2]="("+O[c-2]+" + 1)",T(O)}function _(O){return O[c-1]="("+O[c-1]+" + 1)",O[c-2]="("+O[c-2]+" + 1)",T(O)}function T(O){const U=r.map((X,re)=>B(re,O)),W=U.join(","),z=U.slice(-2).join(",");return`getChannel(getX(${W}), vec2(${z}))`}function B(O,U){return o.indexOf(O)!==-1&&r[O]!==1?`${r[O]} - ${U[O]} - 1`:`${U[O]}`}}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GTe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{dims:f}=c,m=h.shape.length,y=q(f,h.shape);if(m===0)return Ha({inputs:{x:h},backend:o});const A=Te().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zTe(h.shape,y):new UTe(h.shape,y);return o.runWebGLProgram(A,[h],h.dtype)}const WTe={kernelName:es,backendName:"webgl",kernelFunc:GTe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HTe{constructor(r,o){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const c=r[1],h=r[2];this.outputShape=r;let f="";typeof o=="number"?f=`float outputValue = ${o.toFixed(2)};`:f=`
        vec3 fill = vec3(${o.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${f}
          if(coordX >= 0 && coordX < ${h} && coordY >= 0 && coordY < ${c}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const XTe={kernelName:y0,backendName:"webgl",kernelFunc:({inputs:a,attrs:r,backend:o})=>{const{image:c}=a,{radians:h,fillValue:f,center:m}=r,y=o,A=new HTe(c.shape,f),[w,C]=pk(m,c.shape[1],c.shape[2]),_=[[w,C,Math.sin(h),Math.cos(h)]];return y.runWebGLProgram(A,[c],c.dtype,_)}};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const $Te=Bi({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),QTe={kernelName:_c,backendName:"webgl",kernelFunc:$Te};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const KTe=Bi({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Kwe}),ZTe={kernelName:Cu,backendName:"webgl",kernelFunc:KTe};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class QR{constructor(r,o,c,h,f,m,y=!0,A=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=m;const w=er(f.length),C=er(m.length);let _="";c===1?_="i":c===2&&(_="i, j");const T=`getIndices(${_})`;let B="";h===1?B="i":h===2&&(B="i, coords[1]");const O=`getUpdates(${B})`;let U="";A&&(U="coords[0], coords[1]");const W=`getDefaultValue(${U})`,z=o>1?"strides[j]":"strides";this.userCode=`
        ${w} strides = ${w}(${f});

        void main() {
          ${C} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${r}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${o}; j++) {
              int index = round(${T});
              flattenedIndex += index * ${z};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${O};
              found = true;
            }
          }
          setOutput(mix(${W}, sum, float(found)));
        }
      `}}/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class jTe{constructor(r,o,c,h,f,m,y=!0,A=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=m;const w=er(f.length),C=er(m.length);let _="";c===1?_="i":c===2&&(_="i, j");const T=`getIndices(${_})`;let B="";h===1?B="i":h===2&&(B="i, coords[1]");const O=`getUpdates(${B})`;let U="";A&&(U="coords[0], coords[1]");const W=`getDefaultValue(${U})`,z=o>1?"strides[j]":"strides",X=o>1?"strides[j + 1]":"strides";this.userCode=`
        ${w} strides = ${w}(${f});

        void main() {
          ${C} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${r}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${o}; j+=2) {
              ivec4 index = round(${T});
              flattenedIndex += index.xz * ${z};
              if (j + 1 < ${o}) {
                flattenedIndex += index.yw * ${X};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${O};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${W}, sum, found));
        }
      `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YTe(a){const{inputs:r,backend:o,attrs:c}=a,{indices:h,updates:f}=r,{shape:m}=c,{sliceRank:y,numUpdates:A,sliceSize:w,strides:C,outputSize:_}=bm(f,h,m),T=[_/w,w];if(_===0)return o.makeTensorInfo(m,h.dtype);const B=nn({inputs:{x:h},backend:o,attrs:{shape:[A,y]}}),O=nn({inputs:{x:f},backend:o,attrs:{shape:[A,w]}}),U=o.makeTensorInfo([],"float32",new Float32Array([0]));let W;Te().getBool("WEBGL_PACK")?W=new jTe(A,y,B.shape.length,O.shape.length,C,T):W=new QR(A,y,B.shape.length,O.shape.length,C,T);const z=o.runWebGLProgram(W,[O,B,U],O.dtype),X=nn({inputs:{x:z},backend:o,attrs:{shape:m}});return o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(z),o.disposeIntermediateTensorInfo(U),X}const qTe={kernelName:Ic,backendName:"webgl",kernelFunc:YTe};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class JTe{constructor(r,o,c,h){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[r,c];const f="while (left < right) {",m=`for (int i = 0; i < ${Math.ceil(Math.log2(o+1))}; ++i) { if (left >= right) break;`,y=Te().getNumber("WEBGL_VERSION")===2?f:m,A=h==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${y}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${A} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function eMe(a){const{inputs:r,backend:o,attrs:c}=a,{sortedSequence:h,values:f}=r,{side:m}=c,y=new JTe(h.shape[0],h.shape[1],f.shape[1],m),A=[[h.shape[1]]];return o.runWebGLProgram(y,[h,f],"int32",A)}const tMe={kernelName:J,backendName:"webgl",kernelFunc:eMe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class nMe{constructor(r,o,c){this.variableNames=["c","a","b"],this.outputShape=o;let h,f;if(c>4)throw Error(`Where for rank ${c} is not yet supported`);if(c===1)f="resRC",h="resRC";else{const y=["resRC.x","resRC.y","resRC.z","resRC.w"],A=[],w=[];for(let C=0;C<o.length;C++)w.push(`${y[C]}`),C<r&&A.push(`${y[C]}`);h=A.join(),f=w.join()}const m=er(c);this.userCode=`
      void main() {
        ${m} resRC = getOutputCoords();
        float cVal = getC(${h});
        if (cVal >= 1.0) {
          setOutput(getA(${f}));
        } else {
          setOutput(getB(${f}));
        }
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function iMe(a){const{inputs:r,backend:o}=a,{condition:c,t:h,e:f}=r,m=new nMe(c.shape.length,h.shape,h.shape.length);return o.runWebGLProgram(m,[c,h,f],Ua(h.dtype,f.dtype))}const rMe={kernelName:ae,backendName:"webgl",kernelFunc:iMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const sMe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Gw};
  float scale = ${Ww};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,oMe=Bi({opSnippet:sMe}),aMe={kernelName:me,backendName:"webgl",kernelFunc:oMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const lMe=ey+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,cMe=Bi({opSnippet:lMe,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:jwe}),uMe={kernelName:xi,backendName:"webgl",kernelFunc:cMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const hMe=Bi({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),dMe={kernelName:zn,backendName:"webgl",kernelFunc:hMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const fMe=ey+`
  return sin(x);
`,pMe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${Fm}
  return result;
`,mMe=Bi({opSnippet:fMe,packedOpSnippet:pMe}),gMe={kernelName:it,backendName:"webgl",kernelFunc:mMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const yMe=Bi({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),AMe={kernelName:Xt,backendName:"webgl",kernelFunc:yMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const vMe=Bi({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),bMe={kernelName:Ii,backendName:"webgl",kernelFunc:vMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const xMe={kernelName:Ro,backendName:"webgl",kernelFunc:a=>{const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{blockShape:f,paddings:m}=c;b(h.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const y=f.reduce((z,X)=>z*X),A=[[0,0]];A.push(...m);for(let z=1+f.length;z<h.shape.length;++z)A.push([0,0]);const w=[],C=DH({inputs:{x:h},backend:o,attrs:{paddings:A,constantValue:0}}),_=Lv(C.shape,f,y,!1),T=Bv(_.length,f.length,!1),B=Pv(C.shape,f,y,!1),O=nn({inputs:{x:C},backend:o,attrs:{shape:_}}),U=Oo({inputs:{x:O},backend:o,attrs:{perm:T}}),W=nn({inputs:{x:U},backend:o,attrs:{shape:B}});return w.push(C),w.push(O),w.push(U),w.forEach(z=>o.disposeIntermediateTensorInfo(z)),W}};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function wMe(a){const{inputs:r,backend:o}=a,{indices:c,values:h,denseShape:f,defaultValue:m}=r;if(f.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${f.shape}`);if(c.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${c.shape}`);if(h.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${h.shape}`);if(m.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${m.shape}`);const y=o.readSync(c.dataId),A=o.readSync(h.dataId),w=o.readSync(f.dataId),C=o.readSync(m.dataId)[0],[_,T,B,O,U]=qwe(y,c.shape,c.dtype,A,h.dtype,w,C);return[o.makeTensorInfo(T,c.dtype,_),o.makeTensorInfo([T[0]],h.dtype,B),o.makeTensorInfo([O.length],"bool",new Uint8Array(O.map(W=>Number(W)))),o.makeTensorInfo([U.length],c.dtype,new Int32Array(U))]}const CMe={kernelName:Lh,backendName:"webgl",kernelFunc:wMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function EMe(a){const{inputs:r,backend:o}=a,{inputIndices:c,inputShape:h,newShape:f}=r;if(c.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${c.shape}`);if(h.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${h.shape}`);if(f.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${f.shape}`);const m=Array.from(o.readSync(h.dataId)),y=o.readSync(c.dataId),A=Array.from(o.readSync(f.dataId)),[w,C,_]=Jwe(y,c.shape,c.dtype,m,A);return[o.makeTensorInfo(C,c.dtype,w),o.makeTensorInfo([_.length],f.dtype,new Int32Array(_))]}const _Me={kernelName:Bh,backendName:"webgl",kernelFunc:EMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function IMe(a){const{inputs:r,backend:o}=a,{data:c,indices:h,segmentIds:f}=r;if(c.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(h.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${h.shape}`);if(f.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${f.shape}`);const m=o.readSync(c.dataId),y=o.readSync(h.dataId),A=o.readSync(f.dataId),[w,C]=G9(m,c.shape,c.dtype,y,A,!0);return o.makeTensorInfo(C,c.dtype,w)}const SMe={kernelName:yw,backendName:"webgl",kernelFunc:IMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function TMe(a){const{inputs:r,backend:o}=a,{data:c,indices:h,segmentIds:f}=r;if(c.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(h.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${h.shape}`);if(f.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${f.shape}`);const m=o.readSync(c.dataId),y=o.readSync(h.dataId),A=o.readSync(f.dataId),[w,C]=G9(m,c.shape,c.dtype,y,A);return o.makeTensorInfo(C,c.dtype,w)}const MMe={kernelName:Da,backendName:"webgl",kernelFunc:TMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function kMe(a){const{inputs:r,backend:o,attrs:c}=a,{sparseIndices:h,sparseValues:f,defaultValue:m}=r,{outputShape:y}=c,{sliceRank:A,numUpdates:w,sliceSize:C,strides:_,outputSize:T}=bm(f,h,y),B=!1;if(f.dtype==="string"){const z=o.bufferSync(h),X=o.bufferSync(f),re=Tc(o.readSync(m.dataId)[0]),se=Zwe(z,X,y,T,C,w,A,_,re,B);return o.makeTensorInfo(y,se.dtype,se.values)}const O=new QR(w,A,h.shape.length,f.shape.length,_,[T,1],B),U=o.runWebGLProgram(O,[f,h,m],f.dtype),W=nn({inputs:{x:U},backend:o,attrs:{shape:y}});return o.disposeIntermediateTensorInfo(U),W}const RMe={kernelName:Ph,backendName:"webgl",kernelFunc:kMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function LMe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{numOrSizeSplits:f,axis:m}=c,y=q(m,h.shape)[0],A=kk(h,f,y),w=h.shape.length,C=new Array(w).fill(0),_=h.shape.slice();return A.map(T=>{const B=[..._];B[y]=T;const O=ty({inputs:{x:h},backend:o,attrs:{begin:C,size:B}});return C[y]+=T,O})}const BMe={kernelName:oo,backendName:"webgl",kernelFunc:LMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const OH="return sqrt(x);",PMe=Bi({opSnippet:OH,packedOpSnippet:OH,cpuKernelImpl:eCe}),NMe={kernelName:lr,backendName:"webgl",kernelFunc:PMe};/**
* @license
* Copyright 2019 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const DMe=Bi({opSnippet:"return x * x;"}),FMe={kernelName:dl,backendName:"webgl",kernelFunc:DMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const VH="return (a - b) * (a - b);",OMe=Js({opSnippet:VH,packedOpSnippet:VH}),VMe={kernelName:nm,backendName:"webgl",kernelFunc:OMe};/**
* @license
* Copyright 2023 Google LLC.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UMe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r;if(h.dtype!=="string")throw new Error("Input must be of datatype string");const f=o.readSync(h.dataId),m=Qh(f),y=tCe(m,"string",c);return o.makeTensorInfo(h.shape,"string",y)}const zMe={kernelName:sv,backendName:"webgl",kernelFunc:UMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function GMe({inputs:a,attrs:r,backend:o}){const{x:c}=a,h=Jl+`
    return x > 0.0 ? 1.0 : float(${r.alpha});
  `,f=new Wu(c.shape,h);return o.runWebGLProgram(f,[c],c.dtype)}const WMe={kernelName:aa,backendName:"webgl",kernelFunc:GMe};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class HMe{constructor(r,o,c){this.variableNames=["x"],this.outputShape=c;const h=c.length,f=er(c.length),m=er(c.length);let y="";if(h===1)y="coords * strides + begin";else{let A=0;y=c.map((w,C)=>(A++,c.length===1?`coords * strides[${C}] + begin[${C}]`:`coords[${A-1}] * strides[${C}] + begin[${C}]`)).join(",")}this.userCode=`
      ${f} begin = ${f}(${r});
      ${f} strides = ${f}(${o});

      void main() {
        ${m} coords = getOutputCoords();
        setOutput(getX(${y}));
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function XMe(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{begin:f,end:m,strides:y,beginMask:A,endMask:w,ellipsisMask:C,newAxisMask:_,shrinkAxisMask:T}=c,{finalShapeSparse:B,finalShape:O,isIdentity:U,sliceDim0:W,isSimpleSlice:z,begin:X,end:re,strides:se}=hk(h.shape,f,m,y,A,w,C,_,T);let le;if(U)le=nn({inputs:{x:h},backend:o,attrs:{shape:O}});else if(W||z){b(h.shape.length>=1,()=>`Input must have rank at least 1, got: ${h.shape.length}`);const ye=lk(X,re,se),be=ty({inputs:{x:h},backend:o,attrs:{begin:X,size:ye}});le=nn({inputs:{x:be},backend:o,attrs:{shape:O}}),o.disposeIntermediateTensorInfo(be)}else if(o.shouldExecuteOnCPU([h])){const ye=o.readSync(h.dataId),be=yi(h.shape,h.dtype,ye),Se=nCe(B,be,se,X);le=o.makeTensorInfo(O,h.dtype,Se.values)}else{const ye=new HMe(X,se,B);le=o.runWebGLProgram(ye,[h],h.dtype)}const ge=nn({inputs:{x:le},backend:o,attrs:{shape:O}});return o.disposeIntermediateTensorInfo(le),ge}const $Me={kernelName:Eu,backendName:"webgl",kernelFunc:XMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function QMe(a){const{inputs:r,backend:o,attrs:c}=a,{separator:h,nGramWidths:f,leftPad:m,rightPad:y,padWidth:A,preserveShortSequences:w}=c,{data:C,dataSplits:_}=r,T=o.readSync(C.dataId),B=o.readSync(_.dataId),[O,U]=iCe(T,B,h,f,m,y,A,w);return[o.makeTensorInfo([O.length],"string",O),o.makeTensorInfo(_.shape,"int32",U)]}const KMe={kernelName:Aw,backendName:"webgl",kernelFunc:QMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ZMe(a){const{inputs:r,backend:o,attrs:c}=a,{skipEmpty:h}=c,{input:f,delimiter:m}=r;if(f.dtype!=="string")throw new Error("Input must be of datatype string");if(f.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${f.shape}`);if(m.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${m.shape}`);const y=o.readSync(f.dataId),A=o.readSync(m.dataId)[0],[w,C,_]=rCe(y,A,h),T=C.length;return[o.makeTensorInfo([T,2],"int32",w),o.makeTensorInfo([T],"string",C),o.makeTensorInfo([2],"int32",new Int32Array(_))]}const jMe={kernelName:Jd,backendName:"webgl",kernelFunc:ZMe};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function YMe(a){const{inputs:r,backend:o,attrs:c}=a,{numBuckets:h}=c,{input:f}=r;if(f.dtype!=="string")throw new Error("Input must be of datatype string");if(h<=0)throw new Error("Number of buckets must be at least 1");const m=o.readSync(f.dataId),y=sCe(m,h);return o.makeTensorInfo(f.shape,"int32",y)}const qMe={kernelName:ov,backendName:"webgl",kernelFunc:YMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const JMe=Bi({opSnippet:"return tan(x);"}),eke={kernelName:im,backendName:"webgl",kernelFunc:JMe};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const tke=Bi({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),nke={kernelName:Fa,backendName:"webgl",kernelFunc:tke};/**
* @license
* Copyright 2022 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function ike(a){const{inputs:r,backend:o,attrs:c}=a,{tensor:h,indices:f,updates:m}=r,{sliceRank:y,numUpdates:A,sliceSize:w,strides:C,outputSize:_}=bm(m,f,h.shape),T=[_/w,w];if(_===0)return o.makeTensorInfo(h.shape,f.dtype);const B=nn({inputs:{x:f},backend:o,attrs:{shape:[A,y]}}),O=nn({inputs:{x:m},backend:o,attrs:{shape:[A,w]}}),U=nn({inputs:{x:h},backend:o,attrs:{shape:T}}),W=new QR(A,y,B.shape.length,O.shape.length,C,T,!1,!0),z=o.runWebGLProgram(W,[O,B,U],U.dtype),X=nn({inputs:{x:z},backend:o,attrs:{shape:h.shape}});return o.disposeIntermediateTensorInfo(B),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(z),X}const rke={kernelName:N,backendName:"webgl",kernelFunc:ike};/**
* @license
* Copyright 2017 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class ske{constructor(r,o){this.variableNames=["A"];const c=new Array(r.length);for(let m=0;m<c.length;m++)c[m]=r[m]*o[m];this.outputShape=c,this.rank=c.length;const h=er(this.rank),f=oke(r);this.userCode=`
      void main() {
        ${h} resRC = getOutputCoords();
        setOutput(getA(${f}));
      }
    `}}function oke(a){const r=a.length;if(r>5)throw Error(`Tile for rank ${r} is not yet supported`);if(r===1)return`imod(resRC, ${a[0]})`;const o=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[];for(let h=0;h<a.length;h++)c.push(`imod(${o[h]}, ${a[h]})`);return c.join()}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function UH(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{reps:f}=c;if(h.dtype==="string"||h.shape.length>5){const y=o.readSync(h.dataId),A=h.dtype==="string"?y.map(_=>Tc(_)):y,w=yi(h.shape,h.dtype,A),C=aCe(w,f);return o.makeTensorInfo(C.shape,C.dtype,C.values)}const m=new ske(h.shape,f);return o.runWebGLProgram(m,[h],h.dtype)}const ake={kernelName:Iu,backendName:"webgl",kernelFunc:UH};class lke{constructor(r){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=r,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class cke{constructor(r){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=r,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function Vm(a,r){r!==null&&a.disposeIntermediateTensorInfo(r)}function zH(a){let r=1;for(;r<a;)r*=2;return r}function uke(a){const{inputs:r,backend:o,attrs:c}=a,{x:h}=r,{k:f,sorted:m}=c,y=Te().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),A=Te().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),w=h.shape,C=w[w.length-1];if(o.shouldExecuteOnCPU([h])||C<y||f>A){const Se=o.readSync(h.dataId),[Be,Ye]=lCe(Se,w,h.dtype,f,m);return[o.makeTensorInfo(Be.shape,Be.dtype,Be.values),o.makeTensorInfo(Ye.shape,Ye.dtype,Ye.values)]}if(f===0)return w[w.length-1]=0,[o.makeTensorInfo(w,h.dtype,[]),o.makeTensorInfo(w,"int32",[])];if(C===1)return[h,cb({attrs:{shape:w,dtype:"int32",value:0},backend:o})];const _=o.texData.get(h.dataId),T=_!==null&&_.isPacked,B=T?o.unpackTensor(h):h,O=M(w)/C,U=nn({inputs:{x:B},attrs:{shape:[O,C]},backend:o});T&&Vm(o,B);const W=zH(f),z=zH(C);let X=null;const re=()=>X===null?[U,U]:[U,X],se=(Se,Be,Ye)=>{const et=re(),tt=new lke(Ye),ot=[[C],[X===null?1:0],[Number.NEGATIVE_INFINITY],[Se],[Be]],st=X;X=o.runWebGLProgram(tt,et,"int32",ot),Vm(o,st)};for(let Se=1;Se<W;Se*=2){const Be=Se*2;for(let Ye=Se;Ye>=1;Ye/=2)se(Be,Ye,[O,z])}for(let Se=z;Se>W;Se/=2){const Be=re(),Ye=new cke([O,Se/2]),et=[[C],[X===null?1:0],[W]],tt=X;X=o.runWebGLProgram(Ye,Be,"int32",et),Vm(o,tt);const ot=W/2,st=ot*2;for(let ct=ot;ct>=1;ct/=2)se(st,ct,X.shape)}let le=X;X=ty({inputs:{x:X},backend:o,attrs:{begin:0,size:[O,f]}}),Vm(o,le);let ge=MH({inputs:{x:U,indices:X},backend:o,attrs:{axis:1,batchDims:1}});Vm(o,U);const ye=w.slice(0,-1);ye.push(f),le=X,X=nn({inputs:{x:X},attrs:{shape:ye},backend:o}),Vm(o,le);const be=ge;return ge=nn({inputs:{x:ge},attrs:{shape:ye},backend:o}),Vm(o,be),[ge,X]}const hke={kernelName:av,backendName:"webgl",kernelFunc:uke};/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class dke{constructor(r,o,c,h,f,m){this.variableNames=["Image","Transforms"],this.outputShape=m;const y=c==="nearest"?1:2;let A;switch(h){case"constant":A=1;break;case"reflect":A=2;break;case"wrap":A=3;break;case"nearest":A=4;break;default:A=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${A} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${A} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${A} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${r} && 0 <= coordX && coordX < ${o}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${f});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${f});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${o}));
                float mapY = mapCoord(inY, float(${r}));

                if (${y} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
* @license
* Copyright 2021 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function fke(a){const{inputs:r,backend:o,attrs:c}=a,{image:h,transforms:f}=r,{interpolation:m,fillMode:y,fillValue:A,outputShape:w}=c,[C,_,T,B]=h.shape,[O,U]=w??[_,T],W=[C,O,U,B],z=new dke(_,T,m,y,A,W);return o.runWebGLProgram(z,[h,f],"float32")}const pke={kernelName:rm,backendName:"webgl",kernelFunc:fke};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the License);
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an AS IS BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function mke(a){const{inputs:r,attrs:o,backend:c}=a,{axis:h}=o,{x:f}=r;nb(f,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const m=c.readSync(f.dataId),{outputValues:y,outputShape:A,indices:w}=cCe(m,h,f.shape,f.dtype);return[c.makeTensorInfo(A,f.dtype,y),c.makeTensorInfo([w.length],"int32",w)]}const gke={kernelName:fl,backendName:"webgl",kernelFunc:mke};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function yke(a){const{inputs:r,backend:o,attrs:c}=a,{value:h}=r;let{axis:f}=c;f<0&&(f+=h.shape.length);const m=h,y=m.shape.length,A=h.shape[f],w=new Array(y-1);let C=0;for(let U=0;U<y;U++)U!==f&&(w[C++]=m.shape[U]);const _=[],T=new Array(y).fill(0),B=m.shape.slice();B[f]=1;const O=new Array(A);for(let U=0;U<O.length;U++){T[f]=U;const W=ty({inputs:{x:m},backend:o,attrs:{begin:T,size:B}}),z=nn({inputs:{x:W},backend:o,attrs:{shape:w}});O[U]=z,_.push(W)}return _.forEach(U=>o.disposeIntermediateTensorInfo(U)),O}const Ake={kernelName:m0,backendName:"webgl",kernelFunc:yke};/**
* @license
* Copyright 2018 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/class vke{constructor(r,o){this.variableNames=["x","segmentIds"];const c=r.windowSize,h=r.batchSize,f=r.inSize,m=r.numSegments,y=m*Math.ceil(f/c);this.outputShape=[h,y];const A="0.0",w="sumValue",C=Math.floor(c/4)*4,_=c%4,T=`
        sumValue += dot(values, segFilter);
    `;let B="";f%c>0&&(B=`
        if (inIdx < 0 || inIdx >= ${f}) {
          return initializationValue;
        }
      `);let O="";f%c>0&&(O=`
        if (inIdx < 0 || inIdx >= ${f}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${A};

      float getValue(int batch, int inIdx) {
        ${B}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${O}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${m})) * float(${c}));
        int currentSeg = int(mod(float(outIdx), float(${m})));

        float sumValue = 0.0;

        for (int i = 0; i < ${C}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${T}
        }

        int inIdx = inOffset + ${C};
        if (${_===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${T}
        } else if (${_===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${T}
        } else if (${_===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${T}
        }
        setOutput(${w});
      }
    `}}/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/function bke(a){const{inputs:r,backend:o,attrs:c}=a,{x:h,segmentIds:f}=r,{numSegments:m}=c,y=h.shape.length,A=[];let w=0;const C=Tr([w],y);let _=h;C!=null&&(_=Oo({inputs:{x:h},backend:o,attrs:{perm:C}}),A.push(_),w=Hr(1,y)[0]);const T=pG(_.shape,w,m),B=M([_.shape[w]]),O=nn({inputs:{x:_},backend:o,attrs:{shape:[-1,B]}});A.push(O);const U=mM(h.dtype),W=(se,le,ge,ye,be)=>{const Se=se.shape[0],Be=se.shape[1],Ye=fG(Be,be),et={windowSize:Ye,inSize:Be,batchSize:Se,numSegments:be},tt=new vke(et,le),ot=o.compileAndRun(tt,[se,ge],ye);if(A.push(ot),ot.shape[1]===be)return ot;const st=FH({backend:o,attrs:{start:0,stop:be,step:1,dtype:"float32"}}),ct=UH({inputs:{x:st},backend:o,attrs:{reps:[Be/Ye]}});return A.push(st),A.push(ct),W(ot,le,ct,ye,be)},z=W(O,"unsortedSegmentSum",f,U,m),X=nn({inputs:{x:z},backend:o,attrs:{shape:T}});let re=X;if(C!=null){A.push(X);const se=ff(C);re=Oo({inputs:{x:re},backend:o,attrs:{perm:se}})}return A.forEach(se=>o.disposeIntermediateTensorInfo(se)),re}const xke={kernelName:Sc,backendName:"webgl",kernelFunc:bke};/**
* @license
* Copyright 2020 Google LLC. All Rights Reserved.
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
* =============================================================================
*/const wke=[eEe,nEe,sEe,lEe,uEe,fEe,mEe,yEe,xEe,CEe,IEe,MEe,LEe,DEe,VEe,zEe,WEe,QEe,ZEe,YEe,e_e,o_e,l_e,d_e,p_e,v_e,x_e,__e,FCe,T_e,B_e,F_e,W_e,$_e,K_e,j_e,q_e,nIe,rIe,oIe,lIe,uIe,dIe,mIe,yIe,xIe,CIe,IIe,MIe,RIe,BIe,DIe,OIe,zIe,WIe,HIe,$Ie,KIe,jIe,qIe,e2e,n2e,s2e,l2e,u2e,f2e,g2e,A2e,b2e,DCe,w2e,R_e,E2e,I2e,T2e,VCe,k2e,L2e,P2e,F2e,U2e,G2e,H2e,$2e,Z2e,Y2e,J2e,iSe,sSe,aSe,hSe,fSe,mSe,ySe,vSe,CSe,ISe,kSe,DSe,GCe,USe,WSe,$Se,ZSe,m_e,YSe,JSe,tTe,rTe,lTe,zCe,uTe,dTe,pTe,gTe,yTe,g_e,LSe,vTe,wTe,_Te,HCe,MTe,LTe,DTe,VTe,WTe,XTe,QTe,ZTe,qTe,tMe,rMe,aMe,uMe,dMe,gMe,AMe,s_e,PSe,bMe,xMe,CMe,_Me,SMe,MMe,RMe,BMe,NMe,FMe,VMe,zMe,WMe,$Me,KMe,jMe,qMe,BSe,YCe,eke,nke,rke,ake,hke,pke,qCe,gke,Ake,xke,qSe];for(const a of wke)la(a);const GH="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIFd0e2NvbnN0cnVjdG9yKG49W10sZT1RdCl7aWYodGhpcy5kYXRhPW4sdGhpcy5sZW5ndGg9dGhpcy5kYXRhLmxlbmd0aCx0aGlzLmNvbXBhcmU9ZSx0aGlzLmxlbmd0aD4wKWZvcihsZXQgdD0odGhpcy5sZW5ndGg+PjEpLTE7dD49MDt0LS0pdGhpcy5fZG93bih0KX1wdXNoKG4pe3RoaXMuZGF0YS5wdXNoKG4pLHRoaXMubGVuZ3RoKyssdGhpcy5fdXAodGhpcy5sZW5ndGgtMSl9cG9wKCl7aWYodGhpcy5sZW5ndGg9PT0wKXJldHVybjtjb25zdCBuPXRoaXMuZGF0YVswXSxlPXRoaXMuZGF0YS5wb3AoKTtyZXR1cm4gdGhpcy5sZW5ndGgtLSx0aGlzLmxlbmd0aD4wJiYodGhpcy5kYXRhWzBdPWUsdGhpcy5fZG93bigwKSksbn1wZWVrKCl7cmV0dXJuIHRoaXMuZGF0YVswXX1fdXAobil7Y29uc3R7ZGF0YTplLGNvbXBhcmU6dH09dGhpcyxzPWVbbl07Zm9yKDtuPjA7KXtjb25zdCByPW4tMT4+MSxpPWVbcl07aWYodChzLGkpPj0wKWJyZWFrO2Vbbl09aSxuPXJ9ZVtuXT1zfV9kb3duKG4pe2NvbnN0e2RhdGE6ZSxjb21wYXJlOnR9PXRoaXMscz10aGlzLmxlbmd0aD4+MSxyPWVbbl07Zm9yKDtuPHM7KXtsZXQgaT0objw8MSkrMSxoPWVbaV07Y29uc3QgbD1pKzE7aWYobDx0aGlzLmxlbmd0aCYmdChlW2xdLGgpPDAmJihpPWwsaD1lW2xdKSx0KGgscik+PTApYnJlYWs7ZVtuXT1oLG49aX1lW25dPXJ9fWZ1bmN0aW9uIFF0KG8sbil7cmV0dXJuIG88bj8tMTpvPm4/MTowfWNvbnN0IHl0PW89Pntjb25zdHt2MTpuLHYyOmV9PW87bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9KG5bc11eZVtzXSk+Pj4wO3QrPVp0KHIpfXJldHVybiB0fSxadD1vPT57dmFyIG49by0obz4+MSYxNDMxNjU1NzY1KTtyZXR1cm4gbj0obj4+MiY4NTg5OTM0NTkpKyhuJjg1ODk5MzQ1OSksbj0obj4+NCkrbiYyNTI2NDUxMzUsbj0obj4+OCkrbiYxNjcxMTkzNSxuPShuPj4xNikrbiY2NTUzNSxufSxjdD0xLHZ0PW89Pntjb25zdHtrZXl3aWR0aDpuLGtleWhlaWdodDplLHF1ZXJ5d2lkdGg6dCxxdWVyeWhlaWdodDpzLG1hdGNoZXM6cn09byxpPXQqMS4yLGg9LWksbD1zKjEuMix1PS1sLGY9MTIsZz0xMCxhPS0xLGo9MSx5PTEvTWF0aC5sb2coMTApLG09TWF0aC5tYXgobixlKSxNPU1hdGguZmxvb3Iobi8yKSxUPU1hdGguZmxvb3IoZS8yKSxFPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludC5zY2FsZSxLPXJbTl0ua2V5cG9pbnQuc2NhbGU7Sz09MCYmY29uc29sZS5sb2coIkVSUk9SIGRpdmlkZSB6ZXJvIik7Y29uc3Qgdj0kL0s7RS5wdXNoKHYqbSl9RS5zb3J0KChOLCQpPT5OLSQpO2NvbnN0IFI9LjI1KkVbTWF0aC5mbG9vcihFLmxlbmd0aC8yKS0oRS5sZW5ndGglMj09MD8xOjApLTFdLHE9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGktaCkvUikpLEk9TWF0aC5tYXgoNSxNYXRoLmNlaWwoKGwtdSkvUikpLHo9cSpJLEI9eipmLGM9W10scD1bXSxTPXt9O2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtjb25zdCAkPXJbTl0ucXVlcnlwb2ludCxLPXJbTl0ua2V5cG9pbnQse3g6dix5OlYsc2NhbGU6TCxhbmdsZTpDfT14dCh7cXVlcnlwb2ludDokLGtleXBvaW50Okssa2V5Y2VudGVyWDpNLGtleWNlbnRlclk6VCxzY2FsZU9uZU92ZXJMb2dLOnl9KTtpZih2PGh8fHY+PWl8fFY8dXx8Vj49bHx8Qzw9LU1hdGguUEl8fEM+TWF0aC5QSXx8TDxhfHxMPj1qKXtjW05dPSExO2NvbnRpbnVlfWxldCBYPXEqKHYtaCkvKGktaCksd3Q9SSooVi11KS8obC11KSxwdD1mKihDK01hdGguUEkpLygyKk1hdGguUEkpLGR0PWcqKEwtYSkvKGotYSk7cFtOXT17YmluWDpYLGJpblk6d3QsYmluQW5nbGU6cHQsYmluU2NhbGU6ZHR9O2xldCBpdD1NYXRoLmZsb29yKFgtLjUpLGx0PU1hdGguZmxvb3Iod3QtLjUpLGh0PU1hdGguZmxvb3IoZHQtLjUpLGp0PShNYXRoLmZsb29yKHB0LS41KStmKSVmO2lmKGl0PDB8fGl0KzE+PXF8fGx0PDB8fGx0KzE+PUl8fGh0PDB8fGh0KzE+PWcpe2NbTl09ITE7Y29udGludWV9Zm9yKGxldCB1dD0wO3V0PDI7dXQrKyl7bGV0IGt0PWl0K3V0O2ZvcihsZXQgYnQ9MDtidDwyO2J0Kyspe2xldCB1bj1sdCtidDtmb3IobGV0IEl0PTA7SXQ8MjtJdCsrKXtsZXQgY249KGp0K0l0KSVmO2ZvcihsZXQgUnQ9MDtSdDwyO1J0Kyspe2xldCBmbj1odCtSdDtjb25zdCBOdD1rdCt1bipxK2NuKnorZm4qQjtTW050XT09PXZvaWQgMCYmKFNbTnRdPTApLFNbTnRdKz0xfX19fWNbTl09ITB9bGV0IGQ9MCxEPS0xO2lmKE9iamVjdC5rZXlzKFMpLmZvckVhY2goTj0+e1NbTl0+ZCYmKGQ9U1tOXSxEPU4pfSksZDwzKXJldHVybltdO2NvbnN0IFU9TWF0aC5mbG9vcihEJUIleiVxKSxGPU1hdGguZmxvb3IoKEQtVSklQiV6L3EpLFA9TWF0aC5mbG9vcigoRC1VLUYqcSklQi96KSxZPU1hdGguZmxvb3IoKEQtVS1GKnEtUCp6KS9CKSxHPVtdO2ZvcihsZXQgTj0wO048ci5sZW5ndGg7TisrKXtpZighY1tOXSljb250aW51ZTtjb25zdCAkPXBbTl07aWYoTWF0aC5hYnMoJC5iaW5YLShVKy41KSk+PWN0fHxNYXRoLmFicygkLmJpblktKEYrLjUpKT49Y3R8fE1hdGguYWJzKCQuYmluU2NhbGUtKFkrLjUpKT49Y3QpY29udGludWU7Y29uc3QgTD1NYXRoLmFicygkLmJpbkFuZ2xlLShQKy41KSk7TWF0aC5taW4oTCxmLUwpPj1jdHx8Ry5wdXNoKHJbTl0pfXJldHVybiBHfSx4dD0oe3F1ZXJ5cG9pbnQ6byxrZXlwb2ludDpuLGtleWNlbnRlclg6ZSxrZXljZW50ZXJZOnQsc2NhbGVPbmVPdmVyTG9nSzpzfSk9PntsZXQgcj1vLmFuZ2xlLW4uYW5nbGU7cjw9LU1hdGguUEk/cis9MipNYXRoLlBJOnI+TWF0aC5QSSYmKHItPTIqTWF0aC5QSSk7Y29uc3QgaT1vLnNjYWxlL24uc2NhbGUsaD1pKk1hdGguY29zKHIpLGw9aSpNYXRoLnNpbihyKSx1PVtoLC1sLGwsaF0sZj1bdVswXSpuLngrdVsxXSpuLnksdVsyXSpuLngrdVszXSpuLnldLGc9by54LWZbMF0sYT1vLnktZlsxXTtyZXR1cm57eDp1WzBdKmUrdVsxXSp0K2cseTp1WzJdKmUrdVszXSp0K2EsYW5nbGU6cixzY2FsZTpNYXRoLmxvZyhpKSpzfX0sQXQ9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZztmdW5jdGlvbiBXKG8pe3JldHVybiBBdC5jYWxsKG8pLmVuZHNXaXRoKCJBcnJheV0iKX1mdW5jdGlvbiB0ZShvKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoPjEmJmFyZ3VtZW50c1sxXSE9PXZvaWQgMD9hcmd1bWVudHNbMV06e307aWYoIVcobykpdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBiZSBhbiBhcnJheSIpO2lmKG8ubGVuZ3RoPT09MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJpbnB1dCBtdXN0IG5vdCBiZSBlbXB0eSIpO3ZhciBlPW4uZnJvbUluZGV4LHQ9ZT09PXZvaWQgMD8wOmUscz1uLnRvSW5kZXgscj1zPT09dm9pZCAwP28ubGVuZ3RoOnM7aWYodDwwfHx0Pj1vLmxlbmd0aHx8IU51bWJlci5pc0ludGVnZXIodCkpdGhyb3cgbmV3IEVycm9yKCJmcm9tSW5kZXggbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIgc21hbGxlciB0aGFuIGxlbmd0aCIpO2lmKHI8PXR8fHI+by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBFcnJvcigidG9JbmRleCBtdXN0IGJlIGFuIGludGVnZXIgZ3JlYXRlciB0aGFuIGZyb21JbmRleCBhbmQgYXQgbW9zdCBlcXVhbCB0byBsZW5ndGgiKTtmb3IodmFyIGk9b1t0XSxoPXQrMTtoPHI7aCsrKW9baF0+aSYmKGk9b1toXSk7cmV0dXJuIGl9ZnVuY3Rpb24gZWUobyl7dmFyIG49YXJndW1lbnRzLmxlbmd0aD4xJiZhcmd1bWVudHNbMV0hPT12b2lkIDA/YXJndW1lbnRzWzFdOnt9O2lmKCFXKG8pKXRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKTt2YXIgZT1uLmZyb21JbmRleCx0PWU9PT12b2lkIDA/MDplLHM9bi50b0luZGV4LHI9cz09PXZvaWQgMD9vLmxlbmd0aDpzO2lmKHQ8MHx8dD49by5sZW5ndGh8fCFOdW1iZXIuaXNJbnRlZ2VyKHQpKXRocm93IG5ldyBFcnJvcigiZnJvbUluZGV4IG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIHNtYWxsZXIgdGhhbiBsZW5ndGgiKTtpZihyPD10fHxyPm8ubGVuZ3RofHwhTnVtYmVyLmlzSW50ZWdlcihyKSl0aHJvdyBuZXcgRXJyb3IoInRvSW5kZXggbXVzdCBiZSBhbiBpbnRlZ2VyIGdyZWF0ZXIgdGhhbiBmcm9tSW5kZXggYW5kIGF0IG1vc3QgZXF1YWwgdG8gbGVuZ3RoIik7Zm9yKHZhciBpPW9bdF0saD10KzE7aDxyO2grKylvW2hdPGkmJihpPW9baF0pO3JldHVybiBpfWZ1bmN0aW9uIHF0KG8pe3ZhciBuPWFyZ3VtZW50cy5sZW5ndGg+MSYmYXJndW1lbnRzWzFdIT09dm9pZCAwP2FyZ3VtZW50c1sxXTp7fTtpZihXKG8pKXtpZihvLmxlbmd0aD09PTApdGhyb3cgbmV3IFR5cGVFcnJvcigiaW5wdXQgbXVzdCBub3QgYmUgZW1wdHkiKX1lbHNlIHRocm93IG5ldyBUeXBlRXJyb3IoImlucHV0IG11c3QgYmUgYW4gYXJyYXkiKTt2YXIgZTtpZihuLm91dHB1dCE9PXZvaWQgMCl7aWYoIVcobi5vdXRwdXQpKXRocm93IG5ldyBUeXBlRXJyb3IoIm91dHB1dCBvcHRpb24gbXVzdCBiZSBhbiBhcnJheSBpZiBzcGVjaWZpZWQiKTtlPW4ub3V0cHV0fWVsc2UgZT1uZXcgQXJyYXkoby5sZW5ndGgpO3ZhciB0PWVlKG8pLHM9dGUobyk7aWYodD09PXMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbmltdW0gYW5kIG1heGltdW0gaW5wdXQgdmFsdWVzIGFyZSBlcXVhbC4gQ2Fubm90IHJlc2NhbGUgYSBjb25zdGFudCBhcnJheSIpO3ZhciByPW4ubWluLGk9cj09PXZvaWQgMD9uLmF1dG9NaW5NYXg/dDowOnIsaD1uLm1heCxsPWg9PT12b2lkIDA/bi5hdXRvTWluTWF4P3M6MTpoO2lmKGk+PWwpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBvcHRpb24gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4IG9wdGlvbiIpO2Zvcih2YXIgdT0obC1pKS8ocy10KSxmPTA7ZjxvLmxlbmd0aDtmKyspZVtmXT0ob1tmXS10KSp1K2k7cmV0dXJuIGV9Y29uc3QgZnQ9IiAiLnJlcGVhdCgyKSxfdD0iICIucmVwZWF0KDQpO2Z1bmN0aW9uIG5lKCl7cmV0dXJuIFR0KHRoaXMpfWZ1bmN0aW9uIFR0KG8sbj17fSl7Y29uc3R7bWF4Um93czplPTE1LG1heENvbHVtbnM6dD0xMCxtYXhOdW1TaXplOnM9OCxwYWRNaW51czpyPSJhdXRvIn09bjtyZXR1cm5gJHtvLmNvbnN0cnVjdG9yLm5hbWV9IHsKJHtmdH1bCiR7X3R9JHtzZShvLGUsdCxzLHIpfQoke2Z0fV0KJHtmdH1yb3dzOiAke28ucm93c30KJHtmdH1jb2x1bW5zOiAke28uY29sdW1uc30KfWB9ZnVuY3Rpb24gc2UobyxuLGUsdCxzKXtjb25zdHtyb3dzOnIsY29sdW1uczppfT1vLGg9TWF0aC5taW4ocixuKSxsPU1hdGgubWluKGksZSksdT1bXTtpZihzPT09ImF1dG8iKXtzPSExO3Q6Zm9yKGxldCBmPTA7ZjxoO2YrKylmb3IobGV0IGc9MDtnPGw7ZysrKWlmKG8uZ2V0KGYsZyk8MCl7cz0hMDticmVhayB0fX1mb3IobGV0IGY9MDtmPGg7ZisrKXtsZXQgZz1bXTtmb3IobGV0IGE9MDthPGw7YSsrKWcucHVzaChvZShvLmdldChmLGEpLHQscykpO3UucHVzaChgJHtnLmpvaW4oIiAiKX1gKX1yZXR1cm4gbCE9PWkmJih1W3UubGVuZ3RoLTFdKz1gIC4uLiAke2ktZX0gbW9yZSBjb2x1bW5zYCksaCE9PXImJnUucHVzaChgLi4uICR7ci1ufSBtb3JlIHJvd3NgKSx1LmpvaW4oYAoke190fWApfWZ1bmN0aW9uIG9lKG8sbixlKXtyZXR1cm4obz49MCYmZT9gICR7enQobyxuLTEpfWA6enQobyxuKSkucGFkRW5kKG4pfWZ1bmN0aW9uIHp0KG8sbil7bGV0IGU9by50b1N0cmluZygpO2lmKGUubGVuZ3RoPD1uKXJldHVybiBlO2xldCB0PW8udG9GaXhlZChuKTtpZih0Lmxlbmd0aD5uJiYodD1vLnRvRml4ZWQoTWF0aC5tYXgoMCxuLSh0Lmxlbmd0aC1uKSkpKSx0Lmxlbmd0aDw9biYmIXQuc3RhcnRzV2l0aCgiMC4wMDAiKSYmIXQuc3RhcnRzV2l0aCgiLTAuMDAwIikpcmV0dXJuIHQ7bGV0IHM9by50b0V4cG9uZW50aWFsKG4pO3JldHVybiBzLmxlbmd0aD5uJiYocz1vLnRvRXhwb25lbnRpYWwoTWF0aC5tYXgoMCxuLShzLmxlbmd0aC1uKSkpKSxzLnNsaWNlKDApfWZ1bmN0aW9uIHJlKG8sbil7by5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5hZGRTKHQpOnRoaXMuYWRkTSh0KX0sby5wcm90b3R5cGUuYWRkUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpK3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5hZGRNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSt0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5hZGQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuYWRkKHMpfSxvLnByb3RvdHlwZS5zdWI9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnN1YlModCk6dGhpcy5zdWJNKHQpfSxvLnByb3RvdHlwZS5zdWJTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciktdCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLnN1Yk09ZnVuY3Rpb24odCl7aWYodD1uLmNoZWNrTWF0cml4KHQpLHRoaXMucm93cyE9PXQucm93c3x8dGhpcy5jb2x1bW5zIT09dC5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJNYXRyaWNlcyBkaW1lbnNpb25zIG11c3QgYmUgZXF1YWwiKTtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpLXQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnN1Yj1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5zdWIocyl9LG8ucHJvdG90eXBlLnN1YnRyYWN0PW8ucHJvdG90eXBlLnN1YixvLnByb3RvdHlwZS5zdWJ0cmFjdFM9by5wcm90b3R5cGUuc3ViUyxvLnByb3RvdHlwZS5zdWJ0cmFjdE09by5wcm90b3R5cGUuc3ViTSxvLnN1YnRyYWN0PW8uc3ViLG8ucHJvdG90eXBlLm11bD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMubXVsUyh0KTp0aGlzLm11bE0odCl9LG8ucHJvdG90eXBlLm11bFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSp0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubXVsTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikqdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ubXVsPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLm11bChzKX0sby5wcm90b3R5cGUubXVsdGlwbHk9by5wcm90b3R5cGUubXVsLG8ucHJvdG90eXBlLm11bHRpcGx5Uz1vLnByb3RvdHlwZS5tdWxTLG8ucHJvdG90eXBlLm11bHRpcGx5TT1vLnByb3RvdHlwZS5tdWxNLG8ubXVsdGlwbHk9by5tdWwsby5wcm90b3R5cGUuZGl2PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5kaXZTKHQpOnRoaXMuZGl2TSh0KX0sby5wcm90b3R5cGUuZGl2Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpL3QpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5kaXZNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKS90LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5kaXY9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuZGl2KHMpfSxvLnByb3RvdHlwZS5kaXZpZGU9by5wcm90b3R5cGUuZGl2LG8ucHJvdG90eXBlLmRpdmlkZVM9by5wcm90b3R5cGUuZGl2UyxvLnByb3RvdHlwZS5kaXZpZGVNPW8ucHJvdG90eXBlLmRpdk0sby5kaXZpZGU9by5kaXYsby5wcm90b3R5cGUubW9kPWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5tb2RTKHQpOnRoaXMubW9kTSh0KX0sby5wcm90b3R5cGUubW9kUz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpJXQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5tb2RNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSV0LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5tb2Q9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkubW9kKHMpfSxvLnByb3RvdHlwZS5tb2R1bHVzPW8ucHJvdG90eXBlLm1vZCxvLnByb3RvdHlwZS5tb2R1bHVzUz1vLnByb3RvdHlwZS5tb2RTLG8ucHJvdG90eXBlLm1vZHVsdXNNPW8ucHJvdG90eXBlLm1vZE0sby5tb2R1bHVzPW8ubW9kLG8ucHJvdG90eXBlLmFuZD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMuYW5kUyh0KTp0aGlzLmFuZE0odCl9LG8ucHJvdG90eXBlLmFuZFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKSZ0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUuYW5kTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscikmdC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8uYW5kPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLmFuZChzKX0sby5wcm90b3R5cGUub3I9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLm9yUyh0KTp0aGlzLm9yTSh0KX0sby5wcm90b3R5cGUub3JTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dCk7cmV0dXJuIHRoaXN9LG8ucHJvdG90eXBlLm9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscil8dC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ub3I9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkub3Iocyl9LG8ucHJvdG90eXBlLnhvcj1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMueG9yUyh0KTp0aGlzLnhvck0odCl9LG8ucHJvdG90eXBlLnhvclM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKV50KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUueG9yTT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMsciledC5nZXQocyxyKSk7cmV0dXJuIHRoaXN9LG8ueG9yPWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnhvcihzKX0sby5wcm90b3R5cGUubGVmdFNoaWZ0PWZ1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdD09Im51bWJlciI/dGhpcy5sZWZ0U2hpZnRTKHQpOnRoaXMubGVmdFNoaWZ0TSh0KX0sby5wcm90b3R5cGUubGVmdFNoaWZ0Uz1mdW5jdGlvbih0KXtmb3IobGV0IHM9MDtzPHRoaXMucm93cztzKyspZm9yKGxldCByPTA7cjx0aGlzLmNvbHVtbnM7cisrKXRoaXMuc2V0KHMscix0aGlzLmdldChzLHIpPDx0KTtyZXR1cm4gdGhpc30sby5wcm90b3R5cGUubGVmdFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik8PHQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLmxlZnRTaGlmdD1mdW5jdGlvbih0LHMpe3JldHVybiBuZXcgbih0KS5sZWZ0U2hpZnQocyl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTKHQpOnRoaXMuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdE0odCl9LG8ucHJvdG90eXBlLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnRTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5zaWduUHJvcGFnYXRpbmdSaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+PnQuZ2V0KHMscikpO3JldHVybiB0aGlzfSxvLnNpZ25Qcm9wYWdhdGluZ1JpZ2h0U2hpZnQ9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkuc2lnblByb3BhZ2F0aW5nUmlnaHRTaGlmdChzKX0sby5wcm90b3R5cGUucmlnaHRTaGlmdD1mdW5jdGlvbih0KXtyZXR1cm4gdHlwZW9mIHQ9PSJudW1iZXIiP3RoaXMucmlnaHRTaGlmdFModCk6dGhpcy5yaWdodFNoaWZ0TSh0KX0sby5wcm90b3R5cGUucmlnaHRTaGlmdFM9ZnVuY3Rpb24odCl7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsdGhpcy5nZXQocyxyKT4+PnQpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5yaWdodFNoaWZ0TT1mdW5jdGlvbih0KXtpZih0PW4uY2hlY2tNYXRyaXgodCksdGhpcy5yb3dzIT09dC5yb3dzfHx0aGlzLmNvbHVtbnMhPT10LmNvbHVtbnMpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIk1hdHJpY2VzIGRpbWVuc2lvbnMgbXVzdCBiZSBlcXVhbCIpO2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLHRoaXMuZ2V0KHMscik+Pj50LmdldChzLHIpKTtyZXR1cm4gdGhpc30sby5yaWdodFNoaWZ0PWZ1bmN0aW9uKHQscyl7cmV0dXJuIG5ldyBuKHQpLnJpZ2h0U2hpZnQocyl9LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdD1vLnByb3RvdHlwZS5yaWdodFNoaWZ0LG8ucHJvdG90eXBlLnplcm9GaWxsUmlnaHRTaGlmdFM9by5wcm90b3R5cGUucmlnaHRTaGlmdFMsby5wcm90b3R5cGUuemVyb0ZpbGxSaWdodFNoaWZ0TT1vLnByb3RvdHlwZS5yaWdodFNoaWZ0TSxvLnplcm9GaWxsUmlnaHRTaGlmdD1vLnJpZ2h0U2hpZnQsby5wcm90b3R5cGUubm90PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsfnRoaXMuZ2V0KHQscykpO3JldHVybiB0aGlzfSxvLm5vdD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubm90KCl9LG8ucHJvdG90eXBlLmFicz1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYWJzKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hYnM9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFicygpfSxvLnByb3RvdHlwZS5hY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hY29zPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hY29zKCl9LG8ucHJvdG90eXBlLmFjb3NoPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5hY29zaCh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYWNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFjb3NoKCl9LG8ucHJvdG90eXBlLmFzaW49ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmFzaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmFzaW4oKX0sby5wcm90b3R5cGUuYXNpbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmFzaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5hc2luaD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXNpbmgoKX0sby5wcm90b3R5cGUuYXRhbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uYXRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuYXRhbigpfSxvLnByb3RvdHlwZS5hdGFuaD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguYXRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmF0YW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5hdGFuaCgpfSxvLnByb3RvdHlwZS5jYnJ0PWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jYnJ0KHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jYnJ0PWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5jYnJ0KCl9LG8ucHJvdG90eXBlLmNlaWw9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNlaWwodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNlaWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNlaWwoKX0sby5wcm90b3R5cGUuY2x6MzI9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNsejMyKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5jbHozMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY2x6MzIoKX0sby5wcm90b3R5cGUuY29zPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5jb3ModGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvcz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuY29zKCl9LG8ucHJvdG90eXBlLmNvc2g9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmNvc2godGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmNvc2g9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmNvc2goKX0sby5wcm90b3R5cGUuZXhwPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHAodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLmV4cD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkuZXhwKCl9LG8ucHJvdG90eXBlLmV4cG0xPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5leHBtMSh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZXhwbTE9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmV4cG0xKCl9LG8ucHJvdG90eXBlLmZsb29yPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5mbG9vcih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8uZmxvb3I9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZsb29yKCl9LG8ucHJvdG90eXBlLmZyb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguZnJvdW5kKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5mcm91bmQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLmZyb3VuZCgpfSxvLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZyh0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5sb2coKX0sby5wcm90b3R5cGUubG9nMXA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzFwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxcD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMXAoKX0sby5wcm90b3R5cGUubG9nMTA9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLmxvZzEwKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5sb2cxMD1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMTAoKX0sby5wcm90b3R5cGUubG9nMj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgubG9nMih0aGlzLmdldCh0LHMpKSk7cmV0dXJuIHRoaXN9LG8ubG9nMj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkubG9nMigpfSxvLnByb3RvdHlwZS5yb3VuZD1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGgucm91bmQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnJvdW5kPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5yb3VuZCgpfSxvLnByb3RvdHlwZS5zaWduPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaWduKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaWduPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaWduKCl9LG8ucHJvdG90eXBlLnNpbj1mdW5jdGlvbigpe2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5zZXQodCxzLE1hdGguc2luKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW49ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNpbigpfSxvLnByb3RvdHlwZS5zaW5oPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC5zaW5oKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby5zaW5oPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgbih0KS5zaW5oKCl9LG8ucHJvdG90eXBlLnNxcnQ9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnNxcnQodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnNxcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnNxcnQoKX0sby5wcm90b3R5cGUudGFuPWZ1bmN0aW9uKCl7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWZvcihsZXQgcz0wO3M8dGhpcy5jb2x1bW5zO3MrKyl0aGlzLnNldCh0LHMsTWF0aC50YW4odGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbj1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudGFuKCl9LG8ucHJvdG90eXBlLnRhbmg9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRhbmgodGhpcy5nZXQodCxzKSkpO3JldHVybiB0aGlzfSxvLnRhbmg9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBuKHQpLnRhbmgoKX0sby5wcm90b3R5cGUudHJ1bmM9ZnVuY3Rpb24oKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuc2V0KHQscyxNYXRoLnRydW5jKHRoaXMuZ2V0KHQscykpKTtyZXR1cm4gdGhpc30sby50cnVuYz1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IG4odCkudHJ1bmMoKX0sby5wb3c9ZnVuY3Rpb24odCxzKXtyZXR1cm4gbmV3IG4odCkucG93KHMpfSxvLnByb3RvdHlwZS5wb3c9ZnVuY3Rpb24odCl7cmV0dXJuIHR5cGVvZiB0PT0ibnVtYmVyIj90aGlzLnBvd1ModCk6dGhpcy5wb3dNKHQpfSxvLnByb3RvdHlwZS5wb3dTPWZ1bmN0aW9uKHQpe2ZvcihsZXQgcz0wO3M8dGhpcy5yb3dzO3MrKylmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspdGhpcy5zZXQocyxyLE1hdGgucG93KHRoaXMuZ2V0KHMsciksdCkpO3JldHVybiB0aGlzfSxvLnByb3RvdHlwZS5wb3dNPWZ1bmN0aW9uKHQpe2lmKHQ9bi5jaGVja01hdHJpeCh0KSx0aGlzLnJvd3MhPT10LnJvd3N8fHRoaXMuY29sdW1ucyE9PXQuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiTWF0cmljZXMgZGltZW5zaW9ucyBtdXN0IGJlIGVxdWFsIik7Zm9yKGxldCBzPTA7czx0aGlzLnJvd3M7cysrKWZvcihsZXQgcj0wO3I8dGhpcy5jb2x1bW5zO3IrKyl0aGlzLnNldChzLHIsTWF0aC5wb3codGhpcy5nZXQocyxyKSx0LmdldChzLHIpKSk7cmV0dXJuIHRoaXN9fWZ1bmN0aW9uIFEobyxuLGUpe2xldCB0PWU/by5yb3dzOm8ucm93cy0xO2lmKG48MHx8bj50KXRocm93IG5ldyBSYW5nZUVycm9yKCJSb3cgaW5kZXggb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gWihvLG4sZSl7bGV0IHQ9ZT9vLmNvbHVtbnM6by5jb2x1bW5zLTE7aWYobjwwfHxuPnQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIkNvbHVtbiBpbmRleCBvdXQgb2YgcmFuZ2UiKX1mdW5jdGlvbiB0dChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8uY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIGNvbHVtbnMiKTtyZXR1cm4gbn1mdW5jdGlvbiBldChvLG4pe2lmKG4udG8xREFycmF5JiYobj1uLnRvMURBcnJheSgpKSxuLmxlbmd0aCE9PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9yIHNpemUgbXVzdCBiZSB0aGUgc2FtZSBhcyB0aGUgbnVtYmVyIG9mIHJvd3MiKTtyZXR1cm4gbn1mdW5jdGlvbiBpZShvLG4pe2lmKCFXKG4pKXRocm93IG5ldyBUeXBlRXJyb3IoInJvdyBpbmRpY2VzIG11c3QgYmUgYW4gYXJyYXkiKTtmb3IobGV0IGU9MDtlPG4ubGVuZ3RoO2UrKylpZihuW2VdPDB8fG5bZV0+PW8ucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigicm93IGluZGljZXMgYXJlIG91dCBvZiByYW5nZSIpfWZ1bmN0aW9uIGxlKG8sbil7aWYoIVcobikpdGhyb3cgbmV3IFR5cGVFcnJvcigiY29sdW1uIGluZGljZXMgbXVzdCBiZSBhbiBhcnJheSIpO2ZvcihsZXQgZT0wO2U8bi5sZW5ndGg7ZSsrKWlmKG5bZV08MHx8bltlXT49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJjb2x1bW4gaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gRnQobyxuLGUsdCxzKXtpZihhcmd1bWVudHMubGVuZ3RoIT09NSl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiZXhwZWN0ZWQgNCBhcmd1bWVudHMiKTtpZihhdCgic3RhcnRSb3ciLG4pLGF0KCJlbmRSb3ciLGUpLGF0KCJzdGFydENvbHVtbiIsdCksYXQoImVuZENvbHVtbiIscyksbj5lfHx0PnN8fG48MHx8bj49by5yb3dzfHxlPDB8fGU+PW8ucm93c3x8dDwwfHx0Pj1vLmNvbHVtbnN8fHM8MHx8cz49by5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKCJTdWJtYXRyaXggaW5kaWNlcyBhcmUgb3V0IG9mIHJhbmdlIil9ZnVuY3Rpb24gZ3QobyxuPTApe2xldCBlPVtdO2ZvcihsZXQgdD0wO3Q8bzt0KyspZS5wdXNoKG4pO3JldHVybiBlfWZ1bmN0aW9uIGF0KG8sbil7aWYodHlwZW9mIG4hPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoYCR7b30gbXVzdCBiZSBhIG51bWJlcmApfWZ1bmN0aW9uIG50KG8pe2lmKG8uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiRW1wdHkgbWF0cml4IGhhcyBubyBlbGVtZW50cyB0byBpbmRleCIpfWZ1bmN0aW9uIGhlKG8pe2xldCBuPWd0KG8ucm93cyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW2VdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIHVlKG8pe2xldCBuPWd0KG8uY29sdW1ucyk7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7KytlKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zOysrdCluW3RdKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGNlKG8pe2xldCBuPTA7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKyluKz1vLmdldChlLHQpO3JldHVybiBufWZ1bmN0aW9uIGZlKG8pe2xldCBuPWd0KG8ucm93cywxKTtmb3IobGV0IGU9MDtlPG8ucm93czsrK2UpZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7Kyt0KW5bZV0qPW8uZ2V0KGUsdCk7cmV0dXJuIG59ZnVuY3Rpb24gZ2Uobyl7bGV0IG49Z3Qoby5jb2x1bW5zLDEpO2ZvcihsZXQgZT0wO2U8by5yb3dzOysrZSlmb3IobGV0IHQ9MDt0PG8uY29sdW1uczsrK3Qpblt0XSo9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBhZShvKXtsZXQgbj0xO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspbio9by5nZXQoZSx0KTtyZXR1cm4gbn1mdW5jdGlvbiBtZShvLG4sZSl7Y29uc3QgdD1vLnJvd3Mscz1vLmNvbHVtbnMscj1bXTtmb3IobGV0IGk9MDtpPHQ7aSsrKXtsZXQgaD0wLGw9MCx1PTA7Zm9yKGxldCBmPTA7ZjxzO2YrKyl1PW8uZ2V0KGksZiktZVtpXSxoKz11LGwrPXUqdTtuP3IucHVzaCgobC1oKmgvcykvKHMtMSkpOnIucHVzaCgobC1oKmgvcykvcyl9cmV0dXJuIHJ9ZnVuY3Rpb24gd2UobyxuLGUpe2NvbnN0IHQ9by5yb3dzLHM9by5jb2x1bW5zLHI9W107Zm9yKGxldCBpPTA7aTxzO2krKyl7bGV0IGg9MCxsPTAsdT0wO2ZvcihsZXQgZj0wO2Y8dDtmKyspdT1vLmdldChmLGkpLWVbaV0saCs9dSxsKz11KnU7bj9yLnB1c2goKGwtaCpoL3QpLyh0LTEpKTpyLnB1c2goKGwtaCpoL3QpL3QpfXJldHVybiByfWZ1bmN0aW9uIHBlKG8sbixlKXtjb25zdCB0PW8ucm93cyxzPW8uY29sdW1ucyxyPXQqcztsZXQgaT0wLGg9MCxsPTA7Zm9yKGxldCB1PTA7dTx0O3UrKylmb3IobGV0IGY9MDtmPHM7ZisrKWw9by5nZXQodSxmKS1lLGkrPWwsaCs9bCpsO3JldHVybiBuPyhoLWkqaS9yKS8oci0xKTooaC1pKmkvcikvcn1mdW5jdGlvbiBkZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCktbltlXSl9ZnVuY3Rpb24geWUobyxuKXtmb3IobGV0IGU9MDtlPG8ucm93cztlKyspZm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKW8uc2V0KGUsdCxvLmdldChlLHQpLW5bdF0pfWZ1bmN0aW9uIE1lKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS1uKX1mdW5jdGlvbiBFZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8uY29sdW1ucztzKyspdCs9TWF0aC5wb3coby5nZXQoZSxzKSwyKS8oby5jb2x1bW5zLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIFNlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW2VdKX1mdW5jdGlvbiBqZShvKXtjb25zdCBuPVtdO2ZvcihsZXQgZT0wO2U8by5jb2x1bW5zO2UrKyl7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPG8ucm93cztzKyspdCs9TWF0aC5wb3coby5nZXQocyxlKSwyKS8oby5yb3dzLTEpO24ucHVzaChNYXRoLnNxcnQodCkpfXJldHVybiBufWZ1bmN0aW9uIGtlKG8sbil7Zm9yKGxldCBlPTA7ZTxvLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8by5jb2x1bW5zO3QrKylvLnNldChlLHQsby5nZXQoZSx0KS9uW3RdKX1mdW5jdGlvbiBiZShvKXtjb25zdCBuPW8uc2l6ZS0xO2xldCBlPTA7Zm9yKGxldCB0PTA7dDxvLmNvbHVtbnM7dCsrKWZvcihsZXQgcz0wO3M8by5yb3dzO3MrKyllKz1NYXRoLnBvdyhvLmdldChzLHQpLDIpL247cmV0dXJuIE1hdGguc3FydChlKX1mdW5jdGlvbiBJZShvLG4pe2ZvcihsZXQgZT0wO2U8by5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PG8uY29sdW1uczt0Kyspby5zZXQoZSx0LG8uZ2V0KGUsdCkvbil9Y2xhc3MgX3tzdGF0aWMgZnJvbTFEQXJyYXkobixlLHQpe2lmKG4qZSE9PXQubGVuZ3RoKXRocm93IG5ldyBSYW5nZUVycm9yKCJkYXRhIGxlbmd0aCBkb2VzIG5vdCBtYXRjaCBnaXZlbiBkaW1lbnNpb25zIik7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHRbaSplK2hdKTtyZXR1cm4gcn1zdGF0aWMgcm93VmVjdG9yKG4pe2xldCBlPW5ldyBiKDEsbi5sZW5ndGgpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KDAsdCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgY29sdW1uVmVjdG9yKG4pe2xldCBlPW5ldyBiKG4ubGVuZ3RoLDEpO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWUuc2V0KHQsMCxuW3RdKTtyZXR1cm4gZX1zdGF0aWMgemVyb3MobixlKXtyZXR1cm4gbmV3IGIobixlKX1zdGF0aWMgb25lcyhuLGUpe3JldHVybiBuZXcgYihuLGUpLmZpbGwoMSl9c3RhdGljIHJhbmQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7cmFuZG9tOnM9TWF0aC5yYW5kb219PXQ7bGV0IHI9bmV3IGIobixlKTtmb3IobGV0IGk9MDtpPG47aSsrKWZvcihsZXQgaD0wO2g8ZTtoKyspci5zZXQoaSxoLHMoKSk7cmV0dXJuIHJ9c3RhdGljIHJhbmRJbnQobixlLHQ9e30pe2lmKHR5cGVvZiB0IT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7bWluOnM9MCxtYXg6cj0xZTMscmFuZG9tOmk9TWF0aC5yYW5kb219PXQ7aWYoIU51bWJlci5pc0ludGVnZXIocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWluIG11c3QgYmUgYW4gaW50ZWdlciIpO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKHIpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1heCBtdXN0IGJlIGFuIGludGVnZXIiKTtpZihzPj1yKXRocm93IG5ldyBSYW5nZUVycm9yKCJtaW4gbXVzdCBiZSBzbWFsbGVyIHRoYW4gbWF4Iik7bGV0IGg9ci1zLGw9bmV3IGIobixlKTtmb3IobGV0IHU9MDt1PG47dSsrKWZvcihsZXQgZj0wO2Y8ZTtmKyspe2xldCBnPXMrTWF0aC5yb3VuZChpKCkqaCk7bC5zZXQodSxmLGcpfXJldHVybiBsfXN0YXRpYyBleWUobixlLHQpe2U9PT12b2lkIDAmJihlPW4pLHQ9PT12b2lkIDAmJih0PTEpO2xldCBzPU1hdGgubWluKG4sZSkscj10aGlzLnplcm9zKG4sZSk7Zm9yKGxldCBpPTA7aTxzO2krKylyLnNldChpLGksdCk7cmV0dXJuIHJ9c3RhdGljIGRpYWcobixlLHQpe2xldCBzPW4ubGVuZ3RoO2U9PT12b2lkIDAmJihlPXMpLHQ9PT12b2lkIDAmJih0PWUpO2xldCByPU1hdGgubWluKHMsZSx0KSxpPXRoaXMuemVyb3MoZSx0KTtmb3IobGV0IGg9MDtoPHI7aCsrKWkuc2V0KGgsaCxuW2hdKTtyZXR1cm4gaX1zdGF0aWMgbWluKG4sZSl7bj10aGlzLmNoZWNrTWF0cml4KG4pLGU9dGhpcy5jaGVja01hdHJpeChlKTtsZXQgdD1uLnJvd3Mscz1uLmNvbHVtbnMscj1uZXcgYih0LHMpO2ZvcihsZXQgaT0wO2k8dDtpKyspZm9yKGxldCBoPTA7aDxzO2grKylyLnNldChpLGgsTWF0aC5taW4obi5nZXQoaSxoKSxlLmdldChpLGgpKSk7cmV0dXJuIHJ9c3RhdGljIG1heChuLGUpe249dGhpcy5jaGVja01hdHJpeChuKSxlPXRoaXMuY2hlY2tNYXRyaXgoZSk7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IHRoaXModCxzKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgaD0wO2g8cztoKyspci5zZXQoaSxoLE1hdGgubWF4KG4uZ2V0KGksaCksZS5nZXQoaSxoKSkpO3JldHVybiByfXN0YXRpYyBjaGVja01hdHJpeChuKXtyZXR1cm4gXy5pc01hdHJpeChuKT9uOm5ldyBiKG4pfXN0YXRpYyBpc01hdHJpeChuKXtyZXR1cm4gbiE9bnVsbCYmbi5rbGFzcz09PSJNYXRyaXgifWdldCBzaXplKCl7cmV0dXJuIHRoaXMucm93cyp0aGlzLmNvbHVtbnN9YXBwbHkobil7aWYodHlwZW9mIG4hPSJmdW5jdGlvbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigiY2FsbGJhY2sgbXVzdCBiZSBhIGZ1bmN0aW9uIik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyluLmNhbGwodGhpcyxlLHQpO3JldHVybiB0aGlzfXRvMURBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5wdXNoKHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXRvMkRBcnJheSgpe2xldCBuPVtdO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKyl7bi5wdXNoKFtdKTtmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspbltlXS5wdXNoKHRoaXMuZ2V0KGUsdCkpfXJldHVybiBufXRvSlNPTigpe3JldHVybiB0aGlzLnRvMkRBcnJheSgpfWlzUm93VmVjdG9yKCl7cmV0dXJuIHRoaXMucm93cz09PTF9aXNDb2x1bW5WZWN0b3IoKXtyZXR1cm4gdGhpcy5jb2x1bW5zPT09MX1pc1ZlY3Rvcigpe3JldHVybiB0aGlzLnJvd3M9PT0xfHx0aGlzLmNvbHVtbnM9PT0xfWlzU3F1YXJlKCl7cmV0dXJuIHRoaXMucm93cz09PXRoaXMuY29sdW1uc31pc0VtcHR5KCl7cmV0dXJuIHRoaXMucm93cz09PTB8fHRoaXMuY29sdW1ucz09PTB9aXNTeW1tZXRyaWMoKXtpZih0aGlzLmlzU3F1YXJlKCkpe2ZvcihsZXQgbj0wO248dGhpcy5yb3dzO24rKylmb3IobGV0IGU9MDtlPD1uO2UrKylpZih0aGlzLmdldChuLGUpIT09dGhpcy5nZXQoZSxuKSlyZXR1cm4hMTtyZXR1cm4hMH1yZXR1cm4hMX1pc0VjaGVsb25Gb3JtKCl7bGV0IG49MCxlPTAsdD0tMSxzPSEwLHI9ITE7Zm9yKDtuPHRoaXMucm93cyYmczspe2ZvcihlPTAscj0hMTtlPHRoaXMuY29sdW1ucyYmcj09PSExOyl0aGlzLmdldChuLGUpPT09MD9lKys6dGhpcy5nZXQobixlKT09PTEmJmU+dD8ocj0hMCx0PWUpOihzPSExLHI9ITApO24rK31yZXR1cm4gc31pc1JlZHVjZWRFY2hlbG9uRm9ybSgpe2xldCBuPTAsZT0wLHQ9LTEscz0hMCxyPSExO2Zvcig7bjx0aGlzLnJvd3MmJnM7KXtmb3IoZT0wLHI9ITE7ZTx0aGlzLmNvbHVtbnMmJnI9PT0hMTspdGhpcy5nZXQobixlKT09PTA/ZSsrOnRoaXMuZ2V0KG4sZSk9PT0xJiZlPnQ/KHI9ITAsdD1lKToocz0hMSxyPSEwKTtmb3IobGV0IGk9ZSsxO2k8dGhpcy5yb3dzO2krKyl0aGlzLmdldChuLGkpIT09MCYmKHM9ITEpO24rK31yZXR1cm4gc31lY2hlbG9uRm9ybSgpe2xldCBuPXRoaXMuY2xvbmUoKSxlPTAsdD0wO2Zvcig7ZTxuLnJvd3MmJnQ8bi5jb2x1bW5zOyl7bGV0IHM9ZTtmb3IobGV0IHI9ZTtyPG4ucm93cztyKyspbi5nZXQocix0KT5uLmdldChzLHQpJiYocz1yKTtpZihuLmdldChzLHQpPT09MCl0Kys7ZWxzZXtuLnN3YXBSb3dzKGUscyk7bGV0IHI9bi5nZXQoZSx0KTtmb3IobGV0IGk9dDtpPG4uY29sdW1ucztpKyspbi5zZXQoZSxpLG4uZ2V0KGUsaSkvcik7Zm9yKGxldCBpPWUrMTtpPG4ucm93cztpKyspe2xldCBoPW4uZ2V0KGksdCkvbi5nZXQoZSx0KTtuLnNldChpLHQsMCk7Zm9yKGxldCBsPXQrMTtsPG4uY29sdW1ucztsKyspbi5zZXQoaSxsLG4uZ2V0KGksbCktbi5nZXQoZSxsKSpoKX1lKyssdCsrfX1yZXR1cm4gbn1yZWR1Y2VkRWNoZWxvbkZvcm0oKXtsZXQgbj10aGlzLmVjaGVsb25Gb3JtKCksZT1uLmNvbHVtbnMsdD1uLnJvd3Mscz10LTE7Zm9yKDtzPj0wOylpZihuLm1heFJvdyhzKT09PTApcy0tO2Vsc2V7bGV0IHI9MCxpPSExO2Zvcig7cjx0JiZpPT09ITE7KW4uZ2V0KHMscik9PT0xP2k9ITA6cisrO2ZvcihsZXQgaD0wO2g8cztoKyspe2xldCBsPW4uZ2V0KGgscik7Zm9yKGxldCB1PXI7dTxlO3UrKyl7bGV0IGY9bi5nZXQoaCx1KS1sKm4uZ2V0KHMsdSk7bi5zZXQoaCx1LGYpfX1zLS19cmV0dXJuIG59c2V0KCl7dGhyb3cgbmV3IEVycm9yKCJzZXQgbWV0aG9kIGlzIHVuaW1wbGVtZW50ZWQiKX1nZXQoKXt0aHJvdyBuZXcgRXJyb3IoImdldCBtZXRob2QgaXMgdW5pbXBsZW1lbnRlZCIpfXJlcGVhdChuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e3Jvd3M6ZT0xLGNvbHVtbnM6dD0xfT1uO2lmKCFOdW1iZXIuaXNJbnRlZ2VyKGUpfHxlPD0wKXRocm93IG5ldyBUeXBlRXJyb3IoInJvd3MgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIiKTtpZighTnVtYmVyLmlzSW50ZWdlcih0KXx8dDw9MCl0aHJvdyBuZXcgVHlwZUVycm9yKCJjb2x1bW5zIG11c3QgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyIik7bGV0IHM9bmV3IGIodGhpcy5yb3dzKmUsdGhpcy5jb2x1bW5zKnQpO2ZvcihsZXQgcj0wO3I8ZTtyKyspZm9yKGxldCBpPTA7aTx0O2krKylzLnNldFN1Yk1hdHJpeCh0aGlzLHRoaXMucm93cypyLHRoaXMuY29sdW1ucyppKTtyZXR1cm4gc31maWxsKG4pe2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LG4pO3JldHVybiB0aGlzfW5lZygpe3JldHVybiB0aGlzLm11bFMoLTEpfWdldFJvdyhuKXtRKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKWUucHVzaCh0aGlzLmdldChuLHQpKTtyZXR1cm4gZX1nZXRSb3dWZWN0b3Iobil7cmV0dXJuIGIucm93VmVjdG9yKHRoaXMuZ2V0Um93KG4pKX1zZXRSb3cobixlKXtRKHRoaXMsbiksZT10dCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsZVt0XSk7cmV0dXJuIHRoaXN9c3dhcFJvd3MobixlKXtRKHRoaXMsbiksUSh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl7bGV0IHM9dGhpcy5nZXQobix0KTt0aGlzLnNldChuLHQsdGhpcy5nZXQoZSx0KSksdGhpcy5zZXQoZSx0LHMpfXJldHVybiB0aGlzfWdldENvbHVtbihuKXtaKHRoaXMsbik7bGV0IGU9W107Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKWUucHVzaCh0aGlzLmdldCh0LG4pKTtyZXR1cm4gZX1nZXRDb2x1bW5WZWN0b3Iobil7cmV0dXJuIGIuY29sdW1uVmVjdG9yKHRoaXMuZ2V0Q29sdW1uKG4pKX1zZXRDb2x1bW4obixlKXtaKHRoaXMsbiksZT1ldCh0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLnNldCh0LG4sZVt0XSk7cmV0dXJuIHRoaXN9c3dhcENvbHVtbnMobixlKXtaKHRoaXMsbiksWih0aGlzLGUpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxuKTt0aGlzLnNldCh0LG4sdGhpcy5nZXQodCxlKSksdGhpcy5zZXQodCxlLHMpfXJldHVybiB0aGlzfWFkZFJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KStuW3RdKTtyZXR1cm4gdGhpc31zdWJSb3dWZWN0b3Iobil7bj10dCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCktblt0XSk7cmV0dXJuIHRoaXN9bXVsUm93VmVjdG9yKG4pe249dHQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpKm5bdF0pO3JldHVybiB0aGlzfWRpdlJvd1ZlY3RvcihuKXtuPXR0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KS9uW3RdKTtyZXR1cm4gdGhpc31hZGRDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkrbltlXSk7cmV0dXJuIHRoaXN9c3ViQ29sdW1uVmVjdG9yKG4pe249ZXQodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKXRoaXMuc2V0KGUsdCx0aGlzLmdldChlLHQpLW5bZV0pO3JldHVybiB0aGlzfW11bENvbHVtblZlY3RvcihuKXtuPWV0KHRoaXMsbik7Zm9yKGxldCBlPTA7ZTx0aGlzLnJvd3M7ZSsrKWZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChlLHQsdGhpcy5nZXQoZSx0KSpuW2VdKTtyZXR1cm4gdGhpc31kaXZDb2x1bW5WZWN0b3Iobil7bj1ldCh0aGlzLG4pO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspdGhpcy5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkvbltlXSk7cmV0dXJuIHRoaXN9bXVsUm93KG4sZSl7USh0aGlzLG4pO2ZvcihsZXQgdD0wO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLnNldChuLHQsdGhpcy5nZXQobix0KSplKTtyZXR1cm4gdGhpc31tdWxDb2x1bW4obixlKXtaKHRoaXMsbik7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXRoaXMuc2V0KHQsbix0aGlzLmdldCh0LG4pKmUpO3JldHVybiB0aGlzfW1heChuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5lW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk+ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1heEluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKT5uJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1pbihuKXtpZih0aGlzLmlzRW1wdHkoKSlyZXR1cm4gTmFOO3N3aXRjaChuKXtjYXNlInJvdyI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMucm93cykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3RdJiYoZVt0XT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlImNvbHVtbiI6e2NvbnN0IGU9bmV3IEFycmF5KHRoaXMuY29sdW1ucykuZmlsbChOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxlW3NdJiYoZVtzXT10aGlzLmdldCh0LHMpKTtyZXR1cm4gZX1jYXNlIHZvaWQgMDp7bGV0IGU9dGhpcy5nZXQoMCwwKTtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KHQscyk8ZSYmKGU9dGhpcy5nZXQodCxzKSk7cmV0dXJuIGV9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fW1pbkluZGV4KCl7bnQodGhpcyk7bGV0IG49dGhpcy5nZXQoMCwwKSxlPVswLDBdO2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKylmb3IobGV0IHM9MDtzPHRoaXMuY29sdW1ucztzKyspdGhpcy5nZXQodCxzKTxuJiYobj10aGlzLmdldCh0LHMpLGVbMF09dCxlWzFdPXMpO3JldHVybiBlfW1heFJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPmUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1heFJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk+ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1pblJvdyhuKXtpZihRKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldChuLDApO2ZvcihsZXQgdD0xO3Q8dGhpcy5jb2x1bW5zO3QrKyl0aGlzLmdldChuLHQpPGUmJihlPXRoaXMuZ2V0KG4sdCkpO3JldHVybiBlfW1pblJvd0luZGV4KG4pe1EodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldChuLDApLHQ9W24sMF07Zm9yKGxldCBzPTE7czx0aGlzLmNvbHVtbnM7cysrKXRoaXMuZ2V0KG4scyk8ZSYmKGU9dGhpcy5nZXQobixzKSx0WzFdPXMpO3JldHVybiB0fW1heENvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPmUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1heENvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik+ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fW1pbkNvbHVtbihuKXtpZihaKHRoaXMsbiksdGhpcy5pc0VtcHR5KCkpcmV0dXJuIE5hTjtsZXQgZT10aGlzLmdldCgwLG4pO2ZvcihsZXQgdD0xO3Q8dGhpcy5yb3dzO3QrKyl0aGlzLmdldCh0LG4pPGUmJihlPXRoaXMuZ2V0KHQsbikpO3JldHVybiBlfW1pbkNvbHVtbkluZGV4KG4pe1oodGhpcyxuKSxudCh0aGlzKTtsZXQgZT10aGlzLmdldCgwLG4pLHQ9WzAsbl07Zm9yKGxldCBzPTE7czx0aGlzLnJvd3M7cysrKXRoaXMuZ2V0KHMsbik8ZSYmKGU9dGhpcy5nZXQocyxuKSx0WzBdPXMpO3JldHVybiB0fWRpYWcoKXtsZXQgbj1NYXRoLm1pbih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKSxlPVtdO2ZvcihsZXQgdD0wO3Q8bjt0KyspZS5wdXNoKHRoaXMuZ2V0KHQsdCkpO3JldHVybiBlfW5vcm0obj0iZnJvYmVuaXVzIil7bGV0IGU9MDtpZihuPT09Im1heCIpcmV0dXJuIHRoaXMubWF4KCk7aWYobj09PSJmcm9iZW5pdXMiKXtmb3IobGV0IHQ9MDt0PHRoaXMucm93czt0KyspZm9yKGxldCBzPTA7czx0aGlzLmNvbHVtbnM7cysrKWU9ZSt0aGlzLmdldCh0LHMpKnRoaXMuZ2V0KHQscyk7cmV0dXJuIE1hdGguc3FydChlKX1lbHNlIHRocm93IG5ldyBSYW5nZUVycm9yKGB1bmtub3duIG5vcm0gdHlwZTogJHtufWApfWN1bXVsYXRpdmVTdW0oKXtsZXQgbj0wO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbis9dGhpcy5nZXQoZSx0KSx0aGlzLnNldChlLHQsbik7cmV0dXJuIHRoaXN9ZG90KG4pe18uaXNNYXRyaXgobikmJihuPW4udG8xREFycmF5KCkpO2xldCBlPXRoaXMudG8xREFycmF5KCk7aWYoZS5sZW5ndGghPT1uLmxlbmd0aCl0aHJvdyBuZXcgUmFuZ2VFcnJvcigidmVjdG9ycyBkbyBub3QgaGF2ZSB0aGUgc2FtZSBzaXplIik7bGV0IHQ9MDtmb3IobGV0IHM9MDtzPGUubGVuZ3RoO3MrKyl0Kz1lW3NdKm5bc107cmV0dXJuIHR9bW11bChuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5yb3dzLHQ9dGhpcy5jb2x1bW5zLHM9bi5jb2x1bW5zLHI9bmV3IGIoZSxzKSxpPW5ldyBGbG9hdDY0QXJyYXkodCk7Zm9yKGxldCBoPTA7aDxzO2grKyl7Zm9yKGxldCBsPTA7bDx0O2wrKylpW2xdPW4uZ2V0KGwsaCk7Zm9yKGxldCBsPTA7bDxlO2wrKyl7bGV0IHU9MDtmb3IobGV0IGY9MDtmPHQ7ZisrKXUrPXRoaXMuZ2V0KGwsZikqaVtmXTtyLnNldChsLGgsdSl9fXJldHVybiByfXN0cmFzc2VuMngyKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigyLDIpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPW4uZ2V0KDAsMCkscj10aGlzLmdldCgwLDEpLGk9bi5nZXQoMCwxKSxoPXRoaXMuZ2V0KDEsMCksbD1uLmdldCgxLDApLHU9dGhpcy5nZXQoMSwxKSxmPW4uZ2V0KDEsMSksZz0odCt1KSoocytmKSxhPShoK3UpKnMsaj10KihpLWYpLHc9dSoobC1zKSx5PSh0K3IpKmYsbT0oaC10KSoocytpKSxNPShyLXUpKihsK2YpLFQ9Zyt3LXkrTSxFPWoreSxrPWErdyxSPWctYStqK207cmV0dXJuIGUuc2V0KDAsMCxUKSxlLnNldCgwLDEsRSksZS5zZXQoMSwwLGspLGUuc2V0KDEsMSxSKSxlfXN0cmFzc2VuM3gzKG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT1uZXcgYigzLDMpO2NvbnN0IHQ9dGhpcy5nZXQoMCwwKSxzPXRoaXMuZ2V0KDAsMSkscj10aGlzLmdldCgwLDIpLGk9dGhpcy5nZXQoMSwwKSxoPXRoaXMuZ2V0KDEsMSksbD10aGlzLmdldCgxLDIpLHU9dGhpcy5nZXQoMiwwKSxmPXRoaXMuZ2V0KDIsMSksZz10aGlzLmdldCgyLDIpLGE9bi5nZXQoMCwwKSxqPW4uZ2V0KDAsMSksdz1uLmdldCgwLDIpLHk9bi5nZXQoMSwwKSxtPW4uZ2V0KDEsMSksTT1uLmdldCgxLDIpLFQ9bi5nZXQoMiwwKSxFPW4uZ2V0KDIsMSksaz1uLmdldCgyLDIpLFI9KHQrcytyLWktaC1mLWcpKm0scT0odC1pKSooLWorbSksST1oKigtYStqK3ktbS1NLVQrayksej0oLXQraStoKSooYS1qK20pLEI9KGkraCkqKC1hK2opLGM9dCphLHA9KC10K3UrZikqKGEtdytNKSxTPSgtdCt1KSoody1NKSxkPSh1K2YpKigtYSt3KSxEPSh0K3Mrci1oLWwtdS1mKSpNLFU9ZiooLWErdyt5LW0tTS1UK0UpLEY9KC1yK2YrZykqKG0rVC1FKSxQPShyLWcpKihtLUUpLFk9cipULEc9KGYrZykqKC1UK0UpLE49KC1yK2grbCkqKE0rVC1rKSwkPShyLWwpKihNLWspLEs9KGgrbCkqKC1UK2spLHY9cyp5LFY9bCpFLEw9aSp3LEM9dSpqLFg9ZyprLHd0PWMrWSt2LHB0PVIreitCK2MrRitZK0csZHQ9YytwK2QrRCtZK04rSyxpdD1xK0kreitjK1krTiskLGx0PXEreitCK2MrVixodD1ZK04rJCtLK0wsanQ9YytwK1MrVStGK1ArWSx1dD1GK1ArWStHK0Msa3Q9YytwK1MrZCtYO3JldHVybiBlLnNldCgwLDAsd3QpLGUuc2V0KDAsMSxwdCksZS5zZXQoMCwyLGR0KSxlLnNldCgxLDAsaXQpLGUuc2V0KDEsMSxsdCksZS5zZXQoMSwyLGh0KSxlLnNldCgyLDAsanQpLGUuc2V0KDIsMSx1dCksZS5zZXQoMiwyLGt0KSxlfW1tdWxTdHJhc3NlbihuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5jbG9uZSgpLHQ9ZS5yb3dzLHM9ZS5jb2x1bW5zLHI9bi5yb3dzLGk9bi5jb2x1bW5zO3MhPT1yJiZjb25zb2xlLndhcm4oYE11bHRpcGx5aW5nICR7dH0geCAke3N9IGFuZCAke3J9IHggJHtpfSBtYXRyaXg6IGRpbWVuc2lvbnMgZG8gbm90IG1hdGNoLmApO2Z1bmN0aW9uIGgoZyxhLGope2xldCB3PWcucm93cyx5PWcuY29sdW1ucztpZih3PT09YSYmeT09PWopcmV0dXJuIGc7e2xldCBtPV8uemVyb3MoYSxqKTtyZXR1cm4gbT1tLnNldFN1Yk1hdHJpeChnLDAsMCksbX19bGV0IGw9TWF0aC5tYXgodCxyKSx1PU1hdGgubWF4KHMsaSk7ZT1oKGUsbCx1KSxuPWgobixsLHUpO2Z1bmN0aW9uIGYoZyxhLGosdyl7aWYoajw9NTEyfHx3PD01MTIpcmV0dXJuIGcubW11bChhKTtqJTI9PT0xJiZ3JTI9PT0xPyhnPWgoZyxqKzEsdysxKSxhPWgoYSxqKzEsdysxKSk6aiUyPT09MT8oZz1oKGcsaisxLHcpLGE9aChhLGorMSx3KSk6dyUyPT09MSYmKGc9aChnLGosdysxKSxhPWgoYSxqLHcrMSkpO2xldCB5PXBhcnNlSW50KGcucm93cy8yLDEwKSxtPXBhcnNlSW50KGcuY29sdW1ucy8yLDEwKSxNPWcuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxUPWEuc3ViTWF0cml4KDAseS0xLDAsbS0xKSxFPWcuc3ViTWF0cml4KDAseS0xLG0sZy5jb2x1bW5zLTEpLGs9YS5zdWJNYXRyaXgoMCx5LTEsbSxhLmNvbHVtbnMtMSksUj1nLnN1Yk1hdHJpeCh5LGcucm93cy0xLDAsbS0xKSxxPWEuc3ViTWF0cml4KHksYS5yb3dzLTEsMCxtLTEpLEk9Zy5zdWJNYXRyaXgoeSxnLnJvd3MtMSxtLGcuY29sdW1ucy0xKSx6PWEuc3ViTWF0cml4KHksYS5yb3dzLTEsbSxhLmNvbHVtbnMtMSksQj1mKF8uYWRkKE0sSSksXy5hZGQoVCx6KSx5LG0pLGM9ZihfLmFkZChSLEkpLFQseSxtKSxwPWYoTSxfLnN1YihrLHopLHksbSksUz1mKEksXy5zdWIocSxUKSx5LG0pLGQ9ZihfLmFkZChNLEUpLHoseSxtKSxEPWYoXy5zdWIoUixNKSxfLmFkZChULGspLHksbSksVT1mKF8uc3ViKEUsSSksXy5hZGQocSx6KSx5LG0pLEY9Xy5hZGQoQixTKTtGLnN1YihkKSxGLmFkZChVKTtsZXQgUD1fLmFkZChwLGQpLFk9Xy5hZGQoYyxTKSxHPV8uc3ViKEIsYyk7Ry5hZGQocCksRy5hZGQoRCk7bGV0IE49Xy56ZXJvcygyKkYucm93cywyKkYuY29sdW1ucyk7cmV0dXJuIE49Ti5zZXRTdWJNYXRyaXgoRiwwLDApLE49Ti5zZXRTdWJNYXRyaXgoUCxGLnJvd3MsMCksTj1OLnNldFN1Yk1hdHJpeChZLDAsRi5jb2x1bW5zKSxOPU4uc2V0U3ViTWF0cml4KEcsRi5yb3dzLEYuY29sdW1ucyksTi5zdWJNYXRyaXgoMCxqLTEsMCx3LTEpfXJldHVybiBmKGUsbixsLHUpfXNjYWxlUm93cyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMucm93cztyKyspe2NvbnN0IGk9dGhpcy5nZXRSb3cocik7aS5sZW5ndGg+MCYmcXQoaSx7bWluOmUsbWF4OnQsb3V0cHV0Oml9KSxzLnNldFJvdyhyLGkpfXJldHVybiBzfXNjYWxlQ29sdW1ucyhuPXt9KXtpZih0eXBlb2YgbiE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e21pbjplPTAsbWF4OnQ9MX09bjtpZighTnVtYmVyLmlzRmluaXRlKGUpKXRocm93IG5ldyBUeXBlRXJyb3IoIm1pbiBtdXN0IGJlIGEgbnVtYmVyIik7aWYoIU51bWJlci5pc0Zpbml0ZSh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtYXggbXVzdCBiZSBhIG51bWJlciIpO2lmKGU+PXQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoIm1pbiBtdXN0IGJlIHNtYWxsZXIgdGhhbiBtYXgiKTtsZXQgcz1uZXcgYih0aGlzLnJvd3MsdGhpcy5jb2x1bW5zKTtmb3IobGV0IHI9MDtyPHRoaXMuY29sdW1ucztyKyspe2NvbnN0IGk9dGhpcy5nZXRDb2x1bW4ocik7aS5sZW5ndGgmJnF0KGkse21pbjplLG1heDp0LG91dHB1dDppfSkscy5zZXRDb2x1bW4ocixpKX1yZXR1cm4gc31mbGlwUm93cygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMuY29sdW1ucy8yKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQoZSx0KSxyPXRoaXMuZ2V0KGUsdGhpcy5jb2x1bW5zLTEtdCk7dGhpcy5zZXQoZSx0LHIpLHRoaXMuc2V0KGUsdGhpcy5jb2x1bW5zLTEtdCxzKX1yZXR1cm4gdGhpc31mbGlwQ29sdW1ucygpe2NvbnN0IG49TWF0aC5jZWlsKHRoaXMucm93cy8yKTtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspZm9yKGxldCB0PTA7dDxuO3QrKyl7bGV0IHM9dGhpcy5nZXQodCxlKSxyPXRoaXMuZ2V0KHRoaXMucm93cy0xLXQsZSk7dGhpcy5zZXQodCxlLHIpLHRoaXMuc2V0KHRoaXMucm93cy0xLXQsZSxzKX1yZXR1cm4gdGhpc31rcm9uZWNrZXJQcm9kdWN0KG4pe249Yi5jaGVja01hdHJpeChuKTtsZXQgZT10aGlzLnJvd3MsdD10aGlzLmNvbHVtbnMscz1uLnJvd3Mscj1uLmNvbHVtbnMsaT1uZXcgYihlKnMsdCpyKTtmb3IobGV0IGg9MDtoPGU7aCsrKWZvcihsZXQgbD0wO2w8dDtsKyspZm9yKGxldCB1PTA7dTxzO3UrKylmb3IobGV0IGY9MDtmPHI7ZisrKWkuc2V0KHMqaCt1LHIqbCtmLHRoaXMuZ2V0KGgsbCkqbi5nZXQodSxmKSk7cmV0dXJuIGl9a3JvbmVja2VyU3VtKG4pe2lmKG49Yi5jaGVja01hdHJpeChuKSwhdGhpcy5pc1NxdWFyZSgpfHwhbi5pc1NxdWFyZSgpKXRocm93IG5ldyBFcnJvcigiS3JvbmVja2VyIFN1bSBuZWVkcyB0d28gU3F1YXJlIE1hdHJpY2VzIik7bGV0IGU9dGhpcy5yb3dzLHQ9bi5yb3dzLHM9dGhpcy5rcm9uZWNrZXJQcm9kdWN0KGIuZXllKHQsdCkpLHI9Yi5leWUoZSxlKS5rcm9uZWNrZXJQcm9kdWN0KG4pO3JldHVybiBzLmFkZChyKX10cmFuc3Bvc2UoKXtsZXQgbj1uZXcgYih0aGlzLmNvbHVtbnMsdGhpcy5yb3dzKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspZm9yKGxldCB0PTA7dDx0aGlzLmNvbHVtbnM7dCsrKW4uc2V0KHQsZSx0aGlzLmdldChlLHQpKTtyZXR1cm4gbn1zb3J0Um93cyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspdGhpcy5zZXRSb3coZSx0aGlzLmdldFJvdyhlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zb3J0Q29sdW1ucyhuPVB0KXtmb3IobGV0IGU9MDtlPHRoaXMuY29sdW1ucztlKyspdGhpcy5zZXRDb2x1bW4oZSx0aGlzLmdldENvbHVtbihlKS5zb3J0KG4pKTtyZXR1cm4gdGhpc31zdWJNYXRyaXgobixlLHQscyl7RnQodGhpcyxuLGUsdCxzKTtsZXQgcj1uZXcgYihlLW4rMSxzLXQrMSk7Zm9yKGxldCBpPW47aTw9ZTtpKyspZm9yKGxldCBoPXQ7aDw9cztoKyspci5zZXQoaS1uLGgtdCx0aGlzLmdldChpLGgpKTtyZXR1cm4gcn1zdWJNYXRyaXhSb3cobixlLHQpe2lmKGU9PT12b2lkIDAmJihlPTApLHQ9PT12b2lkIDAmJih0PXRoaXMuY29sdW1ucy0xKSxlPnR8fGU8MHx8ZT49dGhpcy5jb2x1bW5zfHx0PDB8fHQ+PXRoaXMuY29sdW1ucyl0aHJvdyBuZXcgUmFuZ2VFcnJvcigiQXJndW1lbnQgb3V0IG9mIHJhbmdlIik7bGV0IHM9bmV3IGIobi5sZW5ndGgsdC1lKzEpO2ZvcihsZXQgcj0wO3I8bi5sZW5ndGg7cisrKWZvcihsZXQgaT1lO2k8PXQ7aSsrKXtpZihuW3JdPDB8fG5bcl0+PXRoaXMucm93cyl0aHJvdyBuZXcgUmFuZ2VFcnJvcihgUm93IGluZGV4IG91dCBvZiByYW5nZTogJHtuW3JdfWApO3Muc2V0KHIsaS1lLHRoaXMuZ2V0KG5bcl0saSkpfXJldHVybiBzfXN1Yk1hdHJpeENvbHVtbihuLGUsdCl7aWYoZT09PXZvaWQgMCYmKGU9MCksdD09PXZvaWQgMCYmKHQ9dGhpcy5yb3dzLTEpLGU+dHx8ZTwwfHxlPj10aGlzLnJvd3N8fHQ8MHx8dD49dGhpcy5yb3dzKXRocm93IG5ldyBSYW5nZUVycm9yKCJBcmd1bWVudCBvdXQgb2YgcmFuZ2UiKTtsZXQgcz1uZXcgYih0LWUrMSxuLmxlbmd0aCk7Zm9yKGxldCByPTA7cjxuLmxlbmd0aDtyKyspZm9yKGxldCBpPWU7aTw9dDtpKyspe2lmKG5bcl08MHx8bltyXT49dGhpcy5jb2x1bW5zKXRocm93IG5ldyBSYW5nZUVycm9yKGBDb2x1bW4gaW5kZXggb3V0IG9mIHJhbmdlOiAke25bcl19YCk7cy5zZXQoaS1lLHIsdGhpcy5nZXQoaSxuW3JdKSl9cmV0dXJuIHN9c2V0U3ViTWF0cml4KG4sZSx0KXtpZihuPWIuY2hlY2tNYXRyaXgobiksbi5pc0VtcHR5KCkpcmV0dXJuIHRoaXM7bGV0IHM9ZStuLnJvd3MtMSxyPXQrbi5jb2x1bW5zLTE7RnQodGhpcyxlLHMsdCxyKTtmb3IobGV0IGk9MDtpPG4ucm93cztpKyspZm9yKGxldCBoPTA7aDxuLmNvbHVtbnM7aCsrKXRoaXMuc2V0KGUraSx0K2gsbi5nZXQoaSxoKSk7cmV0dXJuIHRoaXN9c2VsZWN0aW9uKG4sZSl7aWUodGhpcyxuKSxsZSh0aGlzLGUpO2xldCB0PW5ldyBiKG4ubGVuZ3RoLGUubGVuZ3RoKTtmb3IobGV0IHM9MDtzPG4ubGVuZ3RoO3MrKyl7bGV0IHI9bltzXTtmb3IobGV0IGk9MDtpPGUubGVuZ3RoO2krKyl7bGV0IGg9ZVtpXTt0LnNldChzLGksdGhpcy5nZXQocixoKSl9fXJldHVybiB0fXRyYWNlKCl7bGV0IG49TWF0aC5taW4odGhpcy5yb3dzLHRoaXMuY29sdW1ucyksZT0wO2ZvcihsZXQgdD0wO3Q8bjt0KyspZSs9dGhpcy5nZXQodCx0KTtyZXR1cm4gZX1jbG9uZSgpe2xldCBuPW5ldyBiKHRoaXMucm93cyx0aGlzLmNvbHVtbnMpO2ZvcihsZXQgZT0wO2U8dGhpcy5yb3dzO2UrKylmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0Kyspbi5zZXQoZSx0LHRoaXMuZ2V0KGUsdCkpO3JldHVybiBufXN1bShuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBoZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIHVlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBjZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19cHJvZHVjdChuKXtzd2l0Y2gobil7Y2FzZSJyb3ciOnJldHVybiBmZSh0aGlzKTtjYXNlImNvbHVtbiI6cmV0dXJuIGdlKHRoaXMpO2Nhc2Ugdm9pZCAwOnJldHVybiBhZSh0aGlzKTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19bWVhbihuKXtjb25zdCBlPXRoaXMuc3VtKG4pO3N3aXRjaChuKXtjYXNlInJvdyI6e2ZvcihsZXQgdD0wO3Q8dGhpcy5yb3dzO3QrKyllW3RdLz10aGlzLmNvbHVtbnM7cmV0dXJuIGV9Y2FzZSJjb2x1bW4iOntmb3IobGV0IHQ9MDt0PHRoaXMuY29sdW1uczt0KyspZVt0XS89dGhpcy5yb3dzO3JldHVybiBlfWNhc2Ugdm9pZCAwOnJldHVybiBlL3RoaXMuc2l6ZTtkZWZhdWx0OnRocm93IG5ldyBFcnJvcihgaW52YWxpZCBvcHRpb246ICR7bn1gKX19dmFyaWFuY2UobixlPXt9KXtpZih0eXBlb2Ygbj09Im9iamVjdCImJihlPW4sbj12b2lkIDApLHR5cGVvZiBlIT0ib2JqZWN0Iil0aHJvdyBuZXcgVHlwZUVycm9yKCJvcHRpb25zIG11c3QgYmUgYW4gb2JqZWN0Iik7Y29uc3R7dW5iaWFzZWQ6dD0hMCxtZWFuOnM9dGhpcy5tZWFuKG4pfT1lO2lmKHR5cGVvZiB0IT0iYm9vbGVhbiIpdGhyb3cgbmV3IFR5cGVFcnJvcigidW5iaWFzZWQgbXVzdCBiZSBhIGJvb2xlYW4iKTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyhzKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJtZWFuIG11c3QgYmUgYW4gYXJyYXkiKTtyZXR1cm4gbWUodGhpcyx0LHMpfWNhc2UiY29sdW1uIjp7aWYoIVcocykpdGhyb3cgbmV3IFR5cGVFcnJvcigibWVhbiBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIHdlKHRoaXMsdCxzKX1jYXNlIHZvaWQgMDp7aWYodHlwZW9mIHMhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIm1lYW4gbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBwZSh0aGlzLHQscyl9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXN0YW5kYXJkRGV2aWF0aW9uKG4sZSl7dHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKTtjb25zdCB0PXRoaXMudmFyaWFuY2UobixlKTtpZihuPT09dm9pZCAwKXJldHVybiBNYXRoLnNxcnQodCk7Zm9yKGxldCBzPTA7czx0Lmxlbmd0aDtzKyspdFtzXT1NYXRoLnNxcnQodFtzXSk7cmV0dXJuIHR9Y2VudGVyKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2NvbnN0e2NlbnRlcjp0PXRoaXMubWVhbihuKX09ZTtzd2l0Y2gobil7Y2FzZSJyb3ciOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBkZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiB5ZSh0aGlzLHQpLHRoaXN9Y2FzZSB2b2lkIDA6e2lmKHR5cGVvZiB0IT0ibnVtYmVyIil0aHJvdyBuZXcgVHlwZUVycm9yKCJjZW50ZXIgbXVzdCBiZSBhIG51bWJlciIpO3JldHVybiBNZSh0aGlzLHQpLHRoaXN9ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgb3B0aW9uOiAke259YCl9fXNjYWxlKG4sZT17fSl7aWYodHlwZW9mIG49PSJvYmplY3QiJiYoZT1uLG49dm9pZCAwKSx0eXBlb2YgZSE9Im9iamVjdCIpdGhyb3cgbmV3IFR5cGVFcnJvcigib3B0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCIpO2xldCB0PWUuc2NhbGU7c3dpdGNoKG4pe2Nhc2Uicm93Ijp7aWYodD09PXZvaWQgMCl0PUVlKHRoaXMpO2Vsc2UgaWYoIVcodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigic2NhbGUgbXVzdCBiZSBhbiBhcnJheSIpO3JldHVybiBTZSh0aGlzLHQpLHRoaXN9Y2FzZSJjb2x1bW4iOntpZih0PT09dm9pZCAwKXQ9amUodGhpcyk7ZWxzZSBpZighVyh0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJzY2FsZSBtdXN0IGJlIGFuIGFycmF5Iik7cmV0dXJuIGtlKHRoaXMsdCksdGhpc31jYXNlIHZvaWQgMDp7aWYodD09PXZvaWQgMCl0PWJlKHRoaXMpO2Vsc2UgaWYodHlwZW9mIHQhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoInNjYWxlIG11c3QgYmUgYSBudW1iZXIiKTtyZXR1cm4gSWUodGhpcyx0KSx0aGlzfWRlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIG9wdGlvbjogJHtufWApfX10b1N0cmluZyhuKXtyZXR1cm4gVHQodGhpcyxuKX19Xy5wcm90b3R5cGUua2xhc3M9Ik1hdHJpeCIsdHlwZW9mIFN5bWJvbDwidSImJihfLnByb3RvdHlwZVtTeW1ib2wuZm9yKCJub2RlanMudXRpbC5pbnNwZWN0LmN1c3RvbSIpXT1uZSk7ZnVuY3Rpb24gUHQobyxuKXtyZXR1cm4gby1ufWZ1bmN0aW9uIFJlKG8pe3JldHVybiBvLmV2ZXJ5KG49PnR5cGVvZiBuPT0ibnVtYmVyIil9Xy5yYW5kb209Xy5yYW5kLF8ucmFuZG9tSW50PV8ucmFuZEludCxfLmRpYWdvbmFsPV8uZGlhZyxfLnByb3RvdHlwZS5kaWFnb25hbD1fLnByb3RvdHlwZS5kaWFnLF8uaWRlbnRpdHk9Xy5leWUsXy5wcm90b3R5cGUubmVnYXRlPV8ucHJvdG90eXBlLm5lZyxfLnByb3RvdHlwZS50ZW5zb3JQcm9kdWN0PV8ucHJvdG90eXBlLmtyb25lY2tlclByb2R1Y3Q7Y2xhc3MgYiBleHRlbmRzIF97Y29uc3RydWN0b3IobixlKXtpZihzdXBlcigpLGIuaXNNYXRyaXgobikpcmV0dXJuIG4uY2xvbmUoKTtpZihOdW1iZXIuaXNJbnRlZ2VyKG4pJiZuPj0wKWlmKHRoaXMuZGF0YT1bXSxOdW1iZXIuaXNJbnRlZ2VyKGUpJiZlPj0wKWZvcihsZXQgdD0wO3Q8bjt0KyspdGhpcy5kYXRhLnB1c2gobmV3IEZsb2F0NjRBcnJheShlKSk7ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJuQ29sdW1ucyBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlciIpO2Vsc2UgaWYoVyhuKSl7Y29uc3QgdD1uO2lmKG49dC5sZW5ndGgsZT1uP3RbMF0ubGVuZ3RoOjAsdHlwZW9mIGUhPSJudW1iZXIiKXRocm93IG5ldyBUeXBlRXJyb3IoIkRhdGEgbXVzdCBiZSBhIDJEIGFycmF5IHdpdGggYXQgbGVhc3Qgb25lIGVsZW1lbnQiKTt0aGlzLmRhdGE9W107Zm9yKGxldCBzPTA7czxuO3MrKyl7aWYodFtzXS5sZW5ndGghPT1lKXRocm93IG5ldyBSYW5nZUVycm9yKCJJbmNvbnNpc3RlbnQgYXJyYXkgZGltZW5zaW9ucyIpO2lmKCFSZSh0W3NdKSl0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnB1dCBkYXRhIGNvbnRhaW5zIG5vbi1udW1lcmljIHZhbHVlcyIpO3RoaXMuZGF0YS5wdXNoKEZsb2F0NjRBcnJheS5mcm9tKHRbc10pKX19ZWxzZSB0aHJvdyBuZXcgVHlwZUVycm9yKCJGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgbnVtYmVyIG9yIGFuIGFycmF5Iik7dGhpcy5yb3dzPW4sdGhpcy5jb2x1bW5zPWV9c2V0KG4sZSx0KXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdPXQsdGhpc31nZXQobixlKXtyZXR1cm4gdGhpcy5kYXRhW25dW2VdfXJlbW92ZVJvdyhuKXtyZXR1cm4gUSh0aGlzLG4pLHRoaXMuZGF0YS5zcGxpY2UobiwxKSx0aGlzLnJvd3MtPTEsdGhpc31hZGRSb3cobixlKXtyZXR1cm4gZT09PXZvaWQgMCYmKGU9bixuPXRoaXMucm93cyksUSh0aGlzLG4sITApLGU9RmxvYXQ2NEFycmF5LmZyb20odHQodGhpcyxlKSksdGhpcy5kYXRhLnNwbGljZShuLDAsZSksdGhpcy5yb3dzKz0xLHRoaXN9cmVtb3ZlQ29sdW1uKG4pe1oodGhpcyxuKTtmb3IobGV0IGU9MDtlPHRoaXMucm93cztlKyspe2NvbnN0IHQ9bmV3IEZsb2F0NjRBcnJheSh0aGlzLmNvbHVtbnMtMSk7Zm9yKGxldCBzPTA7czxuO3MrKyl0W3NdPXRoaXMuZGF0YVtlXVtzXTtmb3IobGV0IHM9bisxO3M8dGhpcy5jb2x1bW5zO3MrKyl0W3MtMV09dGhpcy5kYXRhW2VdW3NdO3RoaXMuZGF0YVtlXT10fXJldHVybiB0aGlzLmNvbHVtbnMtPTEsdGhpc31hZGRDb2x1bW4obixlKXt0eXBlb2YgZT4idSImJihlPW4sbj10aGlzLmNvbHVtbnMpLFoodGhpcyxuLCEwKSxlPWV0KHRoaXMsZSk7Zm9yKGxldCB0PTA7dDx0aGlzLnJvd3M7dCsrKXtjb25zdCBzPW5ldyBGbG9hdDY0QXJyYXkodGhpcy5jb2x1bW5zKzEpO2xldCByPTA7Zm9yKDtyPG47cisrKXNbcl09dGhpcy5kYXRhW3RdW3JdO2ZvcihzW3IrK109ZVt0XTtyPHRoaXMuY29sdW1ucysxO3IrKylzW3JdPXRoaXMuZGF0YVt0XVtyLTFdO3RoaXMuZGF0YVt0XT1zfXJldHVybiB0aGlzLmNvbHVtbnMrPTEsdGhpc319cmUoXyxiKTtjbGFzcyBzdCBleHRlbmRzIF97Y29uc3RydWN0b3Iobil7c3VwZXIoKSx0aGlzLmRhdGE9bix0aGlzLnJvd3M9bi5sZW5ndGgsdGhpcy5jb2x1bW5zPW5bMF0ubGVuZ3RofXNldChuLGUsdCl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXT10LHRoaXN9Z2V0KG4sZSl7cmV0dXJuIHRoaXMuZGF0YVtuXVtlXX19Y2xhc3MgTmV7Y29uc3RydWN0b3Iobil7bj1zdC5jaGVja01hdHJpeChuKTtsZXQgZT1uLmNsb25lKCksdD1lLnJvd3Mscz1lLmNvbHVtbnMscj1uZXcgRmxvYXQ2NEFycmF5KHQpLGk9MSxoLGwsdSxmLGcsYSxqLHcseTtmb3IoaD0wO2g8dDtoKyspcltoXT1oO2Zvcih3PW5ldyBGbG9hdDY0QXJyYXkodCksbD0wO2w8cztsKyspe2ZvcihoPTA7aDx0O2grKyl3W2hdPWUuZ2V0KGgsbCk7Zm9yKGg9MDtoPHQ7aCsrKXtmb3IoeT1NYXRoLm1pbihoLGwpLGc9MCx1PTA7dTx5O3UrKylnKz1lLmdldChoLHUpKndbdV07d1toXS09ZyxlLnNldChoLGwsd1toXSl9Zm9yKGY9bCxoPWwrMTtoPHQ7aCsrKU1hdGguYWJzKHdbaF0pPk1hdGguYWJzKHdbZl0pJiYoZj1oKTtpZihmIT09bCl7Zm9yKHU9MDt1PHM7dSsrKWE9ZS5nZXQoZix1KSxlLnNldChmLHUsZS5nZXQobCx1KSksZS5zZXQobCx1LGEpO2o9cltmXSxyW2ZdPXJbbF0scltsXT1qLGk9LWl9aWYobDx0JiZlLmdldChsLGwpIT09MClmb3IoaD1sKzE7aDx0O2grKyllLnNldChoLGwsZS5nZXQoaCxsKS9lLmdldChsLGwpKX10aGlzLkxVPWUsdGhpcy5waXZvdFZlY3Rvcj1yLHRoaXMucGl2b3RTaWduPWl9aXNTaW5ndWxhcigpe2xldCBuPXRoaXMuTFUsZT1uLmNvbHVtbnM7Zm9yKGxldCB0PTA7dDxlO3QrKylpZihuLmdldCh0LHQpPT09MClyZXR1cm4hMDtyZXR1cm4hMX1zb2x2ZShuKXtuPWIuY2hlY2tNYXRyaXgobik7bGV0IGU9dGhpcy5MVTtpZihlLnJvd3MhPT1uLnJvd3MpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIG1hdHJpeCBkaW1lbnNpb25zIik7aWYodGhpcy5pc1Npbmd1bGFyKCkpdGhyb3cgbmV3IEVycm9yKCJMVSBtYXRyaXggaXMgc2luZ3VsYXIiKTtsZXQgcz1uLmNvbHVtbnMscj1uLnN1Yk1hdHJpeFJvdyh0aGlzLnBpdm90VmVjdG9yLDAscy0xKSxpPWUuY29sdW1ucyxoLGwsdTtmb3IodT0wO3U8aTt1KyspZm9yKGg9dSsxO2g8aTtoKyspZm9yKGw9MDtsPHM7bCsrKXIuc2V0KGgsbCxyLmdldChoLGwpLXIuZ2V0KHUsbCkqZS5nZXQoaCx1KSk7Zm9yKHU9aS0xO3U+PTA7dS0tKXtmb3IobD0wO2w8cztsKyspci5zZXQodSxsLHIuZ2V0KHUsbCkvZS5nZXQodSx1KSk7Zm9yKGg9MDtoPHU7aCsrKWZvcihsPTA7bDxzO2wrKylyLnNldChoLGwsci5nZXQoaCxsKS1yLmdldCh1LGwpKmUuZ2V0KGgsdSkpfXJldHVybiByfWdldCBkZXRlcm1pbmFudCgpe2xldCBuPXRoaXMuTFU7aWYoIW4uaXNTcXVhcmUoKSl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCBtdXN0IGJlIHNxdWFyZSIpO2xldCBlPXRoaXMucGl2b3RTaWduLHQ9bi5jb2x1bW5zO2ZvcihsZXQgcz0wO3M8dDtzKyspZSo9bi5nZXQocyxzKTtyZXR1cm4gZX1nZXQgbG93ZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI+aT9zLnNldChyLGksbi5nZXQocixpKSk6cj09PWk/cy5zZXQocixpLDEpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5MVSxlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCk7Zm9yKGxldCByPTA7cjxlO3IrKylmb3IobGV0IGk9MDtpPHQ7aSsrKXI8PWk/cy5zZXQocixpLG4uZ2V0KHIsaSkpOnMuc2V0KHIsaSwwKTtyZXR1cm4gc31nZXQgcGl2b3RQZXJtdXRhdGlvblZlY3Rvcigpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucGl2b3RWZWN0b3IpfX1mdW5jdGlvbiB4KG8sbil7bGV0IGU9MDtyZXR1cm4gTWF0aC5hYnMobyk+TWF0aC5hYnMobik/KGU9bi9vLE1hdGguYWJzKG8pKk1hdGguc3FydCgxK2UqZSkpOm4hPT0wPyhlPW8vbixNYXRoLmFicyhuKSpNYXRoLnNxcnQoMStlKmUpKTowfWNsYXNzIHZle2NvbnN0cnVjdG9yKG4pe249c3QuY2hlY2tNYXRyaXgobik7bGV0IGU9bi5jbG9uZSgpLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IEZsb2F0NjRBcnJheShzKSxpLGgsbCx1O2ZvcihsPTA7bDxzO2wrKyl7bGV0IGY9MDtmb3IoaT1sO2k8dDtpKyspZj14KGYsZS5nZXQoaSxsKSk7aWYoZiE9PTApe2ZvcihlLmdldChsLGwpPDAmJihmPS1mKSxpPWw7aTx0O2krKyllLnNldChpLGwsZS5nZXQoaSxsKS9mKTtmb3IoZS5zZXQobCxsLGUuZ2V0KGwsbCkrMSksaD1sKzE7aDxzO2grKyl7Zm9yKHU9MCxpPWw7aTx0O2krKyl1Kz1lLmdldChpLGwpKmUuZ2V0KGksaCk7Zm9yKHU9LXUvZS5nZXQobCxsKSxpPWw7aTx0O2krKyllLnNldChpLGgsZS5nZXQoaSxoKSt1KmUuZ2V0KGksbCkpfX1yW2xdPS1mfXRoaXMuUVI9ZSx0aGlzLlJkaWFnPXJ9c29sdmUobil7bj1iLmNoZWNrTWF0cml4KG4pO2xldCBlPXRoaXMuUVIsdD1lLnJvd3M7aWYobi5yb3dzIT09dCl0aHJvdyBuZXcgRXJyb3IoIk1hdHJpeCByb3cgZGltZW5zaW9ucyBtdXN0IGFncmVlIik7aWYoIXRoaXMuaXNGdWxsUmFuaygpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IGlzIHJhbmsgZGVmaWNpZW50Iik7bGV0IHM9bi5jb2x1bW5zLHI9bi5jbG9uZSgpLGk9ZS5jb2x1bW5zLGgsbCx1LGY7Zm9yKHU9MDt1PGk7dSsrKWZvcihsPTA7bDxzO2wrKyl7Zm9yKGY9MCxoPXU7aDx0O2grKylmKz1lLmdldChoLHUpKnIuZ2V0KGgsbCk7Zm9yKGY9LWYvZS5nZXQodSx1KSxoPXU7aDx0O2grKylyLnNldChoLGwsci5nZXQoaCxsKStmKmUuZ2V0KGgsdSkpfWZvcih1PWktMTt1Pj0wO3UtLSl7Zm9yKGw9MDtsPHM7bCsrKXIuc2V0KHUsbCxyLmdldCh1LGwpL3RoaXMuUmRpYWdbdV0pO2ZvcihoPTA7aDx1O2grKylmb3IobD0wO2w8cztsKyspci5zZXQoaCxsLHIuZ2V0KGgsbCktci5nZXQodSxsKSplLmdldChoLHUpKX1yZXR1cm4gci5zdWJNYXRyaXgoMCxpLTEsMCxzLTEpfWlzRnVsbFJhbmsoKXtsZXQgbj10aGlzLlFSLmNvbHVtbnM7Zm9yKGxldCBlPTA7ZTxuO2UrKylpZih0aGlzLlJkaWFnW2VdPT09MClyZXR1cm4hMTtyZXR1cm4hMH1nZXQgdXBwZXJUcmlhbmd1bGFyTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4uY29sdW1ucyx0PW5ldyBiKGUsZSkscyxyO2ZvcihzPTA7czxlO3MrKylmb3Iocj0wO3I8ZTtyKyspczxyP3Quc2V0KHMscixuLmdldChzLHIpKTpzPT09cj90LnNldChzLHIsdGhpcy5SZGlhZ1tzXSk6dC5zZXQocyxyLDApO3JldHVybiB0fWdldCBvcnRob2dvbmFsTWF0cml4KCl7bGV0IG49dGhpcy5RUixlPW4ucm93cyx0PW4uY29sdW1ucyxzPW5ldyBiKGUsdCkscixpLGgsbDtmb3IoaD10LTE7aD49MDtoLS0pe2ZvcihyPTA7cjxlO3IrKylzLnNldChyLGgsMCk7Zm9yKHMuc2V0KGgsaCwxKSxpPWg7aTx0O2krKylpZihuLmdldChoLGgpIT09MCl7Zm9yKGw9MCxyPWg7cjxlO3IrKylsKz1uLmdldChyLGgpKnMuZ2V0KHIsaSk7Zm9yKGw9LWwvbi5nZXQoaCxoKSxyPWg7cjxlO3IrKylzLnNldChyLGkscy5nZXQocixpKStsKm4uZ2V0KHIsaCkpfX1yZXR1cm4gc319Y2xhc3MgRHR7Y29uc3RydWN0b3IobixlPXt9KXtpZihuPXN0LmNoZWNrTWF0cml4KG4pLG4uaXNFbXB0eSgpKXRocm93IG5ldyBFcnJvcigiTWF0cml4IG11c3QgYmUgbm9uLWVtcHR5Iik7bGV0IHQ9bi5yb3dzLHM9bi5jb2x1bW5zO2NvbnN0e2NvbXB1dGVMZWZ0U2luZ3VsYXJWZWN0b3JzOnI9ITAsY29tcHV0ZVJpZ2h0U2luZ3VsYXJWZWN0b3JzOmk9ITAsYXV0b1RyYW5zcG9zZTpoPSExfT1lO2xldCBsPSEhcix1PSEhaSxmPSExLGc7aWYodDxzKWlmKCFoKWc9bi5jbG9uZSgpLGNvbnNvbGUud2FybigiQ29tcHV0aW5nIFNWRCBvbiBhIG1hdHJpeCB3aXRoIG1vcmUgY29sdW1ucyB0aGFuIHJvd3MuIENvbnNpZGVyIGVuYWJsaW5nIGF1dG9UcmFuc3Bvc2UiKTtlbHNle2c9bi50cmFuc3Bvc2UoKSx0PWcucm93cyxzPWcuY29sdW1ucyxmPSEwO2xldCBjPWw7bD11LHU9Y31lbHNlIGc9bi5jbG9uZSgpO2xldCBhPU1hdGgubWluKHQscyksaj1NYXRoLm1pbih0KzEscyksdz1uZXcgRmxvYXQ2NEFycmF5KGopLHk9bmV3IGIodCxhKSxtPW5ldyBiKHMscyksTT1uZXcgRmxvYXQ2NEFycmF5KHMpLFQ9bmV3IEZsb2F0NjRBcnJheSh0KSxFPW5ldyBGbG9hdDY0QXJyYXkoaik7Zm9yKGxldCBjPTA7YzxqO2MrKylFW2NdPWM7bGV0IGs9TWF0aC5taW4odC0xLHMpLFI9TWF0aC5tYXgoMCxNYXRoLm1pbihzLTIsdCkpLHE9TWF0aC5tYXgoayxSKTtmb3IobGV0IGM9MDtjPHE7YysrKXtpZihjPGspe3dbY109MDtmb3IobGV0IHA9YztwPHQ7cCsrKXdbY109eCh3W2NdLGcuZ2V0KHAsYykpO2lmKHdbY10hPT0wKXtnLmdldChjLGMpPDAmJih3W2NdPS13W2NdKTtmb3IobGV0IHA9YztwPHQ7cCsrKWcuc2V0KHAsYyxnLmdldChwLGMpL3dbY10pO2cuc2V0KGMsYyxnLmdldChjLGMpKzEpfXdbY109LXdbY119Zm9yKGxldCBwPWMrMTtwPHM7cCsrKXtpZihjPGsmJndbY10hPT0wKXtsZXQgUz0wO2ZvcihsZXQgZD1jO2Q8dDtkKyspUys9Zy5nZXQoZCxjKSpnLmdldChkLHApO1M9LVMvZy5nZXQoYyxjKTtmb3IobGV0IGQ9YztkPHQ7ZCsrKWcuc2V0KGQscCxnLmdldChkLHApK1MqZy5nZXQoZCxjKSl9TVtwXT1nLmdldChjLHApfWlmKGwmJmM8aylmb3IobGV0IHA9YztwPHQ7cCsrKXkuc2V0KHAsYyxnLmdldChwLGMpKTtpZihjPFIpe01bY109MDtmb3IobGV0IHA9YysxO3A8cztwKyspTVtjXT14KE1bY10sTVtwXSk7aWYoTVtjXSE9PTApe01bYysxXTwwJiYoTVtjXT0wLU1bY10pO2ZvcihsZXQgcD1jKzE7cDxzO3ArKylNW3BdLz1NW2NdO01bYysxXSs9MX1pZihNW2NdPS1NW2NdLGMrMTx0JiZNW2NdIT09MCl7Zm9yKGxldCBwPWMrMTtwPHQ7cCsrKVRbcF09MDtmb3IobGV0IHA9YysxO3A8dDtwKyspZm9yKGxldCBTPWMrMTtTPHM7UysrKVRbcF0rPU1bU10qZy5nZXQocCxTKTtmb3IobGV0IHA9YysxO3A8cztwKyspe2xldCBTPS1NW3BdL01bYysxXTtmb3IobGV0IGQ9YysxO2Q8dDtkKyspZy5zZXQoZCxwLGcuZ2V0KGQscCkrUypUW2RdKX19aWYodSlmb3IobGV0IHA9YysxO3A8cztwKyspbS5zZXQocCxjLE1bcF0pfX1sZXQgST1NYXRoLm1pbihzLHQrMSk7aWYoazxzJiYod1trXT1nLmdldChrLGspKSx0PEkmJih3W0ktMV09MCksUisxPEkmJihNW1JdPWcuZ2V0KFIsSS0xKSksTVtJLTFdPTAsbCl7Zm9yKGxldCBjPWs7YzxhO2MrKyl7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfWZvcihsZXQgYz1rLTE7Yz49MDtjLS0paWYod1tjXSE9PTApe2ZvcihsZXQgcD1jKzE7cDxhO3ArKyl7bGV0IFM9MDtmb3IobGV0IGQ9YztkPHQ7ZCsrKVMrPXkuZ2V0KGQsYykqeS5nZXQoZCxwKTtTPS1TL3kuZ2V0KGMsYyk7Zm9yKGxldCBkPWM7ZDx0O2QrKyl5LnNldChkLHAseS5nZXQoZCxwKStTKnkuZ2V0KGQsYykpfWZvcihsZXQgcD1jO3A8dDtwKyspeS5zZXQocCxjLC15LmdldChwLGMpKTt5LnNldChjLGMsMSt5LmdldChjLGMpKTtmb3IobGV0IHA9MDtwPGMtMTtwKyspeS5zZXQocCxjLDApfWVsc2V7Zm9yKGxldCBwPTA7cDx0O3ArKyl5LnNldChwLGMsMCk7eS5zZXQoYyxjLDEpfX1pZih1KWZvcihsZXQgYz1zLTE7Yz49MDtjLS0pe2lmKGM8UiYmTVtjXSE9PTApZm9yKGxldCBwPWMrMTtwPHM7cCsrKXtsZXQgUz0wO2ZvcihsZXQgZD1jKzE7ZDxzO2QrKylTKz1tLmdldChkLGMpKm0uZ2V0KGQscCk7Uz0tUy9tLmdldChjKzEsYyk7Zm9yKGxldCBkPWMrMTtkPHM7ZCsrKW0uc2V0KGQscCxtLmdldChkLHApK1MqbS5nZXQoZCxjKSl9Zm9yKGxldCBwPTA7cDxzO3ArKyltLnNldChwLGMsMCk7bS5zZXQoYyxjLDEpfWxldCB6PUktMSxCPU51bWJlci5FUFNJTE9OO2Zvcig7ST4wOyl7bGV0IGMscDtmb3IoYz1JLTI7Yz49LTEmJmMhPT0tMTtjLS0pe2NvbnN0IFM9TnVtYmVyLk1JTl9WQUxVRStCKk1hdGguYWJzKHdbY10rTWF0aC5hYnMod1tjKzFdKSk7aWYoTWF0aC5hYnMoTVtjXSk8PVN8fE51bWJlci5pc05hTihNW2NdKSl7TVtjXT0wO2JyZWFrfX1pZihjPT09SS0yKXA9NDtlbHNle2xldCBTO2ZvcihTPUktMTtTPj1jJiZTIT09YztTLS0pe2xldCBkPShTIT09ST9NYXRoLmFicyhNW1NdKTowKSsoUyE9PWMrMT9NYXRoLmFicyhNW1MtMV0pOjApO2lmKE1hdGguYWJzKHdbU10pPD1CKmQpe3dbU109MDticmVha319Uz09PWM/cD0zOlM9PT1JLTE/cD0xOihwPTIsYz1TKX1zd2l0Y2goYysrLHApe2Nhc2UgMTp7bGV0IFM9TVtJLTJdO01bSS0yXT0wO2ZvcihsZXQgZD1JLTI7ZD49YztkLS0pe2xldCBEPXgod1tkXSxTKSxVPXdbZF0vRCxGPVMvRDtpZih3W2RdPUQsZCE9PWMmJihTPS1GKk1bZC0xXSxNW2QtMV09VSpNW2QtMV0pLHUpZm9yKGxldCBQPTA7UDxzO1ArKylEPVUqbS5nZXQoUCxkKStGKm0uZ2V0KFAsSS0xKSxtLnNldChQLEktMSwtRiptLmdldChQLGQpK1UqbS5nZXQoUCxJLTEpKSxtLnNldChQLGQsRCl9YnJlYWt9Y2FzZSAyOntsZXQgUz1NW2MtMV07TVtjLTFdPTA7Zm9yKGxldCBkPWM7ZDxJO2QrKyl7bGV0IEQ9eCh3W2RdLFMpLFU9d1tkXS9ELEY9Uy9EO2lmKHdbZF09RCxTPS1GKk1bZF0sTVtkXT1VKk1bZF0sbClmb3IobGV0IFA9MDtQPHQ7UCsrKUQ9VSp5LmdldChQLGQpK0YqeS5nZXQoUCxjLTEpLHkuc2V0KFAsYy0xLC1GKnkuZ2V0KFAsZCkrVSp5LmdldChQLGMtMSkpLHkuc2V0KFAsZCxEKX1icmVha31jYXNlIDM6e2NvbnN0IFM9TWF0aC5tYXgoTWF0aC5hYnMod1tJLTFdKSxNYXRoLmFicyh3W0ktMl0pLE1hdGguYWJzKE1bSS0yXSksTWF0aC5hYnMod1tjXSksTWF0aC5hYnMoTVtjXSkpLGQ9d1tJLTFdL1MsRD13W0ktMl0vUyxVPU1bSS0yXS9TLEY9d1tjXS9TLFA9TVtjXS9TLFk9KChEK2QpKihELWQpK1UqVSkvMixHPWQqVSooZCpVKTtsZXQgTj0wOyhZIT09MHx8RyE9PTApJiYoWTwwP049MC1NYXRoLnNxcnQoWSpZK0cpOk49TWF0aC5zcXJ0KFkqWStHKSxOPUcvKFkrTikpO2xldCAkPShGK2QpKihGLWQpK04sSz1GKlA7Zm9yKGxldCB2PWM7djxJLTE7disrKXtsZXQgVj14KCQsSyk7Vj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpO2xldCBMPSQvVixDPUsvVjtpZih2IT09YyYmKE1bdi0xXT1WKSwkPUwqd1t2XStDKk1bdl0sTVt2XT1MKk1bdl0tQyp3W3ZdLEs9Qyp3W3YrMV0sd1t2KzFdPUwqd1t2KzFdLHUpZm9yKGxldCBYPTA7WDxzO1grKylWPUwqbS5nZXQoWCx2KStDKm0uZ2V0KFgsdisxKSxtLnNldChYLHYrMSwtQyptLmdldChYLHYpK0wqbS5nZXQoWCx2KzEpKSxtLnNldChYLHYsVik7aWYoVj14KCQsSyksVj09PTAmJihWPU51bWJlci5NSU5fVkFMVUUpLEw9JC9WLEM9Sy9WLHdbdl09ViwkPUwqTVt2XStDKndbdisxXSx3W3YrMV09LUMqTVt2XStMKndbdisxXSxLPUMqTVt2KzFdLE1bdisxXT1MKk1bdisxXSxsJiZ2PHQtMSlmb3IobGV0IFg9MDtYPHQ7WCsrKVY9TCp5LmdldChYLHYpK0MqeS5nZXQoWCx2KzEpLHkuc2V0KFgsdisxLC1DKnkuZ2V0KFgsdikrTCp5LmdldChYLHYrMSkpLHkuc2V0KFgsdixWKX1NW0ktMl09JDticmVha31jYXNlIDQ6e2lmKHdbY108PTAmJih3W2NdPXdbY108MD8td1tjXTowLHUpKWZvcihsZXQgUz0wO1M8PXo7UysrKW0uc2V0KFMsYywtbS5nZXQoUyxjKSk7Zm9yKDtjPHomJiEod1tjXT49d1tjKzFdKTspe2xldCBTPXdbY107aWYod1tjXT13W2MrMV0sd1tjKzFdPVMsdSYmYzxzLTEpZm9yKGxldCBkPTA7ZDxzO2QrKylTPW0uZ2V0KGQsYysxKSxtLnNldChkLGMrMSxtLmdldChkLGMpKSxtLnNldChkLGMsUyk7aWYobCYmYzx0LTEpZm9yKGxldCBkPTA7ZDx0O2QrKylTPXkuZ2V0KGQsYysxKSx5LnNldChkLGMrMSx5LmdldChkLGMpKSx5LnNldChkLGMsUyk7YysrfUktLTticmVha319fWlmKGYpe2xldCBjPW07bT15LHk9Y310aGlzLm09dCx0aGlzLm49cyx0aGlzLnM9dyx0aGlzLlU9eSx0aGlzLlY9bX1zb2x2ZShuKXtsZXQgZT1uLHQ9dGhpcy50aHJlc2hvbGQscz10aGlzLnMubGVuZ3RoLHI9Yi56ZXJvcyhzLHMpO2ZvcihsZXQgYT0wO2E8czthKyspTWF0aC5hYnModGhpcy5zW2FdKTw9dD9yLnNldChhLGEsMCk6ci5zZXQoYSxhLDEvdGhpcy5zW2FdKTtsZXQgaT10aGlzLlUsaD10aGlzLnJpZ2h0U2luZ3VsYXJWZWN0b3JzLGw9aC5tbXVsKHIpLHU9aC5yb3dzLGY9aS5yb3dzLGc9Yi56ZXJvcyh1LGYpO2ZvcihsZXQgYT0wO2E8dTthKyspZm9yKGxldCBqPTA7ajxmO2orKyl7bGV0IHc9MDtmb3IobGV0IHk9MDt5PHM7eSsrKXcrPWwuZ2V0KGEseSkqaS5nZXQoaix5KTtnLnNldChhLGosdyl9cmV0dXJuIGcubW11bChlKX1zb2x2ZUZvckRpYWdvbmFsKG4pe3JldHVybiB0aGlzLnNvbHZlKGIuZGlhZyhuKSl9aW52ZXJzZSgpe2xldCBuPXRoaXMuVixlPXRoaXMudGhyZXNob2xkLHQ9bi5yb3dzLHM9bi5jb2x1bW5zLHI9bmV3IGIodCx0aGlzLnMubGVuZ3RoKTtmb3IobGV0IGY9MDtmPHQ7ZisrKWZvcihsZXQgZz0wO2c8cztnKyspTWF0aC5hYnModGhpcy5zW2ddKT5lJiZyLnNldChmLGcsbi5nZXQoZixnKS90aGlzLnNbZ10pO2xldCBpPXRoaXMuVSxoPWkucm93cyxsPWkuY29sdW1ucyx1PW5ldyBiKHQsaCk7Zm9yKGxldCBmPTA7Zjx0O2YrKylmb3IobGV0IGc9MDtnPGg7ZysrKXtsZXQgYT0wO2ZvcihsZXQgaj0wO2o8bDtqKyspYSs9ci5nZXQoZixqKSppLmdldChnLGopO3Uuc2V0KGYsZyxhKX1yZXR1cm4gdX1nZXQgY29uZGl0aW9uKCl7cmV0dXJuIHRoaXMuc1swXS90aGlzLnNbTWF0aC5taW4odGhpcy5tLHRoaXMubiktMV19Z2V0IG5vcm0yKCl7cmV0dXJuIHRoaXMuc1swXX1nZXQgcmFuaygpe2xldCBuPU1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXSpOdW1iZXIuRVBTSUxPTixlPTAsdD10aGlzLnM7Zm9yKGxldCBzPTAscj10Lmxlbmd0aDtzPHI7cysrKXRbc10+biYmZSsrO3JldHVybiBlfWdldCBkaWFnb25hbCgpe3JldHVybiBBcnJheS5mcm9tKHRoaXMucyl9Z2V0IHRocmVzaG9sZCgpe3JldHVybiBOdW1iZXIuRVBTSUxPTi8yKk1hdGgubWF4KHRoaXMubSx0aGlzLm4pKnRoaXMuc1swXX1nZXQgbGVmdFNpbmd1bGFyVmVjdG9ycygpe3JldHVybiB0aGlzLlV9Z2V0IHJpZ2h0U2luZ3VsYXJWZWN0b3JzKCl7cmV0dXJuIHRoaXMuVn1nZXQgZGlhZ29uYWxNYXRyaXgoKXtyZXR1cm4gYi5kaWFnKHRoaXMucyl9fWZ1bmN0aW9uIE10KG8sbj0hMSl7cmV0dXJuIG89c3QuY2hlY2tNYXRyaXgobyksbj9uZXcgRHQobykuaW52ZXJzZSgpOnFlKG8sYi5leWUoby5yb3dzKSl9ZnVuY3Rpb24gcWUobyxuLGU9ITEpe3JldHVybiBvPXN0LmNoZWNrTWF0cml4KG8pLG49c3QuY2hlY2tNYXRyaXgobiksZT9uZXcgRHQobykuc29sdmUobik6by5pc1NxdWFyZSgpP25ldyBOZShvKS5zb2x2ZShuKTpuZXcgdmUobykuc29sdmUobil9Y29uc3QgX2U9MTIzNCxUZT0oKT0+KHtzZWVkOl9lLGFycmF5U2h1ZmZsZShuKXtjb25zdHthcnI6ZSxzYW1wbGVTaXplOnR9PW47Zm9yKGxldCBzPTA7czx0O3MrKyl7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCByPXRoaXMuc2VlZD4+MTYmMzI3Njc7cj1yJWUubGVuZ3RoO2xldCBpPWVbc107ZVtzXT1lW3JdLGVbcl09aX19LG5leHRJbnQobil7dGhpcy5zZWVkPSgyMTQwMTMqdGhpcy5zZWVkKzI1MzEwMTEpJS0yMTQ3NDgzNjQ4O2xldCBlPXRoaXMuc2VlZD4+MTYmMzI3Njc7cmV0dXJuIGU9ZSVuLGV9fSksSj0obyxuLGUpPT4oblswXS1vWzBdKSooZVsxXS1vWzFdKS0oblsxXS1vWzFdKSooZVswXS1vWzBdKSx6ZT0obyxuLGUsdCxzLHIsaSxoKT0+IShKKG8sbixlKT4wIT1KKHMscixpKT4wfHxKKG4sZSx0KT4wIT1KKHIsaSxoKT4wfHxKKGUsdCxvKT4wIT1KKGksaCxzKT4wfHxKKHQsbyxuKT4wIT1KKGgscyxyKT4wKSxGZT0obyxuLGUsdCxzLHIpPT5KKG8sbixlKT4wPT1KKHQscyxyKT4wLFBlPW89Pntjb25zdCBuPW9bNF0qb1s4XS1vWzVdKm9bN10sZT1vWzNdKm9bOF0tb1s1XSpvWzZdLHQ9b1szXSpvWzddLW9bNF0qb1s2XTtyZXR1cm4gb1swXSpuLW9bMV0qZStvWzJdKnR9LEJ0PShvLG4pPT57Y29uc3QgZT1QZShvKTtpZihNYXRoLmFicyhlKTw9bilyZXR1cm4gbnVsbDtjb25zdCB0PTEvZTtyZXR1cm5bKG9bNF0qb1s4XS1vWzVdKm9bN10pKnQsKG9bMl0qb1s3XS1vWzFdKm9bOF0pKnQsKG9bMV0qb1s1XS1vWzJdKm9bNF0pKnQsKG9bNV0qb1s2XS1vWzNdKm9bOF0pKnQsKG9bMF0qb1s4XS1vWzJdKm9bNl0pKnQsKG9bMl0qb1szXS1vWzBdKm9bNV0pKnQsKG9bM10qb1s3XS1vWzRdKm9bNl0pKnQsKG9bMV0qb1s2XS1vWzBdKm9bN10pKnQsKG9bMF0qb1s0XS1vWzFdKm9bM10pKnRdfSxvdD0obyxuKT0+e2NvbnN0IGU9bls2XSpvWzBdK25bN10qb1sxXStuWzhdLHQ9W107cmV0dXJuIHRbMF09KG5bMF0qb1swXStuWzFdKm9bMV0rblsyXSkvZSx0WzFdPShuWzNdKm9bMF0rbls0XSpvWzFdK25bNV0pL2UsdH0sRGU9KG8sbixlLHQpPT57Y29uc3Qgcz1ydChuLG8pLHI9cnQoZSxvKSxpPXJ0KHQsbyksaD1ydChuLGUpLGw9cnQodCxlKSx1PW10KHMsciksZj1tdChyLGkpLGc9bXQocyxpKSxhPW10KGgsbCk7cmV0dXJuIE1hdGgubWluKE1hdGgubWluKE1hdGgubWluKHUsZiksZyksYSl9LEJlPShvLG4sZSx0KT0+e2NvbnN0IHM9SihvLG4sZSk8PTA7cmV0dXJuIShKKG4sZSx0KTw9MCE9PXN8fEooZSx0LG8pPD0wIT09c3x8Sih0LG8sbik8PTAhPT1zKX0scnQ9KG8sbik9PltvWzBdLW5bMF0sb1sxXS1uWzFdXSxtdD0obyxuKT0+e2NvbnN0IGU9b1swXSpuWzFdLW9bMV0qblswXTtyZXR1cm4gTWF0aC5hYnMoZSkqLjV9LFZ0PShvLG4pPT57Y29uc3R7bm9ybVBvaW50czplLHBhcmFtOnR9PVh0KG8pLHtub3JtUG9pbnRzOnMscGFyYW06cn09WHQobiksaT1zLmxlbmd0aCxoPVtdLGw9W107Zm9yKGxldCB1PTA7dTxpO3UrKyl7Y29uc3QgZj1bZVt1XVswXSxlW3VdWzFdLDEsMCwwLDAsLShlW3VdWzBdKnNbdV1bMF0pLC0oZVt1XVsxXSpzW3VdWzBdKV0sZz1bMCwwLDAsZVt1XVswXSxlW3VdWzFdLDEsLShlW3VdWzBdKnNbdV1bMV0pLC0oZVt1XVsxXSpzW3VdWzFdKV07aC5wdXNoKGYpLGgucHVzaChnKSxsLnB1c2goW3NbdV1bMF1dKSxsLnB1c2goW3NbdV1bMV1dKX10cnl7Y29uc3QgdT1uZXcgYihoKSxmPW5ldyBiKGwpLGc9dS50cmFuc3Bvc2UoKSxhPWcubW11bCh1KSxqPWcubW11bChmKSx5PU10KGEpLm1tdWwoaikudG8xREFycmF5KCk7cmV0dXJuIFZlKHksdCxyKX1jYXRjaHtyZXR1cm4gbnVsbH19LFh0PW89PntsZXQgbj0wLGU9MDtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyluKz1vW2xdWzBdLGUrPW9bbF1bMV07bGV0IHQ9bi9vLmxlbmd0aCxzPWUvby5sZW5ndGgscj0wO2ZvcihsZXQgbD0wO2w8by5sZW5ndGg7bCsrKXtjb25zdCB1PW9bbF1bMF0tdCxmPW9bbF1bMV0tcztyKz1NYXRoLnNxcnQodSp1K2YqZil9bGV0IGk9TWF0aC5zcXJ0KDIpKm8ubGVuZ3RoL3I7Y29uc3QgaD1bXTtmb3IobGV0IGw9MDtsPG8ubGVuZ3RoO2wrKyloLnB1c2goWyhvW2xdWzBdLXQpKmksKG9bbF1bMV0tcykqaV0pO3JldHVybntub3JtUG9pbnRzOmgscGFyYW06e21lYW5YOnQsbWVhblk6cyxzOml9fX0sVmU9KG8sbixlKT0+e2NvbnN0IHQ9ZS5zKmUubWVhblgscz1lLnMqZS5tZWFuWSxyPVtvWzBdK3Qqb1s2XSxvWzFdK3Qqb1s3XSwob1swXSt0Km9bNl0pKi1uLm1lYW5YKyhvWzFdK3Qqb1s3XSkqLW4ubWVhblkrKG9bMl0rdCkvbi5zLG9bM10rcypvWzZdLG9bNF0rcypvWzddLChvWzNdK3Mqb1s2XSkqLW4ubWVhblgrKG9bNF0rcypvWzddKSotbi5tZWFuWSsob1s1XStzKS9uLnMsZS5zKm9bNl0sZS5zKm9bN10sZS5zKm9bNl0qLW4ubWVhblgrZS5zKm9bN10qLW4ubWVhblkrZS5zL24uc107Zm9yKGxldCBpPTA7aTw5O2krKylyW2ldPXJbaV0vcls4XTtyZXR1cm4gcn0sWGU9LjAxLFVlPTEwLCRlPTIwLExlPTEwLFV0PW89Pntjb25zdHtzcmNQb2ludHM6bixkc3RQb2ludHM6ZSxrZXlmcmFtZTp0LHF1aWNrTW9kZTpzfT1vLHI9W1swLDBdLFt0LndpZHRoLDBdLFt0LndpZHRoLHQuaGVpZ2h0XSxbMCx0LmhlaWdodF1dLGk9NDtpZihuLmxlbmd0aDxpKXJldHVybiBudWxsO2NvbnN0IGg9WGUsbD0xLyhoKmgpLHU9TWF0aC5taW4oVWUsbi5sZW5ndGgpLGY9VGUoKSxnPVtdO2ZvcihsZXQgRT0wO0U8bi5sZW5ndGg7RSsrKWdbRV09RTtmLmFycmF5U2h1ZmZsZSh7YXJyOmcsc2FtcGxlU2l6ZTpnLmxlbmd0aH0pO2NvbnN0IGE9cz9MZTokZSxqPWEqMjtsZXQgdz0wO2NvbnN0IHk9W107Zm9yKDt3PGomJnkubGVuZ3RoPGE7KXtpZih3Kz0xLGYuYXJyYXlTaHVmZmxlKHthcnI6ZyxzYW1wbGVTaXplOml9KSwhemUobltnWzBdXSxuW2dbMV1dLG5bZ1syXV0sbltnWzNdXSxlW2dbMF1dLGVbZ1sxXV0sZVtnWzJdXSxlW2dbM11dKSljb250aW51ZTtjb25zdCBFPVZ0KFtuW2dbMF1dLG5bZ1sxXV0sbltnWzJdXSxuW2dbM11dXSxbZVtnWzBdXSxlW2dbMV1dLGVbZ1syXV0sZVtnWzNdXV0pO0UhPT1udWxsJiZIZSh7SDpFLHRlc3RQb2ludHM6cn0pJiZ5LnB1c2goRSl9aWYoeS5sZW5ndGg9PT0wKXJldHVybiBudWxsO2NvbnN0IG09W107Zm9yKGxldCBFPTA7RTx5Lmxlbmd0aDtFKyspbS5wdXNoKHtIOnlbRV0sY29zdDowfSk7bGV0IE09dTtmb3IobGV0IEU9MDtFPG4ubGVuZ3RoJiZtLmxlbmd0aD4yO0UrPU0pe009TWF0aC5taW4odSxuLmxlbmd0aC1FKTtsZXQgaz1FK007Zm9yKGxldCBSPTA7UjxtLmxlbmd0aDtSKyspZm9yKGxldCBxPUU7cTxrO3ErKyl7Y29uc3QgST1DZSh7SDptW1JdLkgsc3JjUG9pbnQ6bltxXSxkc3RQb2ludDplW3FdLG9uZU92ZXJTY2FsZTI6bH0pO21bUl0uY29zdCs9SX1tLnNvcnQoKFIscSk9PlIuY29zdC1xLmNvc3QpLG0uc3BsaWNlKC1NYXRoLmZsb29yKChtLmxlbmd0aCsxKS8yKSl9bGV0IFQ9bnVsbDtmb3IobGV0IEU9MDtFPG0ubGVuZ3RoO0UrKyl7Y29uc3Qgaz1ZZSh7aW5IOm1bRV0uSH0pO2lmKE9lKHtIOmssdGVzdFBvaW50czpyLGtleWZyYW1lOnR9KSl7VD1rO2JyZWFrfX1yZXR1cm4gVH0sT2U9KHtIOm8sdGVzdFBvaW50czpuLGtleWZyYW1lOmV9KT0+e2NvbnN0IHQ9QnQobywxZS01KTtpZih0PT09bnVsbClyZXR1cm4hMTtjb25zdCBzPVtdO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKXMucHVzaChvdChuW2ldLHQpKTtyZXR1cm4hKERlKHNbMF0sc1sxXSxzWzJdLHNbM10pPGUud2lkdGgqZS5oZWlnaHQqMWUtNHx8IUJlKHNbMF0sc1sxXSxzWzJdLHNbM10pKX0sWWU9KHtpbkg6b30pPT57Y29uc3Qgbj0xL29bOF0sZT1bXTtmb3IobGV0IHQ9MDt0PDg7dCsrKWVbdF09b1t0XSpuO3JldHVybiBlWzhdPTEsZX0sQ2U9KHtIOm8sc3JjUG9pbnQ6bixkc3RQb2ludDplLG9uZU92ZXJTY2FsZTI6dH0pPT57Y29uc3Qgcz1vdChuLG8pLHI9W3NbMF0tZVswXSxzWzFdLWVbMV1dO3JldHVybiBNYXRoLmxvZygxKyhyWzBdKnJbMF0rclsxXSpyWzFdKSp0KX0sSGU9KHtIOm8sdGVzdFBvaW50czpufSk9Pntjb25zdCBlPVtdO2ZvcihsZXQgdD0wO3Q8bi5sZW5ndGg7dCsrKWVbdF09b3Qoblt0XSxvKTtmb3IobGV0IHQ9MDt0PG4ubGVuZ3RoO3QrKyl7Y29uc3Qgcz10LHI9KHQrMSklbi5sZW5ndGgsaT0odCsyKSVuLmxlbmd0aDtpZighRmUobltzXSxuW3JdLG5baV0sZVtzXSxlW3JdLGVbaV0pKXJldHVybiExfXJldHVybiEwfSwkdD0zLEx0PTYsS2U9OCxPdD0uNyxKZT0oe2tleWZyYW1lOm8scXVlcnlwb2ludHM6bixxdWVyeXdpZHRoOmUscXVlcnloZWlnaHQ6dCxkZWJ1Z01vZGU6c30pPT57bGV0IHI9e307Y29uc3QgaT1bXTtmb3IobGV0IG09MDttPG4ubGVuZ3RoO20rKyl7Y29uc3QgTT1uW21dLFQ9TS5tYXhpbWE/by5tYXhpbWFQb2ludHM6by5taW5pbWFQb2ludHM7aWYoVC5sZW5ndGg9PT0wKWNvbnRpbnVlO2NvbnN0IEU9TS5tYXhpbWE/by5tYXhpbWFQb2ludHNDbHVzdGVyLnJvb3ROb2RlOm8ubWluaW1hUG9pbnRzQ2x1c3Rlci5yb290Tm9kZSxrPVtdLFI9bmV3IFd0KFtdLChCLGMpPT5CLmQtYy5kKTtFdCh7bm9kZTpFLGtleXBvaW50czpULHF1ZXJ5cG9pbnQ6TSxxdWV1ZTpSLGtleXBvaW50SW5kZXhlczprLG51bVBvcDowfSk7bGV0IHE9LTEsST1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUix6PU51bWJlci5NQVhfU0FGRV9JTlRFR0VSO2ZvcihsZXQgQj0wO0I8ay5sZW5ndGg7QisrKXtjb25zdCBjPVRba1tCXV0scD15dCh7djE6Yy5kZXNjcmlwdG9ycyx2MjpNLmRlc2NyaXB0b3JzfSk7cDxJPyh6PUksST1wLHE9a1tCXSk6cDx6JiYoej1wKX1xIT09LTEmJih6PT09TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJ8fDEqSS96PE90KSYmaS5wdXNoKHtxdWVyeXBvaW50Ok0sa2V5cG9pbnQ6VFtxXX0pfWlmKHMmJihyLm1hdGNoZXM9aSksaS5sZW5ndGg8THQpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgaD12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczppfSk7cyYmKHIuaG91Z2hNYXRjaGVzPWgpO2NvbnN0IGw9VXQoe3NyY1BvaW50czpoLm1hcChtPT5bbS5rZXlwb2ludC54LG0ua2V5cG9pbnQueV0pLGRzdFBvaW50czpoLm1hcChtPT5bbS5xdWVyeXBvaW50LngsbS5xdWVyeXBvaW50LnldKSxrZXlmcmFtZTpvfSk7aWYobD09PW51bGwpcmV0dXJue2RlYnVnRXh0cmE6cn07Y29uc3QgdT1ZdCh7SDpsLG1hdGNoZXM6aCx0aHJlc2hvbGQ6JHR9KTtpZihzJiYoci5pbmxpZXJNYXRjaGVzPXUpLHUubGVuZ3RoPEx0KXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IGY9QnQobCwxZS01KSxnPTEwKjEwLGE9W107Zm9yKGxldCBtPTA7bTxuLmxlbmd0aDttKyspe2NvbnN0IE09blttXSxUPW90KFtNLngsTS55XSxmKTtsZXQgRT0tMSxrPU51bWJlci5NQVhfU0FGRV9JTlRFR0VSLFI9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Y29uc3QgcT1NLm1heGltYT9vLm1heGltYVBvaW50czpvLm1pbmltYVBvaW50cztmb3IobGV0IEk9MDtJPHEubGVuZ3RoO0krKyl7Y29uc3Qgej1xW0ldO2lmKCh6LngtVFswXSkqKHoueC1UWzBdKSsoei55LVRbMV0pKih6LnktVFsxXSk+Zyljb250aW51ZTtjb25zdCBjPXl0KHt2MTp6LmRlc2NyaXB0b3JzLHYyOk0uZGVzY3JpcHRvcnN9KTtjPGs/KFI9ayxrPWMsRT1JKTpjPFImJihSPWMpfUUhPT0tMSYmKFI9PT1OdW1iZXIuTUFYX1NBRkVfSU5URUdFUnx8MSprL1I8T3QpJiZhLnB1c2goe3F1ZXJ5cG9pbnQ6TSxrZXlwb2ludDpxW0VdfSl9cyYmKHIubWF0Y2hlczI9YSk7Y29uc3Qgaj12dCh7a2V5d2lkdGg6by53aWR0aCxrZXloZWlnaHQ6by5oZWlnaHQscXVlcnl3aWR0aDplLHF1ZXJ5aGVpZ2h0OnQsbWF0Y2hlczphfSk7cyYmKHIuaG91Z2hNYXRjaGVzMj1qKTtjb25zdCB3PVV0KHtzcmNQb2ludHM6ai5tYXAobT0+W20ua2V5cG9pbnQueCxtLmtleXBvaW50LnldKSxkc3RQb2ludHM6ai5tYXAobT0+W20ucXVlcnlwb2ludC54LG0ucXVlcnlwb2ludC55XSksa2V5ZnJhbWU6b30pO2lmKHc9PT1udWxsKXJldHVybntkZWJ1Z0V4dHJhOnJ9O2NvbnN0IHk9WXQoe0g6dyxtYXRjaGVzOmosdGhyZXNob2xkOiR0fSk7cmV0dXJuIHMmJihyLmlubGllck1hdGNoZXMyPXkpLHtIOncsbWF0Y2hlczp5LGRlYnVnRXh0cmE6cn19LEV0PSh7bm9kZTpvLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSk9PntpZihvLmxlYWYpe2ZvcihsZXQgbD0wO2w8by5wb2ludEluZGV4ZXMubGVuZ3RoO2wrKylzLnB1c2goby5wb2ludEluZGV4ZXNbbF0pO3JldHVybn1jb25zdCBpPVtdO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKXtjb25zdCBmPW8uY2hpbGRyZW5bbF0uY2VudGVyUG9pbnRJbmRleCxnPXl0KHt2MTpuW2ZdLmRlc2NyaXB0b3JzLHYyOmUuZGVzY3JpcHRvcnN9KTtpLnB1c2goZyl9bGV0IGg9TnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7Zm9yKGxldCBsPTA7bDxvLmNoaWxkcmVuLmxlbmd0aDtsKyspaD1NYXRoLm1pbihoLGlbbF0pO2ZvcihsZXQgbD0wO2w8by5jaGlsZHJlbi5sZW5ndGg7bCsrKWlbbF0hPT1oJiZ0LnB1c2goe25vZGU6by5jaGlsZHJlbltsXSxkOmlbbF19KTtmb3IobGV0IGw9MDtsPG8uY2hpbGRyZW4ubGVuZ3RoO2wrKylpW2xdPT09aCYmRXQoe25vZGU6by5jaGlsZHJlbltsXSxrZXlwb2ludHM6bixxdWVyeXBvaW50OmUscXVldWU6dCxrZXlwb2ludEluZGV4ZXM6cyxudW1Qb3A6cn0pO2lmKHI8S2UmJnQubGVuZ3RoPjApe2NvbnN0e25vZGU6bCxkOnV9PXQucG9wKCk7cis9MSxFdCh7bm9kZTpsLGtleXBvaW50czpuLHF1ZXJ5cG9pbnQ6ZSxxdWV1ZTp0LGtleXBvaW50SW5kZXhlczpzLG51bVBvcDpyfSl9fSxZdD1vPT57Y29uc3R7SDpuLG1hdGNoZXM6ZSx0aHJlc2hvbGQ6dH09byxzPXQqdCxyPVtdO2ZvcihsZXQgaT0wO2k8ZS5sZW5ndGg7aSsrKXtjb25zdCBoPWVbaV0ucXVlcnlwb2ludCxsPWVbaV0ua2V5cG9pbnQsdT1vdChbbC54LGwueV0sbik7KHVbMF0taC54KSoodVswXS1oLngpKyh1WzFdLWgueSkqKHVbMV0taC55KTw9cyYmci5wdXNoKGVbaV0pfXJldHVybiByfTtjbGFzcyBHZXtjb25zdHJ1Y3RvcihuLGUsdD0hMSl7dGhpcy5xdWVyeVdpZHRoPW4sdGhpcy5xdWVyeUhlaWdodD1lLHRoaXMuZGVidWdNb2RlPXR9bWF0Y2hEZXRlY3Rpb24obixlKXtsZXQgdD17ZnJhbWVzOltdfSxzPW51bGw7Zm9yKGxldCBsPTA7bDxuLmxlbmd0aDtsKyspe2NvbnN0e0g6dSxtYXRjaGVzOmYsZGVidWdFeHRyYTpnfT1KZSh7a2V5ZnJhbWU6bltsXSxxdWVyeXBvaW50czplLHF1ZXJ5d2lkdGg6dGhpcy5xdWVyeVdpZHRoLHF1ZXJ5aGVpZ2h0OnRoaXMucXVlcnlIZWlnaHQsZGVidWdNb2RlOnRoaXMuZGVidWdNb2RlfSk7dC5mcmFtZXMucHVzaChnKSx1JiYocz09PW51bGx8fHMubWF0Y2hlcy5sZW5ndGg8Zi5sZW5ndGgpJiYocz17a2V5ZnJhbWVJbmRleDpsLEg6dSxtYXRjaGVzOmZ9KX1pZihzPT09bnVsbClyZXR1cm57a2V5ZnJhbWVJbmRleDotMSxkZWJ1Z0V4dHJhOnR9O2NvbnN0IHI9W10saT1bXSxoPW5bcy5rZXlmcmFtZUluZGV4XTtmb3IobGV0IGw9MDtsPHMubWF0Y2hlcy5sZW5ndGg7bCsrKXtjb25zdCB1PXMubWF0Y2hlc1tsXS5xdWVyeXBvaW50LGY9cy5tYXRjaGVzW2xdLmtleXBvaW50O3IucHVzaCh7eDp1LngseTp1Lnl9KSxpLnB1c2goe3g6KGYueCsuNSkvaC5zY2FsZSx5OihmLnkrLjUpL2guc2NhbGUsejowfSl9cmV0dXJue3NjcmVlbkNvb3JkczpyLHdvcmxkQ29vcmRzOmksa2V5ZnJhbWVJbmRleDpzLmtleWZyYW1lSW5kZXgsZGVidWdFeHRyYTp0fX19Y29uc3QgV2U9KHtzY3JlZW5Db29yZHM6byx3b3JsZENvb3JkczpuLHByb2plY3Rpb25UcmFuc2Zvcm06ZX0pPT57Y29uc3QgdD1WdChuLm1hcChtPT5bbS54LG0ueV0pLG8ubWFwKG09PlttLngsbS55XSkpLHM9bmV3IGIoW1t0WzBdLHRbMV0sdFsyXV0sW3RbM10sdFs0XSx0WzVdXSxbdFs2XSx0WzddLHRbOF1dXSkscj1uZXcgYihlKSxsPU10KHIpLm1tdWwocykudG8xREFycmF5KCksdT1NYXRoLnNxcnQobFswXSpsWzBdK2xbM10qbFszXStsWzZdKmxbNl0pLGY9TWF0aC5zcXJ0KGxbMV0qbFsxXStsWzRdKmxbNF0rbFs3XSpsWzddKSxnPSh1K2YpLzIsYT1bXTthWzBdPWxbMF0vdSxhWzNdPWxbM10vdSxhWzZdPWxbNl0vdSxhWzFdPWxbMV0vZixhWzRdPWxbNF0vZixhWzddPWxbN10vZixhWzJdPWFbM10qYVs3XS1hWzZdKmFbNF0sYVs1XT1hWzZdKmFbMV0tYVswXSphWzddLGFbOF09YVswXSphWzRdLWFbMV0qYVszXTtjb25zdCBqPU1hdGguc3FydChhWzJdKmFbMl0rYVs1XSphWzVdK2FbOF0qYVs4XSk7YVsyXS89aixhWzVdLz1qLGFbOF0vPWo7Y29uc3Qgdz1bXTtyZXR1cm4gd1swXT1sWzJdL2csd1sxXT1sWzVdL2csd1syXT1sWzhdL2csW1thWzBdLGFbMV0sYVsyXSx3WzBdXSxbYVszXSxhWzRdLGFbNV0sd1sxXV0sW2FbNl0sYVs3XSxhWzhdLHdbMl1dXX0sUWU9KG8sbik9Pltbb1swXVswXSpuWzBdWzBdK29bMF1bMl0qblsyXVswXSxvWzBdWzBdKm5bMF1bMV0rb1swXVsyXSpuWzJdWzFdLG9bMF1bMF0qblswXVsyXStvWzBdWzJdKm5bMl1bMl0sb1swXVswXSpuWzBdWzNdK29bMF1bMl0qblsyXVszXV0sW29bMV1bMV0qblsxXVswXStvWzFdWzJdKm5bMl1bMF0sb1sxXVsxXSpuWzFdWzFdK29bMV1bMl0qblsyXVsxXSxvWzFdWzFdKm5bMV1bMl0rb1sxXVsyXSpuWzJdWzJdLG9bMV1bMV0qblsxXVszXStvWzFdWzJdKm5bMl1bM11dLFtuWzJdWzBdLG5bMl1bMV0sblsyXVsyXSxuWzJdWzNdXV0sQ3Q9KG8sbixlLHQpPT57Y29uc3Qgcz1vWzBdWzBdKm4rb1swXVsxXSplK29bMF1bM10scj1vWzFdWzBdKm4rb1sxXVsxXSplK29bMV1bM10saT1vWzJdWzBdKm4rb1syXVsxXSplK29bMl1bM107cmV0dXJue3g6cyx5OnIsejppfX0sWmU9KG8sbixlLHQpPT57Y29uc3R7eDpzLHk6cix6Oml9PUN0KG8sbixlKTtyZXR1cm57eDpzL2kseTpyL2l9fSx4ZT01LEFlPTQsSHQ9MTAsdG49LjEsZW49Ljk5O2xldCBIPVtbXSxbXSxbXV0sQT1bW10sW11dLE89W1tdLFtdLFtdXTtjb25zdCBubj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dH0pPT57bGV0IHM9MCxyPTA7Zm9yKGxldCBnPTA7ZzxlLmxlbmd0aDtnKyspcys9ZVtnXS54LHIrPWVbZ10ueTtzLz1lLmxlbmd0aCxyLz1lLmxlbmd0aDtjb25zdCBpPVtdO2ZvcihsZXQgZz0wO2c8ZS5sZW5ndGg7ZysrKWkucHVzaCh7eDplW2ddLngtcyx5OmVbZ10ueS1yLHo6ZVtnXS56fSk7Y29uc3QgaD1bW10sW10sW11dO2ZvcihsZXQgZz0wO2c8MztnKyspZm9yKGxldCBhPTA7YTwzO2ErKyloW2ddW2FdPW9bZ11bYV07aFswXVszXT1vWzBdWzBdKnMrb1swXVsxXSpyK29bMF1bM10saFsxXVszXT1vWzFdWzBdKnMrb1sxXVsxXSpyK29bMV1bM10saFsyXVszXT1vWzJdWzBdKnMrb1syXVsxXSpyK29bMl1bM107Y29uc3QgbD1bMSwuOCwuNiwuNCwwXTtsZXQgdT1oLGY9bnVsbDtmb3IobGV0IGc9MDtnPGwubGVuZ3RoO2crKyl7Y29uc3QgYT1zbih7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTp1LHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkczppLHNjcmVlbkNvb3Jkczp0LGlubGllclByb2I6bFtnXX0pO2lmKHU9YS5tb2RlbFZpZXdUcmFuc2Zvcm0sYS5lcnI8eGUpe2Y9dTticmVha319cmV0dXJuIGY9PT1udWxsP251bGw6KGZbMF1bM109ZlswXVszXS1mWzBdWzBdKnMtZlswXVsxXSpyLGZbMV1bM109ZlsxXVszXS1mWzFdWzBdKnMtZlsxXVsxXSpyLGZbMl1bM109ZlsyXVszXS1mWzJdWzBdKnMtZlsyXVsxXSpyLGYpfSxzbj0oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06byxwcm9qZWN0aW9uVHJhbnNmb3JtOm4sd29ybGRDb29yZHM6ZSxzY3JlZW5Db29yZHM6dCxpbmxpZXJQcm9iOnN9KT0+e2NvbnN0IHI9czwxO2xldCBpPW8saD0wLGw9MCx1PW5ldyBBcnJheShlLmxlbmd0aCksZj1uZXcgQXJyYXkoZS5sZW5ndGgpLGc9bmV3IEFycmF5KGUubGVuZ3RoKSxhPW5ldyBBcnJheShlLmxlbmd0aCk7Zm9yKGxldCBqPTA7ajw9SHQ7aisrKXtjb25zdCB3PVFlKG4saSk7Zm9yKGxldCBFPTA7RTxlLmxlbmd0aDtFKyspe2NvbnN0IGs9WmUodyxlW0VdLngsZVtFXS55LGVbRV0ueiksUj10W0VdLngtay54LHE9dFtFXS55LWsueTtnW0VdPVIsYVtFXT1xLHVbRV09UipSK3EqcX1sZXQgeTtpZihsPTAscil7Y29uc3QgRT1NYXRoLm1heCgzLE1hdGguZmxvb3IoZS5sZW5ndGgqcyktMSk7Zm9yKGxldCBrPTA7azxlLmxlbmd0aDtrKyspZltrXT11W2tdO2Yuc29ydCgoayxSKT0+ay1SKSx5PU1hdGgubWF4KGZbRV0qQWUsMTYpO2ZvcihsZXQgaz0wO2s8ZS5sZW5ndGg7aysrKWZba10+eT9sKz15LzY6bCs9eS82KigxLSgxLWZba10veSkqKDEtZltrXS95KSooMS1mW2tdL3kpKX1lbHNlIGZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKWwrPXVbRV07aWYobC89ZS5sZW5ndGgsbDx0bnx8aj4wJiZsL2g+ZW58fGo9PT1IdClicmVhaztoPWw7Y29uc3QgbT1bXSxNPVtdO2ZvcihsZXQgRT0wO0U8ZS5sZW5ndGg7RSsrKXtpZihyJiZ1W0VdPnkpY29udGludWU7Y29uc3Qgaz1sbih7bW9kZWxWaWV3UHJvamVjdGlvblRyYW5zZm9ybTp3LG1vZGVsVmlld1RyYW5zZm9ybTppLHByb2plY3Rpb25UcmFuc2Zvcm06bix3b3JsZENvb3JkOmVbRV19KTtpZihyKXtjb25zdCBSPSgxLXVbRV0veSkqKDEtdVtFXS95KTtmb3IobGV0IHE9MDtxPDI7cSsrKWZvcihsZXQgST0wO0k8NjtJKyspa1txXVtJXSo9UjttLnB1c2goW2dbRV0qUl0pLG0ucHVzaChbYVtFXSpSXSl9ZWxzZSBtLnB1c2goW2dbRV1dKSxtLnB1c2goW2FbRV1dKTtmb3IobGV0IFI9MDtSPGsubGVuZ3RoO1IrKylNLnB1c2goa1tSXSl9Y29uc3QgVD1ybih7ZFU6bSxKX1VfUzpNfSk7aWYoVD09PW51bGwpYnJlYWs7aT1vbih7bW9kZWxWaWV3VHJhbnNmb3JtOmksZFM6VH0pfXJldHVybnttb2RlbFZpZXdUcmFuc2Zvcm06aSxlcnI6bH19LG9uPSh7bW9kZWxWaWV3VHJhbnNmb3JtOm8sZFM6bn0pPT57bGV0IGU9blswXSpuWzBdK25bMV0qblsxXStuWzJdKm5bMl0sdCxzLHI7ZTwxZS02Pyh0PTEscz0wLHI9MCxlPTApOihlPU1hdGguc3FydChlKSx0PW5bMF0vZSxzPW5bMV0vZSxyPW5bMl0vZSk7Y29uc3QgaT1NYXRoLmNvcyhlKSxoPU1hdGguc2luKGUpLGw9MS1pO0hbMF1bMF09dCp0KmwraSxIWzBdWzFdPXQqcypsLXIqaCxIWzBdWzJdPXQqcipsK3MqaCxIWzBdWzNdPW5bM10sSFsxXVswXT1zKnQqbCtyKmgsSFsxXVsxXT1zKnMqbCtpLEhbMV1bMl09cypyKmwtdCpoLEhbMV1bM109bls0XSxIWzJdWzBdPXIqdCpsLXMqaCxIWzJdWzFdPXIqcypsK3QqaCxIWzJdWzJdPXIqcipsK2ksSFsyXVszXT1uWzVdO2NvbnN0IHU9W1tdLFtdLFtdXTtmb3IobGV0IGY9MDtmPDM7ZisrKXtmb3IobGV0IGc9MDtnPDQ7ZysrKXVbZl1bZ109b1tmXVswXSpIWzBdW2ddK29bZl1bMV0qSFsxXVtnXStvW2ZdWzJdKkhbMl1bZ107dVtmXVszXSs9b1tmXVszXX1yZXR1cm4gdX0scm49KHtkVTpvLEpfVV9TOm59KT0+e2NvbnN0IGU9bmV3IGIobiksdD1uZXcgYihvKSxzPWUudHJhbnNwb3NlKCkscj1zLm1tdWwoZSksaT1zLm1tdWwodCk7bGV0IGg7dHJ5e2g9TXQocil9Y2F0Y2h7cmV0dXJuIG51bGx9cmV0dXJuIGgubW11bChpKS50bzFEQXJyYXkoKX0sbG49KHttb2RlbFZpZXdQcm9qZWN0aW9uVHJhbnNmb3JtOm8sbW9kZWxWaWV3VHJhbnNmb3JtOm4scHJvamVjdGlvblRyYW5zZm9ybTplLHdvcmxkQ29vcmQ6dH0pPT57Y29uc3Qgcz1uLHt4OnIseTppLHo6aH09dCxsPUN0KG8scixpKSx1PWwueipsLno7QVswXVswXT1lWzBdWzBdKmwuei91LEFbMF1bMV09ZVswXVsxXSpsLnovdSxBWzBdWzJdPShlWzBdWzJdKmwuei1lWzJdWzJdKmwueCkvdSxBWzFdWzBdPWVbMV1bMF0qbC56L3UsQVsxXVsxXT1lWzFdWzFdKmwuei91LEFbMV1bMl09KGVbMV1bMl0qbC56LWVbMl1bMl0qbC55KS91LE9bMF1bMF09c1swXVsyXSppLE9bMF1bMV09LXNbMF1bMl0qcixPWzBdWzJdPXNbMF1bMV0qci1zWzBdWzBdKmksT1swXVszXT1zWzBdWzBdLE9bMF1bNF09c1swXVsxXSxPWzBdWzVdPXNbMF1bMl0sT1sxXVswXT1zWzFdWzJdKmksT1sxXVsxXT0tc1sxXVsyXSpyLE9bMV1bMl09c1sxXVsxXSpyLXNbMV1bMF0qaSxPWzFdWzNdPXNbMV1bMF0sT1sxXVs0XT1zWzFdWzFdLE9bMV1bNV09c1sxXVsyXSxPWzJdWzBdPXNbMl1bMl0qaSxPWzJdWzFdPS1zWzJdWzJdKnIsT1syXVsyXT1zWzJdWzFdKnItc1syXVswXSppLE9bMl1bM109c1syXVswXSxPWzJdWzRdPXNbMl1bMV0sT1syXVs1XT1zWzJdWzJdO2NvbnN0IGY9W1tdLFtdXTtmb3IobGV0IGc9MDtnPDI7ZysrKWZvcihsZXQgYT0wO2E8NjthKyspe2ZbZ11bYV09MDtmb3IobGV0IGo9MDtqPDM7aisrKWZbZ11bYV0rPUFbZ11bal0qT1tqXVthXX1yZXR1cm4gZn07Y2xhc3MgaG57Y29uc3RydWN0b3Iobil7dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtPW59ZXN0aW1hdGUoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmV9KXtyZXR1cm4gV2Uoe3NjcmVlbkNvb3JkczpuLHdvcmxkQ29vcmRzOmUscHJvamVjdGlvblRyYW5zZm9ybTp0aGlzLnByb2plY3Rpb25UcmFuc2Zvcm19KX1yZWZpbmVFc3RpbWF0ZSh7aW5pdGlhbE1vZGVsVmlld1RyYW5zZm9ybTpuLHdvcmxkQ29vcmRzOmUsc2NyZWVuQ29vcmRzOnR9KXtyZXR1cm4gbm4oe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06bix3b3JsZENvb3JkczplLHNjcmVlbkNvb3Jkczp0LHByb2plY3Rpb25UcmFuc2Zvcm06dGhpcy5wcm9qZWN0aW9uVHJhbnNmb3JtfSl9fWxldCBLdD1udWxsLEp0PSExLEd0PW51bGwsU3Q9bnVsbDtvbm1lc3NhZ2U9bz0+e2NvbnN0e2RhdGE6bn09bztzd2l0Y2gobi50eXBlKXtjYXNlInNldHVwIjpuLnByb2plY3Rpb25UcmFuc2Zvcm0sS3Q9bi5tYXRjaGluZ0RhdGFMaXN0LEp0PW4uZGVidWdNb2RlLEd0PW5ldyBHZShuLmlucHV0V2lkdGgsbi5pbnB1dEhlaWdodCxKdCksU3Q9bmV3IGhuKG4ucHJvamVjdGlvblRyYW5zZm9ybSk7YnJlYWs7Y2FzZSJtYXRjaCI6Y29uc3QgZT1uLnRhcmdldEluZGV4ZXM7bGV0IHQ9LTEscz1udWxsLHI9bnVsbDtmb3IobGV0IGY9MDtmPGUubGVuZ3RoO2YrKyl7Y29uc3QgZz1lW2ZdLHtrZXlmcmFtZUluZGV4OmEsc2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6dyxkZWJ1Z0V4dHJhOnl9PUd0Lm1hdGNoRGV0ZWN0aW9uKEt0W2ddLG4uZmVhdHVyZVBvaW50cyk7aWYocj15LGEhPT0tMSl7Y29uc3QgbT1TdC5lc3RpbWF0ZSh7c2NyZWVuQ29vcmRzOmosd29ybGRDb29yZHM6d30pO20mJih0PWcscz1tKTticmVha319cG9zdE1lc3NhZ2Uoe3R5cGU6Im1hdGNoRG9uZSIsdGFyZ2V0SW5kZXg6dCxtb2RlbFZpZXdUcmFuc2Zvcm06cyxkZWJ1Z0V4dHJhOnJ9KTticmVhaztjYXNlInRyYWNrVXBkYXRlIjpjb25zdHttb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfT1uLHU9U3QucmVmaW5lRXN0aW1hdGUoe2luaXRpYWxNb2RlbFZpZXdUcmFuc2Zvcm06aSx3b3JsZENvb3JkczpoLHNjcmVlbkNvb3JkczpsfSk7cG9zdE1lc3NhZ2Uoe3R5cGU6InRyYWNrVXBkYXRlRG9uZSIsbW9kZWxWaWV3VHJhbnNmb3JtOnV9KTticmVhaztjYXNlImRpc3Bvc2UiOmNsb3NlKCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgbWVzc2FnZSB0eXBlICcke24udHlwZX0nYCl9fX0pKCk7Cg==",WH=typeof window<"u"&&window.Blob&&new Blob([atob(GH)],{type:"text/javascript;charset=utf-8"});function Cke(a){let r;try{if(r=WH&&(window.URL||window.webkitURL).createObjectURL(WH),!r)throw"";const o=new Worker(r,{name:a==null?void 0:a.name});return o.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(r)}),o}catch{return new Worker("data:application/javascript;base64,"+GH,{name:a==null?void 0:a.name})}finally{r&&(window.URL||window.webkitURL).revokeObjectURL(r)}}const Eke=(a,r)=>[[a[0][0]*r[0][0]+a[0][2]*r[2][0],a[0][0]*r[0][1]+a[0][2]*r[2][1],a[0][0]*r[0][2]+a[0][2]*r[2][2],a[0][0]*r[0][3]+a[0][2]*r[2][3]],[a[1][1]*r[1][0]+a[1][2]*r[2][0],a[1][1]*r[1][1]+a[1][2]*r[2][1],a[1][1]*r[1][2]+a[1][2]*r[2][2],a[1][1]*r[1][3]+a[1][2]*r[2][3]],[r[2][0],r[2][1],r[2][2],r[2][3]]],_ke=(a,r,o,c)=>{const h=a[0][0]*r+a[0][1]*o+a[0][3],f=a[1][0]*r+a[1][1]*o+a[1][3],m=a[2][0]*r+a[2][1]*o+a[2][3];return{x:h,y:f,z:m}},Ike=(a,r,o,c)=>{const{x:h,y:f,z:m}=_ke(a,r,o);return{x:h/m,y:f/m}},Ske=6,Tke=1,Mke=10,kke=1,Rke=.8,Lke=1,Hu=1e3;class Bke{constructor(r,o,c,h,f,m=!1){this.markerDimensions=r,this.trackingDataList=o,this.projectionTransform=c,this.debugMode=m,this.trackingKeyframeList=[];for(let A=0;A<o.length;A++)this.trackingKeyframeList.push(o[A][Lke]);let y=0;for(let A=0;A<this.trackingKeyframeList.length;A++)y=Math.max(y,this.trackingKeyframeList[A].points.length);this.featurePointsListT=[],this.imagePixelsListT=[],this.imagePropertiesListT=[];for(let A=0;A<this.trackingKeyframeList.length;A++){const{featurePoints:w,imagePixels:C,imageProperties:_}=this._prebuild(this.trackingKeyframeList[A],y);this.featurePointsListT[A]=w,this.imagePixelsListT[A]=C,this.imagePropertiesListT[A]=_}this.kernelCaches={}}dummyRun(r){let o=[[1,1,1,1],[1,1,1,1],[1,1,1,1]];for(let c=0;c<this.featurePointsListT.length;c++)this.track(r,o,c)}track(r,o,c){let h={};const f=Eke(this.projectionTransform,o),m=this._buildAdjustedModelViewTransform(f);this.markerDimensions[c][0],this.markerDimensions[c][1],this.trackingKeyframeList[c].width,this.trackingKeyframeList[c].height;const y=this.featurePointsListT[c],A=this.imagePixelsListT[c],w=this.imagePropertiesListT[c],C=this._computeProjection(m,r,c),{matchingPointsT:_,simT:T}=this._computeMatching(y,A,w,C),B=_.arraySync(),O=T.arraySync(),U=this.trackingKeyframeList[c],W=[],z=[],X=[];for(let re=0;re<B.length;re++)if(O[re]>Rke&&re<U.points.length){X.push(re);const se=Ike(f,B[re][0],B[re][1]);z.push(se),W.push({x:U.points[re].x/U.scale,y:U.points[re].y/U.scale,z:0})}return this.debugMode&&(h={projectedImage:C.arraySync(),matchingPoints:_.arraySync(),goodTrack:X,trackedPoints:z}),m.dispose(),C.dispose(),_.dispose(),T.dispose(),{worldCoords:W,screenCoords:z,debugExtra:h}}_computeMatching(r,o,c,h){const f=Ske,m=f*2+1,y=Mke*Tke,A=kke,w=y*2+1,C=h.shape[0],_=h.shape[1],T=r.shape[0];if(!this.kernelCaches.computeMatching){const B={variableNames:["features","markerPixels","markerProperties","targetPixels"],outputShape:[T,w*w],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    int featureIndex = coords[0];
	    int searchOffsetIndex = coords[1];

	    int markerWidth = int(getMarkerProperties(0));
	    int markerHeight = int(getMarkerProperties(1));
	    float markerScale = getMarkerProperties(2);

	    int searchOffsetX = imod(searchOffsetIndex, ${w}) * ${A};
	    int searchOffsetY = searchOffsetIndex / ${w} * ${A};

	    int sCenterX = int(getFeatures(featureIndex, 0) * markerScale);
	    int sCenterY = int(getFeatures(featureIndex, 1) * markerScale);

	    int sx = sCenterX + searchOffsetX - ${y};
	    int sy = sCenterY + searchOffsetY - ${y};

	    if (sx < ${f} || sx >= (${_} - ${f}) || sy < ${f} || sy >= (${C} - ${f})) {
	      setOutput(-2.);
	    } 
	    else {
	      float sumPoint = 0.;
	      float sumPointSquare = 0.;
	      float sumTemplate = 0.;
	      float sumTemplateSquare = 0.;
	      float sumPointTemplate = 0.;

	      for (int templateOffsetY = 0; templateOffsetY < ${m}; templateOffsetY++) {
		for (int templateOffsetX = 0; templateOffsetX < ${m}; templateOffsetX++) {
		  int fx2 = sCenterX + templateOffsetX - ${f};
		  int fy2 = sCenterY + templateOffsetY - ${f};

		  int sx2 = sx + templateOffsetX - ${f};
		  int sy2 = sy + templateOffsetY - ${f};

		  int markerPixelIndex = fy2 * markerWidth + fx2;
		  float markerPixel = getMarkerPixels(markerPixelIndex);
		  float targetPixel = getTargetPixels(sy2, sx2);

		  sumTemplate += markerPixel;
		  sumTemplateSquare += markerPixel * markerPixel;
		  sumPoint += targetPixel;
		  sumPointSquare += targetPixel * targetPixel;
		  sumPointTemplate += targetPixel * markerPixel;
		}
	      }

	      // Normalized cross-correlation
	      // !important divide first avoid overflow (e.g. sumPoint / count * sumPoint)
	      float count = float(${m} * ${m});
	      float pointVariance = sqrt(sumPointSquare - sumPoint / count * sumPoint);
	      float templateVariance = sqrt(sumTemplateSquare - sumTemplate / count * sumTemplate);

	      if (pointVariance < 0.0000001) {
		setOutput(-3.);
	      } else if (templateVariance < 0.0000001) {
		//setOutput(sumTemplate);
		setOutput(-4.);
	      } else {
		sumPointTemplate -= sumPoint / count * sumTemplate;
		float sim = sumPointTemplate / pointVariance / templateVariance;  
		setOutput(sim);
	      }
	    }
	  }
	`},O={variableNames:["featurePoints","markerProperties","maxIndex"],outputShape:[T,2],userCode:`
	  void main() {
	    ivec2 coords = getOutputCoords();

	    float markerScale = getMarkerProperties(2);

	    int featureIndex = coords[0];

	    int maxIndex = int(getMaxIndex(featureIndex));
	    int searchLocationIndex = maxIndex / ${w*w};
	    int searchOffsetIndex = imod(maxIndex, ${w*w});

	    if (coords[1] == 0) {
	      int searchOffsetX = imod(searchOffsetIndex, ${w}) * ${A};
	      setOutput(getFeaturePoints(featureIndex, 0) + float(searchOffsetX - ${y}) / markerScale);
	    }
	    else if (coords[1] == 1) {
	      int searchOffsetY = searchOffsetIndex / ${w} * ${A};
	      setOutput(getFeaturePoints(featureIndex, 1) + float(searchOffsetY - ${y}) / markerScale);
	    }
	  }
	`},U={variableNames:["sims","maxIndex"],outputShape:[T],userCode:`
	  void main() {
	    int featureIndex = getOutputCoords();
	    int maxIndex = int(getMaxIndex(featureIndex));
	    setOutput(getSims(featureIndex, maxIndex));
	  }
	`};this.kernelCaches.computeMatching=[B,O,U]}return Qe(()=>{const B=this.kernelCaches.computeMatching,O=this._compileAndRun(B[0],[r,o,c,h]),U=O.argMax(1),W=this._compileAndRun(B[1],[r,c,U]),z=this._compileAndRun(B[2],[O,U]);return{matchingPointsT:W,simT:z}})}_computeProjection(r,o,c){const h=this.trackingKeyframeList[c].width,f=this.trackingKeyframeList[c].height,m=this.trackingKeyframeList[c].scale,y=h+"-"+f+"-"+m;if(this.kernelCaches.computeProjection||(this.kernelCaches.computeProjection={}),!this.kernelCaches.computeProjection[y]){const A={variableNames:["M","pixel"],outputShape:[f,h],userCode:`
	  void main() {
	      ivec2 coords = getOutputCoords();

	      float m00 = getM(0, 0) * ${Hu}.;
	      float m01 = getM(0, 1) * ${Hu}.;
	      float m03 = getM(0, 3) * ${Hu}.;
	      float m10 = getM(1, 0) * ${Hu}.;
	      float m11 = getM(1, 1) * ${Hu}.;
	      float m13 = getM(1, 3) * ${Hu}.;
	      float m20 = getM(2, 0) * ${Hu}.;
	      float m21 = getM(2, 1) * ${Hu}.;
	      float m23 = getM(2, 3) * ${Hu}.;

	      float y = float(coords[0]) / float(${m});
	      float x = float(coords[1]) / float(${m});
	      float uz = (x * m20) + (y * m21) + m23;
	      float oneOverUz = 1. / uz;

	      float ux = (x * m00) + (y * m01) + m03;
	      float uy = (x * m10) + (y * m11) + m13;

	      ux = floor(ux * oneOverUz + 0.5);
	      uy = floor(uy * oneOverUz + 0.5);
	      setOutput(getPixel(int(uy), int(ux)));
	    }
	`};this.kernelCaches.computeProjection[y]=A}return Qe(()=>{const A=this.kernelCaches.computeProjection[y];return this._compileAndRun(A,[r,o])})}_buildAdjustedModelViewTransform(r){return Qe(()=>{let o=[];for(let c=0;c<r.length;c++){o.push([]);for(let h=0;h<r[c].length;h++)o[c].push(r[c][h]/Hu)}return pl(o,[3,4])})}_prebuild(r,o){return Qe(()=>{const c=r.scale,h=[];for(let y=0;y<o;y++)y<r.points.length?h.push([r.points[y].x/c,r.points[y].y/c]):h.push([-1,-1]);const f=pl(r.data,[r.width*r.height]),m=pl([r.width,r.height,r.scale],[3]);return{featurePoints:pl(h,[h.length,2],"float32"),imagePixels:f,imageProperties:m}})}_compileAndRun(r,o){const c=uf().compileAndRun(r,o);return cr().makeTensorFromDataId(c.dataId,c.shape,c.dtype)}}const FC=[{sigma:.55,points:[[-1,0],[-.5,-.866025],[.5,-.866025],[1,-0],[.5,.866025],[-.5,.866025]]},{sigma:.475,points:[[0,.930969],[-.806243,.465485],[-.806243,-.465485],[-0,-.930969],[.806243,-.465485],[.806243,.465485]]},{sigma:.4,points:[[.847306,-0],[.423653,.733789],[-.423653,.733789],[-.847306,0],[-.423653,-.733789],[.423653,-.733789]]},{sigma:.325,points:[[-0,-.741094],[.641806,-.370547],[.641806,.370547],[0,.741094],[-.641806,.370547],[-.641806,-.370547]]},{sigma:.25,points:[[-.595502,0],[-.297751,-.51572],[.297751,-.51572],[.595502,-0],[.297751,.51572],[-.297751,.51572]]},{sigma:.175,points:[[0,.362783],[-.314179,.181391],[-.314179,-.181391],[-0,-.362783],[.314179,-.181391],[.314179,.181391]]},{sigma:.1,points:[[0,0]]}],Um=[];for(let a=0;a<FC.length;a++){const r=FC[a].sigma;for(let o=0;o<FC[a].points.length;o++){const c=FC[a].points[o];Um.push([r,c[0],c[1]])}}const KR={};function Pke(a){const r=a.shape[1],o=a.shape[0],c="w"+r+"h"+o;if(!KR.hasOwnProperty(c)){const h={variableNames:["p"],outputShape:[o,r],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0], coords[1]-2);
          sum += getP(coords[0], coords[1]-1) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0], coords[1]+1) * 4.;
          sum += getP(coords[0], coords[1]+2);
          setOutput(sum);
        }
      `},f={variableNames:["p"],outputShape:[o,r],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();

          float sum = getP(coords[0]-2, coords[1]);
          sum += getP(coords[0]-1, coords[1]) * 4.;
          sum += getP(coords[0], coords[1]) * 6.;
          sum += getP(coords[0]+1, coords[1]) * 4.;
          sum += getP(coords[0]+2, coords[1]);
          sum /= 256.;
          setOutput(sum);
        }
      `};KR[c]=[h,f]}return KR[c]}const Nke={kernelName:"BinomialFilter",backendName:"webgl",kernelFunc:a=>{const r=a.inputs.image,o=a.backend,[c,h]=Pke(r),f=o.runWebGLProgram(c,[r],r.dtype),m=o.runWebGLProgram(h,[f],r.dtype);return o.disposeIntermediateTensorInfo(f),m}},OC=7,HH=3,Dke=HH*HH,ZR=4,Fke=(ZR+1)*(ZR+1)/ZR,jR={};function Oke(a){const r=a.shape[1],o=a.shape[0],c="w"+r+"h"+o;if(!jR.hasOwnProperty(c)){const h={variableNames:["image0","image1","image2"],outputShape:[o,r],userCode:`
        void main() {
          ivec2 coords = getOutputCoords();
    
          int y = coords[0];
          int x = coords[1];
    
          float value = getImage1(y, x);
    
          // Step 1: find local maxima/minima
          if (value * value < ${Dke}.) {
            setOutput(0.);
            return;
          }
          if (y < ${OC} || y > ${o-1-OC}) {
            setOutput(0.);
            return;
          }
          if (x < ${OC} || x > ${r-1-OC}) {
            setOutput(0.);
            return;
          }
    
          bool isMax = true;
          bool isMin = true;
          for (int dy = -1; dy <= 1; dy++) {
            for (int dx = -1; dx <= 1; dx++) {
              float value0 = getImage0(y+dy, x+dx);
              float value1 = getImage1(y+dy, x+dx);
              float value2 = getImage2(y+dy, x+dx);
    
        if (value < value0 || value < value1 || value < value2) {
          isMax = false;
        }
        if (value > value0 || value > value1 || value > value2) {
          isMin = false;
        }
            }
          }
    
          if (!isMax && !isMin) {
            setOutput(0.);
            return;
          }
    
          // compute edge score and reject based on threshold
          float dxx = getImage1(y, x+1) + getImage1(y, x-1) - 2. * getImage1(y, x);
          float dyy = getImage1(y+1, x) + getImage1(y-1, x) - 2. * getImage1(y, x);
          float dxy = 0.25 * (getImage1(y-1,x-1) + getImage1(y+1,x+1) - getImage1(y-1,x+1) - getImage1(y+1,x-1));
    
          float det = (dxx * dyy) - (dxy * dxy);
    
          if (abs(det) < 0.0001) { // determinant undefined. no solution
            setOutput(0.);
            return;
          }
    
          float edgeScore = (dxx + dyy) * (dxx + dyy) / det;
    
          if (abs(edgeScore) >= ${Fke} ) {
            setOutput(0.);
            return;
          }
          setOutput(getImage1(y,x));
        }
      `};jR[c]=h}return jR[c]}const Vke={kernelName:"BuildExtremas",backendName:"webgl",kernelFunc:a=>{let{image0:r,image1:o,image2:c}=a.inputs;const h=a.backend,f=Oke(o);return r=cr().runKernel("DownsampleBilinear",{image:r}),c=cr().runKernel("UpsampleBilinear",{image:c,targetImage:o}),h.runWebGLProgram(f,[r,o,c],o.dtype)}},ub=36,YR={};function Uke(a){const r=a.shape[0];if(!YR.hasOwnProperty(r)){const o={variableNames:["histogram"],outputShape:[a.shape[0]],userCode:`
            void main() {
                int featureIndex = getOutputCoords();

                int maxIndex = 0;
                for (int i = 1; i < ${ub}; i++) {
                    if (getHistogram(featureIndex, i) > getHistogram(featureIndex, maxIndex)) {
                        maxIndex = i;
                    }
                }

                int prev = imod(maxIndex - 1 + ${ub}, ${ub});
                int next = imod(maxIndex + 1, ${ub});

                /**
                 * Fit a quatratic to 3 points. The system of equations is:
                 *
                 * y0 = A*x0^2 + B*x0 + C
                 * y1 = A*x1^2 + B*x1 + C
                 * y2 = A*x2^2 + B*x2 + C
                 *
                 * This system of equations is solved for A,B,C.
                 */
                float p10 = float(maxIndex - 1);
                float p11 = getHistogram(featureIndex, prev); 
                float p20 = float(maxIndex);
                float p21 = getHistogram(featureIndex, maxIndex); 
                float p30 = float(maxIndex + 1);
                float p31 = getHistogram(featureIndex, next); 

                float d1 = (p30-p20)*(p30-p10);
                float d2 = (p10-p20)*(p30-p10);
                float d3 = p10-p20;

                // If any of the denominators are zero then, just use maxIndex.
                    float fbin = float(maxIndex);
                if ( abs(d1) > 0.00001 && abs(d2) > 0.00001 && abs(d3) > 0.00001) {
                float a = p10*p10;
                float b = p20*p20;

                // Solve for the coefficients A,B,C
                float A = ((p31-p21)/d1)-((p11-p21)/d2);
                float B = ((p11-p21)+(A*(b-a)))/d3;
                float C = p11-(A*a)-(B*p10);
                fbin = -B / (2. * A);
                }

                float an = 2.0 *${Math.PI} * (fbin + 0.5) / ${ub}. - ${Math.PI};
                setOutput(an);
            }
            `};YR[r]=o}return YR[r]}const zke={kernelName:"ComputeExtremaAngles",backendName:"webgl",kernelFunc:a=>{const{histograms:r}=a.inputs,o=a.backend,c=Uke(r);return o.runWebGLProgram(c,[r],r.dtype)}},XH=7,qR={};function Gke(a,r){const o=`${a}|${r.shape[0]}`;if(!qR.hasOwnProperty(o)){const c=[];for(let m=1;m<a;m++)c.push("image"+m);let h="float getPixel(int octave, int y, int x) {";for(let m=1;m<a;m++)h+=`
  if (octave == ${m}) {
	return getImage${m}(y, x);
  }
`;h+="}";const f={variableNames:[...c,"extrema","angles","freakPoints"],outputShape:[r.shape[0],Um.length],userCode:`
  ${h}
  void main() {
	ivec2 coords = getOutputCoords();
	int featureIndex = coords[0];
	int freakIndex = coords[1];

	float freakSigma = getFreakPoints(freakIndex, 0);
	float freakX = getFreakPoints(freakIndex, 1);
	float freakY = getFreakPoints(freakIndex, 2);

	int octave = int(getExtrema(featureIndex, 1));
	float inputY = getExtrema(featureIndex, 2);
	float inputX = getExtrema(featureIndex, 3);
	float inputAngle = getAngles(featureIndex);
	float cos = ${XH}. * cos(inputAngle);
	float sin = ${XH}. * sin(inputAngle);

	float yp = inputY + freakX * sin + freakY * cos;
	float xp = inputX + freakX * cos + freakY * -sin;

	int x0 = int(floor(xp));
	int x1 = x0 + 1;
	int y0 = int(floor(yp));
	int y1 = y0 + 1;

	float f1 = getPixel(octave, y0, x0);
	float f2 = getPixel(octave, y0, x1);
	float f3 = getPixel(octave, y1, x0);
	float f4 = getPixel(octave, y1, x1);

	float x1f = float(x1);
	float y1f = float(y1);
	float x0f = float(x0);
	float y0f = float(y0);

	// ratio for interpolation between four neighbouring points
	float value = (x1f - xp) * (y1f - yp) * f1
		+ (xp - x0f) * (y1f - yp) * f2
		+ (x1f - xp) * (yp - y0f) * f3
		+ (xp - x0f) * (yp - y0f) * f4;

	setOutput(value);
  }
`};qR[o]=f}return qR[o]}const Wke={kernelName:"ComputeExtremaFreak",backendName:"webgl",kernelFunc:a=>{const{gaussianImagesT:r,prunedExtremas:o,prunedExtremasAngles:c,freakPointsT:h,pyramidImagesLength:f}=a.inputs,m=a.backend,y=Gke(f,o);return m.runWebGLProgram(y,[...r,o,c,h],"float32")}},$H=(Um.length-1)*Um.length/2,Hke=Math.ceil($H/8),JR={};function Xke(a){const r=`${a.shape[0]}`;if(!JR.hasOwnProperty(r)){const o={variableNames:["freak","p"],outputShape:[a.shape[0],Hke],userCode:`
  void main() {
    ivec2 coords = getOutputCoords();
    int featureIndex = coords[0];
    int descIndex = coords[1] * 8;

    int sum = 0;
    for (int i = 0; i < 8; i++) {
      if (descIndex + i >= ${$H}) {
        continue;
      }

      int p1 = int(getP(descIndex + i, 0));
      int p2 = int(getP(descIndex + i, 1));

      float v1 = getFreak(featureIndex, p1);
      float v2 = getFreak(featureIndex, p2);

      if (v1 < v2 + 0.01) {
        sum += int(pow(2.0, float(7 - i)));
      }
    }
    setOutput(float(sum));
  }
`};JR[r]=o}return JR[r]}const $ke={kernelName:"ComputeFreakDescriptors",backendName:"webgl",kernelFunc:a=>{const{extremaFreaks:r,positionT:o}=a.inputs,{backend:c}=a,h=Xke(r);return c.runWebGLProgram(h,[r,o],"int32")}},eL={};function Qke(a,r){const o=`${a}|${r}`;if(!eL.hasOwnProperty(o)){const c=[];let h="float getPixel(int octave, int y, int x) {";for(let f=1;f<a;f++)c.push("image"+f),h+=`
				if (octave == ${f}) {
					return getImage${f}(y, x);
				}
			`;h+="}",eL[o]={variableNames:[...c,"extrema"],outputShape:[r,3,3],userCode:`
			${h}
		
			void main() {
				ivec3 coords = getOutputCoords();
				int featureIndex = coords[0];
				float score = getExtrema(featureIndex, 0);
				if (score == 0.0) {
					return;
				}
		
				int dy = coords[1]-1;
				int dx = coords[2]-1;
				int octave = int(getExtrema(featureIndex, 1));
				int y = int(getExtrema(featureIndex, 2));
				int x = int(getExtrema(featureIndex, 3));
				setOutput(getPixel(octave, y+dy, x+dx));
			}
			`}}return eL[o]}const Kke={kernelName:"ComputeLocalization",backendName:"webgl",kernelFunc:a=>{const{prunedExtremasList:r,dogPyramidImagesT:o}=a.inputs,c=a.backend,h=Qke(o.length,r.length),f=pl(r,[r.length,r[0].length],"int32");return c.runWebGLProgram(h,[...o.slice(1),f],o[0].dtype)}},Zke=.159154943091895,iy=36,tL={};function jke(a,r,o){const c=`${o}|${a.shape[0]}|${r.shape[0]}`;if(!tL.hasOwnProperty(c)){const h=[];for(let A=1;A<o;A++)h.push("image"+A);let f="float getPixel(int octave, int y, int x) {";for(let A=1;A<o;A++)f+=`
            if (octave == ${A}) {
                return getImage${A}(y, x);
            }
            `;f+="}";const m={variableNames:[...h,"extrema","radial"],outputShape:[a.shape[0],r.shape[0],2],userCode:`
                ${f}

                void main() {
                    ivec3 coords = getOutputCoords();
                    int featureIndex = coords[0];
                    int radialIndex = coords[1];
                    int propertyIndex = coords[2];

                    int radialY = int(getRadial(radialIndex, 0));
                    int radialX = int(getRadial(radialIndex, 1));
                    float radialW = getRadial(radialIndex, 2);

                    int octave = int(getExtrema(featureIndex, 1));
                    int y = int(getExtrema(featureIndex, 2));
                    int x = int(getExtrema(featureIndex, 3));

                    int xp = x + radialX;
                    int yp = y + radialY;

                    float dy = getPixel(octave, yp+1, xp) - getPixel(octave, yp-1, xp);
                    float dx = getPixel(octave, yp, xp+1) - getPixel(octave, yp, xp-1);

                    if (propertyIndex == 0) {
                    // be careful that atan(0, 0) gives 1.57 instead of 0 (different from js), but doesn't matter here, coz magnitude is 0
                    
                    float angle = atan(dy, dx) + ${Math.PI};
                    float fbin = angle * ${iy}. * ${Zke};
                    setOutput(fbin);
                    return;
                    }

                    if (propertyIndex == 1) {
                        float mag = sqrt(dx * dx + dy * dy);
                        float magnitude = radialW * mag;
                        setOutput(magnitude);
                        return;
                    }
                }

                `},y={variableNames:["fbinMag"],outputShape:[a.shape[0],iy],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int featureIndex = coords[0];
                int binIndex = coords[1];

                float sum = 0.;
                for (int i = 0; i < ${r.shape[0]}; i++) {
                    float fbin = getFbinMag(featureIndex, i, 0);
                    int bin = int(floor(fbin - 0.5));
                    int b1 = imod(bin + ${iy}, ${iy});
                    int b2 = imod(bin + 1 + ${iy}, ${iy});

                    if (b1 == binIndex || b2 == binIndex) {
                        float magnitude = getFbinMag(featureIndex, i, 1);
                        float w2 = fbin - float(bin) - 0.5;
                        float w1 = w2 * -1. + 1.;

                        if (b1 == binIndex) {
                            sum += w1 * magnitude;
                        }
                        if (b2 == binIndex) {
                            sum += w2 * magnitude;
                        }
                    }
                }
                setOutput(sum);
            }
            `};tL[c]=[m,y]}return tL[c]}const Yke={kernelName:"ComputeOrientationHistograms",backendName:"webgl",kernelFunc:a=>{const{gaussianImagesT:r,prunedExtremasT:o,radialPropertiesT:c,pyramidImagesLength:h}=a.inputs,f=a.backend,[m,y]=jke(o,c,h),A=f.runWebGLProgram(m,[...r,o,c],c.dtype),w=f.runWebGLProgram(y,[A],c.dtype);return f.disposeIntermediateTensorInfo(A),w}},nL={};function qke(a){const r=a.shape[1],o=a.shape[0],c="w"+r+"h"+o;if(!nL.hasOwnProperty(c)){const h={variableNames:["p"],outputShape:[Math.floor(o/2),Math.floor(r/2)],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();
                int y = coords[0] * 2;
                int x = coords[1] * 2;
        
                float sum = getP(y, x) * 0.25;
                sum += getP(y+1,x) * 0.25; 
                sum += getP(y, x+1) * 0.25; 
                sum += getP(y+1,x+1) * 0.25;
                setOutput(sum);
            }
            `};nL[c]=h}return nL[c]}const Jke={kernelName:"DownsampleBilinear",backendName:"webgl",kernelFunc:a=>{const r=a.inputs.image,o=a.backend,c=qke(r);return o.runWebGLProgram(c,[r],r.dtype)}},eRe={kernelName:"ExtremaReduction",backendName:"webgl",kernelFunc:a=>{const{extremasResultT:r}=a.inputs,o=a.backend,c=r.shape[0],h=r.shape[1],f={variableNames:["extrema"],outputShape:[Math.floor(c/2),Math.floor(h/2)],userCode:`
		  void main() {
			ivec2 coords = getOutputCoords();
			int y = coords[0] * 2;
			int x = coords[1] * 2;
  
			float location = 0.0;
			float values = getExtrema(y, x);
  
			if (getExtrema(y+1, x) != 0.0) {
			  location = 1.0;
		  values = getExtrema(y+1, x);
			}
			else if (getExtrema(y, x+1) != 0.0) {
			  location = 2.0;
		  values = getExtrema(y, x+1);
			}
			else if (getExtrema(y+1, x+1) != 0.0) {
			  location = 3.0;
		  values = getExtrema(y+1, x+1);
			}
  
			if (values < 0.0) {
			  setOutput(location * -1000.0 + values);
			} else {
			  setOutput(location * 1000.0 + values);
			}
		  }
		`};return o.runWebGLProgram(f,[r],r.dtype)}},VC=36,tRe=5,iL={};function nRe(a){const r=`h${a.shape[0]}`;if(!iL.hasOwnProperty(r)){const o={variableNames:["histogram"],outputShape:[a.shape[0],VC],userCode:`
            void main() {
                ivec2 coords = getOutputCoords();

                int featureIndex = coords[0];
                int binIndex = coords[1];

                int prevBin = imod(binIndex - 1 + ${VC}, ${VC});
                int nextBin = imod(binIndex + 1, ${VC});
                float result = 0.274068619061197 * getHistogram(featureIndex, prevBin) + 0.451862761877606 * getHistogram(featureIndex, binIndex) + 0.274068619061197 * getHistogram(featureIndex, nextBin);

                setOutput(result);
            }
            `};iL[r]=o}return iL[r]}const iRe={kernelName:"SmoothHistograms",backendName:"webgl",kernelFunc:a=>{let{histograms:r}=a.inputs;const o=a.backend,c=nRe(r);for(let h=0;h<tRe;h++){const f=r;r=o.runWebGLProgram(c,[r],r.dtype),h>0&&o.disposeIntermediateTensorInfo(f)}return r}},rL={};function rRe(a,r){const o=r.shape[1],c=r.shape[0],h="w"+o+"h"+c;if(!rL.hasOwnProperty(h)){const f={variableNames:["p"],outputShape:[c,o],userCode:`
              void main() {
                ivec2 coords = getOutputCoords();
                int j = coords[0];
                int i = coords[1];
        
                float sj = 0.5 * float(j) - 0.25; 
                float si = 0.5 * float(i) - 0.25;
        
                float sj0 = floor(sj);
                float sj1 = ceil(sj);
                float si0 = floor(si);
                float si1 = ceil(si);
        
                int sj0I = int(sj0);
                int sj1I = int(sj1);
                int si0I = int(si0);
                int si1I = int(si1);
        
                float sum = 0.0;
                sum += getP(sj0I, si0I) * (si1 - si) * (sj1 - sj);
                sum += getP(sj1I, si0I) * (si1 - si) * (sj - sj0);
                sum += getP(sj0I, si1I) * (si - si0) * (sj1 - sj);
                sum += getP(sj1I, si1I) * (si - si0) * (sj - sj0);
                setOutput(sum);
              }
            `};rL[h]=f}return rL[h]}const sRe={kernelName:"UpsampleBilinear",backendName:"webgl",kernelFunc:a=>{const{image:r,targetImage:o}=a.inputs,c=a.backend,h=rRe(r,o);return c.runWebGLProgram(h,[r],r.dtype)}};la(Nke),la(Vke),la(zke),la(Wke),la($ke),la(Kke),la(Yke),la(Jke),la(eRe),la(iRe),la(sRe);const QH=8,oRe=5,hb=10,aRe=5,sL=3,lRe=1.5;(Um.length-1)*Um.length/2;class KH{constructor(r,o,c=!1){this.debugMode=c,this.width=r,this.height=o;let h=0;for(;r>=QH&&o>=QH&&(r/=2,o/=2,h++,h!==oRe););this.numOctaves=h,this.tensorCaches={},this.kernelCaches={}}detectImageData(r){const o=new Uint8ClampedArray(4*r.length);for(let h=0;h<r.length;h++)o[4*h]=r[h],o[4*h+1]=r[h],o[4*h+2]=r[h],o[4*h+3]=255;const c=new ImageData(o,this.width,this.height);return this.detect(c)}detect(r){let o=null;const c=[];for(let z=0;z<this.numOctaves;z++){let X,re;z===0?X=this._applyFilter(r):X=this._downsampleBilinear(c[z-1][c[z-1].length-1]),re=this._applyFilter(X),c.push([X,re])}const h=[];for(let z=0;z<this.numOctaves;z++){let X=this._differenceImageBinomial(c[z][0],c[z][1]);h.push(X)}const f=[];for(let z=1;z<this.numOctaves-1;z++){const X=this._buildExtremas(h[z-1],h[z],h[z+1]);f.push(X)}const m=this._applyPrune(f),y=this._computeLocalization(m,h),A=this._computeOrientationHistograms(y,c),w=this._smoothHistograms(A),C=this._computeExtremaAngles(w),_=this._computeExtremaFreak(c,y,C),T=this._computeFreakDescriptors(_),B=y.arraySync(),O=C.arraySync(),U=T.arraySync();this.debugMode&&(o={pyramidImages:c.map(z=>z.map(X=>X.arraySync())),dogPyramidImages:h.map(z=>z?z.arraySync():null),extremasResults:f.map(z=>z.arraySync()),extremaAngles:C.arraySync(),prunedExtremas:m,localizedExtremas:y.arraySync()}),c.forEach(z=>z.forEach(X=>X.dispose())),h.forEach(z=>z&&z.dispose()),f.forEach(z=>z.dispose()),y.dispose(),A.dispose(),w.dispose(),C.dispose(),_.dispose(),T.dispose();const W=[];for(let z=0;z<B.length;z++){if(B[z][0]==0)continue;const X=[];for(let be=0;be<U[z].length;be+=4){const Se=U[z][be],Be=U[z][be+1],Ye=U[z][be+2],et=U[z][be+3];let tt=Se*16777216+Be*65536+Ye*256+et;X.push(tt)}const re=B[z][1],se=B[z][2],le=B[z][3]*Math.pow(2,re)+Math.pow(2,re-1)-.5,ge=se*Math.pow(2,re)+Math.pow(2,re-1)-.5,ye=Math.pow(2,re);W.push({maxima:B[z][0]>0,x:le,y:ge,scale:ye,angle:O[z],descriptors:X})}return{featurePoints:W,debugExtra:o}}_computeFreakDescriptors(r){if(!this.tensorCaches.computeFreakDescriptors){const c=[],h=[];for(let y=0;y<r.shape[1];y++)for(let A=y+1;A<r.shape[1];A++)c.push(y),h.push(A);const f=pl(c,[c.length]).cast("int32"),m=pl(h,[h.length]).cast("int32");this.tensorCaches.computeFreakDescriptors={positionT:ml(Pu([f,m],1))}}const{positionT:o}=this.tensorCaches.computeFreakDescriptors;return Qe(()=>cr().runKernel("ComputeFreakDescriptors",{extremaFreaks:r,positionT:o}))}_computeExtremaFreak(r,o,c){this.tensorCaches._computeExtremaFreak||Qe(()=>{const m=pl(Um);this.tensorCaches._computeExtremaFreak={freakPointsT:ml(m)}});const{freakPointsT:h}=this.tensorCaches._computeExtremaFreak,f=[];for(let m=1;m<r.length;m++)f.push(r[m][1]);return Qe(()=>cr().runKernel("ComputeExtremaFreak",{gaussianImagesT:f,prunedExtremas:o,prunedExtremasAngles:c,freakPointsT:h,pyramidImagesLength:r.length}))}_computeExtremaAngles(r){return Qe(()=>cr().runKernel("ComputeExtremaAngles",{histograms:r}))}_computeOrientationHistograms(r,o){const c=[];for(let f=1;f<o.length;f++)c.push(o[f][1]);this.tensorCaches.orientationHistograms||Qe(()=>{const f=-1/(2*sL*sL),m=sL*lRe,y=Math.ceil(m),A=[];for(let w=-y;w<=y;w++)for(let C=-y;C<=y;C++){const _=C*C+w*w;if(_<=m*m){const T=_*f;let B=(720+T*(720+T*(360+T*(120+T*(30+T*(6+T))))))*.0013888888;A.push([w,C,B])}}this.tensorCaches.orientationHistograms={radialPropertiesT:ml(pl(A,[A.length,3]))}});const{radialPropertiesT:h}=this.tensorCaches.orientationHistograms;return Qe(()=>cr().runKernel("ComputeOrientationHistograms",{gaussianImagesT:c,prunedExtremasT:r,radialPropertiesT:h,pyramidImagesLength:o.length}))}_smoothHistograms(r){return Qe(()=>cr().runKernel("SmoothHistograms",{histograms:r}))}_computeLocalization(r,o){return Qe(()=>{const c=cr().runKernel("ComputeLocalization",{prunedExtremasList:r,dogPyramidImagesT:o}).arraySync(),h=[];for(let m=0;m<c.length;m++){h.push([]);for(let y=0;y<c[m].length;y++)h[m].push([])}const f=[];for(let m=0;m<r.length;m++)f[m]=[r[m][0],r[m][1],r[m][2],r[m][3]];for(let m=0;m<f.length;m++){if(f[m][0]===0)continue;const y=c[m],A=.5*(y[1][2]-y[1][0]),w=.5*(y[2][1]-y[0][1]),C=y[1][2]+y[1][0]-2*y[1][1],_=y[2][1]+y[0][1]-2*y[1][1],T=.25*(y[0][0]+y[2][2]-y[0][2]-y[2][0]),B=C*_-T*T,O=(_*-A+-T*-w)/B,U=(-T*-A+C*-w)/B,W=f[m][2]+U,z=f[m][3]+O;Math.abs(B)<1e-4||(f[m][2]=W,f[m][3]=z)}return pl(f,[f.length,f[0].length],"float32")})}_applyPrune(r){const o=hb*hb,c=aRe,h=[],f=[];for(let y=0;y<o;y++){f.push([]),h.push([]);for(let A=0;A<c;A++)f[y].push([0,0,0,0]),h[y].push(0)}Qe(()=>{for(let y=0;y<r.length;y++){const A=cr().runKernel("ExtremaReduction",{extremasResultT:r[y]}),w=y+1,C=A.arraySync(),_=A.shape[0],T=A.shape[1],B=T*2/hb,O=_*2/hb;for(let U=0;U<_;U++)for(let W=0;W<T;W++){const z=C[U][W];if(z==0)continue;const X=z%1e3,re=Math.floor(Math.abs(z)/1e3),se=W*2+(re===2||re===3?1:0),le=U*2+(re===1||re===3?1:0),ge=Math.floor(se/B),ye=Math.floor(le/O)*hb+ge,be=Math.abs(X);let Se=c;for(;Se>=1&&be>h[ye][Se-1];)Se-=1;if(Se<c){for(let Be=c-1;Be>=Se+1;Be--)h[ye][Be]=h[ye][Be-1],f[ye][Be][0]=f[ye][Be-1][0],f[ye][Be][1]=f[ye][Be-1][1],f[ye][Be][2]=f[ye][Be-1][2],f[ye][Be][3]=f[ye][Be-1][3];h[ye][Se]=be,f[ye][Se][0]=X,f[ye][Se][1]=w,f[ye][Se][2]=le,f[ye][Se][3]=se}}}});const m=[];for(let y=0;y<o;y++)for(let A=0;A<c;A++)m.push(f[y][A]);return m}_buildExtremas(r,o,c){return Qe(()=>cr().runKernel("BuildExtremas",{image0:r,image1:o,image2:c}))}_differenceImageBinomial(r,o){return Qe(()=>r.sub(o))}_applyFilter(r){return Qe(()=>cr().runKernel("BinomialFilter",{image:r}))}_downsampleBilinear(r){return Qe(()=>cr().runKernel("DownsampleBilinear",{image:r}))}_compileAndRun(r,o){const c=uf().compileAndRun(r,o);return cr().makeTensorFromDataId(c.dataId,c.shape,c.dtype)}_runWebGLProgram(r,o,c){const h=uf().runWebGLProgram(r,o,c);return cr().makeTensorFromDataId(h.dataId,h.shape,h.dtype)}}class cRe{constructor(r,o,c=!1){this.debugMode=c,this.width=r,this.height=o;let h=Math.min(r,o)/2,f=Math.pow(2,Math.round(Math.log(h)/Math.log(2)));this.cropSize=f,this.detector=new KH(f,f,c),this.kernelCaches={},this.lastRandomIndex=4}detect(r){const o=Math.floor(this.height/2-this.cropSize/2),c=Math.floor(this.width/2-this.cropSize/2),h=this._detect(r,c,o);return this.debugMode&&(h.debugExtra.crop={startX:c,startY:o,cropSize:this.cropSize}),h}detectMoving(r){const o=this.lastRandomIndex%3,c=Math.floor(this.lastRandomIndex/3);let h=Math.floor(this.height/2-this.cropSize+c*this.cropSize/2),f=Math.floor(this.width/2-this.cropSize+o*this.cropSize/2);return f<0&&(f=0),h<0&&(h=0),f>=this.width-this.cropSize&&(f=this.width-this.cropSize-1),h>=this.height-this.cropSize&&(h=this.height-this.cropSize-1),this.lastRandomIndex=(this.lastRandomIndex+1)%9,this._detect(r,f,h)}_detect(r,o,c){const h=r.slice([c,o],[this.cropSize,this.cropSize]),{featurePoints:f,debugExtra:m}=this.detector.detect(h);return f.forEach(y=>{y.x+=o,y.y+=c}),this.debugMode&&(m.projectedImage=h.arraySync()),h.dispose(),{featurePoints:f,debugExtra:m}}}const ZH=({image:a,ratio:r})=>{const o=Math.round(a.width*r),c=Math.round(a.height*r),h=new Uint8Array(o*c);for(let f=0;f<o;f++){let m=Math.round(1*f/r),y=Math.round(1*(f+1)/r)-1;y>=a.width&&(y=a.width-1);for(let A=0;A<c;A++){let w=Math.round(1*A/r),C=Math.round(1*(A+1)/r)-1;C>=a.height&&(C=a.height-1);let _=0,T=0;for(let B=m;B<=y;B++)for(let O=w;O<=C;O++)_+=1*a.data[O*a.width+B],T+=1;h[A*o+f]=Math.floor(_/T)}}return{data:h,width:o,height:c}},uRe=100,hRe=a=>{const r=uRe/Math.min(a.width,a.height),o=[];let c=r;for(;;)if(o.push(c),c*=Math.pow(2,1/3),c>=.95){c=1;break}o.push(c),o.reverse();const h=[];for(let f=0;f<o.length;f++)a.width*o[f],a.height*o[f],h.push(Object.assign(ZH({image:a,ratio:o[f]}),{scale:o[f]}));return h},dRe=a=>{const r=Math.min(a.width,a.height),o=[],c=[];o.push(256/r),o.push(128/r);for(let h=0;h<o.length;h++)c.push(Object.assign(ZH({image:a,ratio:o[h]}),{scale:o[h]}));return c},fRe=a=>{const{v1:r,v2:o}=a;let c=0;for(let h=0;h<r.length;h++){let f=(r[h]^o[h])>>>0;c+=pRe(f)}return c},pRe=a=>{var r=a-(a>>1&1431655765);return r=(r>>2&858993459)+(r&858993459),r=(r>>4)+r&252645135,r=(r>>8)+r&16711935,r=(r>>16)+r&65535,r},mRe=1234,gRe=()=>({seed:mRe,arrayShuffle(a){const{arr:r,sampleSize:o}=a;for(let c=0;c<o;c++){this.seed=(214013*this.seed+2531011)%-2147483648;let h=this.seed>>16&32767;h=h%r.length;let f=r[c];r[c]=r[h],r[h]=f}},nextInt(a){this.seed=(214013*this.seed+2531011)%-2147483648;let r=this.seed>>16&32767;return r=r%a,r}}),yRe=16,ARe=128,oL=8,vRe=a=>{const{points:r,pointIndexes:o,randomizer:c}=a,h=[];for(let A=0;A<o.length;A++)h.push(A);let f=Number.MAX_SAFE_INTEGER,m=-1;const y=[];for(let A=0;A<ARe;A++){c.arrayShuffle({arr:h,sampleSize:oL});let w=0;const C=[];for(let _=0;_<o.length;_++){let T=Number.MAX_SAFE_INTEGER;for(let B=0;B<oL;B++){const O=o[h[B]],U=fRe({v1:r[o[_]].descriptors,v2:r[O].descriptors});U<T&&(C[_]=h[B],T=U)}w+=T}y.push(C),w<f&&(f=w,m=A)}return y[m]},jH=({points:a})=>{const r=[];for(let c=0;c<a.length;c++)r.push(c);const o=gRe();return{rootNode:YH({points:a,pointIndexes:r,centerPointIndex:null,randomizer:o})}},YH=a=>{const{points:r,pointIndexes:o,centerPointIndex:c,randomizer:h}=a;let f=!1;(o.length<=oL||o.length<=yRe)&&(f=!0);const m={};if(!f){const A=vRe({points:r,pointIndexes:o,randomizer:h});for(let w=0;w<A.length;w++)m[o[A[w]]]===void 0&&(m[o[A[w]]]=[]),m[o[A[w]]].push(o[w])}Object.keys(m).length===1&&(f=!0);const y={centerPointIndex:c};if(f){y.leaf=!0,y.pointIndexes=[];for(let A=0;A<o.length;A++)y.pointIndexes.push(o[A]);return y}return y.leaf=!1,y.children=[],Object.keys(m).forEach(A=>{y.children.push(YH({points:r,pointIndexes:m[A],centerPointIndex:A,randomizer:h}))}),y};var zm=4294967295;function bRe(a,r,o){var c=o/4294967296,h=o;a.setUint32(r,c),a.setUint32(r+4,h)}function qH(a,r,o){var c=Math.floor(o/4294967296),h=o;a.setUint32(r,c),a.setUint32(r+4,h)}function JH(a,r){var o=a.getInt32(r),c=a.getUint32(r+4);return o*4294967296+c}function xRe(a,r){var o=a.getUint32(r),c=a.getUint32(r+4);return o*4294967296+c}var aL,lL,cL,UC=(typeof process>"u"||((aL=process==null?void 0:nN)===null||aL===void 0?void 0:aL.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function eX(a){for(var r=a.length,o=0,c=0;c<r;){var h=a.charCodeAt(c++);if(h&4294967168)if(!(h&4294965248))o+=2;else{if(h>=55296&&h<=56319&&c<r){var f=a.charCodeAt(c);(f&64512)===56320&&(++c,h=((h&1023)<<10)+(f&1023)+65536)}h&4294901760?o+=4:o+=3}else{o++;continue}}return o}function wRe(a,r,o){for(var c=a.length,h=o,f=0;f<c;){var m=a.charCodeAt(f++);if(m&4294967168)if(!(m&4294965248))r[h++]=m>>6&31|192;else{if(m>=55296&&m<=56319&&f<c){var y=a.charCodeAt(f);(y&64512)===56320&&(++f,m=((m&1023)<<10)+(y&1023)+65536)}m&4294901760?(r[h++]=m>>18&7|240,r[h++]=m>>12&63|128,r[h++]=m>>6&63|128):(r[h++]=m>>12&15|224,r[h++]=m>>6&63|128)}else{r[h++]=m;continue}r[h++]=m&63|128}}var zC=UC?new TextEncoder:void 0,CRe=UC?typeof process<"u"&&((lL=process==null?void 0:nN)===null||lL===void 0?void 0:lL.TEXT_ENCODING)!=="force"?200:0:zm;function ERe(a,r,o){r.set(zC.encode(a),o)}function _Re(a,r,o){zC.encodeInto(a,r.subarray(o))}var IRe=zC!=null&&zC.encodeInto?_Re:ERe,SRe=4096;function tX(a,r,o){for(var c=r,h=c+o,f=[],m="";c<h;){var y=a[c++];if(!(y&128))f.push(y);else if((y&224)===192){var A=a[c++]&63;f.push((y&31)<<6|A)}else if((y&240)===224){var A=a[c++]&63,w=a[c++]&63;f.push((y&31)<<12|A<<6|w)}else if((y&248)===240){var A=a[c++]&63,w=a[c++]&63,C=a[c++]&63,_=(y&7)<<18|A<<12|w<<6|C;_>65535&&(_-=65536,f.push(_>>>10&1023|55296),_=56320|_&1023),f.push(_)}else f.push(y);f.length>=SRe&&(m+=String.fromCharCode.apply(String,f),f.length=0)}return f.length>0&&(m+=String.fromCharCode.apply(String,f)),m}var TRe=UC?new TextDecoder:null,MRe=UC?typeof process<"u"&&((cL=process==null?void 0:nN)===null||cL===void 0?void 0:cL.TEXT_DECODER)!=="force"?200:0:zm;function kRe(a,r,o){var c=a.subarray(r,r+o);return TRe.decode(c)}var GC=function(){function a(r,o){this.type=r,this.data=o}return a}(),RRe=function(){var a=function(r,o){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(c[f]=h[f])},a(r,o)};return function(r,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");a(r,o);function c(){this.constructor=r}r.prototype=o===null?Object.create(o):(c.prototype=o.prototype,new c)}}(),Xu=function(a){RRe(r,a);function r(o){var c=a.call(this,o)||this,h=Object.create(r.prototype);return Object.setPrototypeOf(c,h),Object.defineProperty(c,"name",{configurable:!0,enumerable:!1,value:r.name}),c}return r}(Error),LRe=-1,BRe=4294967296-1,PRe=17179869184-1;function NRe(a){var r=a.sec,o=a.nsec;if(r>=0&&o>=0&&r<=PRe)if(o===0&&r<=BRe){var c=new Uint8Array(4),h=new DataView(c.buffer);return h.setUint32(0,r),c}else{var f=r/4294967296,m=r&4294967295,c=new Uint8Array(8),h=new DataView(c.buffer);return h.setUint32(0,o<<2|f&3),h.setUint32(4,m),c}else{var c=new Uint8Array(12),h=new DataView(c.buffer);return h.setUint32(0,o),qH(h,4,r),c}}function DRe(a){var r=a.getTime(),o=Math.floor(r/1e3),c=(r-o*1e3)*1e6,h=Math.floor(c/1e9);return{sec:o+h,nsec:c-h*1e9}}function FRe(a){if(a instanceof Date){var r=DRe(a);return NRe(r)}else return null}function ORe(a){var r=new DataView(a.buffer,a.byteOffset,a.byteLength);switch(a.byteLength){case 4:{var o=r.getUint32(0),c=0;return{sec:o,nsec:c}}case 8:{var h=r.getUint32(0),f=r.getUint32(4),o=(h&3)*4294967296+f,c=h>>>2;return{sec:o,nsec:c}}case 12:{var o=JH(r,4),c=r.getUint32(0);return{sec:o,nsec:c}}default:throw new Xu("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(a.length))}}function VRe(a){var r=ORe(a);return new Date(r.sec*1e3+r.nsec/1e6)}var URe={type:LRe,encode:FRe,decode:VRe},nX=function(){function a(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(URe)}return a.prototype.register=function(r){var o=r.type,c=r.encode,h=r.decode;if(o>=0)this.encoders[o]=c,this.decoders[o]=h;else{var f=1+o;this.builtInEncoders[f]=c,this.builtInDecoders[f]=h}},a.prototype.tryToEncode=function(r,o){for(var c=0;c<this.builtInEncoders.length;c++){var h=this.builtInEncoders[c];if(h!=null){var f=h(r,o);if(f!=null){var m=-1-c;return new GC(m,f)}}}for(var c=0;c<this.encoders.length;c++){var h=this.encoders[c];if(h!=null){var f=h(r,o);if(f!=null){var m=c;return new GC(m,f)}}}return r instanceof GC?r:null},a.prototype.decode=function(r,o,c){var h=o<0?this.builtInDecoders[-1-o]:this.decoders[o];return h?h(r,o,c):new GC(o,r)},a.defaultCodec=new a,a}();function WC(a){return a instanceof Uint8Array?a:ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer?new Uint8Array(a):Uint8Array.from(a)}function zRe(a){if(a instanceof ArrayBuffer)return new DataView(a);var r=WC(a);return new DataView(r.buffer,r.byteOffset,r.byteLength)}var GRe=100,WRe=2048,HRe=function(){function a(r,o,c,h,f,m,y,A){r===void 0&&(r=nX.defaultCodec),o===void 0&&(o=void 0),c===void 0&&(c=GRe),h===void 0&&(h=WRe),f===void 0&&(f=!1),m===void 0&&(m=!1),y===void 0&&(y=!1),A===void 0&&(A=!1),this.extensionCodec=r,this.context=o,this.maxDepth=c,this.initialBufferSize=h,this.sortKeys=f,this.forceFloat32=m,this.ignoreUndefined=y,this.forceIntegerToFloat=A,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return a.prototype.reinitializeState=function(){this.pos=0},a.prototype.encodeSharedRef=function(r){return this.reinitializeState(),this.doEncode(r,1),this.bytes.subarray(0,this.pos)},a.prototype.encode=function(r){return this.reinitializeState(),this.doEncode(r,1),this.bytes.slice(0,this.pos)},a.prototype.doEncode=function(r,o){if(o>this.maxDepth)throw new Error("Too deep objects in depth ".concat(o));r==null?this.encodeNil():typeof r=="boolean"?this.encodeBoolean(r):typeof r=="number"?this.encodeNumber(r):typeof r=="string"?this.encodeString(r):this.encodeObject(r,o)},a.prototype.ensureBufferSizeToWrite=function(r){var o=this.pos+r;this.view.byteLength<o&&this.resizeBuffer(o*2)},a.prototype.resizeBuffer=function(r){var o=new ArrayBuffer(r),c=new Uint8Array(o),h=new DataView(o);c.set(this.bytes),this.view=h,this.bytes=c},a.prototype.encodeNil=function(){this.writeU8(192)},a.prototype.encodeBoolean=function(r){r===!1?this.writeU8(194):this.writeU8(195)},a.prototype.encodeNumber=function(r){Number.isSafeInteger(r)&&!this.forceIntegerToFloat?r>=0?r<128?this.writeU8(r):r<256?(this.writeU8(204),this.writeU8(r)):r<65536?(this.writeU8(205),this.writeU16(r)):r<4294967296?(this.writeU8(206),this.writeU32(r)):(this.writeU8(207),this.writeU64(r)):r>=-32?this.writeU8(224|r+32):r>=-128?(this.writeU8(208),this.writeI8(r)):r>=-32768?(this.writeU8(209),this.writeI16(r)):r>=-2147483648?(this.writeU8(210),this.writeI32(r)):(this.writeU8(211),this.writeI64(r)):this.forceFloat32?(this.writeU8(202),this.writeF32(r)):(this.writeU8(203),this.writeF64(r))},a.prototype.writeStringHeader=function(r){if(r<32)this.writeU8(160+r);else if(r<256)this.writeU8(217),this.writeU8(r);else if(r<65536)this.writeU8(218),this.writeU16(r);else if(r<4294967296)this.writeU8(219),this.writeU32(r);else throw new Error("Too long string: ".concat(r," bytes in UTF-8"))},a.prototype.encodeString=function(r){var o=5,c=r.length;if(c>CRe){var h=eX(r);this.ensureBufferSizeToWrite(o+h),this.writeStringHeader(h),IRe(r,this.bytes,this.pos),this.pos+=h}else{var h=eX(r);this.ensureBufferSizeToWrite(o+h),this.writeStringHeader(h),wRe(r,this.bytes,this.pos),this.pos+=h}},a.prototype.encodeObject=function(r,o){var c=this.extensionCodec.tryToEncode(r,this.context);if(c!=null)this.encodeExtension(c);else if(Array.isArray(r))this.encodeArray(r,o);else if(ArrayBuffer.isView(r))this.encodeBinary(r);else if(typeof r=="object")this.encodeMap(r,o);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(r)))},a.prototype.encodeBinary=function(r){var o=r.byteLength;if(o<256)this.writeU8(196),this.writeU8(o);else if(o<65536)this.writeU8(197),this.writeU16(o);else if(o<4294967296)this.writeU8(198),this.writeU32(o);else throw new Error("Too large binary: ".concat(o));var c=WC(r);this.writeU8a(c)},a.prototype.encodeArray=function(r,o){var c=r.length;if(c<16)this.writeU8(144+c);else if(c<65536)this.writeU8(220),this.writeU16(c);else if(c<4294967296)this.writeU8(221),this.writeU32(c);else throw new Error("Too large array: ".concat(c));for(var h=0,f=r;h<f.length;h++){var m=f[h];this.doEncode(m,o+1)}},a.prototype.countWithoutUndefined=function(r,o){for(var c=0,h=0,f=o;h<f.length;h++){var m=f[h];r[m]!==void 0&&c++}return c},a.prototype.encodeMap=function(r,o){var c=Object.keys(r);this.sortKeys&&c.sort();var h=this.ignoreUndefined?this.countWithoutUndefined(r,c):c.length;if(h<16)this.writeU8(128+h);else if(h<65536)this.writeU8(222),this.writeU16(h);else if(h<4294967296)this.writeU8(223),this.writeU32(h);else throw new Error("Too large map object: ".concat(h));for(var f=0,m=c;f<m.length;f++){var y=m[f],A=r[y];this.ignoreUndefined&&A===void 0||(this.encodeString(y),this.doEncode(A,o+1))}},a.prototype.encodeExtension=function(r){var o=r.data.length;if(o===1)this.writeU8(212);else if(o===2)this.writeU8(213);else if(o===4)this.writeU8(214);else if(o===8)this.writeU8(215);else if(o===16)this.writeU8(216);else if(o<256)this.writeU8(199),this.writeU8(o);else if(o<65536)this.writeU8(200),this.writeU16(o);else if(o<4294967296)this.writeU8(201),this.writeU32(o);else throw new Error("Too large extension object: ".concat(o));this.writeI8(r.type),this.writeU8a(r.data)},a.prototype.writeU8=function(r){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,r),this.pos++},a.prototype.writeU8a=function(r){var o=r.length;this.ensureBufferSizeToWrite(o),this.bytes.set(r,this.pos),this.pos+=o},a.prototype.writeI8=function(r){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,r),this.pos++},a.prototype.writeU16=function(r){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,r),this.pos+=2},a.prototype.writeI16=function(r){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,r),this.pos+=2},a.prototype.writeU32=function(r){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,r),this.pos+=4},a.prototype.writeI32=function(r){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,r),this.pos+=4},a.prototype.writeF32=function(r){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,r),this.pos+=4},a.prototype.writeF64=function(r){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,r),this.pos+=8},a.prototype.writeU64=function(r){this.ensureBufferSizeToWrite(8),bRe(this.view,this.pos,r),this.pos+=8},a.prototype.writeI64=function(r){this.ensureBufferSizeToWrite(8),qH(this.view,this.pos,r),this.pos+=8},a}(),XRe={};function $Re(a,r){r===void 0&&(r=XRe);var o=new HRe(r.extensionCodec,r.context,r.maxDepth,r.initialBufferSize,r.sortKeys,r.forceFloat32,r.ignoreUndefined,r.forceIntegerToFloat);return o.encodeSharedRef(a)}function uL(a){return"".concat(a<0?"-":"","0x").concat(Math.abs(a).toString(16).padStart(2,"0"))}var QRe=16,KRe=16,ZRe=function(){function a(r,o){r===void 0&&(r=QRe),o===void 0&&(o=KRe),this.maxKeyLength=r,this.maxLengthPerKey=o,this.hit=0,this.miss=0,this.caches=[];for(var c=0;c<this.maxKeyLength;c++)this.caches.push([])}return a.prototype.canBeCached=function(r){return r>0&&r<=this.maxKeyLength},a.prototype.find=function(r,o,c){var h=this.caches[c-1];e:for(var f=0,m=h;f<m.length;f++){for(var y=m[f],A=y.bytes,w=0;w<c;w++)if(A[w]!==r[o+w])continue e;return y.str}return null},a.prototype.store=function(r,o){var c=this.caches[r.length-1],h={bytes:r,str:o};c.length>=this.maxLengthPerKey?c[Math.random()*c.length|0]=h:c.push(h)},a.prototype.decode=function(r,o,c){var h=this.find(r,o,c);if(h!=null)return this.hit++,h;this.miss++;var f=tX(r,o,c),m=Uint8Array.prototype.slice.call(r,o,o+c);return this.store(m,f),f},a}(),jRe=function(a,r,o,c){function h(f){return f instanceof o?f:new o(function(m){m(f)})}return new(o||(o=Promise))(function(f,m){function y(C){try{w(c.next(C))}catch(_){m(_)}}function A(C){try{w(c.throw(C))}catch(_){m(_)}}function w(C){C.done?f(C.value):h(C.value).then(y,A)}w((c=c.apply(a,[])).next())})},hL=function(a,r){var o={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},c,h,f,m;return m={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function y(w){return function(C){return A([w,C])}}function A(w){if(c)throw new TypeError("Generator is already executing.");for(;o;)try{if(c=1,h&&(f=w[0]&2?h.return:w[0]?h.throw||((f=h.return)&&f.call(h),0):h.next)&&!(f=f.call(h,w[1])).done)return f;switch(h=0,f&&(w=[w[0]&2,f.value]),w[0]){case 0:case 1:f=w;break;case 4:return o.label++,{value:w[1],done:!1};case 5:o.label++,h=w[1],w=[0];continue;case 7:w=o.ops.pop(),o.trys.pop();continue;default:if(f=o.trys,!(f=f.length>0&&f[f.length-1])&&(w[0]===6||w[0]===2)){o=0;continue}if(w[0]===3&&(!f||w[1]>f[0]&&w[1]<f[3])){o.label=w[1];break}if(w[0]===6&&o.label<f[1]){o.label=f[1],f=w;break}if(f&&o.label<f[2]){o.label=f[2],o.ops.push(w);break}f[2]&&o.ops.pop(),o.trys.pop();continue}w=r.call(a,o)}catch(C){w=[6,C],h=0}finally{c=f=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},iX=function(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=a[Symbol.asyncIterator],o;return r?r.call(a):(a=typeof __values=="function"?__values(a):a[Symbol.iterator](),o={},c("next"),c("throw"),c("return"),o[Symbol.asyncIterator]=function(){return this},o);function c(f){o[f]=a[f]&&function(m){return new Promise(function(y,A){m=a[f](m),h(y,A,m.done,m.value)})}}function h(f,m,y,A){Promise.resolve(A).then(function(w){f({value:w,done:y})},m)}},ry=function(a){return this instanceof ry?(this.v=a,this):new ry(a)},YRe=function(a,r,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=o.apply(a,r||[]),h,f=[];return h={},m("next"),m("throw"),m("return"),h[Symbol.asyncIterator]=function(){return this},h;function m(T){c[T]&&(h[T]=function(B){return new Promise(function(O,U){f.push([T,B,O,U])>1||y(T,B)})})}function y(T,B){try{A(c[T](B))}catch(O){_(f[0][3],O)}}function A(T){T.value instanceof ry?Promise.resolve(T.value.v).then(w,C):_(f[0][2],T)}function w(T){y("next",T)}function C(T){y("throw",T)}function _(T,B){T(B),f.shift(),f.length&&y(f[0][0],f[0][1])}},qRe=function(a){var r=typeof a;return r==="string"||r==="number"},db=-1,dL=new DataView(new ArrayBuffer(0)),JRe=new Uint8Array(dL.buffer),fL=function(){try{dL.getInt8(0)}catch(a){return a.constructor}throw new Error("never reached")}(),rX=new fL("Insufficient data"),eLe=new ZRe,tLe=function(){function a(r,o,c,h,f,m,y,A){r===void 0&&(r=nX.defaultCodec),o===void 0&&(o=void 0),c===void 0&&(c=zm),h===void 0&&(h=zm),f===void 0&&(f=zm),m===void 0&&(m=zm),y===void 0&&(y=zm),A===void 0&&(A=eLe),this.extensionCodec=r,this.context=o,this.maxStrLength=c,this.maxBinLength=h,this.maxArrayLength=f,this.maxMapLength=m,this.maxExtLength=y,this.keyDecoder=A,this.totalPos=0,this.pos=0,this.view=dL,this.bytes=JRe,this.headByte=db,this.stack=[]}return a.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=db,this.stack.length=0},a.prototype.setBuffer=function(r){this.bytes=WC(r),this.view=zRe(this.bytes),this.pos=0},a.prototype.appendBuffer=function(r){if(this.headByte===db&&!this.hasRemaining(1))this.setBuffer(r);else{var o=this.bytes.subarray(this.pos),c=WC(r),h=new Uint8Array(o.length+c.length);h.set(o),h.set(c,o.length),this.setBuffer(h)}},a.prototype.hasRemaining=function(r){return this.view.byteLength-this.pos>=r},a.prototype.createExtraByteError=function(r){var o=this,c=o.view,h=o.pos;return new RangeError("Extra ".concat(c.byteLength-h," of ").concat(c.byteLength," byte(s) found at buffer[").concat(r,"]"))},a.prototype.decode=function(r){this.reinitializeState(),this.setBuffer(r);var o=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return o},a.prototype.decodeMulti=function(r){return hL(this,function(o){switch(o.label){case 0:this.reinitializeState(),this.setBuffer(r),o.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return o.sent(),[3,1];case 3:return[2]}})},a.prototype.decodeAsync=function(r){var o,c,h,f;return jRe(this,void 0,void 0,function(){var m,y,A,w,C,_,T,B;return hL(this,function(O){switch(O.label){case 0:m=!1,O.label=1;case 1:O.trys.push([1,6,7,12]),o=iX(r),O.label=2;case 2:return[4,o.next()];case 3:if(c=O.sent(),!!c.done)return[3,5];if(A=c.value,m)throw this.createExtraByteError(this.totalPos);this.appendBuffer(A);try{y=this.doDecodeSync(),m=!0}catch(U){if(!(U instanceof fL))throw U}this.totalPos+=this.pos,O.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return w=O.sent(),h={error:w},[3,12];case 7:return O.trys.push([7,,10,11]),c&&!c.done&&(f=o.return)?[4,f.call(o)]:[3,9];case 8:O.sent(),O.label=9;case 9:return[3,11];case 10:if(h)throw h.error;return[7];case 11:return[7];case 12:if(m){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,y]}throw C=this,_=C.headByte,T=C.pos,B=C.totalPos,new RangeError("Insufficient data in parsing ".concat(uL(_)," at ").concat(B," (").concat(T," in the current buffer)"))}})})},a.prototype.decodeArrayStream=function(r){return this.decodeMultiAsync(r,!0)},a.prototype.decodeStream=function(r){return this.decodeMultiAsync(r,!1)},a.prototype.decodeMultiAsync=function(r,o){return YRe(this,arguments,function(){var c,h,f,m,y,A,w,C,_;return hL(this,function(T){switch(T.label){case 0:c=o,h=-1,T.label=1;case 1:T.trys.push([1,13,14,19]),f=iX(r),T.label=2;case 2:return[4,ry(f.next())];case 3:if(m=T.sent(),!!m.done)return[3,12];if(y=m.value,o&&h===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(y),c&&(h=this.readArraySize(),c=!1,this.complete()),T.label=4;case 4:T.trys.push([4,9,,10]),T.label=5;case 5:return[4,ry(this.doDecodeSync())];case 6:return[4,T.sent()];case 7:return T.sent(),--h===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(A=T.sent(),!(A instanceof fL))throw A;return[3,10];case 10:this.totalPos+=this.pos,T.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return w=T.sent(),C={error:w},[3,19];case 14:return T.trys.push([14,,17,18]),m&&!m.done&&(_=f.return)?[4,ry(_.call(f))]:[3,16];case 15:T.sent(),T.label=16;case 16:return[3,18];case 17:if(C)throw C.error;return[7];case 18:return[7];case 19:return[2]}})})},a.prototype.doDecodeSync=function(){e:for(;;){var r=this.readHeadByte(),o=void 0;if(r>=224)o=r-256;else if(r<192)if(r<128)o=r;else if(r<144){var c=r-128;if(c!==0){this.pushMapState(c),this.complete();continue e}else o={}}else if(r<160){var c=r-144;if(c!==0){this.pushArrayState(c),this.complete();continue e}else o=[]}else{var h=r-160;o=this.decodeUtf8String(h,0)}else if(r===192)o=null;else if(r===194)o=!1;else if(r===195)o=!0;else if(r===202)o=this.readF32();else if(r===203)o=this.readF64();else if(r===204)o=this.readU8();else if(r===205)o=this.readU16();else if(r===206)o=this.readU32();else if(r===207)o=this.readU64();else if(r===208)o=this.readI8();else if(r===209)o=this.readI16();else if(r===210)o=this.readI32();else if(r===211)o=this.readI64();else if(r===217){var h=this.lookU8();o=this.decodeUtf8String(h,1)}else if(r===218){var h=this.lookU16();o=this.decodeUtf8String(h,2)}else if(r===219){var h=this.lookU32();o=this.decodeUtf8String(h,4)}else if(r===220){var c=this.readU16();if(c!==0){this.pushArrayState(c),this.complete();continue e}else o=[]}else if(r===221){var c=this.readU32();if(c!==0){this.pushArrayState(c),this.complete();continue e}else o=[]}else if(r===222){var c=this.readU16();if(c!==0){this.pushMapState(c),this.complete();continue e}else o={}}else if(r===223){var c=this.readU32();if(c!==0){this.pushMapState(c),this.complete();continue e}else o={}}else if(r===196){var c=this.lookU8();o=this.decodeBinary(c,1)}else if(r===197){var c=this.lookU16();o=this.decodeBinary(c,2)}else if(r===198){var c=this.lookU32();o=this.decodeBinary(c,4)}else if(r===212)o=this.decodeExtension(1,0);else if(r===213)o=this.decodeExtension(2,0);else if(r===214)o=this.decodeExtension(4,0);else if(r===215)o=this.decodeExtension(8,0);else if(r===216)o=this.decodeExtension(16,0);else if(r===199){var c=this.lookU8();o=this.decodeExtension(c,1)}else if(r===200){var c=this.lookU16();o=this.decodeExtension(c,2)}else if(r===201){var c=this.lookU32();o=this.decodeExtension(c,4)}else throw new Xu("Unrecognized type byte: ".concat(uL(r)));this.complete();for(var f=this.stack;f.length>0;){var m=f[f.length-1];if(m.type===0)if(m.array[m.position]=o,m.position++,m.position===m.size)f.pop(),o=m.array;else continue e;else if(m.type===1){if(!qRe(o))throw new Xu("The type of key must be string or number but "+typeof o);if(o==="__proto__")throw new Xu("The key __proto__ is not allowed");m.key=o,m.type=2;continue e}else if(m.map[m.key]=o,m.readCount++,m.readCount===m.size)f.pop(),o=m.map;else{m.key=null,m.type=1;continue e}}return o}},a.prototype.readHeadByte=function(){return this.headByte===db&&(this.headByte=this.readU8()),this.headByte},a.prototype.complete=function(){this.headByte=db},a.prototype.readArraySize=function(){var r=this.readHeadByte();switch(r){case 220:return this.readU16();case 221:return this.readU32();default:{if(r<160)return r-144;throw new Xu("Unrecognized array type byte: ".concat(uL(r)))}}},a.prototype.pushMapState=function(r){if(r>this.maxMapLength)throw new Xu("Max length exceeded: map length (".concat(r,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:r,key:null,readCount:0,map:{}})},a.prototype.pushArrayState=function(r){if(r>this.maxArrayLength)throw new Xu("Max length exceeded: array length (".concat(r,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:r,array:new Array(r),position:0})},a.prototype.decodeUtf8String=function(r,o){var c;if(r>this.maxStrLength)throw new Xu("Max length exceeded: UTF-8 byte length (".concat(r,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+o+r)throw rX;var h=this.pos+o,f;return this.stateIsMapKey()&&!((c=this.keyDecoder)===null||c===void 0)&&c.canBeCached(r)?f=this.keyDecoder.decode(this.bytes,h,r):r>MRe?f=kRe(this.bytes,h,r):f=tX(this.bytes,h,r),this.pos+=o+r,f},a.prototype.stateIsMapKey=function(){if(this.stack.length>0){var r=this.stack[this.stack.length-1];return r.type===1}return!1},a.prototype.decodeBinary=function(r,o){if(r>this.maxBinLength)throw new Xu("Max length exceeded: bin length (".concat(r,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(r+o))throw rX;var c=this.pos+o,h=this.bytes.subarray(c,c+r);return this.pos+=o+r,h},a.prototype.decodeExtension=function(r,o){if(r>this.maxExtLength)throw new Xu("Max length exceeded: ext length (".concat(r,") > maxExtLength (").concat(this.maxExtLength,")"));var c=this.view.getInt8(this.pos+o),h=this.decodeBinary(r,o+1);return this.extensionCodec.decode(h,c,this.context)},a.prototype.lookU8=function(){return this.view.getUint8(this.pos)},a.prototype.lookU16=function(){return this.view.getUint16(this.pos)},a.prototype.lookU32=function(){return this.view.getUint32(this.pos)},a.prototype.readU8=function(){var r=this.view.getUint8(this.pos);return this.pos++,r},a.prototype.readI8=function(){var r=this.view.getInt8(this.pos);return this.pos++,r},a.prototype.readU16=function(){var r=this.view.getUint16(this.pos);return this.pos+=2,r},a.prototype.readI16=function(){var r=this.view.getInt16(this.pos);return this.pos+=2,r},a.prototype.readU32=function(){var r=this.view.getUint32(this.pos);return this.pos+=4,r},a.prototype.readI32=function(){var r=this.view.getInt32(this.pos);return this.pos+=4,r},a.prototype.readU64=function(){var r=xRe(this.view,this.pos);return this.pos+=8,r},a.prototype.readI64=function(){var r=JH(this.view,this.pos);return this.pos+=8,r},a.prototype.readF32=function(){var r=this.view.getFloat32(this.pos);return this.pos+=4,r},a.prototype.readF64=function(){var r=this.view.getFloat64(this.pos);return this.pos+=8,r},a}(),nLe={};function iLe(a,r){r===void 0&&(r=nLe);var o=new tLe(r.extensionCodec,r.context,r.maxStrLength,r.maxBinLength,r.maxArrayLength,r.maxMapLength,r.maxExtLength);return o.decode(a)}const sX=2;class rLe{constructor(){this.data=null}compileImageTargets(r,o){return new Promise(async(c,h)=>{const f=[];for(let w=0;w<r.length;w++){const C=r[w],_=this.createProcessCanvas(C).getContext("2d");_.drawImage(C,0,0,C.width,C.height);const T=_.getImageData(0,0,C.width,C.height),B=new Uint8Array(C.width*C.height);for(let U=0;U<B.length;U++){const W=U*4;B[U]=Math.floor((T.data[W]+T.data[W+1]+T.data[W+2])/3)}const O={data:B,height:C.height,width:C.width};f.push(O)}const m=50/f.length;let y=0;this.data=[];for(let w=0;w<f.length;w++){const C=f[w],_=hRe(C),T=m/_.length,B=await sLe(_,()=>{y+=T,o(y)});this.data.push({targetImage:C,imageList:_,matchingData:B})}for(let w=0;w<f.length;w++){const C=dRe(f[w]);this.data[w].trackingImageList=C}const A=await this.compileTrack({progressCallback:o,targetImages:f,basePercent:50});for(let w=0;w<f.length;w++)this.data[w].trackingData=A[w];c(this.data)})}exportData(){const r=[];for(let o=0;o<this.data.length;o++)r.push({targetImage:{width:this.data[o].targetImage.width,height:this.data[o].targetImage.height},trackingData:this.data[o].trackingData,matchingData:this.data[o].matchingData});return $Re({v:sX,dataList:r})}importData(r){const o=iLe(new Uint8Array(r));if(!o.v||o.v!==sX)return console.error("Your compiled .mind might be outdated. Please recompile"),[];const{dataList:c}=o;this.data=[];for(let h=0;h<c.length;h++)this.data.push({targetImage:c[h].targetImage,trackingData:c[h].trackingData,matchingData:c[h].matchingData});return this.data}createProcessCanvas(r){console.warn("missing createProcessCanvas implementation")}compileTrack({progressCallback:r,targetImages:o,basePercent:c}){console.warn("missing compileTrack implementation")}}const sLe=async(a,r)=>{const o=[];for(let c=0;c<a.length;c++){const h=a[c],f=new KH(h.width,h.height);await Uw(),Qe(()=>{const m=pl(h.data,[h.data.length],"float32").reshape([h.height,h.width]),{featurePoints:y}=f.detect(m),A=y.filter(T=>T.maxima),w=y.filter(T=>!T.maxima),C=jH({points:A}),_=jH({points:w});o.push({maximaPoints:A,minimaPoints:w,maximaPointsCluster:C,minimaPointsCluster:_,width:h.width,height:h.height,scale:h.scale}),r(c)})}return o},oX="KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIHp7Y29uc3RydWN0b3Iocyx0LG8pe3RoaXMuY3Vtc3VtPVtdO2ZvcihsZXQgZT0wO2U8bztlKyspe3RoaXMuY3Vtc3VtLnB1c2goW10pO2ZvcihsZXQgbj0wO248dDtuKyspdGhpcy5jdW1zdW1bZV0ucHVzaCgwKX10aGlzLmN1bXN1bVswXVswXT1zWzBdO2ZvcihsZXQgZT0xO2U8dDtlKyspdGhpcy5jdW1zdW1bMF1bZV09dGhpcy5jdW1zdW1bMF1bZS0xXStzW2VdO2ZvcihsZXQgZT0xO2U8bztlKyspdGhpcy5jdW1zdW1bZV1bMF09dGhpcy5jdW1zdW1bZS0xXVswXStzW2UqdF07Zm9yKGxldCBlPTE7ZTxvO2UrKylmb3IobGV0IG49MTtuPHQ7bisrKXRoaXMuY3Vtc3VtW2VdW25dPXNbZSp0K25dK3RoaXMuY3Vtc3VtW2UtMV1bbl0rdGhpcy5jdW1zdW1bZV1bbi0xXS10aGlzLmN1bXN1bVtlLTFdW24tMV19cXVlcnkocyx0LG8sZSl7bGV0IG49dGhpcy5jdW1zdW1bZV1bb107cmV0dXJuIHQ+MCYmKG4tPXRoaXMuY3Vtc3VtW3QtMV1bb10pLHM+MCYmKG4tPXRoaXMuY3Vtc3VtW2VdW3MtMV0pLHM+MCYmdD4wJiYobis9dGhpcy5jdW1zdW1bdC0xXVtzLTFdKSxufX1jb25zdCBDPTEwLGI9MixNPTYsRj01LEk9Ljk1LEw9LjksTz0uMixaPTgsTj0yNCoyLzMsVT1yPT57Y29uc3R7ZGF0YTpzLHdpZHRoOnQsaGVpZ2h0Om8sc2NhbGU6ZX09cixuPVt0Km9dO2ZvcihsZXQgaT0wO2k8bi5sZW5ndGg7aSsrKW5baV09ITE7Y29uc3QgYT1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWFbaV09LTEsYVt0KihvLTEpK2ldPS0xO2ZvcihsZXQgaT0wO2k8bztpKyspYVtpKnRdPS0xLGFbaSp0K3QtMV09LTE7Zm9yKGxldCBpPTE7aTx0LTE7aSsrKWZvcihsZXQgcD0xO3A8by0xO3ArKyl7bGV0IGY9aSt0KnAsaD0wLGM9MDtmb3IobGV0IHU9LTE7dTw9MTt1KyspaCs9c1tmK3QqdSsxXS1zW2YrdCp1LTFdLGMrPXNbZit0K3VdLXNbZi10K3VdO2gvPTMqMjU2LGMvPTMqMjU2LGFbZl09TWF0aC5zcXJ0KChoKmgrYypjKS8yKX1jb25zdCBnPW5ldyBVaW50MzJBcnJheSgxZTMpO2ZvcihsZXQgaT0wO2k8MWUzO2krKylnW2ldPTA7Y29uc3QgZD1bLTEsMSwtdCx0XTtmb3IobGV0IGk9MTtpPHQtMTtpKyspZm9yKGxldCBwPTE7cDxvLTE7cCsrKXtsZXQgZj1pK3QqcCxoPSEwO2ZvcihsZXQgYz0wO2M8ZC5sZW5ndGg7YysrKWlmKGFbZl08PWFbZitkW2NdXSl7aD0hMTticmVha31pZihoKXtsZXQgYz1NYXRoLmZsb29yKGFbZl0qMWUzKTtjPjk5OSYmKGM9OTk5KSxjPDAmJihjPTApLGdbY10rPTEsbltmXT0hMH19Y29uc3Qgdz0uMDIqdCpvO2xldCBqPTk5OSxFPTA7Zm9yKDtqPj0wJiYoRSs9Z1tqXSwhKEU+dykpOylqLS07Zm9yKGxldCBpPTA7aTxuLmxlbmd0aDtpKyspbltpXSYmYVtpXSoxZTM8aiYmKG5baV09ITEpO2NvbnN0IGw9W107Zm9yKGxldCBpPTA7aTxzLmxlbmd0aDtpKyspbFtpXT1zW2ldKnNbaV07Y29uc3QgUz1uZXcgeihzLHQsbyksRD1uZXcgeihsLHQsbyksaz1uZXcgRmxvYXQzMkFycmF5KHMubGVuZ3RoKTtmb3IobGV0IGk9MDtpPHQ7aSsrKWZvcihsZXQgcD0wO3A8bztwKyspe2NvbnN0IGY9cCp0K2k7aWYoIW5bZl0pe2tbZl09MTtjb250aW51ZX1jb25zdCBoPVAoe2ltYWdlOnIsY3g6aSxjeTpwLHNkVGhyZXNoOkYsaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KTtpZihoPT09bnVsbCl7a1tmXT0xO2NvbnRpbnVlfWxldCBjPS0xO2ZvcihsZXQgdT0tQzt1PD1DO3UrKyl7Zm9yKGxldCBtPS1DO208PUM7bSsrKXtpZihtKm0rdSp1PD1iKmIpY29udGludWU7Y29uc3QgeD1SKHtpbWFnZTpyLGN4OmkrbSxjeTpwK3UsdmxlbjpoLHR4OmksdHk6cCxpbWFnZURhdGFDdW1zdW06UyxpbWFnZURhdGFTcXJDdW1zdW06RH0pO2lmKHghPT1udWxsJiZ4PmMmJihjPXgsYz5JKSlicmVha31pZihjPkkpYnJlYWt9a1tmXT1jfXJldHVybiBWKHtpbWFnZTpyLGZlYXR1cmVNYXA6ayx0ZW1wbGF0ZVNpemU6TSxzZWFyY2hTaXplOmIsb2NjU2l6ZTpOLG1heFNpbVRocmVzaDpMLG1pblNpbVRocmVzaDpPLHNkVGhyZXNoOlosaW1hZ2VEYXRhQ3Vtc3VtOlMsaW1hZ2VEYXRhU3FyQ3Vtc3VtOkR9KX0sVj1yPT57bGV0e2ltYWdlOnMsZmVhdHVyZU1hcDp0LHRlbXBsYXRlU2l6ZTpvLHNlYXJjaFNpemU6ZSxvY2NTaXplOm4sbWF4U2ltVGhyZXNoOmEsbWluU2ltVGhyZXNoOmcsc2RUaHJlc2g6ZCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an09cjtjb25zdHtkYXRhOkUsd2lkdGg6bCxoZWlnaHQ6UyxzY2FsZTpEfT1zO249TWF0aC5mbG9vcihNYXRoLm1pbihzLndpZHRoLHMuaGVpZ2h0KS8xMCk7Y29uc3Qgaz0obyoyKzEpKjMsQT1NYXRoLmZsb29yKGwvayksaT1NYXRoLmZsb29yKFMvayk7bGV0IHA9TWF0aC5mbG9vcihsL24pKk1hdGguZmxvb3IoUy9uKStBKmk7Y29uc3QgZj1bXSxoPW5ldyBGbG9hdDMyQXJyYXkoRS5sZW5ndGgpO2ZvcihsZXQgdT0wO3U8aC5sZW5ndGg7dSsrKWhbdV09dFt1XTtsZXQgYz0wO2Zvcig7YzxwOyl7bGV0IHU9YSxtPS0xLHg9LTE7Zm9yKGxldCB5PTA7eTxTO3krKylmb3IobGV0IFQ9MDtUPGw7VCsrKWhbeSpsK1RdPHUmJih1PWhbeSpsK1RdLG09VCx4PXkpO2lmKG09PT0tMSlicmVhaztjb25zdCB2PVAoe2ltYWdlOnMsY3g6bSxjeTp4LHNkVGhyZXNoOjAsaW1hZ2VEYXRhQ3Vtc3VtOncsaW1hZ2VEYXRhU3FyQ3Vtc3VtOmp9KTtpZih2PT09bnVsbCl7aFt4KmwrbV09MTtjb250aW51ZX1pZih2LyhvKjIrMSk8ZCl7aFt4KmwrbV09MTtjb250aW51ZX1sZXQgcT0xLF89LTE7Zm9yKGxldCB5PS1lO3k8PWU7eSsrKXtmb3IobGV0IFQ9LWU7VDw9ZTtUKyspe2lmKFQqVCt5Knk+ZSplfHxUPT09MCYmeT09PTApY29udGludWU7Y29uc3QgSD1SKHtpbWFnZTpzLHZsZW46dixjeDptK1QsY3k6eCt5LHR4Om0sdHk6eCxpbWFnZURhdGFDdW1zdW06dyxpbWFnZURhdGFTcXJDdW1zdW06an0pO2lmKEghPT1udWxsJiYoSDxxJiYocT1ILHE8ZyYmcTx1KXx8SD5fJiYoXz1ILF8+Ljk5KSkpYnJlYWt9aWYocTxnJiZxPHV8fF8+Ljk5KWJyZWFrfWlmKHE8ZyYmcTx1fHxfPi45OSl7aFt4KmwrbV09MTtjb250aW51ZX1mLnB1c2goe3g6bSx5Onh9KSxjKz0xO2ZvcihsZXQgeT0tbjt5PD1uO3krKylmb3IobGV0IFQ9LW47VDw9bjtUKyspeCt5PDB8fHgreT49U3x8bStUPDB8fG0rVD49bHx8KGhbKHgreSkqbCsobStUKV09MSl9cmV0dXJuIGZ9LFA9KHtpbWFnZTpyLGN4OnMsY3k6dCxzZFRocmVzaDpvLGltYWdlRGF0YUN1bXN1bTplLGltYWdlRGF0YVNxckN1bXN1bTpufSk9PntpZihzLU08MHx8cytNPj1yLndpZHRofHx0LU08MHx8dCtNPj1yLmhlaWdodClyZXR1cm4gbnVsbDtjb25zdCBhPTIqTSsxLGc9YSphO2xldCBkPWUucXVlcnkocy1NLHQtTSxzK00sdCtNKTtkLz1nO2xldCB3PW4ucXVlcnkocy1NLHQtTSxzK00sdCtNKTtyZXR1cm4gdy09MipkKmUucXVlcnkocy1NLHQtTSxzK00sdCtNKSx3Kz1nKmQqZCx3L2c8bypvP251bGw6KHc9TWF0aC5zcXJ0KHcpLHcpfSxSPXI9Pntjb25zdHtpbWFnZTpzLGN4OnQsY3k6byx2bGVuOmUsdHg6bix0eTphLGltYWdlRGF0YUN1bXN1bTpnLGltYWdlRGF0YVNxckN1bXN1bTpkfT1yLHtkYXRhOncsd2lkdGg6aixoZWlnaHQ6RX09cyxsPU07aWYodC1sPDB8fHQrbD49anx8by1sPDB8fG8rbD49RSlyZXR1cm4gbnVsbDtjb25zdCBTPTIqbCsxO2xldCBEPWcucXVlcnkodC1sLG8tbCx0K2wsbytsKSxrPWQucXVlcnkodC1sLG8tbCx0K2wsbytsKSxBPTAsaT0oby1sKSpqKyh0LWwpLHA9KGEtbCkqaisobi1sKSxmPWotUztmb3IobGV0IG09MDttPFM7bSsrKXtmb3IobGV0IHg9MDt4PFM7eCsrKUErPXdbaV0qd1twXSxpKz0xLHArPTE7aSs9ZixwKz1mfWxldCBoPWcucXVlcnkobi1sLGEtbCxuK2wsYStsKTtoLz1TKlMsQS09aCpEO2xldCBjPWstRCpELyhTKlMpO3JldHVybiBjPT0wP251bGw6KGM9TWF0aC5zcXJ0KGMpLDEqQS8oZSpjKSl9LFc9KHIscyk9Pntjb25zdCB0PVtdO2ZvcihsZXQgbz0wO288ci5sZW5ndGg7bysrKXtjb25zdCBlPXJbb10sbj1VKGUpLGE9e2RhdGE6ZS5kYXRhLHNjYWxlOmUuc2NhbGUsd2lkdGg6ZS53aWR0aCxoZWlnaHQ6ZS5oZWlnaHQscG9pbnRzOm59O3QucHVzaChhKSxzKG8pfXJldHVybiB0fSxYPSh7aW1hZ2U6cixyYXRpbzpzfSk9Pntjb25zdCB0PU1hdGgucm91bmQoci53aWR0aCpzKSxvPU1hdGgucm91bmQoci5oZWlnaHQqcyksZT1uZXcgVWludDhBcnJheSh0Km8pO2ZvcihsZXQgbj0wO248dDtuKyspe2xldCBhPU1hdGgucm91bmQoMSpuL3MpLGc9TWF0aC5yb3VuZCgxKihuKzEpL3MpLTE7Zz49ci53aWR0aCYmKGc9ci53aWR0aC0xKTtmb3IobGV0IGQ9MDtkPG87ZCsrKXtsZXQgdz1NYXRoLnJvdW5kKDEqZC9zKSxqPU1hdGgucm91bmQoMSooZCsxKS9zKS0xO2o+PXIuaGVpZ2h0JiYoaj1yLmhlaWdodC0xKTtsZXQgRT0wLGw9MDtmb3IobGV0IFM9YTtTPD1nO1MrKylmb3IobGV0IEQ9dztEPD1qO0QrKylFKz0xKnIuZGF0YVtEKnIud2lkdGgrU10sbCs9MTtlW2QqdCtuXT1NYXRoLmZsb29yKEUvbCl9fXJldHVybntkYXRhOmUsd2lkdGg6dCxoZWlnaHQ6b319LFk9cj0+e2NvbnN0IHM9TWF0aC5taW4oci53aWR0aCxyLmhlaWdodCksdD1bXSxvPVtdO3QucHVzaCgyNTYvcyksdC5wdXNoKDEyOC9zKTtmb3IobGV0IGU9MDtlPHQubGVuZ3RoO2UrKylvLnB1c2goT2JqZWN0LmFzc2lnbihYKHtpbWFnZTpyLHJhdGlvOnRbZV19KSx7c2NhbGU6dFtlXX0pKTtyZXR1cm4gb307b25tZXNzYWdlPXI9Pntjb25zdHtkYXRhOnN9PXI7aWYocy50eXBlPT09ImNvbXBpbGUiKXtjb25zdHt0YXJnZXRJbWFnZXM6dH09cyxvPTEwMC90Lmxlbmd0aDtsZXQgZT0wO2NvbnN0IG49W107Zm9yKGxldCBhPTA7YTx0Lmxlbmd0aDthKyspe2NvbnN0IGc9dFthXSxkPVkoZyksdz1vL2QubGVuZ3RoLGo9VyhkLEU9PntlKz13LHBvc3RNZXNzYWdlKHt0eXBlOiJwcm9ncmVzcyIscGVyY2VudDplfSl9KTtuLnB1c2goail9cG9zdE1lc3NhZ2Uoe3R5cGU6ImNvbXBpbGVEb25lIixsaXN0Om59KX19fSkoKTsK",aX=typeof window<"u"&&window.Blob&&new Blob([atob(oX)],{type:"text/javascript;charset=utf-8"});function oLe(a){let r;try{if(r=aX&&(window.URL||window.webkitURL).createObjectURL(aX),!r)throw"";const o=new Worker(r,{name:a==null?void 0:a.name});return o.addEventListener("error",()=>{(window.URL||window.webkitURL).revokeObjectURL(r)}),o}catch{return new Worker("data:application/javascript;base64,"+oX,{name:a==null?void 0:a.name})}finally{r&&(window.URL||window.webkitURL).revokeObjectURL(r)}}class lX extends rLe{createProcessCanvas(r){const o=document.createElement("canvas");return o.width=r.width,o.height=r.height,o}compileTrack({progressCallback:r,targetImages:o,basePercent:c}){return new Promise((h,f)=>{const m=new oLe;m.onmessage=y=>{y.data.type==="progress"?r(c+y.data.percent*c/100):y.data.type==="compileDone"&&h(y.data.list)},m.postMessage({type:"compile",targetImages:o})})}}class aLe{constructor(r,o){this.width=r,this.height=o,this.texShape=[o,r];const c=document.createElement("canvas").getContext("2d");c.canvas.width=r,c.canvas.height=o,this.context=c,this.program=this.buildProgram(r,o);const h=uf();this.tempPixelHandle=h.makeTensorInfo(this.texShape,"float32"),h.texData.get(this.tempPixelHandle.dataId).usage=2}_loadInput(r){return Qe(()=>{let o=Khe(r);return o=o.mean(2),o})}loadInput(r){const o=this.context;if(o.clearRect(0,0,this.context.canvas.width,this.context.canvas.height),r.width===this.height&&r.height===this.width){let h=this.context.canvas.width/2,f=this.context.canvas.height/2;o.save(),o.translate(h,f),o.rotate(90*Math.PI/180),o.drawImage(r,-r.width/2,-r.height/2),o.restore()}else this.context.drawImage(r,0,0,r.width,r.height);const c=uf();return c.gpgpu.uploadPixelDataToTexture(c.getTexture(this.tempPixelHandle.dataId),this.context.canvas),this._compileAndRun(this.program,[this.tempPixelHandle])}buildProgram(r,o){const c=Te().getNumber("WEBGL_VERSION")===2?"texture":"texture2D";return{variableNames:["A"],outputShape:this.texShape,userCode:`
	void main() {
	  ivec2 coords = getOutputCoords();
	  int texR = coords[0];
	  int texC = coords[1];
	  vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${o}.0);

	  vec4 values = ${c}(A, uv);
	  setOutput((0.299 * values.r + 0.587 * values.g + 0.114 * values.b) * 255.0);
	}
      `}}_compileAndRun(r,o){const c=uf().compileAndRun(r,o);return cr().makeTensorFromDataId(c.dataId,c.shape,c.dtype)}_runWebGLProgram(r,o,c){const h=uf().runWebGLProgram(r,o,c);return cr().makeTensorFromDataId(h.dataId,h.shape,h.dtype)}}const cX=(a,r)=>{const o=2*Math.PI*r*a;return o/(o+1)},uX=(a,r,o)=>a*r+(1-a)*o;class lLe{constructor({minCutOff:r,beta:o}){this.minCutOff=r,this.beta=o,this.dCutOff=.001,this.xPrev=null,this.dxPrev=null,this.tPrev=null,this.initialized=!1}reset(){this.initialized=!1}filter(r,o){if(!this.initialized)return this.initialized=!0,this.xPrev=o,this.dxPrev=o.map(()=>0),this.tPrev=r,o;const{xPrev:c,tPrev:h,dxPrev:f}=this,m=r-h,y=cX(m,this.dCutOff),A=[],w=[],C=[];for(let _=0;_<o.length;_++){A[_]=(o[_]-c[_])/m,w[_]=uX(y,A[_],f[_]);const T=this.minCutOff+this.beta*Math.abs(w[_]),B=cX(m,T);C[_]=uX(B,o[_],c[_])}return this.xPrev=C,this.dxPrev=w,this.tPrev=r,C}}const pL={memory:yM,nextFrame:Uw},cLe=.001,uLe=1e3,hLe=5,dLe=5;class hX{constructor({inputWidth:r,inputHeight:o,onUpdate:c=null,debugMode:h=!1,maxTrack:f=1,warmupTolerance:m=null,missTolerance:y=null,filterMinCF:A=null,filterBeta:w=null}){this.inputWidth=r,this.inputHeight=o,this.maxTrack=f,this.filterMinCF=A===null?cLe:A,this.filterBeta=w===null?uLe:w,this.warmupTolerance=m===null?hLe:m,this.missTolerance=y===null?dLe:y,this.cropDetector=new cRe(this.inputWidth,this.inputHeight,h),this.inputLoader=new aLe(this.inputWidth,this.inputHeight),this.markerDimensions=null,this.onUpdate=c,this.debugMode=h,this.processingVideo=!1,this.interestedTargetIndex=-1,this.trackingStates=[];const C=10,_=1e5,T=45*Math.PI/180,B=this.inputHeight/2/Math.tan(T/2);this.projectionTransform=[[B,0,this.inputWidth/2],[0,B,this.inputHeight/2],[0,0,1]],this.projectionMatrix=this._glProjectionMatrix({projectionTransform:this.projectionTransform,width:this.inputWidth,height:this.inputHeight,near:C,far:_}),this.worker=new Cke,this.workerMatchDone=null,this.workerTrackDone=null,this.worker.onmessage=O=>{O.data.type==="matchDone"&&this.workerMatchDone!==null&&this.workerMatchDone(O.data),O.data.type==="trackUpdateDone"&&this.workerTrackDone!==null&&this.workerTrackDone(O.data)}}showTFStats(){console.log(pL.memory().numTensors),console.table(pL.memory())}addImageTargets(r){return new Promise(async(o,c)=>{const h=await(await fetch(r)).arrayBuffer(),f=this.addImageTargetsFromBuffer(h);o(f)})}addImageTargetsFromBuffer(r){const o=new lX().importData(r),c=[],h=[],f=[];for(let m=0;m<o.length;m++)h.push(o[m].matchingData),c.push(o[m].trackingData),f.push([o[m].targetImage.width,o[m].targetImage.height]);return this.tracker=new Bke(f,c,this.projectionTransform,this.inputWidth,this.inputHeight,this.debugMode),this.worker.postMessage({type:"setup",inputWidth:this.inputWidth,inputHeight:this.inputHeight,projectionTransform:this.projectionTransform,debugMode:this.debugMode,matchingDataList:h}),this.markerDimensions=f,{dimensions:f,matchingDataList:h,trackingDataList:c}}dispose(){this.stopProcessVideo(),this.worker.postMessage({type:"dispose"})}dummyRun(r){const o=this.inputLoader.loadInput(r);this.cropDetector.detect(o),this.tracker.dummyRun(o),o.dispose()}getProjectionMatrix(){return this.projectionMatrix}getRotatedZ90Matrix(r){return[-r[1],r[0],r[2],r[3],-r[5],r[4],r[6],r[7],-r[9],r[8],r[10],r[11],-r[13],r[12],r[14],r[15]]}getWorldMatrix(r,o){return this._glModelViewMatrix(r,o)}async _detectAndMatch(r,o){const{featurePoints:c}=this.cropDetector.detectMoving(r),{targetIndex:h,modelViewTransform:f}=await this._workerMatch(c,o);return{targetIndex:h,modelViewTransform:f}}async _trackAndUpdate(r,o,c){const{worldCoords:h,screenCoords:f}=this.tracker.track(r,o,c);return h.length<4?null:await this._workerTrackUpdate(o,{worldCoords:h,screenCoords:f})}processVideo(r){if(!this.processingVideo){this.processingVideo=!0,this.trackingStates=[];for(let o=0;o<this.markerDimensions.length;o++)this.trackingStates.push({showing:!1,isTracking:!1,currentModelViewTransform:null,trackCount:0,trackMiss:0,filter:new lLe({minCutOff:this.filterMinCF,beta:this.filterBeta})});(async()=>{for(;this.processingVideo;){const o=this.inputLoader.loadInput(r);if(this.trackingStates.reduce((c,h)=>c+(h.isTracking?1:0),0)<this.maxTrack){const c=[];for(let m=0;m<this.trackingStates.length;m++)this.trackingStates[m].isTracking!==!0&&(this.interestedTargetIndex!==-1&&this.interestedTargetIndex!==m||c.push(m));const{targetIndex:h,modelViewTransform:f}=await this._detectAndMatch(o,c);h!==-1&&(this.trackingStates[h].isTracking=!0,this.trackingStates[h].currentModelViewTransform=f)}for(let c=0;c<this.trackingStates.length;c++){const h=this.trackingStates[c];if(h.isTracking){let f=await this._trackAndUpdate(o,h.currentModelViewTransform,c);f===null?h.isTracking=!1:h.currentModelViewTransform=f}if(h.showing||h.isTracking&&(h.trackMiss=0,h.trackCount+=1,h.trackCount>this.warmupTolerance&&(h.showing=!0,h.trackingMatrix=null,h.filter.reset())),h.showing&&(h.isTracking?h.trackMiss=0:(h.trackCount=0,h.trackMiss+=1,h.trackMiss>this.missTolerance&&(h.showing=!1,h.trackingMatrix=null,this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:c,worldMatrix:null})))),h.showing){const f=this._glModelViewMatrix(h.currentModelViewTransform,c);h.trackingMatrix=h.filter.filter(Date.now(),f);let m=[];for(let y=0;y<h.trackingMatrix.length;y++)m[y]=h.trackingMatrix[y];r.width===this.inputHeight&&r.height===this.inputWidth&&(m=this.getRotatedZ90Matrix(m)),this.onUpdate&&this.onUpdate({type:"updateMatrix",targetIndex:c,worldMatrix:m})}}o.dispose(),this.onUpdate&&this.onUpdate({type:"processDone"}),await pL.nextFrame()}})()}}stopProcessVideo(){this.processingVideo=!1}async detect(r){const o=this.inputLoader.loadInput(r),{featurePoints:c,debugExtra:h}=await this.cropDetector.detect(o);return o.dispose(),{featurePoints:c,debugExtra:h}}async match(r,o){const{modelViewTransform:c,debugExtra:h}=await this._workerMatch(r,[o]);return{modelViewTransform:c,debugExtra:h}}async track(r,o,c){const h=this.inputLoader.loadInput(r),f=this.tracker.track(h,o,c);return h.dispose(),f}async trackUpdate(r,o){return o.worldCoords.length<4?null:await this._workerTrackUpdate(r,o)}_workerMatch(r,o){return new Promise(async(c,h)=>{this.workerMatchDone=f=>{c({targetIndex:f.targetIndex,modelViewTransform:f.modelViewTransform,debugExtra:f.debugExtra})},this.worker.postMessage({type:"match",featurePoints:r,targetIndexes:o})})}_workerTrackUpdate(r,o){return new Promise(async(c,h)=>{this.workerTrackDone=y=>{c(y.modelViewTransform)};const{worldCoords:f,screenCoords:m}=o;this.worker.postMessage({type:"trackUpdate",modelViewTransform:r,worldCoords:f,screenCoords:m})})}_glModelViewMatrix(r,o){const c=this.markerDimensions[o][1];return[r[0][0],-r[1][0],-r[2][0],0,-r[0][1],r[1][1],r[2][1],0,-r[0][2],r[1][2],r[2][2],0,r[0][1]*c+r[0][3],-(r[1][1]*c+r[1][3]),-(r[2][1]*c+r[2][3]),1]}_glProjectionMatrix({projectionTransform:r,width:o,height:c,near:h,far:f}){const m=[[2*r[0][0]/o,0,-(2*r[0][2]/o-1),0],[0,2*r[1][1]/c,-(2*r[1][2]/c-1),0],[0,0,-(f+h)/(f-h),-2*f*h/(f-h)],[0,0,-1,0]],y=[];for(let A=0;A<4;A++)for(let w=0;w<4;w++)y.push(m[w][A]);return y}}const fLe=`<div class="mindar-ui-overlay mindar-ui-loading">
  <div class="loader"/>
</div>
`,pLe=`<div class="mindar-ui-overlay mindar-ui-compatibility">
  <div class="content">
    <h1>Failed to launch :(</h1>
    <p>
      Looks like your device/browser is not compatible.
    </p>

    <br/>
    <br/>
    <p>
      Please try the following recommended browsers:
    </p>
    <p>
      For Android device - Chrome
    </p>
    <p>
      For iOS device - Safari
    </p>
  </div>
</div>
`,mLe=`<div class="mindar-ui-overlay mindar-ui-scanning">
  <div class="scanning">
    <div class="inner">
      <div class="scanline"/>
    </div>
  </div>
</div>
`,gLe=".mindar-ui-overlay{display:flex;align-items:center;justify-content:center;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;z-index:2}.mindar-ui-overlay.hidden{display:none}.mindar-ui-loading .loader{border:16px solid #222;border-top:16px solid white;opacity:.8;border-radius:50%;width:120px;height:120px;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.mindar-ui-compatibility .content{background:black;color:#fff;opacity:.8;text-align:center;margin:20px;padding:20px;min-height:50vh}@media (min-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:50vh;height:50vh}}@media (max-aspect-ratio: 1/1){.mindar-ui-scanning .scanning{width:80vw;height:80vw}}.mindar-ui-scanning .scanning .inner{position:relative;width:100%;height:100%;opacity:.8;background:linear-gradient(to right,white 10px,transparent 10px) 0 0,linear-gradient(to right,white 10px,transparent 10px) 0 100%,linear-gradient(to left,white 10px,transparent 10px) 100% 0,linear-gradient(to left,white 10px,transparent 10px) 100% 100%,linear-gradient(to bottom,white 10px,transparent 10px) 0 0,linear-gradient(to bottom,white 10px,transparent 10px) 100% 0,linear-gradient(to top,white 10px,transparent 10px) 0 100%,linear-gradient(to top,white 10px,transparent 10px) 100% 100%;background-repeat:no-repeat;background-size:40px 40px}.mindar-ui-scanning .scanning .inner .scanline{position:absolute;width:100%;height:10px;background:white;animation:move 2s linear infinite}@keyframes move{0%,to{top:0%}50%{top:calc(100% - 10px)}}";class dX{constructor({uiLoading:r,uiScanning:o,uiError:c}){const h=document.createElement("style");h.innerText=gLe,document.head.appendChild(h),r==="yes"?this.loadingModal=this._loadHTML(fLe):r!=="no"&&(this.loadingModal=document.querySelector(r)),c==="yes"?this.compatibilityModal=this._loadHTML(pLe):c!=="no"&&(this.compatibilityModal=document.querySelector(c)),o==="yes"?this.scanningMask=this._loadHTML(mLe):o!=="no"&&(this.scanningMask=document.querySelector(o)),this.hideLoading(),this.hideCompatibility(),this.hideScanning()}showLoading(){this.loadingModal&&this.loadingModal.classList.remove("hidden")}hideLoading(){this.loadingModal&&this.loadingModal.classList.add("hidden")}showCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.remove("hidden")}hideCompatibility(){this.compatibilityModal&&this.compatibilityModal.classList.add("hidden")}showScanning(){this.scanningMask&&this.scanningMask.classList.remove("hidden")}hideScanning(){this.scanningMask&&this.scanningMask.classList.add("hidden")}_loadHTML(r){const o=document.createElement("template");o.innerHTML=r.trim();const c=o.content.firstChild;return document.getElementsByTagName("body")[0].appendChild(c),c}}window.MINDAR||(window.MINDAR={}),window.MINDAR.IMAGE={Controller:hX,Compiler:lX,UI:dX},AFRAME.registerSystem("mindar-image-system",{container:null,video:null,processingImage:!1,init:function(){this.anchorEntities=[]},tick:function(){},setup:function({imageTargetSrc:a,maxTrack:r,showStats:o,uiLoading:c,uiScanning:h,uiError:f,missTolerance:m,warmupTolerance:y,filterMinCF:A,filterBeta:w}){this.imageTargetSrc=a,this.maxTrack=r,this.filterMinCF=A,this.filterBeta=w,this.missTolerance=m,this.warmupTolerance=y,this.showStats=o,this.ui=new dX({uiLoading:c,uiScanning:h,uiError:f})},registerAnchor:function(a,r){this.anchorEntities.push({el:a,targetIndex:r})},start:function(){this.container=this.el.sceneEl.parentNode,this.showStats&&(this.mainStats=new Stats,this.mainStats.showPanel(0),this.mainStats.domElement.style.cssText="position:absolute;top:0px;left:0px;z-index:999",this.container.appendChild(this.mainStats.domElement)),this.ui.showLoading(),this._startVideo()},switchTarget:function(a){this.controller.interestedTargetIndex=a},stop:function(){this.pause(),this.video.srcObject.getTracks().forEach(function(a){a.stop()}),this.video.remove(),this.controller.dispose()},pause:function(a=!1){a||this.video.pause(),this.controller.stopProcessVideo()},unpause:function(){this.video.play(),this.controller.processVideo(this.video)},_startVideo:function(){if(this.video=document.createElement("video"),this.video.setAttribute("autoplay",""),this.video.setAttribute("muted",""),this.video.setAttribute("playsinline",""),this.video.style.position="absolute",this.video.style.top="0px",this.video.style.left="0px",this.video.style.zIndex="-2",this.container.appendChild(this.video),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){this.el.emit("arError",{error:"VIDEO_FAIL"}),this.ui.showCompatibility();return}navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(a=>{this.video.addEventListener("loadedmetadata",()=>{this.video.setAttribute("width",this.video.videoWidth),this.video.setAttribute("height",this.video.videoHeight),this._startAR()}),this.video.srcObject=a}).catch(a=>{console.log("getUserMedia error",a),this.el.emit("arError",{error:"VIDEO_FAIL"})})},_startAR:async function(){const a=this.video;this.container,this.controller=new hX({inputWidth:a.videoWidth,inputHeight:a.videoHeight,maxTrack:this.maxTrack,filterMinCF:this.filterMinCF,filterBeta:this.filterBeta,missTolerance:this.missTolerance,warmupTolerance:this.warmupTolerance,onUpdate:o=>{if(o.type==="processDone")this.mainStats&&this.mainStats.update();else if(o.type==="updateMatrix"){const{targetIndex:c,worldMatrix:h}=o;for(let f=0;f<this.anchorEntities.length;f++)this.anchorEntities[f].targetIndex===c&&this.anchorEntities[f].el.updateWorldMatrix(h);this.anchorEntities.reduce((f,m)=>f||m.el.el.object3D.visible,!1)?this.ui.hideScanning():this.ui.showScanning()}}}),this._resize(),window.addEventListener("resize",this._resize.bind(this));const{dimensions:r}=await this.controller.addImageTargets(this.imageTargetSrc);for(let o=0;o<this.anchorEntities.length;o++){const{el:c,targetIndex:h}=this.anchorEntities[o];h<r.length&&c.setupMarker(r[h])}await this.controller.dummyRun(this.video),this.el.emit("arReady"),this.ui.hideLoading(),this.ui.showScanning(),this.controller.processVideo(this.video)},_resize:function(){const a=this.video,r=this.container;let o,c;const h=a.videoWidth/a.videoHeight,f=r.clientWidth/r.clientHeight;h>f?(c=r.clientHeight,o=c*h):(o=r.clientWidth,c=o/h);const m=this.controller.getProjectionMatrix(),y=2*Math.atan(1/m[5]/c*r.clientHeight)*180/Math.PI,A=m[14]/(m[10]-1),w=m[14]/(m[10]+1);m[5]/m[0];const C=r.clientWidth/r.clientHeight,_=r.getElementsByTagName("a-camera")[0].getObject3D("camera");_.fov=y,_.aspect=C,_.near=A,_.far=w,_.updateProjectionMatrix(),this.video.style.top=-(c-r.clientHeight)/2+"px",this.video.style.left=-(o-r.clientWidth)/2+"px",this.video.style.width=o+"px",this.video.style.height=c+"px"}}),AFRAME.registerComponent("mindar-image",{dependencies:["mindar-image-system"],schema:{imageTargetSrc:{type:"string"},maxTrack:{type:"int",default:1},filterMinCF:{type:"number",default:-1},filterBeta:{type:"number",default:-1},missTolerance:{type:"int",default:-1},warmupTolerance:{type:"int",default:-1},showStats:{type:"boolean",default:!1},autoStart:{type:"boolean",default:!0},uiLoading:{type:"string",default:"yes"},uiScanning:{type:"string",default:"yes"},uiError:{type:"string",default:"yes"}},init:function(){const a=this.el.sceneEl.systems["mindar-image-system"];a.setup({imageTargetSrc:this.data.imageTargetSrc,maxTrack:this.data.maxTrack,filterMinCF:this.data.filterMinCF===-1?null:this.data.filterMinCF,filterBeta:this.data.filterBeta===-1?null:this.data.filterBeta,missTolerance:this.data.missTolerance===-1?null:this.data.missTolerance,warmupTolerance:this.data.warmupTolerance===-1?null:this.data.warmupTolerance,showStats:this.data.showStats,uiLoading:this.data.uiLoading,uiScanning:this.data.uiScanning,uiError:this.data.uiError}),this.data.autoStart&&this.el.sceneEl.addEventListener("renderstart",()=>{a.start()})},remove:function(){this.el.sceneEl.systems["mindar-image-system"].stop()}}),AFRAME.registerComponent("mindar-image-target",{dependencies:["mindar-image-system"],schema:{targetIndex:{type:"number"}},postMatrix:null,init:function(){this.el.sceneEl.systems["mindar-image-system"].registerAnchor(this,this.data.targetIndex),this.invisibleMatrix=new AFRAME.THREE.Matrix4().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const a=this.el.object3D;a.visible=!1,a.matrixAutoUpdate=!1,a.matrix=this.invisibleMatrix},setupMarker([a,r]){const o=new AFRAME.THREE.Vector3,c=new AFRAME.THREE.Quaternion,h=new AFRAME.THREE.Vector3;o.x=a/2,o.y=a/2+(r-a)/2,h.x=a,h.y=a,h.z=a,this.postMatrix=new AFRAME.THREE.Matrix4,this.postMatrix.compose(o,c,h)},updateWorldMatrix(a){if(this.el.emit("targetUpdate"),!this.el.object3D.visible&&a!==null?this.el.emit("targetFound"):this.el.object3D.visible&&a===null&&this.el.emit("targetLost"),this.el.object3D.visible=a!==null,a===null){this.el.object3D.matrix=this.invisibleMatrix;return}var r=new AFRAME.THREE.Matrix4;r.elements=a,r.multiply(this.postMatrix),this.el.object3D.matrix=r}})})();const qj={"art-01":{name:"Kolbenova 1",area:"Vysoany",points:100,hood:"Vysoany",location:[50.110192,14.503811]},"art-02":{name:"Kolbenova 2",area:"Vysoany",points:50,hood:"Vysoany",location:[50.110203,14.503764]},"art-03":{name:"Kolbenova 3",area:"Vysoany",points:100,hood:"Vysoany",location:[50.109847,14.50425]},"art-04":{name:"Kolbenova 4",area:"Vysoany",points:25,hood:"Vysoany",location:[50.109981,14.504933]},"art-05":{name:"Kolbenova 5",area:"Vysoany",points:200,hood:"Vysoany",location:[50.109764,14.505742]},"art-06":{name:"Kolbenova 6",area:"Vysoany",points:100,hood:"Vysoany",location:[50.109672,14.505847]},"art-07":{name:"Hloubtn 1",area:"Hloubtn",points:100,hood:"Vysoany",location:[50.110383,14.508192]},"art-08":{name:"Hloubtn 2",area:"Hloubtn",points:200,hood:"Vysoany",location:[50.110508,14.509567]},"art-09":{name:"Vysoany 1",area:"Vysoany",points:100,hood:"Vysoany",location:[50.110817,14.505475]},"art-10":{name:"Vysoany 2",area:"Vysoany",points:50,hood:"Vysoany",location:[50.110986,14.504672]}},Jj={0:"art-01",1:"art-02",2:"art-03",3:"art-04",4:"art-05",5:"art-06",6:"art-07",7:"art-08",8:"art-09",9:"art-10"},e7=10*60*1e3;function OJe(){const n=H1(),e=Le.useRef(null),{player:t}=Kd(),[i,s]=Le.useState(!0),[l,u]=Le.useState(null),[d,p]=Le.useState(null),[g,x]=Le.useState(!1),[b,E]=Le.useState(null),[S,M]=Le.useState(!1),[R,P]=Le.useState(null),k=(t==null?void 0:t.team)||"red",F=Le.useCallback(async Q=>{var H;try{const j=await GK(jf(eh,"streetart-captures",Q)),ee=j.exists()?j.data():null,de=await GK(jf(eh,"streetart-scans",`${t.id}_${Q}`)),oe=de.exists()?(H=de.data().timestamp)==null?void 0:H.toMillis():null;if(ee!=null&&ee.capturedBy&&ee.capturedBy!==k)return{canScan:!0,reason:"recapture"};if(oe){const we=Date.now()-oe;if(we<e7)return{canScan:!1,reason:`Wait ${Math.ceil((e7-we)/6e4)}m`}}return{canScan:!0,reason:null}}catch(j){return console.error("Error checking scan status:",j),{canScan:!0,reason:null}}},[t==null?void 0:t.id,k]),V=Le.useCallback(async Q=>{const H=Jj[Q];if(!H||!qj[H])return;const j=qj[H];p({id:H,...j});const ee=await F(H);x(ee.canScan),E(ee.canScan?ee.reason==="recapture"?" Recapture!":null:ee.reason)},[F]),G=Le.useCallback(()=>{p(null),x(!1),E(null),setCaptureProgress(0),holdTimerRef.current&&(clearInterval(holdTimerRef.current),holdTimerRef.current=null)},[]),q=Le.useCallback(async()=>{if(!(!d||!t))try{const Q=d.id,H=d.points;await Jy(jf(eh,"streetart-scans",`${t.id}_${Q}`),{timestamp:AE(),artId:Q,playerId:t.id}),await Jy(jf(eh,"streetart-captures",Q),{artId:Q,capturedBy:k,capturedAt:AE(),playerId:t.id,playerName:t.name,points:H}),await Jy(jf(eh,"streetart-teams",k),{score:HK(H),lastCapture:Q,lastCaptureAt:AE()},{merge:!0}),await Jy(jf(eh,"streetart-players",t.id),{name:t.name,team:k,score:HK(H),lastActive:AE()},{merge:!0}),console.log(" Captured to Firebase:",Q,H),P({id:Q,...d}),M(!0),setTimeout(()=>{localStorage.setItem("streetart-ctf-lastCapture",JSON.stringify({artId:Q,location:d.location,team:k})),n("/map")},2500)}catch(Q){console.error("Capture error:",Q),u("Failed to capture. Try again.")}},[d,t,k]),ne=Le.useCallback(()=>{!g||!d||q()},[g,d,q]);Le.useEffect(()=>{const Q=e.current;if(!Q)return;let H=null,j=[];const de=setTimeout(async()=>{Q.hasLoaded||await new Promise(oe=>Q.addEventListener("loaded",oe,{once:!0}));for(let oe=0;oe<Object.keys(Jj).length;oe++){const we=document.createElement("a-entity");we.setAttribute("mindar-image-target",`targetIndex: ${oe}`),we.setAttribute("data-target-index",oe.toString()),we.addEventListener("targetFound",()=>{console.log(" Target found:",oe),V(oe)}),we.addEventListener("targetLost",()=>{console.log(" Target lost:",oe),G()}),Q.appendChild(we),j.push(we)}if(H=Q.systems["mindar-image-system"],H)try{console.log(" Starting MindAR..."),await H.start(),console.log(" MindAR started!"),s(!1)}catch(oe){console.error("MindAR start error:",oe),u("Camera access required"),s(!1)}else console.error("MindAR system not found"),u("AR system failed to load"),s(!1)},500);return()=>{clearTimeout(de),j.forEach(oe=>oe.remove()),H&&H.stop()}},[V,G]);const K=k==="red"?"#ff6b6b":"#4dabf7";return he.jsxs("div",{className:"fixed inset-0 bg-black z-50",children:[he.jsx("a-scene",{ref:e,"mindar-image":"imageTargetSrc: https://raw.githubusercontent.com/postptacek/street-art-ctf/main/client/targets.mind; autoStart: false; maxTrack: 1; filterMinCF: 0.0001; filterBeta: 1000; uiLoading: no; uiError: no; uiScanning: no;","color-space":"sRGB",renderer:"colorManagement: true","vr-mode-ui":"enabled: false","device-orientation-permission-ui":"enabled: false",embedded:!0,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},children:he.jsx("a-camera",{position:"0 0 0","look-controls":"enabled: false"})}),he.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[he.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between pointer-events-auto",style:{paddingTop:"max(16px, env(safe-area-inset-top))"},children:[he.jsx("button",{onClick:()=>n(-1),className:"w-10 h-10 rounded-full bg-black/50 backdrop-blur flex items-center justify-center",children:he.jsx(nHe,{size:24,className:"text-white"})}),he.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-full bg-black/50 backdrop-blur",children:[he.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:K}}),he.jsx("span",{className:"text-white text-sm font-medium capitalize",children:k})]})]}),i&&he.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80",children:he.jsxs("div",{className:"text-center",children:[he.jsx("div",{className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin mx-auto mb-4"}),he.jsx("p",{className:"text-white",children:"Loading AR Scanner..."})]})}),l&&he.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80",children:he.jsxs("div",{className:"text-center p-6",children:[he.jsx("div",{className:"text-4xl mb-4",children:""}),he.jsx("p",{className:"text-white mb-4",children:l}),he.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-white text-black rounded-xl font-bold",children:"Retry"})]})}),he.jsx(RA,{children:d&&!S&&he.jsx(Mn.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-24 left-4 right-4",children:he.jsxs("div",{className:"bg-black/70 backdrop-blur-xl rounded-2xl p-4 flex items-center justify-between",children:[he.jsxs("div",{children:[he.jsx("p",{className:"text-white font-bold text-lg",children:d.name}),he.jsxs("p",{className:"text-white/60 text-sm",children:[d.area,"  ",d.hood]})]}),he.jsx("div",{className:`px-4 py-2 rounded-xl font-bold text-lg ${g?"bg-green-500":"bg-amber-500"}`,children:g?`+${d.points}`:""})]})})}),!d&&!i&&!l&&he.jsx("div",{className:"absolute bottom-40 left-0 right-0 text-center",children:he.jsx("p",{className:"text-white/70 text-sm",children:"Point camera at street art to scan"})}),d&&!S&&he.jsx("div",{className:"absolute bottom-36 left-0 right-0 text-center",children:he.jsx("p",{className:`text-sm font-medium ${g?"text-green-400":"text-amber-400"}`,children:b||(g?"Tap to capture!":"Searching...")})}),!S&&he.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex justify-center items-center pointer-events-auto",style:{paddingBottom:"max(32px, env(safe-area-inset-bottom))"},children:he.jsx("button",{onClick:ne,disabled:!g,className:`w-20 h-20 rounded-full text-3xl flex items-center justify-center transition-all border-4 ${g?"bg-white/20 border-green-500 active:bg-green-500/30 active:scale-95":"bg-white/5 border-white/20 opacity-50"}`,children:""})})]}),he.jsx(RA,{children:S&&R&&he.jsxs(Mn.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/95 flex flex-col items-center justify-center p-6",children:[he.jsx(Mn.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.1},className:"w-24 h-24 rounded-full flex items-center justify-center mb-6",style:{backgroundColor:`${K}20`,border:`3px solid ${K}`},children:he.jsx("span",{className:"text-5xl",children:""})}),he.jsx(Mn.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"text-3xl font-bold text-white mb-2",children:"Territory Captured!"}),he.jsxs(Mn.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"text-white/60 mb-4",children:[R.name,"  ",R.area]}),he.jsxs(Mn.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",delay:.4},className:"text-6xl font-bold mb-6",style:{color:K},children:["+",R.points]}),he.jsxs(Mn.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"text-white/40 text-sm",children:["Points added to Team ",k==="red"?"Red ":"Blue "]}),he.jsxs(Mn.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},className:"mt-8 flex items-center gap-2 text-white/50",children:[he.jsx(XO,{size:16}),he.jsx("span",{className:"text-sm",children:"Opening map..."})]})]})})]})}function VJe(){const{player:n}=Kd();return n.team?he.jsx(OJe,{}):he.jsx(Mn.div,{className:"flex-1 flex items-center justify-center p-8",initial:{opacity:0},animate:{opacity:1},children:he.jsxs("div",{className:"text-center",children:[he.jsx("div",{className:"w-20 h-20 rounded-3xl bg-amber-500/10 border border-amber-500/20 flex items-center justify-center mx-auto mb-6",children:he.jsx(eHe,{size:36,className:"text-amber-500"})}),he.jsx("h2",{className:"text-2xl font-bold mb-3 text-white",children:"Join a Team First"}),he.jsx("p",{className:"text-white/40 text-sm max-w-xs",children:"Select your team from the home screen to start scanning street art"})]})})}const UJe=[{id:1,name:"StreetKing",team:"red",score:1250,captures:12},{id:2,name:"ArtHunter",team:"blue",score:980,captures:9},{id:3,name:"SprayQueen",team:"red",score:650,captures:6},{id:4,name:"UrbanExplorer",team:"blue",score:580,captures:5},{id:5,name:"WallWalker",team:"red",score:420,captures:4},{id:6,name:"NightOwl",team:"blue",score:380,captures:3}],zJe={red:"Crimson",blue:"Azure"};function GJe({team:n,score:e,rank:t,totalScore:i}){const s=e/i*100,l=t===0;return he.jsxs(Mn.div,{className:"relative overflow-hidden rounded-2xl",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1,type:"spring",stiffness:100},children:[he.jsx("div",{className:"absolute inset-0",style:{background:`linear-gradient(135deg, ${Rr[n].hex}15 0%, transparent 60%)`}}),he.jsx(Mn.div,{className:"absolute inset-y-0 left-0 opacity-10",style:{backgroundColor:Rr[n].hex},initial:{width:0},animate:{width:`${s}%`},transition:{duration:1,delay:.3+t*.1,ease:"easeOut"}}),he.jsx("div",{className:"relative p-4 border rounded-2xl",style:{borderColor:`${Rr[n].hex}30`},children:he.jsxs("div",{className:"flex items-center gap-4",children:[he.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${l?"bg-gradient-to-br from-amber-400 to-orange-500":"bg-white/5"}`,children:l?he.jsx(oHe,{size:20,className:"text-white"}):he.jsx("span",{className:"text-lg font-bold text-white/40",children:t+1})}),he.jsxs("div",{className:"flex-1",children:[he.jsx("p",{className:"font-semibold text-white",children:zJe[n]}),he.jsxs("div",{className:"flex items-center gap-1.5 mt-0.5",children:[he.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:Rr[n].hex}}),he.jsxs("span",{className:"text-xs text-white/40",children:[s.toFixed(0),"% territory"]})]})]}),he.jsxs("div",{className:"text-right",children:[he.jsx("p",{className:"text-2xl font-bold",style:{color:Rr[n].hex},children:e.toLocaleString()}),he.jsx("p",{className:"text-xs text-white/30",children:"points"})]})]})})]})}function WJe({player:n,rank:e,isCurrentPlayer:t}){const i=e<3,s=["from-amber-400 to-orange-500","from-slate-300 to-slate-400","from-amber-600 to-amber-700"];return he.jsxs(Mn.div,{className:`flex items-center gap-3 p-3 rounded-xl transition-colors ${t?"bg-white/10 border border-white/20":"bg-white/[0.02] border border-transparent hover:bg-white/[0.04]"}`,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:e*.03,type:"spring",stiffness:100},children:[he.jsx("div",{className:"w-8 flex justify-center",children:i?he.jsx("div",{className:`w-6 h-6 rounded-lg bg-gradient-to-br ${s[e]} flex items-center justify-center`,children:he.jsx("span",{className:"text-xs font-bold text-white",children:e+1})}):he.jsx("span",{className:"text-sm text-white/30 font-medium",children:e+1})}),he.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold",style:{backgroundColor:`${Rr[n.team].hex}20`,color:Rr[n.team].hex},children:n.name.slice(0,2).toUpperCase()}),he.jsxs("div",{className:"flex-1 min-w-0",children:[he.jsxs("p",{className:`font-medium truncate ${t?"text-white":"text-white/80"}`,children:[n.name,t&&he.jsx("span",{className:"ml-2 text-xs px-1.5 py-0.5 rounded bg-white/10 text-white/50",children:"you"})]}),he.jsxs("p",{className:"text-xs text-white/30",children:[n.captures," captures"]})]}),he.jsx("div",{className:"text-right",children:he.jsx("p",{className:"font-bold text-white",children:n.score.toLocaleString()})})]})}function HJe(){var p;const{teamScores:n,player:e}=Kd(),i=Object.entries(n).filter(([g])=>Rr[g]).sort((g,x)=>x[1]-g[1]),s=Object.values(n).reduce((g,x)=>g+x,0)||1,l=UJe.filter(g=>Rr[g.team]);e.team&&e.score>0&&l.push({id:"current",name:e.name,team:e.team,score:e.score,captures:((p=e.capturedArt)==null?void 0:p.length)||0});const u=l.sort((g,x)=>x.score-g.score),d={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}};return he.jsxs(Mn.div,{className:"flex-1 overflow-y-auto pb-24 px-5 pt-12",initial:"hidden",animate:"visible",exit:{opacity:0},variants:d,children:[he.jsx(Mn.div,{className:"mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:he.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[he.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center",children:he.jsx(AT,{size:20,className:"text-white"})}),he.jsxs("div",{children:[he.jsx("h1",{className:"text-2xl font-bold text-white",children:"Leaderboard"}),he.jsx("p",{className:"text-sm text-white/40",children:"Real-time rankings"})]})]})}),he.jsxs("div",{className:"mb-8",children:[he.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[he.jsx(pHe,{size:16,className:"text-white/40"}),he.jsx("h2",{className:"text-sm font-medium text-white/40 uppercase tracking-wider",children:"Team Standings"})]}),he.jsx("div",{className:"space-y-3",children:i.map(([g,x],b)=>he.jsx(GJe,{team:g,score:x,rank:b,totalScore:s},g))})]}),he.jsxs("div",{children:[he.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[he.jsx(aHe,{size:16,className:"text-white/40"}),he.jsx("h2",{className:"text-sm font-medium text-white/40 uppercase tracking-wider",children:"Top Players"})]}),he.jsx("div",{className:"space-y-2",children:u.map((g,x)=>he.jsx(WJe,{player:g,rank:x,isCurrentPlayer:g.id==="current"},g.id))})]})]})}function iN({icon:n,label:e,value:t,color:i}){return he.jsxs(Mn.div,{className:"glass rounded-xl p-4 text-center",whileHover:{scale:1.02},children:[he.jsx(n,{size:24,className:"mx-auto mb-2",style:{color:i}}),he.jsx("p",{className:"text-2xl font-bold",children:t}),he.jsx("p",{className:"text-xs text-gray-400",children:e})]})}function XJe({art:n}){var e,t;return he.jsxs(Mn.div,{className:"flex items-center gap-3 p-3 bg-white/5 rounded-xl",initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[he.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:`${(e=Rr[n.capturedBy])==null?void 0:e.hex}30`},children:he.jsx(b2,{size:20,style:{color:(t=Rr[n.capturedBy])==null?void 0:t.hex}})}),he.jsxs("div",{className:"flex-1",children:[he.jsx("p",{className:"font-medium text-sm",children:n.name}),he.jsxs("p",{className:"text-xs text-gray-400",children:[n.points," pts"]})]}),he.jsx(AA,{size:18,className:"text-gray-500"})]})}function rN({icon:n,label:e,onClick:t}){return he.jsxs(Mn.button,{onClick:t,className:"w-full flex items-center gap-3 p-4 bg-white/5 rounded-xl hover:bg-white/10 transition-colors",whileTap:{scale:.98},children:[he.jsx(n,{size:20,className:"text-gray-400"}),he.jsx("span",{className:"flex-1 text-left",children:e}),he.jsx(AA,{size:18,className:"text-gray-500"})]})}function $Je(){const{player:n,artPoints:e,joinTeam:t,resetAll:i}=Kd(),[s,l]=Le.useState(!1),[u,d]=Le.useState(n.name),p=(e==null?void 0:e.filter(x=>n.capturedArt.includes(x.id)))||[],g=n.team?Rr[n.team].hex:"#64748b";return he.jsxs(Mn.div,{className:"flex-1 overflow-y-auto pb-20 px-4 pt-6",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[he.jsxs("div",{className:"text-center mb-6",children:[he.jsxs(Mn.div,{className:"relative inline-block",whileHover:{scale:1.05},children:[he.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-3",style:{background:`linear-gradient(135deg, ${g}50, ${g}20)`,border:`3px solid ${g}`},children:he.jsx(Tne,{size:40,style:{color:g}})}),he.jsx("button",{className:"absolute bottom-2 right-0 w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:he.jsx(_ne,{size:14})})]}),s?he.jsx("input",{type:"text",value:u,onChange:x=>d(x.target.value),onBlur:()=>l(!1),className:"text-xl font-bold bg-transparent border-b-2 border-white/30 text-center outline-none",autoFocus:!0}):he.jsx("h1",{className:"text-xl font-bold cursor-pointer",onClick:()=>l(!0),children:n.name}),n.team&&he.jsxs("p",{className:"text-sm mt-1",style:{color:g},children:[n.team.charAt(0).toUpperCase()+n.team.slice(1)," Team"]})]}),he.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[he.jsx(iN,{icon:AT,label:"Score",value:n.score,color:"#eab308"}),he.jsx(iN,{icon:b2,label:"Captures",value:p.length,color:"#22c55e"}),he.jsx(iN,{icon:XO,label:"Sectors",value:"3",color:"#3b82f6"})]}),p.length>0&&he.jsxs("div",{className:"mb-6",children:[he.jsxs("h2",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2",children:[he.jsx(b2,{size:16})," YOUR CAPTURES"]}),he.jsx("div",{className:"space-y-2",children:p.map(x=>he.jsx(XJe,{art:x},x.id))})]}),!n.team&&he.jsxs("div",{className:"mb-6",children:[he.jsx("h2",{className:"text-sm font-medium text-gray-400 mb-3",children:"SELECT YOUR TEAM"}),he.jsx("div",{className:"grid grid-cols-2 gap-2",children:["red","blue"].map(x=>he.jsxs(Mn.button,{onClick:()=>t(x),className:"p-4 rounded-xl bg-white/5 text-center",style:{borderColor:Rr[x].hex,borderWidth:2},whileTap:{scale:.95},children:[he.jsx("div",{className:"w-8 h-8 rounded-full mx-auto mb-2",style:{backgroundColor:Rr[x].hex}}),he.jsx("p",{className:"text-sm font-medium capitalize",children:x==="red"?"Crimson":"Azure"})]},x))})]}),he.jsxs("div",{className:"space-y-2",children:[he.jsxs("h2",{className:"text-sm font-medium text-gray-400 mb-3 flex items-center gap-2",children:[he.jsx(hHe,{size:16})," SETTINGS"]}),he.jsx(rN,{icon:tHe,label:"Notifications"}),he.jsx(rN,{icon:dHe,label:"Privacy"}),he.jsx(rN,{icon:uHe,label:"Reset Game Data",onClick:i})]}),he.jsx("p",{className:"text-center text-xs text-gray-500 mt-6",children:"Street Art CTF v1.0.0"})]})}const QJe=[{path:"/",icon:cHe,label:"Home"},{path:"/map",icon:$O,label:"Map"},{path:"/scanner",icon:Sne,label:"Scan"},{path:"/leaderboard",icon:AT,label:"Ranks"},{path:"/profile",icon:Tne,label:"You"}];function KJe(){return he.jsxs("nav",{className:"fixed bottom-0 left-0 right-0 z-[2000]",children:[he.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-xl border-t border-white/[0.06]"}),he.jsx("div",{className:"relative flex justify-around items-center h-16 px-4 pb-safe",children:QJe.map(({path:n,icon:e,label:t})=>he.jsx(qNe,{to:n,className:"flex-1 flex justify-center",children:({isActive:i})=>he.jsxs(Mn.div,{className:"relative flex flex-col items-center justify-center py-2 px-4",whileTap:{scale:.9},transition:{type:"spring",stiffness:400,damping:17},children:[i&&he.jsx(Mn.div,{layoutId:"nav-pill",className:"absolute inset-0 rounded-xl bg-white/[0.08]",transition:{type:"spring",stiffness:400,damping:30}}),he.jsx(Mn.div,{className:"relative z-10",animate:{scale:i?1:.9,opacity:i?1:.5},transition:{type:"spring",stiffness:300,damping:20},children:he.jsx(e,{size:20,strokeWidth:i?2.5:2})}),he.jsx(Mn.span,{className:"relative z-10 text-[10px] mt-1 font-medium",animate:{opacity:i?1:.4,y:i?0:2},transition:{type:"spring",stiffness:300,damping:20},children:t})]})},n))})]})}function V_({children:n}){const{player:e}=Kd();return e.team&&e.name&&e.name!=="Street Artist"?n:he.jsx(Cq,{to:"/onboarding",replace:!0})}function ZJe(){const n=i0(),{player:e}=Kd(),t=e.team&&e.name&&e.name!=="Street Artist",i=n.pathname==="/onboarding"||n.pathname==="/scanner";return he.jsxs("div",{className:"h-full w-full flex flex-col",children:[he.jsx(RA,{mode:"wait",children:he.jsxs(UNe,{location:n,children:[he.jsx(fg,{path:"/onboarding",element:he.jsx(AHe,{})}),he.jsx(fg,{path:"/",element:t?he.jsx(vHe,{}):he.jsx(Cq,{to:"/onboarding",replace:!0})}),he.jsx(fg,{path:"/map",element:he.jsx(V_,{children:he.jsx(WHe,{})})}),he.jsx(fg,{path:"/scanner",element:he.jsx(V_,{children:he.jsx(VJe,{})})}),he.jsx(fg,{path:"/leaderboard",element:he.jsx(V_,{children:he.jsx(HJe,{})})}),he.jsx(fg,{path:"/profile",element:he.jsx(V_,{children:he.jsx($Je,{})})})]},n.pathname)}),!i&&t&&he.jsx(KJe,{})]})}function jJe(){return he.jsx(Y9e,{children:he.jsx(ZJe,{})})}sN.createRoot(document.getElementById("root")).render(he.jsx(Vg.StrictMode,{children:he.jsx(KNe,{children:he.jsx(jJe,{})})}));
